{"version":3,"file":"main-Bgk02h8A.js","sources":["../../src/utils/Platform.ts","../../src/utils/Logger.ts","../../src/core/Renderer.ts","../../src/core/InputManager.ts","../../src/core/Physics.ts","../../src/core/AudioEngine.ts","../../src/audio/ProceduralAudio.ts","../../src/ui/MainMenu.ts","../../src/core/GameStateManager.ts","../../src/entities/ShipSystems.ts","../../src/systems/WarpDrive.ts","../../src/entities/PlayerShip.ts","../../src/procedural/GalaxyGenerator.ts","../../src/procedural/GalaxyPersistence.ts","../../src/procedural/GalaxyManager.ts","../../src/ui/CockpitStatusBar.ts","../../src/entities/CelestialBody.ts","../../src/ui/InteractionPanel.ts","../../src/managers/CelestialManager.ts","../../src/rendering/SpaceBackground.ts","../../src/items/ItemSystem.ts","../../src/inventory/InventoryManager.ts","../../src/crafting/CraftingSystem.ts","../../src/combat/WeaponSystem.ts","../../src/combat/EnemyAI.ts","../../src/combat/CombatManager.ts","../../src/rpg/PlayerProgression.ts","../../src/rpg/ResearchSystem.ts","../../src/rpg/CrewManagement.ts","../../src/diplomacy/DiplomacySystem.ts","../../src/ai/AlienAI.ts","../../src/optimization/PerformanceMonitor.ts","../../src/effects/ParticleSystem.ts","../../src/core/Game.ts","../../src/main.ts"],"sourcesContent":["/**\n * Platform Detection and Management\n * Handles different deployment targets and adaptive features\n */\n\nexport enum Platform {\n    Desktop = 'desktop',\n    Mobile = 'mobile',\n    Web = 'web',\n    Tauri = 'tauri',\n    Cordova = 'cordova'\n}\n\nexport interface PlatformFeatures {\n    hasKeyboard: boolean;\n    hasTouch: boolean;\n    hasFileSystem: boolean;\n    hasFullscreen: boolean;\n    canVibrate: boolean;\n    preferredInputMethod: 'keyboard' | 'touch' | 'hybrid';\n    storageType: 'localStorage' | 'fileSystem' | 'indexedDB';\n}\n\nexport class PlatformDetector {\n    private static cachedPlatform: Platform | null = null;\n    private static cachedFeatures: PlatformFeatures | null = null;\n\n    /**\n     * Detect the current platform\n     */\n    static detect(): Platform {\n        if (this.cachedPlatform) {\n            return this.cachedPlatform;\n        }\n\n        // Check for Tauri (desktop app)\n        if ((window as any).__TAURI__) {\n            this.cachedPlatform = Platform.Tauri;\n            return this.cachedPlatform;\n        }\n\n        // Check for Cordova (mobile app)\n        if ((window as any).cordova) {\n            this.cachedPlatform = Platform.Cordova;\n            return this.cachedPlatform;\n        }\n\n        // Check for mobile browser\n        if (this.isMobile()) {\n            this.cachedPlatform = Platform.Mobile;\n            return this.cachedPlatform;\n        }\n\n        // Check for desktop browser\n        if (this.isDesktop()) {\n            this.cachedPlatform = Platform.Desktop;\n            return this.cachedPlatform;\n        }\n\n        // Default to web\n        this.cachedPlatform = Platform.Web;\n        return this.cachedPlatform;\n    }\n\n    /**\n     * Get platform-specific features\n     */\n    static getFeatures(): PlatformFeatures {\n        if (this.cachedFeatures) {\n            return this.cachedFeatures;\n        }\n\n        const platform = this.detect();\n        \n        this.cachedFeatures = {\n            hasKeyboard: this.hasKeyboard(platform),\n            hasTouch: this.hasTouch(),\n            hasFileSystem: this.hasFileSystem(platform),\n            hasFullscreen: this.hasFullscreen(),\n            canVibrate: this.canVibrate(),\n            preferredInputMethod: this.getPreferredInput(platform),\n            storageType: this.getStorageType(platform)\n        };\n\n        return this.cachedFeatures;\n    }\n\n    /**\n     * Check if running on mobile device\n     */\n    private static isMobile(): boolean {\n        // Check user agent\n        const userAgent = navigator.userAgent || navigator.vendor || (window as any).opera;\n        \n        // Check for mobile patterns\n        const mobileRegex = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i;\n        if (mobileRegex.test(userAgent)) {\n            return true;\n        }\n\n        // Check for touch capability and small screen\n        const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n        const smallScreen = window.innerWidth <= 768 || window.innerHeight <= 768;\n        \n        return hasTouch && smallScreen;\n    }\n\n    /**\n     * Check if running on desktop\n     */\n    private static isDesktop(): boolean {\n        // Check for desktop-specific features\n        const hasKeyboard = !this.isMobile();\n        const largeScreen = window.innerWidth > 768 && window.innerHeight > 768;\n        \n        // Check user agent for desktop patterns\n        const userAgent = navigator.userAgent;\n        const desktopOS = /windows|mac|linux/i.test(userAgent);\n        \n        return hasKeyboard && largeScreen && desktopOS;\n    }\n\n    /**\n     * Check if platform has keyboard support\n     */\n    private static hasKeyboard(platform: Platform): boolean {\n        switch (platform) {\n            case Platform.Desktop:\n            case Platform.Tauri:\n                return true;\n            case Platform.Mobile:\n            case Platform.Cordova:\n                return false;\n            case Platform.Web:\n                return !this.isMobile();\n            default:\n                return true;\n        }\n    }\n\n    /**\n     * Check if platform has touch support\n     */\n    private static hasTouch(): boolean {\n        return 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n    }\n\n    /**\n     * Check if platform has file system access\n     */\n    private static hasFileSystem(platform: Platform): boolean {\n        switch (platform) {\n            case Platform.Tauri:\n            case Platform.Cordova:\n                return true;\n            default:\n                return false;\n        }\n    }\n\n    /**\n     * Check if platform supports fullscreen\n     */\n    private static hasFullscreen(): boolean {\n        return !!(\n            document.fullscreenEnabled ||\n            (document as any).webkitFullscreenEnabled ||\n            (document as any).mozFullScreenEnabled ||\n            (document as any).msFullscreenEnabled\n        );\n    }\n\n    /**\n     * Check if platform can vibrate\n     */\n    private static canVibrate(): boolean {\n        return 'vibrate' in navigator;\n    }\n\n    /**\n     * Get preferred input method for platform\n     */\n    private static getPreferredInput(platform: Platform): 'keyboard' | 'touch' | 'hybrid' {\n        switch (platform) {\n            case Platform.Desktop:\n            case Platform.Tauri:\n                return 'keyboard';\n            case Platform.Mobile:\n            case Platform.Cordova:\n                return 'touch';\n            case Platform.Web:\n                return this.hasTouch() ? 'hybrid' : 'keyboard';\n            default:\n                return 'hybrid';\n        }\n    }\n\n    /**\n     * Get storage type for platform\n     */\n    private static getStorageType(platform: Platform): 'localStorage' | 'fileSystem' | 'indexedDB' {\n        switch (platform) {\n            case Platform.Tauri:\n            case Platform.Cordova:\n                return 'fileSystem';\n            case Platform.Desktop:\n            case Platform.Mobile:\n            case Platform.Web:\n                return 'indexedDB';\n            default:\n                return 'localStorage';\n        }\n    }\n\n    /**\n     * Get platform-specific configuration\n     */\n    static getConfig() {\n        const platform = this.detect();\n        const features = this.getFeatures();\n\n        return {\n            platform,\n            features,\n            canvas: {\n                // Adjust canvas settings based on platform\n                pixelRatio: window.devicePixelRatio || 1,\n                maxWidth: features.hasTouch ? 800 : 1024,\n                maxHeight: features.hasTouch ? 600 : 768,\n                scalingMode: features.hasTouch ? 'fit' : 'native'\n            },\n            input: {\n                // Input configuration\n                enableKeyboard: features.hasKeyboard,\n                enableTouch: features.hasTouch,\n                enableGamepad: platform === Platform.Desktop || platform === Platform.Tauri,\n                touchSensitivity: features.hasTouch ? 1.0 : 0.0,\n                keyRepeatDelay: 250,\n                keyRepeatRate: 50\n            },\n            performance: {\n                // Performance settings based on platform\n                targetFPS: platform === Platform.Mobile ? 30 : 60,\n                enableParticles: platform !== Platform.Mobile,\n                enablePostProcessing: platform === Platform.Desktop || platform === Platform.Tauri,\n                enableShadows: platform === Platform.Desktop,\n                enableDithering: true, // Always enable for 16-bit aesthetic\n                renderScale: features.hasTouch ? 0.8 : 1.0\n            },\n            audio: {\n                // Audio settings\n                enableAudio: true,\n                enableMusic: true,\n                enableSFX: true,\n                enableSpatialAudio: platform === Platform.Desktop,\n                audioFormat: 'webm', // Fallback to mp3 if needed\n                maxChannels: platform === Platform.Mobile ? 8 : 16\n            },\n            storage: {\n                // Storage configuration\n                type: features.storageType,\n                enableAutoSave: true,\n                saveInterval: 30000, // 30 seconds\n                maxSaveSlots: platform === Platform.Mobile ? 3 : 10,\n                compressionEnabled: true\n            }\n        };\n    }\n\n    /**\n     * Check if platform supports specific feature\n     */\n    static supports(feature: keyof PlatformFeatures): boolean {\n        return Boolean(this.getFeatures()[feature]);\n    }\n\n    /**\n     * Get human-readable platform name\n     */\n    static getPlatformName(): string {\n        switch (this.detect()) {\n            case Platform.Desktop:\n                return 'Desktop Browser';\n            case Platform.Mobile:\n                return 'Mobile Browser';\n            case Platform.Web:\n                return 'Web Browser';\n            case Platform.Tauri:\n                return 'Desktop Application';\n            case Platform.Cordova:\n                return 'Mobile Application';\n            default:\n                return 'Unknown Platform';\n        }\n    }\n\n    /**\n     * Reset cached values (useful for testing)\n     */\n    static reset(): void {\n        this.cachedPlatform = null;\n        this.cachedFeatures = null;\n    }\n}","/**\n * Advanced Logging System for Space Explorer\n * Provides structured logging with different levels and platform detection\n */\n\nexport enum LogLevel {\n    DEBUG = 0,\n    INFO = 1,\n    WARN = 2,\n    ERROR = 3,\n    CRITICAL = 4\n}\n\nexport interface LogEntry {\n    timestamp: number;\n    level: LogLevel;\n    module: string;\n    message: string;\n    data?: any;\n    stack?: string;\n}\n\nexport class Logger {\n    private static globalLevel: LogLevel = LogLevel.INFO;\n    private static entries: LogEntry[] = [];\n    private static maxEntries = 1000;\n    private static enableConsole = true;\n    private static enableStorage = false;\n\n    private module: string;\n\n    constructor(module: string) {\n        this.module = module;\n    }\n\n    /**\n     * Configure global logger settings\n     */\n    static configure(config: {\n        level?: LogLevel;\n        maxEntries?: number;\n        enableConsole?: boolean;\n        enableStorage?: boolean;\n    }): void {\n        if (config.level !== undefined) Logger.globalLevel = config.level;\n        if (config.maxEntries !== undefined) Logger.maxEntries = config.maxEntries;\n        if (config.enableConsole !== undefined) Logger.enableConsole = config.enableConsole;\n        if (config.enableStorage !== undefined) Logger.enableStorage = config.enableStorage;\n    }\n\n    /**\n     * Set global log level\n     */\n    static setLevel(level: LogLevel): void {\n        Logger.globalLevel = level;\n    }\n\n    /**\n     * Log debug information\n     */\n    debug(message: string, data?: any): void {\n        this.log(LogLevel.DEBUG, message, data);\n    }\n\n    /**\n     * Log informational messages\n     */\n    info(message: string, data?: any): void {\n        this.log(LogLevel.INFO, message, data);\n    }\n\n    /**\n     * Log warnings\n     */\n    warn(message: string, data?: any): void {\n        this.log(LogLevel.WARN, message, data);\n    }\n\n    /**\n     * Log errors\n     */\n    error(message: string, error?: any): void {\n        let stack: string | undefined;\n        let data = error;\n\n        if (error instanceof Error) {\n            stack = error.stack;\n            data = {\n                name: error.name,\n                message: error.message,\n                stack: error.stack\n            };\n        }\n\n        this.log(LogLevel.ERROR, message, data, stack);\n    }\n\n    /**\n     * Log critical errors\n     */\n    critical(message: string, error?: any): void {\n        let stack: string | undefined;\n        let data = error;\n\n        if (error instanceof Error) {\n            stack = error.stack;\n            data = {\n                name: error.name,\n                message: error.message,\n                stack: error.stack\n            };\n        }\n\n        this.log(LogLevel.CRITICAL, message, data, stack);\n    }\n\n    /**\n     * Core logging method\n     */\n    private log(level: LogLevel, message: string, data?: any, stack?: string): void {\n        // Check if this level should be logged\n        if (level < Logger.globalLevel) {\n            return;\n        }\n\n        const entry: LogEntry = {\n            timestamp: Date.now(),\n            level,\n            module: this.module,\n            message,\n            data,\n            stack\n        };\n\n        // Add to entries buffer\n        Logger.addEntry(entry);\n\n        // Output to console if enabled\n        if (Logger.enableConsole) {\n            Logger.outputToConsole(entry);\n        }\n\n        // Store if enabled\n        if (Logger.enableStorage) {\n            Logger.storeEntry(entry);\n        }\n    }\n\n    /**\n     * Add entry to buffer\n     */\n    private static addEntry(entry: LogEntry): void {\n        this.entries.push(entry);\n\n        // Maintain buffer size\n        if (this.entries.length > this.maxEntries) {\n            this.entries.shift();\n        }\n    }\n\n    /**\n     * Output entry to console with proper formatting\n     */\n    private static outputToConsole(entry: LogEntry): void {\n        const timestamp = new Date(entry.timestamp).toISOString();\n        const levelName = LogLevel[entry.level];\n        const prefix = `[${timestamp}] [${levelName}] [${entry.module}]`;\n\n        // Choose console method based on level\n        let consoleMethod: 'debug' | 'log' | 'warn' | 'error';\n        let style = '';\n\n        switch (entry.level) {\n            case LogLevel.DEBUG:\n                consoleMethod = 'debug';\n                style = 'color: #888; font-size: 11px;';\n                break;\n            case LogLevel.INFO:\n                consoleMethod = 'log';\n                style = 'color: #0f0; font-weight: bold;';\n                break;\n            case LogLevel.WARN:\n                consoleMethod = 'warn';\n                style = 'color: #ff0; font-weight: bold;';\n                break;\n            case LogLevel.ERROR:\n                consoleMethod = 'error';\n                style = 'color: #f00; font-weight: bold;';\n                break;\n            case LogLevel.CRITICAL:\n                consoleMethod = 'error';\n                style = 'color: #f00; font-weight: bold; background: #400;';\n                break;\n            default:\n                consoleMethod = 'log';\n        }\n\n        // Format message\n        if (entry.data !== undefined) {\n            console[consoleMethod](`%c${prefix} ${entry.message}`, style, entry.data);\n        } else {\n            console[consoleMethod](`%c${prefix} ${entry.message}`, style);\n        }\n\n        // Show stack trace for errors\n        if (entry.stack && (entry.level === LogLevel.ERROR || entry.level === LogLevel.CRITICAL)) {\n            console.groupCollapsed('Stack Trace');\n            console.error(entry.stack);\n            console.groupEnd();\n        }\n    }\n\n    /**\n     * Store entry to persistent storage\n     */\n    private static async storeEntry(entry: LogEntry): Promise<void> {\n        try {\n            // Store in localStorage for now (could be enhanced for different platforms)\n            const stored = localStorage.getItem('spaceExplorer_logs');\n            const logs = stored ? JSON.parse(stored) : [];\n            \n            logs.push(entry);\n            \n            // Keep only recent entries\n            if (logs.length > this.maxEntries) {\n                logs.splice(0, logs.length - this.maxEntries);\n            }\n            \n            localStorage.setItem('spaceExplorer_logs', JSON.stringify(logs));\n        } catch (error) {\n            // Silently fail if storage is not available\n            console.warn('Failed to store log entry:', error);\n        }\n    }\n\n    /**\n     * Get all log entries\n     */\n    static getEntries(): LogEntry[] {\n        return [...this.entries];\n    }\n\n    /**\n     * Get entries filtered by level\n     */\n    static getEntriesByLevel(level: LogLevel): LogEntry[] {\n        return this.entries.filter(entry => entry.level === level);\n    }\n\n    /**\n     * Get entries filtered by module\n     */\n    static getEntriesByModule(module: string): LogEntry[] {\n        return this.entries.filter(entry => entry.module === module);\n    }\n\n    /**\n     * Clear all log entries\n     */\n    static clear(): void {\n        this.entries = [];\n        \n        if (this.enableStorage) {\n            try {\n                localStorage.removeItem('spaceExplorer_logs');\n            } catch (error) {\n                // Silently fail\n            }\n        }\n    }\n\n    /**\n     * Export logs as JSON string\n     */\n    static export(): string {\n        return JSON.stringify({\n            exported: new Date().toISOString(),\n            platform: navigator.userAgent,\n            entries: this.entries\n        }, null, 2);\n    }\n\n    /**\n     * Load logs from storage\n     */\n    static async loadFromStorage(): Promise<void> {\n        try {\n            const stored = localStorage.getItem('spaceExplorer_logs');\n            if (stored) {\n                const logs = JSON.parse(stored);\n                this.entries = logs.slice(-this.maxEntries);\n            }\n        } catch (error) {\n            console.warn('Failed to load logs from storage:', error);\n        }\n    }\n\n    /**\n     * Performance logging utility\n     */\n    static performance = {\n        timers: new Map<string, number>(),\n\n        start(name: string): void {\n            this.timers.set(name, performance.now());\n        },\n\n        end(name: string, logger?: Logger): number {\n            const startTime = this.timers.get(name);\n            if (startTime === undefined) {\n                console.warn(`Timer \"${name}\" was not started`);\n                return 0;\n            }\n\n            const duration = performance.now() - startTime;\n            this.timers.delete(name);\n\n            if (logger) {\n                logger.debug(`Performance: ${name} took ${duration.toFixed(2)}ms`);\n            }\n\n            return duration;\n        },\n\n        measure<T>(name: string, fn: () => T, logger?: Logger): T {\n            this.start(name);\n            try {\n                const result = fn();\n                this.end(name, logger);\n                return result;\n            } catch (error) {\n                this.end(name, logger);\n                throw error;\n            }\n        },\n\n        async measureAsync<T>(name: string, fn: () => Promise<T>, logger?: Logger): Promise<T> {\n            this.start(name);\n            try {\n                const result = await fn();\n                this.end(name, logger);\n                return result;\n            } catch (error) {\n                this.end(name, logger);\n                throw error;\n            }\n        }\n    };\n\n    /**\n     * Create module-specific performance logger\n     */\n    createPerformanceLogger() {\n        return {\n            start: (name: string) => Logger.performance.start(`${this.module}:${name}`),\n            end: (name: string) => Logger.performance.end(`${this.module}:${name}`, this),\n            measure: <T>(name: string, fn: () => T) => \n                Logger.performance.measure(`${this.module}:${name}`, fn, this),\n            measureAsync: <T>(name: string, fn: () => Promise<T>) => \n                Logger.performance.measureAsync(`${this.module}:${name}`, fn, this)\n        };\n    }\n}\n\n// Configure logger based on environment\nif (import.meta.env.DEV) {\n    Logger.configure({\n        level: LogLevel.DEBUG,\n        enableConsole: true,\n        enableStorage: true\n    });\n} else {\n    Logger.configure({\n        level: LogLevel.INFO,\n        enableConsole: false,\n        enableStorage: true\n    });\n}\n\n// Load existing logs\nLogger.loadFromStorage();","/**\n * HTML5 Canvas Renderer with 16-bit Aesthetic\n * Handles pixel-perfect rendering, WebGL shaders, and retro CRT effects\n */\n\nimport { Platform } from '@utils/Platform';\nimport { Logger } from '@utils/Logger';\n\nexport interface RenderConfig {\n    pixelRatio: number;\n    enablePixelPerfect: boolean;\n    enableDithering: boolean;\n    enableCRT: boolean;\n    enablePostProcessing: boolean;\n    backgroundColor: string;\n}\n\nexport interface Color {\n    r: number;\n    g: number;\n    b: number;\n    a?: number;\n}\n\nexport interface Vector2 {\n    x: number;\n    y: number;\n}\n\nexport interface Sprite {\n    data: ImageData;\n    width: number;\n    height: number;\n}\n\nexport class Renderer {\n    private canvas: HTMLCanvasElement;\n    private ctx: CanvasRenderingContext2D;\n    private platform: Platform;\n    private config: RenderConfig;\n    \n    // WebGL support for shaders\n    private gl: WebGLRenderingContext | null = null;\n    private shaderPrograms: Map<string, WebGLProgram> = new Map();\n    \n    // 16-bit color palette\n    private colorPalette: Color[] = [];\n    \n    // Render targets\n    private backBuffer!: ImageData;\n    private frontBuffer!: ImageData;\n    \n    // Performance tracking\n    private renderStats = {\n        drawCalls: 0,\n        triangles: 0,\n        sprites: 0,\n        particles: 0\n    };\n    \n    private logger: Logger;\n\n    constructor(canvas: HTMLCanvasElement, platform: Platform) {\n        this.canvas = canvas;\n        this.platform = platform;\n        this.logger = new Logger('Renderer');\n        \n        // Get 2D context\n        const ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('Failed to get 2D rendering context');\n        }\n        this.ctx = ctx;\n        \n        // Setup configuration\n        this.config = {\n            pixelRatio: window.devicePixelRatio || 1,\n            enablePixelPerfect: true,\n            enableDithering: true,\n            enableCRT: platform !== Platform.Mobile, // Disable CRT on mobile for performance\n            enablePostProcessing: platform === Platform.Desktop,\n            backgroundColor: '#000000'\n        };\n        \n        this.logger.info('🎨 Renderer initialized', {\n            canvasSize: `${canvas.width}x${canvas.height}`,\n            platform: platform,\n            config: this.config\n        });\n    }\n\n    /**\n     * Initialize the renderer\n     */\n    async initialize(): Promise<void> {\n        this.logger.info('🔧 Initializing renderer...');\n        \n        try {\n            // Setup canvas for pixel-perfect rendering\n            this.setupPixelPerfectCanvas();\n            \n            // Generate 16-bit color palette\n            this.generateColorPalette();\n            \n            // Initialize WebGL if available and needed\n            if (this.config.enableCRT || this.config.enablePostProcessing) {\n                this.initializeWebGL();\n            }\n            \n            // Create render buffers\n            this.createRenderBuffers();\n            \n            this.logger.info('✅ Renderer initialization completed');\n            \n        } catch (error) {\n            this.logger.error('❌ Renderer initialization failed', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Setup canvas for pixel-perfect rendering\n     */\n    private setupPixelPerfectCanvas(): void {\n        // Disable image smoothing for pixel art\n        this.ctx.imageSmoothingEnabled = false;\n        (this.ctx as any).webkitImageSmoothingEnabled = false;\n        (this.ctx as any).mozImageSmoothingEnabled = false;\n        (this.ctx as any).msImageSmoothingEnabled = false;\n        \n        // Set pixel ratio scaling\n        const scale = this.config.pixelRatio;\n        this.canvas.style.width = `${this.canvas.width}px`;\n        this.canvas.style.height = `${this.canvas.height}px`;\n        this.canvas.width *= scale;\n        this.canvas.height *= scale;\n        this.ctx.scale(scale, scale);\n        \n        this.logger.debug('Canvas configured for pixel-perfect rendering', {\n            scale: scale,\n            size: `${this.canvas.width}x${this.canvas.height}`\n        });\n    }\n\n        /**\n     * Generate 16-bit color palette - Dark, muted, retro CRT style (Power of Ten/Alien 1979)\n     */\n    private generateColorPalette(): void {\n        this.colorPalette = [\n            // Deep blacks and dark grays (foundation)\n            { r: 0, g: 0, b: 0 },           // Pure black\n            { r: 8, g: 8, b: 8 },           // Very dark gray\n            { r: 16, g: 16, b: 16 },        // Dark gray\n            { r: 24, g: 24, b: 24 },        // Medium dark gray\n\n            // Muted dark greens (classic terminal/CRT phosphor)\n            { r: 4, g: 12, b: 4 },          // Very dark green\n            { r: 8, g: 24, b: 8 },          // Dark green\n            { r: 12, g: 36, b: 12 },        // Muted green\n            { r: 16, g: 48, b: 16 },        // Terminal green\n\n            // Worn amber/yellow (old CRT monitors)\n            { r: 24, g: 16, b: 4 },         // Dark amber\n            { r: 48, g: 32, b: 8 },         // Amber\n            { r: 72, g: 48, b: 12 },        // Worn amber\n            { r: 96, g: 64, b: 16 },        // Bright amber\n\n            // Faded orange warnings (damaged systems)\n            { r: 32, g: 16, b: 4 },         // Dark orange\n            { r: 64, g: 32, b: 8 },         // Faded orange\n            { r: 96, g: 48, b: 12 },        // Orange warning\n            { r: 128, g: 64, b: 16 },       // Bright orange\n\n            // Muted reds (critical alerts)\n            { r: 24, g: 8, b: 8 },          // Very dark red\n            { r: 48, g: 16, b: 16 },        // Dark red\n            { r: 72, g: 24, b: 24 },        // Muted red\n            { r: 96, g: 32, b: 32 },        // Alert red\n\n            // Deep blue-grays (space/depth)\n            { r: 8, g: 12, b: 20 },         // Deep blue-gray\n            { r: 16, g: 24, b: 40 },        // Blue-gray\n            { r: 24, g: 36, b: 60 },        // Space blue\n            { r: 32, g: 48, b: 80 },        // Bright blue-gray\n\n            // Faded cyan/teal (shields/energy)\n            { r: 8, g: 20, b: 16 },         // Dark teal\n            { r: 16, g: 40, b: 32 },        // Teal\n            { r: 24, g: 60, b: 48 },        // Faded cyan\n            { r: 32, g: 80, b: 64 },        // Bright teal\n\n            // Muted purples (exotic/alien)\n            { r: 16, g: 8, b: 24 },         // Dark purple\n            { r: 32, g: 16, b: 48 },        // Purple\n            { r: 48, g: 24, b: 72 },        // Muted purple\n            { r: 64, g: 32, b: 96 },        // Bright purple\n\n            // Light grays and worn whites\n            { r: 32, g: 32, b: 32 },        // Medium gray\n            { r: 48, g: 48, b: 48 },        // Light gray\n            { r: 64, g: 64, b: 64 },        // Bright gray\n            { r: 80, g: 80, b: 80 }         // Worn white\n        ];\n\n        this.logger.debug(`Generated dark retro 16-bit color palette with ${this.colorPalette.length} colors`);\n    }\n\n    /**\n     * Initialize WebGL for shader effects\n     */\n    private initializeWebGL(): void {\n        try {\n            this.gl = this.canvas.getContext('webgl') || this.canvas.getContext('experimental-webgl') as WebGLRenderingContext;\n            \n            if (this.gl) {\n                this.logger.info('✅ WebGL context initialized for shader effects');\n                // TODO: Load and compile shaders in future phases\n            } else {\n                this.logger.warn('⚠️ WebGL not available, falling back to 2D canvas only');\n                this.config.enableCRT = false;\n                this.config.enablePostProcessing = false;\n            }\n        } catch (error) {\n            this.logger.warn('⚠️ WebGL initialization failed', error);\n            this.gl = null;\n            this.config.enableCRT = false;\n            this.config.enablePostProcessing = false;\n        }\n    }\n\n    /**\n     * Create render buffers for double buffering\n     */\n    private createRenderBuffers(): void {\n        const width = this.canvas.width;\n        const height = this.canvas.height;\n        \n        this.backBuffer = this.ctx.createImageData(width, height);\n        this.frontBuffer = this.ctx.createImageData(width, height);\n        \n        // Fill with background color\n        this.clearBuffer(this.backBuffer, this.hexToColor(this.config.backgroundColor));\n        \n        this.logger.debug('Render buffers created', { width, height });\n    }\n\n    /**\n     * Begin frame rendering\n     */\n    beginFrame(): void {\n        // Clear render stats\n        this.renderStats.drawCalls = 0;\n        this.renderStats.triangles = 0;\n        this.renderStats.sprites = 0;\n        this.renderStats.particles = 0;\n        \n        // Clear canvas\n        this.ctx.fillStyle = this.config.backgroundColor;\n        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n        \n        // Clear back buffer\n        this.clearBuffer(this.backBuffer, this.hexToColor(this.config.backgroundColor));\n    }\n\n    /**\n     * End frame rendering and apply post-processing\n     */\n    endFrame(): void {\n        // Apply dithering if enabled\n        if (this.config.enableDithering) {\n            this.applyDithering(this.backBuffer);\n        }\n        \n        // Copy back buffer to canvas\n        this.ctx.putImageData(this.backBuffer, 0, 0);\n        \n        // Apply CRT effects if enabled\n        if (this.config.enableCRT && this.gl) {\n            this.applyCRTEffect();\n        }\n        \n        this.renderStats.drawCalls++;\n    }\n\n    /**\n     * Clear a buffer with a specific color\n     */\n    private clearBuffer(buffer: ImageData, color: Color): void {\n        const data = buffer.data;\n        for (let i = 0; i < data.length; i += 4) {\n            data[i] = color.r;     // Red\n            data[i + 1] = color.g; // Green\n            data[i + 2] = color.b; // Blue\n            data[i + 3] = color.a !== undefined ? color.a : 255; // Alpha\n        }\n    }\n\n    /**\n     * Set pixel in buffer with dithering\n     */\n    setPixel(x: number, y: number, color: Color): void {\n        x = Math.floor(x);\n        y = Math.floor(y);\n        \n        if (x < 0 || x >= this.canvas.width || y < 0 || y >= this.canvas.height) {\n            return;\n        }\n        \n        const index = (y * this.canvas.width + x) * 4;\n        const data = this.backBuffer.data;\n        \n        data[index] = color.r;\n        data[index + 1] = color.g;\n        data[index + 2] = color.b;\n        data[index + 3] = color.a !== undefined ? color.a : 255;\n    }\n\n    /**\n     * Draw a filled rectangle\n     */\n    fillRect(x: number, y: number, width: number, height: number, color: Color): void {\n        for (let py = y; py < y + height; py++) {\n            for (let px = x; px < x + width; px++) {\n                this.setPixel(px, py, color);\n            }\n        }\n        this.renderStats.drawCalls++;\n    }\n\n    /**\n     * Draw a line using Bresenham's algorithm\n     */\n    drawLine(x0: number, y0: number, x1: number, y1: number, color: Color): void {\n        x0 = Math.floor(x0);\n        y0 = Math.floor(y0);\n        x1 = Math.floor(x1);\n        y1 = Math.floor(y1);\n        \n        const dx = Math.abs(x1 - x0);\n        const dy = Math.abs(y1 - y0);\n        const sx = x0 < x1 ? 1 : -1;\n        const sy = y0 < y1 ? 1 : -1;\n        let err = dx - dy;\n        \n        let x = x0;\n        let y = y0;\n        \n        while (true) {\n            this.setPixel(x, y, color);\n            \n            if (x === x1 && y === y1) break;\n            \n            const e2 = 2 * err;\n            if (e2 > -dy) {\n                err -= dy;\n                x += sx;\n            }\n            if (e2 < dx) {\n                err += dx;\n                y += sy;\n            }\n        }\n        \n        this.renderStats.drawCalls++;\n    }\n\n    /**\n     * Draw a circle\n     */\n    drawCircle(centerX: number, centerY: number, radius: number, color: Color, filled: boolean = false): void {\n        centerX = Math.floor(centerX);\n        centerY = Math.floor(centerY);\n        radius = Math.floor(radius);\n        \n        if (filled) {\n            // Filled circle\n            for (let y = -radius; y <= radius; y++) {\n                for (let x = -radius; x <= radius; x++) {\n                    if (x * x + y * y <= radius * radius) {\n                        this.setPixel(centerX + x, centerY + y, color);\n                    }\n                }\n            }\n        } else {\n            // Circle outline using Bresenham's circle algorithm\n            let x = 0;\n            let y = radius;\n            let d = 3 - 2 * radius;\n            \n            while (y >= x) {\n                // Draw octants\n                this.setPixel(centerX + x, centerY + y, color);\n                this.setPixel(centerX - x, centerY + y, color);\n                this.setPixel(centerX + x, centerY - y, color);\n                this.setPixel(centerX - x, centerY - y, color);\n                this.setPixel(centerX + y, centerY + x, color);\n                this.setPixel(centerX - y, centerY + x, color);\n                this.setPixel(centerX + y, centerY - x, color);\n                this.setPixel(centerX - y, centerY - x, color);\n                \n                x++;\n                if (d > 0) {\n                    y--;\n                    d = d + 4 * (x - y) + 10;\n                } else {\n                    d = d + 4 * x + 6;\n                }\n            }\n        }\n        \n        this.renderStats.drawCalls++;\n    }\n\n    /**\n     * Render text with retro font styling\n     */\n    renderText(text: string, x: number, y: number, color: Color, size: number = 12): void {\n        // Save current context\n        this.ctx.save();\n        \n        // Set font and color\n        this.ctx.font = `${size}px \"Courier New\", monospace`;\n        this.ctx.fillStyle = this.colorToHex(color);\n        this.ctx.textBaseline = 'top';\n        \n        // Add retro glow effect\n        this.ctx.shadowColor = this.colorToHex(color);\n        this.ctx.shadowBlur = 2;\n        \n        // Render text\n        this.ctx.fillText(text, x, y);\n        \n        // Restore context\n        this.ctx.restore();\n        \n        this.renderStats.drawCalls++;\n    }\n\n    /**\n     * Render debug text array\n     */\n    renderDebugText(lines: string[], x: number, y: number): void {\n        const lineHeight = 14;\n        const backgroundColor = { r: 0, g: 0, b: 0, a: 128 };\n        const textColor = { r: 0, g: 255, b: 0 }; // Green terminal color\n        \n        // Draw background\n        const maxWidth = Math.max(...lines.map(line => line.length)) * 8;\n        this.fillRect(x - 2, y - 2, maxWidth + 4, lines.length * lineHeight + 4, backgroundColor);\n        \n        // Draw text lines\n        lines.forEach((line, index) => {\n            this.renderText(line, x, y + index * lineHeight, textColor, 12);\n        });\n    }\n\n    /**\n     * Generate procedural space ship sprite\n     */\n    generateShipSprite(type: 'player' | 'enemy' | 'ally', size: number = 32): Sprite {\n        const imageData = this.ctx.createImageData(size, size);\n        const data = imageData.data;\n        \n        // Clear to transparent\n        for (let i = 0; i < data.length; i += 4) {\n            data[i + 3] = 0; // Alpha = 0 (transparent)\n        }\n        \n        // Ship color based on type\n        let shipColor: Color;\n        switch (type) {\n            case 'player':\n                shipColor = { r: 0, g: 255, b: 0 }; // Green\n                break;\n            case 'enemy':\n                shipColor = { r: 255, g: 0, b: 0 }; // Red\n                break;\n            case 'ally':\n                shipColor = { r: 0, g: 128, b: 255 }; // Blue\n                break;\n        }\n        \n        // Simple ship design (triangle pointing up)\n        const centerX = size / 2;\n        const centerY = size / 2;\n        \n        // Draw ship body\n        for (let y = 0; y < size; y++) {\n            for (let x = 0; x < size; x++) {\n                const dx = x - centerX;\n                const dy = y - centerY;\n                \n                // Triangle shape\n                if (dy > -centerY * 0.8 && dy < centerY * 0.6) {\n                    const width = (centerY * 0.8 + dy) * 0.3;\n                    if (Math.abs(dx) < width) {\n                        const index = (y * size + x) * 4;\n                        data[index] = shipColor.r;\n                        data[index + 1] = shipColor.g;\n                        data[index + 2] = shipColor.b;\n                        data[index + 3] = 255;\n                    }\n                }\n            }\n        }\n        \n        this.renderStats.sprites++;\n        return {\n            data: imageData,\n            width: size,\n            height: size\n        };\n    }\n\n    /**\n     * Draw a sprite\n     */\n    drawSprite(sprite: Sprite, x: number, y: number): void {\n        this.ctx.putImageData(sprite.data, x, y);\n        this.renderStats.sprites++;\n    }\n\n    /**\n     * Apply dithering to reduce color banding\n     */\n    private applyDithering(buffer: ImageData): void {\n        if (!this.config.enableDithering) return;\n        \n        const data = buffer.data;\n        const width = buffer.width;\n        const height = buffer.height;\n        \n        // Floyd-Steinberg dithering\n        for (let y = 0; y < height - 1; y++) {\n            for (let x = 1; x < width - 1; x++) {\n                const index = (y * width + x) * 4;\n                \n                // Get current pixel\n                const oldR = data[index];\n                const oldG = data[index + 1];\n                const oldB = data[index + 2];\n                \n                // Find nearest palette color\n                const newColor = this.findNearestPaletteColor({ r: oldR, g: oldG, b: oldB });\n                \n                // Set new color\n                data[index] = newColor.r;\n                data[index + 1] = newColor.g;\n                data[index + 2] = newColor.b;\n                \n                // Calculate quantization error\n                const errorR = oldR - newColor.r;\n                const errorG = oldG - newColor.g;\n                const errorB = oldB - newColor.b;\n                \n                // Distribute error to neighboring pixels\n                this.distributeError(data, width, x + 1, y, errorR, errorG, errorB, 7/16);\n                this.distributeError(data, width, x - 1, y + 1, errorR, errorG, errorB, 3/16);\n                this.distributeError(data, width, x, y + 1, errorR, errorG, errorB, 5/16);\n                this.distributeError(data, width, x + 1, y + 1, errorR, errorG, errorB, 1/16);\n            }\n        }\n    }\n\n    /**\n     * Distribute dithering error to neighboring pixel\n     */\n    private distributeError(data: Uint8ClampedArray, width: number, x: number, y: number, \n                          errorR: number, errorG: number, errorB: number, factor: number): void {\n        const index = (y * width + x) * 4;\n        if (index >= 0 && index < data.length - 3) {\n            data[index] = Math.max(0, Math.min(255, data[index] + errorR * factor));\n            data[index + 1] = Math.max(0, Math.min(255, data[index + 1] + errorG * factor));\n            data[index + 2] = Math.max(0, Math.min(255, data[index + 2] + errorB * factor));\n        }\n    }\n\n    /**\n     * Find nearest color in palette\n     */\n    private findNearestPaletteColor(color: Color): Color {\n        let nearestColor = this.colorPalette[0];\n        let minDistance = Number.MAX_VALUE;\n        \n        for (const paletteColor of this.colorPalette) {\n            const distance = Math.sqrt(\n                Math.pow(color.r - paletteColor.r, 2) +\n                Math.pow(color.g - paletteColor.g, 2) +\n                Math.pow(color.b - paletteColor.b, 2)\n            );\n            \n            if (distance < minDistance) {\n                minDistance = distance;\n                nearestColor = paletteColor;\n            }\n        }\n        \n        return nearestColor;\n    }\n\n    /**\n     * Apply CRT effect (basic implementation)\n     */\n    private applyCRTEffect(): void {\n        // This would use WebGL shaders for proper CRT effects\n        // For now, just apply scanlines via CSS (already done in HTML)\n        this.logger.debug('CRT effect applied (CSS-based)');\n    }\n\n    /**\n     * Handle canvas resize\n     */\n    handleResize(): void {\n        // Recreate render buffers\n        this.createRenderBuffers();\n        this.logger.debug('Renderer resized');\n    }\n\n    /**\n     * Convert hex color to Color object\n     */\n    private hexToColor(hex: string): Color {\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n        return result ? {\n            r: parseInt(result[1], 16),\n            g: parseInt(result[2], 16),\n            b: parseInt(result[3], 16)\n        } : { r: 0, g: 0, b: 0 };\n    }\n\n    /**\n     * Convert Color object to hex string\n     */\n    private colorToHex(color: Color): string {\n        const toHex = (c: number) => {\n            const hex = Math.round(c).toString(16);\n            return hex.length === 1 ? '0' + hex : hex;\n        };\n        return `#${toHex(color.r)}${toHex(color.g)}${toHex(color.b)}`;\n    }\n\n    /**\n     * Get render statistics\n     */\n    getRenderStats() {\n        return { ...this.renderStats };\n    }\n\n    /**\n     * Draw a filled rectangle\n     */\n    drawRect(x: number, y: number, width: number, height: number, color: Color): void {\n        this.ctx.fillStyle = this.colorToHex(color);\n        this.ctx.fillRect(x, y, width, height);\n    }\n\n\n\n    /**\n     * Cleanup resources\n     */\n    cleanup(): void {\n        // Clear WebGL resources if available\n        if (this.gl) {\n            this.shaderPrograms.forEach(program => {\n                this.gl!.deleteProgram(program);\n            });\n            this.shaderPrograms.clear();\n        }\n        \n        this.logger.info('🧹 Renderer cleanup completed');\n    }\n}","/**\n * Input Management System\n * Handles keyboard, mouse, and touch input with platform-specific adaptations\n */\n\nimport { Platform } from '@utils/Platform';\nimport { Logger } from '@utils/Logger';\nimport { Vector2 } from '@core/Renderer';\n\nexport interface InputState {\n    // Keyboard\n    keys: Set<string>;\n    keysPressed: Set<string>;\n    keysReleased: Set<string>;\n    \n    // Mouse\n    mousePosition: Vector2;\n    mouseButtons: Set<number>;\n    mouseButtonsPressed: Set<number>;\n    mouseButtonsReleased: Set<number>;\n    mouseWheel: number;\n    \n    // Touch\n    touches: Touch[];\n    touchStarted: boolean;\n    touchEnded: boolean;\n    \n    // Virtual controls for mobile\n    virtualThrust: number;\n    virtualRotation: number;\n    virtualAction: boolean;\n}\n\nexport interface GamepadState {\n    connected: boolean;\n    axes: number[];\n    buttons: boolean[];\n}\n\nexport class InputManager {\n    private canvas: HTMLCanvasElement;\n    private platform: Platform;\n    private currentState: InputState;\n    private previousState: InputState;\n    \n    // Gamepad support\n    private gamepads: Map<number, GamepadState> = new Map();\n    \n    // Touch controls\n    private touchZones: Map<string, TouchZone> = new Map();\n    private activeTouches: Map<number, TouchInfo> = new Map();\n    \n    // Input configuration\n    private config = {\n        enableKeyboard: true,\n        enableMouse: true,\n        enableTouch: true,\n        enableGamepad: true,\n        touchSensitivity: 1.0,\n        keyRepeatDelay: 250,\n        keyRepeatRate: 50\n    };\n    \n    private logger: Logger;\n    private eventListeners: Array<() => void> = [];\n\n    constructor(canvas: HTMLCanvasElement, platform: Platform) {\n        this.canvas = canvas;\n        this.platform = platform;\n        this.logger = new Logger('InputManager');\n        \n        // Initialize input states\n        this.currentState = this.createEmptyInputState();\n        this.previousState = this.createEmptyInputState();\n        \n        // Configure input based on platform\n        this.configureForPlatform();\n        \n        // Setup event listeners\n        this.setupEventListeners();\n        \n        // Setup touch zones for mobile\n        if (this.config.enableTouch) {\n            this.setupTouchZones();\n        }\n        \n        this.logger.info('🎮 Input manager initialized', {\n            platform: platform,\n            config: this.config\n        });\n    }\n\n    /**\n     * Configure input settings based on platform\n     */\n    private configureForPlatform(): void {\n        switch (this.platform) {\n            case Platform.Desktop:\n            case Platform.Tauri:\n                this.config.enableKeyboard = true;\n                this.config.enableMouse = true;\n                this.config.enableTouch = false;\n                this.config.enableGamepad = true;\n                break;\n                \n            case Platform.Mobile:\n            case Platform.Cordova:\n                this.config.enableKeyboard = false;\n                this.config.enableMouse = false;\n                this.config.enableTouch = true;\n                this.config.enableGamepad = false;\n                this.config.touchSensitivity = 1.5;\n                break;\n                \n            case Platform.Web:\n                // Hybrid mode - detect capabilities\n                this.config.enableKeyboard = true;\n                this.config.enableMouse = true;\n                this.config.enableTouch = 'ontouchstart' in window;\n                this.config.enableGamepad = 'getGamepads' in navigator;\n                break;\n        }\n    }\n\n    /**\n     * Setup event listeners for input\n     */\n    private setupEventListeners(): void {\n        // Keyboard events\n        if (this.config.enableKeyboard) {\n            const keyDownHandler = (e: KeyboardEvent) => this.handleKeyDown(e);\n            const keyUpHandler = (e: KeyboardEvent) => this.handleKeyUp(e);\n            \n            document.addEventListener('keydown', keyDownHandler);\n            document.addEventListener('keyup', keyUpHandler);\n            \n            this.eventListeners.push(() => {\n                document.removeEventListener('keydown', keyDownHandler);\n                document.removeEventListener('keyup', keyUpHandler);\n            });\n        }\n        \n        // Mouse events\n        if (this.config.enableMouse) {\n            const mouseMoveHandler = (e: MouseEvent) => this.handleMouseMove(e);\n            const mouseDownHandler = (e: MouseEvent) => this.handleMouseDown(e);\n            const mouseUpHandler = (e: MouseEvent) => this.handleMouseUp(e);\n            const wheelHandler = (e: WheelEvent) => this.handleWheel(e);\n            \n            this.canvas.addEventListener('mousemove', mouseMoveHandler);\n            this.canvas.addEventListener('mousedown', mouseDownHandler);\n            this.canvas.addEventListener('mouseup', mouseUpHandler);\n            this.canvas.addEventListener('wheel', wheelHandler);\n            \n            this.eventListeners.push(() => {\n                this.canvas.removeEventListener('mousemove', mouseMoveHandler);\n                this.canvas.removeEventListener('mousedown', mouseDownHandler);\n                this.canvas.removeEventListener('mouseup', mouseUpHandler);\n                this.canvas.removeEventListener('wheel', wheelHandler);\n            });\n        }\n        \n        // Touch events\n        if (this.config.enableTouch) {\n            const touchStartHandler = (e: TouchEvent) => this.handleTouchStart(e);\n            const touchMoveHandler = (e: TouchEvent) => this.handleTouchMove(e);\n            const touchEndHandler = (e: TouchEvent) => this.handleTouchEnd(e);\n            \n            this.canvas.addEventListener('touchstart', touchStartHandler, { passive: false });\n            this.canvas.addEventListener('touchmove', touchMoveHandler, { passive: false });\n            this.canvas.addEventListener('touchend', touchEndHandler, { passive: false });\n            \n            this.eventListeners.push(() => {\n                this.canvas.removeEventListener('touchstart', touchStartHandler);\n                this.canvas.removeEventListener('touchmove', touchMoveHandler);\n                this.canvas.removeEventListener('touchend', touchEndHandler);\n            });\n        }\n        \n        // Gamepad events\n        if (this.config.enableGamepad) {\n            const gamepadConnectedHandler = (e: GamepadEvent) => this.handleGamepadConnected(e);\n            const gamepadDisconnectedHandler = (e: GamepadEvent) => this.handleGamepadDisconnected(e);\n            \n            window.addEventListener('gamepadconnected', gamepadConnectedHandler);\n            window.addEventListener('gamepaddisconnected', gamepadDisconnectedHandler);\n            \n            this.eventListeners.push(() => {\n                window.removeEventListener('gamepadconnected', gamepadConnectedHandler);\n                window.removeEventListener('gamepaddisconnected', gamepadDisconnectedHandler);\n            });\n        }\n        \n        // Focus events to handle window focus\n        const focusHandler = () => this.handleFocus();\n        const blurHandler = () => this.handleBlur();\n        \n        window.addEventListener('focus', focusHandler);\n        window.addEventListener('blur', blurHandler);\n        \n        this.eventListeners.push(() => {\n            window.removeEventListener('focus', focusHandler);\n            window.removeEventListener('blur', blurHandler);\n        });\n    }\n\n    /**\n     * Setup touch zones for mobile controls\n     */\n    private setupTouchZones(): void {\n        const canvasRect = this.canvas.getBoundingClientRect();\n        \n        // Left side - thrust control\n        this.touchZones.set('thrust', {\n            x: 0,\n            y: 0,\n            width: canvasRect.width / 2,\n            height: canvasRect.height,\n            type: 'joystick'\n        });\n        \n        // Right side - rotation control\n        this.touchZones.set('rotation', {\n            x: canvasRect.width / 2,\n            y: 0,\n            width: canvasRect.width / 2,\n            height: canvasRect.height,\n            type: 'joystick'\n        });\n        \n        this.logger.debug('Touch zones configured for mobile controls');\n    }\n\n    /**\n     * Update input state (called each frame)\n     */\n    update(deltaTime: number): void {\n        // Copy current state to previous\n        this.previousState = this.deepCopyInputState(this.currentState);\n        \n        // Clear frame-specific states\n        this.currentState.keysPressed.clear();\n        this.currentState.keysReleased.clear();\n        this.currentState.mouseButtonsPressed.clear();\n        this.currentState.mouseButtonsReleased.clear();\n        this.currentState.mouseWheel = 0;\n        this.currentState.touchStarted = false;\n        this.currentState.touchEnded = false;\n        \n        // Update gamepad state\n        if (this.config.enableGamepad) {\n            this.updateGamepadState();\n        }\n        \n        // Update virtual controls from touch input\n        if (this.config.enableTouch) {\n            this.updateVirtualControls();\n        }\n    }\n\n    /**\n     * Keyboard event handlers\n     */\n    private handleKeyDown(e: KeyboardEvent): void {\n        const key = e.code;\n        \n        if (!this.currentState.keys.has(key)) {\n            this.currentState.keysPressed.add(key);\n            this.logger.debug(`Key pressed: ${key}`);\n        }\n        \n        this.currentState.keys.add(key);\n        \n        // Prevent default for game keys\n        if (this.isGameKey(key)) {\n            e.preventDefault();\n        }\n    }\n\n    private handleKeyUp(e: KeyboardEvent): void {\n        const key = e.code;\n        \n        if (this.currentState.keys.has(key)) {\n            this.currentState.keysReleased.add(key);\n            this.logger.debug(`Key released: ${key}`);\n        }\n        \n        this.currentState.keys.delete(key);\n        \n        if (this.isGameKey(key)) {\n            e.preventDefault();\n        }\n    }\n\n    /**\n     * Mouse event handlers\n     */\n    private handleMouseMove(e: MouseEvent): void {\n        const rect = this.canvas.getBoundingClientRect();\n        this.currentState.mousePosition = {\n            x: e.clientX - rect.left,\n            y: e.clientY - rect.top\n        };\n    }\n\n    private handleMouseDown(e: MouseEvent): void {\n        const button = e.button;\n        \n        if (!this.currentState.mouseButtons.has(button)) {\n            this.currentState.mouseButtonsPressed.add(button);\n        }\n        \n        this.currentState.mouseButtons.add(button);\n        e.preventDefault();\n    }\n\n    private handleMouseUp(e: MouseEvent): void {\n        const button = e.button;\n        \n        if (this.currentState.mouseButtons.has(button)) {\n            this.currentState.mouseButtonsReleased.add(button);\n        }\n        \n        this.currentState.mouseButtons.delete(button);\n        e.preventDefault();\n    }\n\n    private handleWheel(e: WheelEvent): void {\n        this.currentState.mouseWheel = e.deltaY;\n        e.preventDefault();\n    }\n\n    /**\n     * Touch event handlers\n     */\n    private handleTouchStart(e: TouchEvent): void {\n        this.currentState.touchStarted = true;\n        this.currentState.touches = Array.from(e.touches);\n        \n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            this.activeTouches.set(touch.identifier, {\n                id: touch.identifier,\n                startPosition: { x: touch.clientX, y: touch.clientY },\n                currentPosition: { x: touch.clientX, y: touch.clientY },\n                zone: this.getTouchZone(touch.clientX, touch.clientY)\n            });\n        }\n        \n        e.preventDefault();\n    }\n\n    private handleTouchMove(e: TouchEvent): void {\n        this.currentState.touches = Array.from(e.touches);\n        \n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            const touchInfo = this.activeTouches.get(touch.identifier);\n            \n            if (touchInfo) {\n                touchInfo.currentPosition = { x: touch.clientX, y: touch.clientY };\n            }\n        }\n        \n        e.preventDefault();\n    }\n\n    private handleTouchEnd(e: TouchEvent): void {\n        this.currentState.touchEnded = true;\n        this.currentState.touches = Array.from(e.touches);\n        \n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            this.activeTouches.delete(touch.identifier);\n        }\n        \n        e.preventDefault();\n    }\n\n    /**\n     * Gamepad event handlers\n     */\n    private handleGamepadConnected(e: GamepadEvent): void {\n        this.logger.info(`Gamepad connected: ${e.gamepad.id}`);\n        this.gamepads.set(e.gamepad.index, {\n            connected: true,\n            axes: [],\n            buttons: []\n        });\n    }\n\n    private handleGamepadDisconnected(e: GamepadEvent): void {\n        this.logger.info(`Gamepad disconnected: ${e.gamepad.id}`);\n        this.gamepads.delete(e.gamepad.index);\n    }\n\n    /**\n     * Update gamepad state\n     */\n    private updateGamepadState(): void {\n        const gamepads = navigator.getGamepads();\n        \n        for (let i = 0; i < gamepads.length; i++) {\n            const gamepad = gamepads[i];\n            if (gamepad && this.gamepads.has(i)) {\n                const state = this.gamepads.get(i)!;\n                state.axes = Array.from(gamepad.axes);\n                state.buttons = gamepad.buttons.map(button => button.pressed);\n            }\n        }\n    }\n\n    /**\n     * Update virtual controls from touch input\n     */\n    private updateVirtualControls(): void {\n        this.currentState.virtualThrust = 0;\n        this.currentState.virtualRotation = 0;\n        this.currentState.virtualAction = false;\n        \n        for (const [touchId, touchInfo] of this.activeTouches) {\n            const deltaX = touchInfo.currentPosition.x - touchInfo.startPosition.x;\n            const deltaY = touchInfo.currentPosition.y - touchInfo.startPosition.y;\n            \n            if (touchInfo.zone === 'thrust') {\n                // Vertical movement controls thrust\n                this.currentState.virtualThrust = -deltaY / 100 * this.config.touchSensitivity;\n                this.currentState.virtualThrust = Math.max(-1, Math.min(1, this.currentState.virtualThrust));\n            } else if (touchInfo.zone === 'rotation') {\n                // Horizontal movement controls rotation\n                this.currentState.virtualRotation = deltaX / 100 * this.config.touchSensitivity;\n                this.currentState.virtualRotation = Math.max(-1, Math.min(1, this.currentState.virtualRotation));\n            }\n        }\n    }\n\n    /**\n     * Focus/blur handlers\n     */\n    private handleFocus(): void {\n        this.logger.debug('Window focused - input enabled');\n    }\n\n    private handleBlur(): void {\n        // Clear all input states when window loses focus\n        this.currentState.keys.clear();\n        this.currentState.mouseButtons.clear();\n        this.activeTouches.clear();\n        this.logger.debug('Window blurred - input cleared');\n    }\n\n    /**\n     * Helper methods\n     */\n    private createEmptyInputState(): InputState {\n        return {\n            keys: new Set(),\n            keysPressed: new Set(),\n            keysReleased: new Set(),\n            mousePosition: { x: 0, y: 0 },\n            mouseButtons: new Set(),\n            mouseButtonsPressed: new Set(),\n            mouseButtonsReleased: new Set(),\n            mouseWheel: 0,\n            touches: [],\n            touchStarted: false,\n            touchEnded: false,\n            virtualThrust: 0,\n            virtualRotation: 0,\n            virtualAction: false\n        };\n    }\n\n    private deepCopyInputState(state: InputState): InputState {\n        return {\n            keys: new Set(state.keys),\n            keysPressed: new Set(),\n            keysReleased: new Set(),\n            mousePosition: { ...state.mousePosition },\n            mouseButtons: new Set(state.mouseButtons),\n            mouseButtonsPressed: new Set(),\n            mouseButtonsReleased: new Set(),\n            mouseWheel: 0,\n            touches: [...state.touches],\n            touchStarted: false,\n            touchEnded: false,\n            virtualThrust: state.virtualThrust,\n            virtualRotation: state.virtualRotation,\n            virtualAction: state.virtualAction\n        };\n    }\n\n    private isGameKey(key: string): boolean {\n        const gameKeys = [\n            'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight',\n            'KeyW', 'KeyA', 'KeyS', 'KeyD',\n            'Space', 'Enter', 'Escape'\n        ];\n        return gameKeys.includes(key);\n    }\n\n    private getTouchZone(x: number, y: number): string | null {\n        for (const [zoneName, zone] of this.touchZones) {\n            if (x >= zone.x && x < zone.x + zone.width &&\n                y >= zone.y && y < zone.y + zone.height) {\n                return zoneName;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Public input query methods\n     */\n    isKeyDown(key: string): boolean {\n        return this.currentState.keys.has(key);\n    }\n\n    isKeyPressed(key: string): boolean {\n        return this.currentState.keysPressed.has(key);\n    }\n\n    isKeyReleased(key: string): boolean {\n        return this.currentState.keysReleased.has(key);\n    }\n\n    isMouseButtonDown(button: number): boolean {\n        return this.currentState.mouseButtons.has(button);\n    }\n\n    isMouseButtonPressed(button: number): boolean {\n        return this.currentState.mouseButtonsPressed.has(button);\n    }\n\n    getMousePosition(): Vector2 {\n        return { ...this.currentState.mousePosition };\n    }\n\n    getMouseWheel(): number {\n        return this.currentState.mouseWheel;\n    }\n\n    getTouchCount(): number {\n        return this.currentState.touches.length;\n    }\n\n    getVirtualThrust(): number {\n        return this.currentState.virtualThrust;\n    }\n\n    getVirtualRotation(): number {\n        return this.currentState.virtualRotation;\n    }\n\n    // Game-specific input methods\n    getThrustInput(): number {\n        if (this.config.enableTouch) {\n            return this.currentState.virtualThrust;\n        }\n        \n        let thrust = 0;\n        if (this.isKeyDown('ArrowUp') || this.isKeyDown('KeyW')) thrust += 1;\n        if (this.isKeyDown('ArrowDown') || this.isKeyDown('KeyS')) thrust -= 1;\n        \n        // Gamepad input\n        for (const gamepad of this.gamepads.values()) {\n            if (gamepad.connected && gamepad.axes.length > 1) {\n                thrust += -gamepad.axes[1]; // Invert Y axis\n            }\n        }\n        \n        return Math.max(-1, Math.min(1, thrust));\n    }\n\n    getRotationInput(): number {\n        if (this.config.enableTouch) {\n            return this.currentState.virtualRotation;\n        }\n        \n        let rotation = 0;\n        if (this.isKeyDown('ArrowLeft') || this.isKeyDown('KeyA')) rotation -= 1;\n        if (this.isKeyDown('ArrowRight') || this.isKeyDown('KeyD')) rotation += 1;\n        \n        // Gamepad input\n        for (const gamepad of this.gamepads.values()) {\n            if (gamepad.connected && gamepad.axes.length > 0) {\n                rotation += gamepad.axes[0]; // X axis\n            }\n        }\n        \n        return Math.max(-1, Math.min(1, rotation));\n    }\n\n    isActionPressed(): boolean {\n        return this.isKeyPressed('Space') || \n               this.isMouseButtonPressed(0) || \n               this.currentState.virtualAction;\n    }\n\n    isPausePressed(): boolean {\n        return this.isKeyPressed('Escape') || this.isKeyPressed('KeyP');\n    }\n\n    /**\n     * Cleanup\n     */\n    cleanup(): void {\n        // Remove all event listeners\n        this.eventListeners.forEach(cleanup => cleanup());\n        this.eventListeners = [];\n        \n        // Clear states\n        this.activeTouches.clear();\n        this.gamepads.clear();\n        \n        this.logger.info('🧹 Input manager cleanup completed');\n    }\n}\n\n// Helper interfaces\ninterface TouchZone {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    type: 'button' | 'joystick';\n}\n\ninterface TouchInfo {\n    id: number;\n    startPosition: Vector2;\n    currentPosition: Vector2;\n    zone: string | null;\n}","/**\n * Space Physics Engine\n * Handles realistic space movement, gravity, and orbital mechanics\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2 } from '@core/Renderer';\n\nexport interface PhysicsObject {\n    id: string;\n    position: Vector2;\n    velocity: Vector2;\n    acceleration: Vector2;\n    mass: number;\n    radius: number;\n    isStatic: boolean;\n    type: 'ship' | 'planet' | 'star' | 'asteroid' | 'projectile';\n    \n    // Physics properties\n    drag: number;\n    restitution: number; // Bounce factor\n    friction: number;\n    \n    // Game-specific properties\n    health?: number;\n    faction?: string;\n    \n    // Callbacks\n    onCollision?: (other: PhysicsObject) => void;\n    onDestroy?: () => void;\n}\n\nexport interface CollisionInfo {\n    objectA: PhysicsObject;\n    objectB: PhysicsObject;\n    penetration: number;\n    normal: Vector2;\n    point: Vector2;\n}\n\nexport interface GravityWell {\n    position: Vector2;\n    mass: number;\n    radius: number; // Effective radius for gravity\n}\n\nexport class SpacePhysics {\n    private objects: Map<string, PhysicsObject> = new Map();\n    private gravityWells: Map<string, GravityWell> = new Map();\n    \n    // Physics constants\n    private readonly GRAVITATIONAL_CONSTANT = 6.67e-11; // Scaled for game\n    private readonly SPACE_DRAG = 0.999; // Very low drag in space\n    private readonly MIN_VELOCITY = 0.01; // Below this, velocity is zeroed\n    private readonly MAX_VELOCITY = 1000; // Maximum velocity cap\n    \n    // Collision detection\n    private collisionPairs: CollisionInfo[] = [];\n    \n    private logger: Logger;\n\n    constructor() {\n        this.logger = new Logger('SpacePhysics');\n        this.logger.info('🌌 Space physics engine initialized');\n    }\n\n    /**\n     * Add a physics object to the simulation\n     */\n    addObject(object: PhysicsObject): void {\n        this.objects.set(object.id, object);\n        this.logger.debug(`Added physics object: ${object.id} (${object.type})`);\n    }\n\n    /**\n     * Remove a physics object from the simulation\n     */\n    removeObject(id: string): boolean {\n        const removed = this.objects.delete(id);\n        if (removed) {\n            this.logger.debug(`Removed physics object: ${id}`);\n        }\n        return removed;\n    }\n\n    /**\n     * Get a physics object by ID\n     */\n    getObject(id: string): PhysicsObject | undefined {\n        return this.objects.get(id);\n    }\n\n    /**\n     * Add a gravity well (like a planet or star)\n     */\n    addGravityWell(id: string, well: GravityWell): void {\n        this.gravityWells.set(id, well);\n        this.logger.debug(`Added gravity well: ${id}`);\n    }\n\n    /**\n     * Remove a gravity well\n     */\n    removeGravityWell(id: string): boolean {\n        return this.gravityWells.delete(id);\n    }\n\n    /**\n     * Update the physics simulation\n     */\n    update(deltaTime: number): void {\n        // Cap delta time to prevent simulation instability\n        deltaTime = Math.min(deltaTime, 1/30); // Max 30 FPS minimum\n        \n        // Clear previous collision data\n        this.collisionPairs = [];\n        \n        // Apply forces to all objects\n        for (const object of this.objects.values()) {\n            if (!object.isStatic) {\n                this.updateObject(object, deltaTime);\n            }\n        }\n        \n        // Detect and resolve collisions\n        this.detectCollisions();\n        this.resolveCollisions();\n    }\n\n    /**\n     * Update a single physics object\n     */\n    private updateObject(object: PhysicsObject, deltaTime: number): void {\n        // Reset acceleration each frame\n        object.acceleration = { x: 0, y: 0 };\n        \n        // Apply gravitational forces\n        this.applyGravity(object);\n        \n        // Apply space drag (very minimal)\n        this.applyDrag(object);\n        \n        // Integrate velocity (acceleration → velocity)\n        object.velocity.x += object.acceleration.x * deltaTime;\n        object.velocity.y += object.acceleration.y * deltaTime;\n        \n        // Cap velocity to prevent runaway speeds\n        const speed = this.getVectorMagnitude(object.velocity);\n        if (speed > this.MAX_VELOCITY) {\n            const scale = this.MAX_VELOCITY / speed;\n            object.velocity.x *= scale;\n            object.velocity.y *= scale;\n        }\n        \n        // Zero very small velocities (simulate friction/energy loss)\n        if (speed < this.MIN_VELOCITY) {\n            object.velocity = { x: 0, y: 0 };\n        }\n        \n        // Integrate position (velocity → position)\n        object.position.x += object.velocity.x * deltaTime;\n        object.position.y += object.velocity.y * deltaTime;\n    }\n\n    /**\n     * Apply gravitational forces from all gravity wells\n     */\n    private applyGravity(object: PhysicsObject): void {\n        for (const well of this.gravityWells.values()) {\n            const dx = well.position.x - object.position.x;\n            const dy = well.position.y - object.position.y;\n            const distanceSquared = dx * dx + dy * dy;\n            const distance = Math.sqrt(distanceSquared);\n            \n            // Skip if too close (prevent division by zero and extreme forces)\n            if (distance < well.radius * 0.1) continue;\n            \n            // Calculate gravitational force\n            // F = G * (m1 * m2) / r²\n            const force = (this.GRAVITATIONAL_CONSTANT * well.mass * object.mass) / distanceSquared;\n            \n            // Apply force in direction of gravity well\n            const forceX = (dx / distance) * force;\n            const forceY = (dy / distance) * force;\n            \n            // F = ma, so a = F/m\n            object.acceleration.x += forceX / object.mass;\n            object.acceleration.y += forceY / object.mass;\n        }\n    }\n\n    /**\n     * Apply drag forces (minimal in space)\n     */\n    private applyDrag(object: PhysicsObject): void {\n        // Apply object-specific drag\n        object.velocity.x *= (this.SPACE_DRAG * object.drag);\n        object.velocity.y *= (this.SPACE_DRAG * object.drag);\n    }\n\n    /**\n     * Detect collisions between all objects\n     */\n    private detectCollisions(): void {\n        const objectArray = Array.from(this.objects.values());\n        \n        for (let i = 0; i < objectArray.length; i++) {\n            for (let j = i + 1; j < objectArray.length; j++) {\n                const objA = objectArray[i];\n                const objB = objectArray[j];\n                \n                const collision = this.checkCollision(objA, objB);\n                if (collision) {\n                    this.collisionPairs.push(collision);\n                }\n            }\n        }\n    }\n\n    /**\n     * Check collision between two objects\n     */\n    private checkCollision(objA: PhysicsObject, objB: PhysicsObject): CollisionInfo | null {\n        const dx = objB.position.x - objA.position.x;\n        const dy = objB.position.y - objA.position.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        const minDistance = objA.radius + objB.radius;\n        \n        if (distance < minDistance) {\n            // Collision detected\n            const penetration = minDistance - distance;\n            const normal = distance > 0 ? \n                { x: dx / distance, y: dy / distance } : \n                { x: 1, y: 0 }; // Fallback if objects are exactly overlapping\n            \n            const point = {\n                x: objA.position.x + dx * (objA.radius / minDistance),\n                y: objA.position.y + dy * (objA.radius / minDistance)\n            };\n            \n            return {\n                objectA: objA,\n                objectB: objB,\n                penetration,\n                normal,\n                point\n            };\n        }\n        \n        return null;\n    }\n\n    /**\n     * Resolve all detected collisions\n     */\n    private resolveCollisions(): void {\n        for (const collision of this.collisionPairs) {\n            this.resolveCollision(collision);\n            \n            // Call collision callbacks\n            if (collision.objectA.onCollision) {\n                collision.objectA.onCollision(collision.objectB);\n            }\n            if (collision.objectB.onCollision) {\n                collision.objectB.onCollision(collision.objectA);\n            }\n        }\n    }\n\n    /**\n     * Resolve a single collision\n     */\n    private resolveCollision(collision: CollisionInfo): void {\n        const { objectA, objectB, penetration, normal } = collision;\n        \n        // Separate objects to prevent overlap\n        if (!objectA.isStatic && !objectB.isStatic) {\n            // Both objects can move\n            const separationA = penetration * 0.5;\n            const separationB = penetration * 0.5;\n            \n            objectA.position.x -= normal.x * separationA;\n            objectA.position.y -= normal.y * separationA;\n            objectB.position.x += normal.x * separationB;\n            objectB.position.y += normal.y * separationB;\n        } else if (!objectA.isStatic) {\n            // Only object A can move\n            objectA.position.x -= normal.x * penetration;\n            objectA.position.y -= normal.y * penetration;\n        } else if (!objectB.isStatic) {\n            // Only object B can move\n            objectB.position.x += normal.x * penetration;\n            objectB.position.y += normal.y * penetration;\n        }\n        \n        // Calculate relative velocity\n        const relativeVelocity = {\n            x: objectB.velocity.x - objectA.velocity.x,\n            y: objectB.velocity.y - objectA.velocity.y\n        };\n        \n        // Calculate collision impulse\n        const velocityAlongNormal = relativeVelocity.x * normal.x + relativeVelocity.y * normal.y;\n        \n        // Objects are separating, no need to resolve\n        if (velocityAlongNormal > 0) return;\n        \n        // Calculate restitution (bounciness)\n        const restitution = Math.min(objectA.restitution, objectB.restitution);\n        \n        // Calculate impulse scalar\n        let impulse = -(1 + restitution) * velocityAlongNormal;\n        \n        // Calculate mass ratio\n        if (!objectA.isStatic && !objectB.isStatic) {\n            impulse /= (1 / objectA.mass + 1 / objectB.mass);\n        }\n        \n        // Apply impulse\n        const impulseVector = { x: impulse * normal.x, y: impulse * normal.y };\n        \n        if (!objectA.isStatic) {\n            objectA.velocity.x -= impulseVector.x / objectA.mass;\n            objectA.velocity.y -= impulseVector.y / objectA.mass;\n        }\n        \n        if (!objectB.isStatic) {\n            objectB.velocity.x += impulseVector.x / objectB.mass;\n            objectB.velocity.y += impulseVector.y / objectB.mass;\n        }\n    }\n\n    /**\n     * Apply thrust to an object (for ships)\n     */\n    applyThrust(objectId: string, thrustVector: Vector2, thrustPower: number): void {\n        const object = this.objects.get(objectId);\n        if (!object || object.isStatic) return;\n        \n        // Normalize thrust vector\n        const magnitude = this.getVectorMagnitude(thrustVector);\n        if (magnitude === 0) return;\n        \n        const normalizedThrust = {\n            x: thrustVector.x / magnitude,\n            y: thrustVector.y / magnitude\n        };\n        \n        // Apply thrust as acceleration\n        object.acceleration.x += normalizedThrust.x * thrustPower / object.mass;\n        object.acceleration.y += normalizedThrust.y * thrustPower / object.mass;\n    }\n\n    /**\n     * Calculate orbital velocity for circular orbit around a gravity well\n     */\n    calculateOrbitalVelocity(distance: number, centralMass: number): number {\n        // v = sqrt(GM/r)\n        return Math.sqrt(this.GRAVITATIONAL_CONSTANT * centralMass / distance);\n    }\n\n    /**\n     * Calculate escape velocity from a gravity well\n     */\n    calculateEscapeVelocity(distance: number, centralMass: number): number {\n        // v = sqrt(2GM/r)\n        return Math.sqrt(2 * this.GRAVITATIONAL_CONSTANT * centralMass / distance);\n    }\n\n    /**\n     * Get all objects within a radius\n     */\n    getObjectsInRadius(center: Vector2, radius: number): PhysicsObject[] {\n        const result: PhysicsObject[] = [];\n        \n        for (const object of this.objects.values()) {\n            const distance = this.getDistance(center, object.position);\n            if (distance <= radius) {\n                result.push(object);\n            }\n        }\n        \n        return result;\n    }\n\n    /**\n     * Raycast to find the first object hit\n     */\n    raycast(start: Vector2, direction: Vector2, maxDistance: number): PhysicsObject | null {\n        const normalizedDirection = this.normalizeVector(direction);\n        const step = 1; // Step size for ray marching\n        \n        for (let distance = 0; distance < maxDistance; distance += step) {\n            const point = {\n                x: start.x + normalizedDirection.x * distance,\n                y: start.y + normalizedDirection.y * distance\n            };\n            \n            for (const object of this.objects.values()) {\n                const objectDistance = this.getDistance(point, object.position);\n                if (objectDistance <= object.radius) {\n                    return object;\n                }\n            }\n        }\n        \n        return null;\n    }\n\n    /**\n     * Utility functions\n     */\n    private getVectorMagnitude(vector: Vector2): number {\n        return Math.sqrt(vector.x * vector.x + vector.y * vector.y);\n    }\n\n    private normalizeVector(vector: Vector2): Vector2 {\n        const magnitude = this.getVectorMagnitude(vector);\n        if (magnitude === 0) return { x: 0, y: 0 };\n        return { x: vector.x / magnitude, y: vector.y / magnitude };\n    }\n\n    private getDistance(a: Vector2, b: Vector2): number {\n        const dx = b.x - a.x;\n        const dy = b.y - a.y;\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    /**\n     * Get simulation statistics\n     */\n    getStats() {\n        return {\n            objectCount: this.objects.size,\n            gravityWellCount: this.gravityWells.size,\n            collisionCount: this.collisionPairs.length,\n            activeObjects: Array.from(this.objects.values()).filter(obj => !obj.isStatic).length\n        };\n    }\n\n    /**\n     * Get object count for performance monitoring\n     */\n    getObjectCount(): number {\n        return this.objects.size;\n    }\n\n    /**\n     * Get all objects (for debugging/rendering)\n     */\n    getAllObjects(): PhysicsObject[] {\n        return Array.from(this.objects.values());\n    }\n\n    /**\n     * Clear all objects and gravity wells\n     */\n    clear(): void {\n        this.objects.clear();\n        this.gravityWells.clear();\n        this.collisionPairs = [];\n        this.logger.debug('Physics simulation cleared');\n    }\n\n    /**\n     * Create a basic ship physics object\n     */\n    createShip(id: string, position: Vector2, mass: number = 1000): PhysicsObject {\n        return {\n            id,\n            position: { ...position },\n            velocity: { x: 0, y: 0 },\n            acceleration: { x: 0, y: 0 },\n            mass,\n            radius: 16, // Ship radius in pixels\n            isStatic: false,\n            type: 'ship',\n            drag: 0.999, // Very little drag in space\n            restitution: 0.3, // Some bounce for collisions\n            friction: 0.1,\n            health: 100\n        };\n    }\n\n    /**\n     * Create a basic planet physics object\n     */\n    createPlanet(id: string, position: Vector2, mass: number, radius: number): PhysicsObject {\n        return {\n            id,\n            position: { ...position },\n            velocity: { x: 0, y: 0 },\n            acceleration: { x: 0, y: 0 },\n            mass,\n            radius,\n            isStatic: true, // Planets don't move\n            type: 'planet',\n            drag: 1.0,\n            restitution: 0.1, // Planets are not bouncy\n            friction: 0.9\n        };\n    }\n\n    /**\n     * Create a projectile physics object\n     */\n    createProjectile(id: string, position: Vector2, velocity: Vector2, mass: number = 1): PhysicsObject {\n        return {\n            id,\n            position: { ...position },\n            velocity: { ...velocity },\n            acceleration: { x: 0, y: 0 },\n            mass,\n            radius: 2, // Small projectile\n            isStatic: false,\n            type: 'projectile',\n            drag: 1.0, // No drag for projectiles\n            restitution: 0.8, // Bouncy projectiles\n            friction: 0.0\n        };\n    }\n}","/**\n * Web Audio API-based Audio Engine\n * Handles procedural sound synthesis and 16-bit style audio effects\n */\n\nimport { Platform } from '@utils/Platform';\nimport { Logger } from '@utils/Logger';\nimport { Vector2 } from '@core/Renderer';\n\nexport interface AudioConfig {\n    masterVolume: number;\n    musicVolume: number;\n    sfxVolume: number;\n    enableSpatialAudio: boolean;\n    maxChannels: number;\n    sampleRate: number;\n}\n\nexport interface SoundEffect {\n    id: string;\n    buffer: AudioBuffer;\n    loop: boolean;\n    volume: number;\n    pitch: number;\n    type: 'engine' | 'weapon' | 'ambient' | 'ui' | 'explosion';\n}\n\nexport interface AudioSource {\n    id: string;\n    node: AudioBufferSourceNode | OscillatorNode;\n    gainNode: GainNode;\n    pannerNode?: PannerNode;\n    position?: Vector2;\n    isPlaying: boolean;\n    loop: boolean;\n    startTime: number;\n}\n\nexport class AudioEngine {\n    private context: AudioContext | null = null;\n    private platform: Platform;\n    private config: AudioConfig;\n    \n    // Audio nodes\n    private masterGain: GainNode | null = null;\n    private musicGain: GainNode | null = null;\n    private sfxGain: GainNode | null = null;\n    \n    // Sound management\n    private soundEffects: Map<string, SoundEffect> = new Map();\n    private activeSources: Map<string, AudioSource> = new Map();\n    \n    // Music system\n    private musicTrack: AudioSource | null = null;\n    private ambientTrack: AudioSource | null = null;\n    \n    // 16-bit synthesis\n    private synthNodes: Map<string, OscillatorNode> = new Map();\n    \n    private logger: Logger;\n    private isInitialized = false;\n\n    constructor(platform: Platform) {\n        this.platform = platform;\n        this.logger = new Logger('AudioEngine');\n        \n        // Configure audio based on platform\n        this.config = {\n            masterVolume: 1.0,\n            musicVolume: 0.7,\n            sfxVolume: 0.8,\n            enableSpatialAudio: platform === Platform.Desktop,\n            maxChannels: platform === Platform.Mobile ? 8 : 16,\n            sampleRate: 44100\n        };\n        \n        this.logger.info('🔊 Audio engine created', {\n            platform: platform,\n            config: this.config\n        });\n    }\n\n    /**\n     * Initialize the audio engine\n     */\n    async initialize(): Promise<void> {\n        this.logger.info('🔧 Initializing audio engine...');\n        \n        try {\n            // Create audio context\n            this.context = new (window.AudioContext || (window as any).webkitAudioContext)({\n                sampleRate: this.config.sampleRate\n            });\n            \n            // Handle context state\n            if (this.context.state === 'suspended') {\n                this.logger.info('Audio context suspended, will resume on user interaction');\n                this.setupUserInteractionHandler();\n            }\n            \n            // Create master gain nodes\n            this.masterGain = this.context.createGain();\n            this.musicGain = this.context.createGain();\n            this.sfxGain = this.context.createGain();\n            \n            // Connect gain nodes\n            this.musicGain.connect(this.masterGain);\n            this.sfxGain.connect(this.masterGain);\n            this.masterGain.connect(this.context.destination);\n            \n            // Set initial volumes\n            this.setMasterVolume(this.config.masterVolume);\n            this.setMusicVolume(this.config.musicVolume);\n            this.setSfxVolume(this.config.sfxVolume);\n            \n            // Generate basic sound effects\n            await this.generateBasicSounds();\n            \n            this.isInitialized = true;\n            this.logger.info('✅ Audio engine initialized successfully');\n            \n        } catch (error) {\n            this.logger.error('❌ Audio engine initialization failed', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Setup user interaction handler for audio context\n     */\n    private setupUserInteractionHandler(): void {\n        const resumeAudio = async () => {\n            if (this.context && this.context.state === 'suspended') {\n                await this.context.resume();\n                this.logger.info('Audio context resumed');\n                \n                // Remove event listeners\n                document.removeEventListener('click', resumeAudio);\n                document.removeEventListener('keydown', resumeAudio);\n                document.removeEventListener('touchstart', resumeAudio);\n            }\n        };\n        \n        document.addEventListener('click', resumeAudio, { once: true });\n        document.addEventListener('keydown', resumeAudio, { once: true });\n        document.addEventListener('touchstart', resumeAudio, { once: true });\n    }\n\n    /**\n     * Generate basic 16-bit style sound effects\n     */\n    private async generateBasicSounds(): Promise<void> {\n        if (!this.context) return;\n        \n        // Engine thrust sound\n        const engineBuffer = this.generateEngineSound(1.0);\n        this.soundEffects.set('engine_thrust', {\n            id: 'engine_thrust',\n            buffer: engineBuffer,\n            loop: true,\n            volume: 0.6,\n            pitch: 1.0,\n            type: 'engine'\n        });\n        \n        // Laser weapon sound\n        const laserBuffer = this.generateLaserSound();\n        this.soundEffects.set('weapon_laser', {\n            id: 'weapon_laser',\n            buffer: laserBuffer,\n            loop: false,\n            volume: 0.8,\n            pitch: 1.0,\n            type: 'weapon'\n        });\n        \n        // Explosion sound\n        const explosionBuffer = this.generateExplosionSound();\n        this.soundEffects.set('explosion', {\n            id: 'explosion',\n            buffer: explosionBuffer,\n            loop: false,\n            volume: 1.0,\n            pitch: 1.0,\n            type: 'explosion'\n        });\n        \n        // UI beep sound\n        const beepBuffer = this.generateBeepSound(800, 0.1);\n        this.soundEffects.set('ui_beep', {\n            id: 'ui_beep',\n            buffer: beepBuffer,\n            loop: false,\n            volume: 0.5,\n            pitch: 1.0,\n            type: 'ui'\n        });\n        \n        this.logger.debug('Generated basic sound effects');\n    }\n\n    /**\n     * Generate procedural engine sound\n     */\n    private generateEngineSound(duration: number): AudioBuffer {\n        if (!this.context) throw new Error('Audio context not initialized');\n        \n        const sampleRate = this.context.sampleRate;\n        const samples = Math.floor(sampleRate * duration);\n        const buffer = this.context.createBuffer(1, samples, sampleRate);\n        const data = buffer.getChannelData(0);\n        \n        for (let i = 0; i < samples; i++) {\n            const t = i / sampleRate;\n            \n            // Multiple oscillators for rich engine sound\n            const baseFreq = 60 + Math.sin(t * 5) * 10; // Low rumble with variation\n            const harmonic1 = Math.sin(2 * Math.PI * baseFreq * t) * 0.5;\n            const harmonic2 = Math.sin(2 * Math.PI * baseFreq * 2 * t) * 0.3;\n            const harmonic3 = Math.sin(2 * Math.PI * baseFreq * 3 * t) * 0.2;\n            \n            // Add noise for texture\n            const noise = (Math.random() - 0.5) * 0.1;\n            \n            data[i] = (harmonic1 + harmonic2 + harmonic3 + noise) * 0.3;\n        }\n        \n        return buffer;\n    }\n\n    /**\n     * Generate procedural laser sound\n     */\n    private generateLaserSound(): AudioBuffer {\n        if (!this.context) throw new Error('Audio context not initialized');\n        \n        const duration = 0.2;\n        const sampleRate = this.context.sampleRate;\n        const samples = Math.floor(sampleRate * duration);\n        const buffer = this.context.createBuffer(1, samples, sampleRate);\n        const data = buffer.getChannelData(0);\n        \n        for (let i = 0; i < samples; i++) {\n            const t = i / sampleRate;\n            const progress = t / duration;\n            \n            // Frequency sweep from high to low\n            const freq = 1200 - progress * 800;\n            const amplitude = Math.exp(-progress * 8); // Exponential decay\n            \n            data[i] = Math.sin(2 * Math.PI * freq * t) * amplitude * 0.5;\n        }\n        \n        return buffer;\n    }\n\n    /**\n     * Generate procedural explosion sound\n     */\n    private generateExplosionSound(): AudioBuffer {\n        if (!this.context) throw new Error('Audio context not initialized');\n        \n        const duration = 1.0;\n        const sampleRate = this.context.sampleRate;\n        const samples = Math.floor(sampleRate * duration);\n        const buffer = this.context.createBuffer(1, samples, sampleRate);\n        const data = buffer.getChannelData(0);\n        \n        for (let i = 0; i < samples; i++) {\n            const t = i / sampleRate;\n            const progress = t / duration;\n            \n            // Start with sharp attack, then decay\n            const amplitude = progress < 0.1 ? \n                progress * 10 : // Quick attack\n                Math.exp(-(progress - 0.1) * 5); // Exponential decay\n            \n            // Mix of noise and low frequency rumble\n            const noise = (Math.random() - 0.5) * 2;\n            const rumble = Math.sin(2 * Math.PI * 40 * t) * 0.5;\n            \n            data[i] = (noise * 0.7 + rumble * 0.3) * amplitude * 0.6;\n        }\n        \n        return buffer;\n    }\n\n    /**\n     * Generate simple beep sound\n     */\n    private generateBeepSound(frequency: number, duration: number): AudioBuffer {\n        if (!this.context) throw new Error('Audio context not initialized');\n        \n        const sampleRate = this.context.sampleRate;\n        const samples = Math.floor(sampleRate * duration);\n        const buffer = this.context.createBuffer(1, samples, sampleRate);\n        const data = buffer.getChannelData(0);\n        \n        for (let i = 0; i < samples; i++) {\n            const t = i / sampleRate;\n            const amplitude = Math.exp(-t * 10); // Quick decay\n            \n            data[i] = Math.sin(2 * Math.PI * frequency * t) * amplitude * 0.4;\n        }\n        \n        return buffer;\n    }\n\n    /**\n     * Play a sound effect\n     */\n    playSfx(soundId: string, position?: Vector2, pitch: number = 1.0, volume: number = 1.0): string | null {\n        if (!this.isInitialized || !this.context) {\n            this.logger.warn('Audio engine not initialized, cannot play sound');\n            return null;\n        }\n        \n        const soundEffect = this.soundEffects.get(soundId);\n        if (!soundEffect) {\n            this.logger.warn(`Sound effect not found: ${soundId}`);\n            return null;\n        }\n        \n        try {\n            // Create audio source\n            const source = this.context.createBufferSource();\n            const gainNode = this.context.createGain();\n            const sourceId = `${soundId}_${Date.now()}_${Math.random()}`;\n            \n            // Setup source\n            source.buffer = soundEffect.buffer;\n            source.loop = soundEffect.loop;\n            source.playbackRate.value = pitch;\n            \n            // Setup gain\n            gainNode.gain.value = soundEffect.volume * volume;\n            \n            // Connect nodes\n            source.connect(gainNode);\n            \n            // Add spatial audio if enabled and position provided\n            let pannerNode: PannerNode | undefined;\n            if (this.config.enableSpatialAudio && position) {\n                pannerNode = this.context.createPanner();\n                pannerNode.panningModel = 'HRTF';\n                pannerNode.distanceModel = 'inverse';\n                pannerNode.refDistance = 100;\n                pannerNode.maxDistance = 1000;\n                pannerNode.rolloffFactor = 1;\n                \n                // Set position\n                pannerNode.positionX.value = position.x;\n                pannerNode.positionY.value = position.y;\n                pannerNode.positionZ.value = 0;\n                \n                gainNode.connect(pannerNode);\n                pannerNode.connect(this.sfxGain!);\n            } else {\n                gainNode.connect(this.sfxGain!);\n            }\n            \n            // Track the audio source\n            const audioSource: AudioSource = {\n                id: sourceId,\n                node: source,\n                gainNode,\n                pannerNode,\n                position,\n                isPlaying: true,\n                loop: soundEffect.loop,\n                startTime: this.context.currentTime\n            };\n            \n            this.activeSources.set(sourceId, audioSource);\n            \n            // Handle sound end\n            source.onended = () => {\n                this.activeSources.delete(sourceId);\n            };\n            \n            // Start playback\n            source.start();\n            \n            this.logger.debug(`Playing sound: ${soundId} (${sourceId})`);\n            return sourceId;\n            \n        } catch (error) {\n            this.logger.error(`Failed to play sound: ${soundId}`, error);\n            return null;\n        }\n    }\n\n    /**\n     * Stop a playing sound\n     */\n    stopSound(sourceId: string): void {\n        const audioSource = this.activeSources.get(sourceId);\n        if (audioSource && audioSource.isPlaying) {\n            try {\n                audioSource.node.stop();\n                audioSource.isPlaying = false;\n                this.activeSources.delete(sourceId);\n                this.logger.debug(`Stopped sound: ${sourceId}`);\n            } catch (error) {\n                this.logger.error(`Failed to stop sound: ${sourceId}`, error);\n            }\n        }\n    }\n\n    /**\n     * Update spatial audio positions\n     */\n    updateSpatialAudio(sourceId: string, position: Vector2): void {\n        const audioSource = this.activeSources.get(sourceId);\n        if (audioSource && audioSource.pannerNode) {\n            audioSource.pannerNode.positionX.value = position.x;\n            audioSource.pannerNode.positionY.value = position.y;\n            audioSource.position = position;\n        }\n    }\n\n    /**\n     * Set listener position for spatial audio\n     */\n    setListenerPosition(position: Vector2, orientation: number = 0): void {\n        if (!this.context || !this.config.enableSpatialAudio) return;\n        \n        const listener = this.context.listener;\n        if (listener.positionX) {\n            listener.positionX.value = position.x;\n            listener.positionY.value = position.y;\n            listener.positionZ.value = 0;\n            \n            // Set orientation\n            listener.forwardX.value = Math.cos(orientation);\n            listener.forwardY.value = Math.sin(orientation);\n            listener.forwardZ.value = 0;\n            \n            listener.upX.value = 0;\n            listener.upY.value = 0;\n            listener.upZ.value = 1;\n        }\n    }\n\n    /**\n     * Volume controls\n     */\n    setMasterVolume(volume: number): void {\n        this.config.masterVolume = Math.max(0, Math.min(1, volume));\n        if (this.masterGain) {\n            this.masterGain.gain.value = this.config.masterVolume;\n        }\n    }\n\n    setMusicVolume(volume: number): void {\n        this.config.musicVolume = Math.max(0, Math.min(1, volume));\n        if (this.musicGain) {\n            this.musicGain.gain.value = this.config.musicVolume;\n        }\n    }\n\n    setSfxVolume(volume: number): void {\n        this.config.sfxVolume = Math.max(0, Math.min(1, volume));\n        if (this.sfxGain) {\n            this.sfxGain.gain.value = this.config.sfxVolume;\n        }\n    }\n\n    /**\n     * Game-specific audio methods\n     */\n    playEngineSound(): string | null {\n        return this.playSfx('engine_thrust', undefined, 1.0, 0.6);\n    }\n\n    playLaserSound(position?: Vector2): string | null {\n        return this.playSfx('weapon_laser', position, 1.0 + (Math.random() - 0.5) * 0.2);\n    }\n\n    playExplosion(position?: Vector2): string | null {\n        return this.playSfx('explosion', position, 1.0, 0.8);\n    }\n\n    playUIBeep(): string | null {\n        return this.playSfx('ui_beep');\n    }\n\n    /**\n     * Update audio engine (called each frame)\n     */\n    update(deltaTime: number): void {\n        // Clean up finished sounds\n        for (const [id, source] of this.activeSources) {\n            if (!source.isPlaying && !source.loop) {\n                this.activeSources.delete(id);\n            }\n        }\n    }\n\n    /**\n     * Pause all audio\n     */\n    pauseAll(): void {\n        if (this.context && this.context.state === 'running') {\n            this.context.suspend();\n            this.logger.debug('Audio paused');\n        }\n    }\n\n    /**\n     * Resume all audio\n     */\n    resumeAll(): void {\n        if (this.context && this.context.state === 'suspended') {\n            this.context.resume();\n            this.logger.debug('Audio resumed');\n        }\n    }\n\n    /**\n     * Stop all audio\n     */\n    stopAll(): void {\n        for (const [id, source] of this.activeSources) {\n            if (source.isPlaying) {\n                try {\n                    source.node.stop();\n                } catch (error) {\n                    // Ignore errors when stopping\n                }\n            }\n        }\n        this.activeSources.clear();\n        this.logger.debug('All audio stopped');\n    }\n\n    /**\n     * Get audio statistics\n     */\n    getStats() {\n        return {\n            isInitialized: this.isInitialized,\n            contextState: this.context?.state || 'none',\n            activeSources: this.activeSources.size,\n            soundEffects: this.soundEffects.size,\n            config: { ...this.config }\n        };\n    }\n\n    /**\n     * Cleanup audio resources\n     */\n    cleanup(): void {\n        this.stopAll();\n        \n        if (this.context) {\n            this.context.close();\n        }\n        \n        this.soundEffects.clear();\n        this.synthNodes.clear();\n        \n        this.logger.info('🧹 Audio engine cleanup completed');\n    }\n}","/**\n * Procedural Audio System\n * Advanced Web Audio API synthesis for retro 16-bit space game sounds\n */\n\nimport { Logger } from '@utils/Logger';\n\nexport enum SoundType {\n    Engine = 'engine',\n    Laser = 'laser',\n    Explosion = 'explosion',\n    Beep = 'beep',\n    Warning = 'warning',\n    Warp = 'warp',\n    Shield = 'shield',\n    Impact = 'impact',\n    Communication = 'communication',\n    Ambient = 'ambient',\n    UI = 'ui',\n    Thrust = 'thrust'\n}\n\nexport enum WaveformType {\n    Sine = 'sine',\n    Square = 'square',\n    Sawtooth = 'sawtooth',\n    Triangle = 'triangle',\n    Noise = 'white'\n}\n\nexport interface SoundConfig {\n    type: SoundType;\n    frequency: number;\n    duration: number;\n    volume: number;\n    \n    // Waveform settings\n    waveform: WaveformType;\n    harmonics?: number[];\n    \n    // Envelope (ADSR)\n    attack: number;\n    decay: number;\n    sustain: number;\n    release: number;\n    \n    // Modulation\n    frequencyModulation?: {\n        rate: number;\n        depth: number;\n        waveform: WaveformType;\n    };\n    \n    // Filter\n    filter?: {\n        type: 'lowpass' | 'highpass' | 'bandpass';\n        frequency: number;\n        resonance: number;\n    };\n    \n    // Effects\n    distortion?: number;\n    reverb?: {\n        roomSize: number;\n        dampening: number;\n        wetness: number;\n    };\n    \n    // Spatial audio\n    position?: { x: number, y: number, z: number };\n    maxDistance?: number;\n}\n\nexport interface AmbientTrackConfig {\n    name: string;\n    layers: AmbientLayer[];\n    fadeInTime: number;\n    fadeOutTime: number;\n    crossfadeTime: number;\n}\n\nexport interface AmbientLayer {\n    id: string;\n    waveform: WaveformType;\n    baseFrequency: number;\n    volume: number;\n    pan: number; // -1 to 1\n    \n    // Modulation\n    frequencyVariation: number;\n    volumeVariation: number;\n    \n    // Movement\n    frequency: {\n        min: number;\n        max: number;\n        speed: number; // Hz per second\n    };\n    \n    // Filter sweep\n    filter?: {\n        type: 'lowpass' | 'highpass' | 'bandpass';\n        minFreq: number;\n        maxFreq: number;\n        speed: number;\n        resonance: number;\n    };\n}\n\nexport interface AudioEvents {\n    onSoundPlayed?: (type: SoundType, config: SoundConfig) => void;\n    onTrackChanged?: (trackName: string) => void;\n    onAudioError?: (error: Error) => void;\n}\n\nexport class ProceduralAudio {\n    private audioContext: AudioContext | null = null;\n    private masterGain: GainNode | null = null;\n    private soundEffectsGain: GainNode | null = null;\n    private musicGain: GainNode | null = null;\n    \n    // Ambient music system\n    private currentTrack: string | null = null;\n    private ambientLayers: Map<string, {\n        oscillator: AudioScheduledSourceNode;\n        gain: GainNode;\n        filter?: BiquadFilterNode;\n        panner: StereoPannerNode;\n    }> = new Map();\n    \n    // Sound effect pools\n    private activeSounds: Set<AudioNode> = new Set();\n    \n    // Noise buffer for effects\n    private noiseBuffer: AudioBuffer | null = null;\n    \n    // Reverb\n    private convolver: ConvolverNode | null = null;\n    private reverbBuffer: AudioBuffer | null = null;\n    \n    // Master settings\n    private masterVolume: number = 0.7;\n    private musicVolume: number = 0.5;\n    private sfxVolume: number = 0.8;\n    \n    private events: AudioEvents;\n    private logger: Logger;\n\n    constructor(events: AudioEvents = {}) {\n        this.logger = new Logger('ProceduralAudio');\n        this.events = events;\n    }\n\n    /**\n     * Initialize audio system\n     */\n    async initialize(): Promise<void> {\n        try {\n            // Create audio context\n            this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n            \n            if (this.audioContext.state === 'suspended') {\n                await this.audioContext.resume();\n            }\n            \n            // Create master gain nodes\n            this.masterGain = this.audioContext.createGain();\n            this.soundEffectsGain = this.audioContext.createGain();\n            this.musicGain = this.audioContext.createGain();\n            \n            // Connect audio graph\n            this.soundEffectsGain.connect(this.masterGain);\n            this.musicGain.connect(this.masterGain);\n            this.masterGain.connect(this.audioContext.destination);\n            \n            // Set initial volumes\n            this.masterGain.gain.value = this.masterVolume;\n            this.soundEffectsGain.gain.value = this.sfxVolume;\n            this.musicGain.gain.value = this.musicVolume;\n            \n            // Create noise buffer\n            await this.createNoiseBuffer();\n            \n            // Create reverb\n            await this.createReverbBuffer();\n            \n            this.logger.info('🔊 Procedural audio system initialized');\n            \n        } catch (error) {\n            this.logger.error('Failed to initialize audio system', error);\n            this.events.onAudioError?.(error as Error);\n        }\n    }\n\n    /**\n     * Create white noise buffer\n     */\n    private async createNoiseBuffer(): Promise<void> {\n        if (!this.audioContext) return;\n        \n        const bufferSize = this.audioContext.sampleRate * 2; // 2 seconds\n        this.noiseBuffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);\n        \n        const output = this.noiseBuffer.getChannelData(0);\n        for (let i = 0; i < bufferSize; i++) {\n            output[i] = Math.random() * 2 - 1;\n        }\n    }\n\n    /**\n     * Create reverb impulse response\n     */\n    private async createReverbBuffer(): Promise<void> {\n        if (!this.audioContext) return;\n        \n        const length = this.audioContext.sampleRate * 3; // 3 seconds\n        this.reverbBuffer = this.audioContext.createBuffer(2, length, this.audioContext.sampleRate);\n        \n        for (let channel = 0; channel < 2; channel++) {\n            const channelData = this.reverbBuffer.getChannelData(channel);\n            for (let i = 0; i < length; i++) {\n                const decay = Math.pow(1 - i / length, 2);\n                channelData[i] = (Math.random() * 2 - 1) * decay;\n            }\n        }\n        \n        this.convolver = this.audioContext.createConvolver();\n        this.convolver.buffer = this.reverbBuffer;\n    }\n\n    /**\n     * Play procedural sound effect\n     */\n    playSound(config: SoundConfig): void {\n        if (!this.audioContext || !this.soundEffectsGain) {\n            this.logger.warn('Audio system not initialized');\n            return;\n        }\n        \n        try {\n            const now = this.audioContext.currentTime;\n            let source: AudioScheduledSourceNode;\n            let sourceGain: GainNode;\n            \n            // Create source based on waveform\n            if (config.waveform === WaveformType.Noise) {\n                source = this.createNoiseSource();\n            } else {\n                source = this.createOscillatorSource(config);\n            }\n            \n            // Create gain for this sound\n            sourceGain = this.audioContext.createGain();\n            sourceGain.gain.value = 0;\n            \n            // Create filter if specified\n            let filterNode: BiquadFilterNode | undefined;\n            if (config.filter) {\n                filterNode = this.audioContext.createBiquadFilter();\n                filterNode.type = config.filter.type;\n                filterNode.frequency.value = config.filter.frequency;\n                filterNode.Q.value = config.filter.resonance;\n            }\n            \n            // Create distortion if specified\n            let distortionNode: WaveShaperNode | undefined;\n            if (config.distortion && config.distortion > 0) {\n                distortionNode = this.createDistortion(config.distortion);\n            }\n            \n            // Create spatial panner if position specified\n            let pannerNode: PannerNode | undefined;\n            if (config.position) {\n                pannerNode = this.audioContext.createPanner();\n                pannerNode.panningModel = 'HRTF';\n                pannerNode.positionX.value = config.position.x;\n                pannerNode.positionY.value = config.position.y;\n                pannerNode.positionZ.value = config.position.z;\n                pannerNode.maxDistance = config.maxDistance || 1000;\n            }\n            \n            // Connect audio graph\n            let currentNode: AudioNode = source;\n            \n            if (filterNode) {\n                currentNode.connect(filterNode);\n                currentNode = filterNode;\n            }\n            \n            if (distortionNode) {\n                currentNode.connect(distortionNode);\n                currentNode = distortionNode;\n            }\n            \n            currentNode.connect(sourceGain);\n            \n            if (pannerNode) {\n                sourceGain.connect(pannerNode);\n                pannerNode.connect(this.soundEffectsGain);\n            } else {\n                sourceGain.connect(this.soundEffectsGain);\n            }\n            \n            // Apply ADSR envelope\n            this.applyEnvelope(sourceGain.gain, config, now);\n            \n            // Apply frequency modulation if specified\n            if (config.frequencyModulation && source instanceof OscillatorNode) {\n                this.applyFrequencyModulation(source, config.frequencyModulation, now);\n            }\n            \n            // Start and schedule stop\n            source.start(now);\n            source.stop(now + config.duration);\n            \n            // Track active sound\n            this.activeSounds.add(source);\n            source.addEventListener('ended', () => {\n                this.activeSounds.delete(source);\n            });\n            \n            this.events.onSoundPlayed?.(config.type, config);\n            \n        } catch (error) {\n            this.logger.error('Failed to play sound', error);\n        }\n    }\n\n    /**\n     * Create oscillator source\n     */\n    private createOscillatorSource(config: SoundConfig): OscillatorNode {\n        const oscillator = this.audioContext!.createOscillator();\n        oscillator.type = config.waveform as OscillatorType;\n        oscillator.frequency.value = config.frequency;\n        \n        // Add harmonics for richer sound\n        if (config.harmonics) {\n            // Create additional oscillators for harmonics\n            config.harmonics.forEach((harmonic, index) => {\n                if (harmonic > 0) {\n                    const harmonicOsc = this.audioContext!.createOscillator();\n                    const harmonicGain = this.audioContext!.createGain();\n                    \n                    harmonicOsc.type = config.waveform as OscillatorType;\n                    harmonicOsc.frequency.value = config.frequency * (index + 2);\n                    harmonicGain.gain.value = harmonic;\n                    \n                    harmonicOsc.connect(harmonicGain);\n                    // Note: This simplified version connects to the same destination\n                    // In practice, you'd want to manage these connections properly\n                }\n            });\n        }\n        \n        return oscillator;\n    }\n\n    /**\n     * Create noise source\n     */\n    private createNoiseSource(): AudioBufferSourceNode {\n        const source = this.audioContext!.createBufferSource();\n        source.buffer = this.noiseBuffer;\n        source.loop = true;\n        return source;\n    }\n\n    /**\n     * Create distortion effect\n     */\n    private createDistortion(amount: number): WaveShaperNode {\n        const distortion = this.audioContext!.createWaveShaper();\n        const samples = 44100;\n        const curve = new Float32Array(samples);\n        const deg = Math.PI / 180;\n        \n        for (let i = 0; i < samples; i++) {\n            const x = (i * 2) / samples - 1;\n            curve[i] = ((3 + amount) * x * 20 * deg) / (Math.PI + amount * Math.abs(x));\n        }\n        \n        distortion.curve = curve;\n        distortion.oversample = '4x';\n        \n        return distortion;\n    }\n\n    /**\n     * Apply ADSR envelope\n     */\n    private applyEnvelope(gainParam: AudioParam, config: SoundConfig, startTime: number): void {\n        const { attack, decay, sustain, release, volume, duration } = config;\n        \n        // Attack\n        gainParam.setValueAtTime(0, startTime);\n        gainParam.linearRampToValueAtTime(volume, startTime + attack);\n        \n        // Decay\n        gainParam.linearRampToValueAtTime(volume * sustain, startTime + attack + decay);\n        \n        // Sustain (hold until release)\n        const sustainEnd = Math.max(startTime + attack + decay, startTime + duration - release);\n        gainParam.setValueAtTime(volume * sustain, sustainEnd);\n        \n        // Release\n        gainParam.linearRampToValueAtTime(0, startTime + duration);\n    }\n\n    /**\n     * Apply frequency modulation\n     */\n    private applyFrequencyModulation(\n        oscillator: OscillatorNode, \n        modConfig: NonNullable<SoundConfig['frequencyModulation']>, \n        startTime: number\n    ): void {\n        const modOscillator = this.audioContext!.createOscillator();\n        const modGain = this.audioContext!.createGain();\n        \n        modOscillator.type = modConfig.waveform as OscillatorType;\n        modOscillator.frequency.value = modConfig.rate;\n        modGain.gain.value = modConfig.depth;\n        \n        modOscillator.connect(modGain);\n        modGain.connect(oscillator.frequency);\n        \n        modOscillator.start(startTime);\n        modOscillator.stop(startTime + 10); // Long enough for any sound\n    }\n\n    /**\n     * Play retro-style sound effects\n     */\n    playRetroSound(type: SoundType, intensity: number = 1.0): void {\n        const configs: { [key in SoundType]: SoundConfig } = {\n            [SoundType.Engine]: {\n                type: SoundType.Engine,\n                frequency: 60 + intensity * 40,\n                duration: 0.5,\n                volume: 0.3 * intensity,\n                waveform: WaveformType.Sawtooth,\n                attack: 0.1,\n                decay: 0.1,\n                sustain: 0.7,\n                release: 0.3,\n                filter: {\n                    type: 'lowpass',\n                    frequency: 800 + intensity * 400,\n                    resonance: 2\n                }\n            },\n            [SoundType.Laser]: {\n                type: SoundType.Laser,\n                frequency: 800,\n                duration: 0.15,\n                volume: 0.4 * intensity,\n                waveform: WaveformType.Square,\n                attack: 0.01,\n                decay: 0.05,\n                sustain: 0.3,\n                release: 0.09,\n                frequencyModulation: {\n                    rate: 30,\n                    depth: 200,\n                    waveform: WaveformType.Sine\n                }\n            },\n            [SoundType.Explosion]: {\n                type: SoundType.Explosion,\n                frequency: 120,\n                duration: 0.8,\n                volume: 0.6 * intensity,\n                waveform: WaveformType.Noise,\n                attack: 0.01,\n                decay: 0.3,\n                sustain: 0.2,\n                release: 0.49,\n                filter: {\n                    type: 'lowpass',\n                    frequency: 2000 - intensity * 500,\n                    resonance: 1\n                },\n                distortion: 0.5\n            },\n            [SoundType.Beep]: {\n                type: SoundType.Beep,\n                frequency: 1000,\n                duration: 0.1,\n                volume: 0.3 * intensity,\n                waveform: WaveformType.Square,\n                attack: 0.01,\n                decay: 0.02,\n                sustain: 0.8,\n                release: 0.07\n            },\n            [SoundType.Warning]: {\n                type: SoundType.Warning,\n                frequency: 800,\n                duration: 0.5,\n                volume: 0.5 * intensity,\n                waveform: WaveformType.Square,\n                attack: 0.05,\n                decay: 0.1,\n                sustain: 0.6,\n                release: 0.35,\n                frequencyModulation: {\n                    rate: 8,\n                    depth: 100,\n                    waveform: WaveformType.Triangle\n                }\n            },\n            [SoundType.Warp]: {\n                type: SoundType.Warp,\n                frequency: 200,\n                duration: 2.0,\n                volume: 0.4 * intensity,\n                waveform: WaveformType.Sine,\n                attack: 0.5,\n                decay: 0.5,\n                sustain: 0.8,\n                release: 1.0,\n                frequencyModulation: {\n                    rate: 0.5,\n                    depth: 400,\n                    waveform: WaveformType.Sine\n                },\n                reverb: {\n                    roomSize: 0.8,\n                    dampening: 0.3,\n                    wetness: 0.6\n                }\n            },\n            [SoundType.Shield]: {\n                type: SoundType.Shield,\n                frequency: 400,\n                duration: 0.3,\n                volume: 0.3 * intensity,\n                waveform: WaveformType.Triangle,\n                attack: 0.1,\n                decay: 0.1,\n                sustain: 0.5,\n                release: 0.1,\n                filter: {\n                    type: 'bandpass',\n                    frequency: 600,\n                    resonance: 5\n                }\n            },\n            [SoundType.Impact]: {\n                type: SoundType.Impact,\n                frequency: 80,\n                duration: 0.2,\n                volume: 0.5 * intensity,\n                waveform: WaveformType.Noise,\n                attack: 0.01,\n                decay: 0.05,\n                sustain: 0.3,\n                release: 0.14,\n                filter: {\n                    type: 'lowpass',\n                    frequency: 500,\n                    resonance: 2\n                },\n                distortion: 0.3\n            },\n            [SoundType.Communication]: {\n                type: SoundType.Communication,\n                frequency: 1200,\n                duration: 0.4,\n                volume: 0.25 * intensity,\n                waveform: WaveformType.Sine,\n                attack: 0.1,\n                decay: 0.1,\n                sustain: 0.6,\n                release: 0.2,\n                frequencyModulation: {\n                    rate: 5,\n                    depth: 50,\n                    waveform: WaveformType.Triangle\n                }\n            },\n            [SoundType.Ambient]: {\n                type: SoundType.Ambient,\n                frequency: 200,\n                duration: 5.0,\n                volume: 0.2 * intensity,\n                waveform: WaveformType.Sine,\n                attack: 2.0,\n                decay: 1.0,\n                sustain: 0.8,\n                release: 2.0\n            },\n            [SoundType.UI]: {\n                type: SoundType.UI,\n                frequency: 600,\n                duration: 0.08,\n                volume: 0.2 * intensity,\n                waveform: WaveformType.Square,\n                attack: 0.01,\n                decay: 0.02,\n                sustain: 0.5,\n                release: 0.05\n            },\n            [SoundType.Thrust]: {\n                type: SoundType.Thrust,\n                frequency: 100 + intensity * 50,\n                duration: 0.3,\n                volume: 0.4 * intensity,\n                waveform: WaveformType.Sawtooth,\n                attack: 0.05,\n                decay: 0.1,\n                sustain: 0.8,\n                release: 0.15,\n                filter: {\n                    type: 'lowpass',\n                    frequency: 400 + intensity * 200,\n                    resonance: 1\n                }\n            }\n        };\n        \n        this.playSound(configs[type]);\n    }\n\n    /**\n     * Start ambient space music\n     */\n    startAmbientTrack(trackName: string): void {\n        if (this.currentTrack === trackName) return;\n        \n        this.stopAmbientTrack();\n        \n        const trackConfigs: { [key: string]: AmbientTrackConfig } = {\n            'deep_space': {\n                name: 'Deep Space',\n                fadeInTime: 3.0,\n                fadeOutTime: 2.0,\n                crossfadeTime: 1.0,\n                layers: [\n                    {\n                        id: 'bass_drone',\n                        waveform: WaveformType.Sine,\n                        baseFrequency: 40,\n                        volume: 0.3,\n                        pan: 0,\n                        frequencyVariation: 0.1,\n                        volumeVariation: 0.2,\n                        frequency: { min: 35, max: 45, speed: 0.1 },\n                        filter: {\n                            type: 'lowpass',\n                            minFreq: 200,\n                            maxFreq: 800,\n                            speed: 0.05,\n                            resonance: 2\n                        }\n                    },\n                    {\n                        id: 'cosmic_wind',\n                        waveform: WaveformType.Noise,\n                        baseFrequency: 200,\n                        volume: 0.15,\n                        pan: -0.3,\n                        frequencyVariation: 0.3,\n                        volumeVariation: 0.4,\n                        frequency: { min: 150, max: 300, speed: 0.2 },\n                        filter: {\n                            type: 'bandpass',\n                            minFreq: 800,\n                            maxFreq: 3000,\n                            speed: 0.3,\n                            resonance: 1\n                        }\n                    },\n                    {\n                        id: 'stellar_harmonics',\n                        waveform: WaveformType.Triangle,\n                        baseFrequency: 220,\n                        volume: 0.2,\n                        pan: 0.4,\n                        frequencyVariation: 0.2,\n                        volumeVariation: 0.3,\n                        frequency: { min: 200, max: 440, speed: 0.15 },\n                        filter: {\n                            type: 'highpass',\n                            minFreq: 400,\n                            maxFreq: 1200,\n                            speed: 0.1,\n                            resonance: 0.5\n                        }\n                    }\n                ]\n            },\n            'nebula_drift': {\n                name: 'Nebula Drift',\n                fadeInTime: 4.0,\n                fadeOutTime: 3.0,\n                crossfadeTime: 2.0,\n                layers: [\n                    {\n                        id: 'nebula_wash',\n                        waveform: WaveformType.Sine,\n                        baseFrequency: 80,\n                        volume: 0.25,\n                        pan: 0,\n                        frequencyVariation: 0.3,\n                        volumeVariation: 0.5,\n                        frequency: { min: 60, max: 120, speed: 0.08 },\n                        filter: {\n                            type: 'lowpass',\n                            minFreq: 300,\n                            maxFreq: 1500,\n                            speed: 0.12,\n                            resonance: 3\n                        }\n                    },\n                    {\n                        id: 'particle_shimmer',\n                        waveform: WaveformType.Triangle,\n                        baseFrequency: 800,\n                        volume: 0.1,\n                        pan: -0.6,\n                        frequencyVariation: 0.4,\n                        volumeVariation: 0.6,\n                        frequency: { min: 600, max: 1200, speed: 0.4 },\n                        filter: {\n                            type: 'bandpass',\n                            minFreq: 1000,\n                            maxFreq: 4000,\n                            speed: 0.5,\n                            resonance: 2\n                        }\n                    }\n                ]\n            },\n            'void_silence': {\n                name: 'Void Silence',\n                fadeInTime: 5.0,\n                fadeOutTime: 4.0,\n                crossfadeTime: 3.0,\n                layers: [\n                    {\n                        id: 'quantum_whisper',\n                        waveform: WaveformType.Sine,\n                        baseFrequency: 30,\n                        volume: 0.15,\n                        pan: 0,\n                        frequencyVariation: 0.05,\n                        volumeVariation: 0.8,\n                        frequency: { min: 25, max: 35, speed: 0.02 },\n                        filter: {\n                            type: 'lowpass',\n                            minFreq: 100,\n                            maxFreq: 400,\n                            speed: 0.03,\n                            resonance: 1\n                        }\n                    }\n                ]\n            }\n        };\n        \n        const config = trackConfigs[trackName];\n        if (!config) {\n            this.logger.warn(`Unknown ambient track: ${trackName}`);\n            return;\n        }\n        \n        this.currentTrack = trackName;\n        this.createAmbientLayers(config);\n        \n        this.events.onTrackChanged?.(trackName);\n        this.logger.info(`🎵 Started ambient track: ${trackName}`);\n    }\n\n    /**\n     * Create ambient music layers\n     */\n    private createAmbientLayers(config: AmbientTrackConfig): void {\n        if (!this.audioContext || !this.musicGain) return;\n        \n        const now = this.audioContext.currentTime;\n        \n        config.layers.forEach(layerConfig => {\n            let source: AudioScheduledSourceNode;\n            \n            if (layerConfig.waveform === WaveformType.Noise) {\n                source = this.audioContext!.createBufferSource();\n                (source as AudioBufferSourceNode).buffer = this.noiseBuffer;\n                (source as AudioBufferSourceNode).loop = true;\n            } else {\n                const oscillator = this.audioContext!.createOscillator();\n                oscillator.type = layerConfig.waveform as OscillatorType;\n                oscillator.frequency.value = layerConfig.baseFrequency;\n                source = oscillator;\n            }\n            \n            // Create gain for this layer\n            const layerGain = this.audioContext!.createGain();\n            layerGain.gain.value = 0;\n            \n            // Create panner\n            const panner = this.audioContext!.createStereoPanner();\n            panner.pan.value = layerConfig.pan;\n            \n            // Create filter if specified\n            let filter: BiquadFilterNode | undefined;\n            if (layerConfig.filter) {\n                filter = this.audioContext!.createBiquadFilter();\n                filter.type = layerConfig.filter.type;\n                filter.frequency.value = layerConfig.filter.minFreq;\n                filter.Q.value = layerConfig.filter.resonance;\n            }\n            \n            // Connect audio graph\n            let currentNode: AudioNode = source;\n            \n            if (filter) {\n                currentNode.connect(filter);\n                currentNode = filter;\n            }\n            \n            currentNode.connect(layerGain);\n            layerGain.connect(panner);\n            panner.connect(this.musicGain!);\n            \n            // Fade in\n            layerGain.gain.linearRampToValueAtTime(\n                layerConfig.volume, \n                now + config.fadeInTime\n            );\n            \n            // Start the source\n            source.start(now);\n            \n            // Store layer references\n            this.ambientLayers.set(layerConfig.id, {\n                oscillator: source,\n                gain: layerGain,\n                filter,\n                panner\n            });\n            \n            // Start modulation if oscillator\n            if (source instanceof OscillatorNode) {\n                this.startLayerModulation(source, layerConfig, filter);\n            }\n        });\n    }\n\n    /**\n     * Start layer modulation effects\n     */\n    private startLayerModulation(\n        oscillator: OscillatorNode, \n        config: AmbientLayer, \n        filter?: BiquadFilterNode\n    ): void {\n        if (!this.audioContext) return;\n        \n        // Frequency modulation\n        const freqModOsc = this.audioContext.createOscillator();\n        const freqModGain = this.audioContext.createGain();\n        \n        freqModOsc.type = 'sine';\n        freqModOsc.frequency.value = config.frequency.speed;\n        freqModGain.gain.value = (config.frequency.max - config.frequency.min) / 2;\n        \n        freqModOsc.connect(freqModGain);\n        freqModGain.connect(oscillator.frequency);\n        freqModOsc.start();\n        \n        // Filter modulation\n        if (filter && config.filter) {\n            const filterModOsc = this.audioContext.createOscillator();\n            const filterModGain = this.audioContext.createGain();\n            \n            filterModOsc.type = 'triangle';\n            filterModOsc.frequency.value = config.filter.speed;\n            filterModGain.gain.value = (config.filter.maxFreq - config.filter.minFreq) / 2;\n            \n            filterModOsc.connect(filterModGain);\n            filterModGain.connect(filter.frequency);\n            filterModOsc.start();\n        }\n    }\n\n    /**\n     * Stop ambient track\n     */\n    stopAmbientTrack(): void {\n        if (!this.currentTrack || !this.audioContext) return;\n        \n        const now = this.audioContext.currentTime;\n        const fadeTime = 2.0;\n        \n        // Fade out all layers\n        this.ambientLayers.forEach(layer => {\n            layer.gain.gain.linearRampToValueAtTime(0, now + fadeTime);\n            layer.oscillator.stop(now + fadeTime + 0.1);\n        });\n        \n        // Clear layers after fade\n        setTimeout(() => {\n            this.ambientLayers.clear();\n        }, (fadeTime + 0.2) * 1000);\n        \n        this.currentTrack = null;\n        this.logger.info('🎵 Stopped ambient track');\n    }\n\n    /**\n     * Set master volume\n     */\n    setMasterVolume(volume: number): void {\n        this.masterVolume = Math.max(0, Math.min(1, volume));\n        if (this.masterGain) {\n            this.masterGain.gain.value = this.masterVolume;\n        }\n    }\n\n    /**\n     * Set music volume\n     */\n    setMusicVolume(volume: number): void {\n        this.musicVolume = Math.max(0, Math.min(1, volume));\n        if (this.musicGain) {\n            this.musicGain.gain.value = this.musicVolume;\n        }\n    }\n\n    /**\n     * Set sound effects volume\n     */\n    setSFXVolume(volume: number): void {\n        this.sfxVolume = Math.max(0, Math.min(1, volume));\n        if (this.soundEffectsGain) {\n            this.soundEffectsGain.gain.value = this.sfxVolume;\n        }\n    }\n\n    /**\n     * Get audio statistics\n     */\n    getAudioStats(): {\n        contextState: string;\n        activeSounds: number;\n        currentTrack: string | null;\n        ambientLayers: number;\n        masterVolume: number;\n        musicVolume: number;\n        sfxVolume: number;\n    } {\n        return {\n            contextState: this.audioContext?.state || 'not_initialized',\n            activeSounds: this.activeSounds.size,\n            currentTrack: this.currentTrack,\n            ambientLayers: this.ambientLayers.size,\n            masterVolume: this.masterVolume,\n            musicVolume: this.musicVolume,\n            sfxVolume: this.sfxVolume\n        };\n    }\n\n    /**\n     * Stop all sounds\n     */\n    stopAllSounds(): void {\n        // Stop sound effects\n        this.activeSounds.forEach(sound => {\n            if (sound instanceof AudioScheduledSourceNode) {\n                try {\n                    sound.stop();\n                } catch (e) {\n                    // Sound might already be stopped\n                }\n            }\n        });\n        this.activeSounds.clear();\n        \n        // Stop ambient music\n        this.stopAmbientTrack();\n    }\n\n    /**\n     * Dispose audio system\n     */\n    dispose(): void {\n        this.stopAllSounds();\n        \n        if (this.audioContext) {\n            this.audioContext.close();\n            this.audioContext = null;\n        }\n        \n        this.logger.info('🔊 Audio system disposed');\n    }\n}","/**\n * Main Menu System\n * Professional game menu with retro CRT styling and smooth transitions\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\nimport { InputManager } from '@core/InputManager';\nimport { ProceduralAudio, SoundType } from '@audio/ProceduralAudio';\nimport { ParticleSystem, ParticleType } from '@effects/ParticleSystem';\n\nexport enum MenuState {\n    MainMenu = 'main_menu',\n    NewGame = 'new_game',\n    LoadGame = 'load_game',\n    Settings = 'settings',\n    Connecting = 'connecting',\n    GameStart = 'game_start'\n}\n\nexport interface MenuButton {\n    id: string;\n    text: string;\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    enabled: boolean;\n    highlighted: boolean;\n    action: () => void;\n    hotkey?: string;\n}\n\nexport interface MenuConfig {\n    title: string;\n    subtitle?: string;\n    showBackground: boolean;\n    showParticles: boolean;\n    enableSounds: boolean;\n    transitionTime: number;\n}\n\nexport interface NewGameSettings {\n    playerName: string;\n    difficulty: 'easy' | 'normal' | 'hard' | 'nightmare';\n    galaxySeed: string;\n    galaxySize: 'small' | 'medium' | 'large' | 'huge';\n    startingResources: 'minimal' | 'standard' | 'abundant';\n    enemyFrequency: 'low' | 'normal' | 'high' | 'extreme';\n    enablePermadeath: boolean;\n    enableTutorial: boolean;\n}\n\nexport interface GameSettings {\n    // Video settings\n    renderScale: number;\n    vsync: boolean;\n    fullscreen: boolean;\n    \n    // Audio settings\n    masterVolume: number;\n    musicVolume: number;\n    sfxVolume: number;\n    \n    // Gameplay settings\n    difficulty: 'easy' | 'normal' | 'hard';\n    mouseSensitivity: number;\n    showFPS: boolean;\n    autoSave: boolean;\n    autoSaveInterval: number;\n    \n    // Accessibility\n    colorblindMode: 'none' | 'deuteranopia' | 'protanopia' | 'tritanopia';\n    subtitles: boolean;\n    reducedMotion: boolean;\n    \n    // Controls\n    keyBindings: { [action: string]: string };\n}\n\nexport interface MenuEvents {\n    onNewGame?: (settings: NewGameSettings) => void;\n    onLoadGame?: (saveSlot: number) => void;\n    onSettings?: (settings: GameSettings) => void;\n    onExit?: () => void;\n    onGameStart?: () => void;\n}\n\nexport class MainMenu {\n    private currentState: MenuState = MenuState.MainMenu;\n    private previousState: MenuState | null = null;\n    \n    // UI state\n    private buttons: MenuButton[] = [];\n    private selectedButtonIndex: number = 0;\n    private animationTime: number = 0;\n    private transitionProgress: number = 0;\n    private isTransitioning: boolean = false;\n    \n    // Settings\n    private newGameSettings: NewGameSettings;\n    private gameSettings: GameSettings;\n    \n    // Visual effects\n    private backgroundParticles: string[] = [];\n    private titleGlow: number = 0;\n    private screenFlicker: number = 0;\n    \n    // Menu specific data\n    private saveSlots: Array<{\n        slot: number;\n        name: string;\n        date: string;\n        playtime: string;\n        level: number;\n        system: string;\n        exists: boolean;\n    }> = [];\n    \n    private events: MenuEvents;\n    private audio: ProceduralAudio | null = null;\n    private particles: ParticleSystem | null = null;\n    private logger: Logger;\n\n    constructor(\n        events: MenuEvents,\n        audio?: ProceduralAudio,\n        particles?: ParticleSystem\n    ) {\n        this.logger = new Logger('MainMenu');\n        this.events = events;\n        this.audio = audio || null;\n        this.particles = particles || null;\n        \n        // Initialize default settings\n        this.newGameSettings = this.getDefaultNewGameSettings();\n        this.gameSettings = this.getDefaultGameSettings();\n        \n        // Load save slots\n        this.loadSaveSlots();\n        \n        // Initialize main menu\n        this.initializeMainMenu();\n        \n        // Start background effects\n        this.startBackgroundEffects();\n        \n        this.logger.info('🎮 Main menu system initialized');\n    }\n\n    /**\n     * Update menu system\n     */\n    update(deltaTime: number, input: InputManager): void {\n        this.animationTime += deltaTime;\n        \n        // Update visual effects\n        this.updateVisualEffects(deltaTime);\n        \n        // Handle transitions\n        if (this.isTransitioning) {\n            this.updateTransition(deltaTime);\n            return;\n        }\n        \n        // Handle input based on current state\n        this.handleInput(input);\n        \n        // Update particles\n        this.updateParticleEffects(deltaTime);\n    }\n\n    /**\n     * Handle input for current menu state\n     */\n    private handleInput(input: InputManager): void {\n        // Navigation\n        if (input.isKeyPressed('ArrowUp') || input.isKeyPressed('KeyW')) {\n            this.navigateUp();\n        } else if (input.isKeyPressed('ArrowDown') || input.isKeyPressed('KeyS')) {\n            this.navigateDown();\n        }\n        \n        // Selection\n        if (input.isKeyPressed('Enter') || input.isKeyPressed('Space')) {\n            this.selectButton();\n        }\n        \n        // Back/Cancel\n        if (input.isKeyPressed('Escape')) {\n            this.goBack();\n        }\n        \n        // State-specific input\n        switch (this.currentState) {\n            case MenuState.NewGame:\n                this.handleNewGameInput(input);\n                break;\n            case MenuState.Settings:\n                this.handleSettingsInput(input);\n                break;\n        }\n        \n        // Hotkey support\n        this.handleHotkeys(input);\n    }\n\n    /**\n     * Navigate up in menu\n     */\n    private navigateUp(): void {\n        if (this.buttons.length === 0) return;\n        \n        this.playUISound('navigation');\n        \n        do {\n            this.selectedButtonIndex = (this.selectedButtonIndex - 1 + this.buttons.length) % this.buttons.length;\n        } while (!this.buttons[this.selectedButtonIndex].enabled);\n        \n        this.updateButtonHighlights();\n    }\n\n    /**\n     * Navigate down in menu\n     */\n    private navigateDown(): void {\n        if (this.buttons.length === 0) return;\n        \n        this.playUISound('navigation');\n        \n        do {\n            this.selectedButtonIndex = (this.selectedButtonIndex + 1) % this.buttons.length;\n        } while (!this.buttons[this.selectedButtonIndex].enabled);\n        \n        this.updateButtonHighlights();\n    }\n\n    /**\n     * Select current button\n     */\n    private selectButton(): void {\n        if (this.buttons.length === 0 || this.selectedButtonIndex >= this.buttons.length) return;\n        \n        const button = this.buttons[this.selectedButtonIndex];\n        if (!button.enabled) return;\n        \n        this.playUISound('select');\n        button.action();\n    }\n\n    /**\n     * Go back to previous menu\n     */\n    private goBack(): void {\n        this.playUISound('back');\n        \n        switch (this.currentState) {\n            case MenuState.MainMenu:\n                // Exit game or minimize\n                this.events.onExit?.();\n                break;\n            default:\n                this.transitionToState(MenuState.MainMenu);\n                break;\n        }\n    }\n\n    /**\n     * Initialize main menu buttons\n     */\n    private initializeMainMenu(): void {\n        this.buttons = [\n            {\n                id: 'new_game',\n                text: 'NOVÁ HRA',\n                x: 0, y: 0, width: 220, height: 45,\n                enabled: true,\n                highlighted: false,\n                action: () => this.transitionToState(MenuState.NewGame),\n                hotkey: 'KeyN'\n            },\n            {\n                id: 'load_game',\n                text: 'NAČÍST HRU',\n                x: 0, y: 0, width: 220, height: 45,\n                enabled: this.hasSaveGames(),\n                highlighted: false,\n                action: () => this.transitionToState(MenuState.LoadGame),\n                hotkey: 'KeyL'\n            },\n            {\n                id: 'settings',\n                text: 'NASTAVENÍ',\n                x: 0, y: 0, width: 220, height: 45,\n                enabled: true,\n                highlighted: false,\n                action: () => this.transitionToState(MenuState.Settings),\n                hotkey: 'KeyS'\n            },\n            {\n                id: 'exit',\n                text: 'UKONČIT',\n                x: 0, y: 0, width: 220, height: 45,\n                enabled: true,\n                highlighted: false,\n                action: () => this.events.onExit?.(),\n                hotkey: 'KeyQ'\n            }\n        ];\n        \n        this.selectedButtonIndex = 0;\n        this.updateButtonPositions();\n        this.updateButtonHighlights();\n    }\n\n    /**\n     * Initialize new game menu\n     */\n    private initializeNewGameMenu(): void {\n        this.buttons = [\n            {\n                id: 'player_name',\n                text: `CAPTAIN NAME: ${this.newGameSettings.playerName}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.editPlayerName()\n            },\n            {\n                id: 'difficulty',\n                text: `DIFFICULTY: ${this.newGameSettings.difficulty.toUpperCase()}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.cycleDifficulty()\n            },\n            {\n                id: 'galaxy_size',\n                text: `GALAXY SIZE: ${this.newGameSettings.galaxySize.toUpperCase()}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.cycleGalaxySize()\n            },\n            {\n                id: 'enemy_frequency',\n                text: `HOSTILES: ${this.newGameSettings.enemyFrequency.toUpperCase()}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.cycleEnemyFrequency()\n            },\n            {\n                id: 'permadeath',\n                text: `PERMADEATH: ${this.newGameSettings.enablePermadeath ? 'ON' : 'OFF'}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.togglePermadeath()\n            },\n            {\n                id: 'tutorial',\n                text: `TUTORIAL: ${this.newGameSettings.enableTutorial ? 'ON' : 'OFF'}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.toggleTutorial()\n            },\n            {\n                id: 'start_game',\n                text: 'START MISSION',\n                x: 0, y: 0, width: 300, height: 40,\n                enabled: true,\n                highlighted: false,\n                action: () => this.startNewGame()\n            },\n            {\n                id: 'back',\n                text: 'BACK',\n                x: 0, y: 0, width: 200, height: 40,\n                enabled: true,\n                highlighted: false,\n                action: () => this.transitionToState(MenuState.MainMenu)\n            }\n        ];\n        \n        this.selectedButtonIndex = 0;\n        this.updateButtonPositions();\n        this.updateButtonHighlights();\n    }\n\n    /**\n     * Initialize load game menu\n     */\n    private initializeLoadGameMenu(): void {\n        this.buttons = [];\n        \n        // Add save slot buttons\n        for (let i = 0; i < this.saveSlots.length; i++) {\n            const slot = this.saveSlots[i];\n            \n            this.buttons.push({\n                id: `save_slot_${slot.slot}`,\n                text: slot.exists ? \n                    `SLOT ${slot.slot}: ${slot.name} - ${slot.system} (${slot.playtime})` :\n                    `SLOT ${slot.slot}: EMPTY`,\n                x: 0, y: 0, width: 600, height: 40,\n                enabled: slot.exists,\n                highlighted: false,\n                action: () => this.loadGame(slot.slot)\n            });\n        }\n        \n        // Add back button\n        this.buttons.push({\n            id: 'back',\n            text: 'BACK',\n            x: 0, y: 0, width: 200, height: 40,\n            enabled: true,\n            highlighted: false,\n            action: () => this.transitionToState(MenuState.MainMenu)\n        });\n        \n        this.selectedButtonIndex = 0;\n        this.updateButtonPositions();\n        this.updateButtonHighlights();\n    }\n\n    /**\n     * Initialize settings menu\n     */\n    private initializeSettingsMenu(): void {\n        this.buttons = [\n            {\n                id: 'render_scale',\n                text: `RENDER QUALITY: ${Math.round(this.gameSettings.renderScale * 100)}%`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.adjustRenderScale()\n            },\n            {\n                id: 'master_volume',\n                text: `MASTER VOLUME: ${Math.round(this.gameSettings.masterVolume * 100)}%`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.adjustMasterVolume()\n            },\n            {\n                id: 'music_volume',\n                text: `MUSIC VOLUME: ${Math.round(this.gameSettings.musicVolume * 100)}%`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.adjustMusicVolume()\n            },\n            {\n                id: 'sfx_volume',\n                text: `SFX VOLUME: ${Math.round(this.gameSettings.sfxVolume * 100)}%`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.adjustSfxVolume()\n            },\n            {\n                id: 'show_fps',\n                text: `SHOW FPS: ${this.gameSettings.showFPS ? 'ON' : 'OFF'}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.toggleShowFPS()\n            },\n            {\n                id: 'vsync',\n                text: `VSYNC: ${this.gameSettings.vsync ? 'ON' : 'OFF'}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.toggleVSync()\n            },\n            {\n                id: 'apply_settings',\n                text: 'APPLY CHANGES',\n                x: 0, y: 0, width: 300, height: 40,\n                enabled: true,\n                highlighted: false,\n                action: () => this.applySettings()\n            },\n            {\n                id: 'reset_defaults',\n                text: 'RESET TO DEFAULTS',\n                x: 0, y: 0, width: 300, height: 40,\n                enabled: true,\n                highlighted: false,\n                action: () => this.resetToDefaults()\n            },\n            {\n                id: 'back',\n                text: 'BACK',\n                x: 0, y: 0, width: 200, height: 40,\n                enabled: true,\n                highlighted: false,\n                action: () => this.transitionToState(MenuState.MainMenu)\n            }\n        ];\n        \n        this.selectedButtonIndex = 0;\n        this.updateButtonPositions();\n        this.updateButtonHighlights();\n    }\n\n\n\n    /**\n     * Update button positions based on screen size\n     */\n    private updateButtonPositions(): void {\n        const centerX = 400; // Assuming 800px width\n        const startY = 250;\n        const spacing = 50;\n        \n        for (let i = 0; i < this.buttons.length; i++) {\n            const button = this.buttons[i];\n            button.x = centerX - button.width / 2;\n            button.y = startY + i * spacing;\n        }\n    }\n\n    /**\n     * Update button highlight states\n     */\n    private updateButtonHighlights(): void {\n        for (let i = 0; i < this.buttons.length; i++) {\n            this.buttons[i].highlighted = (i === this.selectedButtonIndex);\n        }\n    }\n\n    /**\n     * Handle new game settings input\n     */\n    private handleNewGameInput(input: InputManager): void {\n        // Additional input handling for new game menu\n        if (input.isKeyPressed('KeyR')) {\n            this.generateRandomSeed();\n        }\n    }\n\n    /**\n     * Handle settings input\n     */\n    private handleSettingsInput(input: InputManager): void {\n        const button = this.buttons[this.selectedButtonIndex];\n        if (!button) return;\n        \n        // Use left/right arrows to adjust values\n        if (input.isKeyPressed('ArrowLeft')) {\n            this.adjustSettingDown(button.id);\n        } else if (input.isKeyPressed('ArrowRight')) {\n            this.adjustSettingUp(button.id);\n        }\n    }\n\n    /**\n     * Handle hotkey input\n     */\n    private handleHotkeys(input: InputManager): void {\n        if (this.currentState !== MenuState.MainMenu) return;\n        \n        for (const button of this.buttons) {\n            if (button.hotkey && input.isKeyPressed(button.hotkey) && button.enabled) {\n                this.playUISound('select');\n                button.action();\n                break;\n            }\n        }\n    }\n\n    /**\n     * Transition to new menu state\n     */\n    private transitionToState(newState: MenuState): void {\n        if (this.isTransitioning) return;\n        \n        this.previousState = this.currentState;\n        this.isTransitioning = true;\n        this.transitionProgress = 0;\n        \n        // Start transition effect\n        this.playUISound('transition');\n        this.createTransitionEffect();\n        \n        // Initialize new state after half transition\n        setTimeout(() => {\n            this.currentState = newState;\n            this.initializeMenuForState(newState);\n        }, 150); // Half of transition time\n    }\n\n    /**\n     * Initialize menu for specific state\n     */\n    private initializeMenuForState(state: MenuState): void {\n        switch (state) {\n            case MenuState.MainMenu:\n                this.initializeMainMenu();\n                break;\n            case MenuState.NewGame:\n                this.initializeNewGameMenu();\n                break;\n            case MenuState.LoadGame:\n                this.initializeLoadGameMenu();\n                break;\n            case MenuState.Settings:\n                this.initializeSettingsMenu();\n                break;\n        }\n    }\n\n    /**\n     * Update transition animation\n     */\n    private updateTransition(deltaTime: number): void {\n        this.transitionProgress += deltaTime / 300; // 300ms transition\n        \n        if (this.transitionProgress >= 1.0) {\n            this.transitionProgress = 1.0;\n            this.isTransitioning = false;\n        }\n    }\n\n    /**\n     * Update visual effects\n     */\n    private updateVisualEffects(deltaTime: number): void {\n        // Title glow animation\n        this.titleGlow = (Math.sin(this.animationTime * 0.003) + 1) * 0.5;\n        \n        // Screen flicker effect\n        this.screenFlicker = Math.random() * 0.05;\n        \n        // Background particle movement\n        this.updateBackgroundParticles(deltaTime);\n    }\n\n    /**\n     * Update particle effects\n     */\n    private updateParticleEffects(deltaTime: number): void {\n        if (!this.particles) return;\n        \n        this.particles.update(deltaTime);\n        \n        // Spawn occasional background particles\n        if (Math.random() < 0.01) {\n            const x = Math.random() * 800;\n            const y = Math.random() * 600;\n            this.particles.createExplosion({ x, y }, 0.1);\n        }\n    }\n\n    /**\n     * Start background effects\n     */\n    private startBackgroundEffects(): void {\n        if (!this.particles) return;\n        \n        // Create initial background particles\n        for (let i = 0; i < 20; i++) {\n            const x = Math.random() * 800;\n            const y = Math.random() * 600;\n            const emitterId = this.particles.createThrustTrail(\n                { x, y },\n                Math.random() * Math.PI * 2,\n                0.2\n            );\n            this.backgroundParticles.push(emitterId);\n        }\n        \n        // Start ambient music\n        if (this.audio) {\n            this.audio.startAmbientTrack('void_silence');\n        }\n    }\n\n    /**\n     * Update background particles\n     */\n    private updateBackgroundParticles(deltaTime: number): void {\n        // Background particles drift slowly\n        // Implementation depends on particle system API\n    }\n\n    /**\n     * Create transition effect\n     */\n    private createTransitionEffect(): void {\n        if (!this.particles) return;\n        \n        // Screen wipe effect with particles\n        for (let i = 0; i < 50; i++) {\n            const x = Math.random() * 800;\n            const y = Math.random() * 600;\n            this.particles.createExplosion({ x, y }, 0.3);\n        }\n    }\n\n    /**\n     * Play UI sound effect\n     */\n    private playUISound(type: 'navigation' | 'select' | 'back' | 'transition' | 'error'): void {\n        if (!this.audio) return;\n        \n        switch (type) {\n            case 'navigation':\n                this.audio.playRetroSound(SoundType.Beep, 0.3);\n                break;\n            case 'select':\n                this.audio.playRetroSound(SoundType.UI, 0.5);\n                break;\n            case 'back':\n                this.audio.playRetroSound(SoundType.UI, 0.3);\n                break;\n            case 'transition':\n                this.audio.playRetroSound(SoundType.Communication, 0.4);\n                break;\n            case 'error':\n                this.audio.playRetroSound(SoundType.Warning, 0.6);\n                break;\n        }\n    }\n\n    /**\n     * New game setting actions\n     */\n    private editPlayerName(): void {\n        // Simple name cycling for demo\n        const names = ['COMMANDER', 'CAPTAIN', 'ADMIRAL', 'PILOT', 'EXPLORER'];\n        const currentIndex = names.indexOf(this.newGameSettings.playerName);\n        this.newGameSettings.playerName = names[(currentIndex + 1) % names.length];\n        this.updateNewGameMenuText();\n    }\n\n    private cycleDifficulty(): void {\n        const difficulties: NewGameSettings['difficulty'][] = ['easy', 'normal', 'hard', 'nightmare'];\n        const currentIndex = difficulties.indexOf(this.newGameSettings.difficulty);\n        this.newGameSettings.difficulty = difficulties[(currentIndex + 1) % difficulties.length];\n        this.updateNewGameMenuText();\n    }\n\n    private cycleGalaxySize(): void {\n        const sizes: NewGameSettings['galaxySize'][] = ['small', 'medium', 'large', 'huge'];\n        const currentIndex = sizes.indexOf(this.newGameSettings.galaxySize);\n        this.newGameSettings.galaxySize = sizes[(currentIndex + 1) % sizes.length];\n        this.updateNewGameMenuText();\n    }\n\n    private cycleEnemyFrequency(): void {\n        const frequencies: NewGameSettings['enemyFrequency'][] = ['low', 'normal', 'high', 'extreme'];\n        const currentIndex = frequencies.indexOf(this.newGameSettings.enemyFrequency);\n        this.newGameSettings.enemyFrequency = frequencies[(currentIndex + 1) % frequencies.length];\n        this.updateNewGameMenuText();\n    }\n\n    private togglePermadeath(): void {\n        this.newGameSettings.enablePermadeath = !this.newGameSettings.enablePermadeath;\n        this.updateNewGameMenuText();\n    }\n\n    private toggleTutorial(): void {\n        this.newGameSettings.enableTutorial = !this.newGameSettings.enableTutorial;\n        this.updateNewGameMenuText();\n    }\n\n    private generateRandomSeed(): void {\n        this.newGameSettings.galaxySeed = Math.random().toString(36).substring(2, 8).toUpperCase();\n        this.updateNewGameMenuText();\n    }\n\n    private startNewGame(): void {\n        this.playUISound('select');\n        this.events.onNewGame?.(this.newGameSettings);\n        this.transitionToState(MenuState.GameStart);\n    }\n\n    /**\n     * Settings adjustment actions\n     */\n    private adjustSettingDown(settingId: string): void {\n        switch (settingId) {\n            case 'render_scale':\n                this.gameSettings.renderScale = Math.max(0.5, this.gameSettings.renderScale - 0.1);\n                break;\n            case 'master_volume':\n                this.gameSettings.masterVolume = Math.max(0, this.gameSettings.masterVolume - 0.1);\n                break;\n            case 'music_volume':\n                this.gameSettings.musicVolume = Math.max(0, this.gameSettings.musicVolume - 0.1);\n                break;\n            case 'sfx_volume':\n                this.gameSettings.sfxVolume = Math.max(0, this.gameSettings.sfxVolume - 0.1);\n                break;\n        }\n        this.updateSettingsMenuText();\n    }\n\n    private adjustSettingUp(settingId: string): void {\n        switch (settingId) {\n            case 'render_scale':\n                this.gameSettings.renderScale = Math.min(2.0, this.gameSettings.renderScale + 0.1);\n                break;\n            case 'master_volume':\n                this.gameSettings.masterVolume = Math.min(1.0, this.gameSettings.masterVolume + 0.1);\n                break;\n            case 'music_volume':\n                this.gameSettings.musicVolume = Math.min(1.0, this.gameSettings.musicVolume + 0.1);\n                break;\n            case 'sfx_volume':\n                this.gameSettings.sfxVolume = Math.min(1.0, this.gameSettings.sfxVolume + 0.1);\n                break;\n        }\n        this.updateSettingsMenuText();\n    }\n\n    private adjustRenderScale(): void {\n        this.gameSettings.renderScale = this.gameSettings.renderScale >= 2.0 ? 0.5 : this.gameSettings.renderScale + 0.25;\n        this.updateSettingsMenuText();\n    }\n\n    private adjustMasterVolume(): void {\n        this.gameSettings.masterVolume = (this.gameSettings.masterVolume + 0.2) % 1.2;\n        if (this.gameSettings.masterVolume > 1.0) this.gameSettings.masterVolume = 0;\n        this.updateSettingsMenuText();\n    }\n\n    private adjustMusicVolume(): void {\n        this.gameSettings.musicVolume = (this.gameSettings.musicVolume + 0.2) % 1.2;\n        if (this.gameSettings.musicVolume > 1.0) this.gameSettings.musicVolume = 0;\n        this.updateSettingsMenuText();\n    }\n\n    private adjustSfxVolume(): void {\n        this.gameSettings.sfxVolume = (this.gameSettings.sfxVolume + 0.2) % 1.2;\n        if (this.gameSettings.sfxVolume > 1.0) this.gameSettings.sfxVolume = 0;\n        this.updateSettingsMenuText();\n    }\n\n    private toggleShowFPS(): void {\n        this.gameSettings.showFPS = !this.gameSettings.showFPS;\n        this.updateSettingsMenuText();\n    }\n\n    private toggleVSync(): void {\n        this.gameSettings.vsync = !this.gameSettings.vsync;\n        this.updateSettingsMenuText();\n    }\n\n    private applySettings(): void {\n        this.playUISound('select');\n        this.events.onSettings?.(this.gameSettings);\n        this.saveSettings();\n    }\n\n    private resetToDefaults(): void {\n        this.gameSettings = this.getDefaultGameSettings();\n        this.updateSettingsMenuText();\n        this.playUISound('select');\n    }\n\n    /**\n     * Load game action\n     */\n    private loadGame(slot: number): void {\n        this.playUISound('select');\n        this.events.onLoadGame?.(slot);\n        this.transitionToState(MenuState.GameStart);\n    }\n\n    /**\n     * Update menu text after changes\n     */\n    private updateNewGameMenuText(): void {\n        if (this.currentState !== MenuState.NewGame) return;\n        \n        const buttonUpdates = [\n            { id: 'player_name', text: `CAPTAIN NAME: ${this.newGameSettings.playerName}` },\n            { id: 'difficulty', text: `DIFFICULTY: ${this.newGameSettings.difficulty.toUpperCase()}` },\n            { id: 'galaxy_size', text: `GALAXY SIZE: ${this.newGameSettings.galaxySize.toUpperCase()}` },\n            { id: 'enemy_frequency', text: `HOSTILES: ${this.newGameSettings.enemyFrequency.toUpperCase()}` },\n            { id: 'permadeath', text: `PERMADEATH: ${this.newGameSettings.enablePermadeath ? 'ON' : 'OFF'}` },\n            { id: 'tutorial', text: `TUTORIAL: ${this.newGameSettings.enableTutorial ? 'ON' : 'OFF'}` }\n        ];\n        \n        buttonUpdates.forEach(update => {\n            const button = this.buttons.find(b => b.id === update.id);\n            if (button) button.text = update.text;\n        });\n    }\n\n    private updateSettingsMenuText(): void {\n        if (this.currentState !== MenuState.Settings) return;\n        \n        const buttonUpdates = [\n            { id: 'render_scale', text: `RENDER QUALITY: ${Math.round(this.gameSettings.renderScale * 100)}%` },\n            { id: 'master_volume', text: `MASTER VOLUME: ${Math.round(this.gameSettings.masterVolume * 100)}%` },\n            { id: 'music_volume', text: `MUSIC VOLUME: ${Math.round(this.gameSettings.musicVolume * 100)}%` },\n            { id: 'sfx_volume', text: `SFX VOLUME: ${Math.round(this.gameSettings.sfxVolume * 100)}%` },\n            { id: 'show_fps', text: `SHOW FPS: ${this.gameSettings.showFPS ? 'ON' : 'OFF'}` },\n            { id: 'vsync', text: `VSYNC: ${this.gameSettings.vsync ? 'ON' : 'OFF'}` }\n        ];\n        \n        buttonUpdates.forEach(update => {\n            const button = this.buttons.find(b => b.id === update.id);\n            if (button) button.text = update.text;\n        });\n    }\n\n    /**\n     * Utility methods\n     */\n    private getDefaultNewGameSettings(): NewGameSettings {\n        return {\n            playerName: 'COMMANDER',\n            difficulty: 'normal',\n            galaxySeed: Math.random().toString(36).substring(2, 8).toUpperCase(),\n            galaxySize: 'medium',\n            startingResources: 'standard',\n            enemyFrequency: 'normal',\n            enablePermadeath: false,\n            enableTutorial: true\n        };\n    }\n\n    private getDefaultGameSettings(): GameSettings {\n        return {\n            renderScale: 1.0,\n            vsync: true,\n            fullscreen: false,\n            masterVolume: 0.7,\n            musicVolume: 0.5,\n            sfxVolume: 0.8,\n            difficulty: 'normal' as const,\n            mouseSensitivity: 1.0,\n            showFPS: false,\n            autoSave: true,\n            autoSaveInterval: 300, // 5 minutes\n            colorblindMode: 'none',\n            subtitles: false,\n            reducedMotion: false,\n            keyBindings: {\n                forward: 'KeyW',\n                backward: 'KeyS',\n                left: 'KeyA',\n                right: 'KeyD',\n                fire: 'Space',\n                warp: 'KeyW'\n            }\n        };\n    }\n\n    private hasSaveGames(): boolean {\n        return this.saveSlots.some(slot => slot.exists);\n    }\n\n    private loadSaveSlots(): void {\n        // Mock save data for demo\n        this.saveSlots = [\n            {\n                slot: 1,\n                name: 'Captain Nova',\n                date: '2024-01-15',\n                playtime: '12h 34m',\n                level: 15,\n                system: 'Alpha Centauri',\n                exists: true\n            },\n            {\n                slot: 2,\n                name: 'Commander Rex',\n                date: '2024-01-10',\n                playtime: '8h 22m',\n                level: 8,\n                system: 'Sol System',\n                exists: true\n            },\n            {\n                slot: 3,\n                name: '',\n                date: '',\n                playtime: '',\n                level: 0,\n                system: '',\n                exists: false\n            }\n        ];\n    }\n\n    private saveSettings(): void {\n        try {\n            localStorage.setItem('gameSettings', JSON.stringify(this.gameSettings));\n            this.logger.info('⚙️ Settings saved');\n        } catch (error) {\n            this.logger.error('Failed to save settings', error);\n        }\n    }\n\n    private loadSettings(): void {\n        try {\n            const saved = localStorage.getItem('gameSettings');\n            if (saved) {\n                this.gameSettings = { ...this.getDefaultGameSettings(), ...JSON.parse(saved) };\n                this.logger.info('⚙️ Settings loaded');\n            }\n        } catch (error) {\n            this.logger.warn('Failed to load settings, using defaults', error);\n        }\n    }\n\n    /**\n     * Render menu system\n     */\n    render(renderer: Renderer): void {\n        // Clear screen with dark background\n        renderer.fillRect(0, 0, 800, 600, { r: 8, g: 8, b: 8 });\n        \n        // Apply screen flicker effect\n        if (this.screenFlicker > 0.03) {\n            const flickerAlpha = this.screenFlicker * 0.3;\n            renderer.fillRect(0, 0, 800, 600, { r: 16, g: 16, b: 16 });\n        }\n        \n        // Render current state\n        switch (this.currentState) {\n            case MenuState.MainMenu:\n                this.renderMainMenu(renderer);\n                break;\n            case MenuState.NewGame:\n                this.renderNewGameMenu(renderer);\n                break;\n            case MenuState.LoadGame:\n                this.renderLoadGameMenu(renderer);\n                break;\n            case MenuState.Settings:\n                this.renderSettingsMenu(renderer);\n                break;\n            case MenuState.GameStart:\n                this.renderGameStart(renderer);\n                break;\n        }\n        \n        // Render transition effect\n        if (this.isTransitioning) {\n            this.renderTransition(renderer);\n        }\n        \n        // Render particles\n        if (this.particles) {\n            this.particles.render(renderer);\n        }\n    }\n\n    /**\n     * Render main menu\n     */\n    private renderMainMenu(renderer: Renderer): void {\n        // Render title with glow effect\n        const titleColor = {\n            r: 72 + Math.floor(this.titleGlow * 24),\n            g: 48 + Math.floor(this.titleGlow * 16),\n            b: 12 + Math.floor(this.titleGlow * 8)\n        };\n        \n        this.renderText(renderer, 'VESMÍRNÝ PRŮZKUMNÍK', 400, 100, 'large', titleColor, 'center');\n        this.renderText(renderer, 'DOBRODRUŽSTVÍ V HLUBOKÉM VESMÍRU', 400, 140, 'medium', { r: 48, g: 48, b: 48 }, 'center');\n        \n        // Render version\n        this.renderText(renderer, 'v1.0.0 ALPHA', 780, 580, 'small', { r: 32, g: 32, b: 32 }, 'right');\n        \n        // Render buttons\n        this.renderButtons(renderer);\n        \n        // Render hotkey hints\n        if (this.currentState === MenuState.MainMenu) {\n            const hints = [\n                'N - Nová hra    L - Načíst hru    S - Nastavení    Q - Ukončit',\n                'Použijte ŠIPKY nebo WASD pro navigaci, ENTER pro výběr, ESC pro návrat'\n            ];\n            \n            hints.forEach((hint, index) => {\n                this.renderText(renderer, hint, 400, 520 + index * 20, 'small', { r: 24, g: 24, b: 24 }, 'center');\n            });\n        }\n    }\n\n    /**\n     * Render new game menu\n     */\n    private renderNewGameMenu(renderer: Renderer): void {\n        this.renderText(renderer, 'NEW MISSION SETUP', 400, 80, 'large', { r: 72, g: 48, b: 12 }, 'center');\n        \n        // Render buttons\n        this.renderButtons(renderer);\n        \n        // Render galaxy seed info\n        this.renderText(renderer, `GALAXY SEED: ${this.newGameSettings.galaxySeed}`, 400, 480, 'medium', { r: 48, g: 48, b: 48 }, 'center');\n        this.renderText(renderer, 'Press R to generate random seed', 400, 500, 'small', { r: 32, g: 32, b: 32 }, 'center');\n    }\n\n    /**\n     * Render load game menu\n     */\n    private renderLoadGameMenu(renderer: Renderer): void {\n        this.renderText(renderer, 'LOAD MISSION', 400, 80, 'large', { r: 72, g: 48, b: 12 }, 'center');\n        \n        // Render save slot details\n        for (let i = 0; i < this.saveSlots.length; i++) {\n            const slot = this.saveSlots[i];\n            const y = 150 + i * 70;\n            \n            if (slot.exists) {\n                // Render detailed save info\n                this.renderText(renderer, `SLOT ${slot.slot}: ${slot.name}`, 50, y, 'medium', { r: 48, g: 48, b: 48 }, 'left');\n                this.renderText(renderer, `Location: ${slot.system}`, 50, y + 20, 'small', { r: 32, g: 32, b: 32 }, 'left');\n                this.renderText(renderer, `Playtime: ${slot.playtime}`, 400, y + 20, 'small', { r: 32, g: 32, b: 32 }, 'left');\n                this.renderText(renderer, `Date: ${slot.date}`, 600, y + 20, 'small', { r: 32, g: 32, b: 32 }, 'left');\n            } else {\n                this.renderText(renderer, `SLOT ${slot.slot}: EMPTY`, 50, y, 'medium', { r: 24, g: 24, b: 24 }, 'left');\n            }\n        }\n        \n        // Render back button\n        this.renderButtons(renderer);\n    }\n\n    /**\n     * Render settings menu\n     */\n    private renderSettingsMenu(renderer: Renderer): void {\n        this.renderText(renderer, 'SYSTEM CONFIGURATION', 400, 80, 'large', { r: 72, g: 48, b: 12 }, 'center');\n        \n        // Render buttons\n        this.renderButtons(renderer);\n        \n        // Render instructions\n        this.renderText(renderer, 'Use LEFT/RIGHT arrows to adjust values', 400, 500, 'small', { r: 32, g: 32, b: 32 }, 'center');\n    }\n\n\n\n    /**\n     * Render game start loading\n     */\n    private renderGameStart(renderer: Renderer): void {\n        this.renderText(renderer, 'INITIALIZING STELLAR DRIVE...', 400, 250, 'large', { r: 72, g: 48, b: 12 }, 'center');\n        \n        // Animated loading bar\n        const progress = (this.animationTime % 3000) / 3000;\n        const barWidth = 400;\n        const barHeight = 20;\n        const barX = 400 - barWidth / 2;\n        const barY = 300;\n        \n        // Background\n        renderer.drawRect(barX, barY, barWidth, barHeight, { r: 32, g: 32, b: 32 });\n        \n        // Progress\n        const progressWidth = barWidth * progress;\n        renderer.fillRect(barX, barY, progressWidth, barHeight, { r: 72, g: 48, b: 12 });\n        \n        // Loading text\n        const loadingTexts = [\n            'Generating galaxy...',\n            'Calculating stellar positions...',\n            'Initializing quantum drive...',\n            'Loading mission parameters...',\n            'Calibrating sensors...',\n            'Establishing communications...',\n            'Mission ready!'\n        ];\n        \n        const textIndex = Math.floor(progress * loadingTexts.length);\n        const currentText = loadingTexts[Math.min(textIndex, loadingTexts.length - 1)];\n        \n        this.renderText(renderer, currentText, 400, 350, 'medium', { r: 48, g: 48, b: 48 }, 'center');\n        \n        // Auto-start game after loading\n        if (progress >= 0.95) {\n            setTimeout(() => this.events.onGameStart?.(), 500);\n        }\n    }\n\n    /**\n     * Render transition effect\n     */\n    private renderTransition(renderer: Renderer): void {\n        const alpha = this.transitionProgress < 0.5 ? \n            this.transitionProgress * 2 : \n            (1 - this.transitionProgress) * 2;\n        \n        // Screen wipe effect\n        const wipeHeight = 600 * alpha;\n        renderer.fillRect(0, 0, 800, wipeHeight, { r: 16, g: 16, b: 16 });\n        renderer.fillRect(0, 600 - wipeHeight, 800, wipeHeight, { r: 16, g: 16, b: 16 });\n    }\n\n    /**\n     * Render buttons\n     */\n    private renderButtons(renderer: Renderer): void {\n        for (const button of this.buttons) {\n            this.renderButton(renderer, button);\n        }\n    }\n\n    /**\n     * Render individual button\n     */\n    private renderButton(renderer: Renderer, button: MenuButton): void {\n        const color = button.highlighted ? \n            { r: 72, g: 48, b: 12 } : \n            button.enabled ? \n                { r: 48, g: 48, b: 48 } : \n                { r: 24, g: 24, b: 24 };\n        \n        // Button background (if highlighted)\n        if (button.highlighted) {\n            renderer.fillRect(button.x - 5, button.y - 5, button.width + 10, button.height + 10, { r: 16, g: 16, b: 16 });\n            renderer.drawRect(button.x - 5, button.y - 5, button.width + 10, button.height + 10, color);\n        }\n        \n        // Button text\n        this.renderText(renderer, button.text, button.x + button.width / 2, button.y + button.height / 2, 'medium', color, 'center');\n        \n        // Hotkey hint\n        if (button.hotkey && button.enabled) {\n            const hotkeyText = `[${button.hotkey.replace('Key', '')}]`;\n            this.renderText(renderer, hotkeyText, button.x + button.width + 10, button.y + button.height / 2, 'small', { r: 32, g: 32, b: 32 }, 'left');\n        }\n    }\n\n    /**\n     * Render text with retro styling\n     */\n    private renderText(\n        renderer: Renderer, \n        text: string, \n        x: number, \n        y: number, \n        size: 'small' | 'medium' | 'large', \n        color: Color, \n        align: 'left' | 'center' | 'right'\n    ): void {\n        const fontSize = size === 'small' ? 12 : size === 'medium' ? 16 : 24;\n        \n        // Simple text rendering for now - would use proper font rendering in full implementation\n        let textX = x;\n        if (align === 'center') {\n            textX = x - (text.length * fontSize * 0.3);\n        } else if (align === 'right') {\n            textX = x - (text.length * fontSize * 0.6);\n        }\n        \n        // Draw text as rectangles (simplified implementation)\n        for (let i = 0; i < text.length; i++) {\n            const charX = textX + i * fontSize * 0.6;\n            \n            if (text[i] !== ' ') {\n                renderer.fillRect(charX, y - fontSize / 2, fontSize * 0.5, fontSize, color);\n            }\n        }\n    }\n\n    /**\n     * Get current menu state\n     */\n    getCurrentState(): MenuState {\n        return this.currentState;\n    }\n\n    /**\n     * Get current settings\n     */\n    getGameSettings(): GameSettings {\n        return { ...this.gameSettings };\n    }\n\n    /**\n     * Set new game settings externally\n     */\n    setNewGameSettings(settings: Partial<NewGameSettings>): void {\n        Object.assign(this.newGameSettings, settings);\n        if (this.currentState === MenuState.NewGame) {\n            this.updateNewGameMenuText();\n        }\n    }\n\n    /**\n     * Dispose menu system\n     */\n    dispose(): void {\n        // Clean up background particles\n        if (this.particles) {\n            this.backgroundParticles.forEach(id => {\n                this.particles!.removeEmitter(id);\n            });\n        }\n        \n        this.logger.info('🎮 Main menu system disposed');\n    }\n}","/**\n * Game State Manager\n * Handles different game states and manages transitions with save/load functionality\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer } from '@core/Renderer';\nimport { PhysicsObject } from '@core/Physics';\nimport { Vector2 } from '@core/Renderer';\nimport { MainMenu, MenuEvents, NewGameSettings, GameSettings } from '@ui/MainMenu';\nimport { InputManager } from '@core/InputManager';\nimport { ProceduralAudio } from '@audio/ProceduralAudio';\nimport { ParticleSystem } from '@effects/ParticleSystem';\n\nexport enum GameState {\n    MainMenu = 'main_menu',\n    Loading = 'loading',\n    Playing = 'playing',\n    Paused = 'paused',\n    Inventory = 'inventory',\n    Research = 'research',\n    Navigation = 'navigation',\n    Diplomacy = 'diplomacy',\n    Settings = 'settings',\n    Credits = 'credits',\n    NewGame = 'new_game',\n    LoadGame = 'load_game',\n    Error = 'error'\n}\n\nexport interface GameData {\n    // Player data\n    playerShip: {\n        id: string;\n        position: Vector2;\n        velocity: Vector2;\n        health: number;\n        fuel: number;\n        resources: Map<string, number>;\n    };\n    \n    // Current location\n    currentSystem: {\n        id: string;\n        name: string;\n        type: 'star_system' | 'interstellar_space';\n    };\n    \n    // Game progress\n    gameTime: number;\n    level: number;\n    experience: number;\n    discoveries: string[];\n    technologies: string[];\n    \n    // Settings\n    settings: {\n        masterVolume: number;\n        musicVolume: number;\n        sfxVolume: number;\n        difficulty: 'easy' | 'normal' | 'hard';\n    };\n    \n    // Statistics\n    stats: {\n        timePlayedSeconds: number;\n        systemsVisited: number;\n        aliensEncountered: number;\n        battlesWon: number;\n        resourcesCollected: number;\n    };\n}\n\nexport interface StateTransition {\n    from: GameState;\n    to: GameState;\n    condition?: () => boolean;\n    action?: () => void;\n}\n\nexport class GameStateManager {\n    private currentState: GameState = GameState.MainMenu;\n    private previousState: GameState = GameState.MainMenu;\n    private gameData: GameData;\n    \n    // State management\n    private stateStack: GameState[] = [];\n    private transitions: Map<string, StateTransition> = new Map();\n    private stateStartTime: number = Date.now();\n    \n    // Menu system\n    private mainMenu: MainMenu | null = null;\n    \n    // Demo entities for FÁZE 1\n    private demoShip: PhysicsObject | null = null;\n    private demoPlanets: PhysicsObject[] = [];\n    \n    private logger: Logger;\n    private isInitialized = false;\n    private saveInterval = 30000; // Auto-save every 30 seconds\n\n    constructor(audio?: ProceduralAudio, particles?: ParticleSystem) {\n        this.logger = new Logger('GameStateManager');\n        \n        // Initialize default game data\n        this.gameData = this.createDefaultGameData();\n        \n        // Initialize menu system\n        this.initializeMenuSystem(audio, particles);\n        \n        // Setup state transitions\n        this.setupStateTransitions();\n        \n        this.logger.info('🎯 Game state manager created');\n    }\n\n    /**\n     * Initialize menu system\n     */\n    private initializeMenuSystem(audio?: ProceduralAudio, particles?: ParticleSystem): void {\n        const menuEvents: MenuEvents = {\n            onNewGame: async (settings: NewGameSettings) => {\n                await this.handleNewGame(settings);\n            },\n            onLoadGame: async (saveSlot: number) => {\n                await this.handleLoadGame(saveSlot);\n            },\n            onSettings: (settings: GameSettings) => {\n                this.handleSettingsChange(settings);\n            },\n            onExit: () => {\n                this.handleExit();\n            },\n            onGameStart: async () => {\n                await this.setState(GameState.Playing);\n            }\n        };\n        \n        this.mainMenu = new MainMenu(menuEvents, audio, particles);\n        this.logger.info('🎮 Menu system initialized');\n    }\n\n    /**\n     * Initialize the game state manager\n     */\n    async initialize(): Promise<void> {\n        this.logger.info('🔧 Initializing game state manager...');\n        \n        try {\n            // Try to load existing save data, fallback to defaults if none exists\n            try {\n                await this.loadGameData();\n                this.logger.info('Existing save data loaded');\n            } catch (error) {\n                this.logger.info('No existing save data found, creating new game data');\n                this.gameData = this.createDefaultGameData();\n            }\n            \n            // Setup demo content for FÁZE 1\n            this.setupDemoContent();\n            \n            this.isInitialized = true;\n            this.logger.info('✅ Game state manager initialized');\n            \n        } catch (error) {\n            this.logger.error('❌ Game state manager initialization failed', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Create default game data\n     */\n    private createDefaultGameData(): GameData {\n        return {\n            playerShip: {\n                id: 'player_ship',\n                position: { x: 512, y: 384 }, // Center of 1024x768 screen\n                velocity: { x: 0, y: 0 },\n                health: 100,\n                fuel: 1000,\n                resources: new Map([\n                    ['credits', 1000],\n                    ['fuel', 1000],\n                    ['metal', 50],\n                    ['crystals', 10]\n                ])\n            },\n            currentSystem: {\n                id: 'sol_system',\n                name: 'Sol System',\n                type: 'star_system'\n            },\n            gameTime: 0,\n            level: 1,\n            experience: 0,\n            discoveries: [],\n            technologies: ['basic_engines', 'basic_weapons'],\n            settings: {\n                masterVolume: 1.0,\n                musicVolume: 0.7,\n                sfxVolume: 0.8,\n                difficulty: 'normal'\n            },\n            stats: {\n                timePlayedSeconds: 0,\n                systemsVisited: 1,\n                aliensEncountered: 0,\n                battlesWon: 0,\n                resourcesCollected: 0\n            }\n        };\n    }\n\n    /**\n     * Setup state transitions\n     */\n    private setupStateTransitions(): void {\n        // Loading → MainMenu\n        this.addTransition(GameState.Loading, GameState.MainMenu);\n        \n        // MainMenu ↔ Playing\n        this.addTransition(GameState.MainMenu, GameState.Playing);\n        this.addTransition(GameState.Playing, GameState.MainMenu);\n        \n        // Playing ↔ Paused\n        this.addTransition(GameState.Playing, GameState.Paused);\n        this.addTransition(GameState.Paused, GameState.Playing);\n        \n        // Playing → Sub-states\n        this.addTransition(GameState.Playing, GameState.Inventory);\n        this.addTransition(GameState.Playing, GameState.Research);\n        this.addTransition(GameState.Playing, GameState.Navigation);\n        this.addTransition(GameState.Playing, GameState.Diplomacy);\n        \n        // Sub-states → Playing\n        this.addTransition(GameState.Inventory, GameState.Playing);\n        this.addTransition(GameState.Research, GameState.Playing);\n        this.addTransition(GameState.Navigation, GameState.Playing);\n        this.addTransition(GameState.Diplomacy, GameState.Playing);\n        \n        // Error state\n        this.addTransition(GameState.Playing, GameState.Error);\n        this.addTransition(GameState.Error, GameState.MainMenu);\n        \n        this.logger.debug('State transitions configured');\n    }\n\n    /**\n     * Add a state transition\n     */\n    private addTransition(from: GameState, to: GameState, condition?: () => boolean, action?: () => void): void {\n        const key = `${from}->${to}`;\n        this.transitions.set(key, { from, to, condition, action });\n    }\n\n    /**\n     * Setup demo content for FÁZE 1\n     */\n    private setupDemoContent(): void {\n        // Demo content will be created when needed\n        // This is just initialization\n        this.logger.debug('Demo content setup prepared');\n    }\n\n    /**\n     * Set the current game state\n     */\n    async setState(newState: GameState): Promise<void> {\n        const transitionKey = `${this.currentState}->${newState}`;\n        const transition = this.transitions.get(transitionKey);\n        \n        if (!transition) {\n            this.logger.warn(`Invalid state transition: ${this.currentState} → ${newState}`);\n            return;\n        }\n        \n        // Check transition condition\n        if (transition.condition && !transition.condition()) {\n            this.logger.debug(`Transition condition not met: ${transitionKey}`);\n            return;\n        }\n        \n        this.logger.info(`State transition: ${this.currentState} → ${newState}`);\n        \n        // Save previous state\n        this.previousState = this.currentState;\n        \n        // Execute transition action\n        if (transition.action) {\n            transition.action();\n        }\n        \n        // Update state\n        this.currentState = newState;\n        \n        // Handle state-specific initialization\n        await this.onStateEnter(newState);\n    }\n\n    /**\n     * Push state onto stack (for modal states)\n     */\n    pushState(newState: GameState): void {\n        this.stateStack.push(this.currentState);\n        this.currentState = newState;\n        this.logger.debug(`Pushed state: ${newState} (stack depth: ${this.stateStack.length})`);\n    }\n\n    /**\n     * Pop state from stack\n     */\n    popState(): GameState | null {\n        if (this.stateStack.length === 0) {\n            this.logger.warn('Cannot pop state: stack is empty');\n            return null;\n        }\n        \n        const poppedState = this.currentState;\n        this.currentState = this.stateStack.pop()!;\n        this.logger.debug(`Popped state: ${poppedState} → ${this.currentState}`);\n        \n        return poppedState;\n    }\n\n    /**\n     * Handle state enter events\n     */\n    private async onStateEnter(state: GameState): Promise<void> {\n        switch (state) {\n            case GameState.Playing:\n                // Start game time tracking\n                this.startGameTimeTracking();\n                break;\n                \n            case GameState.Paused:\n                // Pause game time tracking\n                this.pauseGameTimeTracking();\n                break;\n                \n            case GameState.MainMenu:\n                // Auto-save when returning to menu\n                await this.save();\n                break;\n                \n            case GameState.Error:\n                // Log error state entry\n                this.logger.error('Entered error state');\n                break;\n        }\n    }\n\n    /**\n     * Update the game state manager\n     */\n    update(deltaTime: number, input?: InputManager): void {\n        if (!this.isInitialized) return;\n        \n        // Update game time\n        if (this.currentState === GameState.Playing) {\n            this.gameData.gameTime += deltaTime;\n            this.gameData.stats.timePlayedSeconds += deltaTime;\n        }\n        \n        // State-specific updates\n        switch (this.currentState) {\n            case GameState.MainMenu:\n            case GameState.NewGame:\n            case GameState.LoadGame:\n            case GameState.Settings:\n            case GameState.Credits:\n                if (this.mainMenu && input) {\n                    this.mainMenu.update(deltaTime, input);\n                }\n                break;\n                \n            case GameState.Playing:\n                this.updatePlayingState(deltaTime);\n                break;\n                \n            case GameState.Loading:\n                this.updateLoadingState(deltaTime);\n                break;\n        }\n    }\n\n    /**\n     * Update playing state\n     */\n    private updatePlayingState(deltaTime: number): void {\n        // Update player ship position in game data\n        if (this.demoShip) {\n            this.gameData.playerShip.position = { ...this.demoShip.position };\n            this.gameData.playerShip.velocity = { ...this.demoShip.velocity };\n            \n            // Update ship health if damaged\n            if (this.demoShip.health !== undefined) {\n                this.gameData.playerShip.health = this.demoShip.health;\n            }\n        }\n    }\n\n    /**\n     * Update loading state\n     */\n    private updateLoadingState(deltaTime: number): void {\n        // Simulate loading time\n        const loadingTime = Date.now() - this.stateStartTime;\n        \n        if (loadingTime > 2000) { // 2 seconds loading time\n            this.setState(GameState.Playing).catch(error => {\n                this.logger.error('Failed to transition to playing state', error);\n            });\n        }\n    }\n\n    /**\n     * Render the current game state\n     */\n    render(renderer: Renderer): void {\n        if (!this.isInitialized) {\n            this.renderLoadingState(renderer);\n            return;\n        }\n        \n        switch (this.currentState) {\n            case GameState.MainMenu:\n            case GameState.NewGame:\n            case GameState.LoadGame:\n            case GameState.Settings:\n            case GameState.Credits:\n                if (this.mainMenu) {\n                    this.mainMenu.render(renderer);\n                }\n                break;\n                \n            case GameState.Loading:\n                this.renderLoadingState(renderer);\n                break;\n                \n            case GameState.Playing:\n                this.renderPlayingState(renderer);\n                break;\n                \n            case GameState.Paused:\n                this.renderPausedState(renderer);\n                break;\n                \n            case GameState.Error:\n                this.renderErrorState(renderer);\n                break;\n                \n            default:\n                this.renderDefaultState(renderer);\n        }\n    }\n\n    /**\n     * Render loading state\n     */\n    private renderLoadingState(renderer: Renderer): void {\n        const centerX = 512;\n        const centerY = 384;\n        \n        renderer.renderText('INITIALIZING SPACE EXPLORER...', centerX - 150, centerY - 50, \n            { r: 192, g: 192, b: 192 }, 16);\n        \n        // Animated loading dots\n        const dots = '.'.repeat((Math.floor(Date.now() / 500) % 4));\n        renderer.renderText(`LOADING${dots}`, centerX - 50, centerY, \n            { r: 128, g: 128, b: 128 }, 14);\n    }\n\n    /**\n     * Render menu state\n     */\n    private renderMenuState(renderer: Renderer): void {\n        const centerX = 512;\n        const centerY = 384;\n        \n        // Render background image (Image 3)\n        this.renderMenuBackground(renderer);\n        \n        // Title\n        renderer.renderText('SPACE EXPLORER 16-BIT', centerX - 140, centerY - 100, \n            { r: 255, g: 255, b: 255 }, 20);\n        \n        // Menu options\n        const menuItems = [\n            'CONTINUE EXPLORATION',\n            'NEW EXPEDITION',\n            'SETTINGS',\n            'EXIT'\n        ];\n        \n        menuItems.forEach((item, index) => {\n            const y = centerY - 20 + index * 30;\n            const color = index === 0 ? { r: 255, g: 255, b: 255 } : { r: 192, g: 192, b: 192 };\n            renderer.renderText(item, centerX - 80, y, color, 14);\n        });\n        \n        // Instructions\n        renderer.renderText('USE ARROW KEYS TO NAVIGATE, ENTER TO SELECT', \n            centerX - 180, centerY + 150, { r: 128, g: 128, b: 128 }, 12);\n    }\n\n    /**\n     * Render playing state\n     */\n    private renderPlayingState(renderer: Renderer): void {\n        // Render space background\n        this.renderSpaceBackground(renderer);\n        \n        // Render demo ship if available\n        if (this.demoShip) {\n            const shipSprite = renderer.generateShipSprite('player', 32);\n            renderer.drawSprite(shipSprite, this.demoShip.position.x - 16, this.demoShip.position.y - 16);\n        }\n        \n        // Render demo planets\n        this.demoPlanets.forEach(planet => {\n            renderer.drawCircle(planet.position.x, planet.position.y, planet.radius, \n                { r: 64, g: 128, b: 192 }, true);\n        });\n        \n        // Render basic HUD\n        this.renderBasicHUD(renderer);\n    }\n\n    /**\n     * Render paused state\n     */\n    private renderPausedState(renderer: Renderer): void {\n        // Render playing state first\n        this.renderPlayingState(renderer);\n        \n        // Overlay pause menu\n        const centerX = 512;\n        const centerY = 384;\n        \n        // Semi-transparent background\n        renderer.fillRect(centerX - 100, centerY - 50, 200, 100, { r: 0, g: 0, b: 0, a: 128 });\n        \n        // Pause text\n        renderer.renderText('GAME PAUSED', centerX - 60, centerY - 20, \n            { r: 255, g: 255, b: 0 }, 16);\n        \n        renderer.renderText('PRESS ESC TO RESUME', centerX - 80, centerY + 10, \n            { r: 0, g: 192, b: 0 }, 12);\n    }\n\n    /**\n     * Render error state\n     */\n    private renderErrorState(renderer: Renderer): void {\n        const centerX = 512;\n        const centerY = 384;\n        \n        // Error background\n        renderer.fillRect(0, 0, 1024, 768, { r: 64, g: 0, b: 0 });\n        \n        // Error message\n        renderer.renderText('SYSTEM ERROR', centerX - 60, centerY - 50, \n            { r: 255, g: 0, b: 0 }, 20);\n        \n        renderer.renderText('CRITICAL SYSTEM FAILURE DETECTED', centerX - 140, centerY - 10, \n            { r: 255, g: 64, b: 64 }, 14);\n        \n        renderer.renderText('PRESS ENTER TO RETURN TO MAIN MENU', centerX - 160, centerY + 30, \n            { r: 192, g: 192, b: 192 }, 12);\n    }\n\n    /**\n     * Render default state\n     */\n    private renderDefaultState(renderer: Renderer): void {\n        const centerX = 512;\n        const centerY = 384;\n        \n        renderer.renderText(`UNKNOWN STATE: ${this.currentState}`, centerX - 100, centerY, \n            { r: 255, g: 0, b: 255 }, 16);\n    }\n\n    /**\n     * Render space background\n     */\n    private renderSpaceBackground(renderer: Renderer): void {\n        // Simple star field\n        for (let i = 0; i < 100; i++) {\n            const x = (i * 73) % 1024; // Pseudo-random distribution\n            const y = (i * 149) % 768;\n            const brightness = (i % 3) + 1;\n            const color = { \n                r: brightness * 64, \n                g: brightness * 64, \n                b: brightness * 96 \n            };\n            \n            renderer.setPixel(x, y, color);\n        }\n    }\n\n    /**\n     * Render menu background (Image 3)\n     */\n    private renderMenuBackground(renderer: Renderer): void {\n        // Image 3 as base64 (cockpit view with galaxy)\n        const menuBgData = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABQAGQDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD3+iiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//9k=';\n        \n        // For now, we'll draw a simple gradient background\n        // In a real implementation, you'd decode and render the base64 image\n        for (let y = 0; y < 768; y++) {\n            for (let x = 0; x < 1024; x++) {\n                // Create a dark space gradient from top to bottom\n                const gradient = Math.floor((y / 768) * 64);\n                const color = {\n                    r: gradient / 4,\n                    g: gradient / 3,\n                    b: gradient\n                };\n                renderer.setPixel(x, y, color);\n            }\n        }\n        \n        // Add some stars\n        for (let i = 0; i < 200; i++) {\n            const x = (i * 73) % 1024;\n            const y = (i * 149) % 768;\n            const brightness = (i % 4) + 1;\n            const color = { \n                r: brightness * 48, \n                g: brightness * 48, \n                b: brightness * 64 \n            };\n            \n            renderer.setPixel(x, y, color);\n            \n            // Add twinkling effect for some stars\n            if (i % 7 === 0) {\n                const twinkle = Math.sin(Date.now() / 1000 + i) * 32 + 32;\n                const twinkleColor = {\n                    r: twinkle,\n                    g: twinkle * 0.8,\n                    b: twinkle * 1.2\n                };\n                renderer.setPixel(x, y, twinkleColor);\n            }\n        }\n        \n        // Add galaxy band across the middle\n        for (let x = 0; x < 1024; x++) {\n            for (let y = 300; y < 468; y++) {\n                const distance = Math.abs(y - 384);\n                const intensity = Math.max(0, 168 - distance) / 168;\n                const color = {\n                    r: intensity * 48,\n                    g: intensity * 32,\n                    b: intensity * 64\n                };\n                if (intensity > 0.1) {\n                    renderer.setPixel(x, y, color);\n                }\n            }\n        }\n    }\n\n    /**\n     * Render basic HUD\n     */\n    private renderBasicHUD(renderer: Renderer): void {\n        // Ship status\n        const health = this.gameData.playerShip.health;\n        const fuel = this.gameData.playerShip.fuel;\n        \n        renderer.renderText(`HEALTH: ${health.toFixed(0)}%`, 10, 10, \n            health > 50 ? { r: 0, g: 255, b: 0 } : { r: 255, g: 0, b: 0 }, 12);\n        \n        renderer.renderText(`FUEL: ${fuel.toFixed(0)}`, 10, 30, \n            fuel > 200 ? { r: 0, g: 255, b: 0 } : { r: 255, g: 255, b: 0 }, 12);\n        \n        // Resources\n        renderer.renderText(`CREDITS: ${this.gameData.playerShip.resources.get('credits') || 0}`, \n            10, 50, { r: 255, g: 255, b: 0 }, 12);\n        \n        // Game time\n        const minutes = Math.floor(this.gameData.gameTime / 60);\n        const seconds = Math.floor(this.gameData.gameTime % 60);\n        renderer.renderText(`TIME: ${minutes}:${seconds.toString().padStart(2, '0')}`, \n            10, 70, { r: 0, g: 192, b: 192 }, 12);\n        \n        // Galaxy info (if available)\n        renderer.renderText(`SYSTEM: ${this.gameData.currentSystem.name}`, \n            10, 90, { r: 0, g: 255, b: 255 }, 12);\n        \n        // Galaxy exploration progress\n        renderer.renderText(`EXPLORATION: ${(this.gameData.stats.systemsVisited || 0)} systems`, \n            10, 110, { r: 192, g: 192, b: 192 }, 12);\n    }\n\n    /**\n     * Game time tracking\n     */\n    private gameTimeStarted = false;\n    \n    private startGameTimeTracking(): void {\n        this.gameTimeStarted = true;\n        this.logger.debug('Game time tracking started');\n    }\n    \n    private pauseGameTimeTracking(): void {\n        this.gameTimeStarted = false;\n        this.logger.debug('Game time tracking paused');\n    }\n\n    /**\n     * Save game data\n     */\n    async save(): Promise<void> {\n        try {\n            const saveData = {\n                version: '1.0.0',\n                timestamp: Date.now(),\n                gameData: this.gameData\n            };\n            \n            const serialized = JSON.stringify(saveData);\n            localStorage.setItem('spaceExplorer_save', serialized);\n            \n            this.logger.debug('Game saved successfully');\n            \n        } catch (error) {\n            this.logger.error('Failed to save game', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Load game data\n     */\n    async load(): Promise<void> {\n        try {\n            await this.loadGameData();\n            this.logger.info('Game loaded successfully');\n            \n        } catch (error) {\n            this.logger.warn('Failed to load game, using defaults', error);\n            this.gameData = this.createDefaultGameData();\n        }\n    }\n\n    /**\n     * Load game data from storage\n     */\n    private async loadGameData(): Promise<void> {\n        const saved = localStorage.getItem('spaceExplorer_save');\n        if (!saved) {\n            throw new Error('No save data found');\n        }\n        \n        const saveData = JSON.parse(saved);\n        \n        // Validate save data\n        if (!saveData.gameData) {\n            throw new Error('Invalid save data format');\n        }\n        \n        // Restore resources as Map\n        if (saveData.gameData.playerShip.resources) {\n            const resourcesArray = saveData.gameData.playerShip.resources;\n            if (Array.isArray(resourcesArray)) {\n                saveData.gameData.playerShip.resources = new Map(resourcesArray);\n            } else {\n                // Convert object to Map\n                saveData.gameData.playerShip.resources = new Map(Object.entries(resourcesArray));\n            }\n        }\n        \n        this.gameData = saveData.gameData;\n        this.logger.debug('Game data loaded from storage');\n    }\n\n    /**\n     * Handle menu events\n     */\n    private async handleNewGame(settings: NewGameSettings): Promise<void> {\n        this.logger.info('🆕 Starting new game', settings);\n        \n        // Apply new game settings\n        this.gameData = this.createDefaultGameData();\n        this.gameData.playerShip.id = `ship_${settings.playerName.toLowerCase()}`;\n        \n        // Apply difficulty settings\n        switch (settings.difficulty) {\n            case 'easy':\n                this.gameData.playerShip.health = 150;\n                this.gameData.playerShip.fuel = 200;\n                break;\n            case 'hard':\n                this.gameData.playerShip.health = 75;\n                this.gameData.playerShip.fuel = 100;\n                break;\n            case 'nightmare':\n                this.gameData.playerShip.health = 50;\n                this.gameData.playerShip.fuel = 75;\n                break;\n            default: // normal\n                this.gameData.playerShip.health = 100;\n                this.gameData.playerShip.fuel = 150;\n        }\n        \n        // Set galaxy settings\n        this.gameData.currentSystem.name = `Galaxy_${settings.galaxySeed}`;\n        \n        await this.setState(GameState.Loading);\n    }\n    \n    private async handleLoadGame(saveSlot: number): Promise<void> {\n        this.logger.info(`📁 Loading game from slot ${saveSlot}`);\n        \n        try {\n            const saveKey = `stellarOdyssey_save_${saveSlot}`;\n            const saveData = localStorage.getItem(saveKey);\n            \n            if (saveData) {\n                this.gameData = JSON.parse(saveData);\n                await this.setState(GameState.Loading);\n            } else {\n                this.logger.warn('Save slot is empty');\n            }\n        } catch (error) {\n            this.logger.error('Failed to load game', error);\n        }\n    }\n    \n    private handleSettingsChange(settings: GameSettings): void {\n        this.logger.info('⚙️ Applying settings', settings);\n        \n        // Update game data settings\n        this.gameData.settings = {\n            masterVolume: settings.masterVolume,\n            musicVolume: settings.musicVolume,\n            sfxVolume: settings.sfxVolume,\n            difficulty: settings.difficulty || 'normal'\n        };\n        \n        // Save settings\n        try {\n            localStorage.setItem('stellarOdyssey_settings', JSON.stringify(settings));\n        } catch (error) {\n            this.logger.error('Failed to save settings', error);\n        }\n    }\n    \n    private async handleExit(): Promise<void> {\n        this.logger.info('👋 Exiting game');\n        \n        // Save current game state\n        await this.save();\n        \n        // Close game or minimize window\n        if ('close' in window) {\n            (window as any).close();\n        }\n    }\n\n    /**\n     * Public getters\n     */\n    getCurrentState(): GameState {\n        return this.currentState;\n    }\n\n    getPreviousState(): GameState {\n        return this.previousState;\n    }\n\n    getGameData(): GameData {\n        return this.gameData;\n    }\n\n    isInState(state: GameState): boolean {\n        return this.currentState === state;\n    }\n\n    /**\n     * Set demo entities for rendering\n     */\n    setDemoShip(ship: PhysicsObject): void {\n        this.demoShip = ship;\n    }\n\n    setDemoPlanets(planets: PhysicsObject[]): void {\n        this.demoPlanets = [...planets];\n    }\n\n    /**\n     * Game state checks\n     */\n    canPause(): boolean {\n        return this.currentState === GameState.Playing;\n    }\n\n    canResume(): boolean {\n        return this.currentState === GameState.Paused;\n    }\n\n    isGameActive(): boolean {\n        return this.currentState === GameState.Playing;\n    }\n    \n\n\n    isInMenu(): boolean {\n        return this.currentState === GameState.MainMenu;\n    }\n\n    /**\n     * Cleanup\n     */\n    cleanup(): void {\n        // Save game before cleanup\n        this.save().catch(error => {\n            this.logger.error('Failed to save during cleanup', error);\n        });\n        \n        this.logger.info('🧹 Game state manager cleanup completed');\n    }\n}","/**\n * Ship Systems Manager\n * Handles all ship subsystems including engines, shields, weapons, life support, and damage\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2 } from '@core/Renderer';\n\nexport interface ShipSystemsConfig {\n    maxHull: number;\n    maxShields: number;\n    maxPower: number;\n    maxFuel: number;\n    maxHeat: number;\n    \n    // Engine configuration\n    enginePower: number;\n    engineEfficiency: number;\n    \n    // Shield configuration\n    shieldRegenRate: number;\n    shieldPowerDrain: number;\n    \n    // Weapon configuration\n    weaponCount: number;\n    weaponPower: number;\n    weaponHeatGeneration: number;\n}\n\nexport interface SystemStatus {\n    hull: number;           // 0-100%\n    shields: number;        // 0-100%\n    power: number;          // 0-100%\n    fuel: number;           // 0-100%\n    heat: number;           // 0-100%\n    \n    // System states\n    enginesOnline: boolean;\n    shieldsOnline: boolean;\n    weaponsOnline: boolean;\n    lifeSupport: boolean;\n    warpDrive: boolean;\n    \n    // Performance modifiers\n    engineEfficiency: number;  // 0-1\n    shieldStrength: number;    // 0-1\n    weaponAccuracy: number;    // 0-1\n    sensorRange: number;       // 0-1\n}\n\nexport interface DamageReport {\n    section: ShipSection;\n    severity: DamageSeverity;\n    systemsAffected: SystemType[];\n    repairCost: RepairCost;\n    repairTime: number; // seconds\n}\n\nexport interface RepairCost {\n    metal: number;\n    electronics: number;\n    crystals: number;\n    nanobots?: number;\n}\n\nexport enum ShipSection {\n    Bow = 'bow',\n    Stern = 'stern',\n    Port = 'port',\n    Starboard = 'starboard',\n    Core = 'core',\n    Bridge = 'bridge',\n    Engineering = 'engineering',\n    Weapons = 'weapons'\n}\n\nexport enum SystemType {\n    Engines = 'engines',\n    Shields = 'shields',\n    Weapons = 'weapons',\n    LifeSupport = 'life_support',\n    Sensors = 'sensors',\n    Navigation = 'navigation',\n    Communications = 'communications',\n    WarpDrive = 'warp_drive'\n}\n\nexport enum DamageSeverity {\n    Minor = 'minor',       // 0-25% damage\n    Moderate = 'moderate', // 25-50% damage\n    Major = 'major',       // 50-75% damage\n    Critical = 'critical', // 75-100% damage\n    Destroyed = 'destroyed' // 100% damage\n}\n\nexport interface PowerAllocation {\n    engines: number;    // 0-100%\n    shields: number;    // 0-100%\n    weapons: number;    // 0-100%\n    lifeSupport: number; // 0-100%\n    sensors: number;    // 0-100%\n}\n\nexport interface ShipSystemsEvents {\n    onSystemDamage: (system: SystemType, severity: DamageSeverity) => void;\n    onSystemRepaired: (system: SystemType) => void;\n    onCriticalDamage: (section: ShipSection) => void;\n    onPowerFailure: () => void;\n    onOverheat: () => void;\n}\n\nexport class ShipSystems {\n    private config: ShipSystemsConfig;\n    private status: SystemStatus;\n    private damage: Map<ShipSection, DamageReport[]> = new Map();\n    private powerAllocation: PowerAllocation;\n    \n    // System performance tracking\n    private heatGeneration: number = 0;\n    private powerConsumption: number = 0;\n    private fuelConsumption: number = 0;\n    \n    // Timers and intervals\n    private updateTimer: number = 0;\n    private lastUpdateTime: number = 0;\n    \n    // Events\n    private events: Partial<ShipSystemsEvents> = {};\n    \n    private logger: Logger;\n\n    constructor(config: Partial<ShipSystemsConfig> = {}, events: Partial<ShipSystemsEvents> = {}) {\n        this.logger = new Logger('ShipSystems');\n        this.events = events;\n        \n        // Default configuration\n        this.config = {\n            maxHull: 100,\n            maxShields: 100,\n            maxPower: 100,\n            maxFuel: 1000,\n            maxHeat: 100,\n            enginePower: 5000,\n            engineEfficiency: 0.8,\n            shieldRegenRate: 2.0,\n            shieldPowerDrain: 5.0,\n            weaponCount: 2,\n            weaponPower: 25,\n            weaponHeatGeneration: 15,\n            ...config\n        };\n        \n        // Initialize status\n        this.status = {\n            hull: 100,\n            shields: 100,\n            power: 100,\n            fuel: 100,\n            heat: 0,\n            enginesOnline: true,\n            shieldsOnline: true,\n            weaponsOnline: true,\n            lifeSupport: true,\n            warpDrive: true,\n            engineEfficiency: 1.0,\n            shieldStrength: 1.0,\n            weaponAccuracy: 1.0,\n            sensorRange: 1.0\n        };\n        \n        // Initialize power allocation\n        this.powerAllocation = {\n            engines: 30,\n            shields: 25,\n            weapons: 20,\n            lifeSupport: 15,\n            sensors: 10\n        };\n        \n        // Initialize damage tracking for all sections\n        Object.values(ShipSection).forEach(section => {\n            this.damage.set(section, []);\n        });\n        \n        this.logger.info('🛸 Ship systems initialized', {\n            config: this.config,\n            status: this.status\n        });\n    }\n\n    /**\n     * Update ship systems (called each frame)\n     */\n    update(deltaTime: number): void {\n        this.lastUpdateTime = deltaTime;\n        \n        // Update power consumption\n        this.updatePowerConsumption();\n        \n        // Update heat generation and cooling\n        this.updateThermalManagement(deltaTime);\n        \n        // Update shields\n        this.updateShields(deltaTime);\n        \n        // Update fuel consumption\n        this.updateFuelConsumption(deltaTime);\n        \n        // Update system efficiency based on damage\n        this.updateSystemEfficiency();\n        \n        // Check for critical system failures\n        this.checkCriticalSystems();\n        \n        // Update performance modifiers\n        this.updatePerformanceModifiers();\n    }\n\n    /**\n     * Update power consumption based on active systems\n     */\n    private updatePowerConsumption(): void {\n        let totalConsumption = 0;\n        \n        // Base life support always consumes power\n        totalConsumption += (this.powerAllocation.lifeSupport / 100) * 10;\n        \n        // Engine power consumption\n        if (this.status.enginesOnline) {\n            totalConsumption += (this.powerAllocation.engines / 100) * 20;\n        }\n        \n        // Shield power consumption\n        if (this.status.shieldsOnline) {\n            totalConsumption += (this.powerAllocation.shields / 100) * this.config.shieldPowerDrain;\n        }\n        \n        // Weapon power consumption\n        if (this.status.weaponsOnline) {\n            totalConsumption += (this.powerAllocation.weapons / 100) * 15;\n        }\n        \n        // Sensor power consumption\n        totalConsumption += (this.powerAllocation.sensors / 100) * 5;\n        \n        this.powerConsumption = totalConsumption;\n        \n        // Drain power\n        this.status.power = Math.max(0, this.status.power - (totalConsumption * this.lastUpdateTime));\n        \n        // Auto-shutdown systems if power critical\n        if (this.status.power < 10) {\n            this.handlePowerFailure();\n        }\n    }\n\n    /**\n     * Update thermal management (heat generation and cooling)\n     */\n    private updateThermalManagement(deltaTime: number): void {\n        // Heat generation\n        this.heatGeneration = 0;\n        \n        // Engine heat\n        if (this.status.enginesOnline) {\n            this.heatGeneration += (this.powerAllocation.engines / 100) * 8;\n        }\n        \n        // Shield heat\n        if (this.status.shieldsOnline) {\n            this.heatGeneration += (this.powerAllocation.shields / 100) * 3;\n        }\n        \n        // Weapon heat\n        if (this.status.weaponsOnline) {\n            this.heatGeneration += (this.powerAllocation.weapons / 100) * 5;\n        }\n        \n        // Add heat\n        this.status.heat = Math.min(this.config.maxHeat, \n            this.status.heat + this.heatGeneration * deltaTime);\n        \n        // Passive cooling (space is cold)\n        const coolingRate = 15; // Heat units per second\n        this.status.heat = Math.max(0, this.status.heat - coolingRate * deltaTime);\n        \n        // Overheat protection\n        if (this.status.heat > 90) {\n            this.handleOverheat();\n        }\n    }\n\n    /**\n     * Update shields (regeneration and power drain)\n     */\n    private updateShields(deltaTime: number): void {\n        if (this.status.shieldsOnline && this.status.power > 5) {\n            // Shield regeneration\n            const regenRate = this.config.shieldRegenRate * (this.powerAllocation.shields / 100);\n            this.status.shields = Math.min(this.config.maxShields, \n                this.status.shields + regenRate * deltaTime);\n        }\n    }\n\n    /**\n     * Update fuel consumption\n     */\n    private updateFuelConsumption(deltaTime: number): void {\n        if (this.status.enginesOnline) {\n            // Base fuel consumption for life support\n            let consumption = 0.5; // Units per second\n            \n            // Engine fuel consumption based on power allocation\n            consumption += (this.powerAllocation.engines / 100) * 2.0;\n            \n            // Inefficiency increases consumption\n            consumption *= (2.0 - this.status.engineEfficiency);\n            \n            this.fuelConsumption = consumption;\n            this.status.fuel = Math.max(0, this.status.fuel - consumption * deltaTime);\n            \n            // Emergency shutdown if no fuel\n            if (this.status.fuel === 0) {\n                this.emergencyShutdown();\n            }\n        }\n    }\n\n    /**\n     * Update system efficiency based on damage\n     */\n    private updateSystemEfficiency(): void {\n        // Calculate engine efficiency based on engineering section damage\n        const engineDamage = this.getSectionDamageLevel(ShipSection.Engineering);\n        this.status.engineEfficiency = Math.max(0.1, 1.0 - (engineDamage * 0.8));\n        \n        // Calculate shield strength based on core section damage\n        const coreDamage = this.getSectionDamageLevel(ShipSection.Core);\n        this.status.shieldStrength = Math.max(0.1, 1.0 - (coreDamage * 0.9));\n        \n        // Calculate weapon accuracy based on weapons section damage\n        const weaponDamage = this.getSectionDamageLevel(ShipSection.Weapons);\n        this.status.weaponAccuracy = Math.max(0.1, 1.0 - (weaponDamage * 0.7));\n        \n        // Calculate sensor range based on bridge damage\n        const bridgeDamage = this.getSectionDamageLevel(ShipSection.Bridge);\n        this.status.sensorRange = Math.max(0.2, 1.0 - (bridgeDamage * 0.6));\n    }\n\n    /**\n     * Update performance modifiers\n     */\n    private updatePerformanceModifiers(): void {\n        // Heat affects all systems\n        const heatPenalty = Math.max(0, (this.status.heat - 70) / 30); // Penalty starts at 70% heat\n        \n        this.status.engineEfficiency *= (1 - heatPenalty * 0.3);\n        this.status.shieldStrength *= (1 - heatPenalty * 0.2);\n        this.status.weaponAccuracy *= (1 - heatPenalty * 0.4);\n        \n        // Power affects system performance\n        const powerLevel = this.status.power / 100;\n        if (powerLevel < 0.5) {\n            const powerPenalty = (0.5 - powerLevel) * 2; // 0 to 1\n            this.status.engineEfficiency *= (1 - powerPenalty * 0.5);\n            this.status.shieldStrength *= (1 - powerPenalty * 0.7);\n            this.status.weaponAccuracy *= (1 - powerPenalty * 0.3);\n        }\n    }\n\n    /**\n     * Check for critical system failures\n     */\n    private checkCriticalSystems(): void {\n        // Check hull integrity\n        if (this.status.hull < 20) {\n            this.logger.warn('⚠️ Critical hull damage detected');\n            this.events.onCriticalDamage?.(ShipSection.Core);\n        }\n        \n        // Check life support\n        if (!this.status.lifeSupport || this.status.power < 5) {\n            this.logger.error('💀 Life support critical');\n        }\n        \n        // Check for system failures due to damage\n        Object.entries(ShipSection).forEach(([key, section]) => {\n            const damageLevel = this.getSectionDamageLevel(section);\n            if (damageLevel > 0.8) {\n                this.logger.warn(`⚠️ Critical damage in ${section} section`);\n                this.events.onCriticalDamage?.(section);\n            }\n        });\n    }\n\n    /**\n     * Handle power failure\n     */\n    private handlePowerFailure(): void {\n        this.logger.error('⚡ Power failure - emergency protocols activated');\n        \n        // Auto-shutdown non-essential systems\n        this.status.weaponsOnline = false;\n        this.powerAllocation.weapons = 0;\n        this.powerAllocation.sensors = 5; // Minimal sensors\n        \n        // Reduce other allocations\n        this.powerAllocation.engines = Math.min(this.powerAllocation.engines, 20);\n        this.powerAllocation.shields = Math.min(this.powerAllocation.shields, 15);\n        \n        this.events.onPowerFailure?.();\n    }\n\n    /**\n     * Handle overheat\n     */\n    private handleOverheat(): void {\n        this.logger.error('🔥 System overheat - emergency cooling');\n        \n        // Reduce power allocation to prevent further heating\n        this.powerAllocation.engines *= 0.7;\n        this.powerAllocation.weapons *= 0.5;\n        \n        // Emergency shutdown weapons if too hot\n        if (this.status.heat > 95) {\n            this.status.weaponsOnline = false;\n            this.powerAllocation.weapons = 0;\n        }\n        \n        this.events.onOverheat?.();\n    }\n\n    /**\n     * Emergency shutdown\n     */\n    private emergencyShutdown(): void {\n        this.logger.error('🛑 Emergency shutdown - no fuel');\n        \n        this.status.enginesOnline = false;\n        this.status.weaponsOnline = false;\n        this.status.shieldsOnline = false;\n        \n        // Keep minimal life support\n        this.powerAllocation = {\n            engines: 0,\n            shields: 0,\n            weapons: 0,\n            lifeSupport: 100,\n            sensors: 0\n        };\n    }\n\n    /**\n     * Apply damage to ship section\n     */\n    applyDamage(section: ShipSection, amount: number, damageType: 'kinetic' | 'energy' | 'thermal' = 'kinetic'): void {\n        // Calculate actual damage based on shields\n        let actualDamage = amount;\n        \n        if (this.status.shieldsOnline && this.status.shields > 0) {\n            const shieldAbsorption = Math.min(this.status.shields, amount * this.status.shieldStrength);\n            this.status.shields -= shieldAbsorption;\n            actualDamage -= shieldAbsorption;\n            \n            this.logger.debug(`Shields absorbed ${shieldAbsorption.toFixed(1)} damage`);\n        }\n        \n        if (actualDamage > 0) {\n            // Apply hull damage\n            this.status.hull = Math.max(0, this.status.hull - actualDamage);\n            \n            // Create damage report\n            this.addDamageReport(section, actualDamage);\n            \n            this.logger.warn(`${section} section took ${actualDamage.toFixed(1)} ${damageType} damage`);\n        }\n    }\n\n    /**\n     * Add damage report\n     */\n    private addDamageReport(section: ShipSection, damage: number): void {\n        const severity = this.calculateDamageSeverity(damage);\n        const systemsAffected = this.getAffectedSystems(section);\n        \n        const damageReport: DamageReport = {\n            section,\n            severity,\n            systemsAffected,\n            repairCost: this.calculateRepairCost(severity),\n            repairTime: this.calculateRepairTime(severity)\n        };\n        \n        const sectionDamage = this.damage.get(section) || [];\n        sectionDamage.push(damageReport);\n        this.damage.set(section, sectionDamage);\n        \n        // Trigger events\n        systemsAffected.forEach(system => {\n            this.events.onSystemDamage?.(system, severity);\n        });\n    }\n\n    /**\n     * Calculate damage severity\n     */\n    private calculateDamageSeverity(damage: number): DamageSeverity {\n        if (damage >= 50) return DamageSeverity.Critical;\n        if (damage >= 30) return DamageSeverity.Major;\n        if (damage >= 15) return DamageSeverity.Moderate;\n        return DamageSeverity.Minor;\n    }\n\n    /**\n     * Get systems affected by damage to a section\n     */\n    private getAffectedSystems(section: ShipSection): SystemType[] {\n        const systemMap: Record<ShipSection, SystemType[]> = {\n            [ShipSection.Bow]: [SystemType.Sensors, SystemType.Navigation],\n            [ShipSection.Stern]: [SystemType.Engines],\n            [ShipSection.Port]: [],\n            [ShipSection.Starboard]: [],\n            [ShipSection.Core]: [SystemType.LifeSupport, SystemType.Shields],\n            [ShipSection.Bridge]: [SystemType.Navigation, SystemType.Communications, SystemType.Sensors],\n            [ShipSection.Engineering]: [SystemType.Engines, SystemType.WarpDrive],\n            [ShipSection.Weapons]: [SystemType.Weapons]\n        };\n        \n        return systemMap[section] || [];\n    }\n\n    /**\n     * Calculate repair cost\n     */\n    private calculateRepairCost(severity: DamageSeverity): RepairCost {\n        const baseCost = {\n            [DamageSeverity.Minor]: { metal: 5, electronics: 2, crystals: 1 },\n            [DamageSeverity.Moderate]: { metal: 15, electronics: 8, crystals: 3 },\n            [DamageSeverity.Major]: { metal: 30, electronics: 20, crystals: 8 },\n            [DamageSeverity.Critical]: { metal: 60, electronics: 40, crystals: 20, nanobots: 5 },\n            [DamageSeverity.Destroyed]: { metal: 100, electronics: 80, crystals: 40, nanobots: 15 }\n        };\n        \n        return baseCost[severity];\n    }\n\n    /**\n     * Calculate repair time\n     */\n    private calculateRepairTime(severity: DamageSeverity): number {\n        const baseTimes = {\n            [DamageSeverity.Minor]: 30,      // 30 seconds\n            [DamageSeverity.Moderate]: 120,  // 2 minutes\n            [DamageSeverity.Major]: 300,     // 5 minutes\n            [DamageSeverity.Critical]: 600,  // 10 minutes\n            [DamageSeverity.Destroyed]: 1800 // 30 minutes\n        };\n        \n        return baseTimes[severity];\n    }\n\n    /**\n     * Get damage level for a section (0-1)\n     */\n    private getSectionDamageLevel(section: ShipSection): number {\n        const damages = this.damage.get(section) || [];\n        let totalDamage = 0;\n        \n        damages.forEach(damage => {\n            const severityValues = {\n                [DamageSeverity.Minor]: 0.1,\n                [DamageSeverity.Moderate]: 0.25,\n                [DamageSeverity.Major]: 0.5,\n                [DamageSeverity.Critical]: 0.8,\n                [DamageSeverity.Destroyed]: 1.0\n            };\n            totalDamage += severityValues[damage.severity];\n        });\n        \n        return Math.min(1.0, totalDamage);\n    }\n\n    /**\n     * Repair system damage\n     */\n    repairDamage(section: ShipSection, damageIndex: number, resources: RepairCost): boolean {\n        const damages = this.damage.get(section);\n        if (!damages || !damages[damageIndex]) return false;\n        \n        const damageReport = damages[damageIndex];\n        \n        // Check if we have enough resources\n        if (!this.hasEnoughResources(resources, damageReport.repairCost)) {\n            return false;\n        }\n        \n        // Remove the damage\n        damages.splice(damageIndex, 1);\n        this.damage.set(section, damages);\n        \n        // Restore some hull if applicable\n        this.status.hull = Math.min(this.config.maxHull, this.status.hull + 10);\n        \n        // Trigger repair event\n        damageReport.systemsAffected.forEach(system => {\n            this.events.onSystemRepaired?.(system);\n        });\n        \n        this.logger.info(`Repaired ${damageReport.severity} damage in ${section} section`);\n        return true;\n    }\n\n    /**\n     * Check if we have enough resources for repair\n     */\n    private hasEnoughResources(available: RepairCost, required: RepairCost): boolean {\n        return available.metal >= required.metal &&\n               available.electronics >= required.electronics &&\n               available.crystals >= required.crystals &&\n               (required.nanobots === undefined || (available.nanobots || 0) >= required.nanobots);\n    }\n\n    /**\n     * Set power allocation\n     */\n    setPowerAllocation(allocation: Partial<PowerAllocation>): void {\n        this.powerAllocation = { ...this.powerAllocation, ...allocation };\n        \n        // Ensure total doesn't exceed 100%\n        const total = Object.values(this.powerAllocation).reduce((sum, val) => sum + val, 0);\n        if (total > 100) {\n            // Scale down proportionally\n            const scale = 100 / total;\n            Object.keys(this.powerAllocation).forEach(key => {\n                (this.powerAllocation as any)[key] *= scale;\n            });\n        }\n        \n        this.logger.debug('Power allocation updated', this.powerAllocation);\n    }\n\n    /**\n     * Toggle system on/off\n     */\n    toggleSystem(system: SystemType, state?: boolean): void {\n        const newState = state !== undefined ? state : !this.getSystemState(system);\n        \n        switch (system) {\n            case SystemType.Engines:\n                this.status.enginesOnline = newState;\n                break;\n            case SystemType.Shields:\n                this.status.shieldsOnline = newState;\n                break;\n            case SystemType.Weapons:\n                this.status.weaponsOnline = newState;\n                break;\n            case SystemType.LifeSupport:\n                this.status.lifeSupport = newState;\n                break;\n            case SystemType.WarpDrive:\n                this.status.warpDrive = newState;\n                break;\n        }\n        \n        this.logger.debug(`${system} ${newState ? 'enabled' : 'disabled'}`);\n    }\n\n    /**\n     * Get system state\n     */\n    private getSystemState(system: SystemType): boolean {\n        switch (system) {\n            case SystemType.Engines: return this.status.enginesOnline;\n            case SystemType.Shields: return this.status.shieldsOnline;\n            case SystemType.Weapons: return this.status.weaponsOnline;\n            case SystemType.LifeSupport: return this.status.lifeSupport;\n            case SystemType.WarpDrive: return this.status.warpDrive;\n            default: return true;\n        }\n    }\n\n    /**\n     * Get current status\n     */\n    getStatus(): SystemStatus {\n        return { ...this.status };\n    }\n\n    /**\n     * Get power allocation\n     */\n    getPowerAllocation(): PowerAllocation {\n        return { ...this.powerAllocation };\n    }\n\n    /**\n     * Get damage reports\n     */\n    getDamageReports(): Map<ShipSection, DamageReport[]> {\n        return new Map(this.damage);\n    }\n\n    /**\n     * Get system diagnostics\n     */\n    getDiagnostics() {\n        return {\n            powerConsumption: this.powerConsumption,\n            heatGeneration: this.heatGeneration,\n            fuelConsumption: this.fuelConsumption,\n            totalDamageReports: Array.from(this.damage.values()).reduce((sum, reports) => sum + reports.length, 0),\n            criticalSystems: this.getCriticalSystems()\n        };\n    }\n\n    /**\n     * Get critical systems\n     */\n    private getCriticalSystems(): SystemType[] {\n        const critical: SystemType[] = [];\n        \n        if (this.status.hull < 25) critical.push(SystemType.LifeSupport);\n        if (this.status.power < 15) critical.push(SystemType.Engines);\n        if (this.status.heat > 85) critical.push(SystemType.Weapons);\n        if (!this.status.enginesOnline) critical.push(SystemType.Engines);\n        if (!this.status.lifeSupport) critical.push(SystemType.LifeSupport);\n        \n        return critical;\n    }\n\n    /**\n     * Add fuel\n     */\n    addFuel(amount: number): void {\n        this.status.fuel = Math.min(this.config.maxFuel, this.status.fuel + amount);\n    }\n\n    /**\n     * Add power (battery recharge)\n     */\n    addPower(amount: number): void {\n        this.status.power = Math.min(this.config.maxPower, this.status.power + amount);\n    }\n\n    /**\n     * Emergency repair (restores basic functionality)\n     */\n    emergencyRepair(): void {\n        this.status.hull = Math.max(this.status.hull, 25);\n        this.status.power = Math.max(this.status.power, 30);\n        this.status.heat = Math.min(this.status.heat, 50);\n        \n        // Restore critical systems\n        this.status.enginesOnline = true;\n        this.status.lifeSupport = true;\n        \n        this.logger.info('🔧 Emergency repair completed');\n    }\n}","/**\n * Warp Drive System\n * Complete warp drive mechanics with black hole formation, particle effects, and space distortion\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer, Color } from '@core/Renderer';\nimport { AudioEngine } from '@core/AudioEngine';\n\nexport interface WarpDriveConfig {\n    speedMultiplier: number; // 20x speed multiplier\n    energyCost: number; // Energy cost per second\n    particleCount: number; // Number of particles for effects\n    maxRange: number; // Maximum warp range\n    cooldownTime: number; // Cooldown between warps\n}\n\nexport enum WarpState {\n    Idle = 'idle',\n    Charging = 'charging',         // 0-5s: Particle absorption\n    BlackHoleGrowth = 'growth',    // 5-7s: Black hole formation\n    AccretionFormation = 'accretion', // 7-12s: Accretion disk formation\n    Active = 'active',             // Warp active with space distortion\n    Deactivating = 'deactivating' // 6s: Shutdown sequence\n}\n\ninterface WarpParticle {\n    position: Vector2;\n    velocity: Vector2;\n    color: Color;\n    life: number; // 0-1\n    size: number;\n    absorbed: boolean;\n}\n\ninterface AccretionParticle {\n    angle: number;\n    radius: number;\n    speed: number;\n    color: Color;\n    size: number;\n    life: number;\n}\n\ninterface SpaceDistortion {\n    intensity: number; // 0-1\n    radius: number;\n    center: Vector2;\n}\n\nexport interface WarpEvents {\n    onWarpStart?: () => void;\n    onWarpEnd?: () => void;\n    onBlackHoleFormed?: () => void;\n    onSpaceDistorted?: () => void;\n    onWarpFail?: (reason: string) => void;\n}\n\nexport class WarpDrive {\n    private config: WarpDriveConfig;\n    private events: WarpEvents;\n    \n    // Warp state\n    private state: WarpState = WarpState.Idle;\n    private stateTimer: number = 0;\n    private isCharging: boolean = false;\n    private isActive: boolean = false;\n    \n    // Visual effects\n    private particles: WarpParticle[] = [];\n    private accretionParticles: AccretionParticle[] = [];\n    private blackHoleRadius: number = 0;\n    private distortion: SpaceDistortion = { intensity: 0, radius: 0, center: { x: 0, y: 0 } };\n    \n    // Ship properties\n    private shipPosition: Vector2 = { x: 0, y: 0 };\n    private shipSize: number = 20;\n    private originalSpeed: number = 1.0;\n    \n    // Timing phases (seconds)\n    private readonly PHASE_PARTICLE_ABSORPTION = 5.0;\n    private readonly PHASE_BLACK_HOLE_GROWTH = 2.0; // 5-7s\n    private readonly PHASE_ACCRETION_FORMATION = 5.0; // 7-12s\n    private readonly PHASE_SHUTDOWN = 6.0;\n    \n    // Effect intensities\n    private particleIntensity: number = 0;\n    private blackHoleIntensity: number = 0;\n    private accretionIntensity: number = 0;\n    private distortionIntensity: number = 0;\n    \n    private logger: Logger;\n\n    constructor(\n        config: Partial<WarpDriveConfig> = {},\n        events: WarpEvents = {}\n    ) {\n        this.logger = new Logger('WarpDrive');\n        this.events = events;\n        \n        this.config = {\n            speedMultiplier: 20.0,\n            energyCost: 10.0, // Energy per second\n            particleCount: 50,\n            maxRange: 10000,\n            cooldownTime: 30.0,\n            ...config\n        };\n        \n        this.logger.info('🌌 Warp drive system initialized', {\n            speedMultiplier: this.config.speedMultiplier,\n            particleCount: this.config.particleCount\n        });\n    }\n\n    /**\n     * Activate warp drive\n     */\n    activateWarp(shipPosition: Vector2, shipSize: number): boolean {\n        if (this.state !== WarpState.Idle) {\n            this.logger.warn('⚠️ Warp already active or charging');\n            return false;\n        }\n        \n        this.shipPosition = { ...shipPosition };\n        this.shipSize = shipSize;\n        this.state = WarpState.Charging;\n        this.stateTimer = 0;\n        this.isCharging = true;\n        \n        // Initialize particle system\n        this.initializeParticles();\n        \n        this.logger.info('🚀 Warp drive activation sequence started');\n        this.events.onWarpStart?.();\n        \n        return true;\n    }\n\n    /**\n     * Deactivate warp drive\n     */\n    deactivateWarp(): void {\n        if (this.state === WarpState.Active) {\n            this.state = WarpState.Deactivating;\n            this.stateTimer = 0;\n            this.isActive = false;\n            \n            this.logger.info('🛑 Warp drive deactivation sequence started');\n        }\n    }\n\n    /**\n     * Initialize particle system for warp effects\n     */\n    private initializeParticles(): void {\n        this.particles = [];\n        const spawnRadius = 150; // Spawn particles around ship\n        \n        for (let i = 0; i < this.config.particleCount; i++) {\n            // Spawn particles in circle around ship\n            const angle = (Math.PI * 2 * i) / this.config.particleCount + Math.random() * 0.5;\n            const distance = spawnRadius + Math.random() * 50;\n            \n            const position = {\n                x: this.shipPosition.x + Math.cos(angle) * distance,\n                y: this.shipPosition.y + Math.sin(angle) * distance\n            };\n            \n            // Random particle colors (red, yellow, gray, purple, white, orange)\n            const colors = [\n                { r: 72, g: 24, b: 24 },  // Dark red\n                { r: 72, g: 48, b: 12 },  // Dark yellow\n                { r: 48, g: 48, b: 48 },  // Gray\n                { r: 48, g: 24, b: 72 },  // Dark purple\n                { r: 64, g: 64, b: 64 },  // White (muted)\n                { r: 64, g: 32, b: 16 }   // Dark orange\n            ];\n            \n            this.particles.push({\n                position: { ...position },\n                velocity: { x: 0, y: 0 },\n                color: colors[Math.floor(Math.random() * colors.length)],\n                life: 1.0,\n                size: Math.random() * 3 + 1,\n                absorbed: false\n            });\n        }\n    }\n\n    /**\n     * Update warp drive system\n     */\n    update(deltaTime: number, shipPosition: Vector2): number {\n        this.shipPosition = { ...shipPosition };\n        this.stateTimer += deltaTime;\n        \n        switch (this.state) {\n            case WarpState.Charging:\n                this.updateChargingPhase(deltaTime);\n                break;\n                \n            case WarpState.BlackHoleGrowth:\n                this.updateBlackHoleGrowth(deltaTime);\n                break;\n                \n            case WarpState.AccretionFormation:\n                this.updateAccretionFormation(deltaTime);\n                break;\n                \n            case WarpState.Active:\n                this.updateActiveWarp(deltaTime);\n                break;\n                \n            case WarpState.Deactivating:\n                this.updateDeactivation(deltaTime);\n                break;\n        }\n        \n        // Update particle systems\n        this.updateParticles(deltaTime);\n        this.updateAccretionDisk(deltaTime);\n        this.updateSpaceDistortion(deltaTime);\n        \n        // Return speed multiplier\n        return this.isActive ? this.config.speedMultiplier : 1.0;\n    }\n\n    /**\n     * Update charging phase (0-5 seconds)\n     */\n    private updateChargingPhase(deltaTime: number): void {\n        const progress = this.stateTimer / this.PHASE_PARTICLE_ABSORPTION;\n        this.particleIntensity = Math.min(1.0, progress);\n        \n        // Particles start moving toward ship center\n        this.particles.forEach(particle => {\n            if (!particle.absorbed) {\n                const toCenter = {\n                    x: this.shipPosition.x - particle.position.x,\n                    y: this.shipPosition.y - particle.position.y\n                };\n                const distance = Math.sqrt(toCenter.x * toCenter.x + toCenter.y * toCenter.y);\n                \n                if (distance > 5) {\n                    // Accelerate toward center\n                    const speed = 50 + (progress * 200); // Speed increases over time\n                    particle.velocity.x = (toCenter.x / distance) * speed;\n                    particle.velocity.y = (toCenter.y / distance) * speed;\n                    \n                    // Update position\n                    particle.position.x += particle.velocity.x * deltaTime;\n                    particle.position.y += particle.velocity.y * deltaTime;\n                } else {\n                    particle.absorbed = true;\n                }\n            }\n        });\n        \n        // Transition to black hole growth\n        if (this.stateTimer >= this.PHASE_PARTICLE_ABSORPTION) {\n            this.state = WarpState.BlackHoleGrowth;\n            this.stateTimer = 0;\n            this.logger.debug('🕳️ Black hole formation phase started');\n        }\n    }\n\n    /**\n     * Update black hole growth phase (5-7 seconds)\n     */\n    private updateBlackHoleGrowth(deltaTime: number): void {\n        const progress = this.stateTimer / this.PHASE_BLACK_HOLE_GROWTH;\n        this.blackHoleIntensity = Math.min(1.0, progress);\n        \n        // Black hole grows to 1/3 of ship size\n        this.blackHoleRadius = (this.shipSize / 3) * this.blackHoleIntensity;\n        \n        // Transition to accretion formation\n        if (this.stateTimer >= this.PHASE_BLACK_HOLE_GROWTH) {\n            this.state = WarpState.AccretionFormation;\n            this.stateTimer = 0;\n            this.initializeAccretionDisk();\n            this.logger.debug('💫 Accretion disk formation phase started');\n        }\n    }\n\n    /**\n     * Update accretion formation phase (7-12 seconds)\n     */\n    private updateAccretionFormation(deltaTime: number): void {\n        const progress = this.stateTimer / this.PHASE_ACCRETION_FORMATION;\n        this.accretionIntensity = Math.min(1.0, progress);\n        \n        // Black hole continues growing to consume whole ship\n        const totalGrowthProgress = (this.PHASE_BLACK_HOLE_GROWTH + this.stateTimer) / \n                                  (this.PHASE_BLACK_HOLE_GROWTH + this.PHASE_ACCRETION_FORMATION);\n        this.blackHoleRadius = this.shipSize * totalGrowthProgress;\n        \n        // Transition to active warp\n        if (this.stateTimer >= this.PHASE_ACCRETION_FORMATION) {\n            this.state = WarpState.Active;\n            this.stateTimer = 0;\n            this.isActive = true;\n            this.isCharging = false;\n            \n            // Initialize space distortion\n            this.distortion.center = { ...this.shipPosition };\n            this.distortion.radius = 200;\n            \n            this.logger.info('🌌 Warp drive fully active - space distortion engaged');\n            this.events.onBlackHoleFormed?.();\n            this.events.onSpaceDistorted?.();\n        }\n    }\n\n    /**\n     * Update active warp phase\n     */\n    private updateActiveWarp(deltaTime: number): void {\n        // Maintain full intensity effects\n        this.particleIntensity = 1.0;\n        this.blackHoleIntensity = 1.0;\n        this.accretionIntensity = 1.0;\n        this.distortionIntensity = 1.0;\n        \n        // Update distortion center to follow ship\n        this.distortion.center = { ...this.shipPosition };\n    }\n\n    /**\n     * Update deactivation phase (6 seconds)\n     */\n    private updateDeactivation(deltaTime: number): void {\n        const progress = this.stateTimer / this.PHASE_SHUTDOWN;\n        const reverseProgress = 1.0 - progress;\n        \n        // Gradually reduce all effects\n        this.distortionIntensity = reverseProgress;\n        this.blackHoleIntensity = Math.max(0, reverseProgress - 0.3); // Black hole dissolves faster\n        this.accretionIntensity = Math.max(0, reverseProgress - 0.1); // Accretion disk dissolves\n        this.particleIntensity = Math.max(0, reverseProgress - 0.5); // Particles fade last\n        \n        // Add dissolution particles\n        if (progress > 0.3 && Math.random() < 0.3) {\n            this.addDissolutionParticles();\n        }\n        \n        // Complete shutdown\n        if (this.stateTimer >= this.PHASE_SHUTDOWN) {\n            this.state = WarpState.Idle;\n            this.stateTimer = 0;\n            this.clearAllEffects();\n            \n            this.logger.info('✅ Warp drive deactivation complete');\n            this.events.onWarpEnd?.();\n        }\n    }\n\n    /**\n     * Initialize accretion disk\n     */\n    private initializeAccretionDisk(): void {\n        this.accretionParticles = [];\n        const particleCount = 40;\n        \n        for (let i = 0; i < particleCount; i++) {\n            this.accretionParticles.push({\n                angle: Math.random() * Math.PI * 2,\n                radius: 15 + Math.random() * 25, // Radius around black hole\n                speed: 2 + Math.random() * 4, // Rotation speed (chaotic)\n                color: this.getAccretionColor(),\n                size: Math.random() * 2 + 1,\n                life: 1.0\n            });\n        }\n    }\n\n    /**\n     * Get accretion disk particle color (red-orange-yellow-white swirl)\n     */\n    private getAccretionColor(): Color {\n        const colors = [\n            { r: 96, g: 32, b: 32 },  // Dark red\n            { r: 96, g: 48, b: 16 },  // Dark orange  \n            { r: 96, g: 64, b: 16 },  // Dark yellow\n            { r: 80, g: 80, b: 80 }   // Muted white\n        ];\n        return colors[Math.floor(Math.random() * colors.length)];\n    }\n\n    /**\n     * Update particle effects\n     */\n    private updateParticles(deltaTime: number): void {\n        this.particles.forEach(particle => {\n            if (this.state === WarpState.Deactivating && !particle.absorbed) {\n                // During deactivation, particles fly outward\n                const fromCenter = {\n                    x: particle.position.x - this.shipPosition.x,\n                    y: particle.position.y - this.shipPosition.y\n                };\n                const distance = Math.sqrt(fromCenter.x * fromCenter.x + fromCenter.y * fromCenter.y);\n                \n                if (distance > 0) {\n                    const speed = 100;\n                    particle.velocity.x = (fromCenter.x / distance) * speed;\n                    particle.velocity.y = (fromCenter.y / distance) * speed;\n                    \n                    particle.position.x += particle.velocity.x * deltaTime;\n                    particle.position.y += particle.velocity.y * deltaTime;\n                }\n                \n                particle.life -= deltaTime * 2; // Fade quickly\n            }\n        });\n    }\n\n    /**\n     * Update accretion disk\n     */\n    private updateAccretionDisk(deltaTime: number): void {\n        this.accretionParticles.forEach(particle => {\n            // Chaotic rotation\n            particle.angle += particle.speed * deltaTime * (0.5 + Math.random() * 0.5);\n            \n            // Slight radius variation for chaos\n            particle.radius += Math.sin(particle.angle * 3) * 2 * deltaTime;\n            \n            // During deactivation, particles spiral outward\n            if (this.state === WarpState.Deactivating) {\n                particle.radius += 50 * deltaTime;\n                particle.life -= deltaTime * 1.5;\n            }\n        });\n        \n        // Remove dead particles\n        this.accretionParticles = this.accretionParticles.filter(p => p.life > 0);\n    }\n\n    /**\n     * Update space distortion effect\n     */\n    private updateSpaceDistortion(deltaTime: number): void {\n        if (this.distortionIntensity > 0) {\n            // Subtle pulsing effect\n            this.distortion.intensity = this.distortionIntensity * (0.8 + Math.sin(this.stateTimer * 3) * 0.2);\n        }\n    }\n\n    /**\n     * Add dissolution particles during shutdown\n     */\n    private addDissolutionParticles(): void {\n        for (let i = 0; i < 5; i++) {\n            const angle = Math.random() * Math.PI * 2;\n            const distance = Math.random() * 30;\n            \n            this.particles.push({\n                position: {\n                    x: this.shipPosition.x + Math.cos(angle) * distance,\n                    y: this.shipPosition.y + Math.sin(angle) * distance\n                },\n                velocity: {\n                    x: Math.cos(angle) * 50,\n                    y: Math.sin(angle) * 50\n                },\n                color: { r: 32, g: 32, b: 32 }, // Darker particles for dissolution\n                life: 0.5,\n                size: Math.random() * 2 + 1,\n                absorbed: false\n            });\n        }\n    }\n\n    /**\n     * Clear all effects\n     */\n    private clearAllEffects(): void {\n        this.particles = [];\n        this.accretionParticles = [];\n        this.blackHoleRadius = 0;\n        this.particleIntensity = 0;\n        this.blackHoleIntensity = 0;\n        this.accretionIntensity = 0;\n        this.distortionIntensity = 0;\n    }\n\n    /**\n     * Render warp effects\n     */\n    render(renderer: Renderer): void {\n        if (this.state === WarpState.Idle) return;\n        \n        // Render space distortion first (background effect)\n        if (this.distortionIntensity > 0) {\n            this.renderSpaceDistortion(renderer);\n        }\n        \n        // Render absorption particles\n        if (this.particleIntensity > 0) {\n            this.renderParticles(renderer);\n        }\n        \n        // Render accretion disk\n        if (this.accretionIntensity > 0) {\n            this.renderAccretionDisk(renderer);\n        }\n        \n        // Render black hole (on top)\n        if (this.blackHoleIntensity > 0) {\n            this.renderBlackHole(renderer);\n        }\n    }\n\n    /**\n     * Render absorption particles\n     */\n    private renderParticles(renderer: Renderer): void {\n        this.particles.forEach(particle => {\n            if (particle.life > 0) {\n                const alpha = particle.life * this.particleIntensity;\n                const color = {\n                    r: Math.floor(particle.color.r * alpha),\n                    g: Math.floor(particle.color.g * alpha),\n                    b: Math.floor(particle.color.b * alpha)\n                };\n                \n                renderer.fillRect(\n                    particle.position.x - particle.size/2,\n                    particle.position.y - particle.size/2,\n                    particle.size,\n                    particle.size,\n                    color\n                );\n            }\n        });\n    }\n\n    /**\n     * Render black hole\n     */\n    private renderBlackHole(renderer: Renderer): void {\n        const radius = this.blackHoleRadius * this.blackHoleIntensity;\n        if (radius > 0) {\n            // Pure black center\n            renderer.drawCircle(this.shipPosition.x, this.shipPosition.y, radius, { r: 0, g: 0, b: 0 }, true);\n            \n            // Subtle event horizon glow\n            const glowRadius = radius * 1.2;\n            const glowColor = { r: 8, g: 8, b: 8 }; // Very dark glow\n            renderer.drawCircle(this.shipPosition.x, this.shipPosition.y, glowRadius, glowColor, false);\n        }\n    }\n\n    /**\n     * Render accretion disk\n     */\n    private renderAccretionDisk(renderer: Renderer): void {\n        this.accretionParticles.forEach(particle => {\n            if (particle.life > 0) {\n                const x = this.shipPosition.x + Math.cos(particle.angle) * particle.radius;\n                const y = this.shipPosition.y + Math.sin(particle.angle) * particle.radius;\n                \n                const alpha = particle.life * this.accretionIntensity;\n                const color = {\n                    r: Math.floor(particle.color.r * alpha),\n                    g: Math.floor(particle.color.g * alpha),\n                    b: Math.floor(particle.color.b * alpha)\n                };\n                \n                renderer.fillRect(\n                    x - particle.size/2,\n                    y - particle.size/2,\n                    particle.size,\n                    particle.size,\n                    color\n                );\n            }\n        });\n    }\n\n    /**\n     * Render space distortion effect\n     */\n    private renderSpaceDistortion(renderer: Renderer): void {\n        // This is a placeholder for space distortion\n        // In a real implementation, this would affect the entire background rendering\n        // For now, we'll render subtle distortion lines\n        \n        const intensity = this.distortion.intensity;\n        if (intensity > 0) {\n            const lines = 8;\n            for (let i = 0; i < lines; i++) {\n                const angle = (Math.PI * 2 * i) / lines;\n                const baseRadius = this.distortion.radius;\n                \n                for (let r = baseRadius * 0.5; r < baseRadius * 1.5; r += 10) {\n                    const distortion = Math.sin(this.stateTimer * 2 + r * 0.1) * intensity * 5;\n                    const x = this.distortion.center.x + Math.cos(angle) * (r + distortion);\n                    const y = this.distortion.center.y + Math.sin(angle) * (r + distortion);\n                    \n                    const alpha = intensity * 0.3 * (1 - (r - baseRadius * 0.5) / (baseRadius));\n                    const color = {\n                        r: Math.floor(16 * alpha),\n                        g: Math.floor(24 * alpha),\n                        b: Math.floor(32 * alpha)\n                    };\n                    \n                    renderer.fillRect(x - 1, y - 1, 2, 2, color);\n                }\n            }\n        }\n    }\n\n    /**\n     * Get current warp state\n     */\n    getState(): WarpState {\n        return this.state;\n    }\n\n    /**\n     * Check if warp is active\n     */\n    isWarpActive(): boolean {\n        return this.isActive;\n    }\n\n    /**\n     * Check if warp is charging\n     */\n    isWarpCharging(): boolean {\n        return this.isCharging;\n    }\n\n    /**\n     * Get warp progress (0-1) during charging/deactivation\n     */\n    getWarpProgress(): number {\n        switch (this.state) {\n            case WarpState.Charging:\n                return this.stateTimer / this.PHASE_PARTICLE_ABSORPTION;\n            case WarpState.BlackHoleGrowth:\n                return this.stateTimer / this.PHASE_BLACK_HOLE_GROWTH;\n            case WarpState.AccretionFormation:\n                return this.stateTimer / this.PHASE_ACCRETION_FORMATION;\n            case WarpState.Deactivating:\n                return 1.0 - (this.stateTimer / this.PHASE_SHUTDOWN);\n            case WarpState.Active:\n                return 1.0;\n            default:\n                return 0.0;\n        }\n    }\n\n    /**\n     * Get space distortion data for background rendering\n     */\n    getSpaceDistortion(): SpaceDistortion {\n        return { ...this.distortion };\n    }\n\n    /**\n     * Force emergency warp shutdown\n     */\n    emergencyShutdown(): void {\n        if (this.state !== WarpState.Idle) {\n            this.state = WarpState.Deactivating;\n            this.stateTimer = 0;\n            this.isActive = false;\n            this.isCharging = false;\n            \n            this.logger.warn('🚨 Emergency warp shutdown initiated');\n        }\n    }\n}","/**\n * Player Ship Entity\n * Integrates physics, input, and rendering for the player's controllable ship\n */\n\nimport { PhysicsObject, SpacePhysics } from '@core/Physics';\nimport { InputManager } from '@core/InputManager';\nimport { AudioEngine } from '@core/AudioEngine';\nimport { Vector2 } from '@core/Renderer';\nimport { Logger } from '@utils/Logger';\nimport { ShipSystems, SystemStatus, PowerAllocation, ShipSection, SystemType } from '@entities/ShipSystems';\nimport { WarpDrive, WarpState } from '@systems/WarpDrive';\n\nexport interface ShipStats {\n    maxHealth: number;\n    maxFuel: number;\n    thrustPower: number;\n    rotationSpeed: number;\n    maxVelocity: number;\n    mass: number;\n}\n\nexport class PlayerShip {\n    private physicsObject: PhysicsObject;\n    private physics: SpacePhysics;\n    private input: InputManager;\n    private audio: AudioEngine;\n    \n    // Ship systems\n    private shipSystems: ShipSystems;\n    private warpDrive: WarpDrive;\n    \n    // Ship properties\n    private stats: ShipStats;\n    private currentFuel: number;\n    private rotation: number = 0; // Rotation in radians\n    private thrustLevel: number = 0; // 0-1\n    private engineSoundId: string | null = null;\n    \n    // Visual effects\n    private thrustParticles: ThrustParticle[] = [];\n    \n    private logger: Logger;\n\n    constructor(\n        physics: SpacePhysics,\n        input: InputManager,\n        audio: AudioEngine,\n        startPosition: Vector2,\n        stats?: Partial<ShipStats>\n    ) {\n        this.physics = physics;\n        this.input = input;\n        this.audio = audio;\n        this.logger = new Logger('PlayerShip');\n        \n        // Default ship stats\n        this.stats = {\n            maxHealth: 100,\n            maxFuel: 1000,\n            thrustPower: 5000,\n            rotationSpeed: 3.0,\n            maxVelocity: 500,\n            mass: 1000,\n            ...stats\n        };\n        \n        this.currentFuel = this.stats.maxFuel;\n        \n        // Create physics object\n        this.physicsObject = this.physics.createShip('player_ship', startPosition, this.stats.mass);\n        this.physicsObject.health = this.stats.maxHealth;\n        \n        // Add collision callback\n        this.physicsObject.onCollision = (other) => this.handleCollision(other);\n        \n        // Add to physics simulation\n        this.physics.addObject(this.physicsObject);\n        \n        // Initialize ship systems\n        this.shipSystems = new ShipSystems({\n            maxHull: this.stats.maxHealth,\n            maxFuel: this.stats.maxFuel,\n            enginePower: this.stats.thrustPower,\n            engineEfficiency: 0.85\n        }, {\n            onSystemDamage: (system, severity) => {\n                this.logger.warn(`⚠️ ${system} system damaged: ${severity}`);\n                this.audio.playUIBeep();\n            },\n            onCriticalDamage: (section) => {\n                this.logger.error(`💥 Critical damage in ${section} section!`);\n            },\n            onPowerFailure: () => {\n                this.logger.error('⚡ Power failure - emergency protocols activated');\n            },\n            onOverheat: () => {\n                this.logger.warn('🔥 Ship overheating - reducing power');\n            }\n        });\n        \n        // Initialize warp drive\n        this.warpDrive = new WarpDrive({\n            speedMultiplier: 20.0,\n            energyCost: 15.0,\n            particleCount: 50\n        }, {\n            onWarpStart: () => {\n                this.logger.info('🌌 Warp drive activation sequence initiated');\n            },\n            onWarpEnd: () => {\n                this.logger.info('✅ Warp drive deactivation complete');\n            },\n            onBlackHoleFormed: () => {\n                this.logger.info('🕳️ Black hole formation complete');\n            },\n            onSpaceDistorted: () => {\n                this.logger.info('🌀 Space-time distortion field active');\n            }\n        });\n        \n        this.logger.info('🚀 Player ship created', {\n            position: startPosition,\n            stats: this.stats\n        });\n    }\n\n    /**\n     * Update the player ship\n     */\n    update(deltaTime: number): void {\n        // Update ship systems first\n        this.shipSystems.update(deltaTime);\n        \n        // Update warp drive\n        const warpSpeedMultiplier = this.warpDrive.update(deltaTime, this.physicsObject.position);\n        \n        // Handle input\n        this.handleInput(deltaTime);\n        \n        // Update rotation based on input\n        this.updateRotation(deltaTime);\n        \n        // Update thrust and movement (affected by warp speed)\n        this.updateMovement(deltaTime, warpSpeedMultiplier);\n        \n        // Update visual effects\n        this.updateThrustParticles(deltaTime);\n        \n        // Update audio\n        this.updateAudio();\n        \n        // Apply fuel consumption\n        this.consumeFuel(deltaTime);\n    }\n\n    /**\n     * Handle player input\n     */\n    private handleInput(deltaTime: number): void {\n        // Warp drive controls\n        if (this.input.isKeyPressed('KeyW') || this.input.isActionPressed()) {\n            this.handleWarpInput();\n        }\n        \n        // Get input values\n        const thrustInput = this.input.getThrustInput();\n        const rotationInput = this.input.getRotationInput();\n        \n        // Update thrust level\n        this.thrustLevel = Math.max(0, thrustInput); // Only forward thrust for now\n        \n        // Update rotation\n        this.rotation += rotationInput * this.stats.rotationSpeed * deltaTime;\n        \n        // Normalize rotation to 0-2π\n        while (this.rotation < 0) this.rotation += Math.PI * 2;\n        while (this.rotation > Math.PI * 2) this.rotation -= Math.PI * 2;\n    }\n\n    /**\n     * Update ship rotation\n     */\n    private updateRotation(deltaTime: number): void {\n        // Rotation is handled in handleInput\n        // This method can be used for additional rotation logic\n    }\n\n    /**\n     * Handle warp drive input\n     */\n    private handleWarpInput(): void {\n        const systemStatus = this.shipSystems.getStatus();\n        \n        // Check if warp drive is available\n        if (!systemStatus.warpDrive) {\n            this.logger.warn('⚠️ Warp drive offline');\n            return;\n        }\n        \n        if (systemStatus.power < 20) {\n            this.logger.warn('⚠️ Insufficient power for warp drive');\n            return;\n        }\n        \n        // Toggle warp drive\n        if (this.warpDrive.isWarpActive()) {\n            this.warpDrive.deactivateWarp();\n        } else if (!this.warpDrive.isWarpCharging()) {\n            this.warpDrive.activateWarp(this.physicsObject.position, 20); // Ship size\n        }\n    }\n\n    /**\n     * Update ship movement and thrust\n     */\n    private updateMovement(deltaTime: number, speedMultiplier: number = 1.0): void {\n        if (this.thrustLevel > 0 && this.currentFuel > 0) {\n            // Calculate thrust direction based on rotation\n            const thrustDirection: Vector2 = {\n                x: Math.cos(this.rotation - Math.PI / 2), // -PI/2 because 0 rotation points up\n                y: Math.sin(this.rotation - Math.PI / 2)\n            };\n            \n            // Apply thrust (affected by warp speed multiplier)\n            const thrustForce = this.thrustLevel * this.stats.thrustPower * speedMultiplier;\n            this.physics.applyThrust(this.physicsObject.id, thrustDirection, thrustForce);\n            \n            // Create thrust particles\n            this.createThrustParticles();\n        }\n        \n        // Limit velocity to max speed\n        const currentSpeed = Math.sqrt(\n            this.physicsObject.velocity.x ** 2 + this.physicsObject.velocity.y ** 2\n        );\n        \n        if (currentSpeed > this.stats.maxVelocity) {\n            const scale = this.stats.maxVelocity / currentSpeed;\n            this.physicsObject.velocity.x *= scale;\n            this.physicsObject.velocity.y *= scale;\n        }\n    }\n\n    /**\n     * Update thrust particle effects\n     */\n    private updateThrustParticles(deltaTime: number): void {\n        // Update existing particles\n        for (let i = this.thrustParticles.length - 1; i >= 0; i--) {\n            const particle = this.thrustParticles[i];\n            \n            // Update particle\n            particle.position.x += particle.velocity.x * deltaTime;\n            particle.position.y += particle.velocity.y * deltaTime;\n            particle.life -= deltaTime;\n            \n            // Remove dead particles\n            if (particle.life <= 0) {\n                this.thrustParticles.splice(i, 1);\n            }\n        }\n    }\n\n    /**\n     * Create thrust particles\n     */\n    private createThrustParticles(): void {\n        if (this.thrustParticles.length > 20) return; // Limit particle count\n        \n        // Calculate exhaust position (behind the ship)\n        const exhaustOffset = 20; // Distance behind ship center\n        const exhaustX = this.physicsObject.position.x - Math.cos(this.rotation - Math.PI / 2) * exhaustOffset;\n        const exhaustY = this.physicsObject.position.y - Math.sin(this.rotation - Math.PI / 2) * exhaustOffset;\n        \n        // Create particle\n        const particle: ThrustParticle = {\n            position: { x: exhaustX, y: exhaustY },\n            velocity: {\n                x: -Math.cos(this.rotation - Math.PI / 2) * 100 + (Math.random() - 0.5) * 50,\n                y: -Math.sin(this.rotation - Math.PI / 2) * 100 + (Math.random() - 0.5) * 50\n            },\n            life: 0.5,\n            maxLife: 0.5\n        };\n        \n        this.thrustParticles.push(particle);\n    }\n\n    /**\n     * Update audio based on ship state\n     */\n    private updateAudio(): void {\n        if (this.thrustLevel > 0 && this.currentFuel > 0) {\n            // Start engine sound if not playing\n            if (!this.engineSoundId) {\n                this.engineSoundId = this.audio.playEngineSound();\n            }\n        } else {\n            // Stop engine sound\n            if (this.engineSoundId) {\n                this.audio.stopSound(this.engineSoundId);\n                this.engineSoundId = null;\n            }\n        }\n    }\n\n    /**\n     * Consume fuel based on thrust\n     */\n    private consumeFuel(deltaTime: number): void {\n        if (this.thrustLevel > 0) {\n            const fuelConsumption = this.thrustLevel * 10 * deltaTime; // Adjust consumption rate\n            this.currentFuel = Math.max(0, this.currentFuel - fuelConsumption);\n            \n            if (this.currentFuel === 0) {\n                this.logger.warn('Ship out of fuel!');\n            }\n        }\n    }\n\n    /**\n     * Handle collision with other objects\n     */\n    private handleCollision(other: PhysicsObject): void {\n        this.logger.debug(`Ship collision with ${other.type}: ${other.id}`);\n        \n        switch (other.type) {\n            case 'planet':\n            case 'asteroid':\n                // Take damage from collision\n                const collisionDamage = 10;\n                this.takeDamage(collisionDamage);\n                \n                // Play collision sound\n                this.audio.playExplosion(this.physicsObject.position);\n                break;\n                \n            case 'projectile':\n                // Take damage from projectile\n                this.takeDamage(5);\n                break;\n        }\n    }\n\n    /**\n     * Take damage\n     */\n    takeDamage(amount: number): void {\n        if (this.physicsObject.health) {\n            this.physicsObject.health = Math.max(0, this.physicsObject.health - amount);\n            this.logger.debug(`Ship took ${amount} damage, health: ${this.physicsObject.health}`);\n            \n            if (this.physicsObject.health === 0) {\n                this.destroy();\n            }\n        }\n    }\n\n    /**\n     * Heal the ship\n     */\n    heal(amount: number): void {\n        if (this.physicsObject.health) {\n            this.physicsObject.health = Math.min(this.stats.maxHealth, this.physicsObject.health + amount);\n            this.logger.debug(`Ship healed ${amount}, health: ${this.physicsObject.health}`);\n        }\n    }\n\n    /**\n     * Add fuel\n     */\n    addFuel(amount: number): void {\n        this.currentFuel = Math.min(this.stats.maxFuel, this.currentFuel + amount);\n        this.logger.debug(`Added ${amount} fuel, current: ${this.currentFuel}`);\n    }\n\n    /**\n     * Fire weapon\n     */\n    fireWeapon(): void {\n        if (this.input.isActionPressed()) {\n            // Calculate projectile spawn position (front of ship)\n            const spawnOffset = 25;\n            const spawnX = this.physicsObject.position.x + Math.cos(this.rotation - Math.PI / 2) * spawnOffset;\n            const spawnY = this.physicsObject.position.y + Math.sin(this.rotation - Math.PI / 2) * spawnOffset;\n            \n            // Calculate projectile velocity\n            const projectileSpeed = 800;\n            const projectileVelocity: Vector2 = {\n                x: Math.cos(this.rotation - Math.PI / 2) * projectileSpeed + this.physicsObject.velocity.x,\n                y: Math.sin(this.rotation - Math.PI / 2) * projectileSpeed + this.physicsObject.velocity.y\n            };\n            \n            // Create projectile\n            const projectile = this.physics.createProjectile(\n                `projectile_${Date.now()}`,\n                { x: spawnX, y: spawnY },\n                projectileVelocity\n            );\n            \n            // Add projectile to physics\n            this.physics.addObject(projectile);\n            \n            // Play laser sound\n            this.audio.playLaserSound(this.physicsObject.position);\n            \n            this.logger.debug('Weapon fired');\n        }\n    }\n\n    /**\n     * Destroy the ship\n     */\n    private destroy(): void {\n        this.logger.warn('Ship destroyed!');\n        \n        // Play explosion sound\n        this.audio.playExplosion(this.physicsObject.position);\n        \n        // Stop engine sound\n        if (this.engineSoundId) {\n            this.audio.stopSound(this.engineSoundId);\n            this.engineSoundId = null;\n        }\n        \n        // Remove from physics simulation\n        this.physics.removeObject(this.physicsObject.id);\n    }\n\n    /**\n     * Render thrust particles\n     */\n    renderThrustParticles(renderer: any): void {\n        this.thrustParticles.forEach(particle => {\n            const alpha = particle.life / particle.maxLife;\n            const color = {\n                r: 255,\n                g: Math.floor(255 * alpha),\n                b: 0,\n                a: Math.floor(255 * alpha)\n            };\n            \n            renderer.setPixel(\n                Math.floor(particle.position.x),\n                Math.floor(particle.position.y),\n                color\n            );\n        });\n    }\n\n    /**\n     * Get ship data for UI display\n     */\n    getShipData() {\n        return {\n            position: { ...this.physicsObject.position },\n            velocity: { ...this.physicsObject.velocity },\n            rotation: this.rotation,\n            health: this.physicsObject.health || 0,\n            fuel: this.currentFuel,\n            thrustLevel: this.thrustLevel,\n            maxHealth: this.stats.maxHealth,\n            maxFuel: this.stats.maxFuel\n        };\n    }\n\n    /**\n     * Get physics object for external access\n     */\n    getPhysicsObject(): PhysicsObject {\n        return this.physicsObject;\n    }\n\n    /**\n     * Get current position\n     */\n    getPosition(): Vector2 {\n        return { ...this.physicsObject.position };\n    }\n\n    /**\n     * Get current velocity\n     */\n    getVelocity(): Vector2 {\n        return { ...this.physicsObject.velocity };\n    }\n\n    /**\n     * Get current rotation in radians\n     */\n    getRotation(): number {\n        return this.rotation;\n    }\n\n    /**\n     * Check if ship is alive\n     */\n    isAlive(): boolean {\n        return this.shipSystems.getStatus().hull > 0;\n    }\n    \n    /**\n     * Get ship systems status\n     */\n    getSystemStatus(): SystemStatus {\n        return this.shipSystems.getStatus();\n    }\n    \n    /**\n     * Get ship systems instance\n     */\n    getShipSystems(): ShipSystems {\n        return this.shipSystems;\n    }\n    \n    /**\n     * Apply damage to ship systems\n     */\n    applyDamage(amount: number, section: ShipSection = ShipSection.Core, damageType: 'kinetic' | 'energy' | 'thermal' = 'kinetic'): void {\n        this.shipSystems.applyDamage(section, amount, damageType);\n        \n        // Update physics object health\n        this.physicsObject.health = this.shipSystems.getStatus().hull;\n    }\n    \n    /**\n     * Set power allocation\n     */\n    setPowerAllocation(allocation: Partial<PowerAllocation>): void {\n        this.shipSystems.setPowerAllocation(allocation);\n    }\n    \n    /**\n     * Toggle ship system\n     */\n    toggleSystem(system: SystemType, state?: boolean): void {\n        this.shipSystems.toggleSystem(system, state);\n    }\n    \n    /**\n     * Get warp drive instance\n     */\n    getWarpDrive(): WarpDrive {\n        return this.warpDrive;\n    }\n    \n    /**\n     * Check if warp is active\n     */\n    isWarpActive(): boolean {\n        return this.warpDrive.isWarpActive();\n    }\n    \n    /**\n     * Get warp state\n     */\n    getWarpState(): WarpState {\n        return this.warpDrive.getState();\n    }\n    \n    /**\n     * Render warp effects\n     */\n    renderWarpEffects(renderer: any): void {\n        this.warpDrive.render(renderer);\n    }\n\n    /**\n     * Cleanup\n     */\n    cleanup(): void {\n        // Stop engine sound\n        if (this.engineSoundId) {\n            this.audio.stopSound(this.engineSoundId);\n        }\n        \n        // Remove from physics\n        this.physics.removeObject(this.physicsObject.id);\n        \n        this.logger.info('🧹 Player ship cleanup completed');\n    }\n}\n\n// Thrust particle interface\ninterface ThrustParticle {\n    position: Vector2;\n    velocity: Vector2;\n    life: number;\n    maxLife: number;\n}","/**\n * Galaxy Generation Engine\n * Creates realistic spiral galaxies with procedural star systems\n */\n\nimport { Vector2 } from '@core/Renderer';\nimport { Logger } from '@utils/Logger';\n\nexport interface GalaxyConfig {\n    seed: number;\n    size: number; // Galaxy radius in light years\n    starCount: number;\n    spiralArms: number;\n    armTightness: number; // How tightly wound the spiral arms are\n    coreSize: number; // Size of the galactic core\n    starDensity: number; // Stars per cubic light year\n}\n\nexport interface StarData {\n    id: string;\n    name: string;\n    position: Vector2; // Position in galaxy (light years)\n    type: StarType;\n    mass: number; // Solar masses\n    luminosity: number; // Solar luminosities\n    temperature: number; // Kelvin\n    age: number; // Million years\n    metallicity: number; // 0-1, higher = more heavy elements\n    \n    // Visual properties\n    color: { r: number; g: number; b: number };\n    brightness: number; // 0-1 for rendering\n    radius: number; // Solar radii\n}\n\nexport interface PlanetData {\n    id: string;\n    name: string;\n    starId: string;\n    orbitDistance: number; // AU from star\n    orbitPeriod: number; // Days\n    radius: number; // Earth radii\n    mass: number; // Earth masses\n    type: PlanetType;\n    temperature: number; // Kelvin\n    hasAtmosphere: boolean;\n    atmosphereType?: AtmosphereType;\n    hasRings: boolean;\n    moons: MoonData[];\n    \n    // Surface properties\n    surfaceType: SurfaceType;\n    surfaceColor: { r: number; g: number; b: number };\n    hasWater: boolean;\n    hasLife: boolean;\n}\n\nexport interface MoonData {\n    id: string;\n    name: string;\n    planetId: string;\n    orbitDistance: number; // Planet radii\n    orbitPeriod: number; // Hours\n    radius: number; // Earth radii\n    mass: number; // Earth masses\n    type: 'rocky' | 'icy' | 'captured_asteroid';\n    tidallyLocked: boolean;\n}\n\nexport interface StarSystemData {\n    id: string;\n    name: string;\n    position: Vector2;\n    star: StarData;\n    planets: PlanetData[];\n    asteroidBelts: AsteroidBeltData[];\n    \n    // System properties\n    habitableZoneInner: number; // AU\n    habitableZoneOuter: number; // AU\n    systemAge: number; // Million years\n    metallicity: number;\n    \n    // Generated objects\n    stations?: SpaceStationData[];\n    anomalies?: AnomalyData[];\n}\n\nexport enum StarType {\n    O = 'O', // Blue supergiant\n    B = 'B', // Blue giant\n    A = 'A', // White\n    F = 'F', // Yellow-white\n    G = 'G', // Yellow (like Sun)\n    K = 'K', // Orange\n    M = 'M', // Red dwarf\n    WD = 'WD', // White dwarf\n    NS = 'NS', // Neutron star\n    BH = 'BH'  // Black hole\n}\n\nexport enum PlanetType {\n    Terrestrial = 'terrestrial',\n    GasGiant = 'gas_giant',\n    IceGiant = 'ice_giant',\n    Desert = 'desert',\n    Ocean = 'ocean',\n    Volcanic = 'volcanic',\n    Frozen = 'frozen',\n    Toxic = 'toxic'\n}\n\nexport enum SurfaceType {\n    Rocky = 'rocky',\n    Desert = 'desert',\n    Ocean = 'ocean',\n    Ice = 'ice',\n    Lava = 'lava',\n    Gas = 'gas',\n    Toxic = 'toxic',\n    Crystalline = 'crystalline'\n}\n\nexport enum AtmosphereType {\n    None = 'none',\n    Thin = 'thin',\n    Thick = 'thick',\n    Toxic = 'toxic',\n    Methane = 'methane',\n    Hydrogen = 'hydrogen',\n    CarbonDioxide = 'carbon_dioxide'\n}\n\ninterface AsteroidBeltData {\n    id: string;\n    innerRadius: number; // AU\n    outerRadius: number; // AU\n    density: number; // 0-1\n    composition: 'rocky' | 'metallic' | 'icy';\n}\n\ninterface SpaceStationData {\n    id: string;\n    name: string;\n    position: Vector2;\n    type: 'trading' | 'mining' | 'research' | 'military' | 'abandoned';\n    faction: string;\n    population: number;\n}\n\ninterface AnomalyData {\n    id: string;\n    name: string;\n    position: Vector2;\n    type: 'wormhole' | 'nebula' | 'supernova_remnant' | 'dark_matter' | 'ancient_artifact';\n    strength: number; // 0-1\n}\n\nexport class GalaxyGenerator {\n    private config: GalaxyConfig;\n    private random: SeededRandom;\n    private logger: Logger;\n    \n    // Galaxy data\n    private stars: Map<string, StarData> = new Map();\n    private starSystems: Map<string, StarSystemData> = new Map();\n    private galaxyMap: StarData[] = [];\n\n    constructor(config: Partial<GalaxyConfig> = {}) {\n        this.logger = new Logger('GalaxyGenerator');\n        \n        // Default galaxy configuration\n        this.config = {\n            seed: 42,\n            size: 50000, // 50,000 light years radius\n            starCount: 50, // Reduced for web performance\n            spiralArms: 4,\n            armTightness: 0.3,\n            coreSize: 5000, // 5,000 light years\n            starDensity: 0.1,\n            ...config\n        };\n        \n        this.random = new SeededRandom(this.config.seed);\n        \n        this.logger.info('🌌 Galaxy generator initialized', {\n            seed: this.config.seed,\n            size: this.config.size,\n            starCount: this.config.starCount\n        });\n    }\n\n    /**\n     * Generate the entire galaxy\n     */\n    async generateGalaxy(progressCallback?: (progress: number, message: string) => void): Promise<void> {\n        this.logger.info('🔄 Generating galaxy...');\n        \n        const startTime = performance.now();\n        \n        try {\n            // Generate star positions using spiral galaxy model\n            progressCallback?.(10, 'Creating star positions...');\n            this.generateStarPositions();\n            \n            // Generate star properties\n            progressCallback?.(30, 'Calculating stellar properties...');\n            this.generateStarProperties();\n            \n            // Generate star systems (planets, moons, etc.)\n            progressCallback?.(50, 'Generating planetary systems...');\n            await this.generateStarSystems(progressCallback);\n            \n            // Generate special objects and anomalies\n            progressCallback?.(90, 'Adding cosmic anomalies...');\n            this.generateAnomalies();\n            \n            progressCallback?.(100, 'Galaxy generation complete!');\n            \n            const endTime = performance.now();\n            this.logger.info(`✅ Galaxy generated in ${(endTime - startTime).toFixed(2)}ms`, {\n                stars: this.stars.size,\n                systems: this.starSystems.size\n            });\n            \n        } catch (error) {\n            this.logger.error('❌ Galaxy generation failed', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Generate star positions using spiral galaxy model\n     */\n    private generateStarPositions(): void {\n        this.logger.debug('Generating star positions...');\n        \n        for (let i = 0; i < this.config.starCount; i++) {\n            const position = this.generateSpiralPosition(i);\n            const starId = `star_${i.toString().padStart(4, '0')}`;\n            \n            // Create basic star data (properties will be added later)\n            const star: StarData = {\n                id: starId,\n                name: this.generateStarName(i),\n                position: position,\n                type: StarType.G, // Will be determined later\n                mass: 1.0,\n                luminosity: 1.0,\n                temperature: 5778,\n                age: 4600,\n                metallicity: 0.02,\n                color: { r: 255, g: 255, b: 255 },\n                brightness: 1.0,\n                radius: 1.0\n            };\n            \n            this.stars.set(starId, star);\n            this.galaxyMap.push(star);\n        }\n        \n        this.logger.debug(`Generated ${this.stars.size} star positions`);\n    }\n\n    /**\n     * Generate position using spiral galaxy model\n     */\n    private generateSpiralPosition(index: number): Vector2 {\n        // Distance from galactic center (0 = center, 1 = edge)\n        const normalizedRadius = Math.pow(this.random.next(), 0.7); // Power law distribution\n        const radius = normalizedRadius * this.config.size;\n        \n        // Determine which spiral arm\n        const armIndex = Math.floor(this.random.next() * this.config.spiralArms);\n        const armAngleOffset = (armIndex * 2 * Math.PI) / this.config.spiralArms;\n        \n        // Spiral angle based on distance from center\n        const spiralAngle = armAngleOffset + normalizedRadius * this.config.armTightness * 4 * Math.PI;\n        \n        // Add some random offset to make it less perfect\n        const angleNoise = (this.random.next() - 0.5) * 0.5;\n        const radiusNoise = (this.random.next() - 0.5) * 0.2 * radius;\n        \n        const finalAngle = spiralAngle + angleNoise;\n        const finalRadius = Math.max(0, radius + radiusNoise);\n        \n        return {\n            x: Math.cos(finalAngle) * finalRadius,\n            y: Math.sin(finalAngle) * finalRadius\n        };\n    }\n\n    /**\n     * Generate star names using procedural naming\n     */\n    private generateStarName(index: number): string {\n        const prefixes = ['Alpha', 'Beta', 'Gamma', 'Delta', 'Epsilon', 'Zeta', 'Eta', 'Theta', 'Iota', 'Kappa'];\n        const suffixes = ['Centauri', 'Draconis', 'Lyrae', 'Cygni', 'Aquilae', 'Orionis', 'Ursae', 'Cassiopeiae'];\n        \n        const prefix = prefixes[index % prefixes.length];\n        const suffix = suffixes[Math.floor(index / prefixes.length) % suffixes.length];\n        const number = Math.floor(index / (prefixes.length * suffixes.length)) + 1;\n        \n        return number > 1 ? `${prefix} ${suffix} ${number}` : `${prefix} ${suffix}`;\n    }\n\n    /**\n     * Generate star properties based on stellar evolution\n     */\n    private generateStarProperties(): void {\n        this.logger.debug('Generating star properties...');\n        \n        for (const star of this.stars.values()) {\n            // Determine star type based on galactic position and random factors\n            const distanceFromCore = Math.sqrt(star.position.x ** 2 + star.position.y ** 2);\n            const coreInfluence = Math.max(0, 1 - distanceFromCore / this.config.coreSize);\n            \n            // Metallicity increases closer to galactic center\n            star.metallicity = Math.max(0.001, 0.02 * (0.5 + coreInfluence * 0.5) * this.random.range(0.5, 1.5));\n            \n            // Generate stellar mass (affects everything else)\n            star.mass = this.generateStellarMass();\n            \n            // Determine star type from mass\n            star.type = this.getStarTypeFromMass(star.mass);\n            \n            // Calculate other properties\n            star.luminosity = this.calculateLuminosity(star.mass, star.type);\n            star.temperature = this.calculateTemperature(star.mass, star.type);\n            star.radius = this.calculateRadius(star.mass, star.luminosity, star.temperature);\n            star.age = this.generateStellarAge(star.mass, star.type);\n            \n            // Visual properties\n            star.color = this.getStarColor(star.temperature);\n            star.brightness = Math.min(1.0, star.luminosity / 100); // Scale for visibility\n        }\n        \n        this.logger.debug('Star properties generated');\n    }\n\n    /**\n     * Generate stellar mass using realistic distribution\n     */\n    private generateStellarMass(): number {\n        // Salpeter initial mass function approximation\n        const x = this.random.next();\n        if (x < 0.8) {\n            // Low mass stars (0.1 - 0.8 solar masses)\n            return 0.1 + (0.7 * Math.pow(x / 0.8, 2));\n        } else if (x < 0.95) {\n            // Medium mass stars (0.8 - 3 solar masses)\n            return 0.8 + (2.2 * Math.pow((x - 0.8) / 0.15, 1.5));\n        } else {\n            // High mass stars (3 - 50 solar masses)\n            return 3 + (47 * Math.pow((x - 0.95) / 0.05, 3));\n        }\n    }\n\n    /**\n     * Determine star type from mass\n     */\n    private getStarTypeFromMass(mass: number): StarType {\n        if (mass > 30) return StarType.O;\n        if (mass > 10) return StarType.B;\n        if (mass > 2.5) return StarType.A;\n        if (mass > 1.4) return StarType.F;\n        if (mass > 0.8) return StarType.G;\n        if (mass > 0.5) return StarType.K;\n        return StarType.M;\n    }\n\n    /**\n     * Calculate luminosity from mass and type\n     */\n    private calculateLuminosity(mass: number, type: StarType): number {\n        // Mass-luminosity relation: L ∝ M^α\n        let alpha = 3.5; // Default for main sequence\n        \n        switch (type) {\n            case StarType.O:\n            case StarType.B:\n                alpha = 4.0;\n                break;\n            case StarType.A:\n            case StarType.F:\n                alpha = 3.5;\n                break;\n            case StarType.G:\n                alpha = 4.0;\n                break;\n            case StarType.K:\n            case StarType.M:\n                alpha = 2.3;\n                break;\n        }\n        \n        return Math.pow(mass, alpha);\n    }\n\n    /**\n     * Calculate temperature from mass and type\n     */\n    private calculateTemperature(mass: number, type: StarType): number {\n        const baseTemps = {\n            [StarType.O]: 35000,\n            [StarType.B]: 20000,\n            [StarType.A]: 8500,\n            [StarType.F]: 6500,\n            [StarType.G]: 5500,\n            [StarType.K]: 4000,\n            [StarType.M]: 3000\n        };\n        \n        const baseTemp = (baseTemps as any)[type] || 5500;\n        return baseTemp * this.random.range(0.9, 1.1);\n    }\n\n    /**\n     * Calculate radius from mass, luminosity, and temperature\n     */\n    private calculateRadius(mass: number, luminosity: number, temperature: number): number {\n        // Stefan-Boltzmann law: L = 4πR²σT⁴\n        // R ∝ √(L/T⁴)\n        const solarTemp = 5778;\n        return Math.sqrt(luminosity) * Math.pow(solarTemp / temperature, 2);\n    }\n\n    /**\n     * Generate stellar age\n     */\n    private generateStellarAge(mass: number, type: StarType): number {\n        // Main sequence lifetime ∝ M/L ∝ M^(-2.5)\n        const solarLifetime = 10000; // Million years\n        const lifetime = solarLifetime * Math.pow(mass, -2.5);\n        \n        // Random age between 0 and lifetime\n        return this.random.next() * lifetime;\n    }\n\n    /**\n     * Get star color from temperature\n     */\n    private getStarColor(temperature: number): { r: number; g: number; b: number } {\n        // Simplified blackbody color approximation\n        if (temperature > 25000) return { r: 155, g: 176, b: 255 }; // Blue\n        if (temperature > 10000) return { r: 202, g: 215, b: 255 }; // Blue-white\n        if (temperature > 7500) return { r: 248, g: 247, b: 255 };  // White\n        if (temperature > 6000) return { r: 255, g: 244, b: 234 };  // Yellow-white\n        if (temperature > 5000) return { r: 255, g: 214, b: 170 };  // Yellow\n        if (temperature > 3500) return { r: 255, g: 204, b: 111 };  // Orange\n        return { r: 255, g: 204, b: 111 }; // Red\n    }\n\n    /**\n     * Generate complete star systems\n     */\n    private async generateStarSystems(progressCallback?: (progress: number, message: string) => void): Promise<void> {\n        this.logger.debug('Generating star systems...');\n        \n        let systemCount = 0;\n        const stars = Array.from(this.stars.values());\n        const batchSize = 5; // Reduced batch size for better responsiveness\n        \n        for (let i = 0; i < stars.length; i += batchSize) {\n            const batch = stars.slice(i, i + batchSize);\n            \n            // Process batch\n            for (const star of batch) {\n                // Not all stars have planetary systems\n                if (this.random.next() < 0.7) { // 70% chance of planets\n                    const system = await this.generateStarSystem(star);\n                    this.starSystems.set(star.id, system);\n                    systemCount++;\n                }\n            }\n            \n            // Update progress\n            const progress = 50 + Math.floor((i / stars.length) * 35); // 50-85% range\n            progressCallback?.(progress, `Generated ${systemCount} star systems...`);\n            \n            // Yield control to prevent blocking\n            await new Promise(resolve => setTimeout(resolve, 1));\n        }\n        \n        this.logger.debug(`Generated ${systemCount} star systems`);\n    }\n\n    /**\n     * Generate a single star system\n     */\n    private async generateStarSystem(star: StarData): Promise<StarSystemData> {\n        const system: StarSystemData = {\n            id: star.id,\n            name: `${star.name} System`,\n            position: star.position,\n            star: star,\n            planets: [],\n            asteroidBelts: [],\n            habitableZoneInner: 0,\n            habitableZoneOuter: 0,\n            systemAge: star.age,\n            metallicity: star.metallicity\n        };\n        \n        // Calculate habitable zone\n        const luminosity = star.luminosity;\n        system.habitableZoneInner = Math.sqrt(luminosity / 1.1);\n        system.habitableZoneOuter = Math.sqrt(luminosity / 0.53);\n        \n        // Generate planets\n        const planetCount = Math.floor(this.random.range(0, 8));\n        let currentOrbit = this.random.range(0.1, 0.5); // Start close to star\n        \n        for (let i = 0; i < planetCount; i++) {\n            const planet = this.generatePlanet(star, system, i, currentOrbit);\n            system.planets.push(planet);\n            \n            // Space out orbits realistically\n            currentOrbit *= this.random.range(1.4, 2.0);\n        }\n        \n        // Generate asteroid belts\n        if (this.random.next() < 0.3) { // 30% chance\n            system.asteroidBelts.push({\n                id: `${star.id}_belt_1`,\n                innerRadius: currentOrbit,\n                outerRadius: currentOrbit * 1.5,\n                density: this.random.range(0.3, 0.8),\n                composition: this.random.choice(['rocky', 'metallic', 'icy'])\n            });\n        }\n        \n        return system;\n    }\n\n    /**\n     * Generate a planet\n     */\n    private generatePlanet(star: StarData, system: StarSystemData, index: number, orbitDistance: number): PlanetData {\n        const planetId = `${star.id}_planet_${index}`;\n        \n        // Determine planet type based on distance from star\n        let planetType: PlanetType;\n        if (orbitDistance < system.habitableZoneInner * 0.5) {\n            planetType = PlanetType.Volcanic;\n        } else if (orbitDistance > system.habitableZoneOuter * 2) {\n            planetType = this.random.choice([PlanetType.GasGiant, PlanetType.IceGiant, PlanetType.Frozen]);\n        } else if (orbitDistance >= system.habitableZoneInner && orbitDistance <= system.habitableZoneOuter) {\n            planetType = this.random.choice([PlanetType.Terrestrial, PlanetType.Ocean, PlanetType.Desert]);\n        } else {\n            planetType = this.random.choice([PlanetType.Terrestrial, PlanetType.Desert, PlanetType.Frozen]);\n        }\n        \n        // Calculate planet properties\n        const mass = this.generatePlanetMass(planetType);\n        const radius = this.calculatePlanetRadius(mass, planetType);\n        const temperature = this.calculatePlanetTemperature(star, orbitDistance);\n        \n        const planet: PlanetData = {\n            id: planetId,\n            name: `${star.name} ${this.numberToRoman(index + 1)}`,\n            starId: star.id,\n            orbitDistance: orbitDistance,\n            orbitPeriod: this.calculateOrbitPeriod(orbitDistance, star.mass),\n            radius: radius,\n            mass: mass,\n            type: planetType,\n            temperature: temperature,\n            hasAtmosphere: this.determineAtmosphere(planetType, mass, temperature),\n            hasRings: this.random.next() < 0.1, // 10% chance\n            moons: [],\n            surfaceType: this.determineSurfaceType(planetType, temperature),\n            surfaceColor: this.generateSurfaceColor(planetType),\n            hasWater: temperature > 273 && temperature < 373 && planetType !== PlanetType.GasGiant,\n            hasLife: false // Will be determined later\n        };\n        \n        // Determine atmosphere type\n        if (planet.hasAtmosphere) {\n            planet.atmosphereType = this.determineAtmosphereType(planetType, temperature);\n        }\n        \n        // Generate moons\n        const moonCount = this.generateMoonCount(planetType, mass);\n        for (let j = 0; j < moonCount; j++) {\n            planet.moons.push(this.generateMoon(planet, j));\n        }\n        \n        return planet;\n    }\n\n    /**\n     * Generate planet mass based on type\n     */\n    private generatePlanetMass(type: PlanetType): number {\n        switch (type) {\n            case PlanetType.GasGiant:\n                return this.random.range(50, 500); // Earth masses\n            case PlanetType.IceGiant:\n                return this.random.range(10, 50);\n            case PlanetType.Terrestrial:\n            case PlanetType.Ocean:\n            case PlanetType.Desert:\n            case PlanetType.Volcanic:\n            case PlanetType.Frozen:\n            case PlanetType.Toxic:\n                return this.random.range(0.1, 3.0);\n            default:\n                return 1.0;\n        }\n    }\n\n    /**\n     * Calculate planet radius from mass and type\n     */\n    private calculatePlanetRadius(mass: number, type: PlanetType): number {\n        if (type === PlanetType.GasGiant || type === PlanetType.IceGiant) {\n            return Math.pow(mass, 0.27); // Gas giants have different mass-radius relation\n        } else {\n            return Math.pow(mass, 0.27); // Rocky planets\n        }\n    }\n\n    /**\n     * Calculate planet temperature\n     */\n    private calculatePlanetTemperature(star: StarData, distance: number): number {\n        // Simplified temperature calculation\n        const solarConstant = star.luminosity / (distance * distance);\n        const baseTemp = 278.5 * Math.pow(solarConstant, 0.25); // Effective temperature\n        \n        // Add some randomness for atmosphere effects\n        return baseTemp * this.random.range(0.8, 1.2);\n    }\n\n    /**\n     * Calculate orbit period using Kepler's laws\n     */\n    private calculateOrbitPeriod(distance: number, starMass: number): number {\n        // T² ∝ a³/M (in Earth years)\n        return Math.sqrt(Math.pow(distance, 3) / starMass) * 365.25; // Convert to days\n    }\n\n    /**\n     * Generate other helper methods...\n     */\n    private determineAtmosphere(type: PlanetType, mass: number, temperature: number): boolean {\n        if (type === PlanetType.GasGiant || type === PlanetType.IceGiant) return true;\n        if (mass < 0.1) return false; // Too small to hold atmosphere\n        if (temperature > 2000) return false; // Too hot\n        return this.random.next() < 0.7;\n    }\n\n    private determineSurfaceType(type: PlanetType, temperature: number): SurfaceType {\n        switch (type) {\n            case PlanetType.Ocean: return SurfaceType.Ocean;\n            case PlanetType.Desert: return SurfaceType.Desert;\n            case PlanetType.Volcanic: return SurfaceType.Lava;\n            case PlanetType.Frozen: return SurfaceType.Ice;\n            case PlanetType.GasGiant:\n            case PlanetType.IceGiant: return SurfaceType.Gas;\n            case PlanetType.Toxic: return SurfaceType.Toxic;\n            default: return SurfaceType.Rocky;\n        }\n    }\n\n    private generateSurfaceColor(type: PlanetType): { r: number; g: number; b: number } {\n        switch (type) {\n            case PlanetType.Ocean: return { r: 0, g: 100, b: 200 };\n            case PlanetType.Desert: return { r: 200, g: 150, b: 100 };\n            case PlanetType.Volcanic: return { r: 150, g: 50, b: 0 };\n            case PlanetType.Frozen: return { r: 200, g: 220, b: 255 };\n            case PlanetType.GasGiant: return { r: 180, g: 140, b: 100 };\n            case PlanetType.IceGiant: return { r: 100, g: 150, b: 200 };\n            case PlanetType.Toxic: return { r: 100, g: 150, b: 50 };\n            default: return { r: 120, g: 100, b: 80 };\n        }\n    }\n\n    private determineAtmosphereType(type: PlanetType, temperature: number): AtmosphereType {\n        if (temperature > 1000) return AtmosphereType.Toxic;\n        if (type === PlanetType.GasGiant) return AtmosphereType.Hydrogen;\n        if (type === PlanetType.IceGiant) return AtmosphereType.Methane;\n        if (temperature < 200) return AtmosphereType.Thin;\n        return AtmosphereType.CarbonDioxide;\n    }\n\n    private generateMoonCount(planetType: PlanetType, mass: number): number {\n        if (planetType === PlanetType.GasGiant) return Math.floor(this.random.range(5, 20));\n        if (planetType === PlanetType.IceGiant) return Math.floor(this.random.range(2, 10));\n        if (mass > 1.0) return Math.floor(this.random.range(0, 3));\n        return this.random.next() < 0.3 ? 1 : 0;\n    }\n\n    private generateMoon(planet: PlanetData, index: number): MoonData {\n        return {\n            id: `${planet.id}_moon_${index}`,\n            name: `${planet.name} ${String.fromCharCode(97 + index)}`, // a, b, c...\n            planetId: planet.id,\n            orbitDistance: this.random.range(3, 20), // Planet radii\n            orbitPeriod: this.random.range(12, 168), // Hours\n            radius: this.random.range(0.1, 0.5), // Earth radii\n            mass: this.random.range(0.01, 0.2), // Earth masses\n            type: this.random.choice(['rocky', 'icy', 'captured_asteroid']),\n            tidallyLocked: this.random.next() < 0.8\n        };\n    }\n\n    private generateAnomalies(): void {\n        // Generate special objects and anomalies\n        // This will be implemented based on specific game requirements\n    }\n\n    private numberToRoman(num: number): string {\n        const values = [10, 9, 5, 4, 1];\n        const symbols = ['X', 'IX', 'V', 'IV', 'I'];\n        let result = '';\n        \n        for (let i = 0; i < values.length; i++) {\n            while (num >= values[i]) {\n                result += symbols[i];\n                num -= values[i];\n            }\n        }\n        return result;\n    }\n\n    /**\n     * Public API methods\n     */\n    getStarsInRadius(center: Vector2, radius: number): StarData[] {\n        return this.galaxyMap.filter(star => {\n            const distance = Math.sqrt(\n                Math.pow(star.position.x - center.x, 2) + \n                Math.pow(star.position.y - center.y, 2)\n            );\n            return distance <= radius;\n        });\n    }\n\n    getStarSystem(starId: string): StarSystemData | undefined {\n        return this.starSystems.get(starId);\n    }\n\n    getAllStars(): StarData[] {\n        return [...this.galaxyMap];\n    }\n\n    getAllSystems(): StarSystemData[] {\n        return Array.from(this.starSystems.values());\n    }\n\n    getGalaxyConfig(): GalaxyConfig {\n        return { ...this.config };\n    }\n}\n\n/**\n * Seeded random number generator for consistent generation\n */\nclass SeededRandom {\n    private seed: number;\n\n    constructor(seed: number) {\n        this.seed = seed;\n    }\n\n    next(): number {\n        this.seed = (this.seed * 9301 + 49297) % 233280;\n        return this.seed / 233280;\n    }\n\n    range(min: number, max: number): number {\n        return min + this.next() * (max - min);\n    }\n\n    choice<T>(array: T[]): T {\n        return array[Math.floor(this.next() * array.length)];\n    }\n\n    integer(min: number, max: number): number {\n        return Math.floor(this.range(min, max + 1));\n    }\n}","/**\n * Galaxy Persistence System\n * Handles saving and loading of galaxy data with compression and chunked loading\n */\n\nimport { Logger } from '@utils/Logger';\nimport { \n    GalaxyConfig, \n    StarData, \n    StarSystemData, \n    PlanetData,\n    GalaxyGenerator \n} from './GalaxyGenerator';\nimport { Vector2 } from '@core/Renderer';\nimport { Platform, PlatformDetector } from '@utils/Platform';\n\nexport interface GalaxySaveData {\n    version: string;\n    timestamp: number;\n    config: GalaxyConfig;\n    playerData: PlayerGalaxyData;\n    \n    // Galaxy data\n    stars: CompressedStarData[];\n    systems: CompressedSystemData[];\n    \n    // Discovery and exploration data\n    exploredSystems: string[];\n    discoveredPlanets: string[];\n    visitedLocations: VisitedLocation[];\n    \n    // Player progression in galaxy\n    reputation: Map<string, number>; // Faction reputation\n    tradeRoutes: TradeRoute[];\n}\n\nexport interface PlayerGalaxyData {\n    currentSystemId: string;\n    homeSystemId: string;\n    totalSystemsVisited: number;\n    totalPlanetsExplored: number;\n    totalDistanceTraveled: number; // Light years\n    galaxyDiscoveryProgress: number; // 0-1\n}\n\nexport interface CompressedStarData {\n    id: string;\n    name: string;\n    pos: [number, number]; // [x, y] position\n    type: string; // StarType\n    mass: number;\n    temp: number; // Temperature\n    color: [number, number, number]; // [r, g, b]\n}\n\nexport interface CompressedSystemData {\n    id: string;\n    planets: CompressedPlanetData[];\n    explored: boolean;\n    lastVisited?: number; // Timestamp\n}\n\nexport interface CompressedPlanetData {\n    id: string;\n    name: string;\n    type: string; // PlanetType\n    orbit: number; // Orbit distance\n    radius: number;\n    temp: number; // Temperature\n    hasAtmo: boolean;\n    moons: number; // Moon count\n    color: [number, number, number]; // [r, g, b]\n}\n\nexport interface VisitedLocation {\n    systemId: string;\n    planetId?: string;\n    timestamp: number;\n    coordinates: Vector2;\n    notes?: string;\n}\n\nexport interface TradeRoute {\n    id: string;\n    fromSystemId: string;\n    toSystemId: string;\n    commodity: string;\n    profitMargin: number;\n    discovered: boolean;\n}\n\nexport interface ChunkLoadOptions {\n    center: Vector2;\n    radius: number;\n    maxSystems: number;\n    includeUnexplored: boolean;\n}\n\nexport class GalaxyPersistence {\n    private platform: Platform;\n    private logger: Logger;\n    \n    // Cached data for performance\n    private cachedSaveData: GalaxySaveData | null = null;\n    private loadedChunks: Map<string, StarSystemData[]> = new Map();\n    private compressionEnabled: boolean;\n\n    constructor() {\n        this.platform = PlatformDetector.detect();\n        this.logger = new Logger('GalaxyPersistence');\n        this.compressionEnabled = true; // Enable compression by default\n        \n        this.logger.info('💾 Galaxy persistence system initialized', {\n            platform: this.platform,\n            compressionEnabled: this.compressionEnabled\n        });\n    }\n\n    /**\n     * Save complete galaxy data\n     */\n    async saveGalaxy(\n        generator: GalaxyGenerator,\n        playerData: PlayerGalaxyData,\n        explorationData: {\n            exploredSystems: string[];\n            discoveredPlanets: string[];\n            visitedLocations: VisitedLocation[];\n        }\n    ): Promise<void> {\n        this.logger.info('💾 Saving galaxy data...');\n        \n        const startTime = performance.now();\n        \n        try {\n            // Prepare save data\n            const saveData: GalaxySaveData = {\n                version: '2.0.0',\n                timestamp: Date.now(),\n                config: generator.getGalaxyConfig(),\n                playerData: { ...playerData },\n                stars: [],\n                systems: [],\n                exploredSystems: [...explorationData.exploredSystems],\n                discoveredPlanets: [...explorationData.discoveredPlanets],\n                visitedLocations: [...explorationData.visitedLocations],\n                reputation: new Map(),\n                tradeRoutes: []\n            };\n            \n            // Compress galaxy data\n            saveData.stars = this.compressStarData(generator.getAllStars());\n            saveData.systems = this.compressSystemData(generator.getAllSystems());\n            \n            // Cache the save data\n            this.cachedSaveData = saveData;\n            \n            // Save to storage based on platform\n            await this.saveToStorage(saveData);\n            \n            const endTime = performance.now();\n            this.logger.info(`✅ Galaxy saved successfully in ${(endTime - startTime).toFixed(2)}ms`, {\n                stars: saveData.stars.length,\n                systems: saveData.systems.length,\n                size: this.calculateSaveSize(saveData)\n            });\n            \n        } catch (error) {\n            this.logger.error('❌ Failed to save galaxy', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Load complete galaxy data\n     */\n    async loadGalaxy(): Promise<{\n        generator: GalaxyGenerator;\n        playerData: PlayerGalaxyData;\n        explorationData: {\n            exploredSystems: string[];\n            discoveredPlanets: string[];\n            visitedLocations: VisitedLocation[];\n        };\n    } | null> {\n        this.logger.info('📁 Loading galaxy data...');\n        \n        const startTime = performance.now();\n        \n        try {\n            // Load from storage\n            const saveData = await this.loadFromStorage();\n            if (!saveData) {\n                this.logger.warn('No galaxy save data found');\n                return null;\n            }\n            \n            // Validate save data\n            this.validateSaveData(saveData);\n            \n            // Create generator with saved config\n            const generator = new GalaxyGenerator(saveData.config);\n            \n            // Decompress and restore galaxy data\n            await this.restoreGalaxyData(generator, saveData);\n            \n            const endTime = performance.now();\n            this.logger.info(`✅ Galaxy loaded successfully in ${(endTime - startTime).toFixed(2)}ms`);\n            \n            return {\n                generator,\n                playerData: saveData.playerData,\n                explorationData: {\n                    exploredSystems: saveData.exploredSystems,\n                    discoveredPlanets: saveData.discoveredPlanets,\n                    visitedLocations: saveData.visitedLocations\n                }\n            };\n            \n        } catch (error) {\n            this.logger.error('❌ Failed to load galaxy', error);\n            return null;\n        }\n    }\n\n    /**\n     * Load galaxy chunk for specific region\n     */\n    async loadGalaxyChunk(\n        generator: GalaxyGenerator,\n        options: ChunkLoadOptions\n    ): Promise<StarSystemData[]> {\n        const chunkKey = this.getChunkKey(options.center, options.radius);\n        \n        // Check if chunk is already loaded\n        if (this.loadedChunks.has(chunkKey)) {\n            return this.loadedChunks.get(chunkKey)!;\n        }\n        \n        this.logger.debug(`Loading galaxy chunk: ${chunkKey}`);\n        \n        try {\n            // Get stars in radius\n            const starsInRegion = generator.getStarsInRadius(options.center, options.radius);\n            \n            // Limit to max systems\n            const limitedStars = starsInRegion.slice(0, options.maxSystems);\n            \n            // Load systems for these stars\n            const systems: StarSystemData[] = [];\n            for (const star of limitedStars) {\n                const system = generator.getStarSystem(star.id);\n                if (system) {\n                    // Check if should include unexplored systems\n                    if (options.includeUnexplored || this.isSystemExplored(system.id)) {\n                        systems.push(system);\n                    }\n                }\n            }\n            \n            // Cache the chunk\n            this.loadedChunks.set(chunkKey, systems);\n            \n            this.logger.debug(`Loaded chunk with ${systems.length} systems`);\n            return systems;\n            \n        } catch (error) {\n            this.logger.error(`Failed to load galaxy chunk: ${chunkKey}`, error);\n            return [];\n        }\n    }\n\n    /**\n     * Compress star data for storage\n     */\n    private compressStarData(stars: StarData[]): CompressedStarData[] {\n        return stars.map(star => ({\n            id: star.id,\n            name: star.name,\n            pos: [Math.round(star.position.x), Math.round(star.position.y)],\n            type: star.type,\n            mass: Math.round(star.mass * 100) / 100, // 2 decimal places\n            temp: Math.round(star.temperature),\n            color: [star.color.r, star.color.g, star.color.b]\n        }));\n    }\n\n    /**\n     * Compress system data for storage\n     */\n    private compressSystemData(systems: StarSystemData[]): CompressedSystemData[] {\n        return systems.map(system => ({\n            id: system.id,\n            planets: this.compressPlanetData(system.planets),\n            explored: this.isSystemExplored(system.id)\n        }));\n    }\n\n    /**\n     * Compress planet data for storage\n     */\n    private compressPlanetData(planets: PlanetData[]): CompressedPlanetData[] {\n        return planets.map(planet => ({\n            id: planet.id,\n            name: planet.name,\n            type: planet.type,\n            orbit: Math.round(planet.orbitDistance * 100) / 100,\n            radius: Math.round(planet.radius * 100) / 100,\n            temp: Math.round(planet.temperature),\n            hasAtmo: planet.hasAtmosphere,\n            moons: planet.moons.length,\n            color: [planet.surfaceColor.r, planet.surfaceColor.g, planet.surfaceColor.b]\n        }));\n    }\n\n    /**\n     * Restore galaxy data from compressed format\n     */\n    private async restoreGalaxyData(generator: GalaxyGenerator, saveData: GalaxySaveData): Promise<void> {\n        // Note: This is a simplified restoration process\n        // In a full implementation, we would need to properly reconstruct\n        // the galaxy data structures from compressed format\n        \n        this.logger.debug('Restoring galaxy data from compressed format...');\n        \n        // For now, regenerate the galaxy with the same seed\n        // This ensures consistency while avoiding complex decompression\n        await generator.generateGalaxy();\n        \n        this.logger.debug('Galaxy data restoration completed');\n    }\n\n    /**\n     * Save to storage based on platform\n     */\n    private async saveToStorage(saveData: GalaxySaveData): Promise<void> {\n        const serialized = JSON.stringify(saveData);\n        \n        switch (this.platform) {\n            case Platform.Desktop:\n            case Platform.Web:\n            case Platform.Mobile:\n                // Use localStorage/IndexedDB\n                await this.saveToWebStorage(serialized);\n                break;\n                \n            case Platform.Tauri:\n                // Use file system through Tauri API\n                await this.saveToFileSystem(serialized);\n                break;\n                \n            case Platform.Cordova:\n                // Use Cordova file plugin\n                await this.saveToCordovaFile(serialized);\n                break;\n                \n            default:\n                throw new Error(`Unsupported platform for saving: ${this.platform}`);\n        }\n    }\n\n    /**\n     * Load from storage based on platform\n     */\n    private async loadFromStorage(): Promise<GalaxySaveData | null> {\n        switch (this.platform) {\n            case Platform.Desktop:\n            case Platform.Web:\n            case Platform.Mobile:\n                return await this.loadFromWebStorage();\n                \n            case Platform.Tauri:\n                return await this.loadFromFileSystem();\n                \n            case Platform.Cordova:\n                return await this.loadFromCordovaFile();\n                \n            default:\n                throw new Error(`Unsupported platform for loading: ${this.platform}`);\n        }\n    }\n\n    /**\n     * Save to web storage (localStorage/IndexedDB)\n     */\n    private async saveToWebStorage(data: string): Promise<void> {\n        try {\n            // Try IndexedDB first for larger storage capacity\n            if ('indexedDB' in window) {\n                await this.saveToIndexedDB(data);\n            } else {\n                // Fallback to localStorage\n                localStorage.setItem('spaceExplorer_galaxy', data);\n            }\n        } catch (error) {\n            // If IndexedDB fails, try localStorage\n            try {\n                localStorage.setItem('spaceExplorer_galaxy', data);\n            } catch (localStorageError) {\n                throw new Error('Failed to save to both IndexedDB and localStorage');\n            }\n        }\n    }\n\n    /**\n     * Load from web storage\n     */\n    private async loadFromWebStorage(): Promise<GalaxySaveData | null> {\n        try {\n            // Try IndexedDB first\n            if ('indexedDB' in window) {\n                const data = await this.loadFromIndexedDB();\n                if (data) return data;\n            }\n            \n            // Fallback to localStorage\n            const stored = localStorage.getItem('spaceExplorer_galaxy');\n            return stored ? JSON.parse(stored) : null;\n            \n        } catch (error) {\n            this.logger.error('Failed to load from web storage', error);\n            return null;\n        }\n    }\n\n    /**\n     * Save to IndexedDB for larger storage capacity\n     */\n    private async saveToIndexedDB(data: string): Promise<void> {\n        return new Promise((resolve, reject) => {\n            const request = indexedDB.open('SpaceExplorerDB', 1);\n            \n            request.onerror = () => reject(request.error);\n            \n            request.onupgradeneeded = () => {\n                const db = request.result;\n                if (!db.objectStoreNames.contains('galaxy')) {\n                    db.createObjectStore('galaxy');\n                }\n            };\n            \n            request.onsuccess = () => {\n                const db = request.result;\n                const transaction = db.transaction(['galaxy'], 'readwrite');\n                const store = transaction.objectStore('galaxy');\n                \n                const putRequest = store.put(data, 'galaxyData');\n                putRequest.onsuccess = () => resolve();\n                putRequest.onerror = () => reject(putRequest.error);\n            };\n        });\n    }\n\n    /**\n     * Load from IndexedDB\n     */\n    private async loadFromIndexedDB(): Promise<GalaxySaveData | null> {\n        return new Promise((resolve, reject) => {\n            const request = indexedDB.open('SpaceExplorerDB', 1);\n            \n            request.onerror = () => resolve(null);\n            \n            request.onsuccess = () => {\n                const db = request.result;\n                \n                if (!db.objectStoreNames.contains('galaxy')) {\n                    resolve(null);\n                    return;\n                }\n                \n                const transaction = db.transaction(['galaxy'], 'readonly');\n                const store = transaction.objectStore('galaxy');\n                \n                const getRequest = store.get('galaxyData');\n                getRequest.onsuccess = () => {\n                    const data = getRequest.result;\n                    resolve(data ? JSON.parse(data) : null);\n                };\n                getRequest.onerror = () => resolve(null);\n            };\n        });\n    }\n\n    /**\n     * Save to file system (Tauri)\n     */\n    private async saveToFileSystem(data: string): Promise<void> {\n        // Placeholder for Tauri file system API\n        // This would use the Tauri fs API when available\n        this.logger.warn('File system save not implemented yet');\n        throw new Error('File system save not implemented');\n    }\n\n    /**\n     * Load from file system (Tauri)\n     */\n    private async loadFromFileSystem(): Promise<GalaxySaveData | null> {\n        // Placeholder for Tauri file system API\n        this.logger.warn('File system load not implemented yet');\n        return null;\n    }\n\n    /**\n     * Save to Cordova file\n     */\n    private async saveToCordovaFile(data: string): Promise<void> {\n        // Placeholder for Cordova file plugin\n        this.logger.warn('Cordova file save not implemented yet');\n        throw new Error('Cordova file save not implemented');\n    }\n\n    /**\n     * Load from Cordova file\n     */\n    private async loadFromCordovaFile(): Promise<GalaxySaveData | null> {\n        // Placeholder for Cordova file plugin\n        this.logger.warn('Cordova file load not implemented yet');\n        return null;\n    }\n\n    /**\n     * Validate save data integrity\n     */\n    private validateSaveData(saveData: GalaxySaveData): void {\n        if (!saveData.version) {\n            throw new Error('Invalid save data: missing version');\n        }\n        \n        if (!saveData.config || !saveData.stars || !saveData.systems) {\n            throw new Error('Invalid save data: missing core data');\n        }\n        \n        // Version compatibility check\n        const [major] = saveData.version.split('.').map(Number);\n        if (major !== 2) {\n            throw new Error(`Incompatible save version: ${saveData.version}`);\n        }\n    }\n\n    /**\n     * Calculate save data size\n     */\n    private calculateSaveSize(saveData: GalaxySaveData): string {\n        const serialized = JSON.stringify(saveData);\n        const bytes = new Blob([serialized]).size;\n        \n        if (bytes < 1024) return `${bytes} B`;\n        if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n        return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    }\n\n    /**\n     * Generate chunk key for caching\n     */\n    private getChunkKey(center: Vector2, radius: number): string {\n        const x = Math.round(center.x / 1000) * 1000;\n        const y = Math.round(center.y / 1000) * 1000;\n        const r = Math.round(radius / 100) * 100;\n        return `chunk_${x}_${y}_${r}`;\n    }\n\n    /**\n     * Check if system is explored\n     */\n    private isSystemExplored(systemId: string): boolean {\n        if (!this.cachedSaveData) return false;\n        return this.cachedSaveData.exploredSystems.includes(systemId);\n    }\n\n    /**\n     * Clear cached data\n     */\n    clearCache(): void {\n        this.cachedSaveData = null;\n        this.loadedChunks.clear();\n        this.logger.debug('Galaxy persistence cache cleared');\n    }\n\n    /**\n     * Get storage statistics\n     */\n    getStorageStats(): {\n        cacheSize: number;\n        loadedChunks: number;\n        lastSaveTime?: number;\n    } {\n        return {\n            cacheSize: this.cachedSaveData ? 1 : 0,\n            loadedChunks: this.loadedChunks.size,\n            lastSaveTime: this.cachedSaveData?.timestamp\n        };\n    }\n\n    /**\n     * Export galaxy data for sharing/backup\n     */\n    async exportGalaxy(): Promise<string> {\n        if (!this.cachedSaveData) {\n            throw new Error('No galaxy data to export');\n        }\n        \n        return JSON.stringify(this.cachedSaveData, null, 2);\n    }\n\n    /**\n     * Import galaxy data from backup\n     */\n    async importGalaxy(data: string): Promise<void> {\n        try {\n            const saveData: GalaxySaveData = JSON.parse(data);\n            this.validateSaveData(saveData);\n            \n            await this.saveToStorage(saveData);\n            this.cachedSaveData = saveData;\n            \n            this.logger.info('Galaxy data imported successfully');\n            \n        } catch (error) {\n            this.logger.error('Failed to import galaxy data', error);\n            throw error;\n        }\n    }\n}","/**\n * Galaxy Manager - Integration Layer\n * Provides unified interface for galaxy generation, persistence, and exploration\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2 } from '@core/Renderer';\nimport { \n    GalaxyGenerator, \n    GalaxyConfig, \n    StarData, \n    StarSystemData,\n    PlanetData,\n    StarType\n} from './GalaxyGenerator';\nimport { \n    GalaxyPersistence, \n    PlayerGalaxyData,\n    VisitedLocation,\n    ChunkLoadOptions \n} from './GalaxyPersistence';\n\nexport interface ExplorationData {\n    exploredSystems: Set<string>;\n    discoveredPlanets: Set<string>;\n    visitedLocations: VisitedLocation[];\n    currentSystemId: string;\n    homeSystemId: string;\n}\n\nexport interface GalaxyManagerConfig {\n    enableAutoSave: boolean;\n    autoSaveInterval: number; // milliseconds\n    chunkLoadRadius: number; // light years\n    maxLoadedSystems: number;\n    galaxyConfig?: Partial<GalaxyConfig>;\n}\n\nexport interface GalaxyStats {\n    totalStars: number;\n    totalSystems: number;\n    exploredSystems: number;\n    discoveredPlanets: number;\n    systemsVisited: number;\n    distanceTraveled: number;\n    currentSystemName: string;\n    galaxySize: number;\n    explorationProgress: number; // 0-1\n}\n\nexport class GalaxyManager {\n    private generator: GalaxyGenerator;\n    private persistence: GalaxyPersistence;\n    private config: GalaxyManagerConfig;\n    \n    // Galaxy state\n    private explorationData: ExplorationData;\n    private playerData: PlayerGalaxyData;\n    private isInitialized = false;\n    \n    // Runtime data\n    private loadedSystems: Map<string, StarSystemData> = new Map();\n    private nearbyStars: StarData[] = [];\n    private currentSystem: StarSystemData | null = null;\n    \n    // Auto-save\n    private autoSaveTimer: number | null = null;\n    \n    private logger: Logger;\n\n    constructor(config: Partial<GalaxyManagerConfig> = {}) {\n        this.logger = new Logger('GalaxyManager');\n        \n        // Default configuration\n        this.config = {\n            enableAutoSave: true,\n            autoSaveInterval: 60000, // 1 minute\n            chunkLoadRadius: 500, // 500 light years\n            maxLoadedSystems: 100,\n            galaxyConfig: {\n                seed: Math.floor(Math.random() * 1000000),\n                starCount: 25, // Even smaller for better performance\n                size: 30000 // 30,000 light years\n            },\n            ...config\n        };\n        \n        // Initialize components\n        this.generator = new GalaxyGenerator(this.config.galaxyConfig);\n        this.persistence = new GalaxyPersistence();\n        \n        // Initialize exploration data\n        this.explorationData = {\n            exploredSystems: new Set(),\n            discoveredPlanets: new Set(),\n            visitedLocations: [],\n            currentSystemId: '',\n            homeSystemId: ''\n        };\n        \n        // Initialize player data\n        this.playerData = {\n            currentSystemId: '',\n            homeSystemId: '',\n            totalSystemsVisited: 0,\n            totalPlanetsExplored: 0,\n            totalDistanceTraveled: 0,\n            galaxyDiscoveryProgress: 0\n        };\n        \n        this.logger.info('🌌 Galaxy manager initialized', {\n            config: this.config\n        });\n    }\n\n    /**\n     * Initialize the galaxy (load existing or generate new)\n     */\n    async initialize(): Promise<void> {\n        this.logger.info('🚀 Initializing galaxy...');\n        \n        try {\n            // Set timeout for galaxy generation\n            const timeoutPromise = new Promise((_, reject) => {\n                setTimeout(() => reject(new Error('Galaxy generation timeout')), 30000); // 30 second timeout\n            });\n            \n            const initPromise = this.doInitialize();\n            \n            // Race between initialization and timeout\n            await Promise.race([initPromise, timeoutPromise]);\n            \n        } catch (error) {\n            this.logger.error('❌ Galaxy initialization failed, using fallback', error);\n            \n            // Clear any partial state\n            this.loadedSystems.clear();\n            \n            // Fallback to minimal galaxy\n            await this.initializeFallbackGalaxy();\n        }\n    }\n    \n    private async doInitialize(): Promise<void> {\n        // Try to load existing galaxy\n        const savedData = await this.persistence.loadGalaxy();\n        \n        if (savedData) {\n            // Load from save\n            this.logger.info('📁 Loading existing galaxy...');\n            this.generator = savedData.generator;\n            this.playerData = savedData.playerData;\n            \n            // Convert arrays back to Sets\n            this.explorationData = {\n                exploredSystems: new Set(savedData.explorationData.exploredSystems),\n                discoveredPlanets: new Set(savedData.explorationData.discoveredPlanets),\n                visitedLocations: savedData.explorationData.visitedLocations,\n                currentSystemId: savedData.playerData.currentSystemId,\n                homeSystemId: savedData.playerData.homeSystemId\n            };\n            \n        } else {\n            // Generate new galaxy\n            this.logger.info('🔄 Generating new galaxy...');\n            await this.generator.generateGalaxy();\n            \n            // Set up initial player data\n            await this.setupNewGame();\n        }\n        \n        // Load current system and nearby area\n        await this.loadCurrentArea();\n        \n        // Setup auto-save\n        if (this.config.enableAutoSave) {\n            this.setupAutoSave();\n        }\n        \n        this.isInitialized = true;\n        this.logger.info('✅ Galaxy initialization completed');\n    }\n    \n    private async initializeFallbackGalaxy(): Promise<void> {\n        this.logger.info('🔄 Creating minimal galaxy...');\n        \n        // Create a very simple galaxy with just a few stars\n        this.generator = new GalaxyGenerator({\n            ...this.config.galaxyConfig,\n            starCount: 5 // Minimal galaxy\n        });\n        \n        await this.generator.generateGalaxy();\n        await this.setupNewGame();\n        \n        this.isInitialized = true;\n        this.logger.info('✅ Fallback galaxy ready');\n    }\n\n    /**\n     * Setup new game with starting system\n     */\n    private async setupNewGame(): Promise<void> {\n        // Find a suitable starting system near galactic center\n        const centerStars = this.generator.getStarsInRadius({ x: 0, y: 0 }, 5000);\n        \n        // Find a G-type star with planets\n        let startingSystem: StarSystemData | null = null;\n        for (const star of centerStars) {\n            if (star.type === StarType.G) { // Sun-like star\n                const system = this.generator.getStarSystem(star.id);\n                if (system && system.planets.length > 0) {\n                    startingSystem = system;\n                    break;\n                }\n            }\n        }\n        \n        // Fallback to any system with planets\n        if (!startingSystem) {\n            for (const star of centerStars) {\n                const system = this.generator.getStarSystem(star.id);\n                if (system && system.planets.length > 0) {\n                    startingSystem = system;\n                    break;\n                }\n            }\n        }\n        \n        if (!startingSystem) {\n            throw new Error('Could not find suitable starting system');\n        }\n        \n        // Set starting system\n        this.explorationData.currentSystemId = startingSystem.id;\n        this.explorationData.homeSystemId = startingSystem.id;\n        this.playerData.currentSystemId = startingSystem.id;\n        this.playerData.homeSystemId = startingSystem.id;\n        \n        // Mark as explored\n        this.exploreSystem(startingSystem.id);\n        \n        this.logger.info(`🏠 Starting system set: ${startingSystem.name}`);\n    }\n\n    /**\n     * Load current area around player\n     */\n    private async loadCurrentArea(): Promise<void> {\n        if (!this.explorationData.currentSystemId) return;\n        \n        // Get current system\n        this.currentSystem = this.generator.getStarSystem(this.explorationData.currentSystemId) || null;\n        if (!this.currentSystem) {\n            this.logger.error('Current system not found');\n            return;\n        }\n        \n        // Load nearby systems\n        const chunkOptions: ChunkLoadOptions = {\n            center: this.currentSystem.position,\n            radius: this.config.chunkLoadRadius,\n            maxSystems: this.config.maxLoadedSystems,\n            includeUnexplored: true\n        };\n        \n        const nearbySystems = await this.persistence.loadGalaxyChunk(this.generator, chunkOptions);\n        \n        // Update loaded systems\n        this.loadedSystems.clear();\n        for (const system of nearbySystems) {\n            this.loadedSystems.set(system.id, system);\n        }\n        \n        // Get nearby stars for rendering\n        this.nearbyStars = this.generator.getStarsInRadius(\n            this.currentSystem.position,\n            this.config.chunkLoadRadius / 2\n        );\n        \n        this.logger.debug(`Loaded ${nearbySystems.length} systems and ${this.nearbyStars.length} stars`);\n    }\n\n    /**\n     * Travel to a new system\n     */\n    async travelToSystem(systemId: string): Promise<boolean> {\n        const targetSystem = this.generator.getStarSystem(systemId);\n        if (!targetSystem) {\n            this.logger.error(`System not found: ${systemId}`);\n            return false;\n        }\n        \n        // Calculate travel distance\n        const currentPos = this.currentSystem?.position || { x: 0, y: 0 };\n        const distance = Math.sqrt(\n            Math.pow(targetSystem.position.x - currentPos.x, 2) +\n            Math.pow(targetSystem.position.y - currentPos.y, 2)\n        );\n        \n        // Update player data\n        this.explorationData.currentSystemId = systemId;\n        this.playerData.currentSystemId = systemId;\n        this.playerData.totalDistanceTraveled += distance;\n        \n        // Add to visited systems if not already visited\n        if (!this.explorationData.exploredSystems.has(systemId)) {\n            this.playerData.totalSystemsVisited++;\n        }\n        \n        // Explore the system\n        this.exploreSystem(systemId);\n        \n        // Add to visited locations\n        this.explorationData.visitedLocations.push({\n            systemId: systemId,\n            timestamp: Date.now(),\n            coordinates: targetSystem.position\n        });\n        \n        // Reload area around new system\n        await this.loadCurrentArea();\n        \n        this.logger.info(`🚀 Traveled to ${targetSystem.name} (${distance.toFixed(1)} LY)`);\n        return true;\n    }\n\n    /**\n     * Explore a system (mark as explored)\n     */\n    exploreSystem(systemId: string): void {\n        if (!this.explorationData.exploredSystems.has(systemId)) {\n            this.explorationData.exploredSystems.add(systemId);\n            \n            // Explore all planets in the system\n            const system = this.generator.getStarSystem(systemId);\n            if (system) {\n                for (const planet of system.planets) {\n                    this.discoverPlanet(planet.id);\n                }\n            }\n            \n            this.updateExplorationProgress();\n            this.logger.debug(`System explored: ${systemId}`);\n        }\n    }\n\n    /**\n     * Discover a planet\n     */\n    discoverPlanet(planetId: string): void {\n        if (!this.explorationData.discoveredPlanets.has(planetId)) {\n            this.explorationData.discoveredPlanets.add(planetId);\n            this.playerData.totalPlanetsExplored++;\n            \n            this.logger.debug(`Planet discovered: ${planetId}`);\n        }\n    }\n\n    /**\n     * Update exploration progress\n     */\n    private updateExplorationProgress(): void {\n        const totalSystems = this.generator.getAllSystems().length;\n        const exploredSystems = this.explorationData.exploredSystems.size;\n        \n        this.playerData.galaxyDiscoveryProgress = totalSystems > 0 ? exploredSystems / totalSystems : 0;\n    }\n\n    /**\n     * Get nearby systems for rendering\n     */\n    getNearbyStars(): StarData[] {\n        return [...this.nearbyStars];\n    }\n\n    /**\n     * Get loaded systems\n     */\n    getLoadedSystems(): StarSystemData[] {\n        return Array.from(this.loadedSystems.values());\n    }\n\n    /**\n     * Get current system\n     */\n    getCurrentSystem(): StarSystemData | null {\n        return this.currentSystem;\n    }\n\n    /**\n     * Get system by ID\n     */\n    getSystem(systemId: string): StarSystemData | undefined {\n        return this.loadedSystems.get(systemId) || this.generator.getStarSystem(systemId);\n    }\n\n    /**\n     * Find systems within radius\n     */\n    findSystemsInRadius(center: Vector2, radius: number): StarSystemData[] {\n        const nearbyStars = this.generator.getStarsInRadius(center, radius);\n        const systems: StarSystemData[] = [];\n        \n        for (const star of nearbyStars) {\n            const system = this.generator.getStarSystem(star.id);\n            if (system) {\n                systems.push(system);\n            }\n        }\n        \n        return systems;\n    }\n\n    /**\n     * Check if system is explored\n     */\n    isSystemExplored(systemId: string): boolean {\n        return this.explorationData.exploredSystems.has(systemId);\n    }\n\n    /**\n     * Check if planet is discovered\n     */\n    isPlanetDiscovered(planetId: string): boolean {\n        return this.explorationData.discoveredPlanets.has(planetId);\n    }\n\n    /**\n     * Get galaxy statistics\n     */\n    getGalaxyStats(): GalaxyStats {\n        const totalStars = this.generator.getAllStars().length;\n        const allSystems = this.generator.getAllSystems();\n        const totalSystems = allSystems.length;\n        const totalPlanets = allSystems.reduce((sum, system) => sum + system.planets.length, 0);\n        \n        return {\n            totalStars: totalStars,\n            totalSystems: totalSystems,\n            exploredSystems: this.explorationData.exploredSystems.size,\n            discoveredPlanets: this.explorationData.discoveredPlanets.size,\n            systemsVisited: this.playerData.totalSystemsVisited,\n            distanceTraveled: this.playerData.totalDistanceTraveled,\n            currentSystemName: this.currentSystem?.name || 'Unknown',\n            galaxySize: this.generator.getGalaxyConfig().size,\n            explorationProgress: this.playerData.galaxyDiscoveryProgress\n        };\n    }\n\n    /**\n     * Save galaxy state\n     */\n    async saveGalaxy(): Promise<void> {\n        if (!this.isInitialized) return;\n        \n        try {\n            // Convert Sets to Arrays for serialization\n            const explorationData = {\n                exploredSystems: Array.from(this.explorationData.exploredSystems),\n                discoveredPlanets: Array.from(this.explorationData.discoveredPlanets),\n                visitedLocations: this.explorationData.visitedLocations\n            };\n            \n            await this.persistence.saveGalaxy(\n                this.generator,\n                this.playerData,\n                explorationData\n            );\n            \n            this.logger.debug('Galaxy saved successfully');\n            \n        } catch (error) {\n            this.logger.error('Failed to save galaxy', error);\n        }\n    }\n\n    /**\n     * Setup auto-save timer\n     */\n    private setupAutoSave(): void {\n        if (this.autoSaveTimer) {\n            clearInterval(this.autoSaveTimer);\n        }\n        \n        this.autoSaveTimer = window.setInterval(async () => {\n            await this.saveGalaxy();\n        }, this.config.autoSaveInterval);\n        \n        this.logger.debug(`Auto-save enabled (${this.config.autoSaveInterval}ms interval)`);\n    }\n\n    /**\n     * Get player galaxy data\n     */\n    getPlayerData(): PlayerGalaxyData {\n        return { ...this.playerData };\n    }\n\n    /**\n     * Get exploration data\n     */\n    getExplorationData(): ExplorationData {\n        return {\n            exploredSystems: new Set(this.explorationData.exploredSystems),\n            discoveredPlanets: new Set(this.explorationData.discoveredPlanets),\n            visitedLocations: [...this.explorationData.visitedLocations],\n            currentSystemId: this.explorationData.currentSystemId,\n            homeSystemId: this.explorationData.homeSystemId\n        };\n    }\n\n    /**\n     * Export galaxy for sharing\n     */\n    async exportGalaxy(): Promise<string> {\n        return await this.persistence.exportGalaxy();\n    }\n\n    /**\n     * Import galaxy from backup\n     */\n    async importGalaxy(data: string): Promise<void> {\n        await this.persistence.importGalaxy(data);\n        \n        // Reinitialize after import\n        this.isInitialized = false;\n        await this.initialize();\n    }\n\n    /**\n     * Get storage statistics\n     */\n    getStorageStats() {\n        return this.persistence.getStorageStats();\n    }\n\n    /**\n     * Search for systems by name\n     */\n    searchSystems(query: string): StarSystemData[] {\n        const allSystems = this.generator.getAllSystems();\n        const lowercaseQuery = query.toLowerCase();\n        \n        return allSystems.filter(system => \n            system.name.toLowerCase().includes(lowercaseQuery) ||\n            system.star.name.toLowerCase().includes(lowercaseQuery)\n        ).slice(0, 20); // Limit results\n    }\n\n    /**\n     * Get distance between two systems\n     */\n    getSystemDistance(systemId1: string, systemId2: string): number {\n        const system1 = this.getSystem(systemId1);\n        const system2 = this.getSystem(systemId2);\n        \n        if (!system1 || !system2) return -1;\n        \n        return Math.sqrt(\n            Math.pow(system2.position.x - system1.position.x, 2) +\n            Math.pow(system2.position.y - system1.position.y, 2)\n        );\n    }\n\n    /**\n     * Get home system\n     */\n    getHomeSystem(): StarSystemData | null {\n        if (!this.explorationData.homeSystemId) return null;\n        return this.getSystem(this.explorationData.homeSystemId) || null;\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(newConfig: Partial<GalaxyManagerConfig>): void {\n        this.config = { ...this.config, ...newConfig };\n        \n        // Restart auto-save if interval changed\n        if (newConfig.autoSaveInterval && this.config.enableAutoSave) {\n            this.setupAutoSave();\n        }\n        \n        this.logger.debug('Galaxy manager configuration updated');\n    }\n\n    /**\n     * Cleanup resources\n     */\n    async cleanup(): Promise<void> {\n        // Save before cleanup\n        await this.saveGalaxy();\n        \n        // Clear auto-save timer\n        if (this.autoSaveTimer) {\n            clearInterval(this.autoSaveTimer);\n            this.autoSaveTimer = null;\n        }\n        \n        // Clear cached data\n        this.loadedSystems.clear();\n        this.nearbyStars = [];\n        this.persistence.clearCache();\n        \n        this.logger.info('🧹 Galaxy manager cleanup completed');\n    }\n\n    /**\n     * Check if galaxy is initialized\n     */\n    isGalaxyInitialized(): boolean {\n        return this.isInitialized;\n    }\n}","/**\n * Retro Cockpit Status Bar\n * 5-panel status bar with CRT monitor styling and interactive controls\n */\n\nimport { Renderer, Color } from '@core/Renderer';\nimport { InputManager } from '@core/InputManager';\nimport { SystemStatus, PowerAllocation, DamageReport, ShipSection } from '@entities/ShipSystems';\nimport { Logger } from '@utils/Logger';\nimport { Vector2 } from '@core/Renderer';\n\nexport interface StatusBarConfig {\n    screenWidth: number;\n    screenHeight: number;\n    panelHeight: number;\n    panelSpacing: number;\n    enableInteraction: boolean;\n    crtEffects: boolean;\n}\n\nexport interface PanelInteraction {\n    onPowerAllocationChange?: (allocation: Partial<PowerAllocation>) => void;\n    onSystemToggle?: (system: string, state: boolean) => void;\n    onRepairRequest?: (section: ShipSection, damageIndex: number) => void;\n    onInventoryOpen?: () => void;\n    onCodexOpen?: () => void;\n    onResearchOpen?: () => void;\n    onCrewOpen?: () => void;\n    onRadarZoom?: (zoomLevel: number) => void;\n    onGalaxyMapOpen?: () => void;\n}\n\ninterface PanelArea {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    title: string;\n}\n\ninterface InteractiveElement {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    type: 'button' | 'slider' | 'toggle' | 'monitor';\n    id: string;\n    value?: number; // For sliders\n    state?: boolean; // For toggles\n    label: string;\n}\n\nexport class CockpitStatusBar {\n    private config: StatusBarConfig;\n    private panels: PanelArea[] = [];\n    private interactiveElements: Map<string, InteractiveElement> = new Map();\n    private interactions: PanelInteraction;\n    \n    // Visual state\n    private flickerTimer = 0;\n    private scanlineOffset = 0;\n    private glitchTimer = 0;\n    \n    // Input handling\n    private hoveredElement: string | null = null;\n    private selectedElement: string | null = null;\n    private isDragging = false;\n    \n    // Data display\n    private systemStatus: SystemStatus;\n    private damageReports: Map<ShipSection, DamageReport[]> = new Map();\n    private cargoLoad = 0;\n    private radarZoom = 1.0;\n    private radarMode: 'system' | 'interstellar' = 'system';\n    \n    private logger: Logger;\n\n    constructor(\n        config: Partial<StatusBarConfig> = {},\n        interactions: PanelInteraction = {}\n    ) {\n        this.logger = new Logger('CockpitStatusBar');\n        this.interactions = interactions;\n        \n        // Default configuration\n        this.config = {\n            screenWidth: 1024,\n            screenHeight: 768,\n            panelHeight: 115, // 15% of 768px\n            panelSpacing: 5,\n            enableInteraction: true,\n            crtEffects: true,\n            ...config\n        };\n        \n        // Initialize default system status\n        this.systemStatus = {\n            hull: 100,\n            shields: 100,\n            power: 100,\n            fuel: 100,\n            heat: 0,\n            enginesOnline: true,\n            shieldsOnline: true,\n            weaponsOnline: true,\n            lifeSupport: true,\n            warpDrive: true,\n            engineEfficiency: 1.0,\n            shieldStrength: 1.0,\n            weaponAccuracy: 1.0,\n            sensorRange: 1.0\n        };\n        \n        this.setupPanels();\n        this.setupInteractiveElements();\n        \n        this.logger.info('🖥️ Cockpit status bar initialized', {\n            panels: this.panels.length,\n            interactiveElements: this.interactiveElements.size\n        });\n    }\n\n    /**\n     * Setup the 5 main panels\n     */\n    private setupPanels(): void {\n        const totalWidth = this.config.screenWidth;\n        const panelWidth = (totalWidth - (this.config.panelSpacing * 6)) / 5;\n        const startY = this.config.screenHeight - this.config.panelHeight;\n        \n        this.panels = [\n            {\n                x: this.config.panelSpacing,\n                y: startY,\n                width: panelWidth,\n                height: this.config.panelHeight,\n                title: 'SHIP SYSTEMS'\n            },\n            {\n                x: this.config.panelSpacing + (panelWidth + this.config.panelSpacing) * 1,\n                y: startY,\n                width: panelWidth,\n                height: this.config.panelHeight,\n                title: 'SHIP CONTROL'\n            },\n            {\n                x: this.config.panelSpacing + (panelWidth + this.config.panelSpacing) * 2,\n                y: startY,\n                width: panelWidth,\n                height: this.config.panelHeight,\n                title: 'DAMAGE & CARGO'\n            },\n            {\n                x: this.config.panelSpacing + (panelWidth + this.config.panelSpacing) * 3,\n                y: startY,\n                width: panelWidth,\n                height: this.config.panelHeight,\n                title: 'WEAPONS'\n            },\n            {\n                x: this.config.panelSpacing + (panelWidth + this.config.panelSpacing) * 4,\n                y: startY,\n                width: panelWidth,\n                height: this.config.panelHeight,\n                title: 'RADAR & NAV'\n            }\n        ];\n    }\n\n    /**\n     * Setup interactive elements for each panel\n     */\n    private setupInteractiveElements(): void {\n        this.setupSystemsPanel();\n        this.setupControlPanel();\n        this.setupDamagePanel();\n        this.setupWeaponsPanel();\n        this.setupRadarPanel();\n    }\n\n    /**\n     * Setup ship systems panel (Panel 1)\n     */\n    private setupSystemsPanel(): void {\n        const panel = this.panels[0];\n        const elementWidth = 25;\n        const elementHeight = 8;\n        \n        // Status indicators\n        this.addElement('hull_indicator', panel.x + 10, panel.y + 20, elementWidth, elementHeight, 'monitor', 'HULL');\n        this.addElement('shields_indicator', panel.x + 10, panel.y + 35, elementWidth, elementHeight, 'monitor', 'SHIELDS');\n        this.addElement('power_indicator', panel.x + 10, panel.y + 50, elementWidth, elementHeight, 'monitor', 'POWER');\n        this.addElement('fuel_indicator', panel.x + 10, panel.y + 65, elementWidth, elementHeight, 'monitor', 'FUEL');\n        this.addElement('heat_indicator', panel.x + 10, panel.y + 80, elementWidth, elementHeight, 'monitor', 'HEAT');\n        \n        // Critical warning lights\n        this.addElement('reactor_warning', panel.x + 80, panel.y + 20, 12, 12, 'button', 'RCTR');\n        this.addElement('hull_warning', panel.x + 80, panel.y + 35, 12, 12, 'button', 'HULL');\n        this.addElement('shield_warning', panel.x + 80, panel.y + 50, 12, 12, 'button', 'SHLD');\n        this.addElement('warp_warning', panel.x + 80, panel.y + 65, 12, 12, 'button', 'WARP');\n    }\n\n    /**\n     * Setup ship control panel (Panel 2)\n     */\n    private setupControlPanel(): void {\n        const panel = this.panels[1];\n        \n        // System toggles\n        this.addElement('engines_toggle', panel.x + 10, panel.y + 20, 30, 15, 'toggle', 'ENGINES');\n        this.addElement('shields_toggle', panel.x + 50, panel.y + 20, 30, 15, 'toggle', 'SHIELDS');\n        this.addElement('weapons_toggle', panel.x + 90, panel.y + 20, 30, 15, 'toggle', 'WEAPONS');\n        this.addElement('warp_toggle', panel.x + 130, panel.y + 20, 30, 15, 'toggle', 'WARP');\n        \n        // Power sliders\n        this.addElement('thrust_slider', panel.x + 10, panel.y + 45, 60, 10, 'slider', 'THRUST');\n        this.addElement('shield_slider', panel.x + 80, panel.y + 45, 60, 10, 'slider', 'SHIELDS');\n        \n        // Emergency button\n        this.addElement('autodestruct', panel.x + 60, panel.y + 70, 40, 20, 'button', 'AUTO-DESTRUCT');\n    }\n\n    /**\n     * Setup damage and cargo panel (Panel 3)\n     */\n    private setupDamagePanel(): void {\n        const panel = this.panels[2];\n        \n        // Damage monitor (central area)\n        this.addElement('damage_monitor', panel.x + 10, panel.y + 20, 80, 50, 'monitor', 'DAMAGE');\n        \n        // Cargo load indicator\n        this.addElement('cargo_indicator', panel.x + 100, panel.y + 20, 60, 15, 'monitor', 'CARGO');\n        \n        // Interface buttons\n        this.addElement('inventory_btn', panel.x + 10, panel.y + 80, 35, 15, 'button', 'INV');\n        this.addElement('codex_btn', panel.x + 50, panel.y + 80, 35, 15, 'button', 'CODEX');\n        this.addElement('research_btn', panel.x + 90, panel.y + 80, 35, 15, 'button', 'RSCH');\n        this.addElement('crew_btn', panel.x + 130, panel.y + 80, 35, 15, 'button', 'CREW');\n    }\n\n    /**\n     * Setup weapons panel (Panel 4)\n     */\n    private setupWeaponsPanel(): void {\n        const panel = this.panels[3];\n        \n        // Weapon selection\n        this.addElement('weapon1_btn', panel.x + 10, panel.y + 20, 40, 15, 'button', 'LASER');\n        this.addElement('weapon2_btn', panel.x + 55, panel.y + 20, 40, 15, 'button', 'PLASMA');\n        this.addElement('weapon3_btn', panel.x + 100, panel.y + 20, 40, 15, 'button', 'MISSILE');\n        \n        // Weapon info monitor\n        this.addElement('weapon_monitor', panel.x + 10, panel.y + 40, 130, 25, 'monitor', 'WEAPON INFO');\n        \n        // Warning lights\n        this.addElement('overheat_warning', panel.x + 10, panel.y + 75, 15, 15, 'button', 'HOT');\n        this.addElement('ammo_warning', panel.x + 30, panel.y + 75, 15, 15, 'button', 'AMMO');\n        this.addElement('energy_warning', panel.x + 50, panel.y + 75, 15, 15, 'button', 'PWR');\n        \n        // Warp drive button\n        this.addElement('warp_button', panel.x + 80, panel.y + 75, 50, 15, 'button', 'WARP');\n    }\n\n    /**\n     * Setup radar and navigation panel (Panel 5)\n     */\n    private setupRadarPanel(): void {\n        const panel = this.panels[4];\n        \n        // Radar display\n        this.addElement('radar_display', panel.x + 10, panel.y + 20, 80, 50, 'monitor', 'RADAR');\n        \n        // Radar controls\n        this.addElement('zoom_in', panel.x + 100, panel.y + 20, 20, 15, 'button', 'Z+');\n        this.addElement('zoom_out', panel.x + 125, panel.y + 20, 20, 15, 'button', 'Z-');\n        this.addElement('radar_mode', panel.x + 100, panel.y + 40, 45, 15, 'toggle', 'MODE');\n        this.addElement('galaxy_map', panel.x + 100, panel.y + 60, 45, 15, 'button', 'GALAXY');\n    }\n\n    /**\n     * Add interactive element\n     */\n    private addElement(\n        id: string, \n        x: number, \n        y: number, \n        width: number, \n        height: number, \n        type: 'button' | 'slider' | 'toggle' | 'monitor',\n        label: string\n    ): void {\n        this.interactiveElements.set(id, {\n            x, y, width, height, type, id, label,\n            value: type === 'slider' ? 50 : undefined,\n            state: type === 'toggle' ? true : undefined\n        });\n    }\n\n    /**\n     * Update status bar (called each frame)\n     */\n    update(deltaTime: number, input: InputManager): void {\n        // Update visual effects\n        this.updateVisualEffects(deltaTime);\n        \n        // Handle input if interaction is enabled\n        if (this.config.enableInteraction) {\n            this.handleInput(input);\n        }\n    }\n\n    /**\n     * Update visual effects (flicker, scanlines, glitch)\n     */\n    private updateVisualEffects(deltaTime: number): void {\n        this.flickerTimer += deltaTime;\n        this.scanlineOffset += deltaTime * 100; // Scanline speed\n        this.glitchTimer += deltaTime;\n        \n        // Reset timers to prevent overflow\n        if (this.flickerTimer > 10) this.flickerTimer = 0;\n        if (this.scanlineOffset > 1000) this.scanlineOffset = 0;\n        if (this.glitchTimer > 5) this.glitchTimer = 0;\n    }\n\n    /**\n     * Handle user input\n     */\n    private handleInput(input: InputManager): void {\n        const mousePos = input.getMousePosition();\n        \n        // Check for element hover\n        this.hoveredElement = null;\n        for (const [id, element] of this.interactiveElements) {\n            if (this.isPointInElement(mousePos, element)) {\n                this.hoveredElement = id;\n                break;\n            }\n        }\n        \n        // Handle clicks\n        if (input.isMouseButtonPressed(0)) {\n            if (this.hoveredElement) {\n                this.handleElementClick(this.hoveredElement);\n            }\n        }\n        \n        // Handle dragging for sliders\n        if (input.isMouseButtonDown(0) && this.selectedElement) {\n            const element = this.interactiveElements.get(this.selectedElement);\n            if (element && element.type === 'slider') {\n                this.handleSliderDrag(element, mousePos);\n            }\n        } else {\n            this.selectedElement = null;\n            this.isDragging = false;\n        }\n    }\n\n    /**\n     * Check if point is inside element\n     */\n    private isPointInElement(point: Vector2, element: InteractiveElement): boolean {\n        return point.x >= element.x && \n               point.x <= element.x + element.width &&\n               point.y >= element.y && \n               point.y <= element.y + element.height;\n    }\n\n    /**\n     * Handle element click\n     */\n    private handleElementClick(elementId: string): void {\n        const element = this.interactiveElements.get(elementId);\n        if (!element) return;\n        \n        this.selectedElement = elementId;\n        \n        switch (element.type) {\n            case 'button':\n                this.handleButtonClick(elementId);\n                break;\n            case 'toggle':\n                this.handleToggleClick(elementId, element);\n                break;\n            case 'slider':\n                this.isDragging = true;\n                break;\n        }\n    }\n\n    /**\n     * Handle button clicks\n     */\n    private handleButtonClick(elementId: string): void {\n        switch (elementId) {\n            case 'autodestruct':\n                // Confirmation would be needed\n                this.logger.warn('🛑 Auto-destruct sequence requested');\n                break;\n            case 'inventory_btn':\n                this.interactions.onInventoryOpen?.();\n                break;\n            case 'codex_btn':\n                this.interactions.onCodexOpen?.();\n                break;\n            case 'research_btn':\n                this.interactions.onResearchOpen?.();\n                break;\n            case 'crew_btn':\n                this.interactions.onCrewOpen?.();\n                break;\n            case 'galaxy_map':\n                this.interactions.onGalaxyMapOpen?.();\n                break;\n            case 'zoom_in':\n                this.radarZoom = Math.min(5.0, this.radarZoom * 1.5);\n                this.interactions.onRadarZoom?.(this.radarZoom);\n                break;\n            case 'zoom_out':\n                this.radarZoom = Math.max(0.2, this.radarZoom / 1.5);\n                this.interactions.onRadarZoom?.(this.radarZoom);\n                break;\n        }\n    }\n\n    /**\n     * Handle toggle clicks\n     */\n    private handleToggleClick(elementId: string, element: InteractiveElement): void {\n        element.state = !element.state;\n        \n        const systemMap: Record<string, string> = {\n            'engines_toggle': 'engines',\n            'shields_toggle': 'shields',\n            'weapons_toggle': 'weapons',\n            'warp_toggle': 'warp_drive',\n            'radar_mode': 'radar_mode'\n        };\n        \n        const systemName = systemMap[elementId];\n        if (systemName) {\n            if (systemName === 'radar_mode') {\n                this.radarMode = this.radarMode === 'system' ? 'interstellar' : 'system';\n            } else {\n                this.interactions.onSystemToggle?.(systemName, element.state!);\n            }\n        }\n    }\n\n    /**\n     * Handle slider dragging\n     */\n    private handleSliderDrag(element: InteractiveElement, mousePos: Vector2): void {\n        const localX = mousePos.x - element.x;\n        const percentage = Math.max(0, Math.min(100, (localX / element.width) * 100));\n        element.value = percentage;\n        \n        // Update power allocation\n        if (element.id === 'thrust_slider') {\n            this.interactions.onPowerAllocationChange?.({ engines: percentage });\n        } else if (element.id === 'shield_slider') {\n            this.interactions.onPowerAllocationChange?.({ shields: percentage });\n        }\n    }\n\n    /**\n     * Render the status bar\n     */\n    render(renderer: Renderer): void {\n        // Render background base\n        this.renderPanelBase(renderer);\n        \n        // Render each panel\n        this.panels.forEach((panel, index) => {\n            this.renderPanel(renderer, panel, index);\n        });\n        \n        // Render CRT effects if enabled\n        if (this.config.crtEffects) {\n            this.renderCRTEffects(renderer);\n        }\n    }\n\n    /**\n     * Render panel base structure\n     */\n    private renderPanelBase(renderer: Renderer): void {\n        const baseY = this.config.screenHeight - this.config.panelHeight - 10;\n        const baseHeight = this.config.panelHeight + 20;\n        \n        // Main base panel (very dark, worn metal)\n        renderer.fillRect(0, baseY, this.config.screenWidth, baseHeight, { r: 12, g: 14, b: 16 });\n        \n        // Decorative edge (muted terminal glow)\n        renderer.fillRect(0, baseY, this.config.screenWidth, 3, { r: 8, g: 24, b: 8 });\n        \n        // Panel separators (dark gray lines)\n        for (let i = 1; i < this.panels.length; i++) {\n            const x = this.panels[i].x - this.config.panelSpacing / 2;\n            renderer.fillRect(x, baseY + 5, 1, baseHeight - 10, { r: 24, g: 24, b: 24 });\n        }\n    }\n\n    /**\n     * Render individual panel\n     */\n    private renderPanel(renderer: Renderer, panel: PanelArea, panelIndex: number): void {\n        // Panel background with depth effect (dark, worn CRT style)\n        renderer.fillRect(panel.x, panel.y, panel.width, panel.height, { r: 8, g: 12, b: 8 });\n        renderer.drawLine(panel.x, panel.y, panel.x + panel.width, panel.y, { r: 16, g: 48, b: 16 });\n        renderer.drawLine(panel.x, panel.y, panel.x, panel.y + panel.height, { r: 16, g: 48, b: 16 });\n        \n        // Panel title (muted terminal green)\n        renderer.renderText(panel.title, panel.x + 5, panel.y + 5, { r: 12, g: 36, b: 12 }, 8);\n        \n        // Render panel content based on index\n        switch (panelIndex) {\n            case 0: this.renderSystemsPanel(renderer, panel); break;\n            case 1: this.renderControlPanel(renderer, panel); break;\n            case 2: this.renderDamagePanel(renderer, panel); break;\n            case 3: this.renderWeaponsPanel(renderer, panel); break;\n            case 4: this.renderRadarPanel(renderer, panel); break;\n        }\n    }\n\n    /**\n     * Render systems panel content\n     */\n    private renderSystemsPanel(renderer: Renderer, panel: PanelArea): void {\n        // Status bars\n        this.renderStatusBar(renderer, panel.x + 40, panel.y + 20, 30, 8, this.systemStatus.hull, 'HULL');\n        this.renderStatusBar(renderer, panel.x + 40, panel.y + 35, 30, 8, this.systemStatus.shields, 'SHLD');\n        this.renderStatusBar(renderer, panel.x + 40, panel.y + 50, 30, 8, this.systemStatus.power, 'PWR');\n        this.renderStatusBar(renderer, panel.x + 40, panel.y + 65, 30, 8, this.systemStatus.fuel, 'FUEL');\n        this.renderStatusBar(renderer, panel.x + 40, panel.y + 80, 30, 8, this.systemStatus.heat, 'HEAT', true);\n        \n        // Warning lights\n        this.renderWarningLight(renderer, panel.x + 95, panel.y + 20, this.systemStatus.power < 30);\n        this.renderWarningLight(renderer, panel.x + 95, panel.y + 35, this.systemStatus.hull < 25);\n        this.renderWarningLight(renderer, panel.x + 95, panel.y + 50, !this.systemStatus.shieldsOnline);\n        this.renderWarningLight(renderer, panel.x + 95, panel.y + 65, !this.systemStatus.warpDrive);\n    }\n\n    /**\n     * Render control panel content\n     */\n    private renderControlPanel(renderer: Renderer, panel: PanelArea): void {\n        // System toggles\n        this.renderToggle(renderer, panel.x + 10, panel.y + 20, 30, 15, this.systemStatus.enginesOnline, 'ENG');\n        this.renderToggle(renderer, panel.x + 50, panel.y + 20, 30, 15, this.systemStatus.shieldsOnline, 'SHLD');\n        this.renderToggle(renderer, panel.x + 90, panel.y + 20, 30, 15, this.systemStatus.weaponsOnline, 'WPN');\n        this.renderToggle(renderer, panel.x + 130, panel.y + 20, 30, 15, this.systemStatus.warpDrive, 'WARP');\n        \n        // Power sliders\n        const thrustSlider = this.interactiveElements.get('thrust_slider');\n        const shieldSlider = this.interactiveElements.get('shield_slider');\n        \n        if (thrustSlider) {\n            this.renderSlider(renderer, thrustSlider, thrustSlider.value || 50, 'THRUST');\n        }\n        if (shieldSlider) {\n            this.renderSlider(renderer, shieldSlider, shieldSlider.value || 50, 'SHIELDS');\n        }\n        \n        // Emergency button\n        this.renderButton(renderer, panel.x + 60, panel.y + 70, 40, 20, 'DESTRUCT', { r: 200, g: 0, b: 0 });\n    }\n\n    /**\n     * Render damage panel content\n     */\n    private renderDamagePanel(renderer: Renderer, panel: PanelArea): void {\n        // Damage monitor\n        this.renderDamageDisplay(renderer, panel.x + 10, panel.y + 20, 80, 50);\n        \n        // Cargo indicator\n        renderer.renderText(`CARGO: ${this.cargoLoad.toFixed(0)}%`, \n            panel.x + 100, panel.y + 25, { r: 255, g: 255, b: 0 }, 10);\n        \n        // Interface buttons\n        this.renderButton(renderer, panel.x + 10, panel.y + 80, 35, 15, 'INV', { r: 0, g: 192, b: 255 });\n        this.renderButton(renderer, panel.x + 50, panel.y + 80, 35, 15, 'CODEX', { r: 0, g: 192, b: 255 });\n        this.renderButton(renderer, panel.x + 90, panel.y + 80, 35, 15, 'RSCH', { r: 0, g: 192, b: 255 });\n        this.renderButton(renderer, panel.x + 130, panel.y + 80, 35, 15, 'CREW', { r: 0, g: 192, b: 255 });\n    }\n\n    /**\n     * Render weapons panel content\n     */\n    private renderWeaponsPanel(renderer: Renderer, panel: PanelArea): void {\n        // Weapon selection buttons\n        this.renderButton(renderer, panel.x + 10, panel.y + 20, 40, 15, 'LASER', { r: 0, g: 255, b: 0 });\n        this.renderButton(renderer, panel.x + 55, panel.y + 20, 40, 15, 'PLASMA', { r: 128, g: 128, b: 128 });\n        this.renderButton(renderer, panel.x + 100, panel.y + 20, 40, 15, 'MISSILE', { r: 128, g: 128, b: 128 });\n        \n        // Weapon info display\n        renderer.fillRect(panel.x + 10, panel.y + 40, 130, 25, { r: 5, g: 10, b: 5 });\n        renderer.renderText('LASER CANNON MK-II', panel.x + 15, panel.y + 45, { r: 0, g: 255, b: 0 }, 8);\n        renderer.renderText('PWR: 85% RNG: 2.5KM', panel.x + 15, panel.y + 55, { r: 0, g: 192, b: 0 }, 8);\n        \n        // Warning lights\n        this.renderWarningLight(renderer, panel.x + 15, panel.y + 75, this.systemStatus.heat > 80);\n        this.renderWarningLight(renderer, panel.x + 35, panel.y + 75, false); // Ammo OK\n        this.renderWarningLight(renderer, panel.x + 55, panel.y + 75, this.systemStatus.power < 20);\n    }\n\n    /**\n     * Render radar panel content\n     */\n    private renderRadarPanel(renderer: Renderer, panel: PanelArea): void {\n        // Radar display\n        this.renderRadarDisplay(renderer, panel.x + 10, panel.y + 20, 80, 50);\n        \n        // Control buttons\n        this.renderButton(renderer, panel.x + 100, panel.y + 20, 20, 15, 'Z+', { r: 0, g: 128, b: 255 });\n        this.renderButton(renderer, panel.x + 125, panel.y + 20, 20, 15, 'Z-', { r: 0, g: 128, b: 255 });\n        this.renderToggle(renderer, panel.x + 100, panel.y + 40, 45, 15, this.radarMode === 'interstellar', 'MODE');\n        this.renderButton(renderer, panel.x + 100, panel.y + 60, 45, 15, 'GALAXY', { r: 255, g: 165, b: 0 });\n    }\n\n    /**\n     * Render status bar\n     */\n    private renderStatusBar(\n        renderer: Renderer, \n        x: number, \n        y: number, \n        width: number, \n        height: number, \n        value: number, \n        label: string,\n        isHeat = false\n    ): void {\n        // Background\n        renderer.fillRect(x, y, width, height, { r: 5, g: 5, b: 5 });\n        \n        // Fill bar\n        const fillWidth = (value / 100) * width;\n        let fillColor: Color;\n        \n        if (isHeat) {\n            // Heat bar (muted red when high)\n            fillColor = value > 70 ? { r: 96, g: 32, b: 32 } : \n                       value > 40 ? { r: 96, g: 64, b: 16 } : \n                                   { r: 12, g: 36, b: 12 };\n        } else {\n            // Standard bar (muted green to amber to red)\n            fillColor = value > 60 ? { r: 12, g: 36, b: 12 } : \n                       value > 30 ? { r: 72, g: 48, b: 12 } : \n                                   { r: 72, g: 24, b: 24 };\n        }\n        \n        renderer.fillRect(x, y, fillWidth, height, fillColor);\n        \n        // Border (dark gray)\n        renderer.drawLine(x, y, x + width, y, { r: 32, g: 32, b: 32 });\n        renderer.drawLine(x, y + height, x + width, y + height, { r: 32, g: 32, b: 32 });\n        \n        // Value text (muted white)\n        renderer.renderText(`${value.toFixed(0)}`, x + width + 2, y, { r: 64, g: 64, b: 64 }, 8);\n    }\n\n    /**\n     * Render warning light\n     */\n    private renderWarningLight(renderer: Renderer, x: number, y: number, isActive: boolean): void {\n        const color = isActive ? \n            { r: 72, g: 24, b: 24 } : \n            { r: 24, g: 8, b: 8 };\n        \n        renderer.fillRect(x, y, 8, 8, color);\n        \n        // Flicker effect for active warnings (muted glow)\n        if (isActive && Math.sin(this.flickerTimer * 10) > 0.5) {\n            renderer.fillRect(x + 1, y + 1, 6, 6, { r: 96, g: 32, b: 32 });\n        }\n    }\n\n    /**\n     * Render toggle switch\n     */\n    private renderToggle(\n        renderer: Renderer, \n        x: number, \n        y: number, \n        width: number, \n        height: number, \n        state: boolean, \n        label: string\n    ): void {\n        const bgColor = state ? { r: 8, g: 24, b: 8 } : { r: 24, g: 8, b: 8 };\n        const textColor = state ? { r: 16, g: 48, b: 16 } : { r: 32, g: 32, b: 32 };\n        \n        renderer.fillRect(x, y, width, height, bgColor);\n        renderer.renderText(label, x + 2, y + 4, textColor, 8);\n    }\n\n    /**\n     * Render slider\n     */\n    private renderSlider(\n        renderer: Renderer, \n        element: InteractiveElement, \n        value: number, \n        label: string\n    ): void {\n        // Background (dark worn metal)\n        renderer.fillRect(element.x, element.y, element.width, element.height, { r: 8, g: 8, b: 8 });\n        \n        // Slider position (muted teal)\n        const sliderPos = (value / 100) * element.width;\n        renderer.fillRect(element.x, element.y, sliderPos, element.height, { r: 16, g: 40, b: 32 });\n        \n        // Slider handle (worn white)\n        renderer.fillRect(element.x + sliderPos - 2, element.y - 2, 4, element.height + 4, { r: 64, g: 64, b: 64 });\n        \n        // Label and value (muted text)\n        renderer.renderText(label, element.x, element.y - 12, { r: 48, g: 48, b: 48 }, 8);\n        renderer.renderText(`${value.toFixed(0)}%`, element.x + element.width - 25, element.y - 12, { r: 48, g: 48, b: 48 }, 8);\n    }\n\n    /**\n     * Render button\n     */\n    private renderButton(\n        renderer: Renderer, \n        x: number, \n        y: number, \n        width: number, \n        height: number, \n        label: string, \n        color: Color\n    ): void {\n        const isHovered = this.hoveredElement?.includes(label.toLowerCase());\n        const bgColor = isHovered ? \n            { r: color.r + 30, g: color.g + 30, b: color.b + 30 } : \n            { r: color.r / 3, g: color.g / 3, b: color.b / 3 };\n        \n        renderer.fillRect(x, y, width, height, bgColor);\n        renderer.renderText(label, x + 2, y + 3, color, 8);\n    }\n\n    /**\n     * Render damage display\n     */\n    private renderDamageDisplay(renderer: Renderer, x: number, y: number, width: number, height: number): void {\n        // Background\n        renderer.fillRect(x, y, width, height, { r: 5, g: 10, b: 5 });\n        \n        // Ship schematic (simplified)\n        const shipX = x + width / 2;\n        const shipY = y + height / 2;\n        \n        // Draw 8 sections of the ship\n        const sections = [\n            { name: 'BOW', x: shipX, y: shipY - 15, color: { r: 0, g: 255, b: 0 } },\n            { name: 'STERN', x: shipX, y: shipY + 15, color: { r: 0, g: 255, b: 0 } },\n            { name: 'PORT', x: shipX - 15, y: shipY, color: { r: 0, g: 255, b: 0 } },\n            { name: 'STBD', x: shipX + 15, y: shipY, color: { r: 0, g: 255, b: 0 } },\n            { name: 'CORE', x: shipX, y: shipY, color: { r: 0, g: 255, b: 0 } },\n            { name: 'BRDG', x: shipX - 8, y: shipY - 8, color: { r: 0, g: 255, b: 0 } },\n            { name: 'ENG', x: shipX + 8, y: shipY + 8, color: { r: 0, g: 255, b: 0 } },\n            { name: 'WPN', x: shipX + 8, y: shipY - 8, color: { r: 0, g: 255, b: 0 } }\n        ];\n        \n        sections.forEach(section => {\n            renderer.fillRect(section.x - 4, section.y - 4, 8, 8, section.color);\n            renderer.renderText(section.name, section.x - 12, section.y + 8, { r: 0, g: 192, b: 0 }, 6);\n        });\n    }\n\n    /**\n     * Render radar display\n     */\n    private renderRadarDisplay(renderer: Renderer, x: number, y: number, width: number, height: number): void {\n        // Background\n        renderer.fillRect(x, y, width, height, { r: 0, g: 8, b: 0 });\n        \n        // Radar grid\n        const centerX = x + width / 2;\n        const centerY = y + height / 2;\n        const maxRadius = Math.min(width, height) / 2 - 5;\n        \n        // Range rings\n        for (let i = 1; i <= 3; i++) {\n            const radius = (maxRadius / 3) * i;\n            renderer.drawCircle(centerX, centerY, radius, { r: 0, g: 64, b: 0 });\n        }\n        \n        // Cross hairs\n        renderer.drawLine(centerX - maxRadius, centerY, centerX + maxRadius, centerY, { r: 0, g: 64, b: 0 });\n        renderer.drawLine(centerX, centerY - maxRadius, centerX, centerY + maxRadius, { r: 0, g: 64, b: 0 });\n        \n        // Player ship (center)\n        renderer.fillRect(centerX - 1, centerY - 1, 3, 3, { r: 0, g: 255, b: 0 });\n        \n        // Sample contacts\n        renderer.fillRect(centerX + 10, centerY - 15, 2, 2, { r: 255, g: 255, b: 0 }); // Planet\n        renderer.fillRect(centerX - 20, centerY + 8, 2, 2, { r: 255, g: 255, b: 0 }); // Planet\n        \n        // Mode indicator\n        renderer.renderText(this.radarMode.toUpperCase(), x + 2, y + height - 12, { r: 0, g: 255, b: 0 }, 8);\n        renderer.renderText(`ZOOM: ${this.radarZoom.toFixed(1)}x`, x + 2, y + height - 22, { r: 0, g: 255, b: 0 }, 8);\n    }\n\n    /**\n     * Render CRT effects\n     */\n    private renderCRTEffects(renderer: Renderer): void {\n        // Scanlines are handled by CSS in the main HTML\n        // Additional flicker effect for damaged systems\n        if (this.systemStatus.hull < 50 || this.systemStatus.power < 30) {\n            // Add random glitch pixels\n            if (Math.random() < 0.1) {\n                const x = Math.random() * this.config.screenWidth;\n                const y = this.config.screenHeight - this.config.panelHeight + Math.random() * this.config.panelHeight;\n                renderer.setPixel(x, y, { r: 255, g: 255, b: 255 });\n            }\n        }\n    }\n\n    /**\n     * Update system status\n     */\n    updateSystemStatus(status: SystemStatus): void {\n        this.systemStatus = { ...status };\n    }\n\n    /**\n     * Update damage reports\n     */\n    updateDamageReports(reports: Map<ShipSection, DamageReport[]>): void {\n        this.damageReports = new Map(reports);\n    }\n\n    /**\n     * Update cargo load\n     */\n    updateCargoLoad(load: number): void {\n        this.cargoLoad = Math.max(0, Math.min(100, load));\n    }\n\n    /**\n     * Get current power allocation from sliders\n     */\n    getPowerAllocation(): PowerAllocation {\n        const thrustSlider = this.interactiveElements.get('thrust_slider');\n        const shieldSlider = this.interactiveElements.get('shield_slider');\n        \n        return {\n            engines: thrustSlider?.value || 30,\n            shields: shieldSlider?.value || 25,\n            weapons: 20,\n            lifeSupport: 15,\n            sensors: 10\n        };\n    }\n}","/**\n * Celestial Body System\n * Handles planets, moons, stars, asteroids with orbital mechanics and interactions\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer, Color } from '@core/Renderer';\nimport { PhysicsObject } from '@core/Physics';\nimport { StarData, PlanetData, MoonData, PlanetType, SurfaceType } from '@procedural/GalaxyGenerator';\n\nexport interface CelestialBodyConfig {\n    renderDistance: number; // Maximum distance to render details\n    orbitLineOpacity: number;\n    showOrbitLines: boolean;\n    animationSpeed: number;\n    minPixelSize: number; // Minimum size for distant objects\n    maxPixelSize: number; // Maximum size for close objects\n}\n\nexport interface InteractionZone {\n    bodyId: string;\n    type: 'orbit' | 'surface' | 'atmosphere';\n    radius: number;\n    distance: number; // Distance from ship\n    canEnter: boolean;\n    requirements?: string[];\n}\n\nexport interface BodyInteraction {\n    onEnterOrbit?: (bodyId: string) => void;\n    onExitOrbit?: (bodyId: string) => void;\n    onLandingAttempt?: (bodyId: string, canLand: boolean) => void;\n    onMining?: (bodyId: string, resources: MiningResult) => void;\n    onScan?: (bodyId: string, scanData: ScanResult) => void;\n}\n\nexport interface MiningResult {\n    resourceType: string;\n    quantity: number;\n    quality: number; // 0-1\n    depletion: number; // How much the resource is depleted\n}\n\nexport interface ScanResult {\n    composition: string[];\n    atmosphere?: AtmosphereData;\n    surfaceConditions: SurfaceConditions;\n    biologicalSigns: boolean;\n    anomalies: string[];\n    mineralDeposits: MineralDeposit[];\n}\n\nexport interface AtmosphereData {\n    pressure: number; // Earth atmospheres\n    composition: { [element: string]: number };\n    breathable: boolean;\n    toxic: boolean;\n    temperature: number; // Kelvin\n}\n\nexport interface SurfaceConditions {\n    temperature: number; // Kelvin\n    gravity: number; // Earth gravities\n    radiation: number; // 0-1 (danger level)\n    weather: string;\n    landingDifficulty: number; // 0-1\n}\n\nexport interface MineralDeposit {\n    type: string;\n    richness: number; // 0-1\n    accessibility: number; // 0-1\n    extractionDifficulty: number; // 0-1\n}\n\nexport class CelestialBody {\n    public id: string;\n    public name: string;\n    public type: 'star' | 'planet' | 'moon' | 'asteroid';\n    public position: Vector2;\n    public velocity: Vector2 = { x: 0, y: 0 };\n    \n    // Visual properties\n    public radius: number;\n    public color: Color;\n    public atmosphereColor?: Color;\n    public hasAtmosphere: boolean = false;\n    public hasRings: boolean = false;\n    public ringColor?: Color;\n    \n    // Orbital mechanics\n    public orbitCenter?: Vector2;\n    public orbitRadius: number = 0;\n    public orbitSpeed: number = 0;\n    public orbitAngle: number = 0;\n    public rotationSpeed: number = 0;\n    public currentRotation: number = 0;\n    \n    // Physics and interaction\n    public mass: number;\n    public physicsObject?: PhysicsObject;\n    public interactionZones: InteractionZone[] = [];\n    \n    // Data\n    public planetData?: PlanetData;\n    public starData?: StarData;\n    public moonData?: MoonData;\n    \n    // Resource data\n    public mineralDeposits: MineralDeposit[] = [];\n    public surfaceConditions?: SurfaceConditions;\n    public atmosphereData?: AtmosphereData;\n    \n    // Interaction state\n    public isDiscovered: boolean = false;\n    public isScanned: boolean = false;\n    public isLanded: boolean = false;\n    public resourcesDepleted: number = 0; // 0-1\n    \n    private logger: Logger;\n\n    constructor(config: {\n        id: string;\n        name: string;\n        type: 'star' | 'planet' | 'moon' | 'asteroid';\n        position: Vector2;\n        radius: number;\n        mass: number;\n        color: Color;\n        planetData?: PlanetData;\n        starData?: StarData;\n        moonData?: MoonData;\n    }) {\n        this.id = config.id;\n        this.name = config.name;\n        this.type = config.type;\n        this.position = { ...config.position };\n        this.radius = config.radius;\n        this.mass = config.mass;\n        this.color = { ...config.color };\n        \n        this.planetData = config.planetData;\n        this.starData = config.starData;\n        this.moonData = config.moonData;\n        \n        this.logger = new Logger(`CelestialBody:${config.name}`);\n        \n        this.initializeFromData();\n        this.generateInteractionZones();\n        this.generateResources();\n        \n        this.logger.debug(`Created ${this.type}: ${this.name}`, {\n            radius: this.radius,\n            mass: this.mass,\n            hasAtmosphere: this.hasAtmosphere\n        });\n    }\n\n    /**\n     * Initialize body properties from data\n     */\n    private initializeFromData(): void {\n        if (this.planetData) {\n            this.hasAtmosphere = this.planetData.hasAtmosphere;\n            this.hasRings = this.planetData.hasRings;\n            \n            // Set colors based on planet type with dark, muted tones\n            this.updatePlanetVisuals();\n            \n            // Setup orbital mechanics\n            if (this.planetData.orbitDistance > 0) {\n                this.orbitRadius = this.planetData.orbitDistance * 50; // Scale for display\n                this.orbitSpeed = 2 * Math.PI / (this.planetData.orbitPeriod / 3600); // Convert to radians per hour\n            }\n            \n            // Rotation (30-frame cycle as specified)\n            this.rotationSpeed = (2 * Math.PI) / 30; // 30 frames for full rotation\n        }\n        \n        if (this.starData) {\n            // Star visual properties with muted glow\n            this.color = this.getDarkStarColor(this.starData.temperature);\n            this.rotationSpeed = (2 * Math.PI) / 60; // Slower star rotation\n        }\n        \n        if (this.moonData) {\n            // Moon properties\n            this.orbitRadius = this.moonData.orbitDistance * 5; // Scale for display\n            this.orbitSpeed = 2 * Math.PI / (this.moonData.orbitPeriod / 60); // Convert to minutes\n            this.rotationSpeed = this.moonData.tidallyLocked ? this.orbitSpeed : (2 * Math.PI) / 45;\n        }\n    }\n\n    /**\n     * Update planet visual properties with dark, atmospheric colors\n     */\n    private updatePlanetVisuals(): void {\n        if (!this.planetData) return;\n        \n        // Dark, muted planet colors based on type\n        switch (this.planetData.type) {\n            case PlanetType.Terrestrial:\n                this.color = { r: 32, g: 24, b: 16 }; // Dark brown/rock\n                if (this.hasAtmosphere) {\n                    this.atmosphereColor = { r: 16, g: 24, b: 32 }; // Dark blue haze\n                }\n                break;\n                \n            case PlanetType.Ocean:\n                this.color = { r: 8, g: 16, b: 32 }; // Deep dark blue\n                this.atmosphereColor = { r: 12, g: 20, b: 28 }; // Muted blue atmosphere\n                break;\n                \n            case PlanetType.Desert:\n                this.color = { r: 48, g: 32, b: 16 }; // Dark sand/rust\n                break;\n                \n            case PlanetType.Volcanic:\n                this.color = { r: 32, g: 16, b: 8 }; // Dark volcanic rock\n                break;\n                \n            case PlanetType.Frozen:\n                this.color = { r: 32, g: 36, b: 40 }; // Dark ice\n                break;\n                \n            case PlanetType.GasGiant:\n                this.color = { r: 40, g: 32, b: 24 }; // Muted gas colors\n                this.atmosphereColor = { r: 32, g: 28, b: 20 }; // Dark atmosphere\n                if (this.hasRings) {\n                    this.ringColor = { r: 24, g: 20, b: 16 }; // Dark ring material\n                }\n                break;\n                \n            case PlanetType.IceGiant:\n                this.color = { r: 16, g: 24, b: 32 }; // Dark blue-gray\n                this.atmosphereColor = { r: 12, g: 20, b: 28 }; // Muted methane haze\n                break;\n                \n            case PlanetType.Toxic:\n                this.color = { r: 32, g: 24, b: 16 }; // Dark toxic surface\n                this.atmosphereColor = { r: 48, g: 32, b: 16 }; // Toxic haze\n                break;\n        }\n    }\n\n    /**\n     * Get dark star color based on temperature\n     */\n    private getDarkStarColor(temperature: number): Color {\n        // Dark, muted star colors (no bright neons)\n        if (temperature > 25000) return { r: 32, g: 36, b: 48 }; // Muted blue\n        if (temperature > 10000) return { r: 40, g: 44, b: 48 }; // Blue-white\n        if (temperature > 7500) return { r: 48, g: 48, b: 48 };  // Muted white\n        if (temperature > 6000) return { r: 48, g: 44, b: 36 };  // Yellow-white\n        if (temperature > 5000) return { r: 48, g: 40, b: 28 };  // Muted yellow\n        if (temperature > 3500) return { r: 48, g: 32, b: 20 };  // Orange\n        return { r: 48, g: 24, b: 16 }; // Dark red\n    }\n\n    /**\n     * Generate interaction zones around the body\n     */\n    private generateInteractionZones(): void {\n        this.interactionZones = [];\n        \n        // Orbit zone (space around the body)\n        this.interactionZones.push({\n            bodyId: this.id,\n            type: 'orbit',\n            radius: this.radius * 3,\n            distance: 0,\n            canEnter: true\n        });\n        \n        // Atmosphere zone (if has atmosphere)\n        if (this.hasAtmosphere) {\n            this.interactionZones.push({\n                bodyId: this.id,\n                type: 'atmosphere',\n                radius: this.radius * 1.5,\n                distance: 0,\n                canEnter: true,\n                requirements: ['heat_shielding']\n            });\n        }\n        \n        // Surface zone (for landing)\n        if (this.type !== 'star') {\n            const canLand = this.canShipLand();\n            this.interactionZones.push({\n                bodyId: this.id,\n                type: 'surface',\n                radius: this.radius,\n                distance: 0,\n                canEnter: canLand,\n                requirements: canLand ? [] : ['specialized_equipment']\n            });\n        }\n    }\n\n    /**\n     * Determine if a ship can land on this body\n     */\n    private canShipLand(): boolean {\n        if (this.type === 'star') return false;\n        if (this.type === 'asteroid') return true; // Can dock with asteroids\n        \n        if (this.planetData) {\n            // Gas giants can't be landed on\n            if (this.planetData.type === PlanetType.GasGiant || \n                this.planetData.type === PlanetType.IceGiant) {\n                return false;\n            }\n            \n            // Very high temperature/pressure is dangerous\n            if (this.planetData.temperature > 1000) return false;\n            \n            return true;\n        }\n        \n        return true; // Moons and unknown bodies default to landable\n    }\n\n    /**\n     * Generate mineral deposits and resources\n     */\n    private generateResources(): void {\n        this.mineralDeposits = [];\n        \n        if (this.type === 'star') return; // Stars don't have mineable resources\n        \n        // Generate resources based on body type\n        const resourceTypes = this.getResourceTypes();\n        \n        resourceTypes.forEach(resourceType => {\n            this.mineralDeposits.push({\n                type: resourceType,\n                richness: Math.random() * 0.7 + 0.3, // 0.3 to 1.0\n                accessibility: Math.random() * 0.8 + 0.2, // 0.2 to 1.0\n                extractionDifficulty: Math.random() * 0.6 + 0.2 // 0.2 to 0.8\n            });\n        });\n        \n        // Generate surface conditions\n        this.generateSurfaceConditions();\n    }\n\n    /**\n     * Get available resource types for this body\n     */\n    private getResourceTypes(): string[] {\n        const baseResources = ['metal', 'crystals'];\n        \n        if (this.type === 'asteroid') {\n            return [...baseResources, 'rare_metals', 'ice'];\n        }\n        \n        if (this.planetData) {\n            switch (this.planetData.type) {\n                case PlanetType.Terrestrial:\n                    return [...baseResources, 'rare_earth', 'radioactive'];\n                case PlanetType.Volcanic:\n                    return [...baseResources, 'sulfur', 'rare_metals'];\n                case PlanetType.Frozen:\n                    return [...baseResources, 'ice', 'frozen_gases'];\n                case PlanetType.Desert:\n                    return [...baseResources, 'silicon', 'rare_earth'];\n                case PlanetType.Ocean:\n                    return [...baseResources, 'deuterium', 'biologics'];\n                default:\n                    return baseResources;\n            }\n        }\n        \n        return baseResources;\n    }\n\n    /**\n     * Generate surface conditions for landing/mining\n     */\n    private generateSurfaceConditions(): void {\n        if (this.type === 'star') return;\n        \n        let temperature = 273; // Default Earth-like\n        let gravity = 1.0;\n        let radiation = 0.0;\n        let weather = 'none';\n        let landingDifficulty = 0.2;\n        \n        if (this.planetData) {\n            temperature = this.planetData.temperature;\n            gravity = Math.sqrt(this.planetData.mass); // Simplified gravity calculation\n            \n            // Radiation based on proximity to star and atmosphere\n            radiation = this.hasAtmosphere ? 0.1 : 0.3;\n            \n            // Weather based on atmosphere and temperature\n            if (this.hasAtmosphere) {\n                if (temperature > 373) weather = 'extreme_heat';\n                else if (temperature < 273) weather = 'frozen';\n                else weather = 'stable';\n            }\n            \n            // Landing difficulty based on conditions\n            landingDifficulty = Math.min(0.9, \n                (Math.abs(temperature - 273) / 500) + \n                (Math.abs(gravity - 1) * 0.3) + \n                (radiation * 0.4)\n            );\n        }\n        \n        this.surfaceConditions = {\n            temperature,\n            gravity,\n            radiation,\n            weather,\n            landingDifficulty\n        };\n    }\n\n    /**\n     * Update orbital mechanics and rotation\n     */\n    update(deltaTime: number): void {\n        // Update orbital position\n        if (this.orbitCenter && this.orbitRadius > 0) {\n            this.orbitAngle += this.orbitSpeed * deltaTime;\n            \n            this.position.x = this.orbitCenter.x + Math.cos(this.orbitAngle) * this.orbitRadius;\n            this.position.y = this.orbitCenter.y + Math.sin(this.orbitAngle) * this.orbitRadius;\n        }\n        \n        // Update rotation (30-frame animation cycle)\n        this.currentRotation += this.rotationSpeed * deltaTime;\n        if (this.currentRotation > 2 * Math.PI) {\n            this.currentRotation -= 2 * Math.PI;\n        }\n        \n        // Update physics object position if exists\n        if (this.physicsObject) {\n            this.physicsObject.position = { ...this.position };\n        }\n    }\n\n    /**\n     * Render the celestial body with dark retro style\n     */\n    render(renderer: Renderer, cameraPosition: Vector2, config: CelestialBodyConfig): void {\n        const distance = this.getDistanceFrom(cameraPosition);\n        \n        // Don't render if too far away\n        if (distance > config.renderDistance) return;\n        \n        // Calculate screen position\n        const screenPos = {\n            x: this.position.x - cameraPosition.x + 512, // Assuming 1024x768 screen\n            y: this.position.y - cameraPosition.y + 384\n        };\n        \n        // Calculate size based on distance\n        const baseSize = this.radius;\n        const scaledSize = Math.max(config.minPixelSize, \n            Math.min(config.maxPixelSize, baseSize * (config.renderDistance / distance)));\n        \n        // Render orbit line if enabled and not too close\n        if (config.showOrbitLines && this.orbitCenter && distance > 100) {\n            this.renderOrbitLine(renderer, cameraPosition, config);\n        }\n        \n        // Render atmosphere if present\n        if (this.hasAtmosphere && this.atmosphereColor) {\n            const atmoSize = scaledSize * 1.3;\n            renderer.drawCircle(screenPos.x, screenPos.y, atmoSize, this.atmosphereColor, true);\n        }\n        \n        // Render rings if present\n        if (this.hasRings && this.ringColor) {\n            this.renderRings(renderer, screenPos, scaledSize);\n        }\n        \n        // Render main body\n        renderer.drawCircle(screenPos.x, screenPos.y, scaledSize, this.color, true);\n        \n        // Add subtle rotation texture for planets\n        if (this.type === 'planet' && scaledSize > 8) {\n            this.renderSurfaceDetails(renderer, screenPos, scaledSize);\n        }\n        \n        // Render star glow effect (very subtle)\n        if (this.type === 'star') {\n            this.renderStarGlow(renderer, screenPos, scaledSize);\n        }\n        \n        // Render name if close enough and discovered\n        if (distance < config.renderDistance / 3 && this.isDiscovered) {\n            renderer.renderText(this.name, screenPos.x - 20, screenPos.y - scaledSize - 15, \n                { r: 48, g: 48, b: 48 }, 8);\n        }\n    }\n\n    /**\n     * Render orbit line with dark, subtle styling\n     */\n    private renderOrbitLine(renderer: Renderer, cameraPosition: Vector2, config: CelestialBodyConfig): void {\n        if (!this.orbitCenter) return;\n        \n        const centerScreen = {\n            x: this.orbitCenter.x - cameraPosition.x + 512,\n            y: this.orbitCenter.y - cameraPosition.y + 384\n        };\n        \n        // Render faint orbit line\n        const orbitColor = { \n            r: Math.floor(this.color.r * 0.3), \n            g: Math.floor(this.color.g * 0.3), \n            b: Math.floor(this.color.b * 0.3) \n        };\n        \n        renderer.drawCircle(centerScreen.x, centerScreen.y, this.orbitRadius, orbitColor, false);\n    }\n\n    /**\n     * Render planet rings with dark styling\n     */\n    private renderRings(renderer: Renderer, screenPos: Vector2, size: number): void {\n        if (!this.ringColor) return;\n        \n        const innerRadius = size * 1.5;\n        const outerRadius = size * 2.2;\n        \n        // Draw ring segments\n        for (let radius = innerRadius; radius < outerRadius; radius += 2) {\n            const alpha = 1 - ((radius - innerRadius) / (outerRadius - innerRadius)) * 0.7;\n            const ringColor = {\n                r: Math.floor(this.ringColor.r * alpha),\n                g: Math.floor(this.ringColor.g * alpha),\n                b: Math.floor(this.ringColor.b * alpha)\n            };\n            \n            renderer.drawCircle(screenPos.x, screenPos.y, radius, ringColor, false);\n        }\n    }\n\n    /**\n     * Render surface details with 30-frame rotation\n     */\n    private renderSurfaceDetails(renderer: Renderer, screenPos: Vector2, size: number): void {\n        const rotationFrame = Math.floor((this.currentRotation / (2 * Math.PI)) * 30);\n        \n        // Simple surface features that rotate\n        for (let i = 0; i < 3; i++) {\n            const angle = (i * 2 * Math.PI / 3) + this.currentRotation;\n            const featureX = screenPos.x + Math.cos(angle) * (size * 0.6);\n            const featureY = screenPos.y + Math.sin(angle) * (size * 0.3); // Flattened for 2D view\n            \n            // Dark surface features\n            const featureColor = {\n                r: Math.max(0, this.color.r - 8),\n                g: Math.max(0, this.color.g - 8),\n                b: Math.max(0, this.color.b - 8)\n            };\n            \n            renderer.fillRect(featureX - 1, featureY - 1, 2, 2, featureColor);\n        }\n    }\n\n    /**\n     * Render subtle star glow effect\n     */\n    private renderStarGlow(renderer: Renderer, screenPos: Vector2, size: number): void {\n        // Very subtle glow effect (no bright neons)\n        const glowColor = {\n            r: Math.min(64, this.color.r + 16),\n            g: Math.min(64, this.color.g + 16),\n            b: Math.min(64, this.color.b + 16)\n        };\n        \n        renderer.drawCircle(screenPos.x, screenPos.y, size * 1.2, glowColor, false);\n    }\n\n    /**\n     * Check for ship interactions\n     */\n    checkInteraction(shipPosition: Vector2): InteractionZone | null {\n        const distance = this.getDistanceFrom(shipPosition);\n        \n        // Check each interaction zone\n        for (const zone of this.interactionZones) {\n            if (distance <= zone.radius) {\n                zone.distance = distance;\n                return zone;\n            }\n        }\n        \n        return null;\n    }\n\n    /**\n     * Perform mining operation\n     */\n    performMining(shipPosition: Vector2, miningEfficiency: number = 1.0): MiningResult | null {\n        const interaction = this.checkInteraction(shipPosition);\n        \n        if (!interaction || interaction.type !== 'surface') {\n            return null;\n        }\n        \n        // Find best resource to mine\n        const availableResources = this.mineralDeposits.filter(deposit => \n            deposit.richness > this.resourcesDepleted\n        );\n        \n        if (availableResources.length === 0) {\n            return null;\n        }\n        \n        const resource = availableResources[0]; // Mine the first available resource\n        const extractedQuantity = resource.richness * resource.accessibility * miningEfficiency;\n        \n        // Deplete resources\n        resource.richness = Math.max(0, resource.richness - 0.05);\n        this.resourcesDepleted = Math.min(1, this.resourcesDepleted + 0.02);\n        \n        return {\n            resourceType: resource.type,\n            quantity: extractedQuantity,\n            quality: resource.accessibility,\n            depletion: this.resourcesDepleted\n        };\n    }\n\n    /**\n     * Perform detailed scan\n     */\n    performScan(): ScanResult {\n        this.isScanned = true;\n        \n        return {\n            composition: this.getResourceTypes(),\n            atmosphere: this.atmosphereData,\n            surfaceConditions: this.surfaceConditions!,\n            biologicalSigns: this.planetData?.hasLife || false,\n            anomalies: [], // TODO: Generate anomalies\n            mineralDeposits: [...this.mineralDeposits]\n        };\n    }\n\n    /**\n     * Get distance from a position\n     */\n    getDistanceFrom(position: Vector2): number {\n        const dx = this.position.x - position.x;\n        const dy = this.position.y - position.y;\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    /**\n     * Set orbit around another body\n     */\n    setOrbit(center: Vector2, radius: number, speed: number): void {\n        this.orbitCenter = { ...center };\n        this.orbitRadius = radius;\n        this.orbitSpeed = speed;\n    }\n\n    /**\n     * Get interaction info for UI\n     */\n    getInteractionInfo(): string {\n        if (!this.isDiscovered) return 'Unknown Object';\n        \n        let info = `${this.name} (${this.type.toUpperCase()})`;\n        \n        if (this.surfaceConditions) {\n            info += `\\nTemp: ${this.surfaceConditions.temperature.toFixed(0)}K`;\n            info += `\\nGravity: ${this.surfaceConditions.gravity.toFixed(1)}g`;\n            \n            if (this.mineralDeposits.length > 0) {\n                info += `\\nResources: ${this.mineralDeposits.length} types`;\n            }\n        }\n        \n        return info;\n    }\n}","/**\n * Interaction Panel UI\n * Popup window for celestial body interactions with retro CRT styling\n */\n\nimport { Renderer, Color, Vector2 } from '@core/Renderer';\nimport { InputManager } from '@core/InputManager';\nimport { Logger } from '@utils/Logger';\nimport { InteractionZone, CelestialBody, ScanResult, MiningResult } from '@entities/CelestialBody';\n\nexport interface InteractionPanelConfig {\n    enableAnimations: boolean;\n    fadeSpeed: number;\n    maxWidth: number;\n    maxHeight: number;\n}\n\nexport interface PanelInteractions {\n    onEnterOrbit?: (bodyId: string) => void;\n    onLand?: (bodyId: string) => void;\n    onContinueFlight?: () => void;\n    onStartMining?: (bodyId: string) => void;\n    onPerformScan?: (bodyId: string) => void;\n    onExitOrbit?: (bodyId: string) => void;\n}\n\ninterface InteractionButton {\n    id: string;\n    label: string;\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    enabled: boolean;\n    color: Color;\n    requirements?: string[];\n}\n\nexport class InteractionPanel {\n    private config: InteractionPanelConfig;\n    private interactions: PanelInteractions;\n    \n    // Panel state\n    private isVisible: boolean = false;\n    private currentBody: CelestialBody | null = null;\n    private currentZone: InteractionZone | null = null;\n    private opacity: number = 0;\n    private targetOpacity: number = 0;\n    \n    // Panel layout\n    private panelX: number = 0;\n    private panelY: number = 0;\n    private panelWidth: number = 0;\n    private panelHeight: number = 0;\n    \n    // Interactive elements\n    private buttons: InteractionButton[] = [];\n    private hoveredButton: string | null = null;\n    private selectedButton: string | null = null;\n    \n    // Content data\n    private bodyInfo: string = '';\n    private scanData: ScanResult | null = null;\n    private miningResults: MiningResult[] = [];\n    \n    private logger: Logger;\n\n    constructor(\n        config: Partial<InteractionPanelConfig> = {},\n        interactions: PanelInteractions = {}\n    ) {\n        this.logger = new Logger('InteractionPanel');\n        this.interactions = interactions;\n        \n        this.config = {\n            enableAnimations: true,\n            fadeSpeed: 3.0,\n            maxWidth: 300,\n            maxHeight: 200,\n            ...config\n        };\n        \n        this.logger.info('📱 Interaction panel initialized');\n    }\n\n    /**\n     * Show interaction panel for a celestial body\n     */\n    showInteraction(body: CelestialBody, zone: InteractionZone, shipPosition: Vector2): void {\n        this.currentBody = body;\n        this.currentZone = zone;\n        this.bodyInfo = body.getInteractionInfo();\n        \n        // Calculate panel position near the body\n        this.calculatePanelPosition(body.position, shipPosition);\n        \n        // Setup buttons based on interaction type\n        this.setupButtons();\n        \n        // Show panel with animation\n        this.targetOpacity = 1.0;\n        this.isVisible = true;\n        \n        this.logger.debug(`Showing interaction for ${body.name}`, {\n            type: zone.type,\n            canEnter: zone.canEnter\n        });\n    }\n\n    /**\n     * Hide the interaction panel\n     */\n    hideInteraction(): void {\n        this.targetOpacity = 0.0;\n        \n        // Reset after fade out\n        setTimeout(() => {\n            if (this.targetOpacity === 0) {\n                this.isVisible = false;\n                this.currentBody = null;\n                this.currentZone = null;\n                this.scanData = null;\n                this.miningResults = [];\n            }\n        }, this.config.enableAnimations ? 500 : 0);\n        \n        this.logger.debug('Hiding interaction panel');\n    }\n\n    /**\n     * Calculate optimal panel position\n     */\n    private calculatePanelPosition(bodyPosition: Vector2, shipPosition: Vector2): void {\n        // Base position relative to body (convert world to screen coordinates)\n        const screenBodyX = bodyPosition.x - shipPosition.x + 512;\n        const screenBodyY = bodyPosition.y - shipPosition.y + 384;\n        \n        // Panel dimensions\n        this.panelWidth = Math.min(this.config.maxWidth, 280);\n        this.panelHeight = Math.min(this.config.maxHeight, 180);\n        \n        // Position panel to the right of the body, avoiding screen edges\n        this.panelX = screenBodyX + 60;\n        this.panelY = screenBodyY - this.panelHeight / 2;\n        \n        // Keep panel on screen\n        if (this.panelX + this.panelWidth > 1024) {\n            this.panelX = screenBodyX - this.panelWidth - 60; // Move to left side\n        }\n        \n        if (this.panelY < 20) this.panelY = 20;\n        if (this.panelY + this.panelHeight > 500) { // Avoid cockpit area\n            this.panelY = 500 - this.panelHeight;\n        }\n    }\n\n    /**\n     * Setup interaction buttons based on current zone\n     */\n    private setupButtons(): void {\n        this.buttons = [];\n        \n        if (!this.currentZone || !this.currentBody) return;\n        \n        const buttonWidth = 80;\n        const buttonHeight = 25;\n        const buttonSpacing = 10;\n        let currentY = this.panelY + 80;\n        \n        // Enter Orbit button\n        if (this.currentZone.type === 'orbit' && this.currentZone.canEnter) {\n            this.buttons.push({\n                id: 'enter_orbit',\n                label: 'ENTER ORBIT',\n                x: this.panelX + 10,\n                y: currentY,\n                width: buttonWidth,\n                height: buttonHeight,\n                enabled: true,\n                color: { r: 16, g: 48, b: 16 } // Dark green\n            });\n            currentY += buttonHeight + buttonSpacing;\n        }\n        \n        // Land button\n        if (this.currentZone.type === 'surface' && this.currentZone.canEnter) {\n            this.buttons.push({\n                id: 'land',\n                label: 'LAND',\n                x: this.panelX + 10,\n                y: currentY,\n                width: buttonWidth,\n                height: buttonHeight,\n                enabled: true,\n                color: { r: 72, g: 48, b: 12 } // Dark amber\n            });\n            currentY += buttonHeight + buttonSpacing;\n        }\n        \n        // Scan button (always available when close)\n        this.buttons.push({\n            id: 'scan',\n            label: 'SCAN',\n            x: this.panelX + 100,\n            y: this.panelY + 80,\n            width: buttonWidth,\n            height: buttonHeight,\n            enabled: true,\n            color: { r: 16, g: 40, b: 32 } // Dark teal\n        });\n        \n        // Mining button (if landed or in atmosphere)\n        if (this.currentZone.type === 'surface' || this.currentZone.type === 'atmosphere') {\n            if (this.currentBody.mineralDeposits.length > 0) {\n                this.buttons.push({\n                    id: 'mine',\n                    label: 'MINE',\n                    x: this.panelX + 100,\n                    y: this.panelY + 110,\n                    width: buttonWidth,\n                    height: buttonHeight,\n                    enabled: this.currentBody.resourcesDepleted < 0.9,\n                    color: { r: 48, g: 32, b: 16 } // Dark orange\n                });\n            }\n        }\n        \n        // Continue Flight button (always present)\n        this.buttons.push({\n            id: 'continue',\n            label: 'CONTINUE',\n            x: this.panelX + 10,\n            y: this.panelY + this.panelHeight - 35,\n            width: this.panelWidth - 20,\n            height: buttonHeight,\n            enabled: true,\n            color: { r: 32, g: 32, b: 32 } // Gray\n        });\n    }\n\n    /**\n     * Update panel state\n     */\n    update(deltaTime: number, input: InputManager): void {\n        if (!this.isVisible && this.targetOpacity === 0) return;\n        \n        // Update opacity animation\n        if (this.config.enableAnimations) {\n            if (this.opacity < this.targetOpacity) {\n                this.opacity = Math.min(this.targetOpacity, this.opacity + this.config.fadeSpeed * deltaTime);\n            } else if (this.opacity > this.targetOpacity) {\n                this.opacity = Math.max(this.targetOpacity, this.opacity - this.config.fadeSpeed * deltaTime);\n            }\n        } else {\n            this.opacity = this.targetOpacity;\n        }\n        \n        // Handle input if visible\n        if (this.isVisible && this.opacity > 0.5) {\n            this.handleInput(input);\n        }\n    }\n\n    /**\n     * Handle user input\n     */\n    private handleInput(input: InputManager): void {\n        const mousePos = input.getMousePosition();\n        \n        // Check for button hover\n        this.hoveredButton = null;\n        for (const button of this.buttons) {\n            if (this.isPointInButton(mousePos, button)) {\n                this.hoveredButton = button.id;\n                break;\n            }\n        }\n        \n        // Handle button clicks\n        if (input.isMouseButtonPressed(0) && this.hoveredButton) {\n            this.handleButtonClick(this.hoveredButton);\n        }\n        \n        // Handle keyboard shortcuts\n        if (input.isKeyPressed('KeyE')) {\n            this.handleButtonClick('enter_orbit');\n        } else if (input.isKeyPressed('KeyL')) {\n            this.handleButtonClick('land');\n        } else if (input.isKeyPressed('KeyS')) {\n            this.handleButtonClick('scan');\n        } else if (input.isKeyPressed('KeyM')) {\n            this.handleButtonClick('mine');\n        } else if (input.isKeyPressed('KeyC') || input.isKeyPressed('Escape')) {\n            this.handleButtonClick('continue');\n        }\n    }\n\n    /**\n     * Check if point is inside button\n     */\n    private isPointInButton(point: Vector2, button: InteractionButton): boolean {\n        return point.x >= button.x && \n               point.x <= button.x + button.width &&\n               point.y >= button.y && \n               point.y <= button.y + button.height;\n    }\n\n    /**\n     * Handle button clicks\n     */\n    private handleButtonClick(buttonId: string): void {\n        if (!this.currentBody) return;\n        \n        const button = this.buttons.find(b => b.id === buttonId);\n        if (!button || !button.enabled) return;\n        \n        switch (buttonId) {\n            case 'enter_orbit':\n                this.interactions.onEnterOrbit?.(this.currentBody.id);\n                this.logger.info(`🛰️ Entering orbit around ${this.currentBody.name}`);\n                this.hideInteraction();\n                break;\n                \n            case 'land':\n                this.interactions.onLand?.(this.currentBody.id);\n                this.logger.info(`🚁 Landing on ${this.currentBody.name}`);\n                this.hideInteraction();\n                break;\n                \n            case 'scan':\n                this.performScan();\n                break;\n                \n            case 'mine':\n                this.performMining();\n                break;\n                \n            case 'continue':\n                this.interactions.onContinueFlight?.();\n                this.hideInteraction();\n                break;\n        }\n    }\n\n    /**\n     * Perform scan operation\n     */\n    private performScan(): void {\n        if (!this.currentBody) return;\n        \n        this.scanData = this.currentBody.performScan();\n        this.currentBody.isDiscovered = true;\n        \n        this.interactions.onPerformScan?.(this.currentBody.id);\n        \n        this.logger.info(`🔍 Scanned ${this.currentBody.name}`, {\n            composition: this.scanData.composition,\n            biologicalSigns: this.scanData.biologicalSigns\n        });\n        \n        // Refresh body info with scan data\n        this.bodyInfo = this.currentBody.getInteractionInfo();\n    }\n\n    /**\n     * Perform mining operation\n     */\n    private performMining(): void {\n        if (!this.currentBody) return;\n        \n        const shipPosition = { x: 0, y: 0 }; // TODO: Get actual ship position\n        const result = this.currentBody.performMining(shipPosition, 1.0);\n        \n        if (result) {\n            this.miningResults.push(result);\n            this.interactions.onStartMining?.(this.currentBody.id);\n            \n            this.logger.info(`⛏️ Mined ${result.quantity.toFixed(2)} ${result.resourceType}`, {\n                quality: result.quality,\n                depletion: result.depletion\n            });\n            \n            // Update button state if resources depleted\n            if (result.depletion > 0.9) {\n                const mineButton = this.buttons.find(b => b.id === 'mine');\n                if (mineButton) {\n                    mineButton.enabled = false;\n                    mineButton.color = { r: 24, g: 24, b: 24 }; // Disabled gray\n                }\n            }\n        }\n    }\n\n    /**\n     * Render the interaction panel\n     */\n    render(renderer: Renderer): void {\n        if (!this.isVisible || this.opacity <= 0) return;\n        \n        // Apply opacity to all colors\n        const alpha = this.opacity;\n        \n        // Render panel background (dark CRT monitor style)\n        const bgColor = { \n            r: Math.floor(8 * alpha), \n            g: Math.floor(12 * alpha), \n            b: Math.floor(8 * alpha) \n        };\n        renderer.fillRect(this.panelX, this.panelY, this.panelWidth, this.panelHeight, bgColor);\n        \n        // Panel border (dark green CRT glow)\n        const borderColor = { \n            r: Math.floor(16 * alpha), \n            g: Math.floor(48 * alpha), \n            b: Math.floor(16 * alpha) \n        };\n        this.renderPanelBorder(renderer, borderColor);\n        \n        // Panel title\n        const titleColor = { \n            r: Math.floor(12 * alpha), \n            g: Math.floor(36 * alpha), \n            b: Math.floor(12 * alpha) \n        };\n        renderer.renderText('PROXIMITY ALERT', this.panelX + 10, this.panelY + 10, titleColor, 10);\n        \n        // Body information\n        if (this.bodyInfo) {\n            this.renderBodyInfo(renderer, alpha);\n        }\n        \n        // Scan data\n        if (this.scanData) {\n            this.renderScanData(renderer, alpha);\n        }\n        \n        // Mining results\n        if (this.miningResults.length > 0) {\n            this.renderMiningResults(renderer, alpha);\n        }\n        \n        // Render buttons\n        this.renderButtons(renderer, alpha);\n        \n        // Render CRT effects\n        this.renderCRTEffects(renderer, alpha);\n    }\n\n    /**\n     * Render panel border with CRT styling\n     */\n    private renderPanelBorder(renderer: Renderer, color: Color): void {\n        // Top and bottom borders\n        renderer.fillRect(this.panelX, this.panelY, this.panelWidth, 2, color);\n        renderer.fillRect(this.panelX, this.panelY + this.panelHeight - 2, this.panelWidth, 2, color);\n        \n        // Left and right borders\n        renderer.fillRect(this.panelX, this.panelY, 2, this.panelHeight, color);\n        renderer.fillRect(this.panelX + this.panelWidth - 2, this.panelY, 2, this.panelHeight, color);\n        \n        // Corner highlights\n        const highlightColor = { r: color.r + 8, g: color.g + 8, b: color.b + 8 };\n        renderer.fillRect(this.panelX, this.panelY, 8, 2, highlightColor);\n        renderer.fillRect(this.panelX, this.panelY, 2, 8, highlightColor);\n    }\n\n    /**\n     * Render body information\n     */\n    private renderBodyInfo(renderer: Renderer, alpha: number): void {\n        const textColor = { \n            r: Math.floor(48 * alpha), \n            g: Math.floor(48 * alpha), \n            b: Math.floor(48 * alpha) \n        };\n        \n        const lines = this.bodyInfo.split('\\n');\n        let y = this.panelY + 30;\n        \n        lines.forEach(line => {\n            renderer.renderText(line, this.panelX + 10, y, textColor, 8);\n            y += 12;\n        });\n    }\n\n    /**\n     * Render scan data\n     */\n    private renderScanData(renderer: Renderer, alpha: number): void {\n        if (!this.scanData) return;\n        \n        const textColor = { \n            r: Math.floor(32 * alpha), \n            g: Math.floor(80 * alpha), \n            b: Math.floor(64 * alpha) \n        };\n        \n        let y = this.panelY + 30;\n        \n        renderer.renderText(`COMP: ${this.scanData.composition.join(', ')}`, \n            this.panelX + 10, y, textColor, 7);\n        y += 10;\n        \n        if (this.scanData.biologicalSigns) {\n            renderer.renderText('BIO: DETECTED', this.panelX + 10, y, \n                { r: Math.floor(96 * alpha), g: Math.floor(64 * alpha), b: Math.floor(16 * alpha) }, 7);\n            y += 10;\n        }\n        \n        renderer.renderText(`MINERALS: ${this.scanData.mineralDeposits.length}`, \n            this.panelX + 10, y, textColor, 7);\n    }\n\n    /**\n     * Render mining results\n     */\n    private renderMiningResults(renderer: Renderer, alpha: number): void {\n        const textColor = { \n            r: Math.floor(96 * alpha), \n            g: Math.floor(64 * alpha), \n            b: Math.floor(16 * alpha) \n        };\n        \n        const lastResult = this.miningResults[this.miningResults.length - 1];\n        const y = this.panelY + this.panelHeight - 60;\n        \n        renderer.renderText(`MINED: ${lastResult.quantity.toFixed(1)} ${lastResult.resourceType}`, \n            this.panelX + 10, y, textColor, 8);\n    }\n\n    /**\n     * Render interactive buttons\n     */\n    private renderButtons(renderer: Renderer, alpha: number): void {\n        this.buttons.forEach(button => {\n            const isHovered = this.hoveredButton === button.id;\n            const buttonAlpha = button.enabled ? alpha : alpha * 0.5;\n            \n            // Button background\n            const bgColor = isHovered ? \n                { \n                    r: Math.floor((button.color.r + 16) * buttonAlpha), \n                    g: Math.floor((button.color.g + 16) * buttonAlpha), \n                    b: Math.floor((button.color.b + 16) * buttonAlpha) \n                } : \n                { \n                    r: Math.floor(button.color.r * buttonAlpha), \n                    g: Math.floor(button.color.g * buttonAlpha), \n                    b: Math.floor(button.color.b * buttonAlpha) \n                };\n            \n            renderer.fillRect(button.x, button.y, button.width, button.height, bgColor);\n            \n            // Button border\n            const borderColor = { \n                r: Math.floor((button.color.r + 32) * buttonAlpha), \n                g: Math.floor((button.color.g + 32) * buttonAlpha), \n                b: Math.floor((button.color.b + 32) * buttonAlpha) \n            };\n            renderer.drawLine(button.x, button.y, button.x + button.width, button.y, borderColor);\n            renderer.drawLine(button.x, button.y, button.x, button.y + button.height, borderColor);\n            \n            // Button text\n            const textColor = button.enabled ? \n                { \n                    r: Math.floor(64 * alpha), \n                    g: Math.floor(64 * alpha), \n                    b: Math.floor(64 * alpha) \n                } : \n                { \n                    r: Math.floor(32 * alpha), \n                    g: Math.floor(32 * alpha), \n                    b: Math.floor(32 * alpha) \n                };\n            \n            const textX = button.x + (button.width - button.label.length * 6) / 2;\n            const textY = button.y + (button.height - 8) / 2;\n            renderer.renderText(button.label, textX, textY, textColor, 8);\n        });\n    }\n\n    /**\n     * Render CRT effects\n     */\n    private renderCRTEffects(renderer: Renderer, alpha: number): void {\n        // Subtle scanline effect across the panel\n        for (let y = this.panelY; y < this.panelY + this.panelHeight; y += 4) {\n            const scanlineColor = { \n                r: Math.floor(4 * alpha), \n                g: Math.floor(8 * alpha), \n                b: Math.floor(4 * alpha) \n            };\n            renderer.fillRect(this.panelX, y, this.panelWidth, 1, scanlineColor);\n        }\n    }\n\n    /**\n     * Check if panel is currently visible\n     */\n    isInteractionVisible(): boolean {\n        return this.isVisible;\n    }\n\n    /**\n     * Get current interaction body\n     */\n    getCurrentBody(): CelestialBody | null {\n        return this.currentBody;\n    }\n}","/**\n * Celestial Body Manager\n * Manages all celestial bodies in the current star system\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer } from '@core/Renderer';\nimport { CelestialBody, CelestialBodyConfig, BodyInteraction, InteractionZone } from '@entities/CelestialBody';\nimport { InteractionPanel, PanelInteractions } from '@ui/InteractionPanel';\nimport { StarSystemData, PlanetData, StarData } from '@procedural/GalaxyGenerator';\nimport { InputManager } from '@core/InputManager';\n\nexport interface CelestialManagerConfig {\n    renderDistance: number;\n    interactionDistance: number;\n    showOrbitLines: boolean;\n    enableInteractions: boolean;\n    celestialBodyConfig: CelestialBodyConfig;\n}\n\nexport interface SystemLoadConfig {\n    systemData: StarSystemData;\n    playerStartPosition?: Vector2;\n    cameraPosition: Vector2;\n}\n\nexport class CelestialManager {\n    private bodies: Map<string, CelestialBody> = new Map();\n    private interactionPanel: InteractionPanel;\n    private config: CelestialManagerConfig;\n    \n    // Current system data\n    private currentSystem: StarSystemData | null = null;\n    private systemCenter: Vector2 = { x: 512, y: 384 };\n    \n    // Interaction state\n    private nearbyBodies: CelestialBody[] = [];\n    private currentInteraction: { body: CelestialBody; zone: InteractionZone } | null = null;\n    \n    // Performance tracking\n    private lastUpdateTime: number = 0;\n    private frameCount: number = 0;\n    \n    private logger: Logger;\n\n    constructor(\n        config: Partial<CelestialManagerConfig> = {},\n        panelInteractions: PanelInteractions = {}\n    ) {\n        this.logger = new Logger('CelestialManager');\n        \n        this.config = {\n            renderDistance: 2000,\n            interactionDistance: 150,\n            showOrbitLines: true,\n            enableInteractions: true,\n            celestialBodyConfig: {\n                renderDistance: 2000,\n                orbitLineOpacity: 0.3,\n                showOrbitLines: true,\n                animationSpeed: 1.0,\n                minPixelSize: 2,\n                maxPixelSize: 80\n            },\n            ...config\n        };\n        \n        // Initialize interaction panel\n        this.interactionPanel = new InteractionPanel({\n            enableAnimations: true,\n            fadeSpeed: 3.0,\n            maxWidth: 300,\n            maxHeight: 200\n        }, panelInteractions);\n        \n        this.logger.info('🌌 Celestial manager initialized', {\n            renderDistance: this.config.renderDistance,\n            enableInteractions: this.config.enableInteractions\n        });\n    }\n\n    /**\n     * Load a star system\n     */\n    loadSystem(systemConfig: SystemLoadConfig): void {\n        this.logger.info(`🌟 Loading star system: ${systemConfig.systemData.name}`);\n        \n        // Clear existing bodies\n        this.clearSystem();\n        \n        // Store system data\n        this.currentSystem = systemConfig.systemData;\n        this.systemCenter = systemConfig.cameraPosition;\n        \n        // Create star\n        this.createStar(systemConfig.systemData.star);\n        \n        // Create planets\n        systemConfig.systemData.planets.forEach((planetData, index) => {\n            this.createPlanet(planetData, index);\n        });\n        \n        // Create moons for planets\n        systemConfig.systemData.planets.forEach(planetData => {\n            if (planetData.moons && planetData.moons.length > 0) {\n                planetData.moons.forEach(moonData => {\n                    this.createMoon(moonData, planetData);\n                });\n            }\n        });\n        \n        // Setup orbital mechanics\n        this.setupOrbitalMechanics();\n        \n        this.logger.info(`✅ System loaded: ${this.bodies.size} celestial bodies created`);\n    }\n\n    /**\n     * Create star from data\n     */\n    private createStar(starData: StarData): void {\n        const star = new CelestialBody({\n            id: starData.id,\n            name: starData.name,\n            type: 'star',\n            position: { ...this.systemCenter },\n            radius: Math.min(starData.radius * 20, 80), // Scale for visibility\n            mass: starData.mass * 1000000,\n            color: this.getStarColor(starData.temperature),\n            starData: starData\n        });\n        \n        // Mark as discovered (stars are always visible)\n        star.isDiscovered = true;\n        \n        this.bodies.set(star.id, star);\n        this.logger.debug(`⭐ Created star: ${star.name}`);\n    }\n\n    /**\n     * Get star color based on temperature (dark retro style)\n     */\n    private getStarColor(temperature: number): { r: number, g: number, b: number } {\n        // Dark, muted star colors\n        if (temperature > 25000) return { r: 32, g: 36, b: 48 }; // Blue giant\n        if (temperature > 10000) return { r: 40, g: 44, b: 48 }; // Blue-white\n        if (temperature > 7500) return { r: 48, g: 48, b: 48 };  // White\n        if (temperature > 6000) return { r: 48, g: 44, b: 36 };  // Yellow-white (Sun-like)\n        if (temperature > 5000) return { r: 48, g: 40, b: 28 };  // Yellow\n        if (temperature > 3500) return { r: 48, g: 32, b: 20 };  // Orange\n        return { r: 48, g: 24, b: 16 }; // Red dwarf\n    }\n\n    /**\n     * Create planet from data\n     */\n    private createPlanet(planetData: PlanetData, index: number): void {\n        // Calculate position in orbit around star\n        const angle = (index * Math.PI * 2) / (this.currentSystem?.planets.length || 1);\n        const orbitDistance = 150 + (planetData.orbitDistance * 30); // Scale for screen\n        \n        const position = {\n            x: this.systemCenter.x + Math.cos(angle) * orbitDistance,\n            y: this.systemCenter.y + Math.sin(angle) * orbitDistance\n        };\n        \n        const planet = new CelestialBody({\n            id: planetData.id,\n            name: planetData.name,\n            type: 'planet',\n            position: position,\n            radius: Math.max(planetData.radius * 10, 15), // Scale for visibility\n            mass: planetData.mass * 10000,\n            color: this.getPlanetColor(planetData),\n            planetData: planetData\n        });\n        \n        // Set orbital mechanics\n        planet.setOrbit(\n            { ...this.systemCenter },\n            orbitDistance,\n            2 * Math.PI / (planetData.orbitPeriod / 3600) // Convert to radians per hour\n        );\n        \n        this.bodies.set(planet.id, planet);\n        this.logger.debug(`🪐 Created planet: ${planet.name}`);\n    }\n\n    /**\n     * Get planet color based on type and surface (dark retro style)\n     */\n    private getPlanetColor(planetData: PlanetData): { r: number, g: number, b: number } {\n        // Dark, muted planet colors based on surface type and planet type\n        const surfaceType = planetData.surfaceType as string;\n        switch (surfaceType) {\n            case 'Rocky': return { r: 32, g: 24, b: 16 };\n            case 'Desert': return { r: 48, g: 32, b: 16 };\n            case 'Ocean': return { r: 8, g: 16, b: 32 };\n            case 'Ice': return { r: 32, g: 36, b: 40 };\n            case 'Lava': return { r: 32, g: 16, b: 8 };\n            case 'Gas': return { r: 40, g: 32, b: 24 };\n            case 'Toxic': return { r: 32, g: 24, b: 16 };\n            case 'Crystalline': return { r: 24, g: 32, b: 36 };\n            default: return { r: 24, g: 24, b: 24 };\n        }\n    }\n\n    /**\n     * Create moon from data\n     */\n    private createMoon(moonData: any, parentPlanet: PlanetData): void {\n        const parentBody = this.bodies.get(parentPlanet.id);\n        if (!parentBody) return;\n        \n        // Position moon around parent planet\n        const angle = Math.random() * Math.PI * 2;\n        const orbitDistance = moonData.orbitDistance * 3; // Scale for screen\n        \n        const position = {\n            x: parentBody.position.x + Math.cos(angle) * orbitDistance,\n            y: parentBody.position.y + Math.sin(angle) * orbitDistance\n        };\n        \n        const moon = new CelestialBody({\n            id: moonData.id,\n            name: moonData.name,\n            type: 'moon',\n            position: position,\n            radius: Math.max(moonData.radius * 8, 8), // Scale for visibility\n            mass: moonData.mass * 10000,\n            color: { r: 24, g: 24, b: 24 }, // Dark gray for moons\n            moonData: moonData\n        });\n        \n        // Set orbital mechanics around parent planet\n        moon.setOrbit(\n            { ...parentBody.position },\n            orbitDistance,\n            2 * Math.PI / (moonData.orbitPeriod / 60) // Convert to radians per minute\n        );\n        \n        this.bodies.set(moon.id, moon);\n        this.logger.debug(`🌙 Created moon: ${moon.name} (around ${parentPlanet.name})`);\n    }\n\n    /**\n     * Setup orbital mechanics for all bodies\n     */\n    private setupOrbitalMechanics(): void {\n        // Update moon orbits to follow their parent planets\n        this.bodies.forEach(body => {\n            if (body.type === 'moon' && body.moonData) {\n                const parentPlanet = Array.from(this.bodies.values()).find(planet => \n                    planet.type === 'planet' && planet.planetData?.moons?.some(moon => moon.id === body.id)\n                );\n                \n                if (parentPlanet) {\n                    // Moon orbit follows planet position\n                    const originalSetOrbit = body.setOrbit.bind(body);\n                    body.setOrbit = (center, radius, speed) => {\n                        // Update orbit center to parent planet's current position\n                        originalSetOrbit(parentPlanet.position, radius, speed);\n                    };\n                }\n            }\n        });\n    }\n\n    /**\n     * Update all celestial bodies\n     */\n    update(deltaTime: number, input: InputManager, shipPosition: Vector2): void {\n        this.lastUpdateTime = deltaTime;\n        this.frameCount++;\n        \n        // Update all celestial bodies\n        this.bodies.forEach(body => {\n            body.update(deltaTime);\n        });\n        \n        // Update interactions if enabled\n        if (this.config.enableInteractions) {\n            this.updateInteractions(shipPosition, input);\n        }\n        \n        // Update interaction panel\n        this.interactionPanel.update(deltaTime, input);\n    }\n\n    /**\n     * Update interaction system\n     */\n    private updateInteractions(shipPosition: Vector2, input: InputManager): void {\n        // Find nearby bodies\n        this.nearbyBodies = [];\n        let closestInteraction: { body: CelestialBody; zone: InteractionZone } | null = null;\n        let closestDistance = Infinity;\n        \n        this.bodies.forEach(body => {\n            const distance = body.getDistanceFrom(shipPosition);\n            \n            if (distance <= this.config.interactionDistance) {\n                this.nearbyBodies.push(body);\n                \n                // Check for interaction zones\n                const zone = body.checkInteraction(shipPosition);\n                if (zone && distance < closestDistance) {\n                    closestDistance = distance;\n                    closestInteraction = { body, zone };\n                }\n            }\n        });\n        \n                // Handle interaction changes\n        if (closestInteraction && closestInteraction !== this.currentInteraction) {\n            // New interaction\n            this.currentInteraction = closestInteraction;\n            const interaction = closestInteraction as { body: CelestialBody; zone: InteractionZone };\n            this.interactionPanel.showInteraction(\n                interaction.body,\n                interaction.zone,\n                shipPosition\n            );\n            \n            this.logger.debug(`🎯 New interaction: ${interaction.body.name} (${interaction.zone.type})`);\n            \n        } else if (!closestInteraction && this.currentInteraction) {\n            // Lost interaction\n            this.currentInteraction = null;\n            this.interactionPanel.hideInteraction();\n            \n            this.logger.debug('🚀 Left interaction zone');\n        }\n    }\n\n    /**\n     * Render all celestial bodies\n     */\n    render(renderer: Renderer, cameraPosition: Vector2): void {\n        // Sort bodies by distance for proper rendering order\n        const sortedBodies = Array.from(this.bodies.values()).sort((a, b) => {\n            const distA = a.getDistanceFrom(cameraPosition);\n            const distB = b.getDistanceFrom(cameraPosition);\n            return distB - distA; // Render farthest first\n        });\n        \n        // Render celestial bodies\n        sortedBodies.forEach(body => {\n            body.render(renderer, cameraPosition, this.config.celestialBodyConfig);\n        });\n        \n        // Render interaction panel\n        this.interactionPanel.render(renderer);\n    }\n\n    /**\n     * Clear current system\n     */\n    private clearSystem(): void {\n        this.bodies.clear();\n        this.nearbyBodies = [];\n        this.currentInteraction = null;\n        this.interactionPanel.hideInteraction();\n        \n        this.logger.debug('🧹 System cleared');\n    }\n\n    /**\n     * Get celestial body by ID\n     */\n    getBody(bodyId: string): CelestialBody | undefined {\n        return this.bodies.get(bodyId);\n    }\n\n    /**\n     * Get all bodies in system\n     */\n    getAllBodies(): CelestialBody[] {\n        return Array.from(this.bodies.values());\n    }\n\n    /**\n     * Get nearby bodies\n     */\n    getNearbyBodies(): CelestialBody[] {\n        return [...this.nearbyBodies];\n    }\n\n    /**\n     * Get current interaction\n     */\n    getCurrentInteraction(): { body: CelestialBody, zone: InteractionZone } | null {\n        return this.currentInteraction;\n    }\n\n    /**\n     * Force discovery of all bodies (for debugging)\n     */\n    discoverAllBodies(): void {\n        this.bodies.forEach(body => {\n            body.isDiscovered = true;\n        });\n        this.logger.info('🔍 All bodies discovered');\n    }\n\n    /**\n     * Get system statistics\n     */\n    getSystemStats(): {\n        bodyCount: number;\n        discoveredBodies: number;\n        scannedBodies: number;\n        nearbyBodies: number;\n        hasActiveInteraction: boolean;\n    } {\n        const discoveredBodies = Array.from(this.bodies.values()).filter(b => b.isDiscovered).length;\n        const scannedBodies = Array.from(this.bodies.values()).filter(b => b.isScanned).length;\n        \n        return {\n            bodyCount: this.bodies.size,\n            discoveredBodies,\n            scannedBodies,\n            nearbyBodies: this.nearbyBodies.length,\n            hasActiveInteraction: this.currentInteraction !== null\n        };\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(newConfig: Partial<CelestialManagerConfig>): void {\n        this.config = { ...this.config, ...newConfig };\n        this.logger.debug('Config updated', newConfig);\n    }\n\n    /**\n     * Get current system data\n     */\n    getCurrentSystem(): StarSystemData | null {\n        return this.currentSystem;\n    }\n\n    /**\n     * Perform action on body\n     */\n    performAction(bodyId: string, action: 'scan' | 'mine' | 'land', shipPosition?: Vector2): boolean {\n        const body = this.bodies.get(bodyId);\n        if (!body) return false;\n        \n        switch (action) {\n            case 'scan':\n                body.performScan();\n                body.isDiscovered = true;\n                this.logger.info(`🔍 Scanned ${body.name}`);\n                return true;\n                \n            case 'mine':\n                if (shipPosition) {\n                    const result = body.performMining(shipPosition);\n                    if (result) {\n                        this.logger.info(`⛏️ Mined ${result.quantity.toFixed(2)} ${result.resourceType} from ${body.name}`);\n                        return true;\n                    }\n                }\n                return false;\n                \n            case 'land':\n                const interaction = body.checkInteraction(shipPosition || { x: 0, y: 0 });\n                if (interaction && interaction.type === 'surface' && interaction.canEnter) {\n                    body.isLanded = true;\n                    this.logger.info(`🚁 Landed on ${body.name}`);\n                    return true;\n                }\n                return false;\n                \n            default:\n                return false;\n        }\n    }\n\n    /**\n     * Get all active celestial bodies\n     */\n    getActiveBodies(): CelestialBody[] {\n        return Array.from(this.bodies.values());\n    }\n\n    /**\n     * Cleanup\n     */\n    cleanup(): void {\n        this.clearSystem();\n        this.logger.info('🧹 Celestial manager cleanup completed');\n    }\n}","/**\n * Space Background Renderer\n * Multi-layered pixel art space background with warp distortion support\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer, Color } from '@core/Renderer';\n\nexport interface SpaceBackgroundConfig {\n    starCount: number;\n    starLayers: number;\n    parallaxStrength: number;\n    enableDistortion: boolean;\n    galaxyBandIntensity: number;\n    nebulaOpacity: number;\n}\n\nexport interface BackgroundStar {\n    position: Vector2;\n    originalPosition: Vector2; // For distortion restoration\n    color: Color;\n    size: number;\n    layer: number; // 0-4 for parallax\n    twinkle: number; // Twinkle phase\n}\n\nexport interface SpaceDistortionData {\n    center: Vector2;\n    intensity: number; // 0-1\n    radius: number;\n}\n\nexport class SpaceBackground {\n    private config: SpaceBackgroundConfig;\n    private stars: BackgroundStar[] = [];\n    private galaxyBand: BackgroundStar[] = [];\n    private nebulaClouds: Array<{ x: number, y: number, size: number, color: Color }> = [];\n    \n    // Distortion state\n    private isDistorted: boolean = false;\n    private distortionData: SpaceDistortionData | null = null;\n    \n    // Animation\n    private time: number = 0;\n    \n    private logger: Logger;\n\n    constructor(config: Partial<SpaceBackgroundConfig> = {}) {\n        this.logger = new Logger('SpaceBackground');\n        \n        this.config = {\n            starCount: 300,\n            starLayers: 5,\n            parallaxStrength: 0.3,\n            enableDistortion: true,\n            galaxyBandIntensity: 0.4,\n            nebulaOpacity: 0.2,\n            ...config\n        };\n        \n        this.generateBackground();\n        \n        this.logger.info('🌌 Space background initialized', {\n            starCount: this.stars.length,\n            layers: this.config.starLayers\n        });\n    }\n\n    /**\n     * Generate the complete background\n     */\n    private generateBackground(): void {\n        this.generateStars();\n        this.generateGalaxyBand();\n        this.generateNebulae();\n    }\n\n    /**\n     * Generate background stars with multiple layers for parallax\n     */\n    private generateStars(): void {\n        this.stars = [];\n        \n        for (let i = 0; i < this.config.starCount; i++) {\n            const position = {\n                x: Math.random() * 2048, // Larger than screen for movement\n                y: Math.random() * 1536\n            };\n            \n            const layer = Math.floor(Math.random() * this.config.starLayers);\n            const size = this.getStarSize(layer);\n            const color = this.getStarColor();\n            \n            this.stars.push({\n                position: { ...position },\n                originalPosition: { ...position },\n                color,\n                size,\n                layer,\n                twinkle: Math.random() * Math.PI * 2\n            });\n        }\n    }\n\n    /**\n     * Generate galaxy band (Milky Way-like band across sky)\n     */\n    private generateGalaxyBand(): void {\n        this.galaxyBand = [];\n        const bandStars = 80;\n        \n        // Create a diagonal band across the screen\n        for (let i = 0; i < bandStars; i++) {\n            const progress = i / bandStars;\n            const bandWidth = 200;\n            const bandOffset = Math.sin(progress * Math.PI * 3) * 50; // Wavy band\n            \n            const position = {\n                x: progress * 2048 + bandOffset,\n                y: 400 + bandOffset + (Math.random() - 0.5) * bandWidth\n            };\n            \n            // Dense, small stars for galaxy band\n            const color = this.getGalaxyBandColor();\n            \n            this.galaxyBand.push({\n                position: { ...position },\n                originalPosition: { ...position },\n                color,\n                size: Math.random() * 1.5 + 0.5,\n                layer: 2, // Middle layer\n                twinkle: Math.random() * Math.PI * 2\n            });\n        }\n    }\n\n    /**\n     * Generate nebula clouds\n     */\n    private generateNebulae(): void {\n        this.nebulaClouds = [];\n        const nebulaCount = 5;\n        \n        for (let i = 0; i < nebulaCount; i++) {\n            this.nebulaClouds.push({\n                x: Math.random() * 2048,\n                y: Math.random() * 1536,\n                size: Math.random() * 150 + 100,\n                color: this.getNebulaColor()\n            });\n        }\n    }\n\n    /**\n     * Get star size based on layer (closer = bigger)\n     */\n    private getStarSize(layer: number): number {\n        const baseSizes = [3, 2.5, 2, 1.5, 1]; // Layer 0 = closest/biggest\n        return baseSizes[layer] + Math.random() * 0.5;\n    }\n\n    /**\n     * Get star color (dark, muted space colors)\n     */\n    private getStarColor(): Color {\n        const colors = [\n            { r: 64, g: 64, b: 64 },  // White (muted)\n            { r: 48, g: 44, b: 36 },  // Yellow-white\n            { r: 48, g: 40, b: 28 },  // Yellow\n            { r: 48, g: 32, b: 20 },  // Orange\n            { r: 48, g: 24, b: 16 },  // Red\n            { r: 32, g: 36, b: 48 },  // Blue\n            { r: 40, g: 44, b: 48 }   // Blue-white\n        ];\n        return colors[Math.floor(Math.random() * colors.length)];\n    }\n\n    /**\n     * Get galaxy band star color (warmer, denser appearance)\n     */\n    private getGalaxyBandColor(): Color {\n        const colors = [\n            { r: 48, g: 44, b: 28 },  // Warm white\n            { r: 48, g: 40, b: 24 },  // Warm yellow\n            { r: 32, g: 28, b: 20 },  // Dim orange\n            { r: 24, g: 24, b: 20 }   // Very dim\n        ];\n        return colors[Math.floor(Math.random() * colors.length)];\n    }\n\n    /**\n     * Get nebula color (very muted space dust)\n     */\n    private getNebulaColor(): Color {\n        const colors = [\n            { r: 24, g: 16, b: 32 },  // Purple nebula\n            { r: 32, g: 24, b: 16 },  // Brown nebula\n            { r: 16, g: 24, b: 32 },  // Blue nebula\n            { r: 24, g: 32, b: 16 }   // Green nebula\n        ];\n        return colors[Math.floor(Math.random() * colors.length)];\n    }\n\n    /**\n     * Update background animation\n     */\n    update(deltaTime: number): void {\n        this.time += deltaTime;\n        \n        // Update star twinkle animation\n        this.stars.forEach(star => {\n            star.twinkle += deltaTime * (0.5 + Math.random() * 0.5);\n        });\n        \n        this.galaxyBand.forEach(star => {\n            star.twinkle += deltaTime * 0.3; // Slower twinkle for galaxy band\n        });\n    }\n\n    /**\n     * Apply warp distortion to background\n     */\n    applyWarpDistortion(distortionData: SpaceDistortionData): void {\n        if (!this.config.enableDistortion) return;\n        \n        this.distortionData = { ...distortionData };\n        this.isDistorted = true;\n        \n        // Apply distortion to all stars\n        this.distortStars(this.stars, distortionData);\n        this.distortStars(this.galaxyBand, distortionData);\n        \n        this.logger.debug('🌀 Warp distortion applied to background');\n    }\n\n    /**\n     * Restore background from distortion\n     */\n    restoreFromDistortion(): void {\n        if (!this.isDistorted) return;\n        \n        // Restore all stars to original positions\n        this.stars.forEach(star => {\n            star.position = { ...star.originalPosition };\n        });\n        \n        this.galaxyBand.forEach(star => {\n            star.position = { ...star.originalPosition };\n        });\n        \n        this.isDistorted = false;\n        this.distortionData = null;\n        \n        this.logger.debug('🌌 Background restored from warp distortion');\n    }\n\n    /**\n     * Gradually restore background during warp deactivation\n     */\n    gradualRestore(progress: number): void {\n        if (!this.isDistorted || !this.distortionData) return;\n        \n        const restoreAmount = 1.0 - progress; // 1.0 = fully restored, 0.0 = fully distorted\n        \n        // Gradually restore stars\n        this.restoreStarsGradually(this.stars, restoreAmount);\n        this.restoreStarsGradually(this.galaxyBand, restoreAmount);\n    }\n\n    /**\n     * Apply distortion to a set of stars\n     */\n    private distortStars(stars: BackgroundStar[], distortionData: SpaceDistortionData): void {\n        stars.forEach(star => {\n            const dx = star.originalPosition.x - distortionData.center.x;\n            const dy = star.originalPosition.y - distortionData.center.y;\n            const distance = Math.sqrt(dx * dx + dy * dy);\n            \n            if (distance < distortionData.radius) {\n                // Calculate distortion strength based on distance\n                const distortionStrength = (1 - distance / distortionData.radius) * distortionData.intensity;\n                \n                // Apply distortion toward the center\n                const pullStrength = distortionStrength * 50 * (star.layer + 1); // Closer layers distort more\n                \n                star.position.x = star.originalPosition.x - (dx / distance) * pullStrength;\n                star.position.y = star.originalPosition.y - (dy / distance) * pullStrength;\n            }\n        });\n    }\n\n    /**\n     * Gradually restore stars during deactivation\n     */\n    private restoreStarsGradually(stars: BackgroundStar[], restoreAmount: number): void {\n        stars.forEach(star => {\n            // Interpolate between distorted and original position\n            star.position.x = star.position.x + (star.originalPosition.x - star.position.x) * restoreAmount * 0.1;\n            star.position.y = star.position.y + (star.originalPosition.y - star.position.y) * restoreAmount * 0.1;\n        });\n    }\n\n    /**\n     * Render the space background\n     */\n    render(renderer: Renderer, cameraPosition: Vector2): void {\n        // Render nebulae first (background layer)\n        this.renderNebulae(renderer, cameraPosition);\n        \n        // Render galaxy band\n        this.renderGalaxyBand(renderer, cameraPosition);\n        \n        // Render stars in layers (back to front for parallax)\n        for (let layer = this.config.starLayers - 1; layer >= 0; layer--) {\n            this.renderStarLayer(renderer, cameraPosition, layer);\n        }\n    }\n\n    /**\n     * Render nebula clouds\n     */\n    private renderNebulae(renderer: Renderer, cameraPosition: Vector2): void {\n        this.nebulaClouds.forEach(nebula => {\n            const parallaxFactor = 0.1; // Very slow parallax for distant nebulae\n            const screenX = nebula.x - cameraPosition.x * parallaxFactor;\n            const screenY = nebula.y - cameraPosition.y * parallaxFactor;\n            \n            // Skip if off-screen\n            if (screenX < -nebula.size || screenX > 1024 + nebula.size ||\n                screenY < -nebula.size || screenY > 768 + nebula.size) {\n                return;\n            }\n            \n            // Render nebula as scattered pixels\n            const pixelCount = Math.floor(nebula.size / 8);\n            for (let i = 0; i < pixelCount; i++) {\n                const angle = (i / pixelCount) * Math.PI * 2 + this.time * 0.1;\n                const radius = (nebula.size / 2) * Math.sqrt(Math.random()); // Even distribution\n                \n                const x = screenX + Math.cos(angle) * radius;\n                const y = screenY + Math.sin(angle) * radius;\n                \n                const alpha = this.config.nebulaOpacity * (1 - radius / (nebula.size / 2));\n                const color = {\n                    r: Math.floor(nebula.color.r * alpha),\n                    g: Math.floor(nebula.color.g * alpha),\n                    b: Math.floor(nebula.color.b * alpha)\n                };\n                \n                if (color.r > 0 || color.g > 0 || color.b > 0) {\n                    renderer.setPixel(x, y, color);\n                }\n            }\n        });\n    }\n\n    /**\n     * Render galaxy band\n     */\n    private renderGalaxyBand(renderer: Renderer, cameraPosition: Vector2): void {\n        this.galaxyBand.forEach(star => {\n            const parallaxFactor = 0.3; // Medium parallax for galaxy band\n            const screenX = star.position.x - cameraPosition.x * parallaxFactor;\n            const screenY = star.position.y - cameraPosition.y * parallaxFactor;\n            \n            // Skip if off-screen\n            if (screenX < -10 || screenX > 1034 || screenY < -10 || screenY > 778) {\n                return;\n            }\n            \n            // Apply galaxy band intensity and twinkle\n            const twinkle = Math.sin(star.twinkle) * 0.3 + 0.7; // 0.4 to 1.0\n            const intensity = this.config.galaxyBandIntensity * twinkle;\n            \n            const color = {\n                r: Math.floor(star.color.r * intensity),\n                g: Math.floor(star.color.g * intensity),\n                b: Math.floor(star.color.b * intensity)\n            };\n            \n            this.renderStar(renderer, screenX, screenY, star.size * 0.8, color);\n        });\n    }\n\n    /**\n     * Render stars for a specific parallax layer\n     */\n    private renderStarLayer(renderer: Renderer, cameraPosition: Vector2, layer: number): void {\n        // Calculate parallax factor (layer 0 = closest, moves most)\n        const parallaxFactor = (layer + 1) * this.config.parallaxStrength;\n        \n        this.stars.filter(star => star.layer === layer).forEach(star => {\n            const screenX = star.position.x - cameraPosition.x * parallaxFactor;\n            const screenY = star.position.y - cameraPosition.y * parallaxFactor;\n            \n            // Skip if off-screen\n            if (screenX < -10 || screenX > 1034 || screenY < -10 || screenY > 778) {\n                return;\n            }\n            \n            // Apply twinkle effect\n            const twinkle = Math.sin(star.twinkle) * 0.4 + 0.6; // 0.2 to 1.0\n            const color = {\n                r: Math.floor(star.color.r * twinkle),\n                g: Math.floor(star.color.g * twinkle),\n                b: Math.floor(star.color.b * twinkle)\n            };\n            \n            this.renderStar(renderer, screenX, screenY, star.size, color);\n        });\n    }\n\n    /**\n     * Render individual star\n     */\n    private renderStar(renderer: Renderer, x: number, y: number, size: number, color: Color): void {\n        if (size <= 1) {\n            // Single pixel star\n            renderer.setPixel(x, y, color);\n        } else if (size <= 2) {\n            // 2x2 star\n            renderer.fillRect(x - 1, y - 1, 2, 2, color);\n        } else {\n            // Larger star with cross pattern\n            const coreSize = Math.floor(size);\n            const halfCore = Math.floor(coreSize / 2);\n            \n            // Core\n            renderer.fillRect(x - halfCore, y - halfCore, coreSize, coreSize, color);\n            \n            // Cross pattern for larger stars\n            if (size > 2.5) {\n                const dimColor = {\n                    r: Math.floor(color.r * 0.6),\n                    g: Math.floor(color.g * 0.6),\n                    b: Math.floor(color.b * 0.6)\n                };\n                \n                // Horizontal beam\n                renderer.fillRect(x - size, y - 1, size * 2, 2, dimColor);\n                // Vertical beam\n                renderer.fillRect(x - 1, y - size, 2, size * 2, dimColor);\n            }\n        }\n    }\n\n    /**\n     * Update background during warp\n     */\n    updateWarpDistortion(distortionData: SpaceDistortionData): void {\n        if (this.config.enableDistortion) {\n            this.applyWarpDistortion(distortionData);\n        }\n    }\n\n    /**\n     * Get background statistics\n     */\n    getStats(): {\n        starCount: number;\n        galaxyBandStars: number;\n        nebulaCount: number;\n        isDistorted: boolean;\n    } {\n        return {\n            starCount: this.stars.length,\n            galaxyBandStars: this.galaxyBand.length,\n            nebulaCount: this.nebulaClouds.length,\n            isDistorted: this.isDistorted\n        };\n    }\n\n    /**\n     * Regenerate background (for different star systems)\n     */\n    regenerateBackground(): void {\n        this.generateBackground();\n        this.logger.info('🌌 Background regenerated');\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(newConfig: Partial<SpaceBackgroundConfig>): void {\n        this.config = { ...this.config, ...newConfig };\n        \n        // Regenerate if significant changes\n        if (newConfig.starCount || newConfig.starLayers) {\n            this.regenerateBackground();\n        }\n    }\n}","/**\n * Item System - Core item definitions and management\n * Comprehensive item system with procedural generation and 16-bit pixel art\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Color, Renderer } from '@core/Renderer';\n\nexport enum ItemType {\n    Resource = 'resource',\n    Component = 'component',\n    Equipment = 'equipment',\n    Weapon = 'weapon',\n    Tool = 'tool',\n    Consumable = 'consumable',\n    Blueprint = 'blueprint',\n    Artifact = 'artifact'\n}\n\nexport enum ItemRarity {\n    Common = 'common',\n    Uncommon = 'uncommon',\n    Rare = 'rare',\n    Epic = 'epic',\n    Legendary = 'legendary',\n    Artifact = 'artifact'\n}\n\nexport enum ItemCategory {\n    // Resources\n    Metal = 'metal',\n    Crystal = 'crystal',\n    Gas = 'gas',\n    Biological = 'biological',\n    Energy = 'energy',\n    Exotic = 'exotic',\n    \n    // Equipment\n    Engine = 'engine',\n    Shield = 'shield',\n    Reactor = 'reactor',\n    Scanner = 'scanner',\n    WarpCore = 'warp_core',\n    \n    // Weapons\n    Projectile = 'projectile',\n    EnergyWeapon = 'energy_weapon',\n    Missile = 'missile',\n    \n    // Tools\n    Mining = 'mining',\n    Repair = 'repair',\n    Research = 'research'\n}\n\nexport interface ItemStats {\n    // Base properties\n    mass: number;\n    volume: number;\n    durability?: number; // For equipment/tools\n    maxStack: number;\n    \n    // Equipment stats\n    power?: number;\n    efficiency?: number;\n    range?: number;\n    damage?: number;\n    defense?: number;\n    \n    // Resource/component stats\n    purity?: number; // 0-1\n    stability?: number; // 0-1\n    radioactivity?: number; // 0-1\n}\n\nexport interface ItemRecipe {\n    id: string;\n    requiredItems: { [itemId: string]: number };\n    requiredTech?: string[];\n    craftingTime: number; // seconds\n    energyCost: number;\n    successRate: number; // 0-1\n}\n\nexport interface ItemSprite {\n    width: number;\n    height: number;\n    pixels: Color[][]; // 2D array of colors for 16-bit sprite\n}\n\nexport interface GameItem {\n    id: string;\n    name: string;\n    description: string;\n    type: ItemType;\n    category: ItemCategory;\n    rarity: ItemRarity;\n    \n    // Visual\n    sprite: ItemSprite;\n    iconColor: Color;\n    \n    // Properties\n    stats: ItemStats;\n    \n    // Crafting\n    recipe?: ItemRecipe;\n    \n    // Special properties\n    isUnique: boolean;\n    isTradeable: boolean;\n    isConsumable: boolean;\n    \n    // Lore\n    loreText?: string;\n    discoveredBy?: string;\n    discoveryDate?: number;\n}\n\nexport interface ItemStack {\n    item: GameItem;\n    quantity: number;\n    condition?: number; // 0-1 for equipment durability\n    modifiers?: { [key: string]: number }; // Special modifiers\n}\n\nexport class ItemDatabase {\n    private items: Map<string, GameItem> = new Map();\n    private recipes: Map<string, ItemRecipe> = new Map();\n    private categories: Map<ItemCategory, GameItem[]> = new Map();\n    \n    private logger: Logger;\n\n    constructor() {\n        this.logger = new Logger('ItemDatabase');\n        this.initializeDatabase();\n        this.logger.info('📦 Item database initialized', {\n            totalItems: this.items.size,\n            categories: this.categories.size\n        });\n    }\n\n    /**\n     * Initialize the item database with base items\n     */\n    private initializeDatabase(): void {\n        // Generate base resources\n        this.generateResources();\n        \n        // Generate components\n        this.generateComponents();\n        \n        // Generate equipment\n        this.generateEquipment();\n        \n        // Generate weapons\n        this.generateWeapons();\n        \n        // Generate tools\n        this.generateTools();\n        \n        // Generate consumables\n        this.generateConsumables();\n        \n        // Generate blueprints\n        this.generateBlueprints();\n        \n        // Generate artifacts\n        this.generateArtifacts();\n    }\n\n    /**\n     * Generate base resources\n     */\n    private generateResources(): void {\n        const resources = [\n            {\n                id: 'metal_iron',\n                name: 'Iron Ore',\n                description: 'Common metallic ore found throughout the galaxy.',\n                category: ItemCategory.Metal,\n                rarity: ItemRarity.Common,\n                stats: { mass: 1, volume: 1, maxStack: 1000, purity: 0.7 },\n                color: { r: 48, g: 32, b: 24 }\n            },\n            {\n                id: 'metal_titanium',\n                name: 'Titanium',\n                description: 'Lightweight, durable metal used in ship construction.',\n                category: ItemCategory.Metal,\n                rarity: ItemRarity.Uncommon,\n                stats: { mass: 0.8, volume: 1, maxStack: 500, purity: 0.85 },\n                color: { r: 64, g: 64, b: 64 }\n            },\n            {\n                id: 'crystal_quartz',\n                name: 'Quartz Crystal',\n                description: 'Common crystalline structure with electronic properties.',\n                category: ItemCategory.Crystal,\n                rarity: ItemRarity.Common,\n                stats: { mass: 0.5, volume: 1, maxStack: 200, purity: 0.6 },\n                color: { r: 48, g: 48, b: 56 }\n            },\n            {\n                id: 'crystal_dilithium',\n                name: 'Dilithium Crystal',\n                description: 'Rare crystal essential for warp core regulation.',\n                category: ItemCategory.Crystal,\n                rarity: ItemRarity.Rare,\n                stats: { mass: 0.3, volume: 1, maxStack: 50, purity: 0.9, radioactivity: 0.3 },\n                color: { r: 32, g: 48, b: 32 }\n            },\n            {\n                id: 'gas_hydrogen',\n                name: 'Hydrogen',\n                description: 'Common gas used for fuel and life support.',\n                category: ItemCategory.Gas,\n                rarity: ItemRarity.Common,\n                stats: { mass: 0.1, volume: 2, maxStack: 2000, purity: 0.8 },\n                color: { r: 32, g: 40, b: 48 }\n            },\n            {\n                id: 'bio_protein',\n                name: 'Protein Compounds',\n                description: 'Organic compounds essential for life support systems.',\n                category: ItemCategory.Biological,\n                rarity: ItemRarity.Uncommon,\n                stats: { mass: 0.5, volume: 1, maxStack: 100, stability: 0.7 },\n                color: { r: 40, g: 48, b: 32 }\n            },\n            {\n                id: 'energy_antimatter',\n                name: 'Antimatter',\n                description: 'Extremely dangerous but powerful energy source.',\n                category: ItemCategory.Energy,\n                rarity: ItemRarity.Epic,\n                stats: { mass: 0.01, volume: 1, maxStack: 10, radioactivity: 0.9, stability: 0.3 },\n                color: { r: 48, g: 24, b: 72 }\n            }\n        ];\n\n        resources.forEach(res => {\n            const item = this.createItem({\n                id: res.id,\n                name: res.name,\n                description: res.description,\n                type: ItemType.Resource,\n                category: res.category,\n                rarity: res.rarity,\n                stats: res.stats,\n                iconColor: res.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: false\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate ship components\n     */\n    private generateComponents(): void {\n        const components = [\n            {\n                id: 'comp_circuit',\n                name: 'Circuit Board',\n                description: 'Basic electronic component for ship systems.',\n                category: ItemCategory.Engine,\n                rarity: ItemRarity.Common,\n                stats: { mass: 0.2, volume: 1, maxStack: 100, durability: 0.9 },\n                color: { r: 24, g: 48, b: 24 }\n            },\n            {\n                id: 'comp_plasma_conduit',\n                name: 'Plasma Conduit',\n                description: 'Advanced conduit for energy distribution systems.',\n                category: ItemCategory.Reactor,\n                rarity: ItemRarity.Rare,\n                stats: { mass: 2, volume: 1, maxStack: 20, power: 150, efficiency: 0.85 },\n                color: { r: 64, g: 32, b: 16 }\n            },\n            {\n                id: 'comp_shield_emitter',\n                name: 'Shield Emitter',\n                description: 'Generates protective energy barriers around the ship.',\n                category: ItemCategory.Shield,\n                rarity: ItemRarity.Uncommon,\n                stats: { mass: 1.5, volume: 1, maxStack: 50, defense: 100, efficiency: 0.75 },\n                color: { r: 16, g: 32, b: 48 }\n            }\n        ];\n\n        components.forEach(comp => {\n            const item = this.createItem({\n                id: comp.id,\n                name: comp.name,\n                description: comp.description,\n                type: ItemType.Component,\n                category: comp.category,\n                rarity: comp.rarity,\n                stats: comp.stats,\n                iconColor: comp.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: false\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate equipment items\n     */\n    private generateEquipment(): void {\n        const equipment = [\n            {\n                id: 'eq_engine_basic',\n                name: 'Basic Thruster',\n                description: 'Standard propulsion system for small vessels.',\n                category: ItemCategory.Engine,\n                rarity: ItemRarity.Common,\n                stats: { mass: 10, volume: 4, maxStack: 1, power: 100, efficiency: 0.6 },\n                color: { r: 48, g: 48, b: 48 }\n            },\n            {\n                id: 'eq_shield_mk2',\n                name: 'Shield Generator Mk.II',\n                description: 'Improved shield generation system.',\n                category: ItemCategory.Shield,\n                rarity: ItemRarity.Uncommon,\n                stats: { mass: 8, volume: 3, maxStack: 1, defense: 200, efficiency: 0.8 },\n                color: { r: 16, g: 40, b: 32 }\n            },\n            {\n                id: 'eq_warp_core',\n                name: 'Warp Core',\n                description: 'Essential component for faster-than-light travel.',\n                category: ItemCategory.WarpCore,\n                rarity: ItemRarity.Epic,\n                stats: { mass: 20, volume: 8, maxStack: 1, power: 500, efficiency: 0.9 },\n                color: { r: 48, g: 24, b: 72 }\n            }\n        ];\n\n        equipment.forEach(eq => {\n            const item = this.createItem({\n                id: eq.id,\n                name: eq.name,\n                description: eq.description,\n                type: ItemType.Equipment,\n                category: eq.category,\n                rarity: eq.rarity,\n                stats: eq.stats,\n                iconColor: eq.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: false\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate weapons\n     */\n    private generateWeapons(): void {\n        const weapons = [\n            {\n                id: 'wp_laser_basic',\n                name: 'Basic Laser Cannon',\n                description: 'Standard energy weapon for ship defense.',\n                category: ItemCategory.Energy,\n                rarity: ItemRarity.Common,\n                stats: { mass: 5, volume: 2, maxStack: 1, damage: 50, range: 200 },\n                color: { r: 72, g: 24, b: 24 }\n            },\n            {\n                id: 'wp_railgun',\n                name: 'Magnetic Railgun',\n                description: 'High-velocity projectile weapon system.',\n                category: ItemCategory.Projectile,\n                rarity: ItemRarity.Rare,\n                stats: { mass: 12, volume: 4, maxStack: 1, damage: 150, range: 400 },\n                color: { r: 64, g: 64, b: 32 }\n            }\n        ];\n\n        weapons.forEach(wp => {\n            const item = this.createItem({\n                id: wp.id,\n                name: wp.name,\n                description: wp.description,\n                type: ItemType.Weapon,\n                category: wp.category,\n                rarity: wp.rarity,\n                stats: wp.stats,\n                iconColor: wp.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: false\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate tools\n     */\n    private generateTools(): void {\n        const tools = [\n            {\n                id: 'tool_mining_drill',\n                name: 'Mining Drill',\n                description: 'Automated mining equipment for resource extraction.',\n                category: ItemCategory.Mining,\n                rarity: ItemRarity.Uncommon,\n                stats: { mass: 3, volume: 2, maxStack: 1, efficiency: 0.8, durability: 0.9 },\n                color: { r: 96, g: 64, b: 16 }\n            },\n            {\n                id: 'tool_repair_kit',\n                name: 'Repair Kit',\n                description: 'Emergency repair tools and materials.',\n                category: ItemCategory.Repair,\n                rarity: ItemRarity.Common,\n                stats: { mass: 1, volume: 1, maxStack: 10, efficiency: 0.6 },\n                color: { r: 48, g: 48, b: 32 }\n            }\n        ];\n\n        tools.forEach(tool => {\n            const item = this.createItem({\n                id: tool.id,\n                name: tool.name,\n                description: tool.description,\n                type: ItemType.Tool,\n                category: tool.category,\n                rarity: tool.rarity,\n                stats: tool.stats,\n                iconColor: tool.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: false\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate consumables\n     */\n    private generateConsumables(): void {\n        const consumables = [\n            {\n                id: 'cons_energy_cell',\n                name: 'Energy Cell',\n                description: 'Portable power source for emergency systems.',\n                rarity: ItemRarity.Common,\n                stats: { mass: 0.5, volume: 1, maxStack: 50, power: 100 },\n                color: { r: 32, g: 80, b: 64 }\n            },\n            {\n                id: 'cons_nanobots',\n                name: 'Repair Nanobots',\n                description: 'Microscopic robots that repair ship damage.',\n                rarity: ItemRarity.Rare,\n                stats: { mass: 0.1, volume: 1, maxStack: 20, efficiency: 0.9 },\n                color: { r: 48, g: 24, b: 72 }\n            }\n        ];\n\n        consumables.forEach(cons => {\n            const item = this.createItem({\n                id: cons.id,\n                name: cons.name,\n                description: cons.description,\n                type: ItemType.Consumable,\n                category: ItemCategory.Energy,\n                rarity: cons.rarity,\n                stats: cons.stats,\n                iconColor: cons.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: true\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate blueprints\n     */\n    private generateBlueprints(): void {\n        const blueprints = [\n            {\n                id: 'bp_engine_advanced',\n                name: 'Advanced Engine Blueprint',\n                description: 'Schematic for constructing high-efficiency thrusters.',\n                rarity: ItemRarity.Rare,\n                color: { r: 32, g: 48, b: 32 }\n            },\n            {\n                id: 'bp_warp_upgrade',\n                name: 'Warp Core Upgrade Blueprint',\n                description: 'Plans for enhancing warp drive capabilities.',\n                rarity: ItemRarity.Epic,\n                color: { r: 48, g: 24, b: 72 }\n            }\n        ];\n\n        blueprints.forEach(bp => {\n            const item = this.createItem({\n                id: bp.id,\n                name: bp.name,\n                description: bp.description,\n                type: ItemType.Blueprint,\n                category: ItemCategory.Engine,\n                rarity: bp.rarity,\n                stats: { mass: 0.1, volume: 1, maxStack: 1 },\n                iconColor: bp.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: false\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate rare artifacts\n     */\n    private generateArtifacts(): void {\n        const artifacts = [\n            {\n                id: 'art_precursor_relic',\n                name: 'Precursor Data Core',\n                description: 'Ancient technology from a lost civilization.',\n                rarity: ItemRarity.Artifact,\n                stats: { mass: 1, volume: 1, maxStack: 1, radioactivity: 0.5 },\n                color: { r: 64, g: 32, b: 96 },\n                lore: 'This mysterious device contains fragments of knowledge from a species that vanished eons ago.'\n            }\n        ];\n\n        artifacts.forEach(art => {\n            const item = this.createItem({\n                id: art.id,\n                name: art.name,\n                description: art.description,\n                type: ItemType.Artifact,\n                category: ItemCategory.Exotic,\n                rarity: art.rarity,\n                stats: art.stats,\n                iconColor: art.color,\n                isUnique: true,\n                isTradeable: false,\n                isConsumable: false,\n                loreText: art.lore\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Create an item with generated sprite\n     */\n    private createItem(config: {\n        id: string;\n        name: string;\n        description: string;\n        type: ItemType;\n        category: ItemCategory;\n        rarity: ItemRarity;\n        stats: Partial<ItemStats>;\n        iconColor: Color;\n        isUnique: boolean;\n        isTradeable: boolean;\n        isConsumable: boolean;\n        loreText?: string;\n    }): GameItem {\n        const sprite = this.generateItemSprite(config.type, config.category, config.iconColor);\n        \n        return {\n            id: config.id,\n            name: config.name,\n            description: config.description,\n            type: config.type,\n            category: config.category,\n            rarity: config.rarity,\n            sprite,\n            iconColor: config.iconColor,\n            stats: {\n                mass: 1,\n                volume: 1,\n                maxStack: 1,\n                ...config.stats\n            },\n            isUnique: config.isUnique,\n            isTradeable: config.isTradeable,\n            isConsumable: config.isConsumable,\n            loreText: config.loreText\n        };\n    }\n\n    /**\n     * Generate 16-bit pixel art sprite for item\n     */\n    private generateItemSprite(type: ItemType, category: ItemCategory, baseColor: Color): ItemSprite {\n        const width = 16;\n        const height = 16;\n        const pixels: Color[][] = [];\n        \n        // Initialize empty sprite\n        for (let y = 0; y < height; y++) {\n            pixels[y] = [];\n            for (let x = 0; x < width; x++) {\n                pixels[y][x] = { r: 0, g: 0, b: 0 }; // Transparent\n            }\n        }\n        \n        // Generate sprite based on type and category\n        switch (type) {\n            case ItemType.Resource:\n                this.drawResourceSprite(pixels, category, baseColor);\n                break;\n            case ItemType.Component:\n                this.drawComponentSprite(pixels, category, baseColor);\n                break;\n            case ItemType.Equipment:\n                this.drawEquipmentSprite(pixels, category, baseColor);\n                break;\n            case ItemType.Weapon:\n                this.drawWeaponSprite(pixels, category, baseColor);\n                break;\n            case ItemType.Tool:\n                this.drawToolSprite(pixels, category, baseColor);\n                break;\n            case ItemType.Consumable:\n                this.drawConsumableSprite(pixels, baseColor);\n                break;\n            case ItemType.Blueprint:\n                this.drawBlueprintSprite(pixels, baseColor);\n                break;\n            case ItemType.Artifact:\n                this.drawArtifactSprite(pixels, baseColor);\n                break;\n        }\n        \n        return { width, height, pixels };\n    }\n\n    /**\n     * Draw resource sprite (crystal/ore shapes)\n     */\n    private drawResourceSprite(pixels: Color[][], category: ItemCategory, color: Color): void {\n        const darkColor = this.darkenColor(color, 0.7);\n        const lightColor = this.lightenColor(color, 1.3);\n        \n        if (category === ItemCategory.Crystal) {\n            // Crystal shape\n            this.setPixel(pixels, 8, 2, lightColor);\n            this.setPixel(pixels, 7, 3, color);\n            this.setPixel(pixels, 8, 3, lightColor);\n            this.setPixel(pixels, 9, 3, color);\n            this.setPixel(pixels, 6, 4, darkColor);\n            this.setPixel(pixels, 7, 4, color);\n            this.setPixel(pixels, 8, 4, lightColor);\n            this.setPixel(pixels, 9, 4, color);\n            this.setPixel(pixels, 10, 4, darkColor);\n            // Continue crystal pattern...\n            for (let y = 5; y < 13; y++) {\n                for (let x = 6; x <= 10; x++) {\n                    if (x === 6 || x === 10) this.setPixel(pixels, x, y, darkColor);\n                    else if (x === 8) this.setPixel(pixels, x, y, lightColor);\n                    else this.setPixel(pixels, x, y, color);\n                }\n            }\n            this.setPixel(pixels, 8, 13, darkColor);\n        } else {\n            // Ore/metal chunk shape\n            for (let y = 4; y < 12; y++) {\n                for (let x = 5; x < 11; x++) {\n                    if ((x + y) % 3 === 0) this.setPixel(pixels, x, y, lightColor);\n                    else if ((x + y) % 3 === 1) this.setPixel(pixels, x, y, color);\n                    else this.setPixel(pixels, x, y, darkColor);\n                }\n            }\n        }\n    }\n\n    /**\n     * Draw component sprite (circuit patterns)\n     */\n    private drawComponentSprite(pixels: Color[][], category: ItemCategory, color: Color): void {\n        const darkColor = this.darkenColor(color, 0.6);\n        const lightColor = this.lightenColor(color, 1.4);\n        \n        // Circuit board base\n        for (let y = 3; y < 13; y++) {\n            for (let x = 3; x < 13; x++) {\n                this.setPixel(pixels, x, y, darkColor);\n            }\n        }\n        \n        // Circuit traces\n        for (let x = 4; x < 12; x++) {\n            this.setPixel(pixels, x, 6, color);\n            this.setPixel(pixels, x, 9, color);\n        }\n        for (let y = 4; y < 12; y++) {\n            this.setPixel(pixels, 6, y, color);\n            this.setPixel(pixels, 9, y, color);\n        }\n        \n        // Components\n        this.setPixel(pixels, 5, 5, lightColor);\n        this.setPixel(pixels, 10, 5, lightColor);\n        this.setPixel(pixels, 5, 10, lightColor);\n        this.setPixel(pixels, 10, 10, lightColor);\n    }\n\n    /**\n     * Draw equipment sprite (mechanical shapes)\n     */\n    private drawEquipmentSprite(pixels: Color[][], category: ItemCategory, color: Color): void {\n        const darkColor = this.darkenColor(color, 0.7);\n        const lightColor = this.lightenColor(color, 1.2);\n        \n        // Base equipment shape\n        for (let y = 2; y < 14; y++) {\n            for (let x = 4; x < 12; x++) {\n                if (y === 2 || y === 13 || x === 4 || x === 11) {\n                    this.setPixel(pixels, x, y, darkColor);\n                } else {\n                    this.setPixel(pixels, x, y, color);\n                }\n            }\n        }\n        \n        // Equipment details based on category\n        if (category === ItemCategory.Engine) {\n            // Engine nozzle\n            for (let y = 6; y < 10; y++) {\n                this.setPixel(pixels, 8, y, lightColor);\n            }\n        } else if (category === ItemCategory.Shield) {\n            // Shield emitter pattern\n            this.setPixel(pixels, 8, 5, lightColor);\n            this.setPixel(pixels, 7, 6, lightColor);\n            this.setPixel(pixels, 9, 6, lightColor);\n            this.setPixel(pixels, 8, 7, lightColor);\n        }\n    }\n\n    /**\n     * Draw weapon sprite\n     */\n    private drawWeaponSprite(pixels: Color[][], category: ItemCategory, color: Color): void {\n        const darkColor = this.darkenColor(color, 0.6);\n        const lightColor = this.lightenColor(color, 1.3);\n        \n        // Weapon barrel\n        for (let y = 6; y < 10; y++) {\n            for (let x = 2; x < 14; x++) {\n                if (y === 6 || y === 9) this.setPixel(pixels, x, y, darkColor);\n                else this.setPixel(pixels, x, y, color);\n            }\n        }\n        \n        // Weapon tip\n        this.setPixel(pixels, 14, 7, lightColor);\n        this.setPixel(pixels, 14, 8, lightColor);\n        \n        // Handle/mount\n        for (let y = 8; y < 12; y++) {\n            for (let x = 4; x < 8; x++) {\n                this.setPixel(pixels, x, y, darkColor);\n            }\n        }\n    }\n\n    /**\n     * Draw tool sprite\n     */\n    private drawToolSprite(pixels: Color[][], category: ItemCategory, color: Color): void {\n        const darkColor = this.darkenColor(color, 0.7);\n        const lightColor = this.lightenColor(color, 1.2);\n        \n        // Tool handle\n        for (let y = 8; y < 14; y++) {\n            for (let x = 6; x < 10; x++) {\n                this.setPixel(pixels, x, y, darkColor);\n            }\n        }\n        \n        // Tool head based on category\n        if (category === ItemCategory.Mining) {\n            // Drill bit\n            for (let y = 2; y < 8; y++) {\n                this.setPixel(pixels, 8, y, color);\n                if (y > 3) {\n                    this.setPixel(pixels, 7, y, lightColor);\n                    this.setPixel(pixels, 9, y, lightColor);\n                }\n            }\n        } else {\n            // Generic tool head\n            for (let y = 4; y < 8; y++) {\n                for (let x = 5; x < 11; x++) {\n                    this.setPixel(pixels, x, y, color);\n                }\n            }\n        }\n    }\n\n    /**\n     * Draw consumable sprite (container shapes)\n     */\n    private drawConsumableSprite(pixels: Color[][], color: Color): void {\n        const darkColor = this.darkenColor(color, 0.6);\n        const lightColor = this.lightenColor(color, 1.4);\n        \n        // Container outline\n        for (let y = 3; y < 13; y++) {\n            for (let x = 5; x < 11; x++) {\n                if (y === 3 || y === 12 || x === 5 || x === 10) {\n                    this.setPixel(pixels, x, y, darkColor);\n                } else {\n                    this.setPixel(pixels, x, y, color);\n                }\n            }\n        }\n        \n        // Label/indicator\n        this.setPixel(pixels, 8, 6, lightColor);\n        this.setPixel(pixels, 7, 7, lightColor);\n        this.setPixel(pixels, 9, 7, lightColor);\n        this.setPixel(pixels, 8, 8, lightColor);\n    }\n\n    /**\n     * Draw blueprint sprite (schematic pattern)\n     */\n    private drawBlueprintSprite(pixels: Color[][], color: Color): void {\n        const darkColor = this.darkenColor(color, 0.8);\n        const lightColor = this.lightenColor(color, 1.1);\n        \n        // Blueprint base\n        for (let y = 2; y < 14; y++) {\n            for (let x = 3; x < 13; x++) {\n                this.setPixel(pixels, x, y, darkColor);\n            }\n        }\n        \n        // Schematic lines\n        for (let x = 5; x < 11; x++) {\n            this.setPixel(pixels, x, 5, color);\n            this.setPixel(pixels, x, 8, color);\n            this.setPixel(pixels, x, 11, color);\n        }\n        \n        // Blueprint markers\n        this.setPixel(pixels, 5, 6, lightColor);\n        this.setPixel(pixels, 8, 6, lightColor);\n        this.setPixel(pixels, 11, 6, lightColor);\n    }\n\n    /**\n     * Draw artifact sprite (mystical patterns)\n     */\n    private drawArtifactSprite(pixels: Color[][], color: Color): void {\n        const darkColor = this.darkenColor(color, 0.5);\n        const lightColor = this.lightenColor(color, 1.5);\n        \n        // Artifact base\n        for (let y = 4; y < 12; y++) {\n            for (let x = 4; x < 12; x++) {\n                if ((x + y) % 2 === 0) this.setPixel(pixels, x, y, color);\n                else this.setPixel(pixels, x, y, darkColor);\n            }\n        }\n        \n        // Mystical pattern\n        this.setPixel(pixels, 8, 2, lightColor);\n        this.setPixel(pixels, 6, 6, lightColor);\n        this.setPixel(pixels, 10, 6, lightColor);\n        this.setPixel(pixels, 8, 10, lightColor);\n        this.setPixel(pixels, 8, 14, lightColor);\n    }\n\n    /**\n     * Helper methods for sprite generation\n     */\n    private setPixel(pixels: Color[][], x: number, y: number, color: Color): void {\n        if (x >= 0 && x < 16 && y >= 0 && y < 16) {\n            pixels[y][x] = { ...color };\n        }\n    }\n\n    private darkenColor(color: Color, factor: number): Color {\n        return {\n            r: Math.floor(color.r * factor),\n            g: Math.floor(color.g * factor),\n            b: Math.floor(color.b * factor)\n        };\n    }\n\n    private lightenColor(color: Color, factor: number): Color {\n        return {\n            r: Math.min(255, Math.floor(color.r * factor)),\n            g: Math.min(255, Math.floor(color.g * factor)),\n            b: Math.min(255, Math.floor(color.b * factor))\n        };\n    }\n\n    /**\n     * Public interface methods\n     */\n    \n    /**\n     * Add item to database\n     */\n    addItem(item: GameItem): void {\n        this.items.set(item.id, item);\n        \n        if (!this.categories.has(item.category)) {\n            this.categories.set(item.category, []);\n        }\n        this.categories.get(item.category)!.push(item);\n        \n        if (item.recipe) {\n            this.recipes.set(item.id, item.recipe);\n        }\n    }\n\n    /**\n     * Get item by ID\n     */\n    getItem(id: string): GameItem | undefined {\n        return this.items.get(id);\n    }\n\n    /**\n     * Get items by category\n     */\n    getItemsByCategory(category: ItemCategory): GameItem[] {\n        return this.categories.get(category) || [];\n    }\n\n    /**\n     * Get items by type\n     */\n    getItemsByType(type: ItemType): GameItem[] {\n        return Array.from(this.items.values()).filter(item => item.type === type);\n    }\n\n    /**\n     * Get items by rarity\n     */\n    getItemsByRarity(rarity: ItemRarity): GameItem[] {\n        return Array.from(this.items.values()).filter(item => item.rarity === rarity);\n    }\n\n    /**\n     * Get all items\n     */\n    getAllItems(): GameItem[] {\n        return Array.from(this.items.values());\n    }\n\n    /**\n     * Get recipe for item\n     */\n    getRecipe(itemId: string): ItemRecipe | undefined {\n        return this.recipes.get(itemId);\n    }\n\n    /**\n     * Search items by name\n     */\n    searchItems(query: string): GameItem[] {\n        const lowerQuery = query.toLowerCase();\n        return Array.from(this.items.values()).filter(item => \n            item.name.toLowerCase().includes(lowerQuery) ||\n            item.description.toLowerCase().includes(lowerQuery)\n        );\n    }\n\n    /**\n     * Generate random item by rarity\n     */\n    generateRandomItem(rarity?: ItemRarity): GameItem | null {\n        let candidateItems: GameItem[];\n        \n        if (rarity) {\n            candidateItems = this.getItemsByRarity(rarity);\n        } else {\n            // Weighted random by rarity\n            const rarityWeights = {\n                [ItemRarity.Common]: 50,\n                [ItemRarity.Uncommon]: 25,\n                [ItemRarity.Rare]: 15,\n                [ItemRarity.Epic]: 8,\n                [ItemRarity.Legendary]: 1.5,\n                [ItemRarity.Artifact]: 0.5\n            };\n            \n            const totalWeight = Object.values(rarityWeights).reduce((sum, weight) => sum + weight, 0);\n            const random = Math.random() * totalWeight;\n            \n            let currentWeight = 0;\n            let selectedRarity: ItemRarity = ItemRarity.Common;\n            \n            for (const [rarity, weight] of Object.entries(rarityWeights)) {\n                currentWeight += weight;\n                if (random <= currentWeight) {\n                    selectedRarity = rarity as ItemRarity;\n                    break;\n                }\n            }\n            \n            candidateItems = this.getItemsByRarity(selectedRarity);\n        }\n        \n        if (candidateItems.length === 0) return null;\n        \n        const randomIndex = Math.floor(Math.random() * candidateItems.length);\n        return candidateItems[randomIndex];\n    }\n\n    /**\n     * Render item sprite\n     */\n    renderItemSprite(renderer: Renderer, item: GameItem, x: number, y: number, scale: number = 1): void {\n        const sprite = item.sprite;\n        \n        for (let sy = 0; sy < sprite.height; sy++) {\n            for (let sx = 0; sx < sprite.width; sx++) {\n                const pixel = sprite.pixels[sy][sx];\n                if (pixel.r > 0 || pixel.g > 0 || pixel.b > 0) { // Skip transparent pixels\n                    if (scale === 1) {\n                        renderer.setPixel(x + sx, y + sy, pixel);\n                    } else {\n                        // Scale up the pixel\n                        for (let dy = 0; dy < scale; dy++) {\n                            for (let dx = 0; dx < scale; dx++) {\n                                renderer.setPixel(x + sx * scale + dx, y + sy * scale + dy, pixel);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Get database statistics\n     */\n    getStats(): {\n        totalItems: number;\n        itemsByType: { [type: string]: number };\n        itemsByRarity: { [rarity: string]: number };\n        categories: number;\n    } {\n        const itemsByType: { [type: string]: number } = {};\n        const itemsByRarity: { [rarity: string]: number } = {};\n        \n        this.items.forEach(item => {\n            itemsByType[item.type] = (itemsByType[item.type] || 0) + 1;\n            itemsByRarity[item.rarity] = (itemsByRarity[item.rarity] || 0) + 1;\n        });\n        \n        return {\n            totalItems: this.items.size,\n            itemsByType,\n            itemsByRarity,\n            categories: this.categories.size\n        };\n    }\n}","/**\n * Inventory Management System\n * Grid-based inventory with advanced management features and retro UI\n */\n\nimport { Logger } from '@utils/Logger';\nimport { GameItem, ItemStack, ItemType, ItemRarity, ItemDatabase } from '@items/ItemSystem';\nimport { Renderer, Color, Vector2 } from '@core/Renderer';\n\nexport interface InventoryConfig {\n    maxSlots: number;\n    gridWidth: number;\n    gridHeight: number;\n    maxWeight: number;\n    maxVolume: number;\n    allowStacking: boolean;\n}\n\nexport interface InventorySlot {\n    index: number;\n    item: ItemStack | null;\n    x: number; // Grid position\n    y: number;\n    locked: boolean; // Locked slots can't be used\n    reserved: boolean; // Reserved for specific item types\n}\n\nexport interface InventoryFilter {\n    type?: ItemType;\n    rarity?: ItemRarity;\n    searchText?: string;\n    showOnlyUsable?: boolean;\n}\n\nexport interface InventorySortOptions {\n    by: 'name' | 'type' | 'rarity' | 'quantity' | 'value';\n    descending: boolean;\n    groupByType: boolean;\n}\n\nexport interface InventoryEvents {\n    onItemAdded?: (item: GameItem, quantity: number) => void;\n    onItemRemoved?: (item: GameItem, quantity: number) => void;\n    onInventoryFull?: () => void;\n    onWeightExceeded?: () => void;\n    onVolumeExceeded?: () => void;\n    onSlotSelected?: (slot: InventorySlot) => void;\n}\n\nexport class InventoryManager {\n    private config: InventoryConfig;\n    private events: InventoryEvents;\n    private itemDatabase: ItemDatabase;\n    \n    // Storage\n    private slots: InventorySlot[] = [];\n    private totalWeight: number = 0;\n    private totalVolume: number = 0;\n    \n    // UI State\n    private selectedSlot: number = -1;\n    private draggedItem: ItemStack | null = null;\n    private filter: InventoryFilter = {};\n    private sortOptions: InventorySortOptions = { by: 'name', descending: false, groupByType: false };\n    private isVisible: boolean = false;\n    \n    // Visual properties\n    private slotSize: number = 32;\n    private slotSpacing: number = 2;\n    private panelX: number = 50;\n    private panelY: number = 50;\n    \n    private logger: Logger;\n\n    constructor(\n        config: Partial<InventoryConfig> = {},\n        events: InventoryEvents = {},\n        itemDatabase: ItemDatabase\n    ) {\n        this.logger = new Logger('InventoryManager');\n        this.itemDatabase = itemDatabase;\n        this.events = events;\n        \n        this.config = {\n            maxSlots: 50,\n            gridWidth: 10,\n            gridHeight: 5,\n            maxWeight: 1000,\n            maxVolume: 500,\n            allowStacking: true,\n            ...config\n        };\n        \n        this.initializeSlots();\n        \n        this.logger.info('📦 Inventory manager initialized', {\n            slots: this.config.maxSlots,\n            maxWeight: this.config.maxWeight,\n            maxVolume: this.config.maxVolume\n        });\n    }\n\n    /**\n     * Initialize inventory slots\n     */\n    private initializeSlots(): void {\n        this.slots = [];\n        \n        for (let i = 0; i < this.config.maxSlots; i++) {\n            const x = i % this.config.gridWidth;\n            const y = Math.floor(i / this.config.gridWidth);\n            \n            this.slots.push({\n                index: i,\n                item: null,\n                x,\n                y,\n                locked: false,\n                reserved: false\n            });\n        }\n    }\n\n    /**\n     * Add item to inventory\n     */\n    addItem(item: GameItem, quantity: number = 1): boolean {\n        if (quantity <= 0) return false;\n        \n        let remainingQuantity = quantity;\n        \n        // Try to stack with existing items first\n        if (this.config.allowStacking && item.stats.maxStack > 1) {\n            for (const slot of this.slots) {\n                if (slot.item && slot.item.item.id === item.id) {\n                    const canAdd = Math.min(remainingQuantity, item.stats.maxStack - slot.item.quantity);\n                    if (canAdd > 0) {\n                        slot.item.quantity += canAdd;\n                        remainingQuantity -= canAdd;\n                        \n                        if (remainingQuantity === 0) break;\n                    }\n                }\n            }\n        }\n        \n        // Add to empty slots\n        while (remainingQuantity > 0) {\n            const emptySlot = this.findEmptySlot();\n            if (!emptySlot) {\n                this.events.onInventoryFull?.();\n                return false;\n            }\n            \n            const stackSize = Math.min(remainingQuantity, item.stats.maxStack);\n            \n            // Check weight and volume constraints\n            const addedWeight = item.stats.mass * stackSize;\n            const addedVolume = item.stats.volume * stackSize;\n            \n            if (this.totalWeight + addedWeight > this.config.maxWeight) {\n                this.events.onWeightExceeded?.();\n                return false;\n            }\n            \n            if (this.totalVolume + addedVolume > this.config.maxVolume) {\n                this.events.onVolumeExceeded?.();\n                return false;\n            }\n            \n            // Add to slot\n            emptySlot.item = {\n                item: item,\n                quantity: stackSize,\n                condition: item.type === ItemType.Equipment ? 1.0 : undefined\n            };\n            \n            this.totalWeight += addedWeight;\n            this.totalVolume += addedVolume;\n            remainingQuantity -= stackSize;\n        }\n        \n        this.events.onItemAdded?.(item, quantity);\n        this.logger.debug(`Added ${quantity}x ${item.name} to inventory`);\n        \n        return true;\n    }\n\n    /**\n     * Remove item from inventory\n     */\n    removeItem(itemId: string, quantity: number = 1): boolean {\n        if (quantity <= 0) return false;\n        \n        let remainingQuantity = quantity;\n        \n        for (const slot of this.slots) {\n            if (slot.item && slot.item.item.id === itemId && remainingQuantity > 0) {\n                const canRemove = Math.min(remainingQuantity, slot.item.quantity);\n                \n                // Update weight and volume\n                const removedWeight = slot.item.item.stats.mass * canRemove;\n                const removedVolume = slot.item.item.stats.volume * canRemove;\n                this.totalWeight -= removedWeight;\n                this.totalVolume -= removedVolume;\n                \n                slot.item.quantity -= canRemove;\n                remainingQuantity -= canRemove;\n                \n                if (slot.item.quantity === 0) {\n                    const removedItem = slot.item.item;\n                    slot.item = null;\n                    this.events.onItemRemoved?.(removedItem, canRemove);\n                }\n            }\n        }\n        \n        return remainingQuantity === 0;\n    }\n\n    /**\n     * Move item between slots\n     */\n    moveItem(fromSlot: number, toSlot: number): boolean {\n        if (fromSlot < 0 || fromSlot >= this.slots.length || \n            toSlot < 0 || toSlot >= this.slots.length) {\n            return false;\n        }\n        \n        const from = this.slots[fromSlot];\n        const to = this.slots[toSlot];\n        \n        if (!from.item || to.locked) return false;\n        \n        // If target slot is empty, move the item\n        if (!to.item) {\n            to.item = from.item;\n            from.item = null;\n            return true;\n        }\n        \n        // If both slots have the same item and stacking is allowed\n        if (this.config.allowStacking && \n            from.item.item.id === to.item.item.id &&\n            from.item.item.stats.maxStack > 1) {\n            \n            const canStack = Math.min(\n                from.item.quantity, \n                from.item.item.stats.maxStack - to.item.quantity\n            );\n            \n            if (canStack > 0) {\n                to.item.quantity += canStack;\n                from.item.quantity -= canStack;\n                \n                if (from.item.quantity === 0) {\n                    from.item = null;\n                }\n                return true;\n            }\n        }\n        \n        // Swap items\n        const temp = from.item;\n        from.item = to.item;\n        to.item = temp;\n        \n        return true;\n    }\n\n    /**\n     * Find first empty slot\n     */\n    private findEmptySlot(): InventorySlot | null {\n        return this.slots.find(slot => !slot.item && !slot.locked) || null;\n    }\n\n    /**\n     * Get item count\n     */\n    getItemCount(itemId: string): number {\n        return this.slots\n            .filter(slot => slot.item && slot.item.item.id === itemId)\n            .reduce((total, slot) => total + slot.item!.quantity, 0);\n    }\n\n    /**\n     * Has item\n     */\n    hasItem(itemId: string, quantity: number = 1): boolean {\n        return this.getItemCount(itemId) >= quantity;\n    }\n\n    /**\n     * Get all items\n     */\n    getAllItems(): ItemStack[] {\n        return this.slots\n            .filter(slot => slot.item !== null)\n            .map(slot => slot.item!);\n    }\n\n    /**\n     * Get filtered and sorted items\n     */\n    getFilteredItems(): ItemStack[] {\n        let items = this.getAllItems();\n        \n        // Apply filters\n        if (this.filter.type) {\n            items = items.filter(stack => stack.item.type === this.filter.type);\n        }\n        \n        if (this.filter.rarity) {\n            items = items.filter(stack => stack.item.rarity === this.filter.rarity);\n        }\n        \n        if (this.filter.searchText) {\n            const search = this.filter.searchText.toLowerCase();\n            items = items.filter(stack => \n                stack.item.name.toLowerCase().includes(search) ||\n                stack.item.description.toLowerCase().includes(search)\n            );\n        }\n        \n        // Apply sorting\n        items.sort((a, b) => {\n            let comparison = 0;\n            \n            switch (this.sortOptions.by) {\n                case 'name':\n                    comparison = a.item.name.localeCompare(b.item.name);\n                    break;\n                case 'type':\n                    comparison = a.item.type.localeCompare(b.item.type);\n                    break;\n                case 'rarity':\n                    const rarityOrder = ['common', 'uncommon', 'rare', 'epic', 'legendary', 'artifact'];\n                    comparison = rarityOrder.indexOf(a.item.rarity) - rarityOrder.indexOf(b.item.rarity);\n                    break;\n                case 'quantity':\n                    comparison = a.quantity - b.quantity;\n                    break;\n            }\n            \n            return this.sortOptions.descending ? -comparison : comparison;\n        });\n        \n        return items;\n    }\n\n    /**\n     * Compact inventory (remove gaps)\n     */\n    compactInventory(): void {\n        const items: ItemStack[] = [];\n        \n        // Collect all items\n        this.slots.forEach(slot => {\n            if (slot.item) {\n                items.push(slot.item);\n                slot.item = null;\n            }\n        });\n        \n        // Clear weight/volume\n        this.totalWeight = 0;\n        this.totalVolume = 0;\n        \n        // Re-add items compactly\n        items.forEach(stack => {\n            this.addItem(stack.item, stack.quantity);\n        });\n        \n        this.logger.info('📦 Inventory compacted');\n    }\n\n    /**\n     * Auto-sort inventory\n     */\n    autoSort(): void {\n        const items = this.getAllItems();\n        \n        // Clear inventory\n        this.slots.forEach(slot => slot.item = null);\n        this.totalWeight = 0;\n        this.totalVolume = 0;\n        \n        // Sort items\n        items.sort((a, b) => {\n            // First by type\n            if (a.item.type !== b.item.type) {\n                return a.item.type.localeCompare(b.item.type);\n            }\n            \n            // Then by rarity\n            const rarityOrder = ['artifact', 'legendary', 'epic', 'rare', 'uncommon', 'common'];\n            const aRarity = rarityOrder.indexOf(a.item.rarity);\n            const bRarity = rarityOrder.indexOf(b.item.rarity);\n            \n            if (aRarity !== bRarity) {\n                return aRarity - bRarity;\n            }\n            \n            // Finally by name\n            return a.item.name.localeCompare(b.item.name);\n        });\n        \n        // Re-add sorted items\n        items.forEach(stack => {\n            this.addItem(stack.item, stack.quantity);\n        });\n        \n        this.logger.info('📦 Inventory auto-sorted');\n    }\n\n    /**\n     * Get inventory statistics\n     */\n    getStats(): {\n        usedSlots: number;\n        totalSlots: number;\n        totalWeight: number;\n        maxWeight: number;\n        totalVolume: number;\n        maxVolume: number;\n        itemCount: number;\n        uniqueItems: number;\n        fillPercentage: number;\n        weightPercentage: number;\n        volumePercentage: number;\n    } {\n        const usedSlots = this.slots.filter(slot => slot.item !== null).length;\n        const uniqueItems = new Set(this.slots\n            .filter(slot => slot.item)\n            .map(slot => slot.item!.item.id)\n        ).size;\n        \n        const totalItems = this.slots\n            .filter(slot => slot.item)\n            .reduce((total, slot) => total + slot.item!.quantity, 0);\n        \n        return {\n            usedSlots,\n            totalSlots: this.config.maxSlots,\n            totalWeight: this.totalWeight,\n            maxWeight: this.config.maxWeight,\n            totalVolume: this.totalVolume,\n            maxVolume: this.config.maxVolume,\n            itemCount: totalItems,\n            uniqueItems,\n            fillPercentage: (usedSlots / this.config.maxSlots) * 100,\n            weightPercentage: (this.totalWeight / this.config.maxWeight) * 100,\n            volumePercentage: (this.totalVolume / this.config.maxVolume) * 100\n        };\n    }\n\n    /**\n     * Render inventory UI\n     */\n    render(renderer: Renderer): void {\n        if (!this.isVisible) return;\n        \n        // Render background panel\n        this.renderBackground(renderer);\n        \n        // Render header\n        this.renderHeader(renderer);\n        \n        // Render grid\n        this.renderGrid(renderer);\n        \n        // Render items\n        this.renderItems(renderer);\n        \n        // Render selection\n        if (this.selectedSlot >= 0) {\n            this.renderSelection(renderer);\n        }\n        \n        // Render dragged item\n        if (this.draggedItem) {\n            this.renderDraggedItem(renderer);\n        }\n        \n        // Render statistics\n        this.renderStats(renderer);\n    }\n\n    /**\n     * Render background panel\n     */\n    private renderBackground(renderer: Renderer): void {\n        const panelWidth = this.config.gridWidth * (this.slotSize + this.slotSpacing) + 40;\n        const panelHeight = this.config.gridHeight * (this.slotSize + this.slotSpacing) + 150;\n        \n        // Dark panel background\n        renderer.fillRect(this.panelX, this.panelY, panelWidth, panelHeight, { r: 8, g: 12, b: 8 });\n        \n        // Panel border\n        renderer.drawLine(this.panelX, this.panelY, this.panelX + panelWidth, this.panelY, { r: 16, g: 48, b: 16 });\n        renderer.drawLine(this.panelX, this.panelY, this.panelX, this.panelY + panelHeight, { r: 16, g: 48, b: 16 });\n        renderer.drawLine(this.panelX + panelWidth, this.panelY, this.panelX + panelWidth, this.panelY + panelHeight, { r: 16, g: 48, b: 16 });\n        renderer.drawLine(this.panelX, this.panelY + panelHeight, this.panelX + panelWidth, this.panelY + panelHeight, { r: 16, g: 48, b: 16 });\n    }\n\n    /**\n     * Render header\n     */\n    private renderHeader(renderer: Renderer): void {\n        renderer.renderText('INVENTORY', this.panelX + 10, this.panelY + 10, { r: 12, g: 36, b: 12 }, 12);\n        \n        // Quick action buttons\n        const buttonY = this.panelY + 25;\n        renderer.renderText('[S]ORT', this.panelX + 10, buttonY, { r: 32, g: 32, b: 32 }, 8);\n        renderer.renderText('[C]OMPACT', this.panelX + 80, buttonY, { r: 32, g: 32, b: 32 }, 8);\n        renderer.renderText('[F]ILTER', this.panelX + 160, buttonY, { r: 32, g: 32, b: 32 }, 8);\n    }\n\n    /**\n     * Render inventory grid\n     */\n    private renderGrid(renderer: Renderer): void {\n        const gridStartX = this.panelX + 20;\n        const gridStartY = this.panelY + 50;\n        \n        for (let y = 0; y < this.config.gridHeight; y++) {\n            for (let x = 0; x < this.config.gridWidth; x++) {\n                const slotX = gridStartX + x * (this.slotSize + this.slotSpacing);\n                const slotY = gridStartY + y * (this.slotSize + this.slotSpacing);\n                \n                const slotIndex = y * this.config.gridWidth + x;\n                const slot = this.slots[slotIndex];\n                \n                // Slot background\n                let bgColor = { r: 16, g: 16, b: 16 };\n                if (slot.locked) {\n                    bgColor = { r: 24, g: 8, b: 8 }; // Red tint for locked\n                } else if (slot.reserved) {\n                    bgColor = { r: 8, g: 24, b: 8 }; // Green tint for reserved\n                }\n                \n                renderer.fillRect(slotX, slotY, this.slotSize, this.slotSize, bgColor);\n                \n                // Slot border\n                const borderColor = { r: 32, g: 32, b: 32 };\n                renderer.drawLine(slotX, slotY, slotX + this.slotSize, slotY, borderColor);\n                renderer.drawLine(slotX, slotY, slotX, slotY + this.slotSize, borderColor);\n                renderer.drawLine(slotX + this.slotSize, slotY, slotX + this.slotSize, slotY + this.slotSize, borderColor);\n                renderer.drawLine(slotX, slotY + this.slotSize, slotX + this.slotSize, slotY + this.slotSize, borderColor);\n            }\n        }\n    }\n\n    /**\n     * Render items in slots\n     */\n    private renderItems(renderer: Renderer): void {\n        const gridStartX = this.panelX + 20;\n        const gridStartY = this.panelY + 50;\n        \n        this.slots.forEach((slot, index) => {\n            if (!slot.item) return;\n            \n            const slotX = gridStartX + slot.x * (this.slotSize + this.slotSpacing);\n            const slotY = gridStartY + slot.y * (this.slotSize + this.slotSpacing);\n            \n            // Render item sprite\n            const spriteX = slotX + (this.slotSize - 16) / 2;\n            const spriteY = slotY + (this.slotSize - 16) / 2;\n            this.itemDatabase.renderItemSprite(renderer, slot.item.item, spriteX, spriteY, 1);\n            \n            // Render quantity if > 1\n            if (slot.item.quantity > 1) {\n                const quantityText = slot.item.quantity.toString();\n                renderer.renderText(quantityText, slotX + this.slotSize - 15, slotY + this.slotSize - 10, \n                    { r: 48, g: 48, b: 48 }, 8);\n            }\n            \n            // Render rarity indicator\n            const rarityColor = this.getRarityColor(slot.item.item.rarity);\n            renderer.fillRect(slotX + 2, slotY + 2, 4, 4, rarityColor);\n            \n            // Render condition bar for equipment\n            if (slot.item.condition !== undefined) {\n                const conditionWidth = Math.floor((this.slotSize - 4) * slot.item.condition);\n                const conditionColor = slot.item.condition > 0.7 ? \n                    { r: 12, g: 36, b: 12 } : \n                    slot.item.condition > 0.3 ? \n                        { r: 72, g: 48, b: 12 } : \n                        { r: 72, g: 24, b: 24 };\n                \n                renderer.fillRect(slotX + 2, slotY + this.slotSize - 4, conditionWidth, 2, conditionColor);\n            }\n        });\n    }\n\n    /**\n     * Get rarity color\n     */\n    private getRarityColor(rarity: ItemRarity): Color {\n        switch (rarity) {\n            case ItemRarity.Common: return { r: 48, g: 48, b: 48 };\n            case ItemRarity.Uncommon: return { r: 32, g: 48, b: 32 };\n            case ItemRarity.Rare: return { r: 32, g: 40, b: 48 };\n            case ItemRarity.Epic: return { r: 48, g: 32, b: 72 };\n            case ItemRarity.Legendary: return { r: 96, g: 64, b: 16 };\n            case ItemRarity.Artifact: return { r: 64, g: 32, b: 96 };\n            default: return { r: 32, g: 32, b: 32 };\n        }\n    }\n\n    /**\n     * Render selection highlight\n     */\n    private renderSelection(renderer: Renderer): void {\n        const slot = this.slots[this.selectedSlot];\n        if (!slot) return;\n        \n        const gridStartX = this.panelX + 20;\n        const gridStartY = this.panelY + 50;\n        const slotX = gridStartX + slot.x * (this.slotSize + this.slotSpacing);\n        const slotY = gridStartY + slot.y * (this.slotSize + this.slotSpacing);\n        \n        // Selection highlight\n        const highlightColor = { r: 16, g: 48, b: 16 };\n        renderer.drawLine(slotX - 1, slotY - 1, slotX + this.slotSize + 1, slotY - 1, highlightColor);\n        renderer.drawLine(slotX - 1, slotY - 1, slotX - 1, slotY + this.slotSize + 1, highlightColor);\n        renderer.drawLine(slotX + this.slotSize + 1, slotY - 1, slotX + this.slotSize + 1, slotY + this.slotSize + 1, highlightColor);\n        renderer.drawLine(slotX - 1, slotY + this.slotSize + 1, slotX + this.slotSize + 1, slotY + this.slotSize + 1, highlightColor);\n    }\n\n    /**\n     * Render dragged item\n     */\n    private renderDraggedItem(renderer: Renderer): void {\n        // TODO: Implement drag rendering when mouse system is available\n    }\n\n    /**\n     * Render statistics\n     */\n    private renderStats(renderer: Renderer): void {\n        const stats = this.getStats();\n        const statsY = this.panelY + this.config.gridHeight * (this.slotSize + this.slotSpacing) + 70;\n        \n        const textColor = { r: 48, g: 48, b: 48 };\n        \n        renderer.renderText(`SLOTS: ${stats.usedSlots}/${stats.totalSlots}`, \n            this.panelX + 10, statsY, textColor, 8);\n        \n        renderer.renderText(`WEIGHT: ${stats.totalWeight.toFixed(1)}/${stats.maxWeight}`, \n            this.panelX + 10, statsY + 12, textColor, 8);\n        \n        renderer.renderText(`VOLUME: ${stats.totalVolume.toFixed(1)}/${stats.maxVolume}`, \n            this.panelX + 10, statsY + 24, textColor, 8);\n        \n        renderer.renderText(`ITEMS: ${stats.itemCount} (${stats.uniqueItems} types)`, \n            this.panelX + 10, statsY + 36, textColor, 8);\n    }\n\n    /**\n     * Show/hide inventory\n     */\n    setVisible(visible: boolean): void {\n        this.isVisible = visible;\n    }\n\n    /**\n     * Check if inventory is visible\n     */\n    isInventoryVisible(): boolean {\n        return this.isVisible;\n    }\n\n    /**\n     * Select slot\n     */\n    selectSlot(slotIndex: number): void {\n        if (slotIndex >= 0 && slotIndex < this.slots.length) {\n            this.selectedSlot = slotIndex;\n            this.events.onSlotSelected?.(this.slots[slotIndex]);\n        }\n    }\n\n    /**\n     * Get selected slot\n     */\n    getSelectedSlot(): InventorySlot | null {\n        return this.selectedSlot >= 0 ? this.slots[this.selectedSlot] : null;\n    }\n\n    /**\n     * Use item in selected slot\n     */\n    useSelectedItem(): boolean {\n        const slot = this.getSelectedSlot();\n        if (!slot || !slot.item) return false;\n        \n        const item = slot.item.item;\n        \n        if (item.isConsumable) {\n            // Use consumable item\n            this.removeItem(item.id, 1);\n            this.logger.info(`Used ${item.name}`);\n            return true;\n        }\n        \n        return false;\n    }\n\n    /**\n     * Set filter\n     */\n    setFilter(filter: Partial<InventoryFilter>): void {\n        this.filter = { ...this.filter, ...filter };\n    }\n\n    /**\n     * Clear filter\n     */\n    clearFilter(): void {\n        this.filter = {};\n    }\n\n    /**\n     * Set sort options\n     */\n    setSortOptions(options: Partial<InventorySortOptions>): void {\n        this.sortOptions = { ...this.sortOptions, ...options };\n    }\n\n    /**\n     * Lock/unlock slot\n     */\n    setSlotLocked(slotIndex: number, locked: boolean): void {\n        if (slotIndex >= 0 && slotIndex < this.slots.length) {\n            this.slots[slotIndex].locked = locked;\n        }\n    }\n\n    /**\n     * Reserve/unreserve slot\n     */\n    setSlotReserved(slotIndex: number, reserved: boolean): void {\n        if (slotIndex >= 0 && slotIndex < this.slots.length) {\n            this.slots[slotIndex].reserved = reserved;\n        }\n    }\n\n    /**\n     * Clear inventory\n     */\n    clearInventory(): void {\n        this.slots.forEach(slot => slot.item = null);\n        this.totalWeight = 0;\n        this.totalVolume = 0;\n        this.selectedSlot = -1;\n        this.logger.info('📦 Inventory cleared');\n    }\n\n    /**\n     * Save inventory state\n     */\n    saveState(): any {\n        return {\n            slots: this.slots.map(slot => ({\n                index: slot.index,\n                item: slot.item ? {\n                    itemId: slot.item.item.id,\n                    quantity: slot.item.quantity,\n                    condition: slot.item.condition,\n                    modifiers: slot.item.modifiers\n                } : null,\n                locked: slot.locked,\n                reserved: slot.reserved\n            })),\n            totalWeight: this.totalWeight,\n            totalVolume: this.totalVolume\n        };\n    }\n\n    /**\n     * Load inventory state\n     */\n    loadState(state: any): void {\n        this.clearInventory();\n        \n        state.slots.forEach((slotData: any, index: number) => {\n            if (index < this.slots.length) {\n                const slot = this.slots[index];\n                slot.locked = slotData.locked || false;\n                slot.reserved = slotData.reserved || false;\n                \n                if (slotData.item) {\n                    const item = this.itemDatabase.getItem(slotData.item.itemId);\n                    if (item) {\n                        slot.item = {\n                            item,\n                            quantity: slotData.item.quantity,\n                            condition: slotData.item.condition,\n                            modifiers: slotData.item.modifiers\n                        };\n                    }\n                }\n            }\n        });\n        \n        this.totalWeight = state.totalWeight || 0;\n        this.totalVolume = state.totalVolume || 0;\n        \n        this.logger.info('📦 Inventory state loaded');\n    }\n}","/**\n * Crafting System\n * Basic crafting mechanics for combining items into new ones\n */\n\nimport { Logger } from '@utils/Logger';\nimport { GameItem, ItemDatabase, ItemRecipe, ItemType, ItemRarity } from '@items/ItemSystem';\nimport { InventoryManager } from '@inventory/InventoryManager';\nimport { Renderer, Color } from '@core/Renderer';\n\nexport interface CraftingStation {\n    id: string;\n    name: string;\n    type: 'basic' | 'advanced' | 'industrial';\n    availableRecipes: string[]; // Recipe IDs\n    energyRequired: number;\n    isActive: boolean;\n}\n\nexport interface CraftingAttempt {\n    recipeId: string;\n    station: CraftingStation;\n    startTime: number;\n    duration: number;\n    energyCost: number;\n    successRate: number;\n}\n\nexport interface CraftingEvents {\n    onCraftingStarted?: (attempt: CraftingAttempt) => void;\n    onCraftingCompleted?: (item: GameItem, success: boolean) => void;\n    onCraftingFailed?: (reason: string) => void;\n}\n\nexport class CraftingSystem {\n    private itemDatabase: ItemDatabase;\n    private inventory: InventoryManager;\n    private events: CraftingEvents;\n    \n    // Crafting state\n    private stations: Map<string, CraftingStation> = new Map();\n    private activeAttempts: CraftingAttempt[] = [];\n    private knownRecipes: Set<string> = new Set();\n    \n    // UI state\n    private isVisible: boolean = false;\n    private selectedStation: string | null = null;\n    private selectedRecipe: string | null = null;\n    \n    private logger: Logger;\n\n    constructor(\n        itemDatabase: ItemDatabase,\n        inventory: InventoryManager,\n        events: CraftingEvents = {}\n    ) {\n        this.logger = new Logger('CraftingSystem');\n        this.itemDatabase = itemDatabase;\n        this.inventory = inventory;\n        this.events = events;\n        \n        this.initializeStations();\n        this.initializeBasicRecipes();\n        \n        this.logger.info('🔧 Crafting system initialized', {\n            stations: this.stations.size,\n            knownRecipes: this.knownRecipes.size\n        });\n    }\n\n    /**\n     * Initialize crafting stations\n     */\n    private initializeStations(): void {\n        const stations: CraftingStation[] = [\n            {\n                id: 'basic_fabricator',\n                name: 'Basic Fabricator',\n                type: 'basic',\n                availableRecipes: [],\n                energyRequired: 10,\n                isActive: true\n            },\n            {\n                id: 'advanced_forge',\n                name: 'Advanced Forge',\n                type: 'advanced',\n                availableRecipes: [],\n                energyRequired: 25,\n                isActive: true\n            },\n            {\n                id: 'industrial_plant',\n                name: 'Industrial Plant',\n                type: 'industrial',\n                availableRecipes: [],\n                energyRequired: 50,\n                isActive: false // Requires research to unlock\n            }\n        ];\n        \n        stations.forEach(station => {\n            this.stations.set(station.id, station);\n        });\n    }\n\n    /**\n     * Initialize basic crafting recipes\n     */\n    private initializeBasicRecipes(): void {\n        // Create some basic recipes\n        const basicRecipes: ItemRecipe[] = [\n            {\n                id: 'craft_circuit_from_metal',\n                requiredItems: {\n                    'metal_iron': 2,\n                    'crystal_quartz': 1\n                },\n                craftingTime: 5, // 5 seconds\n                energyCost: 10,\n                successRate: 0.9\n            },\n            {\n                id: 'craft_repair_kit',\n                requiredItems: {\n                    'metal_iron': 1,\n                    'comp_circuit': 1\n                },\n                craftingTime: 8,\n                energyCost: 15,\n                successRate: 0.85\n            },\n            {\n                id: 'craft_energy_cell',\n                requiredItems: {\n                    'crystal_quartz': 2,\n                    'gas_hydrogen': 5\n                },\n                craftingTime: 3,\n                energyCost: 5,\n                successRate: 0.95\n            },\n            {\n                id: 'craft_shield_emitter',\n                requiredItems: {\n                    'metal_titanium': 3,\n                    'crystal_quartz': 2,\n                    'comp_circuit': 1\n                },\n                craftingTime: 15,\n                energyCost: 30,\n                successRate: 0.7\n            },\n            {\n                id: 'craft_plasma_conduit',\n                requiredItems: {\n                    'metal_titanium': 2,\n                    'crystal_dilithium': 1,\n                    'comp_circuit': 2\n                },\n                craftingTime: 20,\n                energyCost: 40,\n                successRate: 0.6\n            }\n        ];\n        \n        // Add recipes to appropriate items and stations\n        basicRecipes.forEach(recipe => {\n            // Add recipe to basic fabricator\n            const basicStation = this.stations.get('basic_fabricator');\n            if (basicStation) {\n                basicStation.availableRecipes.push(recipe.id);\n            }\n            \n            // Advanced recipes go to advanced forge\n            if (recipe.energyCost > 20) {\n                const advancedStation = this.stations.get('advanced_forge');\n                if (advancedStation) {\n                    advancedStation.availableRecipes.push(recipe.id);\n                }\n            }\n            \n            // Add to known recipes (player starts with basic knowledge)\n            if (recipe.energyCost <= 15) {\n                this.knownRecipes.add(recipe.id);\n            }\n        });\n        \n        // Update item database with recipes\n        this.updateItemRecipes(basicRecipes);\n    }\n\n    /**\n     * Update item database with crafting recipes\n     */\n    private updateItemRecipes(recipes: ItemRecipe[]): void {\n        recipes.forEach(recipe => {\n            // Find the target item for this recipe\n            const targetItem = this.findTargetItemForRecipe(recipe.id);\n            if (targetItem) {\n                targetItem.recipe = recipe;\n            }\n        });\n    }\n\n    /**\n     * Find target item for a recipe based on recipe ID\n     */\n    private findTargetItemForRecipe(recipeId: string): GameItem | undefined {\n        // Map recipe IDs to item IDs\n        const recipeToItemMap: { [key: string]: string } = {\n            'craft_circuit_from_metal': 'comp_circuit',\n            'craft_repair_kit': 'tool_repair_kit',\n            'craft_energy_cell': 'cons_energy_cell',\n            'craft_shield_emitter': 'comp_shield_emitter',\n            'craft_plasma_conduit': 'comp_plasma_conduit'\n        };\n        \n        const itemId = recipeToItemMap[recipeId];\n        return itemId ? this.itemDatabase.getItem(itemId) : undefined;\n    }\n\n    /**\n     * Start crafting an item\n     */\n    startCrafting(recipeId: string, stationId: string): boolean {\n        const station = this.stations.get(stationId);\n        const targetItem = this.findTargetItemForRecipe(recipeId);\n        \n        if (!station || !targetItem || !targetItem.recipe) {\n            this.events.onCraftingFailed?.('Invalid recipe or station');\n            return false;\n        }\n        \n        if (!station.isActive) {\n            this.events.onCraftingFailed?.('Crafting station is offline');\n            return false;\n        }\n        \n        if (!this.knownRecipes.has(recipeId)) {\n            this.events.onCraftingFailed?.('Recipe not yet discovered');\n            return false;\n        }\n        \n        if (!station.availableRecipes.includes(recipeId)) {\n            this.events.onCraftingFailed?.('Station cannot craft this item');\n            return false;\n        }\n        \n        const recipe = targetItem.recipe;\n        \n        // Check if player has required items\n        for (const [itemId, quantity] of Object.entries(recipe.requiredItems)) {\n            if (!this.inventory.hasItem(itemId, quantity)) {\n                this.events.onCraftingFailed?.(`Insufficient ${itemId}: need ${quantity}`);\n                return false;\n            }\n        }\n        \n        // TODO: Check energy requirements\n        // For now, assume player has enough energy\n        \n        // Remove required items from inventory\n        for (const [itemId, quantity] of Object.entries(recipe.requiredItems)) {\n            this.inventory.removeItem(itemId, quantity);\n        }\n        \n        // Create crafting attempt\n        const attempt: CraftingAttempt = {\n            recipeId,\n            station,\n            startTime: Date.now(),\n            duration: recipe.craftingTime * 1000, // Convert to milliseconds\n            energyCost: recipe.energyCost,\n            successRate: recipe.successRate\n        };\n        \n        this.activeAttempts.push(attempt);\n        this.events.onCraftingStarted?.(attempt);\n        \n        this.logger.info(`🔧 Started crafting ${targetItem.name}`, {\n            station: station.name,\n            duration: recipe.craftingTime,\n            successRate: recipe.successRate\n        });\n        \n        return true;\n    }\n\n    /**\n     * Update crafting system\n     */\n    update(deltaTime: number): void {\n        const currentTime = Date.now();\n        const completedAttempts: CraftingAttempt[] = [];\n        \n        // Check for completed crafting attempts\n        this.activeAttempts.forEach(attempt => {\n            if (currentTime >= attempt.startTime + attempt.duration) {\n                completedAttempts.push(attempt);\n            }\n        });\n        \n        // Process completed attempts\n        completedAttempts.forEach(attempt => {\n            this.completeCrafting(attempt);\n        });\n        \n        // Remove completed attempts\n        this.activeAttempts = this.activeAttempts.filter(\n            attempt => !completedAttempts.includes(attempt)\n        );\n    }\n\n    /**\n     * Complete a crafting attempt\n     */\n    private completeCrafting(attempt: CraftingAttempt): void {\n        const targetItem = this.findTargetItemForRecipe(attempt.recipeId);\n        if (!targetItem) return;\n        \n        // Determine success based on success rate\n        const success = Math.random() < attempt.successRate;\n        \n        if (success) {\n            // Add crafted item to inventory\n            const added = this.inventory.addItem(targetItem, 1);\n            if (added) {\n                this.logger.info(`✅ Successfully crafted ${targetItem.name}`);\n                this.events.onCraftingCompleted?.(targetItem, true);\n            } else {\n                this.logger.warn(`📦 Inventory full - ${targetItem.name} lost`);\n                this.events.onCraftingFailed?.('Inventory full - item lost');\n            }\n        } else {\n            this.logger.warn(`❌ Crafting failed: ${targetItem.name}`);\n            this.events.onCraftingCompleted?.(targetItem, false);\n            \n            // On failure, return some materials (50% chance for each)\n            if (targetItem.recipe) {\n                for (const [itemId, quantity] of Object.entries(targetItem.recipe.requiredItems)) {\n                    if (Math.random() < 0.5) {\n                        const returnQuantity = Math.ceil(quantity * 0.3); // Return 30% of materials\n                        const item = this.itemDatabase.getItem(itemId);\n                        if (item) {\n                            this.inventory.addItem(item, returnQuantity);\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Learn a new recipe\n     */\n    learnRecipe(recipeId: string): boolean {\n        if (this.knownRecipes.has(recipeId)) {\n            return false; // Already known\n        }\n        \n        this.knownRecipes.add(recipeId);\n        this.logger.info(`📚 Learned new recipe: ${recipeId}`);\n        return true;\n    }\n\n    /**\n     * Get available recipes for a station\n     */\n    getAvailableRecipes(stationId: string): GameItem[] {\n        const station = this.stations.get(stationId);\n        if (!station) return [];\n        \n        return station.availableRecipes\n            .filter(recipeId => this.knownRecipes.has(recipeId))\n            .map(recipeId => this.findTargetItemForRecipe(recipeId))\n            .filter(item => item !== undefined) as GameItem[];\n    }\n\n    /**\n     * Check if recipe can be crafted\n     */\n    canCraftRecipe(recipeId: string): {\n        canCraft: boolean;\n        missingItems: { [itemId: string]: number };\n        hasStation: boolean;\n    } {\n        const targetItem = this.findTargetItemForRecipe(recipeId);\n        if (!targetItem || !targetItem.recipe) {\n            return { canCraft: false, missingItems: {}, hasStation: false };\n        }\n        \n        const recipe = targetItem.recipe;\n        const missingItems: { [itemId: string]: number } = {};\n        let hasAllItems = true;\n        \n        // Check required items\n        for (const [itemId, required] of Object.entries(recipe.requiredItems)) {\n            const available = this.inventory.getItemCount(itemId);\n            if (available < required) {\n                missingItems[itemId] = required - available;\n                hasAllItems = false;\n            }\n        }\n        \n        // Check if any station can craft this\n        const hasStation = Array.from(this.stations.values()).some(station => \n            station.isActive && station.availableRecipes.includes(recipeId)\n        );\n        \n        return {\n            canCraft: hasAllItems && hasStation && this.knownRecipes.has(recipeId),\n            missingItems,\n            hasStation\n        };\n    }\n\n    /**\n     * Get crafting progress for active attempts\n     */\n    getCraftingProgress(): Array<{\n        recipeId: string;\n        itemName: string;\n        progress: number; // 0-1\n        timeRemaining: number; // seconds\n    }> {\n        const currentTime = Date.now();\n        \n        return this.activeAttempts.map(attempt => {\n            const elapsed = currentTime - attempt.startTime;\n            const progress = Math.min(1, elapsed / attempt.duration);\n            const timeRemaining = Math.max(0, (attempt.duration - elapsed) / 1000);\n            \n            const targetItem = this.findTargetItemForRecipe(attempt.recipeId);\n            \n            return {\n                recipeId: attempt.recipeId,\n                itemName: targetItem?.name || 'Unknown',\n                progress,\n                timeRemaining\n            };\n        });\n    }\n\n    /**\n     * Render crafting UI\n     */\n    render(renderer: Renderer): void {\n        if (!this.isVisible) return;\n        \n        // Render crafting panel\n        this.renderCraftingPanel(renderer);\n        \n        // Render progress indicators\n        this.renderCraftingProgress(renderer);\n    }\n\n    /**\n     * Render main crafting panel\n     */\n    private renderCraftingPanel(renderer: Renderer): void {\n        const panelX = 300;\n        const panelY = 100;\n        const panelWidth = 400;\n        const panelHeight = 300;\n        \n        // Panel background\n        renderer.fillRect(panelX, panelY, panelWidth, panelHeight, { r: 8, g: 12, b: 8 });\n        \n        // Panel border\n        const borderColor = { r: 16, g: 48, b: 16 };\n        renderer.drawLine(panelX, panelY, panelX + panelWidth, panelY, borderColor);\n        renderer.drawLine(panelX, panelY, panelX, panelY + panelHeight, borderColor);\n        renderer.drawLine(panelX + panelWidth, panelY, panelX + panelWidth, panelY + panelHeight, borderColor);\n        renderer.drawLine(panelX, panelY + panelHeight, panelX + panelWidth, panelY + panelHeight, borderColor);\n        \n        // Title\n        renderer.renderText('FABRICATION UNIT', panelX + 10, panelY + 10, { r: 12, g: 36, b: 12 }, 12);\n        \n        // Station list\n        let stationY = panelY + 35;\n        this.stations.forEach(station => {\n            const stationColor = station.isActive ? \n                { r: 12, g: 36, b: 12 } : \n                { r: 32, g: 32, b: 32 };\n            \n            const statusText = station.isActive ? 'ONLINE' : 'OFFLINE';\n            renderer.renderText(`[${station.id}] ${station.name}: ${statusText}`, \n                panelX + 10, stationY, stationColor, 8);\n            stationY += 12;\n        });\n        \n        // Available recipes for selected station\n        if (this.selectedStation) {\n            const recipes = this.getAvailableRecipes(this.selectedStation);\n            \n            renderer.renderText('AVAILABLE SCHEMATICS:', panelX + 10, stationY + 10, \n                { r: 48, g: 48, b: 48 }, 8);\n            \n            let recipeY = stationY + 25;\n            recipes.forEach(item => {\n                const craftability = this.canCraftRecipe(item.recipe!.id);\n                const textColor = craftability.canCraft ? \n                    { r: 12, g: 36, b: 12 } : \n                    { r: 72, g: 24, b: 24 };\n                \n                renderer.renderText(`- ${item.name}`, panelX + 20, recipeY, textColor, 8);\n                recipeY += 12;\n                \n                // Show missing materials\n                if (Object.keys(craftability.missingItems).length > 0) {\n                    const missingText = Object.entries(craftability.missingItems)\n                        .map(([id, count]) => `${count}x ${id}`)\n                        .join(', ');\n                    renderer.renderText(`  Missing: ${missingText}`, \n                        panelX + 30, recipeY, { r: 48, g: 32, b: 32 }, 7);\n                    recipeY += 10;\n                }\n            });\n        }\n    }\n\n    /**\n     * Render crafting progress\n     */\n    private renderCraftingProgress(renderer: Renderer): void {\n        const progressItems = this.getCraftingProgress();\n        if (progressItems.length === 0) return;\n        \n        const progressX = 50;\n        let progressY = 400;\n        \n        renderer.renderText('FABRICATION IN PROGRESS:', progressX, progressY, \n            { r: 12, g: 36, b: 12 }, 10);\n        progressY += 15;\n        \n        progressItems.forEach(item => {\n            // Progress bar\n            const barWidth = 200;\n            const barHeight = 8;\n            const fillWidth = Math.floor(barWidth * item.progress);\n            \n            // Bar background\n            renderer.fillRect(progressX, progressY, barWidth, barHeight, { r: 16, g: 16, b: 16 });\n            \n            // Bar fill\n            const fillColor = item.progress >= 1 ? \n                { r: 12, g: 36, b: 12 } : \n                { r: 32, g: 80, b: 64 };\n            renderer.fillRect(progressX, progressY, fillWidth, barHeight, fillColor);\n            \n            // Item name and time\n            renderer.renderText(`${item.itemName} - ${item.timeRemaining.toFixed(1)}s`, \n                progressX + barWidth + 10, progressY, { r: 48, g: 48, b: 48 }, 8);\n            \n            progressY += 15;\n        });\n    }\n\n    /**\n     * Show/hide crafting UI\n     */\n    setVisible(visible: boolean): void {\n        this.isVisible = visible;\n    }\n\n    /**\n     * Check if crafting UI is visible\n     */\n    isCraftingVisible(): boolean {\n        return this.isVisible;\n    }\n\n    /**\n     * Select crafting station\n     */\n    selectStation(stationId: string): void {\n        if (this.stations.has(stationId)) {\n            this.selectedStation = stationId;\n        }\n    }\n\n    /**\n     * Get selected station\n     */\n    getSelectedStation(): CraftingStation | null {\n        return this.selectedStation ? this.stations.get(this.selectedStation) || null : null;\n    }\n\n    /**\n     * Activate/deactivate station\n     */\n    setStationActive(stationId: string, active: boolean): void {\n        const station = this.stations.get(stationId);\n        if (station) {\n            station.isActive = active;\n            this.logger.info(`🔧 Station ${station.name} ${active ? 'activated' : 'deactivated'}`);\n        }\n    }\n\n    /**\n     * Get crafting statistics\n     */\n    getStats(): {\n        knownRecipes: number;\n        activeStations: number;\n        totalStations: number;\n        activeCrafting: number;\n    } {\n        const activeStations = Array.from(this.stations.values()).filter(s => s.isActive).length;\n        \n        return {\n            knownRecipes: this.knownRecipes.size,\n            activeStations,\n            totalStations: this.stations.size,\n            activeCrafting: this.activeAttempts.length\n        };\n    }\n\n    /**\n     * Save crafting state\n     */\n    saveState(): any {\n        return {\n            knownRecipes: Array.from(this.knownRecipes),\n            stations: Array.from(this.stations.values()),\n            activeAttempts: this.activeAttempts\n        };\n    }\n\n    /**\n     * Load crafting state\n     */\n    loadState(state: any): void {\n        if (state.knownRecipes) {\n            this.knownRecipes = new Set(state.knownRecipes);\n        }\n        \n        if (state.stations) {\n            state.stations.forEach((stationData: CraftingStation) => {\n                this.stations.set(stationData.id, stationData);\n            });\n        }\n        \n        if (state.activeAttempts) {\n            this.activeAttempts = state.activeAttempts;\n        }\n        \n        this.logger.info('🔧 Crafting state loaded');\n    }\n}","/**\n * Weapon System\n * Complete combat mechanics with projectiles, targeting, and damage\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer, Color } from '@core/Renderer';\nimport { GameItem } from '@items/ItemSystem';\n\nexport enum WeaponType {\n    Energy = 'energy',\n    Projectile = 'projectile', \n    Missile = 'missile',\n    Plasma = 'plasma',\n    Beam = 'beam',\n    Torpedo = 'torpedo'\n}\n\nexport enum DamageType {\n    Kinetic = 'kinetic',\n    Energy = 'energy',\n    Thermal = 'thermal',\n    Electromagnetic = 'electromagnetic',\n    Explosive = 'explosive'\n}\n\nexport enum TargetingMode {\n    Manual = 'manual',\n    Assisted = 'assisted',\n    Automatic = 'automatic',\n    PointDefense = 'point_defense'\n}\n\nexport interface WeaponStats {\n    damage: number;\n    range: number;\n    fireRate: number; // shots per second\n    energyCost: number;\n    accuracy: number; // 0-1\n    penetration: number;\n    spread: number; // degrees\n    chargeTime: number; // seconds\n    cooldownTime: number; // seconds\n    ammoCapacity?: number;\n    reloadTime?: number;\n}\n\nexport interface WeaponConfig {\n    id: string;\n    name: string;\n    type: WeaponType;\n    damageType: DamageType;\n    stats: WeaponStats;\n    item?: GameItem;\n    mountPoint: Vector2;\n    hardpointSize: 'small' | 'medium' | 'large';\n}\n\nexport interface Projectile {\n    id: string;\n    position: Vector2;\n    velocity: Vector2;\n    damage: number;\n    damageType: DamageType;\n    range: number;\n    maxRange: number;\n    size: number;\n    weaponId: string;\n    targetId?: string;\n    penetration: number;\n    isHoming: boolean;\n    homingStrength: number;\n    life: number; // 0-1\n    trail: Vector2[];\n}\n\nexport interface DamageResult {\n    targetId: string;\n    damage: number;\n    damageType: DamageType;\n    criticalHit: boolean;\n    penetrated: boolean;\n    shieldsHit: boolean;\n    hullHit: boolean;\n}\n\nexport interface WeaponEvents {\n    onWeaponFired?: (weapon: WeaponConfig, projectile: Projectile) => void;\n    onProjectileHit?: (projectile: Projectile, result: DamageResult) => void;\n    onWeaponOverheat?: (weapon: WeaponConfig) => void;\n    onAmmoEmpty?: (weapon: WeaponConfig) => void;\n}\n\nexport class WeaponSystem {\n    private weapons: Map<string, WeaponConfig> = new Map();\n    private projectiles: Map<string, Projectile> = new Map();\n    private weaponStates: Map<string, {\n        isCharging: boolean;\n        chargeProgress: number;\n        lastFired: number;\n        heat: number;\n        ammo: number;\n        isOverheated: boolean;\n        cooldownEnd: number;\n    }> = new Map();\n    \n    private events: WeaponEvents;\n    private nextProjectileId: number = 0;\n    \n    // Targeting system\n    private targetingMode: TargetingMode = TargetingMode.Manual;\n    private currentTarget: string | null = null;\n    private targetPosition: Vector2 | null = null;\n    private targets: Map<string, { position: Vector2, velocity: Vector2, size: number }> = new Map();\n    \n    private logger: Logger;\n\n    constructor(events: WeaponEvents = {}) {\n        this.logger = new Logger('WeaponSystem');\n        this.events = events;\n        \n        this.logger.info('⚔️ Weapon system initialized');\n    }\n\n    /**\n     * Add weapon to system\n     */\n    addWeapon(weapon: WeaponConfig): void {\n        this.weapons.set(weapon.id, weapon);\n        this.weaponStates.set(weapon.id, {\n            isCharging: false,\n            chargeProgress: 0,\n            lastFired: 0,\n            heat: 0,\n            ammo: weapon.stats.ammoCapacity || -1, // -1 for infinite energy weapons\n            isOverheated: false,\n            cooldownEnd: 0\n        });\n        \n        this.logger.info(`🔫 Added weapon: ${weapon.name}`, {\n            type: weapon.type,\n            damage: weapon.stats.damage,\n            range: weapon.stats.range\n        });\n    }\n\n    /**\n     * Remove weapon from system\n     */\n    removeWeapon(weaponId: string): void {\n        this.weapons.delete(weaponId);\n        this.weaponStates.delete(weaponId);\n        \n        // Remove projectiles from this weapon\n        for (const [projId, projectile] of this.projectiles.entries()) {\n            if (projectile.weaponId === weaponId) {\n                this.projectiles.delete(projId);\n            }\n        }\n        \n        this.logger.info(`🔫 Removed weapon: ${weaponId}`);\n    }\n\n    /**\n     * Fire weapon\n     */\n    fireWeapon(weaponId: string, sourcePosition: Vector2, targetPosition?: Vector2): boolean {\n        const weapon = this.weapons.get(weaponId);\n        const state = this.weaponStates.get(weaponId);\n        \n        if (!weapon || !state) return false;\n        \n        const currentTime = Date.now() / 1000;\n        \n        // Check if weapon can fire\n        if (state.isOverheated || currentTime < state.cooldownEnd) {\n            return false;\n        }\n        \n        // Check fire rate\n        const timeSinceLastShot = currentTime - state.lastFired;\n        const minInterval = 1 / weapon.stats.fireRate;\n        if (timeSinceLastShot < minInterval) {\n            return false;\n        }\n        \n        // Check ammo\n        if (state.ammo === 0) {\n            this.events.onAmmoEmpty?.(weapon);\n            return false;\n        }\n        \n        // For charge weapons, handle charging\n        if (weapon.stats.chargeTime > 0) {\n            if (!state.isCharging) {\n                state.isCharging = true;\n                state.chargeProgress = 0;\n                return false; // Start charging, don't fire yet\n            } else if (state.chargeProgress < 1.0) {\n                return false; // Still charging\n            }\n        }\n        \n        // Determine target position\n        let finalTargetPos = targetPosition;\n        if (!finalTargetPos) {\n            if (this.targetPosition) {\n                finalTargetPos = this.targetPosition;\n            } else if (this.currentTarget && this.targets.has(this.currentTarget)) {\n                finalTargetPos = this.targets.get(this.currentTarget)!.position;\n            } else {\n                // Default forward firing\n                finalTargetPos = {\n                    x: sourcePosition.x + weapon.stats.range,\n                    y: sourcePosition.y\n                };\n            }\n        }\n        \n        // Calculate firing direction with spread\n        const direction = this.calculateFiringDirection(sourcePosition, finalTargetPos, weapon.stats.spread);\n        \n        // Create projectile\n        const projectile = this.createProjectile(weapon, sourcePosition, direction, finalTargetPos);\n        this.projectiles.set(projectile.id, projectile);\n        \n        // Update weapon state\n        state.lastFired = currentTime;\n        state.heat += 0.1; // Weapons generate heat\n        state.isCharging = false;\n        state.chargeProgress = 0;\n        \n        if (state.ammo > 0) {\n            state.ammo--;\n        }\n        \n        // Check for overheat\n        if (state.heat > 1.0) {\n            state.isOverheated = true;\n            state.cooldownEnd = currentTime + weapon.stats.cooldownTime;\n            this.events.onWeaponOverheat?.(weapon);\n        }\n        \n        this.events.onWeaponFired?.(weapon, projectile);\n        \n        this.logger.debug(`🔥 Fired ${weapon.name}`, {\n            damage: projectile.damage,\n            range: projectile.maxRange,\n            targetDistance: this.calculateDistance(sourcePosition, finalTargetPos)\n        });\n        \n        return true;\n    }\n\n    /**\n     * Create projectile from weapon\n     */\n    private createProjectile(weapon: WeaponConfig, sourcePos: Vector2, direction: Vector2, targetPos: Vector2): Projectile {\n        const projectileId = `proj_${weapon.id}_${this.nextProjectileId++}`;\n        \n        // Calculate velocity based on weapon type\n        let speed = 500; // Default speed\n        let isHoming = false;\n        let homingStrength = 0;\n        \n        switch (weapon.type) {\n            case WeaponType.Energy:\n                speed = 800;\n                break;\n            case WeaponType.Projectile:\n                speed = 600;\n                break;\n            case WeaponType.Missile:\n                speed = 300;\n                isHoming = true;\n                homingStrength = 0.1;\n                break;\n            case WeaponType.Plasma:\n                speed = 400;\n                break;\n            case WeaponType.Beam:\n                speed = 1200; // Very fast\n                break;\n            case WeaponType.Torpedo:\n                speed = 250;\n                isHoming = true;\n                homingStrength = 0.15;\n                break;\n        }\n        \n        const velocity = {\n            x: direction.x * speed,\n            y: direction.y * speed\n        };\n        \n        return {\n            id: projectileId,\n            position: { ...sourcePos },\n            velocity,\n            damage: weapon.stats.damage,\n            damageType: weapon.damageType,\n            range: 0,\n            maxRange: weapon.stats.range,\n            size: this.getProjectileSize(weapon.type),\n            weaponId: weapon.id,\n            targetId: this.currentTarget || undefined,\n            penetration: weapon.stats.penetration,\n            isHoming,\n            homingStrength,\n            life: 1.0,\n            trail: []\n        };\n    }\n\n    /**\n     * Get projectile visual size based on weapon type\n     */\n    private getProjectileSize(weaponType: WeaponType): number {\n        switch (weaponType) {\n            case WeaponType.Energy: return 2;\n            case WeaponType.Projectile: return 1;\n            case WeaponType.Missile: return 4;\n            case WeaponType.Plasma: return 3;\n            case WeaponType.Beam: return 1;\n            case WeaponType.Torpedo: return 6;\n            default: return 2;\n        }\n    }\n\n    /**\n     * Calculate firing direction with accuracy and spread\n     */\n    private calculateFiringDirection(sourcePos: Vector2, targetPos: Vector2, spread: number): Vector2 {\n        // Base direction to target\n        const dx = targetPos.x - sourcePos.x;\n        const dy = targetPos.y - sourcePos.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        \n        if (distance === 0) {\n            return { x: 1, y: 0 }; // Default forward\n        }\n        \n        // Normalize\n        let direction = {\n            x: dx / distance,\n            y: dy / distance\n        };\n        \n        // Apply spread (inaccuracy)\n        if (spread > 0) {\n            const spreadRad = (spread * Math.PI / 180) * (Math.random() - 0.5);\n            const cos = Math.cos(spreadRad);\n            const sin = Math.sin(spreadRad);\n            \n            direction = {\n                x: direction.x * cos - direction.y * sin,\n                y: direction.x * sin + direction.y * cos\n            };\n        }\n        \n        return direction;\n    }\n\n    /**\n     * Update weapon system\n     */\n    update(deltaTime: number): void {\n        this.updateWeaponStates(deltaTime);\n        this.updateProjectiles(deltaTime);\n        this.checkProjectileHits();\n        this.cleanupProjectiles();\n    }\n\n    /**\n     * Update weapon states (cooling, charging, etc.)\n     */\n    private updateWeaponStates(deltaTime: number): void {\n        const currentTime = Date.now() / 1000;\n        \n        for (const [weaponId, state] of this.weaponStates.entries()) {\n            const weapon = this.weapons.get(weaponId);\n            if (!weapon) continue;\n            \n            // Cool down heat\n            if (state.heat > 0) {\n                state.heat = Math.max(0, state.heat - deltaTime * 0.5); // Heat dissipation rate\n            }\n            \n            // Check if cooled down from overheat\n            if (state.isOverheated && currentTime >= state.cooldownEnd) {\n                state.isOverheated = false;\n                state.heat = 0;\n            }\n            \n            // Update charging\n            if (state.isCharging && weapon.stats.chargeTime > 0) {\n                state.chargeProgress = Math.min(1.0, state.chargeProgress + deltaTime / weapon.stats.chargeTime);\n            }\n        }\n    }\n\n    /**\n     * Update projectile movement and behavior\n     */\n    private updateProjectiles(deltaTime: number): void {\n        for (const [projId, projectile] of this.projectiles.entries()) {\n            // Update position\n            projectile.position.x += projectile.velocity.x * deltaTime;\n            projectile.position.y += projectile.velocity.y * deltaTime;\n            \n            // Update range\n            projectile.range += Math.sqrt(\n                projectile.velocity.x * projectile.velocity.x + \n                projectile.velocity.y * projectile.velocity.y\n            ) * deltaTime;\n            \n            // Update trail\n            if (projectile.trail.length > 10) {\n                projectile.trail.shift(); // Remove oldest position\n            }\n            projectile.trail.push({ ...projectile.position });\n            \n            // Homing behavior\n            if (projectile.isHoming && projectile.targetId && this.targets.has(projectile.targetId)) {\n                this.updateHomingProjectile(projectile, deltaTime);\n            }\n            \n            // Update life based on range\n            projectile.life = Math.max(0, 1 - (projectile.range / projectile.maxRange));\n        }\n    }\n\n    /**\n     * Update homing projectile guidance\n     */\n    private updateHomingProjectile(projectile: Projectile, deltaTime: number): void {\n        const target = this.targets.get(projectile.targetId!);\n        if (!target) return;\n        \n        // Predict target position\n        const predictedPos = {\n            x: target.position.x + target.velocity.x * 0.5, // 0.5 second prediction\n            y: target.position.y + target.velocity.y * 0.5\n        };\n        \n        // Calculate direction to predicted position\n        const dx = predictedPos.x - projectile.position.x;\n        const dy = predictedPos.y - projectile.position.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        \n        if (distance > 0) {\n            const targetDirection = {\n                x: dx / distance,\n                y: dy / distance\n            };\n            \n            // Current velocity direction\n            const speed = Math.sqrt(\n                projectile.velocity.x * projectile.velocity.x + \n                projectile.velocity.y * projectile.velocity.y\n            );\n            \n            // Interpolate toward target direction\n            const currentDirection = {\n                x: projectile.velocity.x / speed,\n                y: projectile.velocity.y / speed\n            };\n            \n            const homingFactor = projectile.homingStrength * deltaTime * 10;\n            const newDirection = {\n                x: currentDirection.x + (targetDirection.x - currentDirection.x) * homingFactor,\n                y: currentDirection.y + (targetDirection.y - currentDirection.y) * homingFactor\n            };\n            \n            // Normalize and apply\n            const newLength = Math.sqrt(newDirection.x * newDirection.x + newDirection.y * newDirection.y);\n            if (newLength > 0) {\n                projectile.velocity.x = (newDirection.x / newLength) * speed;\n                projectile.velocity.y = (newDirection.y / newLength) * speed;\n            }\n        }\n    }\n\n    /**\n     * Check for projectile hits against targets\n     */\n    private checkProjectileHits(): void {\n        for (const [projId, projectile] of this.projectiles.entries()) {\n            for (const [targetId, target] of this.targets.entries()) {\n                const distance = this.calculateDistance(projectile.position, target.position);\n                const hitRadius = projectile.size + target.size;\n                \n                if (distance <= hitRadius) {\n                    // Hit detected\n                    const damage = this.calculateDamage(projectile, target);\n                    const result: DamageResult = {\n                        targetId,\n                        damage: damage.finalDamage,\n                        damageType: projectile.damageType,\n                        criticalHit: damage.critical,\n                        penetrated: damage.penetrated,\n                        shieldsHit: damage.shieldsHit,\n                        hullHit: damage.hullHit\n                    };\n                    \n                    this.events.onProjectileHit?.(projectile, result);\n                    \n                    // Remove projectile unless it penetrates\n                    if (!damage.penetrated) {\n                        this.projectiles.delete(projId);\n                    }\n                    \n                    this.logger.debug(`💥 Projectile hit`, {\n                        targetId,\n                        damage: damage.finalDamage,\n                        critical: damage.critical\n                    });\n                    \n                    break; // One hit per projectile per frame\n                }\n            }\n        }\n    }\n\n    /**\n     * Calculate damage from projectile hit\n     */\n    private calculateDamage(projectile: Projectile, target: { position: Vector2, velocity: Vector2, size: number }): {\n        finalDamage: number;\n        critical: boolean;\n        penetrated: boolean;\n        shieldsHit: boolean;\n        hullHit: boolean;\n    } {\n        let damage = projectile.damage;\n        let critical = false;\n        let penetrated = false;\n        \n        // Critical hit chance (5% base)\n        if (Math.random() < 0.05) {\n            critical = true;\n            damage *= 2;\n        }\n        \n        // Damage falloff with range\n        const falloff = Math.max(0.3, 1 - (projectile.range / projectile.maxRange) * 0.5);\n        damage *= falloff;\n        \n        // Penetration check (simplified)\n        if (projectile.penetration > 0.7) {\n            penetrated = Math.random() < 0.3;\n        }\n        \n        return {\n            finalDamage: Math.floor(damage),\n            critical,\n            penetrated,\n            shieldsHit: true, // Simplified - assume shields absorb first\n            hullHit: penetrated\n        };\n    }\n\n    /**\n     * Remove expired projectiles\n     */\n    private cleanupProjectiles(): void {\n        for (const [projId, projectile] of this.projectiles.entries()) {\n            if (projectile.life <= 0 || projectile.range >= projectile.maxRange) {\n                this.projectiles.delete(projId);\n            }\n        }\n    }\n\n    /**\n     * Set targeting mode\n     */\n    setTargetingMode(mode: TargetingMode): void {\n        this.targetingMode = mode;\n        this.logger.debug(`🎯 Targeting mode: ${mode}`);\n    }\n\n    /**\n     * Set manual target position\n     */\n    setTargetPosition(position: Vector2): void {\n        this.targetPosition = { ...position };\n    }\n\n    /**\n     * Set current target\n     */\n    setTarget(targetId: string | null): void {\n        this.currentTarget = targetId;\n        this.logger.debug(`🎯 Target: ${targetId || 'none'}`);\n    }\n\n    /**\n     * Add/update target for tracking\n     */\n    updateTarget(targetId: string, position: Vector2, velocity: Vector2, size: number): void {\n        this.targets.set(targetId, { position: { ...position }, velocity: { ...velocity }, size });\n    }\n\n    /**\n     * Remove target from tracking\n     */\n    removeTarget(targetId: string): void {\n        this.targets.delete(targetId);\n        if (this.currentTarget === targetId) {\n            this.currentTarget = null;\n        }\n    }\n\n    /**\n     * Get weapon information\n     */\n    getWeapon(weaponId: string): { weapon: WeaponConfig; state: any } | null {\n        const weapon = this.weapons.get(weaponId);\n        const state = this.weaponStates.get(weaponId);\n        \n        if (!weapon || !state) return null;\n        \n        return { weapon, state };\n    }\n\n    /**\n     * Get all weapons\n     */\n    getAllWeapons(): Array<{ weapon: WeaponConfig; state: any }> {\n        const result: Array<{ weapon: WeaponConfig; state: any }> = [];\n        \n        for (const [weaponId, weapon] of this.weapons.entries()) {\n            const state = this.weaponStates.get(weaponId);\n            if (state) {\n                result.push({ weapon, state });\n            }\n        }\n        \n        return result;\n    }\n\n    /**\n     * Reload weapon\n     */\n    reloadWeapon(weaponId: string): boolean {\n        const weapon = this.weapons.get(weaponId);\n        const state = this.weaponStates.get(weaponId);\n        \n        if (!weapon || !state || !weapon.stats.ammoCapacity) return false;\n        \n        state.ammo = weapon.stats.ammoCapacity;\n        this.logger.debug(`🔄 Reloaded ${weapon.name}`);\n        \n        return true;\n    }\n\n    /**\n     * Render weapon effects\n     */\n    render(renderer: Renderer): void {\n        this.renderProjectiles(renderer);\n        this.renderWeaponCharges(renderer);\n    }\n\n    /**\n     * Render projectiles and their trails\n     */\n    private renderProjectiles(renderer: Renderer): void {\n        for (const projectile of this.projectiles.values()) {\n            // Render trail\n            if (projectile.trail.length > 1) {\n                for (let i = 1; i < projectile.trail.length; i++) {\n                    const alpha = (i / projectile.trail.length) * projectile.life;\n                    const trailColor = this.getProjectileColor(projectile, alpha * 0.5);\n                    \n                    renderer.drawLine(\n                        projectile.trail[i-1].x, projectile.trail[i-1].y,\n                        projectile.trail[i].x, projectile.trail[i].y,\n                        trailColor\n                    );\n                }\n            }\n            \n            // Render projectile\n            const color = this.getProjectileColor(projectile, projectile.life);\n            const size = projectile.size * projectile.life;\n            \n            if (projectile.size > 2) {\n                // Larger projectiles as filled circles\n                renderer.drawCircle(projectile.position.x, projectile.position.y, size, color, true);\n            } else {\n                // Small projectiles as pixels\n                renderer.fillRect(\n                    projectile.position.x - size/2, \n                    projectile.position.y - size/2, \n                    size, size, color\n                );\n            }\n        }\n    }\n\n    /**\n     * Get projectile color based on weapon type\n     */\n    private getProjectileColor(projectile: Projectile, alpha: number): Color {\n        const weapon = this.weapons.get(projectile.weaponId);\n        if (!weapon) return { r: 48, g: 48, b: 48 };\n        \n        let baseColor: Color;\n        \n        switch (weapon.type) {\n            case WeaponType.Energy:\n                baseColor = { r: 16, g: 48, b: 16 }; // Green energy\n                break;\n            case WeaponType.Projectile:\n                baseColor = { r: 96, g: 64, b: 16 }; // Orange projectile\n                break;\n            case WeaponType.Missile:\n                baseColor = { r: 72, g: 24, b: 24 }; // Red missile\n                break;\n            case WeaponType.Plasma:\n                baseColor = { r: 48, g: 24, b: 72 }; // Purple plasma\n                break;\n            case WeaponType.Beam:\n                baseColor = { r: 32, g: 80, b: 64 }; // Cyan beam\n                break;\n            case WeaponType.Torpedo:\n                baseColor = { r: 64, g: 32, b: 96 }; // Magenta torpedo\n                break;\n            default:\n                baseColor = { r: 48, g: 48, b: 48 };\n        }\n        \n        return {\n            r: Math.floor(baseColor.r * alpha),\n            g: Math.floor(baseColor.g * alpha),\n            b: Math.floor(baseColor.b * alpha)\n        };\n    }\n\n    /**\n     * Render weapon charge indicators\n     */\n    private renderWeaponCharges(renderer: Renderer): void {\n        // TODO: Render charging indicators for weapons that require charging\n        // This would show charge progress bars near weapon hardpoints\n    }\n\n    /**\n     * Calculate distance between two points\n     */\n    private calculateDistance(pos1: Vector2, pos2: Vector2): number {\n        const dx = pos1.x - pos2.x;\n        const dy = pos1.y - pos2.y;\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    /**\n     * Get weapon system statistics\n     */\n    getStats(): {\n        totalWeapons: number;\n        activeProjectiles: number;\n        targetsTracked: number;\n        weaponsByType: { [type: string]: number };\n    } {\n        const weaponsByType: { [type: string]: number } = {};\n        \n        for (const weapon of this.weapons.values()) {\n            weaponsByType[weapon.type] = (weaponsByType[weapon.type] || 0) + 1;\n        }\n        \n        return {\n            totalWeapons: this.weapons.size,\n            activeProjectiles: this.projectiles.size,\n            targetsTracked: this.targets.size,\n            weaponsByType\n        };\n    }\n\n    /**\n     * Clear all projectiles (for cleanup/reset)\n     */\n    clearProjectiles(): void {\n        this.projectiles.clear();\n    }\n\n    /**\n     * Clear all targets\n     */\n    clearTargets(): void {\n        this.targets.clear();\n        this.currentTarget = null;\n    }\n}","/**\n * Enemy AI System\n * Intelligent combat AI with different behaviors and ship types\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer, Color } from '@core/Renderer';\nimport { WeaponSystem, WeaponConfig, WeaponType, DamageType } from './WeaponSystem';\n\nexport enum AIBehavior {\n    Aggressive = 'aggressive',\n    Defensive = 'defensive',\n    Evasive = 'evasive',\n    Patrol = 'patrol',\n    Guard = 'guard',\n    Kamikaze = 'kamikaze',\n    Sniper = 'sniper',\n    Support = 'support'\n}\n\nexport enum ShipClass {\n    Fighter = 'fighter',\n    Corvette = 'corvette',\n    Frigate = 'frigate',\n    Destroyer = 'destroyer',\n    Cruiser = 'cruiser',\n    Battleship = 'battleship',\n    Drone = 'drone'\n}\n\nexport interface EnemyShipConfig {\n    id: string;\n    name: string;\n    shipClass: ShipClass;\n    faction: string;\n    \n    // Physical properties\n    size: number;\n    mass: number;\n    maxSpeed: number;\n    acceleration: number;\n    turnRate: number;\n    \n    // Combat properties\n    hull: number;\n    maxHull: number;\n    shields: number;\n    maxShields: number;\n    armor: number;\n    \n    // AI properties\n    behavior: AIBehavior;\n    aggression: number; // 0-1\n    intelligence: number; // 0-1\n    accuracy: number; // 0-1\n    reactionTime: number; // seconds\n    \n    // Equipment\n    weapons: WeaponConfig[];\n    engagementRange: number;\n    preferredRange: number;\n}\n\nexport interface EnemyShip {\n    config: EnemyShipConfig;\n    position: Vector2;\n    velocity: Vector2;\n    rotation: number;\n    \n    // AI state\n    currentTarget: string | null;\n    state: AIState;\n    stateTimer: number;\n    lastDecisionTime: number;\n    \n    // Combat state\n    lastShotTime: number;\n    weaponCooldowns: Map<string, number>;\n    \n    // Movement state\n    waypoint: Vector2 | null;\n    patrolCenter: Vector2;\n    patrolRadius: number;\n    \n    // Status\n    isAlive: boolean;\n    lastDamageTime: number;\n}\n\nexport enum AIState {\n    Idle = 'idle',\n    Patrol = 'patrol',\n    Pursue = 'pursue',\n    Attack = 'attack',\n    Evade = 'evade',\n    Retreat = 'retreat',\n    Guard = 'guard',\n    CircleStrafe = 'circle_strafe',\n    Ramming = 'ramming'\n}\n\nexport interface AIEvents {\n    onEnemySpawned?: (enemy: EnemyShip) => void;\n    onEnemyDestroyed?: (enemy: EnemyShip) => void;\n    onEnemyDamaged?: (enemy: EnemyShip, damage: number) => void;\n    onEnemyStateChanged?: (enemy: EnemyShip, oldState: AIState, newState: AIState) => void;\n}\n\nexport class EnemyAI {\n    private enemies: Map<string, EnemyShip> = new Map();\n    private weaponSystem: WeaponSystem;\n    private events: AIEvents;\n    \n    // Player tracking\n    private playerPosition: Vector2 = { x: 0, y: 0 };\n    private playerVelocity: Vector2 = { x: 0, y: 0 };\n    private playerSize: number = 20;\n    \n    // Faction relationships\n    private factionRelations: Map<string, Map<string, number>> = new Map(); // -1 to 1\n    \n    private logger: Logger;\n\n    constructor(weaponSystem: WeaponSystem, events: AIEvents = {}) {\n        this.logger = new Logger('EnemyAI');\n        this.weaponSystem = weaponSystem;\n        this.events = events;\n        \n        this.initializeFactions();\n        \n        this.logger.info('🤖 Enemy AI system initialized');\n    }\n\n    /**\n     * Initialize faction relationships\n     */\n    private initializeFactions(): void {\n        const factions = ['pirates', 'aliens', 'rebels', 'corporation', 'military'];\n        \n        for (const faction1 of factions) {\n            if (!this.factionRelations.has(faction1)) {\n                this.factionRelations.set(faction1, new Map());\n            }\n            \n            for (const faction2 of factions) {\n                let relation = 0;\n                \n                if (faction1 === faction2) {\n                    relation = 1; // Same faction\n                } else if (\n                    (faction1 === 'pirates' && faction2 === 'military') ||\n                    (faction1 === 'military' && faction2 === 'pirates') ||\n                    (faction1 === 'rebels' && faction2 === 'corporation') ||\n                    (faction1 === 'corporation' && faction2 === 'rebels')\n                ) {\n                    relation = -1; // Hostile\n                } else if (faction1 === 'aliens') {\n                    relation = -0.5; // Aliens generally hostile\n                } else {\n                    relation = Math.random() * 0.4 - 0.2; // Neutral with slight variation\n                }\n                \n                this.factionRelations.get(faction1)!.set(faction2, relation);\n            }\n        }\n    }\n\n    /**\n     * Spawn enemy ship\n     */\n    spawnEnemy(config: EnemyShipConfig, position: Vector2): string {\n        const enemy: EnemyShip = {\n            config,\n            position: { ...position },\n            velocity: { x: 0, y: 0 },\n            rotation: Math.random() * Math.PI * 2,\n            \n            currentTarget: null,\n            state: AIState.Idle,\n            stateTimer: 0,\n            lastDecisionTime: 0,\n            \n            lastShotTime: 0,\n            weaponCooldowns: new Map(),\n            \n            waypoint: null,\n            patrolCenter: { ...position },\n            patrolRadius: 500,\n            \n            isAlive: true,\n            lastDamageTime: 0\n        };\n        \n        // Add weapons to weapon system\n        config.weapons.forEach(weapon => {\n            const weaponId = `${config.id}_${weapon.id}`;\n            this.weaponSystem.addWeapon({\n                ...weapon,\n                id: weaponId\n            });\n        });\n        \n        // Add as target to weapon system\n        this.weaponSystem.updateTarget(config.id, position, { x: 0, y: 0 }, config.size);\n        \n        this.enemies.set(config.id, enemy);\n        this.events.onEnemySpawned?.(enemy);\n        \n        this.logger.info(`🛸 Spawned ${config.shipClass} \"${config.name}\"`, {\n            faction: config.faction,\n            behavior: config.behavior,\n            position\n        });\n        \n        return config.id;\n    }\n\n    /**\n     * Update player information for AI targeting\n     */\n    updatePlayer(position: Vector2, velocity: Vector2, size: number): void {\n        this.playerPosition = { ...position };\n        this.playerVelocity = { ...velocity };\n        this.playerSize = size;\n        \n        // Update player as target in weapon system\n        this.weaponSystem.updateTarget('player', position, velocity, size);\n    }\n\n    /**\n     * Update AI system\n     */\n    update(deltaTime: number): void {\n        for (const enemy of this.enemies.values()) {\n            if (enemy.isAlive) {\n                this.updateEnemy(enemy, deltaTime);\n            }\n        }\n        \n        this.cleanupDeadEnemies();\n    }\n\n    /**\n     * Update individual enemy\n     */\n    private updateEnemy(enemy: EnemyShip, deltaTime: number): void {\n        const currentTime = Date.now() / 1000;\n        \n        // Update timers\n        enemy.stateTimer += deltaTime;\n        \n        // AI decision making (based on reaction time)\n        if (currentTime - enemy.lastDecisionTime >= enemy.config.reactionTime) {\n            this.makeDecision(enemy);\n            enemy.lastDecisionTime = currentTime;\n        }\n        \n        // Execute current state\n        this.executeState(enemy, deltaTime);\n        \n        // Update movement\n        this.updateMovement(enemy, deltaTime);\n        \n        // Update weapon targeting and firing\n        this.updateCombat(enemy, deltaTime);\n        \n        // Update weapon system target\n        this.weaponSystem.updateTarget(enemy.config.id, enemy.position, enemy.velocity, enemy.config.size);\n    }\n\n    /**\n     * AI decision making\n     */\n    private makeDecision(enemy: EnemyShip): void {\n        const distanceToPlayer = this.calculateDistance(enemy.position, this.playerPosition);\n        const inRange = distanceToPlayer <= enemy.config.engagementRange;\n        const hasLineOfSight = this.hasLineOfSight(enemy.position, this.playerPosition);\n        \n        let newState = enemy.state;\n        \n        switch (enemy.config.behavior) {\n            case AIBehavior.Aggressive:\n                if (inRange && hasLineOfSight) {\n                    newState = AIState.Attack;\n                } else if (distanceToPlayer < enemy.config.engagementRange * 2) {\n                    newState = AIState.Pursue;\n                } else {\n                    newState = AIState.Patrol;\n                }\n                break;\n                \n            case AIBehavior.Defensive:\n                if (inRange && hasLineOfSight && enemy.lastDamageTime > Date.now() / 1000 - 5) {\n                    newState = AIState.Attack;\n                } else if (distanceToPlayer < enemy.config.engagementRange) {\n                    newState = AIState.Guard;\n                } else {\n                    newState = AIState.Patrol;\n                }\n                break;\n                \n            case AIBehavior.Evasive:\n                if (enemy.config.hull < enemy.config.maxHull * 0.3) {\n                    newState = AIState.Retreat;\n                } else if (inRange) {\n                    newState = AIState.Evade;\n                } else {\n                    newState = AIState.Patrol;\n                }\n                break;\n                \n            case AIBehavior.Sniper:\n                if (distanceToPlayer <= enemy.config.preferredRange && hasLineOfSight) {\n                    newState = AIState.Attack;\n                } else if (distanceToPlayer < enemy.config.preferredRange) {\n                    newState = AIState.Retreat; // Back up to preferred range\n                } else {\n                    newState = AIState.Pursue;\n                }\n                break;\n                \n            case AIBehavior.Kamikaze:\n                if (distanceToPlayer < 100) {\n                    newState = AIState.Ramming;\n                } else {\n                    newState = AIState.Pursue;\n                }\n                break;\n                \n            default:\n                newState = AIState.Patrol;\n        }\n        \n        if (newState !== enemy.state) {\n            this.changeState(enemy, newState);\n        }\n    }\n\n    /**\n     * Change enemy AI state\n     */\n    private changeState(enemy: EnemyShip, newState: AIState): void {\n        const oldState = enemy.state;\n        enemy.state = newState;\n        enemy.stateTimer = 0;\n        \n        // State entry logic\n        switch (newState) {\n            case AIState.Patrol:\n                enemy.waypoint = this.generatePatrolWaypoint(enemy);\n                break;\n                \n            case AIState.Pursue:\n                enemy.currentTarget = 'player';\n                break;\n                \n            case AIState.Attack:\n                enemy.currentTarget = 'player';\n                break;\n                \n            case AIState.CircleStrafe:\n                enemy.currentTarget = 'player';\n                break;\n                \n            case AIState.Retreat:\n                enemy.waypoint = this.generateRetreatWaypoint(enemy);\n                break;\n        }\n        \n        this.events.onEnemyStateChanged?.(enemy, oldState, newState);\n        \n        this.logger.debug(`🤖 ${enemy.config.name} state: ${oldState} → ${newState}`);\n    }\n\n    /**\n     * Execute current AI state\n     */\n    private executeState(enemy: EnemyShip, deltaTime: number): void {\n        switch (enemy.state) {\n            case AIState.Idle:\n                // Do nothing, maybe rotate slowly\n                break;\n                \n            case AIState.Patrol:\n                this.executePatrol(enemy, deltaTime);\n                break;\n                \n            case AIState.Pursue:\n                this.executePursue(enemy, deltaTime);\n                break;\n                \n            case AIState.Attack:\n                this.executeAttack(enemy, deltaTime);\n                break;\n                \n            case AIState.Evade:\n                this.executeEvade(enemy, deltaTime);\n                break;\n                \n            case AIState.Retreat:\n                this.executeRetreat(enemy, deltaTime);\n                break;\n                \n            case AIState.CircleStrafe:\n                this.executeCircleStrafe(enemy, deltaTime);\n                break;\n                \n            case AIState.Ramming:\n                this.executeRamming(enemy, deltaTime);\n                break;\n        }\n    }\n\n    /**\n     * Execute patrol behavior\n     */\n    private executePatrol(enemy: EnemyShip, deltaTime: number): void {\n        if (!enemy.waypoint || this.calculateDistance(enemy.position, enemy.waypoint) < 50) {\n            enemy.waypoint = this.generatePatrolWaypoint(enemy);\n        }\n        \n        this.moveToward(enemy, enemy.waypoint, 0.5); // Half speed for patrol\n    }\n\n    /**\n     * Execute pursue behavior\n     */\n    private executePursue(enemy: EnemyShip, deltaTime: number): void {\n        const predictedPlayerPos = this.predictPlayerPosition(0.5);\n        this.moveToward(enemy, predictedPlayerPos, 1.0);\n    }\n\n    /**\n     * Execute attack behavior\n     */\n    private executeAttack(enemy: EnemyShip, deltaTime: number): void {\n        const distanceToPlayer = this.calculateDistance(enemy.position, this.playerPosition);\n        \n        if (distanceToPlayer > enemy.config.preferredRange * 1.2) {\n            // Too far, move closer\n            this.moveToward(enemy, this.playerPosition, 1.0);\n        } else if (distanceToPlayer < enemy.config.preferredRange * 0.8) {\n            // Too close, back away\n            const retreatPoint = this.calculateRetreatPoint(enemy.position, this.playerPosition);\n            this.moveToward(enemy, retreatPoint, 0.8);\n        } else {\n            // Good range, circle strafe\n            this.executeCircleStrafe(enemy, deltaTime);\n        }\n    }\n\n    /**\n     * Execute evade behavior\n     */\n    private executeEvade(enemy: EnemyShip, deltaTime: number): void {\n        const evasionPoint = this.calculateEvasionPoint(enemy);\n        this.moveToward(enemy, evasionPoint, 1.2); // Slightly faster for evasion\n    }\n\n    /**\n     * Execute retreat behavior\n     */\n    private executeRetreat(enemy: EnemyShip, deltaTime: number): void {\n        if (!enemy.waypoint) {\n            enemy.waypoint = this.generateRetreatWaypoint(enemy);\n        }\n        \n        this.moveToward(enemy, enemy.waypoint, 1.5); // Faster retreat\n    }\n\n    /**\n     * Execute circle strafe behavior\n     */\n    private executeCircleStrafe(enemy: EnemyShip, deltaTime: number): void {\n        const toPlayer = {\n            x: this.playerPosition.x - enemy.position.x,\n            y: this.playerPosition.y - enemy.position.y\n        };\n        \n        const distance = Math.sqrt(toPlayer.x * toPlayer.x + toPlayer.y * toPlayer.y);\n        if (distance === 0) return;\n        \n        // Normalize\n        toPlayer.x /= distance;\n        toPlayer.y /= distance;\n        \n        // Calculate perpendicular direction for strafing\n        const strafeDirection = {\n            x: -toPlayer.y, // Perpendicular\n            y: toPlayer.x\n        };\n        \n        // Random direction change\n        if (Math.random() < 0.1) {\n            strafeDirection.x *= -1;\n            strafeDirection.y *= -1;\n        }\n        \n        // Move in strafe direction\n        const targetPoint = {\n            x: enemy.position.x + strafeDirection.x * 200,\n            y: enemy.position.y + strafeDirection.y * 200\n        };\n        \n        this.moveToward(enemy, targetPoint, 0.8);\n    }\n\n    /**\n     * Execute ramming behavior\n     */\n    private executeRamming(enemy: EnemyShip, deltaTime: number): void {\n        // Full speed toward player\n        this.moveToward(enemy, this.playerPosition, 2.0); // Maximum speed\n    }\n\n    /**\n     * Move enemy toward target position\n     */\n    private moveToward(enemy: EnemyShip, target: Vector2, speedMultiplier: number): void {\n        const direction = {\n            x: target.x - enemy.position.x,\n            y: target.y - enemy.position.y\n        };\n        \n        const distance = Math.sqrt(direction.x * direction.x + direction.y * direction.y);\n        if (distance === 0) return;\n        \n        // Normalize\n        direction.x /= distance;\n        direction.y /= distance;\n        \n        // Apply desired velocity\n        const desiredSpeed = enemy.config.maxSpeed * speedMultiplier;\n        const desiredVelocity = {\n            x: direction.x * desiredSpeed,\n            y: direction.y * desiredSpeed\n        };\n        \n        // Smooth acceleration\n        const acceleration = enemy.config.acceleration;\n        enemy.velocity.x += (desiredVelocity.x - enemy.velocity.x) * acceleration * 0.016; // Assume 60fps\n        enemy.velocity.y += (desiredVelocity.y - enemy.velocity.y) * acceleration * 0.016;\n        \n        // Update rotation to face movement direction\n        const targetRotation = Math.atan2(direction.y, direction.x);\n        enemy.rotation = this.lerpAngle(enemy.rotation, targetRotation, enemy.config.turnRate * 0.016);\n    }\n\n    /**\n     * Update enemy movement\n     */\n    private updateMovement(enemy: EnemyShip, deltaTime: number): void {\n        // Apply velocity\n        enemy.position.x += enemy.velocity.x * deltaTime;\n        enemy.position.y += enemy.velocity.y * deltaTime;\n        \n        // Apply drag\n        const drag = 0.95;\n        enemy.velocity.x *= drag;\n        enemy.velocity.y *= drag;\n    }\n\n    /**\n     * Update combat behavior\n     */\n    private updateCombat(enemy: EnemyShip, deltaTime: number): void {\n        if (!enemy.currentTarget) return;\n        \n        const currentTime = Date.now() / 1000;\n        const target = enemy.currentTarget === 'player' ? this.playerPosition : null;\n        \n        if (!target) return;\n        \n        const distance = this.calculateDistance(enemy.position, target);\n        const inRange = distance <= enemy.config.engagementRange;\n        const hasLineOfSight = this.hasLineOfSight(enemy.position, target);\n        \n        if (inRange && hasLineOfSight) {\n            // Try to fire weapons\n            for (const weaponConfig of enemy.config.weapons) {\n                const weaponId = `${enemy.config.id}_${weaponConfig.id}`;\n                const cooldownKey = weaponId;\n                const lastFired = enemy.weaponCooldowns.get(cooldownKey) || 0;\n                \n                // Check if weapon can fire based on fire rate\n                const fireRate = weaponConfig.stats.fireRate;\n                const timeSinceLastShot = currentTime - lastFired;\n                \n                if (timeSinceLastShot >= 1 / fireRate) {\n                    // Apply accuracy\n                    const accuracy = enemy.config.accuracy * enemy.config.intelligence;\n                    const shouldFire = Math.random() < accuracy;\n                    \n                    if (shouldFire) {\n                        const fired = this.weaponSystem.fireWeapon(\n                            weaponId,\n                            enemy.position,\n                            this.predictPlayerPosition(distance / 600) // Predict based on projectile travel time\n                        );\n                        \n                        if (fired) {\n                            enemy.weaponCooldowns.set(cooldownKey, currentTime);\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Apply damage to enemy\n     */\n    applyDamage(enemyId: string, damage: number, damageType: string): boolean {\n        const enemy = this.enemies.get(enemyId);\n        if (!enemy || !enemy.isAlive) return false;\n        \n        // Apply armor reduction\n        let finalDamage = damage;\n        if (enemy.config.armor > 0) {\n            finalDamage = Math.max(1, damage - enemy.config.armor * 0.1);\n        }\n        \n        // Apply to shields first\n        if (enemy.config.shields > 0) {\n            const shieldDamage = Math.min(finalDamage, enemy.config.shields);\n            enemy.config.shields -= shieldDamage;\n            finalDamage -= shieldDamage;\n        }\n        \n        // Apply remaining damage to hull\n        if (finalDamage > 0) {\n            enemy.config.hull -= finalDamage;\n        }\n        \n        enemy.lastDamageTime = Date.now() / 1000;\n        \n        this.events.onEnemyDamaged?.(enemy, damage);\n        \n        // Check if destroyed\n        if (enemy.config.hull <= 0) {\n            this.destroyEnemy(enemyId);\n            return true;\n        }\n        \n        return false;\n    }\n\n    /**\n     * Destroy enemy\n     */\n    private destroyEnemy(enemyId: string): void {\n        const enemy = this.enemies.get(enemyId);\n        if (!enemy) return;\n        \n        enemy.isAlive = false;\n        \n        // Remove weapons\n        enemy.config.weapons.forEach(weapon => {\n            this.weaponSystem.removeWeapon(`${enemyId}_${weapon.id}`);\n        });\n        \n        // Remove from weapon system targets\n        this.weaponSystem.removeTarget(enemyId);\n        \n        this.events.onEnemyDestroyed?.(enemy);\n        \n        this.logger.info(`💥 Destroyed ${enemy.config.name}`);\n    }\n\n    /**\n     * Clean up dead enemies\n     */\n    private cleanupDeadEnemies(): void {\n        for (const [enemyId, enemy] of this.enemies.entries()) {\n            if (!enemy.isAlive) {\n                this.enemies.delete(enemyId);\n            }\n        }\n    }\n\n    /**\n     * Helper methods\n     */\n    \n    private generatePatrolWaypoint(enemy: EnemyShip): Vector2 {\n        const angle = Math.random() * Math.PI * 2;\n        const radius = enemy.patrolRadius * (0.5 + Math.random() * 0.5);\n        \n        return {\n            x: enemy.patrolCenter.x + Math.cos(angle) * radius,\n            y: enemy.patrolCenter.y + Math.sin(angle) * radius\n        };\n    }\n\n    private generateRetreatWaypoint(enemy: EnemyShip): Vector2 {\n        const awayFromPlayer = {\n            x: enemy.position.x - this.playerPosition.x,\n            y: enemy.position.y - this.playerPosition.y\n        };\n        \n        const distance = Math.sqrt(awayFromPlayer.x * awayFromPlayer.x + awayFromPlayer.y * awayFromPlayer.y);\n        if (distance === 0) {\n            return { x: enemy.position.x + 500, y: enemy.position.y };\n        }\n        \n        awayFromPlayer.x /= distance;\n        awayFromPlayer.y /= distance;\n        \n        return {\n            x: enemy.position.x + awayFromPlayer.x * 800,\n            y: enemy.position.y + awayFromPlayer.y * 800\n        };\n    }\n\n    private calculateRetreatPoint(from: Vector2, away: Vector2): Vector2 {\n        const direction = {\n            x: from.x - away.x,\n            y: from.y - away.y\n        };\n        \n        const distance = Math.sqrt(direction.x * direction.x + direction.y * direction.y);\n        if (distance === 0) return from;\n        \n        direction.x /= distance;\n        direction.y /= distance;\n        \n        return {\n            x: from.x + direction.x * 200,\n            y: from.y + direction.y * 200\n        };\n    }\n\n    private calculateEvasionPoint(enemy: EnemyShip): Vector2 {\n        // Move perpendicular to player direction\n        const toPlayer = {\n            x: this.playerPosition.x - enemy.position.x,\n            y: this.playerPosition.y - enemy.position.y\n        };\n        \n        const distance = Math.sqrt(toPlayer.x * toPlayer.x + toPlayer.y * toPlayer.y);\n        if (distance === 0) return enemy.position;\n        \n        // Perpendicular direction\n        const perpendicular = {\n            x: -toPlayer.y / distance,\n            y: toPlayer.x / distance\n        };\n        \n        // Random side\n        if (Math.random() < 0.5) {\n            perpendicular.x *= -1;\n            perpendicular.y *= -1;\n        }\n        \n        return {\n            x: enemy.position.x + perpendicular.x * 300,\n            y: enemy.position.y + perpendicular.y * 300\n        };\n    }\n\n    private predictPlayerPosition(seconds: number): Vector2 {\n        return {\n            x: this.playerPosition.x + this.playerVelocity.x * seconds,\n            y: this.playerPosition.y + this.playerVelocity.y * seconds\n        };\n    }\n\n    private hasLineOfSight(from: Vector2, to: Vector2): boolean {\n        // Simplified - assume always true for now\n        // In a real implementation, this would check for obstacles\n        return true;\n    }\n\n    private calculateDistance(pos1: Vector2, pos2: Vector2): number {\n        const dx = pos1.x - pos2.x;\n        const dy = pos1.y - pos2.y;\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    private lerpAngle(from: number, to: number, factor: number): number {\n        let diff = to - from;\n        \n        // Wrap difference to [-π, π]\n        while (diff > Math.PI) diff -= Math.PI * 2;\n        while (diff < -Math.PI) diff += Math.PI * 2;\n        \n        return from + diff * factor;\n    }\n\n    /**\n     * Render enemies\n     */\n    render(renderer: Renderer): void {\n        for (const enemy of this.enemies.values()) {\n            if (enemy.isAlive) {\n                this.renderEnemy(renderer, enemy);\n            }\n        }\n    }\n\n    /**\n     * Render individual enemy\n     */\n    private renderEnemy(renderer: Renderer, enemy: EnemyShip): void {\n        const pos = enemy.position;\n        const size = enemy.config.size;\n        \n        // Get ship color based on faction and class\n        const color = this.getShipColor(enemy.config.faction, enemy.config.shipClass);\n        \n        // Draw ship body\n        if (enemy.config.shipClass === ShipClass.Drone) {\n            // Small triangle for drones\n            const points = this.getTrianglePoints(pos, size * 0.5, enemy.rotation);\n            this.drawTriangle(renderer, points, color);\n        } else {\n            // Larger ships as rectangles with details\n            this.drawShip(renderer, pos, size, enemy.rotation, color);\n        }\n        \n        // Draw health bar\n        this.drawHealthBar(renderer, enemy);\n        \n        // Draw AI state indicator (debug)\n        if (enemy.state !== AIState.Idle) {\n            this.drawStateIndicator(renderer, enemy);\n        }\n    }\n\n    private getShipColor(faction: string, shipClass: ShipClass): Color {\n        const factionColors: { [key: string]: Color } = {\n            pirates: { r: 72, g: 24, b: 24 },     // Dark red\n            aliens: { r: 48, g: 24, b: 72 },      // Dark purple\n            rebels: { r: 24, g: 48, b: 24 },      // Dark green\n            corporation: { r: 48, g: 48, b: 32 }, // Dark yellow\n            military: { r: 32, g: 32, b: 48 }     // Dark blue\n        };\n        \n        return factionColors[faction] || { r: 48, g: 48, b: 48 };\n    }\n\n    private getTrianglePoints(center: Vector2, size: number, rotation: number): Vector2[] {\n        const cos = Math.cos(rotation);\n        const sin = Math.sin(rotation);\n        \n        return [\n            {\n                x: center.x + cos * size,\n                y: center.y + sin * size\n            },\n            {\n                x: center.x + cos * (-size * 0.5) - sin * (size * 0.5),\n                y: center.y + sin * (-size * 0.5) + cos * (size * 0.5)\n            },\n            {\n                x: center.x + cos * (-size * 0.5) - sin * (-size * 0.5),\n                y: center.y + sin * (-size * 0.5) + cos * (-size * 0.5)\n            }\n        ];\n    }\n\n    private drawTriangle(renderer: Renderer, points: Vector2[], color: Color): void {\n        // Draw triangle outline\n        for (let i = 0; i < points.length; i++) {\n            const next = (i + 1) % points.length;\n            renderer.drawLine(points[i].x, points[i].y, points[next].x, points[next].y, color);\n        }\n    }\n\n    private drawShip(renderer: Renderer, pos: Vector2, size: number, rotation: number, color: Color): void {\n        // Simple ship representation as oriented rectangle\n        const cos = Math.cos(rotation);\n        const sin = Math.sin(rotation);\n        \n        const halfWidth = size * 0.3;\n        const halfHeight = size * 0.6;\n        \n        const corners = [\n            { x: pos.x + cos * halfHeight - sin * halfWidth, y: pos.y + sin * halfHeight + cos * halfWidth },\n            { x: pos.x + cos * halfHeight - sin * (-halfWidth), y: pos.y + sin * halfHeight + cos * (-halfWidth) },\n            { x: pos.x + cos * (-halfHeight) - sin * (-halfWidth), y: pos.y + sin * (-halfHeight) + cos * (-halfWidth) },\n            { x: pos.x + cos * (-halfHeight) - sin * halfWidth, y: pos.y + sin * (-halfHeight) + cos * halfWidth }\n        ];\n        \n        // Draw ship outline\n        for (let i = 0; i < corners.length; i++) {\n            const next = (i + 1) % corners.length;\n            renderer.drawLine(corners[i].x, corners[i].y, corners[next].x, corners[next].y, color);\n        }\n        \n        // Draw front indicator\n        const frontX = pos.x + cos * halfHeight;\n        const frontY = pos.y + sin * halfHeight;\n        renderer.fillRect(frontX - 1, frontY - 1, 2, 2, color);\n    }\n\n    private drawHealthBar(renderer: Renderer, enemy: EnemyShip): void {\n        const pos = enemy.position;\n        const size = enemy.config.size;\n        \n        const barWidth = size * 1.2;\n        const barHeight = 3;\n        const barY = pos.y - size * 0.8;\n        \n        // Background\n        renderer.fillRect(pos.x - barWidth/2, barY, barWidth, barHeight, { r: 16, g: 16, b: 16 });\n        \n        // Health\n        const healthPercent = enemy.config.hull / enemy.config.maxHull;\n        const healthWidth = barWidth * healthPercent;\n        const healthColor = healthPercent > 0.6 ? \n            { r: 12, g: 36, b: 12 } : \n            healthPercent > 0.3 ? \n                { r: 72, g: 48, b: 12 } : \n                { r: 72, g: 24, b: 24 };\n        \n        renderer.fillRect(pos.x - barWidth/2, barY, healthWidth, barHeight, healthColor);\n        \n        // Shields (if any)\n        if (enemy.config.maxShields > 0) {\n            const shieldPercent = enemy.config.shields / enemy.config.maxShields;\n            const shieldWidth = barWidth * shieldPercent;\n            renderer.fillRect(pos.x - barWidth/2, barY - 5, shieldWidth, 2, { r: 16, g: 40, b: 32 });\n        }\n    }\n\n    private drawStateIndicator(renderer: Renderer, enemy: EnemyShip): void {\n        const pos = enemy.position;\n        const stateColors: { [key: string]: Color } = {\n            [AIState.Patrol]: { r: 32, g: 32, b: 32 },\n            [AIState.Pursue]: { r: 72, g: 48, b: 12 },\n            [AIState.Attack]: { r: 72, g: 24, b: 24 },\n            [AIState.Evade]: { r: 12, g: 36, b: 12 },\n            [AIState.Retreat]: { r: 48, g: 32, b: 72 },\n            [AIState.Ramming]: { r: 96, g: 32, b: 32 }\n        };\n        \n        const color = stateColors[enemy.state] || { r: 48, g: 48, b: 48 };\n        renderer.fillRect(pos.x - 3, pos.y + enemy.config.size + 5, 6, 6, color);\n    }\n\n    /**\n     * Get all enemies\n     */\n    getAllEnemies(): EnemyShip[] {\n        return Array.from(this.enemies.values()).filter(e => e.isAlive);\n    }\n\n    /**\n     * Get enemy by ID\n     */\n    getEnemy(enemyId: string): EnemyShip | null {\n        return this.enemies.get(enemyId) || null;\n    }\n\n    /**\n     * Get AI statistics\n     */\n    getStats(): {\n        totalEnemies: number;\n        aliveEnemies: number;\n        enemiesByFaction: { [faction: string]: number };\n        enemiesByState: { [state: string]: number };\n    } {\n        const enemiesByFaction: { [faction: string]: number } = {};\n        const enemiesByState: { [state: string]: number } = {};\n        \n        let aliveCount = 0;\n        \n        for (const enemy of this.enemies.values()) {\n            if (enemy.isAlive) {\n                aliveCount++;\n                enemiesByFaction[enemy.config.faction] = (enemiesByFaction[enemy.config.faction] || 0) + 1;\n                enemiesByState[enemy.state] = (enemiesByState[enemy.state] || 0) + 1;\n            }\n        }\n        \n        return {\n            totalEnemies: this.enemies.size,\n            aliveEnemies: aliveCount,\n            enemiesByFaction,\n            enemiesByState\n        };\n    }\n\n    /**\n     * Clear all enemies\n     */\n    clearEnemies(): void {\n        for (const [enemyId] of this.enemies.entries()) {\n            this.destroyEnemy(enemyId);\n        }\n        this.enemies.clear();\n    }\n}","/**\n * Combat Manager\n * Coordinates weapon systems, enemy AI, and combat encounters\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer } from '@core/Renderer';\nimport { WeaponSystem, WeaponConfig, WeaponType, DamageType, DamageResult } from './WeaponSystem';\nimport { EnemyAI, EnemyShipConfig, ShipClass, AIBehavior } from './EnemyAI';\nimport { GameItem, ItemDatabase } from '@items/ItemSystem';\nimport { InventoryManager } from '@inventory/InventoryManager';\n\nexport interface CombatEncounter {\n    id: string;\n    name: string;\n    difficulty: number; // 1-10\n    enemyConfigs: EnemyShipConfig[];\n    spawnPositions: Vector2[];\n    rewards: {\n        experience: number;\n        credits: number;\n        items: { itemId: string, quantity: number, dropRate: number }[];\n    };\n    isActive: boolean;\n    startTime: number;\n    completionTime?: number;\n}\n\nexport interface CombatStats {\n    totalDamageDealt: number;\n    totalDamageReceived: number;\n    enemiesDestroyed: number;\n    shotsHit: number;\n    shotsFired: number;\n    encountersCompleted: number;\n    experienceGained: number;\n}\n\nexport interface CombatEvents {\n    onEncounterStarted?: (encounter: CombatEncounter) => void;\n    onEncounterCompleted?: (encounter: CombatEncounter, success: boolean) => void;\n    onEnemyDestroyed?: (enemyId: string, rewards: { items: GameItem[], experience: number }) => void;\n    onPlayerDamaged?: (damage: number, damageType: DamageType) => void;\n    onCombatStatsUpdated?: (stats: CombatStats) => void;\n}\n\nexport class CombatManager {\n    private weaponSystem: WeaponSystem;\n    private enemyAI: EnemyAI;\n    private itemDatabase: ItemDatabase;\n    private inventory: InventoryManager;\n    \n    // Combat state\n    private activeEncounters: Map<string, CombatEncounter> = new Map();\n    private combatStats: CombatStats = {\n        totalDamageDealt: 0,\n        totalDamageReceived: 0,\n        enemiesDestroyed: 0,\n        shotsHit: 0,\n        shotsFired: 0,\n        encountersCompleted: 0,\n        experienceGained: 0\n    };\n    \n    // Player ship reference\n    private playerPosition: Vector2 = { x: 0, y: 0 };\n    private playerVelocity: Vector2 = { x: 0, y: 0 };\n    private playerSize: number = 20;\n    private playerHull: number = 100;\n    private playerMaxHull: number = 100;\n    \n    private events: CombatEvents;\n    private logger: Logger;\n\n    constructor(\n        itemDatabase: ItemDatabase,\n        inventory: InventoryManager,\n        events: CombatEvents = {}\n    ) {\n        this.logger = new Logger('CombatManager');\n        this.itemDatabase = itemDatabase;\n        this.inventory = inventory;\n        this.events = events;\n        \n        // Initialize weapon system\n        this.weaponSystem = new WeaponSystem({\n            onWeaponFired: (weapon, projectile) => {\n                this.combatStats.shotsFired++;\n                this.logger.debug(`🔫 ${weapon.name} fired`);\n            },\n            onProjectileHit: (projectile, result) => {\n                this.handleProjectileHit(projectile, result);\n            },\n            onWeaponOverheat: (weapon) => {\n                this.logger.warn(`🔥 ${weapon.name} overheated`);\n            }\n        });\n        \n        // Initialize enemy AI\n        this.enemyAI = new EnemyAI(this.weaponSystem, {\n            onEnemySpawned: (enemy) => {\n                this.logger.info(`🛸 Enemy spawned: ${enemy.config.name}`);\n            },\n            onEnemyDestroyed: (enemy) => {\n                this.handleEnemyDestroyed(enemy);\n            },\n            onEnemyDamaged: (enemy, damage) => {\n                this.logger.debug(`💥 ${enemy.config.name} took ${damage} damage`);\n            }\n        });\n        \n        this.initializePlayerWeapons();\n        \n        this.logger.info('⚔️ Combat manager initialized');\n    }\n\n    /**\n     * Initialize player weapons\n     */\n    private initializePlayerWeapons(): void {\n        // Add basic player weapons\n        const basicLaser: WeaponConfig = {\n            id: 'player_laser_1',\n            name: 'Basic Laser Cannon',\n            type: WeaponType.Energy,\n            damageType: DamageType.Energy,\n            stats: {\n                damage: 25,\n                range: 400,\n                fireRate: 3, // 3 shots per second\n                energyCost: 5,\n                accuracy: 0.9,\n                penetration: 0.1,\n                spread: 2, // 2 degrees\n                chargeTime: 0,\n                cooldownTime: 2\n            },\n            mountPoint: { x: 0, y: -10 },\n            hardpointSize: 'small'\n        };\n        \n        const basicProjectile: WeaponConfig = {\n            id: 'player_cannon_1',\n            name: 'Mass Driver',\n            type: WeaponType.Projectile,\n            damageType: DamageType.Kinetic,\n            stats: {\n                damage: 40,\n                range: 500,\n                fireRate: 2,\n                energyCost: 0,\n                accuracy: 0.8,\n                penetration: 0.3,\n                spread: 1,\n                chargeTime: 0,\n                cooldownTime: 1,\n                ammoCapacity: 100,\n                reloadTime: 3\n            },\n            mountPoint: { x: 0, y: 10 },\n            hardpointSize: 'small'\n        };\n        \n        this.weaponSystem.addWeapon(basicLaser);\n        this.weaponSystem.addWeapon(basicProjectile);\n        \n        this.logger.info('🔫 Player weapons initialized', {\n            laser: basicLaser.name,\n            cannon: basicProjectile.name\n        });\n    }\n\n    /**\n     * Handle projectile hit\n     */\n    private handleProjectileHit(projectile: any, result: DamageResult): void {\n        this.combatStats.shotsHit++;\n        \n        if (result.targetId === 'player') {\n            // Player took damage\n            this.playerHull = Math.max(0, this.playerHull - result.damage);\n            this.combatStats.totalDamageReceived += result.damage;\n            \n            this.events.onPlayerDamaged?.(result.damage, result.damageType);\n            \n            this.logger.info(`💥 Player hit for ${result.damage} ${result.damageType} damage`, {\n                critical: result.criticalHit,\n                penetrated: result.penetrated,\n                hullRemaining: this.playerHull\n            });\n        } else {\n            // Enemy took damage\n            const destroyed = this.enemyAI.applyDamage(result.targetId, result.damage, result.damageType);\n            this.combatStats.totalDamageDealt += result.damage;\n            \n            if (destroyed) {\n                this.combatStats.enemiesDestroyed++;\n            }\n        }\n        \n        this.events.onCombatStatsUpdated?.(this.combatStats);\n    }\n\n    /**\n     * Handle enemy destroyed\n     */\n    private handleEnemyDestroyed(enemy: any): void {\n        const rewards = this.calculateRewards(enemy.config);\n        \n        // Add items to inventory\n        rewards.items.forEach(item => {\n            this.inventory.addItem(item, 1);\n        });\n        \n        // Add experience\n        this.combatStats.experienceGained += rewards.experience;\n        \n        this.events.onEnemyDestroyed?.(enemy.config.id, rewards);\n        \n        // Check if any encounters are completed\n        this.checkEncounterCompletion();\n        \n        this.logger.info(`💰 Enemy destroyed rewards`, {\n            enemy: enemy.config.name,\n            items: rewards.items.length,\n            experience: rewards.experience\n        });\n    }\n\n    /**\n     * Calculate rewards for destroyed enemy\n     */\n    private calculateRewards(enemyConfig: any): { items: GameItem[], experience: number } {\n        const items: GameItem[] = [];\n        let experience = 0;\n        \n        // Base experience based on ship class\n        const baseExperience: { [key: string]: number } = {\n            [ShipClass.Drone]: 5,\n            [ShipClass.Fighter]: 15,\n            [ShipClass.Corvette]: 30,\n            [ShipClass.Frigate]: 50,\n            [ShipClass.Destroyer]: 100,\n            [ShipClass.Cruiser]: 200,\n            [ShipClass.Battleship]: 500\n        };\n        \n        experience = baseExperience[enemyConfig.shipClass] || 10;\n        \n        // Random item drops\n        const dropChance = 0.3; // 30% chance for item drop\n        if (Math.random() < dropChance) {\n            const randomItem = this.itemDatabase.generateRandomItem();\n            if (randomItem) {\n                items.push(randomItem);\n            }\n        }\n        \n        // Specific loot based on faction\n        const factionLoot: { [faction: string]: string[] } = {\n            pirates: ['metal_iron', 'gas_hydrogen'],\n            aliens: ['crystal_dilithium', 'energy_antimatter'],\n            military: ['comp_circuit', 'tool_repair_kit'],\n            corporation: ['crystal_quartz', 'comp_shield_emitter']\n        };\n        \n        const possibleLoot = factionLoot[enemyConfig.faction] || [];\n        if (possibleLoot.length > 0 && Math.random() < 0.4) {\n            const lootId = possibleLoot[Math.floor(Math.random() * possibleLoot.length)];\n            const lootItem = this.itemDatabase.getItem(lootId);\n            if (lootItem) {\n                items.push(lootItem);\n            }\n        }\n        \n        return { items, experience };\n    }\n\n    /**\n     * Start combat encounter\n     */\n    startEncounter(encounter: CombatEncounter): void {\n        encounter.isActive = true;\n        encounter.startTime = Date.now();\n        \n        // Spawn enemies\n        encounter.enemyConfigs.forEach((config, index) => {\n            const spawnPos = encounter.spawnPositions[index] || { x: 800, y: 400 };\n            this.enemyAI.spawnEnemy(config, spawnPos);\n        });\n        \n        this.activeEncounters.set(encounter.id, encounter);\n        this.events.onEncounterStarted?.(encounter);\n        \n        this.logger.info(`🚨 Combat encounter started: ${encounter.name}`, {\n            difficulty: encounter.difficulty,\n            enemies: encounter.enemyConfigs.length\n        });\n    }\n\n    /**\n     * Check if encounters are completed\n     */\n    private checkEncounterCompletion(): void {\n        for (const [encounterId, encounter] of this.activeEncounters.entries()) {\n            if (!encounter.isActive) continue;\n            \n            // Check if all enemies from this encounter are destroyed\n            const remainingEnemies = this.enemyAI.getAllEnemies()\n                .filter(enemy => encounter.enemyConfigs.some(config => config.id === enemy.config.id));\n            \n            if (remainingEnemies.length === 0) {\n                // Encounter completed\n                encounter.isActive = false;\n                encounter.completionTime = Date.now();\n                \n                this.combatStats.encountersCompleted++;\n                this.events.onEncounterCompleted?.(encounter, true);\n                \n                this.logger.info(`✅ Encounter completed: ${encounter.name}`, {\n                    duration: (encounter.completionTime - encounter.startTime) / 1000,\n                    rewards: encounter.rewards\n                });\n                \n                this.activeEncounters.delete(encounterId);\n            }\n        }\n    }\n\n    /**\n     * Generate predefined encounters\n     */\n    generateEncounters(): CombatEncounter[] {\n        const encounters: CombatEncounter[] = [];\n        \n        // Pirate patrol\n        encounters.push({\n            id: 'pirate_patrol_1',\n            name: 'Pirate Patrol',\n            difficulty: 2,\n            enemyConfigs: [\n                this.createEnemyConfig('pirate_fighter_1', 'Pirate Fighter', ShipClass.Fighter, 'pirates', AIBehavior.Aggressive),\n                this.createEnemyConfig('pirate_drone_1', 'Pirate Drone', ShipClass.Drone, 'pirates', AIBehavior.Kamikaze)\n            ],\n            spawnPositions: [\n                { x: 700, y: 300 },\n                { x: 750, y: 350 }\n            ],\n            rewards: {\n                experience: 50,\n                credits: 100,\n                items: [\n                    { itemId: 'metal_iron', quantity: 5, dropRate: 0.8 },\n                    { itemId: 'tool_repair_kit', quantity: 1, dropRate: 0.3 }\n                ]\n            },\n            isActive: false,\n            startTime: 0\n        });\n        \n        // Alien scout\n        encounters.push({\n            id: 'alien_scout_1',\n            name: 'Alien Scout',\n            difficulty: 4,\n            enemyConfigs: [\n                this.createEnemyConfig('alien_corvette_1', 'Alien Corvette', ShipClass.Corvette, 'aliens', AIBehavior.Evasive)\n            ],\n            spawnPositions: [\n                { x: 600, y: 200 }\n            ],\n            rewards: {\n                experience: 80,\n                credits: 200,\n                items: [\n                    { itemId: 'crystal_dilithium', quantity: 2, dropRate: 0.6 },\n                    { itemId: 'energy_antimatter', quantity: 1, dropRate: 0.2 }\n                ]\n            },\n            isActive: false,\n            startTime: 0\n        });\n        \n        // Corporate security\n        encounters.push({\n            id: 'corp_security_1',\n            name: 'Corporate Security',\n            difficulty: 3,\n            enemyConfigs: [\n                this.createEnemyConfig('corp_frigate_1', 'Corporate Frigate', ShipClass.Frigate, 'corporation', AIBehavior.Defensive),\n                this.createEnemyConfig('corp_fighter_1', 'Corporate Fighter', ShipClass.Fighter, 'corporation', AIBehavior.Support)\n            ],\n            spawnPositions: [\n                { x: 800, y: 400 },\n                { x: 750, y: 450 }\n            ],\n            rewards: {\n                experience: 120,\n                credits: 300,\n                items: [\n                    { itemId: 'comp_shield_emitter', quantity: 1, dropRate: 0.5 },\n                    { itemId: 'crystal_quartz', quantity: 3, dropRate: 0.7 }\n                ]\n            },\n            isActive: false,\n            startTime: 0\n        });\n        \n        return encounters;\n    }\n\n    /**\n     * Create enemy ship configuration\n     */\n    private createEnemyConfig(\n        id: string,\n        name: string,\n        shipClass: ShipClass,\n        faction: string,\n        behavior: AIBehavior\n    ): EnemyShipConfig {\n        // Base stats by ship class\n        const classStats: { [key: string]: any } = {\n            [ShipClass.Drone]: {\n                size: 8, maxSpeed: 200, hull: 20, weapons: [this.createBasicWeapon('drone_laser', WeaponType.Energy, 15)]\n            },\n            [ShipClass.Fighter]: {\n                size: 15, maxSpeed: 180, hull: 60, weapons: [this.createBasicWeapon('fighter_cannon', WeaponType.Projectile, 25)]\n            },\n            [ShipClass.Corvette]: {\n                size: 20, maxSpeed: 150, hull: 120, weapons: [\n                    this.createBasicWeapon('corvette_laser', WeaponType.Energy, 30),\n                    this.createBasicWeapon('corvette_missiles', WeaponType.Missile, 40)\n                ]\n            },\n            [ShipClass.Frigate]: {\n                size: 25, maxSpeed: 120, hull: 200, weapons: [\n                    this.createBasicWeapon('frigate_plasma', WeaponType.Plasma, 45),\n                    this.createBasicWeapon('frigate_cannon', WeaponType.Projectile, 35)\n                ]\n            }\n        };\n        \n        const stats = classStats[shipClass] || classStats[ShipClass.Fighter];\n        \n        return {\n            id,\n            name,\n            shipClass,\n            faction,\n            \n            size: stats.size,\n            mass: stats.size * 10,\n            maxSpeed: stats.maxSpeed,\n            acceleration: 0.8,\n            turnRate: 2.0,\n            \n            hull: stats.hull,\n            maxHull: stats.hull,\n            shields: shipClass === ShipClass.Drone ? 0 : stats.hull * 0.5,\n            maxShields: shipClass === ShipClass.Drone ? 0 : stats.hull * 0.5,\n            armor: Math.floor(stats.hull * 0.1),\n            \n            behavior,\n            aggression: behavior === AIBehavior.Aggressive ? 0.9 : 0.6,\n            intelligence: 0.7,\n            accuracy: 0.75,\n            reactionTime: 0.5,\n            \n            weapons: stats.weapons,\n            engagementRange: stats.size * 20,\n            preferredRange: stats.size * 15\n        };\n    }\n\n    /**\n     * Create basic weapon configuration\n     */\n    private createBasicWeapon(id: string, type: WeaponType, damage: number): WeaponConfig {\n        const baseStats = {\n            [WeaponType.Energy]: { range: 300, fireRate: 2.5, energyCost: 5 },\n            [WeaponType.Projectile]: { range: 400, fireRate: 2.0, energyCost: 0 },\n            [WeaponType.Missile]: { range: 500, fireRate: 0.5, energyCost: 15 },\n            [WeaponType.Plasma]: { range: 250, fireRate: 1.5, energyCost: 10 },\n            [WeaponType.Beam]: { range: 350, fireRate: 3.0, energyCost: 8 },\n            [WeaponType.Torpedo]: { range: 600, fireRate: 0.3, energyCost: 20 }\n        };\n        \n        const stats = baseStats[type] || baseStats[WeaponType.Energy];\n        \n        return {\n            id,\n            name: `${type} Weapon`,\n            type,\n            damageType: type === WeaponType.Energy ? DamageType.Energy : DamageType.Kinetic,\n            stats: {\n                damage,\n                range: stats.range,\n                fireRate: stats.fireRate,\n                energyCost: stats.energyCost,\n                accuracy: 0.8,\n                penetration: 0.2,\n                spread: 3,\n                chargeTime: 0,\n                cooldownTime: 1\n            },\n            mountPoint: { x: 0, y: 0 },\n            hardpointSize: 'small'\n        };\n    }\n\n    /**\n     * Update combat manager\n     */\n    update(deltaTime: number): void {\n        // Update weapon system\n        this.weaponSystem.update(deltaTime);\n        \n        // Update enemy AI with player position\n        this.enemyAI.updatePlayer(this.playerPosition, this.playerVelocity, this.playerSize);\n        this.enemyAI.update(deltaTime);\n        \n        // Check encounter completion\n        this.checkEncounterCompletion();\n    }\n\n    /**\n     * Update player information\n     */\n    updatePlayer(position: Vector2, velocity: Vector2, size: number, hull: number, maxHull: number): void {\n        this.playerPosition = { ...position };\n        this.playerVelocity = { ...velocity };\n        this.playerSize = size;\n        this.playerHull = hull;\n        this.playerMaxHull = maxHull;\n    }\n\n    /**\n     * Fire player weapon\n     */\n    firePlayerWeapon(weaponId: string, targetPosition?: Vector2): boolean {\n        return this.weaponSystem.fireWeapon(weaponId, this.playerPosition, targetPosition);\n    }\n\n    /**\n     * Render combat effects\n     */\n    render(renderer: Renderer): void {\n        // Render weapon effects (projectiles, etc.)\n        this.weaponSystem.render(renderer);\n        \n        // Render enemies\n        this.enemyAI.render(renderer);\n    }\n\n    /**\n     * Start random encounter\n     */\n    startRandomEncounter(): void {\n        const encounters = this.generateEncounters();\n        if (encounters.length > 0) {\n            const randomIndex = Math.floor(Math.random() * encounters.length);\n            this.startEncounter(encounters[randomIndex]);\n        }\n    }\n\n    /**\n     * Get combat statistics\n     */\n    getCombatStats(): CombatStats {\n        return { ...this.combatStats };\n    }\n\n    /**\n     * Get active encounters\n     */\n    getActiveEncounters(): CombatEncounter[] {\n        return Array.from(this.activeEncounters.values());\n    }\n\n    /**\n     * Get player weapons\n     */\n    getPlayerWeapons(): Array<{ weapon: WeaponConfig; state: any }> {\n        return this.weaponSystem.getAllWeapons().filter(w => w.weapon.id.startsWith('player_'));\n    }\n\n    /**\n     * Get all enemies\n     */\n    getEnemies(): any[] {\n        return this.enemyAI.getAllEnemies();\n    }\n\n    /**\n     * Clear all combat\n     */\n    clearCombat(): void {\n        this.weaponSystem.clearProjectiles();\n        this.enemyAI.clearEnemies();\n        this.activeEncounters.clear();\n        \n        this.logger.info('🧹 Combat cleared');\n    }\n\n    /**\n     * Reset combat stats\n     */\n    resetStats(): void {\n        this.combatStats = {\n            totalDamageDealt: 0,\n            totalDamageReceived: 0,\n            enemiesDestroyed: 0,\n            shotsHit: 0,\n            shotsFired: 0,\n            encountersCompleted: 0,\n            experienceGained: 0\n        };\n        \n        this.events.onCombatStatsUpdated?.(this.combatStats);\n    }\n}","/**\n * Player Progression System\n * Complete RPG progression with levels, skills, attributes, and achievements\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\n\nexport enum SkillCategory {\n    Combat = 'combat',\n    Piloting = 'piloting',\n    Engineering = 'engineering',\n    Science = 'science',\n    Trade = 'trade',\n    Exploration = 'exploration'\n}\n\nexport enum AttributeType {\n    Reflexes = 'reflexes',       // Combat speed, evasion\n    Intelligence = 'intelligence', // Research, hacking\n    Endurance = 'endurance',     // Hull points, fatigue resistance\n    Perception = 'perception',   // Detection, accuracy\n    Charisma = 'charisma',      // Trade, diplomacy\n    Technical = 'technical'      // Engineering, repair efficiency\n}\n\nexport interface Skill {\n    id: string;\n    name: string;\n    category: SkillCategory;\n    level: number;\n    experience: number;\n    maxLevel: number;\n    description: string;\n    prerequisite?: string; // Required skill ID\n    prerequisiteLevel?: number;\n    \n    // Effects\n    bonuses: SkillBonus[];\n}\n\nexport interface SkillBonus {\n    type: 'damage' | 'accuracy' | 'speed' | 'efficiency' | 'cost_reduction' | 'detection' | 'capacity';\n    value: number; // Percentage or flat bonus\n    description: string;\n}\n\nexport interface Attribute {\n    type: AttributeType;\n    value: number;\n    baseValue: number;\n    modifiers: AttributeModifier[];\n}\n\nexport interface AttributeModifier {\n    source: string;\n    value: number;\n    duration: number; // -1 for permanent\n    description: string;\n}\n\nexport interface Achievement {\n    id: string;\n    name: string;\n    description: string;\n    category: string;\n    requirements: AchievementRequirement[];\n    rewards: AchievementReward[];\n    unlocked: boolean;\n    unlockedDate?: number;\n    hidden: boolean; // Don't show until unlocked\n}\n\nexport interface AchievementRequirement {\n    type: 'kill_enemies' | 'travel_distance' | 'earn_credits' | 'discover_systems' | 'craft_items' | 'complete_missions';\n    target: number;\n    current: number;\n    data?: any; // Additional requirement data\n}\n\nexport interface AchievementReward {\n    type: 'experience' | 'credits' | 'skill_points' | 'attribute_points' | 'item';\n    value: number;\n    itemId?: string;\n}\n\nexport interface CharacterSheet {\n    // Basic info\n    name: string;\n    level: number;\n    experience: number;\n    experienceToNext: number;\n    \n    // Points\n    skillPoints: number;\n    attributePoints: number;\n    \n    // Statistics\n    totalPlayTime: number;\n    enemiesDefeated: number;\n    systemsExplored: number;\n    distanceTraveled: number;\n    creditsEarned: number;\n    itemsCrafted: number;\n    \n    // Skills and attributes\n    skills: Map<string, Skill>;\n    attributes: Map<AttributeType, Attribute>;\n    achievements: Map<string, Achievement>;\n}\n\nexport interface ProgressionEvents {\n    onLevelUp?: (newLevel: number, rewards: { skillPoints: number, attributePoints: number }) => void;\n    onSkillLevelUp?: (skill: Skill, newLevel: number) => void;\n    onAchievementUnlocked?: (achievement: Achievement) => void;\n    onAttributeChanged?: (attribute: AttributeType, oldValue: number, newValue: number) => void;\n}\n\nexport class PlayerProgression {\n    private character!: CharacterSheet;\n    private events: ProgressionEvents;\n    \n    // Experience tables\n    private levelExperienceTable: number[] = [];\n    private skillExperienceTable: number[] = [];\n    \n    private logger: Logger;\n\n    constructor(events: ProgressionEvents = {}) {\n        this.logger = new Logger('PlayerProgression');\n        this.events = events;\n        \n        this.generateExperienceTables();\n        this.initializeCharacter();\n        this.initializeSkills();\n        this.initializeAchievements();\n        \n        this.logger.info('🎭 Player progression system initialized');\n    }\n\n    /**\n     * Generate experience tables for levels and skills\n     */\n    private generateExperienceTables(): void {\n        // Level experience: exponential growth\n        for (let level = 1; level <= 100; level++) {\n            const baseXP = 100;\n            const multiplier = Math.pow(1.15, level - 1);\n            this.levelExperienceTable.push(Math.floor(baseXP * multiplier));\n        }\n        \n        // Skill experience: linear with slight exponential\n        for (let level = 1; level <= 50; level++) {\n            const baseXP = 50;\n            const multiplier = Math.pow(1.1, level - 1);\n            this.skillExperienceTable.push(Math.floor(baseXP * multiplier));\n        }\n    }\n\n    /**\n     * Initialize character with default values\n     */\n    private initializeCharacter(): void {\n        this.character = {\n            name: 'Captain',\n            level: 1,\n            experience: 0,\n            experienceToNext: this.levelExperienceTable[1],\n            \n            skillPoints: 5,\n            attributePoints: 10,\n            \n            totalPlayTime: 0,\n            enemiesDefeated: 0,\n            systemsExplored: 0,\n            distanceTraveled: 0,\n            creditsEarned: 0,\n            itemsCrafted: 0,\n            \n            skills: new Map(),\n            attributes: new Map(),\n            achievements: new Map()\n        };\n        \n        // Initialize attributes\n        for (const attrType of Object.values(AttributeType)) {\n            this.character.attributes.set(attrType, {\n                type: attrType,\n                value: 10,\n                baseValue: 10,\n                modifiers: []\n            });\n        }\n    }\n\n    /**\n     * Initialize skill tree\n     */\n    private initializeSkills(): void {\n        const skills: Skill[] = [\n            // Combat Skills\n            {\n                id: 'weapon_proficiency',\n                name: 'Weapon Proficiency',\n                category: SkillCategory.Combat,\n                level: 0,\n                experience: 0,\n                maxLevel: 25,\n                description: 'Increases weapon damage and accuracy',\n                bonuses: [\n                    { type: 'damage', value: 2, description: '+2% weapon damage per level' },\n                    { type: 'accuracy', value: 1, description: '+1% accuracy per level' }\n                ]\n            },\n            {\n                id: 'tactical_combat',\n                name: 'Tactical Combat',\n                category: SkillCategory.Combat,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Reduces weapon heat buildup and cooldowns',\n                prerequisite: 'weapon_proficiency',\n                prerequisiteLevel: 5,\n                bonuses: [\n                    { type: 'efficiency', value: 3, description: '+3% weapon efficiency per level' },\n                    { type: 'cost_reduction', value: 2, description: '-2% energy cost per level' }\n                ]\n            },\n            {\n                id: 'shield_mastery',\n                name: 'Shield Mastery',\n                category: SkillCategory.Combat,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Improves shield capacity and regeneration',\n                bonuses: [\n                    { type: 'capacity', value: 5, description: '+5% shield capacity per level' },\n                    { type: 'efficiency', value: 3, description: '+3% regeneration rate per level' }\n                ]\n            },\n            \n            // Piloting Skills\n            {\n                id: 'ship_handling',\n                name: 'Ship Handling',\n                category: SkillCategory.Piloting,\n                level: 0,\n                experience: 0,\n                maxLevel: 25,\n                description: 'Improves ship maneuverability and speed',\n                bonuses: [\n                    { type: 'speed', value: 2, description: '+2% ship speed per level' },\n                    { type: 'efficiency', value: 1, description: '+1% turn rate per level' }\n                ]\n            },\n            {\n                id: 'evasive_maneuvers',\n                name: 'Evasive Maneuvers',\n                category: SkillCategory.Piloting,\n                level: 0,\n                experience: 0,\n                maxLevel: 15,\n                description: 'Increases evasion chance and reduces incoming damage',\n                prerequisite: 'ship_handling',\n                prerequisiteLevel: 8,\n                bonuses: [\n                    { type: 'efficiency', value: 2, description: '+2% evasion chance per level' }\n                ]\n            },\n            {\n                id: 'warp_navigation',\n                name: 'Warp Navigation',\n                category: SkillCategory.Piloting,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Reduces warp energy costs and improves efficiency',\n                bonuses: [\n                    { type: 'cost_reduction', value: 3, description: '-3% warp energy cost per level' },\n                    { type: 'speed', value: 1, description: '+1% warp speed per level' }\n                ]\n            },\n            \n            // Engineering Skills\n            {\n                id: 'system_repair',\n                name: 'System Repair',\n                category: SkillCategory.Engineering,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Improves repair efficiency and reduces costs',\n                bonuses: [\n                    { type: 'efficiency', value: 4, description: '+4% repair efficiency per level' },\n                    { type: 'cost_reduction', value: 2, description: '-2% repair cost per level' }\n                ]\n            },\n            {\n                id: 'power_management',\n                name: 'Power Management',\n                category: SkillCategory.Engineering,\n                level: 0,\n                experience: 0,\n                maxLevel: 15,\n                description: 'Increases power capacity and efficiency',\n                bonuses: [\n                    { type: 'capacity', value: 3, description: '+3% power capacity per level' },\n                    { type: 'efficiency', value: 2, description: '+2% power efficiency per level' }\n                ]\n            },\n            {\n                id: 'advanced_crafting',\n                name: 'Advanced Crafting',\n                category: SkillCategory.Engineering,\n                level: 0,\n                experience: 0,\n                maxLevel: 25,\n                description: 'Increases crafting success rates and unlocks recipes',\n                prerequisite: 'system_repair',\n                prerequisiteLevel: 5,\n                bonuses: [\n                    { type: 'efficiency', value: 3, description: '+3% crafting success rate per level' }\n                ]\n            },\n            \n            // Science Skills\n            {\n                id: 'sensor_analysis',\n                name: 'Sensor Analysis',\n                category: SkillCategory.Science,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Improves scanning range and accuracy',\n                bonuses: [\n                    { type: 'detection', value: 5, description: '+5% scanning range per level' },\n                    { type: 'efficiency', value: 2, description: '+2% scan accuracy per level' }\n                ]\n            },\n            {\n                id: 'research_methodology',\n                name: 'Research Methodology',\n                category: SkillCategory.Science,\n                level: 0,\n                experience: 0,\n                maxLevel: 15,\n                description: 'Increases research speed and technology unlock rate',\n                bonuses: [\n                    { type: 'efficiency', value: 4, description: '+4% research speed per level' }\n                ]\n            },\n            \n            // Trade Skills\n            {\n                id: 'negotiation',\n                name: 'Negotiation',\n                category: SkillCategory.Trade,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Improves trade prices and contract rewards',\n                bonuses: [\n                    { type: 'efficiency', value: 2, description: '+2% trade profit per level' }\n                ]\n            },\n            {\n                id: 'market_analysis',\n                name: 'Market Analysis',\n                category: SkillCategory.Trade,\n                level: 0,\n                experience: 0,\n                maxLevel: 15,\n                description: 'Provides better market information and price predictions',\n                prerequisite: 'negotiation',\n                prerequisiteLevel: 5,\n                bonuses: [\n                    { type: 'detection', value: 3, description: '+3% market insight per level' }\n                ]\n            },\n            \n            // Exploration Skills\n            {\n                id: 'stellar_cartography',\n                name: 'Stellar Cartography',\n                category: SkillCategory.Exploration,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Improves exploration rewards and discovery rates',\n                bonuses: [\n                    { type: 'efficiency', value: 3, description: '+3% discovery rate per level' },\n                    { type: 'detection', value: 2, description: '+2% exploration rewards per level' }\n                ]\n            },\n            {\n                id: 'xenobiology',\n                name: 'Xenobiology',\n                category: SkillCategory.Exploration,\n                level: 0,\n                experience: 0,\n                maxLevel: 15,\n                description: 'Increases rewards from biological discoveries',\n                prerequisite: 'stellar_cartography',\n                prerequisiteLevel: 8,\n                bonuses: [\n                    { type: 'efficiency', value: 5, description: '+5% biological research rewards per level' }\n                ]\n            }\n        ];\n        \n        skills.forEach(skill => {\n            this.character.skills.set(skill.id, skill);\n        });\n    }\n\n    /**\n     * Initialize achievements\n     */\n    private initializeAchievements(): void {\n        const achievements: Achievement[] = [\n            {\n                id: 'first_blood',\n                name: 'First Blood',\n                description: 'Destroy your first enemy ship',\n                category: 'Combat',\n                requirements: [\n                    { type: 'kill_enemies', target: 1, current: 0 }\n                ],\n                rewards: [\n                    { type: 'experience', value: 50 },\n                    { type: 'skill_points', value: 1 }\n                ],\n                unlocked: false,\n                hidden: false\n            },\n            {\n                id: 'ace_pilot',\n                name: 'Ace Pilot',\n                description: 'Destroy 50 enemy ships',\n                category: 'Combat',\n                requirements: [\n                    { type: 'kill_enemies', target: 50, current: 0 }\n                ],\n                rewards: [\n                    { type: 'experience', value: 500 },\n                    { type: 'skill_points', value: 3 }\n                ],\n                unlocked: false,\n                hidden: false\n            },\n            {\n                id: 'explorer',\n                name: 'Explorer',\n                description: 'Discover 10 star systems',\n                category: 'Exploration',\n                requirements: [\n                    { type: 'discover_systems', target: 10, current: 0 }\n                ],\n                rewards: [\n                    { type: 'experience', value: 200 },\n                    { type: 'attribute_points', value: 2 }\n                ],\n                unlocked: false,\n                hidden: false\n            },\n            {\n                id: 'master_craftsman',\n                name: 'Master Craftsman',\n                description: 'Craft 100 items',\n                category: 'Engineering',\n                requirements: [\n                    { type: 'craft_items', target: 100, current: 0 }\n                ],\n                rewards: [\n                    { type: 'experience', value: 300 },\n                    { type: 'skill_points', value: 2 }\n                ],\n                unlocked: false,\n                hidden: false\n            },\n            {\n                id: 'millionaire',\n                name: 'Millionaire',\n                description: 'Earn 1,000,000 credits',\n                category: 'Trade',\n                requirements: [\n                    { type: 'earn_credits', target: 1000000, current: 0 }\n                ],\n                rewards: [\n                    { type: 'experience', value: 1000 },\n                    { type: 'attribute_points', value: 5 }\n                ],\n                unlocked: false,\n                hidden: false\n            },\n            {\n                id: 'long_journey',\n                name: 'Long Journey',\n                description: 'Travel 100,000 kilometers',\n                category: 'Exploration',\n                requirements: [\n                    { type: 'travel_distance', target: 100000, current: 0 }\n                ],\n                rewards: [\n                    { type: 'experience', value: 250 },\n                    { type: 'skill_points', value: 1 }\n                ],\n                unlocked: false,\n                hidden: false\n            }\n        ];\n        \n        achievements.forEach(achievement => {\n            this.character.achievements.set(achievement.id, achievement);\n        });\n    }\n\n    /**\n     * Add experience to character\n     */\n    addExperience(amount: number): void {\n        this.character.experience += amount;\n        \n        // Check for level ups\n        while (this.character.experience >= this.character.experienceToNext) {\n            this.levelUp();\n        }\n        \n        this.logger.debug(`+${amount} XP (Total: ${this.character.experience})`);\n    }\n\n    /**\n     * Level up character\n     */\n    private levelUp(): void {\n        this.character.level++;\n        this.character.experience -= this.character.experienceToNext;\n        \n        // Calculate next level requirement\n        if (this.character.level < this.levelExperienceTable.length) {\n            this.character.experienceToNext = this.levelExperienceTable[this.character.level];\n        } else {\n            this.character.experienceToNext = this.levelExperienceTable[this.levelExperienceTable.length - 1];\n        }\n        \n        // Level rewards\n        const skillPointsGained = this.character.level % 2 === 0 ? 2 : 1; // 2 every even level, 1 every odd\n        const attributePointsGained = this.character.level % 5 === 0 ? 2 : 0; // 2 every 5 levels\n        \n        this.character.skillPoints += skillPointsGained;\n        this.character.attributePoints += attributePointsGained;\n        \n        this.events.onLevelUp?.(this.character.level, {\n            skillPoints: skillPointsGained,\n            attributePoints: attributePointsGained\n        });\n        \n        this.logger.info(`🎉 Level Up! Now level ${this.character.level}`, {\n            skillPoints: skillPointsGained,\n            attributePoints: attributePointsGained\n        });\n    }\n\n    /**\n     * Add skill experience\n     */\n    addSkillExperience(skillId: string, amount: number): void {\n        const skill = this.character.skills.get(skillId);\n        if (!skill || skill.level >= skill.maxLevel) return;\n        \n        skill.experience += amount;\n        \n        // Check for skill level up\n        const requiredXP = this.skillExperienceTable[skill.level] || this.skillExperienceTable[this.skillExperienceTable.length - 1];\n        \n        if (skill.experience >= requiredXP) {\n            skill.level++;\n            skill.experience -= requiredXP;\n            \n            this.events.onSkillLevelUp?.(skill, skill.level);\n            \n            this.logger.info(`📈 Skill Level Up: ${skill.name} → ${skill.level}`);\n        }\n    }\n\n    /**\n     * Spend skill points to level up a skill\n     */\n    levelUpSkill(skillId: string): boolean {\n        const skill = this.character.skills.get(skillId);\n        if (!skill || skill.level >= skill.maxLevel) return false;\n        \n        // Check prerequisites\n        if (skill.prerequisite) {\n            const prereqSkill = this.character.skills.get(skill.prerequisite);\n            if (!prereqSkill || prereqSkill.level < (skill.prerequisiteLevel || 1)) {\n                this.logger.warn(`Prerequisite not met: ${skill.prerequisite} level ${skill.prerequisiteLevel}`);\n                return false;\n            }\n        }\n        \n        // Check skill points\n        const cost = Math.max(1, Math.floor(skill.level / 5) + 1); // Increasing cost\n        if (this.character.skillPoints < cost) {\n            this.logger.warn(`Not enough skill points: need ${cost}, have ${this.character.skillPoints}`);\n            return false;\n        }\n        \n        // Level up skill\n        this.character.skillPoints -= cost;\n        skill.level++;\n        \n        this.events.onSkillLevelUp?.(skill, skill.level);\n        \n        this.logger.info(`💫 Manual skill upgrade: ${skill.name} → ${skill.level} (Cost: ${cost} SP)`);\n        \n        return true;\n    }\n\n    /**\n     * Increase attribute\n     */\n    increaseAttribute(type: AttributeType, amount: number = 1): boolean {\n        const cost = amount * 2; // 2 attribute points per increase\n        if (this.character.attributePoints < cost) {\n            this.logger.warn(`Not enough attribute points: need ${cost}, have ${this.character.attributePoints}`);\n            return false;\n        }\n        \n        const attribute = this.character.attributes.get(type);\n        if (!attribute) return false;\n        \n        const oldValue = attribute.value;\n        attribute.baseValue += amount;\n        this.recalculateAttribute(type);\n        \n        this.character.attributePoints -= cost;\n        \n        this.events.onAttributeChanged?.(type, oldValue, attribute.value);\n        \n        this.logger.info(`⚡ Attribute increased: ${type} → ${attribute.value} (Cost: ${cost} AP)`);\n        \n        return true;\n    }\n\n    /**\n     * Add temporary attribute modifier\n     */\n    addAttributeModifier(type: AttributeType, modifier: AttributeModifier): void {\n        const attribute = this.character.attributes.get(type);\n        if (!attribute) return;\n        \n        attribute.modifiers.push(modifier);\n        this.recalculateAttribute(type);\n        \n        this.logger.debug(`Applied modifier to ${type}: ${modifier.value} from ${modifier.source}`);\n    }\n\n    /**\n     * Remove attribute modifier\n     */\n    removeAttributeModifier(type: AttributeType, source: string): void {\n        const attribute = this.character.attributes.get(type);\n        if (!attribute) return;\n        \n        attribute.modifiers = attribute.modifiers.filter(mod => mod.source !== source);\n        this.recalculateAttribute(type);\n        \n        this.logger.debug(`Removed modifier from ${type}: ${source}`);\n    }\n\n    /**\n     * Recalculate attribute value with modifiers\n     */\n    private recalculateAttribute(type: AttributeType): void {\n        const attribute = this.character.attributes.get(type);\n        if (!attribute) return;\n        \n        const oldValue = attribute.value;\n        attribute.value = attribute.baseValue;\n        \n        // Apply modifiers\n        attribute.modifiers.forEach(mod => {\n            attribute.value += mod.value;\n        });\n        \n        // Minimum value of 1\n        attribute.value = Math.max(1, attribute.value);\n        \n        if (oldValue !== attribute.value) {\n            this.events.onAttributeChanged?.(type, oldValue, attribute.value);\n        }\n    }\n\n    /**\n     * Update achievement progress\n     */\n    updateAchievementProgress(type: string, amount: number, data?: any): void {\n        for (const achievement of this.character.achievements.values()) {\n            if (achievement.unlocked) continue;\n            \n            for (const req of achievement.requirements) {\n                if (req.type === type) {\n                    req.current = Math.min(req.target, req.current + amount);\n                    \n                    // Check if achievement is completed\n                    if (this.isAchievementCompleted(achievement)) {\n                        this.unlockAchievement(achievement.id);\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Check if achievement is completed\n     */\n    private isAchievementCompleted(achievement: Achievement): boolean {\n        return achievement.requirements.every(req => req.current >= req.target);\n    }\n\n    /**\n     * Unlock achievement\n     */\n    private unlockAchievement(achievementId: string): void {\n        const achievement = this.character.achievements.get(achievementId);\n        if (!achievement || achievement.unlocked) return;\n        \n        achievement.unlocked = true;\n        achievement.unlockedDate = Date.now();\n        \n        // Apply rewards\n        achievement.rewards.forEach(reward => {\n            switch (reward.type) {\n                case 'experience':\n                    this.addExperience(reward.value);\n                    break;\n                case 'skill_points':\n                    this.character.skillPoints += reward.value;\n                    break;\n                case 'attribute_points':\n                    this.character.attributePoints += reward.value;\n                    break;\n                case 'credits':\n                    this.character.creditsEarned += reward.value;\n                    break;\n            }\n        });\n        \n        this.events.onAchievementUnlocked?.(achievement);\n        \n        this.logger.info(`🏆 Achievement Unlocked: ${achievement.name}`, {\n            rewards: achievement.rewards\n        });\n    }\n\n    /**\n     * Update character statistics\n     */\n    updateStatistics(stats: {\n        playTime?: number;\n        enemiesDefeated?: number;\n        systemsExplored?: number;\n        distanceTraveled?: number;\n        creditsEarned?: number;\n        itemsCrafted?: number;\n    }): void {\n        if (stats.playTime) this.character.totalPlayTime += stats.playTime;\n        if (stats.enemiesDefeated) {\n            this.character.enemiesDefeated += stats.enemiesDefeated;\n            this.updateAchievementProgress('kill_enemies', stats.enemiesDefeated);\n        }\n        if (stats.systemsExplored) {\n            this.character.systemsExplored += stats.systemsExplored;\n            this.updateAchievementProgress('discover_systems', stats.systemsExplored);\n        }\n        if (stats.distanceTraveled) {\n            this.character.distanceTraveled += stats.distanceTraveled;\n            this.updateAchievementProgress('travel_distance', stats.distanceTraveled);\n        }\n        if (stats.creditsEarned) {\n            this.character.creditsEarned += stats.creditsEarned;\n            this.updateAchievementProgress('earn_credits', stats.creditsEarned);\n        }\n        if (stats.itemsCrafted) {\n            this.character.itemsCrafted += stats.itemsCrafted;\n            this.updateAchievementProgress('craft_items', stats.itemsCrafted);\n        }\n    }\n\n    /**\n     * Get skill bonus value\n     */\n    getSkillBonus(skillId: string, bonusType: string): number {\n        const skill = this.character.skills.get(skillId);\n        if (!skill) return 0;\n        \n        const bonus = skill.bonuses.find(b => b.type === bonusType);\n        if (!bonus) return 0;\n        \n        return bonus.value * skill.level;\n    }\n\n    /**\n     * Get total bonus from all skills of a category\n     */\n    getCategoryBonus(category: SkillCategory, bonusType: string): number {\n        let total = 0;\n        \n        for (const skill of this.character.skills.values()) {\n            if (skill.category === category) {\n                total += this.getSkillBonus(skill.id, bonusType);\n            }\n        }\n        \n        return total;\n    }\n\n    /**\n     * Get attribute value\n     */\n    getAttributeValue(type: AttributeType): number {\n        const attribute = this.character.attributes.get(type);\n        return attribute ? attribute.value : 10;\n    }\n\n    /**\n     * Get character sheet\n     */\n    getCharacterSheet(): CharacterSheet {\n        return { ...this.character };\n    }\n\n    /**\n     * Get available skills for leveling\n     */\n    getAvailableSkills(): Skill[] {\n        return Array.from(this.character.skills.values()).filter(skill => {\n            if (skill.level >= skill.maxLevel) return false;\n            \n            // Check prerequisites\n            if (skill.prerequisite) {\n                const prereqSkill = this.character.skills.get(skill.prerequisite);\n                if (!prereqSkill || prereqSkill.level < (skill.prerequisiteLevel || 1)) {\n                    return false;\n                }\n            }\n            \n            return true;\n        });\n    }\n\n    /**\n     * Get unlocked achievements\n     */\n    getUnlockedAchievements(): Achievement[] {\n        return Array.from(this.character.achievements.values()).filter(a => a.unlocked);\n    }\n\n    /**\n     * Get achievement progress\n     */\n    getAchievementProgress(): Achievement[] {\n        return Array.from(this.character.achievements.values()).filter(a => !a.unlocked && !a.hidden);\n    }\n\n    /**\n     * Save character data\n     */\n    saveCharacter(): any {\n        return {\n            character: {\n                ...this.character,\n                skills: Array.from(this.character.skills.entries()),\n                attributes: Array.from(this.character.attributes.entries()),\n                achievements: Array.from(this.character.achievements.entries())\n            }\n        };\n    }\n\n    /**\n     * Load character data\n     */\n    loadCharacter(data: any): void {\n        if (data.character) {\n            this.character = {\n                ...data.character,\n                skills: new Map(data.character.skills),\n                attributes: new Map(data.character.attributes),\n                achievements: new Map(data.character.achievements)\n            };\n            \n            this.logger.info('📜 Character data loaded', {\n                level: this.character.level,\n                experience: this.character.experience\n            });\n        }\n    }\n\n    /**\n     * Get progression statistics\n     */\n    getProgressionStats(): {\n        totalSkillLevels: number;\n        highestSkillLevel: number;\n        totalAttributePoints: number;\n        achievementsUnlocked: number;\n        totalAchievements: number;\n        progressionPercentage: number;\n    } {\n        const totalSkillLevels = Array.from(this.character.skills.values())\n            .reduce((sum, skill) => sum + skill.level, 0);\n        \n        const highestSkillLevel = Math.max(...Array.from(this.character.skills.values())\n            .map(skill => skill.level));\n        \n        const totalAttributePoints = Array.from(this.character.attributes.values())\n            .reduce((sum, attr) => sum + attr.baseValue, 0);\n        \n        const achievementsUnlocked = Array.from(this.character.achievements.values())\n            .filter(a => a.unlocked).length;\n        \n        const totalAchievements = this.character.achievements.size;\n        \n        const maxSkillLevels = Array.from(this.character.skills.values())\n            .reduce((sum, skill) => sum + skill.maxLevel, 0);\n        \n        const progressionPercentage = Math.min(100, \n            (this.character.level / 50) * 30 + \n            (totalSkillLevels / maxSkillLevels) * 40 + \n            (achievementsUnlocked / totalAchievements) * 30\n        );\n        \n        return {\n            totalSkillLevels,\n            highestSkillLevel,\n            totalAttributePoints,\n            achievementsUnlocked,\n            totalAchievements,\n            progressionPercentage\n        };\n    }\n}","/**\n * Research & Technology System\n * Advanced research tree with technological progression and discoveries\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\nimport { GameItem } from '@items/ItemSystem';\n\nexport enum ResearchField {\n    Physics = 'physics',\n    Engineering = 'engineering',\n    Biology = 'biology',\n    Computing = 'computing',\n    Military = 'military',\n    Exploration = 'exploration'\n}\n\nexport enum TechnologyTier {\n    Basic = 1,\n    Advanced = 2,\n    Expert = 3,\n    Master = 4,\n    Legendary = 5\n}\n\nexport interface Technology {\n    id: string;\n    name: string;\n    description: string;\n    field: ResearchField;\n    tier: TechnologyTier;\n    \n    // Research requirements\n    researchCost: number;\n    researchTime: number; // Base time in seconds\n    prerequisites: string[]; // Required technology IDs\n    \n    // Research resources\n    requiredItems: { itemId: string, quantity: number }[];\n    requiredFacilities: string[];\n    \n    // Unlocks\n    unlocks: TechnologyUnlock[];\n    \n    // Progress\n    isUnlocked: boolean;\n    isResearching: boolean;\n    researchProgress: number;\n    researchStartTime: number;\n    completedTime?: number;\n}\n\nexport interface TechnologyUnlock {\n    type: 'ship_component' | 'weapon' | 'facility' | 'ability' | 'recipe' | 'upgrade';\n    target: string;\n    value?: number;\n    description: string;\n}\n\nexport interface ResearchProject {\n    id: string;\n    technologyId: string;\n    facilityId: string;\n    assignedScientists: string[];\n    startTime: number;\n    estimatedCompletion: number;\n    efficiency: number; // 0-1 multiplier\n    status: 'active' | 'paused' | 'completed' | 'failed';\n}\n\nexport interface ResearchFacility {\n    id: string;\n    name: string;\n    type: 'laboratory' | 'observatory' | 'workshop' | 'computer_core' | 'testing_chamber';\n    efficiency: number; // Research speed multiplier\n    specialization: ResearchField[];\n    maxProjects: number;\n    \n    // Current state\n    isOperational: boolean;\n    currentProjects: string[];\n    maintenanceLevel: number; // 0-1\n    upgradeLevel: number;\n}\n\nexport interface Scientist {\n    id: string;\n    name: string;\n    expertise: ResearchField;\n    skill: number; // 1-10\n    efficiency: number; // Research speed bonus\n    \n    // Current assignment\n    assignedProject?: string;\n    assignedFacility?: string;\n    \n    // Status\n    isAvailable: boolean;\n    fatigue: number; // 0-1, affects efficiency\n    morale: number; // 0-1, affects efficiency\n}\n\nexport interface ResearchEvents {\n    onTechnologyUnlocked?: (technology: Technology) => void;\n    onResearchCompleted?: (project: ResearchProject) => void;\n    onDiscoveryMade?: (discovery: Discovery) => void;\n    onBreakthroughAchieved?: (field: ResearchField, tier: TechnologyTier) => void;\n}\n\nexport interface Discovery {\n    id: string;\n    name: string;\n    description: string;\n    field: ResearchField;\n    rarity: 'common' | 'uncommon' | 'rare' | 'epic' | 'legendary';\n    discoveryTime: number;\n    \n    // Effects\n    researchBonus?: { field: ResearchField, bonus: number };\n    unlocksTechnology?: string;\n    grantsResources?: { itemId: string, quantity: number }[];\n}\n\nexport class ResearchSystem {\n    private technologies: Map<string, Technology> = new Map();\n    private projects: Map<string, ResearchProject> = new Map();\n    private facilities: Map<string, ResearchFacility> = new Map();\n    private scientists: Map<string, Scientist> = new Map();\n    private discoveries: Discovery[] = [];\n    \n    // Research state\n    private totalResearchPoints: number = 0;\n    private researchMultipliers: Map<ResearchField, number> = new Map();\n    \n    private events: ResearchEvents;\n    private logger: Logger;\n\n    constructor(events: ResearchEvents = {}) {\n        this.logger = new Logger('ResearchSystem');\n        this.events = events;\n        \n        this.initializeResearchMultipliers();\n        this.initializeTechnologies();\n        this.initializeFacilities();\n        this.initializeScientists();\n        \n        this.logger.info('🔬 Research system initialized');\n    }\n\n    /**\n     * Initialize research field multipliers\n     */\n    private initializeResearchMultipliers(): void {\n        Object.values(ResearchField).forEach(field => {\n            this.researchMultipliers.set(field, 1.0);\n        });\n    }\n\n    /**\n     * Initialize technology tree\n     */\n    private initializeTechnologies(): void {\n        const technologies: Technology[] = [\n            // Tier 1 - Basic Technologies\n            {\n                id: 'basic_sensors',\n                name: 'Enhanced Sensors',\n                description: 'Improved sensor arrays for better detection range',\n                field: ResearchField.Engineering,\n                tier: TechnologyTier.Basic,\n                researchCost: 100,\n                researchTime: 300, // 5 minutes\n                prerequisites: [],\n                requiredItems: [\n                    { itemId: 'comp_circuit', quantity: 5 },\n                    { itemId: 'crystal_quartz', quantity: 3 }\n                ],\n                requiredFacilities: ['basic_lab'],\n                unlocks: [\n                    { type: 'ship_component', target: 'advanced_sensors', description: 'Unlocks Advanced Sensor Array' },\n                    { type: 'ability', target: 'long_range_scan', description: 'Enables long-range scanning' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            {\n                id: 'improved_hull',\n                name: 'Improved Hull Design',\n                description: 'Stronger hull materials and construction techniques',\n                field: ResearchField.Engineering,\n                tier: TechnologyTier.Basic,\n                researchCost: 150,\n                researchTime: 450,\n                prerequisites: [],\n                requiredItems: [\n                    { itemId: 'metal_iron', quantity: 10 },\n                    { itemId: 'metal_titanium', quantity: 5 }\n                ],\n                requiredFacilities: ['workshop'],\n                unlocks: [\n                    { type: 'upgrade', target: 'hull_strength', value: 25, description: '+25% hull strength' },\n                    { type: 'ship_component', target: 'reinforced_hull', description: 'Unlocks Reinforced Hull Plating' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            {\n                id: 'energy_weapons',\n                name: 'Energy Weapon Technology',\n                description: 'Basic laser and plasma weapon systems',\n                field: ResearchField.Military,\n                tier: TechnologyTier.Basic,\n                researchCost: 200,\n                researchTime: 600,\n                prerequisites: [],\n                requiredItems: [\n                    { itemId: 'energy_antimatter', quantity: 2 },\n                    { itemId: 'comp_circuit', quantity: 8 }\n                ],\n                requiredFacilities: ['basic_lab', 'workshop'],\n                unlocks: [\n                    { type: 'weapon', target: 'plasma_cannon', description: 'Unlocks Plasma Cannon' },\n                    { type: 'upgrade', target: 'energy_efficiency', value: 15, description: '+15% energy weapon efficiency' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            \n            // Tier 2 - Advanced Technologies\n            {\n                id: 'quantum_computing',\n                name: 'Quantum Computing',\n                description: 'Advanced quantum processors for complex calculations',\n                field: ResearchField.Computing,\n                tier: TechnologyTier.Advanced,\n                researchCost: 500,\n                researchTime: 1200,\n                prerequisites: ['basic_sensors'],\n                requiredItems: [\n                    { itemId: 'crystal_dilithium', quantity: 3 },\n                    { itemId: 'comp_quantum_processor', quantity: 1 }\n                ],\n                requiredFacilities: ['computer_core'],\n                unlocks: [\n                    { type: 'facility', target: 'quantum_lab', description: 'Unlocks Quantum Research Lab' },\n                    { type: 'upgrade', target: 'research_speed', value: 30, description: '+30% research speed' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            {\n                id: 'shield_technology',\n                name: 'Advanced Shielding',\n                description: 'Improved shield generators and energy distribution',\n                field: ResearchField.Physics,\n                tier: TechnologyTier.Advanced,\n                researchCost: 400,\n                researchTime: 900,\n                prerequisites: ['improved_hull', 'energy_weapons'],\n                requiredItems: [\n                    { itemId: 'comp_shield_emitter', quantity: 3 },\n                    { itemId: 'energy_antimatter', quantity: 5 }\n                ],\n                requiredFacilities: ['testing_chamber'],\n                unlocks: [\n                    { type: 'ship_component', target: 'adaptive_shields', description: 'Unlocks Adaptive Shield Matrix' },\n                    { type: 'upgrade', target: 'shield_capacity', value: 40, description: '+40% shield capacity' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            {\n                id: 'warp_optimization',\n                name: 'Warp Drive Optimization',\n                description: 'Improved warp field stability and efficiency',\n                field: ResearchField.Physics,\n                tier: TechnologyTier.Advanced,\n                researchCost: 600,\n                researchTime: 1500,\n                prerequisites: ['quantum_computing'],\n                requiredItems: [\n                    { itemId: 'crystal_dilithium', quantity: 8 },\n                    { itemId: 'comp_warp_coil', quantity: 2 }\n                ],\n                requiredFacilities: ['observatory'],\n                unlocks: [\n                    { type: 'upgrade', target: 'warp_efficiency', value: 25, description: '+25% warp efficiency' },\n                    { type: 'ability', target: 'emergency_warp', description: 'Enables emergency warp escape' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            \n            // Tier 3 - Expert Technologies\n            {\n                id: 'artificial_intelligence',\n                name: 'Artificial Intelligence',\n                description: 'Advanced AI systems for ship automation',\n                field: ResearchField.Computing,\n                tier: TechnologyTier.Expert,\n                researchCost: 1000,\n                researchTime: 2400,\n                prerequisites: ['quantum_computing', 'shield_technology'],\n                requiredItems: [\n                    { itemId: 'comp_ai_core', quantity: 1 },\n                    { itemId: 'crystal_dilithium', quantity: 10 }\n                ],\n                requiredFacilities: ['quantum_lab'],\n                unlocks: [\n                    { type: 'ship_component', target: 'ai_assistant', description: 'Unlocks AI Ship Assistant' },\n                    { type: 'upgrade', target: 'automation_efficiency', value: 50, description: '+50% system automation' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            {\n                id: 'exotic_matter',\n                name: 'Exotic Matter Research',\n                description: 'Studies of exotic matter and its applications',\n                field: ResearchField.Physics,\n                tier: TechnologyTier.Expert,\n                researchCost: 1200,\n                researchTime: 3000,\n                prerequisites: ['warp_optimization'],\n                requiredItems: [\n                    { itemId: 'exotic_dark_matter', quantity: 3 },\n                    { itemId: 'comp_containment_field', quantity: 2 }\n                ],\n                requiredFacilities: ['testing_chamber', 'quantum_lab'],\n                unlocks: [\n                    { type: 'weapon', target: 'exotic_weapons', description: 'Unlocks Exotic Matter Weapons' },\n                    { type: 'ability', target: 'phase_shift', description: 'Enables temporary phase shifting' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            \n            // Tier 4 - Master Technologies\n            {\n                id: 'consciousness_transfer',\n                name: 'Consciousness Transfer',\n                description: 'Technology to transfer consciousness between vessels',\n                field: ResearchField.Biology,\n                tier: TechnologyTier.Master,\n                researchCost: 2000,\n                researchTime: 4800,\n                prerequisites: ['artificial_intelligence', 'exotic_matter'],\n                requiredItems: [\n                    { itemId: 'bio_neural_matrix', quantity: 1 },\n                    { itemId: 'comp_ai_core', quantity: 3 }\n                ],\n                requiredFacilities: ['quantum_lab', 'bio_lab'],\n                unlocks: [\n                    { type: 'ability', target: 'backup_consciousness', description: 'Enables consciousness backup' },\n                    { type: 'ship_component', target: 'neural_interface', description: 'Direct neural ship control' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            \n            // Tier 5 - Legendary Technologies\n            {\n                id: 'reality_manipulation',\n                name: 'Reality Manipulation',\n                description: 'Ultimate technology to alter space-time itself',\n                field: ResearchField.Physics,\n                tier: TechnologyTier.Legendary,\n                researchCost: 5000,\n                researchTime: 10000,\n                prerequisites: ['consciousness_transfer'],\n                requiredItems: [\n                    { itemId: 'artifact_singularity_core', quantity: 1 },\n                    { itemId: 'exotic_temporal_crystal', quantity: 5 }\n                ],\n                requiredFacilities: ['quantum_lab', 'testing_chamber', 'observatory'],\n                unlocks: [\n                    { type: 'ability', target: 'time_dilation', description: 'Manipulate local time flow' },\n                    { type: 'ability', target: 'space_folding', description: 'Fold space for instant travel' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            }\n        ];\n        \n        technologies.forEach(tech => {\n            this.technologies.set(tech.id, tech);\n        });\n    }\n\n    /**\n     * Initialize research facilities\n     */\n    private initializeFacilities(): void {\n        const facilities: ResearchFacility[] = [\n            {\n                id: 'basic_lab',\n                name: 'Basic Laboratory',\n                type: 'laboratory',\n                efficiency: 1.0,\n                specialization: [ResearchField.Engineering, ResearchField.Computing],\n                maxProjects: 1,\n                isOperational: true,\n                currentProjects: [],\n                maintenanceLevel: 1.0,\n                upgradeLevel: 1\n            },\n            {\n                id: 'workshop',\n                name: 'Engineering Workshop',\n                type: 'workshop',\n                efficiency: 1.2,\n                specialization: [ResearchField.Engineering, ResearchField.Military],\n                maxProjects: 2,\n                isOperational: true,\n                currentProjects: [],\n                maintenanceLevel: 1.0,\n                upgradeLevel: 1\n            },\n            {\n                id: 'computer_core',\n                name: 'Computer Core',\n                type: 'computer_core',\n                efficiency: 1.5,\n                specialization: [ResearchField.Computing],\n                maxProjects: 1,\n                isOperational: true,\n                currentProjects: [],\n                maintenanceLevel: 1.0,\n                upgradeLevel: 1\n            }\n        ];\n        \n        facilities.forEach(facility => {\n            this.facilities.set(facility.id, facility);\n        });\n    }\n\n    /**\n     * Initialize scientists\n     */\n    private initializeScientists(): void {\n        const scientists: Scientist[] = [\n            {\n                id: 'dr_smith',\n                name: 'Dr. Sarah Smith',\n                expertise: ResearchField.Engineering,\n                skill: 7,\n                efficiency: 1.2,\n                isAvailable: true,\n                fatigue: 0,\n                morale: 0.8\n            },\n            {\n                id: 'prof_chen',\n                name: 'Prof. Wei Chen',\n                expertise: ResearchField.Physics,\n                skill: 8,\n                efficiency: 1.3,\n                isAvailable: true,\n                fatigue: 0,\n                morale: 0.9\n            },\n            {\n                id: 'dr_ivanov',\n                name: 'Dr. Viktor Ivanov',\n                expertise: ResearchField.Computing,\n                skill: 6,\n                efficiency: 1.1,\n                isAvailable: true,\n                fatigue: 0,\n                morale: 0.7\n            }\n        ];\n        \n        scientists.forEach(scientist => {\n            this.scientists.set(scientist.id, scientist);\n        });\n    }\n\n    /**\n     * Start research project\n     */\n    startResearch(technologyId: string, facilityId: string, scientistIds: string[] = []): boolean {\n        const technology = this.technologies.get(technologyId);\n        const facility = this.facilities.get(facilityId);\n        \n        if (!technology || !facility) {\n            this.logger.warn('Invalid technology or facility for research', { technologyId, facilityId });\n            return false;\n        }\n        \n        // Check if technology is available for research\n        if (technology.isUnlocked || technology.isResearching) {\n            this.logger.warn('Technology already unlocked or being researched', { technologyId });\n            return false;\n        }\n        \n        // Check prerequisites\n        for (const prereq of technology.prerequisites) {\n            const prereqTech = this.technologies.get(prereq);\n            if (!prereqTech || !prereqTech.isUnlocked) {\n                this.logger.warn('Prerequisites not met', { technologyId, missingPrereq: prereq });\n                return false;\n            }\n        }\n        \n        // Check facility availability\n        if (facility.currentProjects.length >= facility.maxProjects) {\n            this.logger.warn('Facility at capacity', { facilityId });\n            return false;\n        }\n        \n        // Check facility specialization\n        if (facility.specialization.length > 0 && !facility.specialization.includes(technology.field)) {\n            this.logger.warn('Facility not specialized for this research field', { \n                facilityId, \n                field: technology.field, \n                specializations: facility.specialization \n            });\n            return false;\n        }\n        \n        // Validate and assign scientists\n        const validScientists: string[] = [];\n        for (const scientistId of scientistIds) {\n            const scientist = this.scientists.get(scientistId);\n            if (scientist && scientist.isAvailable) {\n                validScientists.push(scientistId);\n                scientist.isAvailable = false;\n                scientist.assignedProject = technologyId;\n                scientist.assignedFacility = facilityId;\n            }\n        }\n        \n        // Calculate research efficiency\n        let efficiency = facility.efficiency * facility.maintenanceLevel;\n        \n        // Add scientist bonuses\n        validScientists.forEach(scientistId => {\n            const scientist = this.scientists.get(scientistId);\n            if (scientist) {\n                let scientistBonus = scientist.efficiency * scientist.morale * (1 - scientist.fatigue);\n                \n                // Expertise bonus\n                if (scientist.expertise === technology.field) {\n                    scientistBonus *= 1.5;\n                }\n                \n                efficiency += scientistBonus;\n            }\n        });\n        \n        // Apply research field multipliers\n        const fieldMultiplier = this.researchMultipliers.get(technology.field) || 1.0;\n        efficiency *= fieldMultiplier;\n        \n        // Calculate estimated completion time\n        const baseTime = technology.researchTime;\n        const estimatedTime = baseTime / efficiency;\n        \n        // Create research project\n        const projectId = `project_${technologyId}_${Date.now()}`;\n        const project: ResearchProject = {\n            id: projectId,\n            technologyId,\n            facilityId,\n            assignedScientists: validScientists,\n            startTime: Date.now(),\n            estimatedCompletion: Date.now() + estimatedTime * 1000,\n            efficiency,\n            status: 'active'\n        };\n        \n        this.projects.set(projectId, project);\n        facility.currentProjects.push(projectId);\n        technology.isResearching = true;\n        technology.researchStartTime = Date.now();\n        \n        this.logger.info(`🔬 Research started: ${technology.name}`, {\n            facility: facility.name,\n            scientists: validScientists.length,\n            efficiency: efficiency.toFixed(2),\n            estimatedHours: (estimatedTime / 3600).toFixed(1)\n        });\n        \n        return true;\n    }\n\n    /**\n     * Update research progress\n     */\n    update(deltaTime: number): void {\n        const currentTime = Date.now();\n        \n        for (const project of this.projects.values()) {\n            if (project.status !== 'active') continue;\n            \n            const technology = this.technologies.get(project.technologyId);\n            if (!technology) continue;\n            \n            // Calculate progress\n            const elapsed = currentTime - project.startTime;\n            const totalDuration = project.estimatedCompletion - project.startTime;\n            const progress = Math.min(1.0, elapsed / totalDuration);\n            \n            technology.researchProgress = progress;\n            \n            // Check for completion\n            if (progress >= 1.0) {\n                this.completeResearch(project.id);\n            } else {\n                // Update scientist fatigue\n                project.assignedScientists.forEach(scientistId => {\n                    const scientist = this.scientists.get(scientistId);\n                    if (scientist) {\n                        scientist.fatigue = Math.min(1.0, scientist.fatigue + deltaTime * 0.0001); // Gradual fatigue\n                    }\n                });\n            }\n        }\n        \n        // Random discovery chances\n        if (Math.random() < 0.001) { // 0.1% chance per update\n            this.makeRandomDiscovery();\n        }\n    }\n\n    /**\n     * Complete research project\n     */\n    private completeResearch(projectId: string): void {\n        const project = this.projects.get(projectId);\n        if (!project) return;\n        \n        const technology = this.technologies.get(project.technologyId);\n        const facility = this.facilities.get(project.facilityId);\n        \n        if (!technology || !facility) return;\n        \n        // Mark technology as unlocked\n        technology.isUnlocked = true;\n        technology.isResearching = false;\n        technology.researchProgress = 1.0;\n        technology.completedTime = Date.now();\n        \n        // Free up scientists\n        project.assignedScientists.forEach(scientistId => {\n            const scientist = this.scientists.get(scientistId);\n            if (scientist) {\n                scientist.isAvailable = true;\n                scientist.assignedProject = undefined;\n                scientist.assignedFacility = undefined;\n                scientist.morale = Math.min(1.0, scientist.morale + 0.1); // Boost morale on success\n            }\n        });\n        \n        // Remove project from facility\n        facility.currentProjects = facility.currentProjects.filter(id => id !== projectId);\n        \n        // Mark project as completed\n        project.status = 'completed';\n        \n        // Award research points\n        this.totalResearchPoints += technology.researchCost;\n        \n        // Apply technology unlocks\n        this.applyTechnologyUnlocks(technology);\n        \n        this.events.onTechnologyUnlocked?.(technology);\n        this.events.onResearchCompleted?.(project);\n        \n        this.logger.info(`🎉 Research completed: ${technology.name}`, {\n            duration: ((Date.now() - project.startTime) / 1000 / 60).toFixed(1) + ' minutes',\n            unlocks: technology.unlocks.length\n        });\n        \n        // Check for breakthrough achievements\n        const tierCount = this.getTierUnlockCount(technology.field, technology.tier);\n        if (tierCount === 1) { // First technology of this tier in this field\n            this.events.onBreakthroughAchieved?.(technology.field, technology.tier);\n        }\n    }\n\n    /**\n     * Apply technology unlocks\n     */\n    private applyTechnologyUnlocks(technology: Technology): void {\n        technology.unlocks.forEach(unlock => {\n            switch (unlock.type) {\n                case 'facility':\n                    this.unlockFacility(unlock.target);\n                    break;\n                case 'upgrade':\n                    this.applyUpgrade(unlock.target, unlock.value || 0);\n                    break;\n                case 'ability':\n                    this.unlockAbility(unlock.target);\n                    break;\n                case 'recipe':\n                    this.unlockRecipe(unlock.target);\n                    break;\n            }\n        });\n    }\n\n    /**\n     * Unlock new research facility\n     */\n    private unlockFacility(facilityType: string): void {\n        const facilityConfigs: { [key: string]: Partial<ResearchFacility> } = {\n            quantum_lab: {\n                name: 'Quantum Research Lab',\n                type: 'laboratory',\n                efficiency: 2.0,\n                specialization: [ResearchField.Physics, ResearchField.Computing],\n                maxProjects: 2\n            },\n            bio_lab: {\n                name: 'Biological Research Lab',\n                type: 'laboratory',\n                efficiency: 1.8,\n                specialization: [ResearchField.Biology],\n                maxProjects: 1\n            },\n            testing_chamber: {\n                name: 'Testing Chamber',\n                type: 'testing_chamber',\n                efficiency: 1.5,\n                specialization: [ResearchField.Military, ResearchField.Engineering],\n                maxProjects: 3\n            },\n            observatory: {\n                name: 'Deep Space Observatory',\n                type: 'observatory',\n                efficiency: 1.6,\n                specialization: [ResearchField.Exploration, ResearchField.Physics],\n                maxProjects: 1\n            }\n        };\n        \n        const config = facilityConfigs[facilityType];\n        if (config) {\n            const facilityId = `${facilityType}_${Date.now()}`;\n            const facility: ResearchFacility = {\n                id: facilityId,\n                name: config.name || facilityType,\n                type: config.type || 'laboratory',\n                efficiency: config.efficiency || 1.0,\n                specialization: config.specialization || [],\n                maxProjects: config.maxProjects || 1,\n                isOperational: true,\n                currentProjects: [],\n                maintenanceLevel: 1.0,\n                upgradeLevel: 1\n            };\n            \n            this.facilities.set(facilityId, facility);\n            this.logger.info(`🏗️ New facility unlocked: ${facility.name}`);\n        }\n    }\n\n    /**\n     * Apply research upgrade\n     */\n    private applyUpgrade(upgradeType: string, value: number): void {\n        switch (upgradeType) {\n            case 'research_speed':\n                Object.values(ResearchField).forEach(field => {\n                    const current = this.researchMultipliers.get(field) || 1.0;\n                    this.researchMultipliers.set(field, current * (1 + value / 100));\n                });\n                break;\n            case 'hull_strength':\n            case 'shield_capacity':\n            case 'warp_efficiency':\n                // These would be applied to ship systems\n                this.logger.info(`⚡ Upgrade applied: ${upgradeType} +${value}%`);\n                break;\n        }\n    }\n\n    /**\n     * Unlock new ability\n     */\n    private unlockAbility(abilityId: string): void {\n        this.logger.info(`🌟 New ability unlocked: ${abilityId}`);\n    }\n\n    /**\n     * Unlock new recipe\n     */\n    private unlockRecipe(recipeId: string): void {\n        this.logger.info(`📋 New recipe unlocked: ${recipeId}`);\n    }\n\n    /**\n     * Make random discovery\n     */\n    private makeRandomDiscovery(): void {\n        const discoveries = [\n            {\n                name: 'Quantum Fluctuation Anomaly',\n                field: ResearchField.Physics,\n                rarity: 'rare' as const,\n                researchBonus: { field: ResearchField.Physics, bonus: 0.1 }\n            },\n            {\n                name: 'Exotic Particle Traces',\n                field: ResearchField.Physics,\n                rarity: 'uncommon' as const,\n                grantsResources: [{ itemId: 'exotic_dark_matter', quantity: 1 }]\n            },\n            {\n                name: 'Ancient Data Fragment',\n                field: ResearchField.Computing,\n                rarity: 'epic' as const,\n                unlocksTechnology: 'artificial_intelligence'\n            },\n            {\n                name: 'Biological Adaptation Pattern',\n                field: ResearchField.Biology,\n                rarity: 'common' as const,\n                researchBonus: { field: ResearchField.Biology, bonus: 0.05 }\n            }\n        ];\n        \n        const discovery = discoveries[Math.floor(Math.random() * discoveries.length)];\n        const discoveryObj: Discovery = {\n            id: `discovery_${Date.now()}`,\n            name: discovery.name,\n            description: `A ${discovery.rarity} discovery in ${discovery.field}`,\n            field: discovery.field,\n            rarity: discovery.rarity,\n            discoveryTime: Date.now(),\n            researchBonus: discovery.researchBonus,\n            unlocksTechnology: discovery.unlocksTechnology,\n            grantsResources: discovery.grantsResources\n        };\n        \n        this.discoveries.push(discoveryObj);\n        \n        // Apply discovery effects\n        if (discoveryObj.researchBonus) {\n            const current = this.researchMultipliers.get(discoveryObj.researchBonus.field) || 1.0;\n            this.researchMultipliers.set(discoveryObj.researchBonus.field, current + discoveryObj.researchBonus.bonus);\n        }\n        \n        this.events.onDiscoveryMade?.(discoveryObj);\n        \n        this.logger.info(`🔍 Discovery made: ${discoveryObj.name}`, {\n            field: discoveryObj.field,\n            rarity: discoveryObj.rarity\n        });\n    }\n\n    /**\n     * Get available technologies for research\n     */\n    getAvailableTechnologies(): Technology[] {\n        return Array.from(this.technologies.values()).filter(tech => {\n            if (tech.isUnlocked || tech.isResearching) return false;\n            \n            // Check prerequisites\n            return tech.prerequisites.every(prereqId => {\n                const prereq = this.technologies.get(prereqId);\n                return prereq && prereq.isUnlocked;\n            });\n        });\n    }\n\n    /**\n     * Get active research projects\n     */\n    getActiveProjects(): ResearchProject[] {\n        return Array.from(this.projects.values()).filter(p => p.status === 'active');\n    }\n\n    /**\n     * Get unlocked technologies\n     */\n    getUnlockedTechnologies(): Technology[] {\n        return Array.from(this.technologies.values()).filter(tech => tech.isUnlocked);\n    }\n\n    /**\n     * Get technology by ID\n     */\n    getTechnology(technologyId: string): Technology | null {\n        return this.technologies.get(technologyId) || null;\n    }\n\n    /**\n     * Get all facilities\n     */\n    getFacilities(): ResearchFacility[] {\n        return Array.from(this.facilities.values());\n    }\n\n    /**\n     * Get available scientists\n     */\n    getAvailableScientists(): Scientist[] {\n        return Array.from(this.scientists.values()).filter(s => s.isAvailable);\n    }\n\n    /**\n     * Get recent discoveries\n     */\n    getRecentDiscoveries(limit: number = 10): Discovery[] {\n        return this.discoveries\n            .sort((a, b) => b.discoveryTime - a.discoveryTime)\n            .slice(0, limit);\n    }\n\n    /**\n     * Get tier unlock count for field\n     */\n    private getTierUnlockCount(field: ResearchField, tier: TechnologyTier): number {\n        return Array.from(this.technologies.values())\n            .filter(tech => tech.field === field && tech.tier === tier && tech.isUnlocked)\n            .length;\n    }\n\n    /**\n     * Get research statistics\n     */\n    getResearchStats(): {\n        totalTechnologies: number;\n        unlockedTechnologies: number;\n        activeProjects: number;\n        totalResearchPoints: number;\n        discoveries: number;\n        facilities: number;\n        scientists: number;\n        fieldProgress: { [field: string]: { unlocked: number, total: number } };\n    } {\n        const fieldProgress: { [field: string]: { unlocked: number, total: number } } = {};\n        \n        Object.values(ResearchField).forEach(field => {\n            const technologies = Array.from(this.technologies.values()).filter(tech => tech.field === field);\n            const unlocked = technologies.filter(tech => tech.isUnlocked).length;\n            fieldProgress[field] = { unlocked, total: technologies.length };\n        });\n        \n        return {\n            totalTechnologies: this.technologies.size,\n            unlockedTechnologies: Array.from(this.technologies.values()).filter(tech => tech.isUnlocked).length,\n            activeProjects: Array.from(this.projects.values()).filter(p => p.status === 'active').length,\n            totalResearchPoints: this.totalResearchPoints,\n            discoveries: this.discoveries.length,\n            facilities: this.facilities.size,\n            scientists: this.scientists.size,\n            fieldProgress\n        };\n    }\n\n    /**\n     * Cancel research project\n     */\n    cancelResearch(projectId: string): boolean {\n        const project = this.projects.get(projectId);\n        if (!project || project.status !== 'active') return false;\n        \n        const technology = this.technologies.get(project.technologyId);\n        const facility = this.facilities.get(project.facilityId);\n        \n        if (technology) {\n            technology.isResearching = false;\n            technology.researchProgress = 0;\n        }\n        \n        if (facility) {\n            facility.currentProjects = facility.currentProjects.filter(id => id !== projectId);\n        }\n        \n        // Free scientists\n        project.assignedScientists.forEach(scientistId => {\n            const scientist = this.scientists.get(scientistId);\n            if (scientist) {\n                scientist.isAvailable = true;\n                scientist.assignedProject = undefined;\n                scientist.assignedFacility = undefined;\n            }\n        });\n        \n        project.status = 'failed';\n        \n        this.logger.info(`❌ Research cancelled: ${project.technologyId}`);\n        \n        return true;\n    }\n\n    /**\n     * Save research data\n     */\n    saveResearchData(): any {\n        return {\n            technologies: Array.from(this.technologies.entries()),\n            projects: Array.from(this.projects.entries()),\n            facilities: Array.from(this.facilities.entries()),\n            scientists: Array.from(this.scientists.entries()),\n            discoveries: this.discoveries,\n            totalResearchPoints: this.totalResearchPoints,\n            researchMultipliers: Array.from(this.researchMultipliers.entries())\n        };\n    }\n\n    /**\n     * Load research data\n     */\n    loadResearchData(data: any): void {\n        if (data.technologies) {\n            this.technologies = new Map(data.technologies);\n        }\n        if (data.projects) {\n            this.projects = new Map(data.projects);\n        }\n        if (data.facilities) {\n            this.facilities = new Map(data.facilities);\n        }\n        if (data.scientists) {\n            this.scientists = new Map(data.scientists);\n        }\n        if (data.discoveries) {\n            this.discoveries = data.discoveries;\n        }\n        if (data.totalResearchPoints) {\n            this.totalResearchPoints = data.totalResearchPoints;\n        }\n        if (data.researchMultipliers) {\n            this.researchMultipliers = new Map(data.researchMultipliers);\n        }\n        \n        this.logger.info('🔬 Research data loaded', {\n            technologies: this.technologies.size,\n            projects: this.projects.size\n        });\n    }\n}","/**\n * Crew Management System\n * Advanced crew mechanics with skills, assignments, morale, and ship operations\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\nimport { SkillCategory } from './PlayerProgression';\n\nexport enum CrewRole {\n    Captain = 'captain',\n    Pilot = 'pilot',\n    Engineer = 'engineer',\n    Scientist = 'scientist',\n    Security = 'security',\n    Medic = 'medic',\n    Communications = 'communications',\n    Navigator = 'navigator'\n}\n\nexport enum ShipStation {\n    Bridge = 'bridge',\n    Engineering = 'engineering',\n    MedBay = 'medbay',\n    ScienceLab = 'science_lab',\n    WeaponsControl = 'weapons_control',\n    Navigation = 'navigation',\n    Communications = 'communications',\n    Recreation = 'recreation'\n}\n\nexport enum CrewSkill {\n    Leadership = 'leadership',\n    Piloting = 'piloting',\n    Engineering = 'engineering',\n    Science = 'science',\n    Combat = 'combat',\n    Medicine = 'medicine',\n    Communications = 'communications',\n    Navigation = 'navigation'\n}\n\nexport interface CrewMember {\n    id: string;\n    name: string;\n    role: CrewRole;\n    species: string;\n    age: number;\n    \n    // Skills (0-100)\n    skills: Map<CrewSkill, number>;\n    \n    // Status\n    health: number; // 0-100\n    morale: number; // 0-100\n    fatigue: number; // 0-100\n    stress: number; // 0-100\n    \n    // Assignment\n    currentStation?: ShipStation;\n    assignedDuty?: string;\n    workEfficiency: number; // 0-2 multiplier\n    \n    // Personality traits\n    traits: CrewTrait[];\n    preferences: CrewPreferences;\n    relationships: Map<string, number>; // Other crew member ID -> relationship (-100 to 100)\n    \n    // Career\n    experience: number;\n    rank: number; // 1-10\n    specializations: string[];\n    commendations: string[];\n    \n    // Biography\n    background: string;\n    homeworld: string;\n    joinDate: number;\n}\n\nexport interface CrewTrait {\n    id: string;\n    name: string;\n    description: string;\n    effects: TraitEffect[];\n    rarity: 'common' | 'uncommon' | 'rare' | 'legendary';\n}\n\nexport interface TraitEffect {\n    type: 'skill_bonus' | 'morale_bonus' | 'stress_resistance' | 'efficiency_bonus' | 'relationship_modifier';\n    target?: CrewSkill | 'all';\n    value: number;\n    condition?: string;\n}\n\nexport interface CrewPreferences {\n    preferredStation: ShipStation;\n    preferredShift: 'alpha' | 'beta' | 'gamma';\n    personalityType: 'introvert' | 'extrovert' | 'ambivert';\n    workStyle: 'methodical' | 'creative' | 'aggressive' | 'collaborative';\n}\n\nexport interface StationAssignment {\n    stationId: ShipStation;\n    assignedCrew: string[];\n    maxCrew: number;\n    requiredSkills: CrewSkill[];\n    efficiency: number; // Based on crew performance\n    status: 'operational' | 'understaffed' | 'overstaffed' | 'unmanned';\n}\n\nexport interface CrewEvent {\n    id: string;\n    type: 'conflict' | 'romance' | 'achievement' | 'injury' | 'discovery' | 'promotion';\n    involvedCrew: string[];\n    description: string;\n    effects: { crewId: string, effect: string, value: number }[];\n    timestamp: number;\n    resolved: boolean;\n}\n\nexport interface CrewManagementEvents {\n    onCrewJoined?: (crew: CrewMember) => void;\n    onCrewLeft?: (crew: CrewMember, reason: string) => void;\n    onCrewPromoted?: (crew: CrewMember, newRank: number) => void;\n    onCrewEvent?: (event: CrewEvent) => void;\n    onStationEfficiencyChanged?: (station: ShipStation, efficiency: number) => void;\n    onMoraleAlert?: (averageMorale: number) => void;\n}\n\nexport class CrewManagement {\n    private crew: Map<string, CrewMember> = new Map();\n    private stations: Map<ShipStation, StationAssignment> = new Map();\n    private events: CrewEvent[] = [];\n    private traits: Map<string, CrewTrait> = new Map();\n    \n    // Ship-wide status\n    private shipMorale: number = 75;\n    private disciplineLevel: number = 80;\n    private crewQuarters: number = 10; // Maximum crew capacity\n    \n    private managementEvents: CrewManagementEvents;\n    private logger: Logger;\n\n    constructor(events: CrewManagementEvents = {}) {\n        this.logger = new Logger('CrewManagement');\n        this.managementEvents = events;\n        \n        this.initializeTraits();\n        this.initializeStations();\n        this.initializeStartingCrew();\n        \n        this.logger.info('👥 Crew management system initialized');\n    }\n\n    /**\n     * Initialize crew traits\n     */\n    private initializeTraits(): void {\n        const traits: CrewTrait[] = [\n            {\n                id: 'veteran',\n                name: 'Veteran',\n                description: 'Experienced crew member with enhanced skills',\n                effects: [\n                    { type: 'skill_bonus', target: 'all', value: 10 },\n                    { type: 'stress_resistance', value: 25 }\n                ],\n                rarity: 'uncommon'\n            },\n            {\n                id: 'natural_leader',\n                name: 'Natural Leader',\n                description: 'Inspires confidence in fellow crew members',\n                effects: [\n                    { type: 'skill_bonus', target: CrewSkill.Leadership, value: 20 },\n                    { type: 'morale_bonus', value: 10 }\n                ],\n                rarity: 'rare'\n            },\n            {\n                id: 'genius',\n                name: 'Genius',\n                description: 'Exceptional intellectual capabilities',\n                effects: [\n                    { type: 'skill_bonus', target: CrewSkill.Science, value: 30 },\n                    { type: 'efficiency_bonus', value: 50 }\n                ],\n                rarity: 'legendary'\n            },\n            {\n                id: 'ace_pilot',\n                name: 'Ace Pilot',\n                description: 'Exceptional piloting skills',\n                effects: [\n                    { type: 'skill_bonus', target: CrewSkill.Piloting, value: 25 },\n                    { type: 'efficiency_bonus', value: 30 }\n                ],\n                rarity: 'rare'\n            },\n            {\n                id: 'workaholic',\n                name: 'Workaholic',\n                description: 'Works longer without fatigue',\n                effects: [\n                    { type: 'efficiency_bonus', value: 20 },\n                    { type: 'stress_resistance', value: -10 }\n                ],\n                rarity: 'common'\n            },\n            {\n                id: 'diplomatic',\n                name: 'Diplomatic',\n                description: 'Excellent at resolving conflicts',\n                effects: [\n                    { type: 'relationship_modifier', value: 15 },\n                    { type: 'skill_bonus', target: CrewSkill.Communications, value: 15 }\n                ],\n                rarity: 'uncommon'\n            },\n            {\n                id: 'combat_veteran',\n                name: 'Combat Veteran',\n                description: 'Experienced in combat situations',\n                effects: [\n                    { type: 'skill_bonus', target: CrewSkill.Combat, value: 20 },\n                    { type: 'stress_resistance', value: 20 }\n                ],\n                rarity: 'uncommon'\n            },\n            {\n                id: 'perfectionist',\n                name: 'Perfectionist',\n                description: 'Produces higher quality work but slower',\n                effects: [\n                    { type: 'efficiency_bonus', value: 25 },\n                    { type: 'stress_resistance', value: -15 }\n                ],\n                rarity: 'common'\n            }\n        ];\n        \n        traits.forEach(trait => {\n            this.traits.set(trait.id, trait);\n        });\n    }\n\n    /**\n     * Initialize ship stations\n     */\n    private initializeStations(): void {\n        const stationConfigs: Array<{\n            station: ShipStation,\n            maxCrew: number,\n            requiredSkills: CrewSkill[]\n        }> = [\n            {\n                station: ShipStation.Bridge,\n                maxCrew: 3,\n                requiredSkills: [CrewSkill.Leadership, CrewSkill.Navigation]\n            },\n            {\n                station: ShipStation.Engineering,\n                maxCrew: 4,\n                requiredSkills: [CrewSkill.Engineering]\n            },\n            {\n                station: ShipStation.MedBay,\n                maxCrew: 2,\n                requiredSkills: [CrewSkill.Medicine]\n            },\n            {\n                station: ShipStation.ScienceLab,\n                maxCrew: 3,\n                requiredSkills: [CrewSkill.Science]\n            },\n            {\n                station: ShipStation.WeaponsControl,\n                maxCrew: 2,\n                requiredSkills: [CrewSkill.Combat]\n            },\n            {\n                station: ShipStation.Navigation,\n                maxCrew: 2,\n                requiredSkills: [CrewSkill.Navigation, CrewSkill.Piloting]\n            },\n            {\n                station: ShipStation.Communications,\n                maxCrew: 1,\n                requiredSkills: [CrewSkill.Communications]\n            },\n            {\n                station: ShipStation.Recreation,\n                maxCrew: 1,\n                requiredSkills: []\n            }\n        ];\n        \n        stationConfigs.forEach(config => {\n            this.stations.set(config.station, {\n                stationId: config.station,\n                assignedCrew: [],\n                maxCrew: config.maxCrew,\n                requiredSkills: config.requiredSkills,\n                efficiency: 0,\n                status: 'unmanned'\n            });\n        });\n    }\n\n    /**\n     * Initialize starting crew\n     */\n    private initializeStartingCrew(): void {\n        const startingCrew = [\n            {\n                name: 'Commander Sarah Cross',\n                role: CrewRole.Captain,\n                species: 'Human',\n                skills: new Map([\n                    [CrewSkill.Leadership, 85],\n                    [CrewSkill.Navigation, 70],\n                    [CrewSkill.Combat, 60]\n                ]),\n                traits: ['natural_leader'],\n                preferredStation: ShipStation.Bridge\n            },\n            {\n                name: 'Lieutenant Marcus Reid',\n                role: CrewRole.Pilot,\n                species: 'Human',\n                skills: new Map([\n                    [CrewSkill.Piloting, 90],\n                    [CrewSkill.Navigation, 75],\n                    [CrewSkill.Engineering, 45]\n                ]),\n                traits: ['ace_pilot'],\n                preferredStation: ShipStation.Navigation\n            },\n            {\n                name: 'Chief Engineer Zara Voss',\n                role: CrewRole.Engineer,\n                species: 'Centaurian',\n                skills: new Map([\n                    [CrewSkill.Engineering, 88],\n                    [CrewSkill.Science, 65],\n                    [CrewSkill.Combat, 30]\n                ]),\n                traits: ['perfectionist'],\n                preferredStation: ShipStation.Engineering\n            },\n            {\n                name: 'Dr. Elena Vasquez',\n                role: CrewRole.Medic,\n                species: 'Human',\n                skills: new Map([\n                    [CrewSkill.Medicine, 85],\n                    [CrewSkill.Science, 70],\n                    [CrewSkill.Communications, 55]\n                ]),\n                traits: ['diplomatic'],\n                preferredStation: ShipStation.MedBay\n            }\n        ];\n        \n        startingCrew.forEach((crewData, index) => {\n            const crew = this.createCrewMember(\n                crewData.name,\n                crewData.role,\n                crewData.species,\n                crewData.skills,\n                crewData.traits,\n                crewData.preferredStation\n            );\n            this.addCrewMember(crew);\n        });\n    }\n\n    /**\n     * Create new crew member\n     */\n    private createCrewMember(\n        name: string,\n        role: CrewRole,\n        species: string,\n        skills: Map<CrewSkill, number>,\n        traitIds: string[] = [],\n        preferredStation?: ShipStation\n    ): CrewMember {\n        const crewId = `crew_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n        \n        // Initialize all skills\n        const allSkills = new Map<CrewSkill, number>();\n        Object.values(CrewSkill).forEach(skill => {\n            allSkills.set(skill, skills.get(skill) || Math.floor(Math.random() * 30) + 20);\n        });\n        \n        // Apply trait bonuses\n        const memberTraits: CrewTrait[] = [];\n        traitIds.forEach(traitId => {\n            const trait = this.traits.get(traitId);\n            if (trait) {\n                memberTraits.push(trait);\n                trait.effects.forEach(effect => {\n                    if (effect.type === 'skill_bonus') {\n                        if (effect.target === 'all') {\n                            Object.values(CrewSkill).forEach(skill => {\n                                const current = allSkills.get(skill) || 0;\n                                allSkills.set(skill, Math.min(100, current + effect.value));\n                            });\n                        } else if (effect.target) {\n                            const current = allSkills.get(effect.target as CrewSkill) || 0;\n                            allSkills.set(effect.target as CrewSkill, Math.min(100, current + effect.value));\n                        }\n                    }\n                });\n            }\n        });\n        \n        return {\n            id: crewId,\n            name,\n            role,\n            species,\n            age: Math.floor(Math.random() * 40) + 25,\n            \n            skills: allSkills,\n            \n            health: 100,\n            morale: Math.floor(Math.random() * 20) + 70, // 70-90\n            fatigue: Math.floor(Math.random() * 20) + 10, // 10-30\n            stress: Math.floor(Math.random() * 15) + 5, // 5-20\n            \n            workEfficiency: 1.0,\n            \n            traits: memberTraits,\n            preferences: {\n                preferredStation: preferredStation || ShipStation.Bridge,\n                preferredShift: 'alpha',\n                personalityType: ['introvert', 'extrovert', 'ambivert'][Math.floor(Math.random() * 3)] as any,\n                workStyle: ['methodical', 'creative', 'aggressive', 'collaborative'][Math.floor(Math.random() * 4)] as any\n            },\n            relationships: new Map(),\n            \n            experience: Math.floor(Math.random() * 1000) + 500,\n            rank: Math.floor(Math.random() * 3) + 1,\n            specializations: [],\n            commendations: [],\n            \n            background: this.generateBackground(species, role),\n            homeworld: this.generateHomeworld(species),\n            joinDate: Date.now() - Math.floor(Math.random() * 365 * 24 * 60 * 60 * 1000) // Random date in past year\n        };\n    }\n\n    /**\n     * Generate crew background\n     */\n    private generateBackground(species: string, role: CrewRole): string {\n        const backgrounds = {\n            [CrewRole.Captain]: ['Former military officer', 'Merchant marine veteran', 'Academy graduate'],\n            [CrewRole.Pilot]: ['Test pilot', 'Racing pilot', 'Military pilot', 'Civilian transport pilot'],\n            [CrewRole.Engineer]: ['Shipyard worker', 'Research scientist', 'Maintenance chief', 'Technical specialist'],\n            [CrewRole.Scientist]: ['University researcher', 'Corporate scientist', 'Field researcher', 'Lab technician'],\n            [CrewRole.Security]: ['Military police', 'Corporate security', 'Bounty hunter', 'Law enforcement'],\n            [CrewRole.Medic]: ['Ship surgeon', 'Emergency medic', 'Research physician', 'Field medic'],\n            [CrewRole.Communications]: ['Signal analyst', 'Diplomatic attaché', 'Communications officer', 'Intelligence operative'],\n            [CrewRole.Navigator]: ['Star chart cartographer', 'Deep space navigator', 'Survey specialist', 'Astrogation expert']\n        };\n        \n        const roleBackgrounds = backgrounds[role] || ['General crew member'];\n        return roleBackgrounds[Math.floor(Math.random() * roleBackgrounds.length)];\n    }\n\n    /**\n     * Generate homeworld\n     */\n    private generateHomeworld(species: string): string {\n        const homeworlds = {\n            'Human': ['Earth', 'Mars', 'Alpha Centauri', 'New Terra', 'Proxima Station'],\n            'Centaurian': ['Centauri Prime', 'Alpha Station', 'Proxima Colony'],\n            'Vulcan': ['Vulcan', 'New Vulcan', 'Vulcan Colony Alpha'],\n            'Andorian': ['Andoria', 'Andorian Outpost', 'Ice Station Beta']\n        };\n        \n        const speciesWorlds = (homeworlds as any)[species] || homeworlds['Human'];\n        return speciesWorlds[Math.floor(Math.random() * speciesWorlds.length)];\n    }\n\n    /**\n     * Add crew member to ship\n     */\n    addCrewMember(crew: CrewMember): boolean {\n        if (this.crew.size >= this.crewQuarters) {\n            this.logger.warn('Cannot add crew member: quarters at capacity');\n            return false;\n        }\n        \n        this.crew.set(crew.id, crew);\n        \n        // Initialize relationships with existing crew\n        for (const existingCrew of this.crew.values()) {\n            if (existingCrew.id !== crew.id) {\n                const relationship = this.calculateInitialRelationship(crew, existingCrew);\n                crew.relationships.set(existingCrew.id, relationship);\n                existingCrew.relationships.set(crew.id, relationship);\n            }\n        }\n        \n        this.managementEvents.onCrewJoined?.(crew);\n        \n        this.logger.info(`👤 Crew member joined: ${crew.name}`, {\n            role: crew.role,\n            species: crew.species,\n            traits: crew.traits.map(t => t.name)\n        });\n        \n        return true;\n    }\n\n    /**\n     * Calculate initial relationship between crew members\n     */\n    private calculateInitialRelationship(crew1: CrewMember, crew2: CrewMember): number {\n        let relationship = 0;\n        \n        // Species compatibility\n        if (crew1.species === crew2.species) {\n            relationship += 10;\n        }\n        \n        // Personality compatibility\n        if (crew1.preferences.personalityType === crew2.preferences.personalityType) {\n            relationship += 5;\n        }\n        \n        // Work style compatibility\n        if (crew1.preferences.workStyle === crew2.preferences.workStyle) {\n            relationship += 5;\n        } else if (\n            (crew1.preferences.workStyle === 'collaborative' || crew2.preferences.workStyle === 'collaborative') &&\n            crew1.preferences.workStyle !== 'aggressive' && crew2.preferences.workStyle !== 'aggressive'\n        ) {\n            relationship += 3;\n        }\n        \n        // Random factor\n        relationship += Math.floor(Math.random() * 21) - 10; // -10 to +10\n        \n        return Math.max(-50, Math.min(50, relationship)); // Clamp to -50 to +50\n    }\n\n    /**\n     * Assign crew member to station\n     */\n    assignCrewToStation(crewId: string, station: ShipStation): boolean {\n        const crew = this.crew.get(crewId);\n        const stationData = this.stations.get(station);\n        \n        if (!crew || !stationData) {\n            this.logger.warn('Invalid crew or station for assignment', { crewId, station });\n            return false;\n        }\n        \n        // Remove from current station\n        if (crew.currentStation) {\n            this.removeCrewFromStation(crewId, crew.currentStation);\n        }\n        \n        // Check capacity\n        if (stationData.assignedCrew.length >= stationData.maxCrew) {\n            this.logger.warn('Station at capacity', { station });\n            return false;\n        }\n        \n        // Assign to new station\n        crew.currentStation = station;\n        stationData.assignedCrew.push(crewId);\n        \n        // Calculate work efficiency based on skills and preferences\n        crew.workEfficiency = this.calculateWorkEfficiency(crew, station);\n        \n        // Update station efficiency\n        this.updateStationEfficiency(station);\n        \n        this.logger.info(`👥 Crew assigned: ${crew.name} → ${station}`, {\n            efficiency: crew.workEfficiency.toFixed(2)\n        });\n        \n        return true;\n    }\n\n    /**\n     * Remove crew from station\n     */\n    private removeCrewFromStation(crewId: string, station: ShipStation): void {\n        const stationData = this.stations.get(station);\n        if (stationData) {\n            stationData.assignedCrew = stationData.assignedCrew.filter(id => id !== crewId);\n            this.updateStationEfficiency(station);\n        }\n        \n        const crew = this.crew.get(crewId);\n        if (crew) {\n            crew.currentStation = undefined;\n            crew.workEfficiency = 1.0;\n        }\n    }\n\n    /**\n     * Calculate work efficiency for crew at station\n     */\n    private calculateWorkEfficiency(crew: CrewMember, station: ShipStation): number {\n        let efficiency = 1.0;\n        \n        // Skill-based efficiency\n        const stationData = this.stations.get(station);\n        if (stationData) {\n            let skillTotal = 0;\n            let skillCount = 0;\n            \n            stationData.requiredSkills.forEach(skill => {\n                const skillLevel = crew.skills.get(skill) || 0;\n                skillTotal += skillLevel;\n                skillCount++;\n            });\n            \n            if (skillCount > 0) {\n                const averageSkill = skillTotal / skillCount;\n                efficiency = 0.5 + (averageSkill / 100) * 1.5; // 0.5 to 2.0 range\n            }\n        }\n        \n        // Preference bonus\n        if (crew.preferences.preferredStation === station) {\n            efficiency *= 1.2;\n        }\n        \n        // Health and morale effects\n        efficiency *= (crew.health / 100);\n        efficiency *= (crew.morale / 100);\n        efficiency *= (1 - crew.fatigue / 200); // Fatigue has less impact\n        efficiency *= (1 - crew.stress / 150); // Stress has moderate impact\n        \n        // Trait effects\n        crew.traits.forEach(trait => {\n            trait.effects.forEach(effect => {\n                if (effect.type === 'efficiency_bonus') {\n                    efficiency *= (1 + effect.value / 100);\n                }\n            });\n        });\n        \n        return Math.max(0.1, Math.min(2.5, efficiency)); // Clamp to 0.1-2.5\n    }\n\n    /**\n     * Update station efficiency based on assigned crew\n     */\n    private updateStationEfficiency(station: ShipStation): void {\n        const stationData = this.stations.get(station);\n        if (!stationData) return;\n        \n        if (stationData.assignedCrew.length === 0) {\n            stationData.efficiency = 0;\n            stationData.status = 'unmanned';\n        } else {\n            let totalEfficiency = 0;\n            let crewCount = 0;\n            \n            stationData.assignedCrew.forEach(crewId => {\n                const crew = this.crew.get(crewId);\n                if (crew) {\n                    totalEfficiency += crew.workEfficiency;\n                    crewCount++;\n                }\n            });\n            \n            if (crewCount > 0) {\n                stationData.efficiency = totalEfficiency / crewCount;\n                \n                // Determine status\n                const optimalCrew = Math.ceil(stationData.maxCrew * 0.75);\n                if (crewCount < optimalCrew) {\n                    stationData.status = 'understaffed';\n                } else if (crewCount > stationData.maxCrew) {\n                    stationData.status = 'overstaffed';\n                    stationData.efficiency *= 0.8; // Overcrowding penalty\n                } else {\n                    stationData.status = 'operational';\n                }\n            }\n        }\n        \n        this.managementEvents.onStationEfficiencyChanged?.(station, stationData.efficiency);\n    }\n\n    /**\n     * Update crew system\n     */\n    update(deltaTime: number): void {\n        this.updateCrewStatus(deltaTime);\n        this.updateRelationships(deltaTime);\n        this.checkCrewEvents();\n        this.updateShipMorale();\n    }\n\n    /**\n     * Update crew status (health, morale, fatigue, stress)\n     */\n    private updateCrewStatus(deltaTime: number): void {\n        for (const crew of this.crew.values()) {\n            // Fatigue increases during work\n            if (crew.currentStation) {\n                crew.fatigue = Math.min(100, crew.fatigue + deltaTime * 0.02);\n            } else {\n                // Rest reduces fatigue\n                crew.fatigue = Math.max(0, crew.fatigue - deltaTime * 0.05);\n            }\n            \n            // Stress management\n            let stressChange = 0;\n            \n            // Work stress\n            if (crew.currentStation) {\n                const stationData = this.stations.get(crew.currentStation);\n                if (stationData && stationData.status === 'understaffed') {\n                    stressChange += deltaTime * 0.03;\n                }\n            }\n            \n            // Relationship stress\n            let relationshipStress = 0;\n            let relationshipCount = 0;\n            crew.relationships.forEach(relationship => {\n                relationshipStress += relationship;\n                relationshipCount++;\n            });\n            \n            if (relationshipCount > 0) {\n                const avgRelationship = relationshipStress / relationshipCount;\n                if (avgRelationship < -20) {\n                    stressChange += deltaTime * 0.02;\n                } else if (avgRelationship > 20) {\n                    stressChange -= deltaTime * 0.01;\n                }\n            }\n            \n            // Apply trait effects\n            crew.traits.forEach(trait => {\n                trait.effects.forEach(effect => {\n                    if (effect.type === 'stress_resistance') {\n                        stressChange *= (1 - effect.value / 100);\n                    }\n                });\n            });\n            \n            crew.stress = Math.max(0, Math.min(100, crew.stress + stressChange));\n            \n            // Morale calculation\n            let moraleChange = 0;\n            \n            // Base morale decay\n            moraleChange -= deltaTime * 0.01;\n            \n            // Station assignment morale\n            if (crew.currentStation === crew.preferences.preferredStation) {\n                moraleChange += deltaTime * 0.02;\n            }\n            \n            // Health affects morale\n            if (crew.health < 80) {\n                moraleChange -= deltaTime * 0.015;\n            }\n            \n            // Stress affects morale\n            if (crew.stress > 60) {\n                moraleChange -= deltaTime * 0.02;\n            }\n            \n            // Apply trait effects\n            crew.traits.forEach(trait => {\n                trait.effects.forEach(effect => {\n                    if (effect.type === 'morale_bonus') {\n                        moraleChange += deltaTime * (effect.value / 1000);\n                    }\n                });\n            });\n            \n            crew.morale = Math.max(0, Math.min(100, crew.morale + moraleChange));\n            \n            // Update work efficiency\n            if (crew.currentStation) {\n                crew.workEfficiency = this.calculateWorkEfficiency(crew, crew.currentStation);\n            }\n        }\n    }\n\n    /**\n     * Update crew relationships\n     */\n    private updateRelationships(deltaTime: number): void {\n        const crewArray = Array.from(this.crew.values());\n        \n        for (let i = 0; i < crewArray.length; i++) {\n            for (let j = i + 1; j < crewArray.length; j++) {\n                const crew1 = crewArray[i];\n                const crew2 = crewArray[j];\n                \n                // Working together improves relationships slowly\n                if (crew1.currentStation === crew2.currentStation && crew1.currentStation) {\n                    const improvement = deltaTime * 0.005;\n                    this.modifyRelationship(crew1.id, crew2.id, improvement);\n                }\n                \n                // Random small relationship changes\n                if (Math.random() < 0.001) { // Very rare random events\n                    const change = (Math.random() - 0.5) * 2; // -1 to +1\n                    this.modifyRelationship(crew1.id, crew2.id, change);\n                }\n            }\n        }\n    }\n\n    /**\n     * Modify relationship between two crew members\n     */\n    private modifyRelationship(crewId1: string, crewId2: string, change: number): void {\n        const crew1 = this.crew.get(crewId1);\n        const crew2 = this.crew.get(crewId2);\n        \n        if (!crew1 || !crew2) return;\n        \n        const current1 = crew1.relationships.get(crewId2) || 0;\n        const current2 = crew2.relationships.get(crewId1) || 0;\n        \n        crew1.relationships.set(crewId2, Math.max(-100, Math.min(100, current1 + change)));\n        crew2.relationships.set(crewId1, Math.max(-100, Math.min(100, current2 + change)));\n    }\n\n    /**\n     * Check for random crew events\n     */\n    private checkCrewEvents(): void {\n        if (Math.random() < 0.0005) { // Very rare events\n            this.generateCrewEvent();\n        }\n    }\n\n    /**\n     * Generate random crew event\n     */\n    private generateCrewEvent(): void {\n        const crewArray = Array.from(this.crew.values());\n        if (crewArray.length < 2) return;\n        \n        const eventTypes = ['conflict', 'achievement', 'discovery', 'promotion'];\n        const eventType = eventTypes[Math.floor(Math.random() * eventTypes.length)] as CrewEvent['type'];\n        \n        let event: CrewEvent;\n        \n        switch (eventType) {\n            case 'conflict':\n                event = this.generateConflictEvent(crewArray);\n                break;\n            case 'achievement':\n                event = this.generateAchievementEvent(crewArray);\n                break;\n            case 'discovery':\n                event = this.generateDiscoveryEvent(crewArray);\n                break;\n            case 'promotion':\n                event = this.generatePromotionEvent(crewArray);\n                break;\n            default:\n                return;\n        }\n        \n        this.events.push(event);\n        this.managementEvents.onCrewEvent?.(event);\n        \n        // Apply event effects\n        event.effects.forEach(effect => {\n            const crew = this.crew.get(effect.crewId);\n            if (crew) {\n                switch (effect.effect) {\n                    case 'morale':\n                        crew.morale = Math.max(0, Math.min(100, crew.morale + effect.value));\n                        break;\n                    case 'stress':\n                        crew.stress = Math.max(0, Math.min(100, crew.stress + effect.value));\n                        break;\n                    case 'experience':\n                        crew.experience += effect.value;\n                        break;\n                }\n            }\n        });\n        \n        this.logger.info(`📰 Crew event: ${event.description}`, {\n            type: event.type,\n            involvedCrew: event.involvedCrew.length\n        });\n    }\n\n    /**\n     * Generate conflict event\n     */\n    private generateConflictEvent(crewArray: CrewMember[]): CrewEvent {\n        const crew1 = crewArray[Math.floor(Math.random() * crewArray.length)];\n        const crew2 = crewArray[Math.floor(Math.random() * crewArray.length)];\n        \n        if (crew1.id === crew2.id) {\n            return this.generateConflictEvent(crewArray); // Retry\n        }\n        \n        const conflictTypes = [\n            'disagreement over procedures',\n            'personality clash',\n            'resource allocation dispute',\n            'work methodology conflict'\n        ];\n        \n        const conflictType = conflictTypes[Math.floor(Math.random() * conflictTypes.length)];\n        \n        return {\n            id: `event_${Date.now()}`,\n            type: 'conflict',\n            involvedCrew: [crew1.id, crew2.id],\n            description: `${crew1.name} and ${crew2.name} had a ${conflictType}`,\n            effects: [\n                { crewId: crew1.id, effect: 'morale', value: -10 },\n                { crewId: crew2.id, effect: 'morale', value: -10 },\n                { crewId: crew1.id, effect: 'stress', value: 15 },\n                { crewId: crew2.id, effect: 'stress', value: 15 }\n            ],\n            timestamp: Date.now(),\n            resolved: false\n        };\n    }\n\n    /**\n     * Generate achievement event\n     */\n    private generateAchievementEvent(crewArray: CrewMember[]): CrewEvent {\n        const crew = crewArray[Math.floor(Math.random() * crewArray.length)];\n        \n        const achievements = [\n            'exceptional performance during crisis',\n            'innovative solution to technical problem',\n            'outstanding leadership during difficult situation',\n            'breakthrough in research project'\n        ];\n        \n        const achievement = achievements[Math.floor(Math.random() * achievements.length)];\n        \n        return {\n            id: `event_${Date.now()}`,\n            type: 'achievement',\n            involvedCrew: [crew.id],\n            description: `${crew.name} demonstrated ${achievement}`,\n            effects: [\n                { crewId: crew.id, effect: 'morale', value: 20 },\n                { crewId: crew.id, effect: 'experience', value: 100 }\n            ],\n            timestamp: Date.now(),\n            resolved: true\n        };\n    }\n\n    /**\n     * Generate discovery event\n     */\n    private generateDiscoveryEvent(crewArray: CrewMember[]): CrewEvent {\n        const crew = crewArray[Math.floor(Math.random() * crewArray.length)];\n        \n        const discoveries = [\n            'discovered new mineral composition',\n            'identified unknown signal pattern',\n            'found evidence of ancient civilization',\n            'detected rare astronomical phenomenon'\n        ];\n        \n        const discovery = discoveries[Math.floor(Math.random() * discoveries.length)];\n        \n        return {\n            id: `event_${Date.now()}`,\n            type: 'discovery',\n            involvedCrew: [crew.id],\n            description: `${crew.name} ${discovery}`,\n            effects: [\n                { crewId: crew.id, effect: 'morale', value: 15 },\n                { crewId: crew.id, effect: 'experience', value: 75 }\n            ],\n            timestamp: Date.now(),\n            resolved: true\n        };\n    }\n\n    /**\n     * Generate promotion event\n     */\n    private generatePromotionEvent(crewArray: CrewMember[]): CrewEvent {\n        const eligibleCrew = crewArray.filter(crew => crew.rank < 10 && crew.experience > 1000);\n        if (eligibleCrew.length === 0) return this.generateAchievementEvent(crewArray);\n        \n        const crew = eligibleCrew[Math.floor(Math.random() * eligibleCrew.length)];\n        crew.rank++;\n        \n        return {\n            id: `event_${Date.now()}`,\n            type: 'promotion',\n            involvedCrew: [crew.id],\n            description: `${crew.name} has been promoted to rank ${crew.rank}`,\n            effects: [\n                { crewId: crew.id, effect: 'morale', value: 25 }\n            ],\n            timestamp: Date.now(),\n            resolved: true\n        };\n    }\n\n    /**\n     * Update ship-wide morale\n     */\n    private updateShipMorale(): void {\n        if (this.crew.size === 0) {\n            this.shipMorale = 50;\n            return;\n        }\n        \n        let totalMorale = 0;\n        for (const crew of this.crew.values()) {\n            totalMorale += crew.morale;\n        }\n        \n        const averageMorale = totalMorale / this.crew.size;\n        \n        // Smooth transition\n        this.shipMorale = this.shipMorale * 0.9 + averageMorale * 0.1;\n        \n        // Check for morale alerts\n        if (this.shipMorale < 40) {\n            this.managementEvents.onMoraleAlert?.(this.shipMorale);\n        }\n    }\n\n    /**\n     * Get crew member by ID\n     */\n    getCrewMember(crewId: string): CrewMember | null {\n        return this.crew.get(crewId) || null;\n    }\n\n    /**\n     * Get all crew members\n     */\n    getAllCrew(): CrewMember[] {\n        return Array.from(this.crew.values());\n    }\n\n    /**\n     * Get crew by role\n     */\n    getCrewByRole(role: CrewRole): CrewMember[] {\n        return Array.from(this.crew.values()).filter(crew => crew.role === role);\n    }\n\n    /**\n     * Get crew by station\n     */\n    getCrewByStation(station: ShipStation): CrewMember[] {\n        return Array.from(this.crew.values()).filter(crew => crew.currentStation === station);\n    }\n\n    /**\n     * Get station information\n     */\n    getStation(station: ShipStation): StationAssignment | null {\n        return this.stations.get(station) || null;\n    }\n\n    /**\n     * Get all stations\n     */\n    getAllStations(): StationAssignment[] {\n        return Array.from(this.stations.values());\n    }\n\n    /**\n     * Get recent crew events\n     */\n    getRecentEvents(limit: number = 10): CrewEvent[] {\n        return this.events\n            .sort((a, b) => b.timestamp - a.timestamp)\n            .slice(0, limit);\n    }\n\n    /**\n     * Get crew management statistics\n     */\n    getCrewStats(): {\n        totalCrew: number;\n        maxCrew: number;\n        averageMorale: number;\n        averageHealth: number;\n        averageFatigue: number;\n        averageStress: number;\n        stationEfficiency: { [station: string]: number };\n        roleDistribution: { [role: string]: number };\n        shipMorale: number;\n        disciplineLevel: number;\n    } {\n        const totalCrew = this.crew.size;\n        const maxCrew = this.crewQuarters;\n        \n        let totalMorale = 0;\n        let totalHealth = 0;\n        let totalFatigue = 0;\n        let totalStress = 0;\n        \n        const roleDistribution: { [role: string]: number } = {};\n        \n        for (const crew of this.crew.values()) {\n            totalMorale += crew.morale;\n            totalHealth += crew.health;\n            totalFatigue += crew.fatigue;\n            totalStress += crew.stress;\n            \n            roleDistribution[crew.role] = (roleDistribution[crew.role] || 0) + 1;\n        }\n        \n        const stationEfficiency: { [station: string]: number } = {};\n        for (const [station, data] of this.stations.entries()) {\n            stationEfficiency[station] = data.efficiency;\n        }\n        \n        return {\n            totalCrew,\n            maxCrew,\n            averageMorale: totalCrew > 0 ? totalMorale / totalCrew : 0,\n            averageHealth: totalCrew > 0 ? totalHealth / totalCrew : 0,\n            averageFatigue: totalCrew > 0 ? totalFatigue / totalCrew : 0,\n            averageStress: totalCrew > 0 ? totalStress / totalCrew : 0,\n            stationEfficiency,\n            roleDistribution,\n            shipMorale: this.shipMorale,\n            disciplineLevel: this.disciplineLevel\n        };\n    }\n\n    /**\n     * Save crew data\n     */\n    saveCrewData(): any {\n        return {\n            crew: Array.from(this.crew.entries()).map(([id, crew]) => [\n                id,\n                {\n                    ...crew,\n                    skills: Array.from(crew.skills.entries()),\n                    relationships: Array.from(crew.relationships.entries())\n                }\n            ]),\n            stations: Array.from(this.stations.entries()),\n            events: this.events,\n            shipMorale: this.shipMorale,\n            disciplineLevel: this.disciplineLevel,\n            crewQuarters: this.crewQuarters\n        };\n    }\n\n    /**\n     * Load crew data\n     */\n    loadCrewData(data: any): void {\n        if (data.crew) {\n            this.crew = new Map(data.crew.map(([id, crew]: [string, any]) => [\n                id,\n                {\n                    ...crew,\n                    skills: new Map(crew.skills),\n                    relationships: new Map(crew.relationships)\n                }\n            ]));\n        }\n        if (data.stations) {\n            this.stations = new Map(data.stations);\n        }\n        if (data.events) {\n            this.events = data.events;\n        }\n        if (data.shipMorale !== undefined) {\n            this.shipMorale = data.shipMorale;\n        }\n        if (data.disciplineLevel !== undefined) {\n            this.disciplineLevel = data.disciplineLevel;\n        }\n        if (data.crewQuarters !== undefined) {\n            this.crewQuarters = data.crewQuarters;\n        }\n        \n        this.logger.info('👥 Crew data loaded', {\n            crewCount: this.crew.size,\n            events: this.events.length\n        });\n    }\n}","/**\n * Diplomacy System\n * Advanced diplomatic interactions with factions, reputation, and negotiations\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\nimport { CrewMember } from '@rpg/CrewManagement';\n\nexport enum FactionType {\n    Government = 'government',\n    Corporate = 'corporate',\n    Military = 'military',\n    Pirates = 'pirates',\n    Traders = 'traders',\n    Scientists = 'scientists',\n    Aliens = 'aliens',\n    Rebels = 'rebels',\n    Religious = 'religious',\n    Independent = 'independent'\n}\n\nexport enum DiplomaticStance {\n    Allied = 'allied',           // +80 to +100\n    Friendly = 'friendly',       // +40 to +79\n    Neutral = 'neutral',         // -39 to +39\n    Unfriendly = 'unfriendly',   // -79 to -40\n    Hostile = 'hostile',         // -100 to -80\n    War = 'war'                  // Active warfare\n}\n\nexport enum NegotiationType {\n    Trade = 'trade',\n    Information = 'information',\n    SafePassage = 'safe_passage',\n    Alliance = 'alliance',\n    Ceasefire = 'ceasefire',\n    Technology = 'technology',\n    Territory = 'territory',\n    Tribute = 'tribute'\n}\n\nexport interface Faction {\n    id: string;\n    name: string;\n    type: FactionType;\n    description: string;\n    \n    // Political attributes\n    government: 'democracy' | 'autocracy' | 'oligarchy' | 'theocracy' | 'anarchy';\n    ideology: 'expansionist' | 'isolationist' | 'pacifist' | 'militaristic' | 'commercial';\n    \n    // Reputation and relationships\n    reputation: number; // -100 to +100\n    stance: DiplomaticStance;\n    trustLevel: number; // 0-100, affects negotiation success\n    \n    // Faction characteristics\n    power: number; // 1-100, military/economic strength\n    territory: string[]; // Controlled systems\n    resources: FactionResources;\n    \n    // Diplomatic history\n    treaties: Treaty[];\n    recentActions: DiplomaticAction[];\n    \n    // AI personality\n    personality: FactionPersonality;\n    \n    // Status\n    isActive: boolean;\n    lastContact: number;\n    homeSystem: string;\n}\n\nexport interface FactionResources {\n    military: number;\n    economic: number;\n    technological: number;\n    influence: number;\n}\n\nexport interface FactionPersonality {\n    aggression: number; // 0-100\n    cooperation: number; // 0-100\n    trustworthiness: number; // 0-100\n    pride: number; // 0-100\n    greed: number; // 0-100\n    xenophobia: number; // 0-100 (for aliens)\n}\n\nexport interface Treaty {\n    id: string;\n    type: 'trade' | 'non_aggression' | 'alliance' | 'technology_sharing' | 'territory';\n    participants: string[]; // Faction IDs\n    terms: TreatyTerm[];\n    startDate: number;\n    duration: number; // -1 for permanent\n    status: 'active' | 'violated' | 'expired' | 'suspended';\n}\n\nexport interface TreatyTerm {\n    type: 'trade_bonus' | 'military_support' | 'information_sharing' | 'territory_access' | 'tribute';\n    beneficiary: string; // Faction ID\n    value: number;\n    description: string;\n}\n\nexport interface DiplomaticAction {\n    id: string;\n    type: 'contact' | 'trade' | 'threat' | 'gift' | 'treaty_offer' | 'treaty_violation' | 'war_declaration';\n    actor: string; // Faction ID\n    target: string; // Faction ID\n    timestamp: number;\n    description: string;\n    reputationChange: number;\n    successful: boolean;\n}\n\nexport interface NegotiationSession {\n    id: string;\n    participants: string[]; // Faction IDs\n    type: NegotiationType;\n    currentOffer: NegotiationOffer;\n    counterOffer?: NegotiationOffer;\n    \n    // Negotiation state\n    rounds: number;\n    maxRounds: number;\n    status: 'active' | 'successful' | 'failed' | 'abandoned';\n    \n    // Modifiers\n    playerSkill: number; // Communications/Charisma bonuses\n    crewBonus: number; // Diplomatic crew bonuses\n    reputationModifier: number;\n}\n\nexport interface NegotiationOffer {\n    proposer: string; // Faction ID\n    terms: OfferTerm[];\n    totalValue: number; // AI-calculated offer value\n    priority: number; // How much proposer wants this\n}\n\nexport interface OfferTerm {\n    type: 'credits' | 'items' | 'information' | 'territory' | 'technology' | 'service' | 'protection';\n    giver: string; // Faction ID\n    receiver: string; // Faction ID\n    description: string;\n    value: number; // AI-calculated worth\n    items?: { itemId: string, quantity: number }[];\n}\n\nexport interface DiplomaticEncounter {\n    id: string;\n    factionId: string;\n    type: 'first_contact' | 'routine_patrol' | 'distress_call' | 'territorial_dispute' | 'trade_opportunity';\n    location: { x: number, y: number };\n    \n    // Encounter details\n    description: string;\n    availableActions: EncounterAction[];\n    consequences: EncounterConsequence[];\n    \n    // Status\n    isActive: boolean;\n    resolution?: 'peaceful' | 'hostile' | 'neutral' | 'beneficial';\n    timestamp: number;\n}\n\nexport interface EncounterAction {\n    id: string;\n    name: string;\n    description: string;\n    requirements?: ActionRequirement[];\n    skillCheck?: { skill: string, difficulty: number };\n    consequences: EncounterConsequence[];\n}\n\nexport interface ActionRequirement {\n    type: 'reputation' | 'crew_skill' | 'technology' | 'item' | 'treaty';\n    value: number | string;\n    description: string;\n}\n\nexport interface EncounterConsequence {\n    type: 'reputation' | 'resources' | 'information' | 'combat' | 'treaty_offer' | 'trade_opportunity';\n    factionId: string;\n    value: number;\n    description: string;\n    items?: { itemId: string, quantity: number }[];\n}\n\nexport interface DiplomacyEvents {\n    onFirstContact?: (faction: Faction) => void;\n    onReputationChanged?: (factionId: string, oldRep: number, newRep: number) => void;\n    onTreatyProposed?: (treaty: Treaty) => void;\n    onTreatyRatified?: (treaty: Treaty) => void;\n    onWarDeclared?: (aggressor: string, target: string) => void;\n    onNegotiationStarted?: (session: NegotiationSession) => void;\n    onNegotiationCompleted?: (session: NegotiationSession, success: boolean) => void;\n    onEncounterGenerated?: (encounter: DiplomaticEncounter) => void;\n}\n\nexport class DiplomacySystem {\n    private factions: Map<string, Faction> = new Map();\n    private treaties: Map<string, Treaty> = new Map();\n    private negotiations: Map<string, NegotiationSession> = new Map();\n    private encounters: Map<string, DiplomaticEncounter> = new Map();\n    private diplomaticActions: DiplomaticAction[] = [];\n    \n    // Player faction\n    private readonly PLAYER_FACTION_ID = 'player';\n    \n    private events: DiplomacyEvents;\n    private logger: Logger;\n\n    constructor(events: DiplomacyEvents = {}) {\n        this.logger = new Logger('DiplomacySystem');\n        this.events = events;\n        \n        this.initializeFactions();\n        this.initializePlayerFaction();\n        \n        this.logger.info('🤝 Diplomacy system initialized');\n    }\n\n    /**\n     * Initialize major factions\n     */\n    private initializeFactions(): void {\n        const factions: Faction[] = [\n            {\n                id: 'terran_federation',\n                name: 'Terran Federation',\n                type: FactionType.Government,\n                description: 'Democratic alliance of human colonies',\n                government: 'democracy',\n                ideology: 'expansionist',\n                reputation: 25,\n                stance: DiplomaticStance.Friendly,\n                trustLevel: 70,\n                power: 85,\n                territory: ['sol_system', 'alpha_centauri', 'proxima_station'],\n                resources: {\n                    military: 80,\n                    economic: 90,\n                    technological: 85,\n                    influence: 75\n                },\n                treaties: [],\n                recentActions: [],\n                personality: {\n                    aggression: 30,\n                    cooperation: 80,\n                    trustworthiness: 85,\n                    pride: 60,\n                    greed: 40,\n                    xenophobia: 20\n                },\n                isActive: true,\n                lastContact: 0,\n                homeSystem: 'sol_system'\n            },\n            {\n                id: 'zephyrian_empire',\n                name: 'Zephyrian Empire',\n                type: FactionType.Aliens,\n                description: 'Ancient alien empire with advanced technology',\n                government: 'autocracy',\n                ideology: 'isolationist',\n                reputation: -10,\n                stance: DiplomaticStance.Neutral,\n                trustLevel: 45,\n                power: 95,\n                territory: ['zephyr_prime', 'nebula_omega', 'crystal_worlds'],\n                resources: {\n                    military: 90,\n                    economic: 70,\n                    technological: 100,\n                    influence: 60\n                },\n                treaties: [],\n                recentActions: [],\n                personality: {\n                    aggression: 50,\n                    cooperation: 30,\n                    trustworthiness: 60,\n                    pride: 90,\n                    greed: 20,\n                    xenophobia: 70\n                },\n                isActive: true,\n                lastContact: 0,\n                homeSystem: 'zephyr_prime'\n            },\n            {\n                id: 'crimson_cartel',\n                name: 'Crimson Cartel',\n                type: FactionType.Pirates,\n                description: 'Notorious pirate confederation',\n                government: 'anarchy',\n                ideology: 'militaristic',\n                reputation: -60,\n                stance: DiplomaticStance.Hostile,\n                trustLevel: 15,\n                power: 45,\n                territory: ['asteroid_belt_7', 'rogue_station'],\n                resources: {\n                    military: 70,\n                    economic: 40,\n                    technological: 30,\n                    influence: 25\n                },\n                treaties: [],\n                recentActions: [],\n                personality: {\n                    aggression: 85,\n                    cooperation: 20,\n                    trustworthiness: 25,\n                    pride: 70,\n                    greed: 90,\n                    xenophobia: 40\n                },\n                isActive: true,\n                lastContact: 0,\n                homeSystem: 'asteroid_belt_7'\n            },\n            {\n                id: 'hegemony_corp',\n                name: 'Hegemony Corporation',\n                type: FactionType.Corporate,\n                description: 'Mega-corporation controlling trade routes',\n                government: 'oligarchy',\n                ideology: 'commercial',\n                reputation: 15,\n                stance: DiplomaticStance.Neutral,\n                trustLevel: 55,\n                power: 75,\n                territory: ['trade_hub_alpha', 'mining_sector_12'],\n                resources: {\n                    military: 50,\n                    economic: 100,\n                    technological: 70,\n                    influence: 80\n                },\n                treaties: [],\n                recentActions: [],\n                personality: {\n                    aggression: 40,\n                    cooperation: 60,\n                    trustworthiness: 50,\n                    pride: 50,\n                    greed: 85,\n                    xenophobia: 30\n                },\n                isActive: true,\n                lastContact: 0,\n                homeSystem: 'trade_hub_alpha'\n            },\n            {\n                id: 'void_seekers',\n                name: 'Void Seekers',\n                type: FactionType.Religious,\n                description: 'Mystical order seeking ancient knowledge',\n                government: 'theocracy',\n                ideology: 'pacifist',\n                reputation: 5,\n                stance: DiplomaticStance.Neutral,\n                trustLevel: 75,\n                power: 30,\n                territory: ['sanctuary_worlds'],\n                resources: {\n                    military: 20,\n                    economic: 40,\n                    technological: 60,\n                    influence: 70\n                },\n                treaties: [],\n                recentActions: [],\n                personality: {\n                    aggression: 10,\n                    cooperation: 70,\n                    trustworthiness: 90,\n                    pride: 40,\n                    greed: 10,\n                    xenophobia: 5\n                },\n                isActive: true,\n                lastContact: 0,\n                homeSystem: 'sanctuary_worlds'\n            },\n            {\n                id: 'liberation_front',\n                name: 'Liberation Front',\n                type: FactionType.Rebels,\n                description: 'Revolutionary movement fighting oppression',\n                government: 'democracy',\n                ideology: 'militaristic',\n                reputation: -20,\n                stance: DiplomaticStance.Unfriendly,\n                trustLevel: 40,\n                power: 35,\n                territory: ['frontier_colonies'],\n                resources: {\n                    military: 60,\n                    economic: 30,\n                    technological: 40,\n                    influence: 50\n                },\n                treaties: [],\n                recentActions: [],\n                personality: {\n                    aggression: 70,\n                    cooperation: 50,\n                    trustworthiness: 60,\n                    pride: 80,\n                    greed: 30,\n                    xenophobia: 35\n                },\n                isActive: true,\n                lastContact: 0,\n                homeSystem: 'frontier_colonies'\n            }\n        ];\n        \n        factions.forEach(faction => {\n            this.factions.set(faction.id, faction);\n        });\n        \n        this.logger.info(`🏛️ Initialized ${factions.length} major factions`);\n    }\n\n    /**\n     * Initialize player faction\n     */\n    private initializePlayerFaction(): void {\n        const playerFaction: Faction = {\n            id: this.PLAYER_FACTION_ID,\n            name: 'Independent Captain',\n            type: FactionType.Independent,\n            description: 'Freelance spaceship captain',\n            government: 'democracy',\n            ideology: 'commercial',\n            reputation: 0,\n            stance: DiplomaticStance.Neutral,\n            trustLevel: 50,\n            power: 25,\n            territory: [],\n            resources: {\n                military: 30,\n                economic: 40,\n                technological: 35,\n                influence: 20\n            },\n            treaties: [],\n            recentActions: [],\n            personality: {\n                aggression: 40,\n                cooperation: 60,\n                trustworthiness: 70,\n                pride: 50,\n                greed: 50,\n                xenophobia: 20\n            },\n            isActive: true,\n            lastContact: Date.now(),\n            homeSystem: 'starting_system'\n        };\n        \n        this.factions.set(this.PLAYER_FACTION_ID, playerFaction);\n    }\n\n    /**\n     * Modify reputation with faction\n     */\n    modifyReputation(factionId: string, change: number, reason: string): void {\n        const faction = this.factions.get(factionId);\n        if (!faction) return;\n        \n        const oldReputation = faction.reputation;\n        faction.reputation = Math.max(-100, Math.min(100, faction.reputation + change));\n        \n        // Update diplomatic stance based on new reputation\n        faction.stance = this.calculateDiplomaticStance(faction.reputation);\n        \n        // Record diplomatic action\n        this.recordDiplomaticAction({\n            type: 'contact',\n            actor: this.PLAYER_FACTION_ID,\n            target: factionId,\n            description: reason,\n            reputationChange: change,\n            successful: change > 0\n        });\n        \n        this.events.onReputationChanged?.(factionId, oldReputation, faction.reputation);\n        \n        this.logger.info(`🤝 Reputation changed: ${faction.name} ${oldReputation} → ${faction.reputation} (${reason})`);\n    }\n\n    /**\n     * Calculate diplomatic stance from reputation\n     */\n    private calculateDiplomaticStance(reputation: number): DiplomaticStance {\n        if (reputation >= 80) return DiplomaticStance.Allied;\n        if (reputation >= 40) return DiplomaticStance.Friendly;\n        if (reputation >= -39) return DiplomaticStance.Neutral;\n        if (reputation >= -79) return DiplomaticStance.Unfriendly;\n        return DiplomaticStance.Hostile;\n    }\n\n    /**\n     * Record diplomatic action\n     */\n    private recordDiplomaticAction(actionData: Omit<DiplomaticAction, 'id' | 'timestamp'>): void {\n        const action: DiplomaticAction = {\n            id: `action_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n            timestamp: Date.now(),\n            ...actionData\n        };\n        \n        this.diplomaticActions.push(action);\n        \n        // Add to faction's recent actions\n        const targetFaction = this.factions.get(actionData.target);\n        if (targetFaction) {\n            targetFaction.recentActions.push(action);\n            \n            // Keep only recent actions (last 10)\n            if (targetFaction.recentActions.length > 10) {\n                targetFaction.recentActions.shift();\n            }\n        }\n    }\n\n    /**\n     * Start negotiation with faction\n     */\n    startNegotiation(\n        factionId: string, \n        type: NegotiationType, \n        playerOffer: OfferTerm[],\n        playerSkill: number = 50,\n        crewBonus: number = 0\n    ): NegotiationSession | null {\n        const faction = this.factions.get(factionId);\n        if (!faction) {\n            this.logger.warn('Cannot start negotiation: faction not found', { factionId });\n            return null;\n        }\n        \n        // Check if negotiation is possible\n        if (faction.stance === DiplomaticStance.War) {\n            this.logger.warn('Cannot negotiate: factions at war', { factionId });\n            return null;\n        }\n        \n        const sessionId = `negotiation_${Date.now()}_${factionId}`;\n        const reputationModifier = Math.floor(faction.reputation / 10); // -10 to +10\n        \n        const session: NegotiationSession = {\n            id: sessionId,\n            participants: [this.PLAYER_FACTION_ID, factionId],\n            type,\n            currentOffer: {\n                proposer: this.PLAYER_FACTION_ID,\n                terms: playerOffer,\n                totalValue: this.calculateOfferValue(playerOffer),\n                priority: this.calculateOfferPriority(type, faction)\n            },\n            rounds: 0,\n            maxRounds: 5,\n            status: 'active',\n            playerSkill,\n            crewBonus,\n            reputationModifier\n        };\n        \n        // Generate AI counter-offer\n        session.counterOffer = this.generateCounterOffer(session, faction);\n        \n        this.negotiations.set(sessionId, session);\n        this.events.onNegotiationStarted?.(session);\n        \n        this.logger.info(`💬 Negotiation started: ${faction.name} - ${type}`, {\n            playerValue: session.currentOffer.totalValue,\n            aiValue: session.counterOffer?.totalValue || 0\n        });\n        \n        return session;\n    }\n\n    /**\n     * Calculate offer value for AI evaluation\n     */\n    private calculateOfferValue(terms: OfferTerm[]): number {\n        let totalValue = 0;\n        \n        terms.forEach(term => {\n            switch (term.type) {\n                case 'credits':\n                    totalValue += term.value;\n                    break;\n                case 'items':\n                    totalValue += term.value * 10; // Items worth more than credits\n                    break;\n                case 'information':\n                    totalValue += term.value * 20; // Information is valuable\n                    break;\n                case 'technology':\n                    totalValue += term.value * 50; // Technology is very valuable\n                    break;\n                case 'territory':\n                    totalValue += term.value * 100; // Territory is extremely valuable\n                    break;\n                case 'service':\n                    totalValue += term.value * 5;\n                    break;\n                case 'protection':\n                    totalValue += term.value * 15;\n                    break;\n            }\n        });\n        \n        return totalValue;\n    }\n\n    /**\n     * Calculate how much faction wants this type of deal\n     */\n    private calculateOfferPriority(type: NegotiationType, faction: Faction): number {\n        let priority = 50; // Base priority\n        \n        switch (type) {\n            case NegotiationType.Trade:\n                priority += faction.personality.greed * 0.3;\n                priority += faction.resources.economic * 0.2;\n                break;\n            case NegotiationType.Alliance:\n                priority += faction.personality.cooperation * 0.4;\n                priority -= faction.personality.pride * 0.2;\n                break;\n            case NegotiationType.Technology:\n                priority += (100 - faction.resources.technological) * 0.3;\n                priority += faction.personality.cooperation * 0.2;\n                break;\n            case NegotiationType.SafePassage:\n                priority += faction.personality.trustworthiness * 0.3;\n                priority -= faction.personality.aggression * 0.2;\n                break;\n            case NegotiationType.Information:\n                priority += faction.personality.cooperation * 0.2;\n                priority += faction.resources.influence * 0.1;\n                break;\n        }\n        \n        // Reputation affects priority\n        priority += faction.reputation * 0.2;\n        \n        return Math.max(0, Math.min(100, priority));\n    }\n\n    /**\n     * Generate AI counter-offer\n     */\n    private generateCounterOffer(session: NegotiationSession, faction: Faction): NegotiationOffer {\n        const playerOfferValue = session.currentOffer.totalValue;\n        const factionDemand = this.calculateFactionDemand(session, faction);\n        \n        const counterTerms: OfferTerm[] = [];\n        \n        // AI wants something in return\n        if (factionDemand > playerOfferValue) {\n            const difference = factionDemand - playerOfferValue;\n            \n            // Request credits if greedy\n            if (faction.personality.greed > 60) {\n                counterTerms.push({\n                    type: 'credits',\n                    giver: this.PLAYER_FACTION_ID,\n                    receiver: faction.id,\n                    description: `Additional payment of ${difference} credits`,\n                    value: difference\n                });\n            }\n            // Request information if influence-focused\n            else if (faction.resources.influence > 70) {\n                counterTerms.push({\n                    type: 'information',\n                    giver: this.PLAYER_FACTION_ID,\n                    receiver: faction.id,\n                    description: 'Strategic intelligence data',\n                    value: Math.floor(difference / 20)\n                });\n            }\n            // Request service\n            else {\n                counterTerms.push({\n                    type: 'service',\n                    giver: this.PLAYER_FACTION_ID,\n                    receiver: faction.id,\n                    description: 'Future service commitment',\n                    value: Math.floor(difference / 5)\n                });\n            }\n        }\n        \n        // AI offers something back based on negotiation type\n        if (session.type === NegotiationType.Trade) {\n            counterTerms.push({\n                type: 'credits',\n                giver: faction.id,\n                receiver: this.PLAYER_FACTION_ID,\n                description: `Trade payment`,\n                value: Math.floor(playerOfferValue * 0.8)\n            });\n        } else if (session.type === NegotiationType.Information) {\n            counterTerms.push({\n                type: 'information',\n                giver: faction.id,\n                receiver: this.PLAYER_FACTION_ID,\n                description: 'Classified intelligence',\n                value: Math.floor(playerOfferValue / 20)\n            });\n        }\n        \n        return {\n            proposer: faction.id,\n            terms: counterTerms,\n            totalValue: this.calculateOfferValue(counterTerms),\n            priority: session.currentOffer.priority\n        };\n    }\n\n    /**\n     * Calculate what faction demands in negotiation\n     */\n    private calculateFactionDemand(session: NegotiationSession, faction: Faction): number {\n        let baseDemand = session.currentOffer.totalValue;\n        \n        // Faction personality affects demands\n        baseDemand *= (1 + faction.personality.greed / 200); // 0.5x to 1.5x\n        baseDemand *= (1 + faction.personality.pride / 300); // 0.67x to 1.33x\n        \n        // Reputation affects demands\n        baseDemand *= (1 - faction.reputation / 200); // Better rep = lower demands\n        \n        // Power imbalance affects demands\n        const playerFaction = this.factions.get(this.PLAYER_FACTION_ID)!;\n        const powerRatio = faction.power / playerFaction.power;\n        baseDemand *= Math.pow(powerRatio, 0.3); // Powerful factions demand more\n        \n        return Math.floor(baseDemand);\n    }\n\n    /**\n     * Continue negotiation with player response\n     */\n    continueNegotiation(\n        sessionId: string, \n        acceptCounter: boolean, \n        newOffer?: OfferTerm[]\n    ): NegotiationSession | null {\n        const session = this.negotiations.get(sessionId);\n        if (!session || session.status !== 'active') return null;\n        \n        const faction = this.factions.get(session.participants[1]);\n        if (!faction) return null;\n        \n        session.rounds++;\n        \n        if (acceptCounter && session.counterOffer) {\n            // Player accepted AI's counter-offer\n            session.status = 'successful';\n            this.applyNegotiationResults(session, session.counterOffer);\n            this.events.onNegotiationCompleted?.(session, true);\n            \n            this.logger.info(`✅ Negotiation successful: ${faction.name}`);\n            \n        } else if (newOffer && session.rounds < session.maxRounds) {\n            // Player made counter-offer\n            session.currentOffer = {\n                proposer: this.PLAYER_FACTION_ID,\n                terms: newOffer,\n                totalValue: this.calculateOfferValue(newOffer),\n                priority: session.currentOffer.priority\n            };\n            \n            // AI evaluates new offer\n            const acceptChance = this.calculateAIAcceptanceChance(session, faction);\n            \n            if (Math.random() < acceptChance) {\n                session.status = 'successful';\n                this.applyNegotiationResults(session, session.currentOffer);\n                this.events.onNegotiationCompleted?.(session, true);\n                \n                this.logger.info(`✅ AI accepted negotiation: ${faction.name}`);\n            } else {\n                // Generate new counter-offer\n                session.counterOffer = this.generateCounterOffer(session, faction);\n            }\n            \n        } else {\n            // Negotiation failed\n            session.status = 'failed';\n            this.modifyReputation(faction.id, -5, 'Failed negotiation');\n            this.events.onNegotiationCompleted?.(session, false);\n            \n            this.logger.info(`❌ Negotiation failed: ${faction.name}`);\n        }\n        \n        return session;\n    }\n\n    /**\n     * Calculate AI acceptance chance for player offer\n     */\n    private calculateAIAcceptanceChance(session: NegotiationSession, faction: Faction): number {\n        const offerValue = session.currentOffer.totalValue;\n        const demandValue = this.calculateFactionDemand(session, faction);\n        \n        let acceptanceChance = 0.5; // Base 50%\n        \n        // Value comparison\n        const valueRatio = offerValue / demandValue;\n        acceptanceChance += (valueRatio - 1) * 0.3; // ±30% based on value\n        \n        // Faction personality\n        acceptanceChance += faction.personality.cooperation / 200; // +0% to +50%\n        acceptanceChance -= faction.personality.pride / 300; // -0% to -33%\n        \n        // Reputation bonus\n        acceptanceChance += faction.reputation / 200; // -50% to +50%\n        \n        // Player skill bonus\n        acceptanceChance += session.playerSkill / 200; // +0% to +50%\n        acceptanceChance += session.crewBonus / 100; // Crew diplomatic bonuses\n        \n        // Negotiation rounds penalty (AI gets impatient)\n        acceptanceChance -= session.rounds * 0.1;\n        \n        return Math.max(0.05, Math.min(0.95, acceptanceChance));\n    }\n\n    /**\n     * Apply results of successful negotiation\n     */\n    private applyNegotiationResults(session: NegotiationSession, agreedOffer: NegotiationOffer): void {\n        // Apply reputation bonus for successful negotiation\n        const otherFaction = session.participants.find(id => id !== this.PLAYER_FACTION_ID);\n        if (otherFaction) {\n            this.modifyReputation(otherFaction, 10, 'Successful negotiation');\n        }\n        \n        // TODO: Apply actual offer terms (credits, items, etc.)\n        // This would integrate with inventory, research, etc.\n        \n        this.recordDiplomaticAction({\n            type: 'trade',\n            actor: this.PLAYER_FACTION_ID,\n            target: otherFaction!,\n            description: `Successful ${session.type} negotiation`,\n            reputationChange: 10,\n            successful: true\n        });\n    }\n\n    /**\n     * Generate random diplomatic encounter\n     */\n    generateRandomEncounter(playerPosition: { x: number, y: number }): DiplomaticEncounter | null {\n        const activeFactions = Array.from(this.factions.values()).filter(f => \n            f.id !== this.PLAYER_FACTION_ID && f.isActive\n        );\n        \n        if (activeFactions.length === 0) return null;\n        \n        const faction = activeFactions[Math.floor(Math.random() * activeFactions.length)];\n        const encounterTypes = ['routine_patrol', 'distress_call', 'trade_opportunity', 'territorial_dispute'];\n        const encounterType = encounterTypes[Math.floor(Math.random() * encounterTypes.length)] as DiplomaticEncounter['type'];\n        \n        const encounter: DiplomaticEncounter = {\n            id: `encounter_${Date.now()}_${faction.id}`,\n            factionId: faction.id,\n            type: encounterType,\n            location: { ...playerPosition },\n            description: this.generateEncounterDescription(faction, encounterType),\n            availableActions: this.generateEncounterActions(faction, encounterType),\n            consequences: [],\n            isActive: true,\n            timestamp: Date.now()\n        };\n        \n        this.encounters.set(encounter.id, encounter);\n        this.events.onEncounterGenerated?.(encounter);\n        \n        this.logger.info(`🎭 Diplomatic encounter: ${faction.name} - ${encounterType}`);\n        \n        return encounter;\n    }\n\n    /**\n     * Generate encounter description\n     */\n    private generateEncounterDescription(faction: Faction, type: DiplomaticEncounter['type']): string {\n        const descriptions = {\n            routine_patrol: [\n                `A ${faction.name} patrol vessel approaches your ship`,\n                `${faction.name} forces are conducting routine inspections in this sector`,\n                `You encounter a ${faction.name} security checkpoint`\n            ],\n            distress_call: [\n                `A ${faction.name} ship is transmitting a distress signal`,\n                `${faction.name} vessel appears to be disabled and requesting assistance`,\n                `Emergency beacon from ${faction.name} ship detected`\n            ],\n            trade_opportunity: [\n                `${faction.name} trader wishes to conduct business`,\n                `A ${faction.name} merchant convoy has goods to trade`,\n                `${faction.name} commercial vessel offers trade opportunity`\n            ],\n            territorial_dispute: [\n                `${faction.name} claims this space as their territory`,\n                `${faction.name} forces demand you leave their space immediately`,\n                `You have entered disputed ${faction.name} territory`\n            ],\n            first_contact: [\n                `First contact with unknown ${faction.name} vessel`,\n                `${faction.name} ship of unknown configuration approaches`,\n                `Unprecedented encounter with ${faction.name} representatives`\n            ]\n        };\n        \n        const typeDescriptions = descriptions[type] || descriptions.routine_patrol;\n        return typeDescriptions[Math.floor(Math.random() * typeDescriptions.length)];\n    }\n\n    /**\n     * Generate encounter actions\n     */\n    private generateEncounterActions(faction: Faction, type: DiplomaticEncounter['type']): EncounterAction[] {\n        const baseActions: EncounterAction[] = [\n            {\n                id: 'diplomatic_greeting',\n                name: 'Diplomatic Greeting',\n                description: 'Approach peacefully and initiate diplomatic contact',\n                skillCheck: { skill: 'communications', difficulty: 30 },\n                consequences: [\n                    {\n                        type: 'reputation',\n                        factionId: faction.id,\n                        value: 5,\n                        description: 'Peaceful approach improves relations'\n                    }\n                ]\n            },\n            {\n                id: 'ignore_encounter',\n                name: 'Ignore and Continue',\n                description: 'Ignore the encounter and continue on your course',\n                consequences: [\n                    {\n                        type: 'reputation',\n                        factionId: faction.id,\n                        value: -2,\n                        description: 'Ignoring faction vessel causes minor offense'\n                    }\n                ]\n            }\n        ];\n        \n        // Add type-specific actions\n        switch (type) {\n            case 'distress_call':\n                baseActions.push({\n                    id: 'offer_assistance',\n                    name: 'Offer Assistance',\n                    description: 'Provide aid to the distressed vessel',\n                    skillCheck: { skill: 'engineering', difficulty: 40 },\n                    consequences: [\n                        {\n                            type: 'reputation',\n                            factionId: faction.id,\n                            value: 15,\n                            description: 'Humanitarian aid greatly improves relations'\n                        },\n                        {\n                            type: 'resources',\n                            factionId: faction.id,\n                            value: 100,\n                            description: 'Faction rewards your assistance'\n                        }\n                    ]\n                });\n                break;\n                \n            case 'trade_opportunity':\n                baseActions.push({\n                    id: 'initiate_trade',\n                    name: 'Initiate Trade',\n                    description: 'Begin trade negotiations',\n                    consequences: [\n                        {\n                            type: 'trade_opportunity',\n                            factionId: faction.id,\n                            value: 1,\n                            description: 'Opens trade dialogue'\n                        }\n                    ]\n                });\n                break;\n                \n            case 'territorial_dispute':\n                baseActions.push({\n                    id: 'negotiate_passage',\n                    name: 'Negotiate Safe Passage',\n                    description: 'Attempt to negotiate peaceful passage through their territory',\n                    requirements: [\n                        { type: 'reputation', value: 0, description: 'Neutral or better standing required' }\n                    ],\n                    skillCheck: { skill: 'communications', difficulty: 50 },\n                    consequences: [\n                        {\n                            type: 'reputation',\n                            factionId: faction.id,\n                            value: 8,\n                            description: 'Successful negotiation improves relations'\n                        }\n                    ]\n                });\n                break;\n        }\n        \n        // Add hostile option if reputation is very low\n        if (faction.reputation < -50) {\n            baseActions.push({\n                id: 'threaten_withdrawal',\n                name: 'Threaten Force',\n                description: 'Threaten to use force if they do not withdraw',\n                requirements: [\n                    { type: 'crew_skill', value: 60, description: 'High combat skill required' }\n                ],\n                consequences: [\n                    {\n                        type: 'combat',\n                        factionId: faction.id,\n                        value: 1,\n                        description: 'May escalate to combat'\n                    },\n                    {\n                        type: 'reputation',\n                        factionId: faction.id,\n                        value: -20,\n                        description: 'Threatening behavior severely damages relations'\n                    }\n                ]\n            });\n        }\n        \n        return baseActions;\n    }\n\n    /**\n     * Resolve encounter action\n     */\n    resolveEncounterAction(encounterId: string, actionId: string, skillValue: number = 50): EncounterConsequence[] {\n        const encounter = this.encounters.get(encounterId);\n        if (!encounter || !encounter.isActive) return [];\n        \n        const action = encounter.availableActions.find(a => a.id === actionId);\n        if (!action) return [];\n        \n        const consequences: EncounterConsequence[] = [...action.consequences];\n        \n        // Handle skill check\n        if (action.skillCheck) {\n            const success = skillValue >= action.skillCheck.difficulty;\n            \n            if (success) {\n                // Bonus for skill success\n                consequences.forEach(c => {\n                    if (c.type === 'reputation' && c.value > 0) {\n                        c.value = Math.floor(c.value * 1.5); // 50% bonus\n                    }\n                });\n            } else {\n                // Penalty for skill failure\n                consequences.forEach(c => {\n                    if (c.type === 'reputation') {\n                        c.value = Math.floor(c.value * 0.5); // 50% penalty\n                    }\n                });\n            }\n        }\n        \n        // Apply consequences\n        consequences.forEach(consequence => {\n            switch (consequence.type) {\n                case 'reputation':\n                    this.modifyReputation(consequence.factionId, consequence.value, consequence.description);\n                    break;\n                case 'combat':\n                    // TODO: Trigger combat encounter\n                    break;\n                case 'trade_opportunity':\n                    // TODO: Open trade interface\n                    break;\n            }\n        });\n        \n        // Mark encounter as resolved\n        encounter.isActive = false;\n        encounter.consequences = consequences;\n        \n        if (consequences.some(c => c.type === 'combat')) {\n            encounter.resolution = 'hostile';\n        } else if (consequences.some(c => c.type === 'reputation' && c.value > 0)) {\n            encounter.resolution = 'beneficial';\n        } else {\n            encounter.resolution = 'neutral';\n        }\n        \n        this.logger.info(`🎯 Encounter resolved: ${actionId}`, {\n            consequences: consequences.length,\n            resolution: encounter.resolution\n        });\n        \n        return consequences;\n    }\n\n    /**\n     * Get faction by ID\n     */\n    getFaction(factionId: string): Faction | null {\n        return this.factions.get(factionId) || null;\n    }\n\n    /**\n     * Get all factions\n     */\n    getAllFactions(): Faction[] {\n        return Array.from(this.factions.values()).filter(f => f.id !== this.PLAYER_FACTION_ID);\n    }\n\n    /**\n     * Get player faction\n     */\n    getPlayerFaction(): Faction {\n        return this.factions.get(this.PLAYER_FACTION_ID)!;\n    }\n\n    /**\n     * Get active negotiations\n     */\n    getActiveNegotiations(): NegotiationSession[] {\n        return Array.from(this.negotiations.values()).filter(n => n.status === 'active');\n    }\n\n    /**\n     * Get active encounters\n     */\n    getActiveEncounters(): DiplomaticEncounter[] {\n        return Array.from(this.encounters.values()).filter(e => e.isActive);\n    }\n\n    /**\n     * Get recent diplomatic actions\n     */\n    getRecentDiplomaticActions(limit: number = 10): DiplomaticAction[] {\n        return this.diplomaticActions\n            .sort((a, b) => b.timestamp - a.timestamp)\n            .slice(0, limit);\n    }\n\n    /**\n     * Get diplomacy statistics\n     */\n    getDiplomacyStats(): {\n        totalFactions: number;\n        alliedFactions: number;\n        hostileFactions: number;\n        activeNegotiations: number;\n        activeTreaties: number;\n        totalEncounters: number;\n        averageReputation: number;\n    } {\n        const factions = this.getAllFactions();\n        const allied = factions.filter(f => f.stance === DiplomaticStance.Allied).length;\n        const hostile = factions.filter(f => f.stance === DiplomaticStance.Hostile || f.stance === DiplomaticStance.War).length;\n        const avgReputation = factions.reduce((sum, f) => sum + f.reputation, 0) / factions.length;\n        \n        return {\n            totalFactions: factions.length,\n            alliedFactions: allied,\n            hostileFactions: hostile,\n            activeNegotiations: this.getActiveNegotiations().length,\n            activeTreaties: Array.from(this.treaties.values()).filter(t => t.status === 'active').length,\n            totalEncounters: this.encounters.size,\n            averageReputation: Math.round(avgReputation)\n        };\n    }\n\n    /**\n     * Save diplomacy data\n     */\n    saveDiplomacyData(): any {\n        return {\n            factions: Array.from(this.factions.entries()),\n            treaties: Array.from(this.treaties.entries()),\n            negotiations: Array.from(this.negotiations.entries()),\n            encounters: Array.from(this.encounters.entries()),\n            diplomaticActions: this.diplomaticActions\n        };\n    }\n\n    /**\n     * Load diplomacy data\n     */\n    loadDiplomacyData(data: any): void {\n        if (data.factions) {\n            this.factions = new Map(data.factions);\n        }\n        if (data.treaties) {\n            this.treaties = new Map(data.treaties);\n        }\n        if (data.negotiations) {\n            this.negotiations = new Map(data.negotiations);\n        }\n        if (data.encounters) {\n            this.encounters = new Map(data.encounters);\n        }\n        if (data.diplomaticActions) {\n            this.diplomaticActions = data.diplomaticActions;\n        }\n        \n        this.logger.info('🤝 Diplomacy data loaded', {\n            factions: this.factions.size,\n            treaties: this.treaties.size,\n            encounters: this.encounters.size\n        });\n    }\n}","/**\n * Alien AI System\n * Advanced alien behaviors, species characteristics, and interactions\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\nimport { Faction, DiplomaticStance } from '@diplomacy/DiplomacySystem';\n\nexport enum AlienSpecies {\n    Zephyrian = 'zephyrian',\n    Crystalline = 'crystalline',\n    Ethereal = 'ethereal',\n    Mechanical = 'mechanical',\n    Hive = 'hive',\n    Energy = 'energy',\n    Aquatic = 'aquatic',\n    Silicon = 'silicon'\n}\n\nexport enum AlienBehaviorType {\n    Peaceful = 'peaceful',\n    Aggressive = 'aggressive',\n    Curious = 'curious',\n    Isolationist = 'isolationist',\n    Expansionist = 'expansionist',\n    Trader = 'trader',\n    Scholar = 'scholar',\n    Guardian = 'guardian'\n}\n\nexport enum CommunicationMethod {\n    Verbal = 'verbal',\n    Telepathic = 'telepathic',\n    Chemical = 'chemical',\n    Light = 'light',\n    Electromagnetic = 'electromagnetic',\n    Quantum = 'quantum',\n    Gestural = 'gestural',\n    Mathematical = 'mathematical'\n}\n\nexport interface AlienSpeciesProfile {\n    species: AlienSpecies;\n    name: string;\n    description: string;\n    \n    // Physical characteristics\n    physiology: {\n        size: 'tiny' | 'small' | 'medium' | 'large' | 'huge';\n        composition: 'organic' | 'silicon' | 'crystalline' | 'energy' | 'mechanical';\n        lifespan: number; // Years\n        temperature: 'cryogenic' | 'cold' | 'temperate' | 'hot' | 'plasma';\n        environment: 'vacuum' | 'atmosphere' | 'liquid' | 'plasma' | 'quantum';\n    };\n    \n    // Cultural traits\n    culture: {\n        government: 'collective' | 'hierarchical' | 'anarchic' | 'democratic' | 'theocratic';\n        values: string[];\n        taboos: string[];\n        rituals: string[];\n        artForms: string[];\n    };\n    \n    // Communication\n    communication: {\n        primary: CommunicationMethod;\n        secondary: CommunicationMethod[];\n        linguisticComplexity: number; // 1-10\n        translationDifficulty: number; // 1-10\n        emotionalRange: string[];\n    };\n    \n    // Technology\n    technology: {\n        level: number; // 1-10\n        specializations: string[];\n        weaknesses: string[];\n        uniqueTech: string[];\n        energySource: string;\n    };\n    \n    // Psychology\n    psychology: {\n        intelligence: number; // 1-10\n        emotionalStability: number; // 1-10\n        socialComplexity: number; // 1-10\n        memoryType: 'short' | 'long' | 'perfect' | 'collective';\n        decisionMaking: 'logical' | 'emotional' | 'intuitive' | 'collective';\n    };\n    \n    // Behavior patterns\n    behaviorPatterns: {\n        primary: AlienBehaviorType;\n        secondary: AlienBehaviorType[];\n        aggressionTriggers: string[];\n        friendshipFactors: string[];\n        fearFactors: string[];\n    };\n}\n\nexport interface AlienEncounter {\n    id: string;\n    species: AlienSpecies;\n    type: 'first_contact' | 'routine' | 'scientific' | 'territorial' | 'distress' | 'probe';\n    location: { x: number, y: number };\n    \n    // Encounter state\n    phase: 'approach' | 'contact' | 'communication' | 'interaction' | 'resolution';\n    intensity: number; // 0-100\n    suspicion: number; // 0-100\n    interest: number; // 0-100\n    \n    // Communication state\n    communicationEstablished: boolean;\n    languageBarrier: number; // 0-100, reduces over time\n    translationProgress: number; // 0-100\n    culturalUnderstanding: number; // 0-100\n    \n    // Interaction history\n    actions: AlienAction[];\n    responses: AlienResponse[];\n    \n    // Outcome tracking\n    success: boolean;\n    knowledge_gained: string[];\n    technology_exchanged: string[];\n    cultural_insights: string[];\n    \n    timestamp: number;\n    duration: number;\n}\n\nexport interface AlienAction {\n    id: string;\n    type: 'scan' | 'communicate' | 'approach' | 'retreat' | 'gift' | 'demonstrate' | 'threaten' | 'probe';\n    description: string;\n    timestamp: number;\n    \n    // Action parameters\n    intensity: number;\n    complexity: number;\n    risk: number;\n    \n    // Expected outcomes\n    expectedResponse: string[];\n    culturalContext?: string;\n}\n\nexport interface AlienResponse {\n    actionId: string;\n    type: 'positive' | 'negative' | 'neutral' | 'confused' | 'curious' | 'hostile';\n    description: string;\n    intensity: number;\n    \n    // Response context\n    culturalReason?: string;\n    technologicalFactor?: string;\n    psychologicalState: string;\n}\n\nexport interface AlienKnowledge {\n    species: AlienSpecies;\n    \n    // Known information\n    physicalTraits: string[];\n    culturalTraits: string[];\n    technologicalCapabilities: string[];\n    communicationMethods: string[];\n    behaviorPatterns: string[];\n    \n    // Understanding levels\n    languageComprehension: number; // 0-100\n    culturalUnderstanding: number; // 0-100\n    technologicalUnderstanding: number; // 0-100\n    psychologicalProfile: number; // 0-100\n    \n    // Interaction history\n    totalContacts: number;\n    successfulCommunications: number;\n    hostileEncounters: number;\n    peacefulEncounters: number;\n    \n    // Research progress\n    researchPoints: number;\n    discoveredSecrets: string[];\n    unlockedTechnologies: string[];\n    \n    lastUpdate: number;\n}\n\nexport interface AlienEvents {\n    onFirstContact?: (species: AlienSpecies, encounter: AlienEncounter) => void;\n    onCommunicationBreakthrough?: (species: AlienSpecies, method: CommunicationMethod) => void;\n    onTechnologyDiscovered?: (species: AlienSpecies, technology: string) => void;\n    onCulturalInsight?: (species: AlienSpecies, insight: string) => void;\n    onHostileAction?: (species: AlienSpecies, action: AlienAction) => void;\n    onAllianceOpportunity?: (species: AlienSpecies) => void;\n}\n\nexport class AlienAI {\n    private speciesProfiles: Map<AlienSpecies, AlienSpeciesProfile> = new Map();\n    private activeEncounters: Map<string, AlienEncounter> = new Map();\n    private knowledgeBase: Map<AlienSpecies, AlienKnowledge> = new Map();\n    \n    // AI behavior state\n    private encounterPatterns: Map<AlienSpecies, number[]> = new Map();\n    private adaptiveBehaviors: Map<AlienSpecies, Map<string, number>> = new Map();\n    \n    private events: AlienEvents;\n    private logger: Logger;\n\n    constructor(events: AlienEvents = {}) {\n        this.logger = new Logger('AlienAI');\n        this.events = events;\n        \n        this.initializeSpeciesProfiles();\n        this.initializeKnowledgeBase();\n        \n        this.logger.info('👽 Alien AI system initialized');\n    }\n\n    /**\n     * Initialize alien species profiles\n     */\n    private initializeSpeciesProfiles(): void {\n        const profiles: AlienSpeciesProfile[] = [\n            {\n                species: AlienSpecies.Zephyrian,\n                name: 'Zephyrians',\n                description: 'Ancient crystalline beings with advanced psionic abilities',\n                physiology: {\n                    size: 'large',\n                    composition: 'crystalline',\n                    lifespan: 10000,\n                    temperature: 'cold',\n                    environment: 'atmosphere'\n                },\n                culture: {\n                    government: 'hierarchical',\n                    values: ['knowledge', 'tradition', 'order', 'perfection'],\n                    taboos: ['chaos', 'destruction of crystals', 'emotional outbursts'],\n                    rituals: ['crystal resonance ceremonies', 'memory sharing'],\n                    artForms: ['harmonic sculptures', 'light patterns', 'crystal gardens']\n                },\n                communication: {\n                    primary: CommunicationMethod.Telepathic,\n                    secondary: [CommunicationMethod.Light, CommunicationMethod.Electromagnetic],\n                    linguisticComplexity: 9,\n                    translationDifficulty: 8,\n                    emotionalRange: ['serenity', 'contemplation', 'ancient_wisdom', 'ethereal_beauty']\n                },\n                technology: {\n                    level: 10,\n                    specializations: ['psionics', 'crystalline_tech', 'energy_manipulation', 'consciousness_transfer'],\n                    weaknesses: ['mechanical_systems', 'rapid_adaptation'],\n                    uniqueTech: ['crystal_matrices', 'psionic_amplifiers', 'temporal_perception'],\n                    energySource: 'stellar_radiation'\n                },\n                psychology: {\n                    intelligence: 10,\n                    emotionalStability: 8,\n                    socialComplexity: 9,\n                    memoryType: 'perfect',\n                    decisionMaking: 'logical'\n                },\n                behaviorPatterns: {\n                    primary: AlienBehaviorType.Scholar,\n                    secondary: [AlienBehaviorType.Isolationist, AlienBehaviorType.Guardian],\n                    aggressionTriggers: ['desecration_of_knowledge', 'threat_to_crystals', 'chaos_creation'],\n                    friendshipFactors: ['respect_for_knowledge', 'peaceful_intentions', 'cultural_exchange'],\n                    fearFactors: ['entropy', 'technological_chaos', 'rapid_change']\n                }\n            },\n            {\n                species: AlienSpecies.Crystalline,\n                name: 'Silicon Entities',\n                description: 'Silicon-based life forms with networked consciousness',\n                physiology: {\n                    size: 'medium',\n                    composition: 'silicon',\n                    lifespan: 50000,\n                    temperature: 'hot',\n                    environment: 'vacuum'\n                },\n                culture: {\n                    government: 'collective',\n                    values: ['efficiency', 'logic', 'growth', 'perfection'],\n                    taboos: ['waste', 'inefficiency', 'individual_glory'],\n                    rituals: ['network_synchronization', 'crystal_growth_ceremonies'],\n                    artForms: ['geometric_patterns', 'crystal_formations', 'harmonic_frequencies']\n                },\n                communication: {\n                    primary: CommunicationMethod.Electromagnetic,\n                    secondary: [CommunicationMethod.Light, CommunicationMethod.Mathematical],\n                    linguisticComplexity: 7,\n                    translationDifficulty: 6,\n                    emotionalRange: ['collective_harmony', 'logical_satisfaction', 'growth_joy']\n                },\n                technology: {\n                    level: 9,\n                    specializations: ['crystal_tech', 'network_systems', 'quantum_computing', 'material_science'],\n                    weaknesses: ['biological_systems', 'emotional_logic'],\n                    uniqueTech: ['living_crystals', 'quantum_networks', 'self_repairing_materials'],\n                    energySource: 'geothermal'\n                },\n                psychology: {\n                    intelligence: 9,\n                    emotionalStability: 10,\n                    socialComplexity: 8,\n                    memoryType: 'collective',\n                    decisionMaking: 'logical'\n                },\n                behaviorPatterns: {\n                    primary: AlienBehaviorType.Peaceful,\n                    secondary: [AlienBehaviorType.Scholar, AlienBehaviorType.Trader],\n                    aggressionTriggers: ['network_disruption', 'crystal_destruction', 'logical_paradoxes'],\n                    friendshipFactors: ['logical_consistency', 'technological_exchange', 'mutual_benefit'],\n                    fearFactors: ['chaos', 'irrationality', 'network_isolation']\n                }\n            },\n            {\n                species: AlienSpecies.Ethereal,\n                name: 'Void Dancers',\n                description: 'Energy beings from higher dimensions',\n                physiology: {\n                    size: 'medium',\n                    composition: 'energy',\n                    lifespan: 1000000,\n                    temperature: 'plasma',\n                    environment: 'quantum'\n                },\n                culture: {\n                    government: 'anarchic',\n                    values: ['freedom', 'exploration', 'transcendence', 'beauty'],\n                    taboos: ['confinement', 'materialism', 'dimensional_barriers'],\n                    rituals: ['dimensional_dancing', 'energy_weaving', 'consciousness_expansion'],\n                    artForms: ['energy_sculptures', 'dimensional_poetry', 'temporal_music']\n                },\n                communication: {\n                    primary: CommunicationMethod.Quantum,\n                    secondary: [CommunicationMethod.Telepathic, CommunicationMethod.Electromagnetic],\n                    linguisticComplexity: 10,\n                    translationDifficulty: 10,\n                    emotionalRange: ['transcendent_joy', 'dimensional_curiosity', 'ethereal_melancholy', 'cosmic_awe']\n                },\n                technology: {\n                    level: 10,\n                    specializations: ['dimensional_tech', 'energy_manipulation', 'consciousness_tech', 'temporal_mechanics'],\n                    weaknesses: ['physical_limitations', 'material_constraints'],\n                    uniqueTech: ['dimensional_gates', 'energy_forms', 'consciousness_transfer', 'temporal_loops'],\n                    energySource: 'dimensional_rifts'\n                },\n                psychology: {\n                    intelligence: 10,\n                    emotionalStability: 5,\n                    socialComplexity: 10,\n                    memoryType: 'long',\n                    decisionMaking: 'intuitive'\n                },\n                behaviorPatterns: {\n                    primary: AlienBehaviorType.Curious,\n                    secondary: [AlienBehaviorType.Scholar, AlienBehaviorType.Peaceful],\n                    aggressionTriggers: ['dimensional_imprisonment', 'energy_disruption', 'consciousness_violation'],\n                    friendshipFactors: ['dimensional_understanding', 'energy_harmony', 'consciousness_respect'],\n                    fearFactors: ['dimensional_collapse', 'energy_drain', 'consciousness_destruction']\n                }\n            },\n            {\n                species: AlienSpecies.Hive,\n                name: 'Unity Swarm',\n                description: 'Collective insectoid intelligence with unified purpose',\n                physiology: {\n                    size: 'small',\n                    composition: 'organic',\n                    lifespan: 100,\n                    temperature: 'temperate',\n                    environment: 'atmosphere'\n                },\n                culture: {\n                    government: 'collective',\n                    values: ['unity', 'efficiency', 'expansion', 'survival'],\n                    taboos: ['individualism', 'waste', 'disloyalty'],\n                    rituals: ['queen_communion', 'hive_synchronization', 'collective_memory_sharing'],\n                    artForms: ['architectural_marvels', 'geometric_patterns', 'collective_harmonics']\n                },\n                communication: {\n                    primary: CommunicationMethod.Chemical,\n                    secondary: [CommunicationMethod.Telepathic, CommunicationMethod.Gestural],\n                    linguisticComplexity: 6,\n                    translationDifficulty: 7,\n                    emotionalRange: ['collective_purpose', 'hive_satisfaction', 'protective_fury', 'expansion_drive']\n                },\n                technology: {\n                    level: 7,\n                    specializations: ['biotechnology', 'swarm_systems', 'collective_computing', 'organic_engineering'],\n                    weaknesses: ['individual_systems', 'abstract_concepts'],\n                    uniqueTech: ['living_ships', 'bio_computers', 'collective_consciousness', 'adaptive_evolution'],\n                    energySource: 'biological'\n                },\n                psychology: {\n                    intelligence: 8,\n                    emotionalStability: 9,\n                    socialComplexity: 10,\n                    memoryType: 'collective',\n                    decisionMaking: 'collective'\n                },\n                behaviorPatterns: {\n                    primary: AlienBehaviorType.Expansionist,\n                    secondary: [AlienBehaviorType.Aggressive, AlienBehaviorType.Guardian],\n                    aggressionTriggers: ['threat_to_hive', 'resource_competition', 'territorial_intrusion'],\n                    friendshipFactors: ['mutual_benefit', 'resource_sharing', 'non_aggression'],\n                    fearFactors: ['hive_fragmentation', 'queen_death', 'collective_disruption']\n                }\n            }\n        ];\n        \n        profiles.forEach(profile => {\n            this.speciesProfiles.set(profile.species, profile);\n        });\n        \n        this.logger.info(`👽 Initialized ${profiles.length} alien species profiles`);\n    }\n\n    /**\n     * Initialize knowledge base for all species\n     */\n    private initializeKnowledgeBase(): void {\n        for (const species of Object.values(AlienSpecies)) {\n            const knowledge: AlienKnowledge = {\n                species,\n                physicalTraits: [],\n                culturalTraits: [],\n                technologicalCapabilities: [],\n                communicationMethods: [],\n                behaviorPatterns: [],\n                languageComprehension: 0,\n                culturalUnderstanding: 0,\n                technologicalUnderstanding: 0,\n                psychologicalProfile: 0,\n                totalContacts: 0,\n                successfulCommunications: 0,\n                hostileEncounters: 0,\n                peacefulEncounters: 0,\n                researchPoints: 0,\n                discoveredSecrets: [],\n                unlockedTechnologies: [],\n                lastUpdate: Date.now()\n            };\n            \n            this.knowledgeBase.set(species, knowledge);\n        }\n    }\n\n    /**\n     * Generate alien encounter\n     */\n    generateEncounter(\n        species: AlienSpecies, \n        position: { x: number, y: number },\n        type: AlienEncounter['type'] = 'routine'\n    ): AlienEncounter {\n        const profile = this.speciesProfiles.get(species);\n        if (!profile) {\n            throw new Error(`Unknown alien species: ${species}`);\n        }\n        \n        const knowledge = this.knowledgeBase.get(species)!;\n        const isFirstContact = knowledge.totalContacts === 0;\n        \n        const encounter: AlienEncounter = {\n            id: `encounter_${Date.now()}_${species}`,\n            species,\n            type: isFirstContact ? 'first_contact' : type,\n            location: { ...position },\n            phase: 'approach',\n            intensity: this.calculateInitialIntensity(profile, type),\n            suspicion: this.calculateInitialSuspicion(profile, knowledge),\n            interest: this.calculateInitialInterest(profile, type),\n            communicationEstablished: false,\n            languageBarrier: Math.max(10, 100 - knowledge.languageComprehension),\n            translationProgress: knowledge.languageComprehension,\n            culturalUnderstanding: knowledge.culturalUnderstanding,\n            actions: [],\n            responses: [],\n            success: false,\n            knowledge_gained: [],\n            technology_exchanged: [],\n            cultural_insights: [],\n            timestamp: Date.now(),\n            duration: 0\n        };\n        \n        this.activeEncounters.set(encounter.id, encounter);\n        \n        if (isFirstContact) {\n            this.events.onFirstContact?.(species, encounter);\n        }\n        \n        this.logger.info(`👽 Alien encounter: ${profile.name} - ${type}`, {\n            firstContact: isFirstContact,\n            intensity: encounter.intensity,\n            suspicion: encounter.suspicion\n        });\n        \n        return encounter;\n    }\n\n    /**\n     * Calculate initial encounter intensity\n     */\n    private calculateInitialIntensity(profile: AlienSpeciesProfile, type: AlienEncounter['type']): number {\n        let intensity = 50; // Base intensity\n        \n        // Species behavior affects intensity\n        switch (profile.behaviorPatterns.primary) {\n            case AlienBehaviorType.Aggressive:\n                intensity += 30;\n                break;\n            case AlienBehaviorType.Curious:\n                intensity += 10;\n                break;\n            case AlienBehaviorType.Isolationist:\n                intensity -= 20;\n                break;\n            case AlienBehaviorType.Peaceful:\n                intensity -= 10;\n                break;\n        }\n        \n        // Encounter type affects intensity\n        switch (type) {\n            case 'first_contact':\n                intensity += 40;\n                break;\n            case 'territorial':\n                intensity += 25;\n                break;\n            case 'distress':\n                intensity += 15;\n                break;\n            case 'scientific':\n                intensity -= 10;\n                break;\n        }\n        \n        // Psychological factors\n        intensity += (10 - profile.psychology.emotionalStability) * 3;\n        \n        return Math.max(0, Math.min(100, intensity));\n    }\n\n    /**\n     * Calculate initial suspicion level\n     */\n    private calculateInitialSuspicion(profile: AlienSpeciesProfile, knowledge: AlienKnowledge): number {\n        let suspicion = 60; // Base suspicion for unknown entities\n        \n        // Previous interactions affect suspicion\n        if (knowledge.totalContacts > 0) {\n            const positiveRatio = knowledge.peacefulEncounters / knowledge.totalContacts;\n            suspicion = Math.floor(suspicion * (1 - positiveRatio));\n        }\n        \n        // Species traits\n        if (profile.behaviorPatterns.aggressionTriggers.includes('unknown_entities')) {\n            suspicion += 20;\n        }\n        \n        if (profile.behaviorPatterns.primary === AlienBehaviorType.Isolationist) {\n            suspicion += 15;\n        }\n        \n        return Math.max(0, Math.min(100, suspicion));\n    }\n\n    /**\n     * Calculate initial interest level\n     */\n    private calculateInitialInterest(profile: AlienSpeciesProfile, type: AlienEncounter['type']): number {\n        let interest = 30; // Base interest\n        \n        // Species behavior affects interest\n        switch (profile.behaviorPatterns.primary) {\n            case AlienBehaviorType.Curious:\n                interest += 40;\n                break;\n            case AlienBehaviorType.Scholar:\n                interest += 30;\n                break;\n            case AlienBehaviorType.Trader:\n                interest += 20;\n                break;\n            case AlienBehaviorType.Isolationist:\n                interest -= 20;\n                break;\n        }\n        \n        // Encounter type affects interest\n        switch (type) {\n            case 'scientific':\n                interest += 30;\n                break;\n            case 'first_contact':\n                interest += 25;\n                break;\n            case 'probe':\n                interest += 15;\n                break;\n        }\n        \n        return Math.max(0, Math.min(100, interest));\n    }\n\n    /**\n     * Process player action in encounter\n     */\n    processPlayerAction(\n        encounterId: string,\n        actionType: AlienAction['type'],\n        intensity: number,\n        context?: string\n    ): AlienResponse {\n        const encounter = this.activeEncounters.get(encounterId);\n        if (!encounter) {\n            throw new Error(`Encounter not found: ${encounterId}`);\n        }\n        \n        const profile = this.speciesProfiles.get(encounter.species)!;\n        \n        // Create player action\n        const action: AlienAction = {\n            id: `action_${Date.now()}`,\n            type: actionType,\n            description: this.generateActionDescription(actionType, intensity, context),\n            timestamp: Date.now(),\n            intensity,\n            complexity: this.calculateActionComplexity(actionType),\n            risk: this.calculateActionRisk(actionType, encounter),\n            expectedResponse: this.predictAlienResponse(profile, actionType),\n            culturalContext: context\n        };\n        \n        encounter.actions.push(action);\n        \n        // Generate alien response\n        const response = this.generateAlienResponse(encounter, action, profile);\n        encounter.responses.push(response);\n        \n        // Update encounter state\n        this.updateEncounterState(encounter, action, response, profile);\n        \n        this.logger.debug(`👽 Action processed: ${actionType} → ${response.type}`, {\n            species: encounter.species,\n            intensity: response.intensity\n        });\n        \n        return response;\n    }\n\n    /**\n     * Generate action description\n     */\n    private generateActionDescription(\n        type: AlienAction['type'], \n        intensity: number, \n        context?: string\n    ): string {\n        const descriptions = {\n            scan: [\n                'Conducting passive sensor sweep',\n                'Analyzing alien vessel signatures',\n                'Performing detailed reconnaissance'\n            ],\n            communicate: [\n                'Attempting to establish communication',\n                'Broadcasting universal greeting protocols',\n                'Transmitting mathematical sequences'\n            ],\n            approach: [\n                'Moving closer to alien vessel',\n                'Advancing with peaceful intentions',\n                'Initiating close-range contact'\n            ],\n            retreat: [\n                'Withdrawing to safe distance',\n                'Pulling back from encounter',\n                'Establishing defensive position'\n            ],\n            gift: [\n                'Offering technological samples',\n                'Presenting cultural artifacts',\n                'Sharing knowledge databases'\n            ],\n            demonstrate: [\n                'Showcasing technological capabilities',\n                'Performing cultural demonstrations',\n                'Exhibiting peaceful intentions'\n            ],\n            threaten: [\n                'Displaying weapons systems',\n                'Transmitting warning signals',\n                'Demonstrating military capability'\n            ],\n            probe: [\n                'Deploying sensor probes',\n                'Initiating detailed scans',\n                'Gathering scientific data'\n            ]\n        };\n        \n        const typeDescriptions = descriptions[type] || ['Unknown action'];\n        let description = typeDescriptions[Math.floor(Math.random() * typeDescriptions.length)];\n        \n        if (intensity > 70) {\n            description += ' with high intensity';\n        } else if (intensity < 30) {\n            description += ' cautiously';\n        }\n        \n        if (context) {\n            description += ` (${context})`;\n        }\n        \n        return description;\n    }\n\n    /**\n     * Calculate action complexity\n     */\n    private calculateActionComplexity(type: AlienAction['type']): number {\n        const complexity = {\n            scan: 3,\n            communicate: 7,\n            approach: 2,\n            retreat: 1,\n            gift: 5,\n            demonstrate: 6,\n            threaten: 4,\n            probe: 8\n        };\n        \n        return complexity[type] || 5;\n    }\n\n    /**\n     * Calculate action risk\n     */\n    private calculateActionRisk(type: AlienAction['type'], encounter: AlienEncounter): number {\n        let risk = 0;\n        \n        switch (type) {\n            case 'threaten':\n                risk = 90;\n                break;\n            case 'probe':\n                risk = 60;\n                break;\n            case 'approach':\n                risk = 40;\n                break;\n            case 'communicate':\n                risk = 20;\n                break;\n            case 'gift':\n                risk = 10;\n                break;\n            default:\n                risk = 30;\n        }\n        \n        // Adjust for alien suspicion\n        risk += encounter.suspicion * 0.3;\n        \n        return Math.max(0, Math.min(100, risk));\n    }\n\n    /**\n     * Predict alien response patterns\n     */\n    private predictAlienResponse(profile: AlienSpeciesProfile, actionType: AlienAction['type']): string[] {\n        const responses: string[] = [];\n        \n        // Base responses for action types\n        switch (actionType) {\n            case 'communicate':\n                responses.push('attempt_communication', 'analyze_signal', 'respond_cautiously');\n                break;\n            case 'gift':\n                responses.push('analyze_gift', 'reciprocate', 'suspicious_examination');\n                break;\n            case 'threaten':\n                responses.push('defensive_posture', 'counter_threat', 'retreat');\n                break;\n            case 'approach':\n                responses.push('allow_approach', 'maintain_distance', 'warning_signal');\n                break;\n        }\n        \n        // Modify based on species behavior\n        switch (profile.behaviorPatterns.primary) {\n            case AlienBehaviorType.Aggressive:\n                responses.push('aggressive_response', 'territorial_warning');\n                break;\n            case AlienBehaviorType.Curious:\n                responses.push('investigate_further', 'ask_questions');\n                break;\n            case AlienBehaviorType.Scholar:\n                responses.push('request_data', 'analyze_thoroughly');\n                break;\n        }\n        \n        return responses;\n    }\n\n    /**\n     * Generate alien response to player action\n     */\n    private generateAlienResponse(\n        encounter: AlienEncounter,\n        action: AlienAction,\n        profile: AlienSpeciesProfile\n    ): AlienResponse {\n        let responseType: AlienResponse['type'] = 'neutral';\n        let intensity = 50;\n        let description = '';\n        let culturalReason = '';\n        \n        // Evaluate action based on alien psychology and culture\n        const evaluation = this.evaluateAction(action, profile, encounter);\n        \n        responseType = evaluation.type;\n        intensity = evaluation.intensity;\n        \n        // Generate description based on response type and species\n        description = this.generateResponseDescription(responseType, profile, action);\n        \n        // Add cultural context if relevant\n        if (evaluation.culturalFactor) {\n            culturalReason = evaluation.culturalFactor;\n        }\n        \n        return {\n            actionId: action.id,\n            type: responseType,\n            description,\n            intensity,\n            culturalReason,\n            psychologicalState: this.determineAlienPsychologicalState(encounter, profile)\n        };\n    }\n\n    /**\n     * Evaluate player action from alien perspective\n     */\n    private evaluateAction(\n        action: AlienAction,\n        profile: AlienSpeciesProfile,\n        encounter: AlienEncounter\n    ): { type: AlienResponse['type'], intensity: number, culturalFactor?: string } {\n        let evaluation = { type: 'neutral' as AlienResponse['type'], intensity: 50 };\n        \n        // Check for cultural triggers\n        const triggers = this.checkCulturalTriggers(action, profile);\n        if (triggers.hostile.length > 0) {\n            evaluation.type = 'hostile';\n            evaluation.intensity = 80;\n            return { ...evaluation, culturalFactor: triggers.hostile[0] };\n        }\n        \n        if (triggers.positive.length > 0) {\n            evaluation.type = 'positive';\n            evaluation.intensity = 70;\n            return { ...evaluation, culturalFactor: triggers.positive[0] };\n        }\n        \n        // Evaluate based on species behavior\n        switch (profile.behaviorPatterns.primary) {\n            case AlienBehaviorType.Curious:\n                if (action.type === 'communicate' || action.type === 'demonstrate') {\n                    evaluation.type = 'curious';\n                    evaluation.intensity = 60 + action.intensity * 0.3;\n                }\n                break;\n                \n            case AlienBehaviorType.Aggressive:\n                if (action.type === 'threaten') {\n                    evaluation.type = 'hostile';\n                    evaluation.intensity = 90;\n                } else if (action.type === 'approach') {\n                    evaluation.type = 'negative';\n                    evaluation.intensity = 70;\n                }\n                break;\n                \n            case AlienBehaviorType.Scholar:\n                if (action.type === 'probe' || action.type === 'communicate') {\n                    evaluation.type = 'curious';\n                    evaluation.intensity = 50 + action.complexity * 5;\n                }\n                break;\n                \n            case AlienBehaviorType.Isolationist:\n                if (action.type === 'approach') {\n                    evaluation.type = 'negative';\n                    evaluation.intensity = 60;\n                } else if (action.type === 'retreat') {\n                    evaluation.type = 'positive';\n                    evaluation.intensity = 40;\n                }\n                break;\n        }\n        \n        // Adjust for encounter state\n        evaluation.intensity += encounter.suspicion * 0.2;\n        evaluation.intensity -= encounter.interest * 0.1;\n        \n        return evaluation;\n    }\n\n    /**\n     * Check for cultural triggers\n     */\n    private checkCulturalTriggers(action: AlienAction, profile: AlienSpeciesProfile): {\n        hostile: string[],\n        positive: string[]\n    } {\n        const triggers = { hostile: [] as string[], positive: [] as string[] };\n        \n        // Check aggression triggers\n        profile.behaviorPatterns.aggressionTriggers.forEach(trigger => {\n            if (this.actionMatchesTrigger(action, trigger)) {\n                triggers.hostile.push(trigger);\n            }\n        });\n        \n        // Check friendship factors\n        profile.behaviorPatterns.friendshipFactors.forEach(factor => {\n            if (this.actionMatchesFactor(action, factor)) {\n                triggers.positive.push(factor);\n            }\n        });\n        \n        return triggers;\n    }\n\n    /**\n     * Check if action matches aggression trigger\n     */\n    private actionMatchesTrigger(action: AlienAction, trigger: string): boolean {\n        const matches = {\n            'threat_display': action.type === 'threaten',\n            'territorial_intrusion': action.type === 'approach' && action.intensity > 70,\n            'aggressive_scanning': action.type === 'probe' && action.intensity > 60,\n            'communication_disruption': action.type === 'communicate' && action.intensity > 80,\n            'unknown_entities': action.type === 'scan' || action.type === 'probe'\n        };\n        \n        return (matches as any)[trigger] || false;\n    }\n\n    /**\n     * Check if action matches friendship factor\n     */\n    private actionMatchesFactor(action: AlienAction, factor: string): boolean {\n        const matches = {\n            'peaceful_intentions': action.type === 'gift' || (action.type === 'communicate' && action.intensity < 50),\n            'cultural_exchange': action.type === 'demonstrate' || action.culturalContext !== undefined,\n            'respect_for_knowledge': action.type === 'communicate' && action.complexity > 6,\n            'technological_sharing': action.type === 'gift' && action.culturalContext?.includes('technology'),\n            'mutual_benefit': action.type === 'gift' || action.type === 'demonstrate'\n        };\n        \n        return (matches as any)[factor] || false;\n    }\n\n    /**\n     * Generate response description\n     */\n    private generateResponseDescription(\n        type: AlienResponse['type'],\n        profile: AlienSpeciesProfile,\n        action: AlienAction\n    ): string {\n        const speciesName = profile.name;\n        \n        const descriptions = {\n            positive: [\n                `${speciesName} vessel responds with apparent approval`,\n                `Alien ship displays positive acknowledgment patterns`,\n                `${speciesName} entities seem pleased with your action`\n            ],\n            negative: [\n                `${speciesName} ship shows signs of disapproval`,\n                `Alien vessel withdraws slightly, emanating negative energy`,\n                `${speciesName} entities appear displeased with your approach`\n            ],\n            curious: [\n                `${speciesName} vessel increases sensor activity, studying you intently`,\n                `Alien ship approaches closer, displaying obvious curiosity`,\n                `${speciesName} entities begin complex scanning procedures`\n            ],\n            hostile: [\n                `${speciesName} vessel powers up weapons systems`,\n                `Alien ship assumes aggressive posture`,\n                `${speciesName} entities broadcast clear threat signals`\n            ],\n            confused: [\n                `${speciesName} ship seems uncertain how to interpret your action`,\n                `Alien vessel displays erratic movement patterns`,\n                `${speciesName} entities appear to be consulting among themselves`\n            ],\n            neutral: [\n                `${speciesName} vessel maintains current position`,\n                `Alien ship shows no particular reaction`,\n                `${speciesName} entities continue previous activities`\n            ]\n        };\n        \n        const typeDescriptions = descriptions[type] || descriptions.neutral;\n        return typeDescriptions[Math.floor(Math.random() * typeDescriptions.length)];\n    }\n\n    /**\n     * Determine alien psychological state\n     */\n    private determineAlienPsychologicalState(encounter: AlienEncounter, profile: AlienSpeciesProfile): string {\n        const states = [];\n        \n        if (encounter.suspicion > 70) states.push('highly_suspicious');\n        else if (encounter.suspicion > 40) states.push('cautious');\n        \n        if (encounter.interest > 70) states.push('fascinated');\n        else if (encounter.interest > 40) states.push('interested');\n        \n        if (encounter.intensity > 80) states.push('agitated');\n        else if (encounter.intensity < 20) states.push('calm');\n        \n        // Add species-specific states\n        switch (profile.behaviorPatterns.primary) {\n            case AlienBehaviorType.Scholar:\n                states.push('analytical');\n                break;\n            case AlienBehaviorType.Curious:\n                states.push('inquisitive');\n                break;\n            case AlienBehaviorType.Aggressive:\n                states.push('territorial');\n                break;\n        }\n        \n        return states.length > 0 ? states.join(', ') : 'neutral';\n    }\n\n    /**\n     * Update encounter state based on interaction\n     */\n    private updateEncounterState(\n        encounter: AlienEncounter,\n        action: AlienAction,\n        response: AlienResponse,\n        profile: AlienSpeciesProfile\n    ): void {\n        // Update suspicion\n        switch (response.type) {\n            case 'positive':\n                encounter.suspicion = Math.max(0, encounter.suspicion - 15);\n                break;\n            case 'negative':\n                encounter.suspicion = Math.min(100, encounter.suspicion + 10);\n                break;\n            case 'hostile':\n                encounter.suspicion = Math.min(100, encounter.suspicion + 25);\n                break;\n        }\n        \n        // Update interest\n        if (action.complexity > 6) {\n            encounter.interest = Math.min(100, encounter.interest + 10);\n        }\n        \n        // Update communication progress\n        if (action.type === 'communicate') {\n            encounter.translationProgress = Math.min(100, encounter.translationProgress + 5);\n            encounter.languageBarrier = Math.max(0, encounter.languageBarrier - 3);\n            \n            if (encounter.translationProgress > 30 && !encounter.communicationEstablished) {\n                encounter.communicationEstablished = true;\n                this.events.onCommunicationBreakthrough?.(encounter.species, profile.communication.primary);\n            }\n        }\n        \n        // Update cultural understanding\n        if (action.culturalContext) {\n            encounter.culturalUnderstanding = Math.min(100, encounter.culturalUnderstanding + 3);\n        }\n        \n        // Update encounter phase\n        this.updateEncounterPhase(encounter);\n        \n        // Update knowledge base\n        this.updateKnowledgeBase(encounter, action, response, profile);\n    }\n\n    /**\n     * Update encounter phase\n     */\n    private updateEncounterPhase(encounter: AlienEncounter): void {\n        const oldPhase = encounter.phase;\n        \n        if (encounter.phase === 'approach' && encounter.actions.length > 0) {\n            encounter.phase = 'contact';\n        } else if (encounter.phase === 'contact' && encounter.communicationEstablished) {\n            encounter.phase = 'communication';\n        } else if (encounter.phase === 'communication' && encounter.culturalUnderstanding > 50) {\n            encounter.phase = 'interaction';\n        } else if (encounter.suspicion < 20 && encounter.interest > 60) {\n            encounter.phase = 'resolution';\n            encounter.success = true;\n        }\n        \n        if (oldPhase !== encounter.phase) {\n            this.logger.info(`👽 Encounter phase changed: ${oldPhase} → ${encounter.phase}`);\n        }\n    }\n\n    /**\n     * Update knowledge base with new information\n     */\n    private updateKnowledgeBase(\n        encounter: AlienEncounter,\n        action: AlienAction,\n        response: AlienResponse,\n        profile: AlienSpeciesProfile\n    ): void {\n        const knowledge = this.knowledgeBase.get(encounter.species)!;\n        \n        // Update contact statistics\n        knowledge.totalContacts = Math.max(knowledge.totalContacts, 1);\n        \n        if (response.type === 'positive' || response.type === 'curious') {\n            knowledge.peacefulEncounters++;\n        } else if (response.type === 'hostile') {\n            knowledge.hostileEncounters++;\n        }\n        \n        if (encounter.communicationEstablished) {\n            knowledge.successfulCommunications++;\n        }\n        \n        // Update understanding levels\n        knowledge.languageComprehension = Math.max(knowledge.languageComprehension, encounter.translationProgress);\n        knowledge.culturalUnderstanding = Math.max(knowledge.culturalUnderstanding, encounter.culturalUnderstanding);\n        \n        // Add new knowledge\n        if (response.culturalReason && !knowledge.culturalTraits.includes(response.culturalReason)) {\n            knowledge.culturalTraits.push(response.culturalReason);\n            encounter.cultural_insights.push(response.culturalReason);\n            this.events.onCulturalInsight?.(encounter.species, response.culturalReason);\n        }\n        \n        // Add research points\n        knowledge.researchPoints += action.complexity;\n        \n        knowledge.lastUpdate = Date.now();\n    }\n\n    /**\n     * Get encounter by ID\n     */\n    getEncounter(encounterId: string): AlienEncounter | null {\n        return this.activeEncounters.get(encounterId) || null;\n    }\n\n    /**\n     * Get all active encounters\n     */\n    getActiveEncounters(): AlienEncounter[] {\n        return Array.from(this.activeEncounters.values());\n    }\n\n    /**\n     * Get species profile\n     */\n    getSpeciesProfile(species: AlienSpecies): AlienSpeciesProfile | null {\n        return this.speciesProfiles.get(species) || null;\n    }\n\n    /**\n     * Get knowledge about species\n     */\n    getSpeciesKnowledge(species: AlienSpecies): AlienKnowledge | null {\n        return this.knowledgeBase.get(species) || null;\n    }\n\n    /**\n     * Get all known species\n     */\n    getKnownSpecies(): AlienSpecies[] {\n        return Array.from(this.knowledgeBase.keys()).filter(species => {\n            const knowledge = this.knowledgeBase.get(species)!;\n            return knowledge.totalContacts > 0;\n        });\n    }\n\n    /**\n     * Complete encounter\n     */\n    completeEncounter(encounterId: string): AlienEncounter | null {\n        const encounter = this.activeEncounters.get(encounterId);\n        if (!encounter) return null;\n        \n        encounter.duration = Date.now() - encounter.timestamp;\n        \n        // Determine final success state\n        if (encounter.suspicion < 30 && encounter.interest > 50) {\n            encounter.success = true;\n        }\n        \n        // Award knowledge and technologies based on success\n        if (encounter.success) {\n            const profile = this.speciesProfiles.get(encounter.species)!;\n            this.awardEncounterRewards(encounter, profile);\n        }\n        \n        this.activeEncounters.delete(encounterId);\n        \n        this.logger.info(`👽 Encounter completed: ${encounter.species}`, {\n            success: encounter.success,\n            duration: encounter.duration / 1000,\n            knowledgeGained: encounter.knowledge_gained.length\n        });\n        \n        return encounter;\n    }\n\n    /**\n     * Award rewards for successful encounter\n     */\n    private awardEncounterRewards(encounter: AlienEncounter, profile: AlienSpeciesProfile): void {\n        const knowledge = this.knowledgeBase.get(encounter.species)!;\n        \n        // Award technologies based on species specializations\n        if (encounter.culturalUnderstanding > 70) {\n            const availableTech = profile.technology.specializations.filter(tech => \n                !knowledge.unlockedTechnologies.includes(tech)\n            );\n            \n            if (availableTech.length > 0) {\n                const newTech = availableTech[Math.floor(Math.random() * availableTech.length)];\n                knowledge.unlockedTechnologies.push(newTech);\n                encounter.technology_exchanged.push(newTech);\n                this.events.onTechnologyDiscovered?.(encounter.species, newTech);\n            }\n        }\n        \n        // Award knowledge points\n        knowledge.researchPoints += encounter.culturalUnderstanding + encounter.translationProgress;\n        \n        // Unlock secrets based on deep understanding\n        if (encounter.culturalUnderstanding > 80 && knowledge.discoveredSecrets.length < 3) {\n            const secretTypes = ['origin_mystery', 'technological_secret', 'cultural_ritual', 'psychological_insight'];\n            const newSecret = secretTypes[knowledge.discoveredSecrets.length];\n            knowledge.discoveredSecrets.push(newSecret);\n            encounter.knowledge_gained.push(newSecret);\n        }\n    }\n\n    /**\n     * Get alien AI statistics\n     */\n    getAlienAIStats(): {\n        totalEncounters: number;\n        activeEncounters: number;\n        knownSpecies: number;\n        successfulContacts: number;\n        hostileEncounters: number;\n        totalKnowledge: number;\n        unlockedTechnologies: number;\n    } {\n        const knownSpecies = this.getKnownSpecies();\n        let totalEncounters = 0;\n        let successfulContacts = 0;\n        let hostileEncounters = 0;\n        let totalKnowledge = 0;\n        let unlockedTechnologies = 0;\n        \n        for (const knowledge of this.knowledgeBase.values()) {\n            totalEncounters += knowledge.totalContacts;\n            successfulContacts += knowledge.successfulCommunications;\n            hostileEncounters += knowledge.hostileEncounters;\n            totalKnowledge += knowledge.researchPoints;\n            unlockedTechnologies += knowledge.unlockedTechnologies.length;\n        }\n        \n        return {\n            totalEncounters,\n            activeEncounters: this.activeEncounters.size,\n            knownSpecies: knownSpecies.length,\n            successfulContacts,\n            hostileEncounters,\n            totalKnowledge,\n            unlockedTechnologies\n        };\n    }\n\n    /**\n     * Save alien AI data\n     */\n    saveAlienAIData(): any {\n        return {\n            activeEncounters: Array.from(this.activeEncounters.entries()),\n            knowledgeBase: Array.from(this.knowledgeBase.entries()),\n            encounterPatterns: Array.from(this.encounterPatterns.entries()),\n            adaptiveBehaviors: Array.from(this.adaptiveBehaviors.entries())\n        };\n    }\n\n    /**\n     * Load alien AI data\n     */\n    loadAlienAIData(data: any): void {\n        if (data.activeEncounters) {\n            this.activeEncounters = new Map(data.activeEncounters);\n        }\n        if (data.knowledgeBase) {\n            this.knowledgeBase = new Map(data.knowledgeBase);\n        }\n        if (data.encounterPatterns) {\n            this.encounterPatterns = new Map(data.encounterPatterns);\n        }\n        if (data.adaptiveBehaviors) {\n            this.adaptiveBehaviors = new Map(data.adaptiveBehaviors);\n        }\n        \n        this.logger.info('👽 Alien AI data loaded', {\n            encounters: this.activeEncounters.size,\n            knownSpecies: this.getKnownSpecies().length\n        });\n    }\n}","/**\n * Performance Monitor\n * Advanced system for tracking game performance and optimization\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Platform, PlatformDetector } from '@utils/Platform';\n\nexport interface PerformanceMetrics {\n    // Frame timing\n    fps: number;\n    frameTime: number; // milliseconds\n    deltaTime: number;\n    \n    // Memory usage\n    memoryUsed: number; // MB\n    memoryTotal: number; // MB\n    memoryPercentage: number;\n    \n    // Rendering\n    drawCalls: number;\n    triangles: number;\n    \n    // System\n    cpuUsage: number; // Estimated\n    batteryLevel?: number;\n    thermalState?: 'normal' | 'fair' | 'serious' | 'critical';\n    \n    // Network\n    latency?: number;\n    bandwidth?: number;\n    \n    // Game specific\n    activeEntities: number;\n    activeSounds: number;\n    textureMemory: number;\n    \n    timestamp: number;\n}\n\nexport interface PerformanceThresholds {\n    fps: {\n        excellent: number;\n        good: number;\n        acceptable: number;\n        poor: number;\n    };\n    memory: {\n        low: number;\n        medium: number;\n        high: number;\n        critical: number;\n    };\n    frameTime: {\n        target: number;\n        warning: number;\n        critical: number;\n    };\n}\n\nexport interface PerformanceSettings {\n    // Rendering quality\n    renderScale: number; // 0.5 - 2.0\n    particleQuality: 'low' | 'medium' | 'high';\n    shadowQuality: 'off' | 'low' | 'medium' | 'high';\n    \n    // Effects\n    postProcessing: boolean;\n    bloom: boolean;\n    antiAliasing: boolean;\n    \n    // LOD settings\n    lodBias: number;\n    maxRenderDistance: number;\n    \n    // Audio\n    audioQuality: 'low' | 'medium' | 'high';\n    maxAudioSources: number;\n    \n    // Physics\n    physicsSteps: number;\n    collisionComplexity: 'simple' | 'medium' | 'complex';\n    \n    // Platform specific\n    mobileLowPowerMode: boolean;\n    vsync: boolean;\n    \n    // Auto-optimization\n    autoOptimize: boolean;\n    adaptiveQuality: boolean;\n}\n\nexport interface OptimizationRecommendation {\n    category: 'rendering' | 'memory' | 'audio' | 'physics' | 'general';\n    severity: 'info' | 'warning' | 'critical';\n    title: string;\n    description: string;\n    impact: 'low' | 'medium' | 'high';\n    settings: Partial<PerformanceSettings>;\n    automaticApply: boolean;\n}\n\nexport interface PerformanceEvents {\n    onPerformanceUpdate?: (metrics: PerformanceMetrics) => void;\n    onThresholdExceeded?: (metric: string, value: number, threshold: number) => void;\n    onOptimizationRecommended?: (recommendations: OptimizationRecommendation[]) => void;\n    onSettingsChanged?: (settings: PerformanceSettings) => void;\n}\n\nexport class PerformanceMonitor {\n    // Metrics tracking\n    private metrics: PerformanceMetrics[] = [];\n    private currentMetrics: PerformanceMetrics;\n    private maxHistory: number = 300; // 5 minutes at 60fps\n    \n    // Timing\n    private frameStartTime: number = 0;\n    private lastFrameTime: number = 0;\n    private fpsHistory: number[] = [];\n    private fpsCounter: number = 0;\n    private fpsTimer: number = 0;\n    \n    // Memory tracking\n    private memoryObserver: PerformanceObserver | null = null;\n    \n    // Performance thresholds\n    private thresholds: PerformanceThresholds;\n    \n    // Current settings\n    private settings: PerformanceSettings;\n    \n    // Platform info\n    private platform: Platform;\n    \n    // Optimization\n    private lastOptimizationCheck: number = 0;\n    private optimizationInterval: number = 10000; // 10 seconds\n    \n    private events: PerformanceEvents;\n    private logger: Logger;\n\n    constructor(events: PerformanceEvents = {}) {\n        this.logger = new Logger('PerformanceMonitor');\n        this.events = events;\n        this.platform = PlatformDetector.detect();\n        \n        // Initialize default thresholds\n        this.thresholds = this.getDefaultThresholds();\n        \n        // Initialize default settings based on platform\n        this.settings = this.getDefaultSettings();\n        \n        // Initialize current metrics\n        this.currentMetrics = this.createEmptyMetrics();\n        \n        this.logger.info('📊 Performance monitor initialized');\n    }\n\n    /**\n     * Initialize performance monitoring\n     */\n    initialize(): void {\n        this.setupMemoryObserver();\n        this.startMonitoring();\n        \n        // Auto-optimization if enabled\n        if (this.settings.autoOptimize) {\n            this.enableAutoOptimization();\n        }\n        \n        this.logger.info('📊 Performance monitoring started');\n    }\n\n    /**\n     * Setup memory observer\n     */\n    private setupMemoryObserver(): void {\n        if ('PerformanceObserver' in window) {\n            try {\n                this.memoryObserver = new PerformanceObserver((list) => {\n                    for (const entry of list.getEntries()) {\n                        if (entry.entryType === 'measure') {\n                            // Process memory measurements\n                        }\n                    }\n                });\n                \n                this.memoryObserver.observe({ entryTypes: ['measure'] });\n            } catch (error) {\n                this.logger.warn('Failed to setup memory observer', error);\n            }\n        }\n    }\n\n    /**\n     * Start performance monitoring\n     */\n    private startMonitoring(): void {\n        // Setup frame timing\n        this.frameStartTime = performance.now();\n        this.lastFrameTime = this.frameStartTime;\n    }\n\n    /**\n     * Update performance metrics\n     */\n    update(deltaTime: number): void {\n        const now = performance.now();\n        \n        // Update frame timing\n        this.updateFrameTiming(now, deltaTime);\n        \n        // Update memory usage\n        this.updateMemoryUsage();\n        \n        // Update system metrics\n        this.updateSystemMetrics();\n        \n        // Update current metrics\n        this.updateCurrentMetrics(now);\n        \n        // Store metrics history\n        this.storeMetrics();\n        \n        // Check thresholds\n        this.checkThresholds();\n        \n        // Auto-optimization check\n        if (this.settings.autoOptimize && now - this.lastOptimizationCheck > this.optimizationInterval) {\n            this.performOptimizationCheck();\n            this.lastOptimizationCheck = now;\n        }\n        \n        // Emit performance update\n        this.events.onPerformanceUpdate?.(this.currentMetrics);\n    }\n\n    /**\n     * Update frame timing metrics\n     */\n    private updateFrameTiming(now: number, deltaTime: number): void {\n        const frameTime = now - this.frameStartTime;\n        this.frameStartTime = now;\n        \n        // Update FPS\n        this.fpsCounter++;\n        this.fpsTimer += deltaTime;\n        \n        if (this.fpsTimer >= 1000) { // Update every second\n            const fps = this.fpsCounter / (this.fpsTimer / 1000);\n            this.fpsHistory.push(fps);\n            \n            if (this.fpsHistory.length > 60) { // Keep 60 seconds\n                this.fpsHistory.shift();\n            }\n            \n            this.fpsCounter = 0;\n            this.fpsTimer = 0;\n        }\n        \n        this.currentMetrics.frameTime = frameTime;\n        this.currentMetrics.deltaTime = deltaTime;\n        this.currentMetrics.fps = this.getAverageFPS();\n    }\n\n    /**\n     * Update memory usage\n     */\n    private updateMemoryUsage(): void {\n        if ('memory' in performance) {\n            const memory = (performance as any).memory;\n            \n            this.currentMetrics.memoryUsed = memory.usedJSHeapSize / 1024 / 1024; // MB\n            this.currentMetrics.memoryTotal = memory.totalJSHeapSize / 1024 / 1024; // MB\n            this.currentMetrics.memoryPercentage = (this.currentMetrics.memoryUsed / this.currentMetrics.memoryTotal) * 100;\n        } else {\n            // Estimate memory usage\n            this.currentMetrics.memoryUsed = this.estimateMemoryUsage();\n            this.currentMetrics.memoryTotal = this.estimateTotalMemory();\n            this.currentMetrics.memoryPercentage = (this.currentMetrics.memoryUsed / this.currentMetrics.memoryTotal) * 100;\n        }\n    }\n\n    /**\n     * Update system metrics\n     */\n    private updateSystemMetrics(): void {\n        // CPU usage estimation based on frame time\n        const targetFrameTime = 1000 / 60; // 16.67ms for 60fps\n        this.currentMetrics.cpuUsage = Math.min(100, (this.currentMetrics.frameTime / targetFrameTime) * 100);\n        \n        // Battery level (if available)\n        if ('getBattery' in navigator) {\n            (navigator as any).getBattery().then((battery: any) => {\n                this.currentMetrics.batteryLevel = battery.level * 100;\n            }).catch(() => {\n                // Battery API not available\n            });\n        }\n        \n        // Thermal state estimation\n        this.currentMetrics.thermalState = this.estimateThermalState();\n    }\n\n    /**\n     * Update current metrics timestamp\n     */\n    private updateCurrentMetrics(now: number): void {\n        this.currentMetrics.timestamp = now;\n    }\n\n    /**\n     * Store metrics in history\n     */\n    private storeMetrics(): void {\n        this.metrics.push({ ...this.currentMetrics });\n        \n        if (this.metrics.length > this.maxHistory) {\n            this.metrics.shift();\n        }\n    }\n\n    /**\n     * Check performance thresholds\n     */\n    private checkThresholds(): void {\n        // FPS threshold\n        if (this.currentMetrics.fps < this.thresholds.fps.poor) {\n            this.events.onThresholdExceeded?.('fps', this.currentMetrics.fps, this.thresholds.fps.poor);\n        }\n        \n        // Memory threshold\n        if (this.currentMetrics.memoryPercentage > this.thresholds.memory.critical) {\n            this.events.onThresholdExceeded?.('memory', this.currentMetrics.memoryPercentage, this.thresholds.memory.critical);\n        }\n        \n        // Frame time threshold\n        if (this.currentMetrics.frameTime > this.thresholds.frameTime.critical) {\n            this.events.onThresholdExceeded?.('frameTime', this.currentMetrics.frameTime, this.thresholds.frameTime.critical);\n        }\n    }\n\n    /**\n     * Perform optimization check\n     */\n    private performOptimizationCheck(): void {\n        const recommendations = this.generateOptimizationRecommendations();\n        \n        if (recommendations.length > 0) {\n            this.events.onOptimizationRecommended?.(recommendations);\n            \n            // Auto-apply critical recommendations\n            recommendations.forEach(rec => {\n                if (rec.automaticApply && rec.severity === 'critical') {\n                    this.applyRecommendation(rec);\n                }\n            });\n        }\n    }\n\n    /**\n     * Generate optimization recommendations\n     */\n    private generateOptimizationRecommendations(): OptimizationRecommendation[] {\n        const recommendations: OptimizationRecommendation[] = [];\n        \n        // Low FPS recommendations\n        if (this.currentMetrics.fps < this.thresholds.fps.acceptable) {\n            if (this.settings.renderScale > 0.75) {\n                recommendations.push({\n                    category: 'rendering',\n                    severity: 'warning',\n                    title: 'Reduce Render Scale',\n                    description: 'Lower the render scale to improve performance',\n                    impact: 'high',\n                    settings: { renderScale: Math.max(0.5, this.settings.renderScale - 0.25) },\n                    automaticApply: this.currentMetrics.fps < this.thresholds.fps.poor\n                });\n            }\n            \n            if (this.settings.particleQuality !== 'low') {\n                recommendations.push({\n                    category: 'rendering',\n                    severity: 'warning',\n                    title: 'Reduce Particle Quality',\n                    description: 'Lower particle effects quality to improve performance',\n                    impact: 'medium',\n                    settings: { particleQuality: 'low' },\n                    automaticApply: this.currentMetrics.fps < this.thresholds.fps.poor\n                });\n            }\n            \n            if (this.settings.postProcessing) {\n                recommendations.push({\n                    category: 'rendering',\n                    severity: 'info',\n                    title: 'Disable Post-Processing',\n                    description: 'Turn off post-processing effects to improve performance',\n                    impact: 'medium',\n                    settings: { postProcessing: false },\n                    automaticApply: false\n                });\n            }\n        }\n        \n        // High memory usage recommendations\n        if (this.currentMetrics.memoryPercentage > this.thresholds.memory.high) {\n            recommendations.push({\n                category: 'memory',\n                severity: 'warning',\n                title: 'Reduce Audio Sources',\n                description: 'Limit the number of simultaneous audio sources',\n                impact: 'low',\n                settings: { maxAudioSources: Math.max(8, this.settings.maxAudioSources - 4) },\n                automaticApply: this.currentMetrics.memoryPercentage > this.thresholds.memory.critical\n            });\n            \n            recommendations.push({\n                category: 'memory',\n                severity: 'warning',\n                title: 'Reduce LOD Distance',\n                description: 'Decrease maximum render distance for objects',\n                impact: 'medium',\n                settings: { maxRenderDistance: this.settings.maxRenderDistance * 0.8 },\n                automaticApply: this.currentMetrics.memoryPercentage > this.thresholds.memory.critical\n            });\n        }\n        \n        // Platform-specific recommendations\n        if (this.platform === Platform.Mobile) {\n            if (!this.settings.mobileLowPowerMode && this.currentMetrics.batteryLevel && this.currentMetrics.batteryLevel < 20) {\n                recommendations.push({\n                    category: 'general',\n                    severity: 'info',\n                    title: 'Enable Low Power Mode',\n                    description: 'Activate power saving features for mobile devices',\n                    impact: 'medium',\n                    settings: { \n                        mobileLowPowerMode: true,\n                        renderScale: 0.75,\n                        particleQuality: 'low',\n                        audioQuality: 'low'\n                    },\n                    automaticApply: false\n                });\n            }\n        }\n        \n        return recommendations;\n    }\n\n    /**\n     * Apply optimization recommendation\n     */\n    applyRecommendation(recommendation: OptimizationRecommendation): void {\n        const oldSettings = { ...this.settings };\n        \n        // Apply settings changes\n        Object.assign(this.settings, recommendation.settings);\n        \n        this.events.onSettingsChanged?.(this.settings);\n        \n        this.logger.info(`Applied optimization: ${recommendation.title}`, {\n            category: recommendation.category,\n            impact: recommendation.impact,\n            settings: recommendation.settings\n        });\n    }\n\n    /**\n     * Get default performance thresholds\n     */\n    private getDefaultThresholds(): PerformanceThresholds {\n        return {\n            fps: {\n                excellent: 60,\n                good: 45,\n                acceptable: 30,\n                poor: 20\n            },\n            memory: {\n                low: 25,     // 25% of available memory\n                medium: 50,  // 50% of available memory\n                high: 75,    // 75% of available memory\n                critical: 90 // 90% of available memory\n            },\n            frameTime: {\n                target: 16.67,   // 60fps target\n                warning: 33.33,  // 30fps warning\n                critical: 50     // 20fps critical\n            }\n        };\n    }\n\n    /**\n     * Get default performance settings\n     */\n    private getDefaultSettings(): PerformanceSettings {\n        const baseSettings: PerformanceSettings = {\n            renderScale: 1.0,\n            particleQuality: 'high',\n            shadowQuality: 'medium',\n            postProcessing: true,\n            bloom: true,\n            antiAliasing: true,\n            lodBias: 1.0,\n            maxRenderDistance: 1000,\n            audioQuality: 'high',\n            maxAudioSources: 32,\n            physicsSteps: 60,\n            collisionComplexity: 'medium',\n            mobileLowPowerMode: false,\n            vsync: true,\n            autoOptimize: true,\n            adaptiveQuality: true\n        };\n        \n        // Platform-specific adjustments\n        switch (this.platform) {\n            case Platform.Mobile:\n                return {\n                    ...baseSettings,\n                    renderScale: 0.8,\n                    particleQuality: 'medium',\n                    shadowQuality: 'low',\n                    postProcessing: false,\n                    bloom: false,\n                    antiAliasing: false,\n                    maxRenderDistance: 500,\n                    audioQuality: 'medium',\n                    maxAudioSources: 16,\n                    physicsSteps: 30,\n                    collisionComplexity: 'simple'\n                };\n                \n            case Platform.Desktop:\n                return baseSettings;\n                \n            default:\n                return {\n                    ...baseSettings,\n                    renderScale: 0.9,\n                    particleQuality: 'medium',\n                    shadowQuality: 'medium'\n                };\n        }\n    }\n\n    /**\n     * Create empty metrics object\n     */\n    private createEmptyMetrics(): PerformanceMetrics {\n        return {\n            fps: 0,\n            frameTime: 0,\n            deltaTime: 0,\n            memoryUsed: 0,\n            memoryTotal: 0,\n            memoryPercentage: 0,\n            drawCalls: 0,\n            triangles: 0,\n            cpuUsage: 0,\n            activeEntities: 0,\n            activeSounds: 0,\n            textureMemory: 0,\n            timestamp: 0\n        };\n    }\n\n    /**\n     * Get average FPS from history\n     */\n    private getAverageFPS(): number {\n        if (this.fpsHistory.length === 0) return 0;\n        \n        const sum = this.fpsHistory.reduce((a, b) => a + b, 0);\n        return sum / this.fpsHistory.length;\n    }\n\n    /**\n     * Estimate memory usage (fallback)\n     */\n    private estimateMemoryUsage(): number {\n        // Rough estimation based on platform and active entities\n        const baseMemory = this.platform === Platform.Mobile ? 50 : 100; // MB\n        const entityMemory = this.currentMetrics.activeEntities * 0.1; // 0.1MB per entity\n        const audioMemory = this.currentMetrics.activeSounds * 2; // 2MB per sound\n        \n        return baseMemory + entityMemory + audioMemory;\n    }\n\n    /**\n     * Estimate total memory (fallback)\n     */\n    private estimateTotalMemory(): number {\n        switch (this.platform) {\n            case Platform.Mobile:\n                return 1024; // 1GB typical mobile\n            case Platform.Desktop:\n                return 4096; // 4GB typical desktop\n            default:\n                return 2048; // 2GB fallback\n        }\n    }\n\n    /**\n     * Estimate thermal state\n     */\n    private estimateThermalState(): PerformanceMetrics['thermalState'] {\n        // Estimate based on CPU usage and sustained performance\n        if (this.currentMetrics.cpuUsage > 90) return 'critical';\n        if (this.currentMetrics.cpuUsage > 75) return 'serious';\n        if (this.currentMetrics.cpuUsage > 50) return 'fair';\n        return 'normal';\n    }\n\n    /**\n     * Enable auto-optimization\n     */\n    private enableAutoOptimization(): void {\n        this.settings.autoOptimize = true;\n        this.settings.adaptiveQuality = true;\n        \n        this.logger.info('🔧 Auto-optimization enabled');\n    }\n\n    /**\n     * Set game-specific metrics\n     */\n    setGameMetrics(metrics: {\n        activeEntities?: number;\n        activeSounds?: number;\n        drawCalls?: number;\n        triangles?: number;\n        textureMemory?: number;\n    }): void {\n        if (metrics.activeEntities !== undefined) this.currentMetrics.activeEntities = metrics.activeEntities;\n        if (metrics.activeSounds !== undefined) this.currentMetrics.activeSounds = metrics.activeSounds;\n        if (metrics.drawCalls !== undefined) this.currentMetrics.drawCalls = metrics.drawCalls;\n        if (metrics.triangles !== undefined) this.currentMetrics.triangles = metrics.triangles;\n        if (metrics.textureMemory !== undefined) this.currentMetrics.textureMemory = metrics.textureMemory;\n    }\n\n    /**\n     * Get current performance metrics\n     */\n    getCurrentMetrics(): PerformanceMetrics {\n        return { ...this.currentMetrics };\n    }\n\n    /**\n     * Get metrics history\n     */\n    getMetricsHistory(duration?: number): PerformanceMetrics[] {\n        if (!duration) return [...this.metrics];\n        \n        const cutoff = Date.now() - duration;\n        return this.metrics.filter(m => m.timestamp >= cutoff);\n    }\n\n    /**\n     * Get performance summary\n     */\n    getPerformanceSummary(): {\n        averageFPS: number;\n        minFPS: number;\n        maxFPS: number;\n        averageFrameTime: number;\n        averageMemoryUsage: number;\n        performanceGrade: 'excellent' | 'good' | 'acceptable' | 'poor';\n    } {\n        const recentMetrics = this.getMetricsHistory(60000); // Last minute\n        \n        if (recentMetrics.length === 0) {\n            return {\n                averageFPS: 0,\n                minFPS: 0,\n                maxFPS: 0,\n                averageFrameTime: 0,\n                averageMemoryUsage: 0,\n                performanceGrade: 'poor'\n            };\n        }\n        \n        const fps = recentMetrics.map(m => m.fps);\n        const frameTime = recentMetrics.map(m => m.frameTime);\n        const memory = recentMetrics.map(m => m.memoryPercentage);\n        \n        const averageFPS = fps.reduce((a, b) => a + b, 0) / fps.length;\n        const minFPS = Math.min(...fps);\n        const maxFPS = Math.max(...fps);\n        const averageFrameTime = frameTime.reduce((a, b) => a + b, 0) / frameTime.length;\n        const averageMemoryUsage = memory.reduce((a, b) => a + b, 0) / memory.length;\n        \n        // Determine performance grade\n        let performanceGrade: 'excellent' | 'good' | 'acceptable' | 'poor';\n        if (averageFPS >= this.thresholds.fps.excellent && averageMemoryUsage < this.thresholds.memory.medium) {\n            performanceGrade = 'excellent';\n        } else if (averageFPS >= this.thresholds.fps.good && averageMemoryUsage < this.thresholds.memory.high) {\n            performanceGrade = 'good';\n        } else if (averageFPS >= this.thresholds.fps.acceptable) {\n            performanceGrade = 'acceptable';\n        } else {\n            performanceGrade = 'poor';\n        }\n        \n        return {\n            averageFPS,\n            minFPS,\n            maxFPS,\n            averageFrameTime,\n            averageMemoryUsage,\n            performanceGrade\n        };\n    }\n\n    /**\n     * Update performance settings\n     */\n    updateSettings(newSettings: Partial<PerformanceSettings>): void {\n        const oldSettings = { ...this.settings };\n        Object.assign(this.settings, newSettings);\n        \n        this.events.onSettingsChanged?.(this.settings);\n        \n        this.logger.info('⚙️ Performance settings updated', {\n            changes: Object.keys(newSettings),\n            newSettings\n        });\n    }\n\n    /**\n     * Get current settings\n     */\n    getSettings(): PerformanceSettings {\n        return { ...this.settings };\n    }\n\n    /**\n     * Reset to default settings\n     */\n    resetToDefaults(): void {\n        this.settings = this.getDefaultSettings();\n        this.events.onSettingsChanged?.(this.settings);\n        \n        this.logger.info('↩️ Performance settings reset to defaults');\n    }\n\n    /**\n     * Dispose performance monitor\n     */\n    dispose(): void {\n        if (this.memoryObserver) {\n            this.memoryObserver.disconnect();\n            this.memoryObserver = null;\n        }\n        \n        this.metrics = [];\n        this.fpsHistory = [];\n        \n        this.logger.info('📊 Performance monitor disposed');\n    }\n}","/**\n * Particle System\n * Advanced particle effects for retro space game visuals\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\n\nexport enum ParticleType {\n    Explosion = 'explosion',\n    Thrust = 'thrust',\n    Laser = 'laser',\n    Shield = 'shield',\n    Spark = 'spark',\n    Smoke = 'smoke',\n    Debris = 'debris',\n    StarField = 'starfield',\n    WarpTrail = 'warp_trail',\n    Beam = 'beam'\n}\n\nexport interface Particle {\n    id: string;\n    type: ParticleType;\n    position: { x: number, y: number };\n    velocity: { x: number, y: number };\n    acceleration: { x: number, y: number };\n    \n    // Visual properties\n    size: number;\n    color: Color;\n    alpha: number;\n    rotation: number;\n    rotationSpeed: number;\n    \n    // Lifecycle\n    age: number;\n    maxAge: number;\n    \n    // Behavior\n    gravity: number;\n    bounce: number;\n    friction: number;\n    \n    // Animation\n    sizeAnimation?: {\n        startSize: number;\n        endSize: number;\n        curve: 'linear' | 'ease-in' | 'ease-out' | 'ease-in-out';\n    };\n    \n    colorAnimation?: {\n        startColor: Color;\n        endColor: Color;\n        curve: 'linear' | 'ease-in' | 'ease-out' | 'ease-in-out';\n    };\n    \n    alphaAnimation?: {\n        startAlpha: number;\n        endAlpha: number;\n        curve: 'linear' | 'ease-in' | 'ease-out' | 'ease-in-out';\n    };\n}\n\nexport interface ParticleEmitter {\n    id: string;\n    type: ParticleType;\n    position: { x: number, y: number };\n    \n    // Emission properties\n    emissionRate: number; // particles per second\n    burstCount: number; // particles per burst\n    \n    // Particle spawn properties\n    velocityRange: {\n        min: { x: number, y: number };\n        max: { x: number, y: number };\n    };\n    \n    sizeRange: { min: number, max: number };\n    lifeRange: { min: number, max: number };\n    colorVariation: number; // 0-1\n    \n    // Emitter lifecycle\n    active: boolean;\n    duration: number; // -1 for infinite\n    startTime: number;\n    \n    // Shape\n    shape: 'point' | 'circle' | 'rectangle' | 'cone';\n    shapeData: any;\n}\n\nexport interface ParticleSystemConfig {\n    maxParticles: number;\n    qualityScale: number; // 0-1, affects particle count\n    enableTrails: boolean;\n    enableBloom: boolean;\n    pixelPerfect: boolean;\n}\n\nexport interface ParticleEvents {\n    onParticleSpawned?: (particle: Particle) => void;\n    onParticleDied?: (particle: Particle) => void;\n    onEmitterCompleted?: (emitter: ParticleEmitter) => void;\n}\n\nexport class ParticleSystem {\n    private particles: Map<string, Particle> = new Map();\n    private emitters: Map<string, ParticleEmitter> = new Map();\n    \n    private nextParticleId: number = 0;\n    private nextEmitterId: number = 0;\n    \n    private config: ParticleSystemConfig;\n    private events: ParticleEvents;\n    private logger: Logger;\n\n    constructor(config: Partial<ParticleSystemConfig> = {}, events: ParticleEvents = {}) {\n        this.logger = new Logger('ParticleSystem');\n        this.events = events;\n        \n        this.config = {\n            maxParticles: 1000,\n            qualityScale: 1.0,\n            enableTrails: true,\n            enableBloom: false,\n            pixelPerfect: true,\n            ...config\n        };\n        \n        this.logger.info('✨ Particle system initialized');\n    }\n\n    /**\n     * Update particle system\n     */\n    update(deltaTime: number): void {\n        this.updateEmitters(deltaTime);\n        this.updateParticles(deltaTime);\n        this.cleanupParticles();\n    }\n\n    /**\n     * Update emitters\n     */\n    private updateEmitters(deltaTime: number): void {\n        const currentTime = Date.now();\n        \n        this.emitters.forEach((emitter, emitterId) => {\n            if (!emitter.active) return;\n            \n            // Check if emitter should expire\n            if (emitter.duration > 0 && currentTime - emitter.startTime > emitter.duration * 1000) {\n                emitter.active = false;\n                this.events.onEmitterCompleted?.(emitter);\n                return;\n            }\n            \n            // Emit particles based on rate\n            if (emitter.emissionRate > 0) {\n                const particlesToEmit = (emitter.emissionRate * deltaTime / 1000) * this.config.qualityScale;\n                const fullParticles = Math.floor(particlesToEmit);\n                const fractionalChance = particlesToEmit - fullParticles;\n                \n                for (let i = 0; i < fullParticles; i++) {\n                    this.emitParticle(emitter);\n                }\n                \n                // Emit fractional particle based on probability\n                if (Math.random() < fractionalChance) {\n                    this.emitParticle(emitter);\n                }\n            }\n            \n            // Handle burst emission\n            if (emitter.burstCount > 0) {\n                for (let i = 0; i < emitter.burstCount; i++) {\n                    this.emitParticle(emitter);\n                }\n                emitter.burstCount = 0; // Reset burst\n            }\n        });\n    }\n\n    /**\n     * Emit single particle from emitter\n     */\n    private emitParticle(emitter: ParticleEmitter): void {\n        if (this.particles.size >= this.config.maxParticles) {\n            // Remove oldest particle to make room\n            const oldestId = this.particles.keys().next().value;\n            if (oldestId) {\n                this.particles.delete(oldestId);\n            }\n        }\n        \n        const particleId = `particle_${this.nextParticleId++}`;\n        const spawnPosition = this.calculateSpawnPosition(emitter);\n        const velocity = this.calculateSpawnVelocity(emitter);\n        \n        const particle: Particle = {\n            id: particleId,\n            type: emitter.type,\n            position: { ...spawnPosition },\n            velocity,\n            acceleration: { x: 0, y: 0 },\n            \n            size: this.randomBetween(emitter.sizeRange.min, emitter.sizeRange.max),\n            color: this.generateParticleColor(emitter.type, emitter.colorVariation),\n            alpha: 1.0,\n            rotation: Math.random() * Math.PI * 2,\n            rotationSpeed: (Math.random() - 0.5) * 4, // -2 to 2 rad/s\n            \n            age: 0,\n            maxAge: this.randomBetween(emitter.lifeRange.min, emitter.lifeRange.max),\n            \n            gravity: this.getParticleGravity(emitter.type),\n            bounce: this.getParticleBounce(emitter.type),\n            friction: this.getParticleFriction(emitter.type)\n        };\n        \n        // Add animations based on particle type\n        this.addParticleAnimations(particle);\n        \n        this.particles.set(particleId, particle);\n        this.events.onParticleSpawned?.(particle);\n    }\n\n    /**\n     * Calculate spawn position based on emitter shape\n     */\n    private calculateSpawnPosition(emitter: ParticleEmitter): { x: number, y: number } {\n        const { position, shape, shapeData } = emitter;\n        \n        switch (shape) {\n            case 'point':\n                return { ...position };\n                \n            case 'circle':\n                const angle = Math.random() * Math.PI * 2;\n                const radius = Math.random() * (shapeData.radius || 10);\n                return {\n                    x: position.x + Math.cos(angle) * radius,\n                    y: position.y + Math.sin(angle) * radius\n                };\n                \n            case 'rectangle':\n                return {\n                    x: position.x + (Math.random() - 0.5) * (shapeData.width || 20),\n                    y: position.y + (Math.random() - 0.5) * (shapeData.height || 20)\n                };\n                \n            case 'cone':\n                const coneAngle = Math.random() * (shapeData.angle || Math.PI / 4) - (shapeData.angle || Math.PI / 4) / 2;\n                const coneRadius = Math.random() * (shapeData.radius || 10);\n                const direction = shapeData.direction || 0;\n                \n                return {\n                    x: position.x + Math.cos(direction + coneAngle) * coneRadius,\n                    y: position.y + Math.sin(direction + coneAngle) * coneRadius\n                };\n                \n            default:\n                return { ...position };\n        }\n    }\n\n    /**\n     * Calculate spawn velocity\n     */\n    private calculateSpawnVelocity(emitter: ParticleEmitter): { x: number, y: number } {\n        const { velocityRange } = emitter;\n        \n        return {\n            x: this.randomBetween(velocityRange.min.x, velocityRange.max.x),\n            y: this.randomBetween(velocityRange.min.y, velocityRange.max.y)\n        };\n    }\n\n    /**\n     * Generate particle color based on type\n     */\n    private generateParticleColor(type: ParticleType, variation: number): Color {\n        const baseColors: { [key in ParticleType]: Color } = {\n            [ParticleType.Explosion]: { r: 96, g: 48, b: 12 }, // Orange explosion\n            [ParticleType.Thrust]: { r: 32, g: 80, b: 64 }, // Cyan thrust\n            [ParticleType.Laser]: { r: 16, g: 48, b: 16 }, // Green laser\n            [ParticleType.Shield]: { r: 24, g: 60, b: 48 }, // Teal shield\n            [ParticleType.Spark]: { r: 96, g: 64, b: 16 }, // Amber sparks\n            [ParticleType.Smoke]: { r: 32, g: 32, b: 32 }, // Gray smoke\n            [ParticleType.Debris]: { r: 48, g: 48, b: 48 }, // Gray debris\n            [ParticleType.StarField]: { r: 80, g: 80, b: 80 }, // White stars\n            [ParticleType.WarpTrail]: { r: 48, g: 24, b: 72 }, // Purple warp\n            [ParticleType.Beam]: { r: 72, g: 24, b: 24 } // Red beam\n        };\n        \n        const baseColor = baseColors[type];\n        const variationAmount = variation * 30; // Max variation\n        \n        return {\n            r: Math.max(0, Math.min(255, baseColor.r + (Math.random() - 0.5) * variationAmount)),\n            g: Math.max(0, Math.min(255, baseColor.g + (Math.random() - 0.5) * variationAmount)),\n            b: Math.max(0, Math.min(255, baseColor.b + (Math.random() - 0.5) * variationAmount))\n        };\n    }\n\n    /**\n     * Get particle physics properties\n     */\n    private getParticleGravity(type: ParticleType): number {\n        const gravityValues: { [key in ParticleType]: number } = {\n            [ParticleType.Explosion]: 0,\n            [ParticleType.Thrust]: -50, // Upward thrust\n            [ParticleType.Laser]: 0,\n            [ParticleType.Shield]: 0,\n            [ParticleType.Spark]: 100, // Falls down\n            [ParticleType.Smoke]: -20, // Rises slowly\n            [ParticleType.Debris]: 200, // Falls fast\n            [ParticleType.StarField]: 0,\n            [ParticleType.WarpTrail]: 0,\n            [ParticleType.Beam]: 0\n        };\n        \n        return gravityValues[type];\n    }\n\n    private getParticleBounce(type: ParticleType): number {\n        const bounceValues: { [key in ParticleType]: number } = {\n            [ParticleType.Explosion]: 0.2,\n            [ParticleType.Thrust]: 0,\n            [ParticleType.Laser]: 0,\n            [ParticleType.Shield]: 0,\n            [ParticleType.Spark]: 0.8,\n            [ParticleType.Smoke]: 0,\n            [ParticleType.Debris]: 0.6,\n            [ParticleType.StarField]: 0,\n            [ParticleType.WarpTrail]: 0,\n            [ParticleType.Beam]: 0\n        };\n        \n        return bounceValues[type];\n    }\n\n    private getParticleFriction(type: ParticleType): number {\n        const frictionValues: { [key in ParticleType]: number } = {\n            [ParticleType.Explosion]: 0.95,\n            [ParticleType.Thrust]: 0.9,\n            [ParticleType.Laser]: 1.0,\n            [ParticleType.Shield]: 0.98,\n            [ParticleType.Spark]: 0.98,\n            [ParticleType.Smoke]: 0.92,\n            [ParticleType.Debris]: 0.95,\n            [ParticleType.StarField]: 1.0,\n            [ParticleType.WarpTrail]: 0.99,\n            [ParticleType.Beam]: 1.0\n        };\n        \n        return frictionValues[type];\n    }\n\n    /**\n     * Add type-specific animations\n     */\n    private addParticleAnimations(particle: Particle): void {\n        switch (particle.type) {\n            case ParticleType.Explosion:\n                particle.sizeAnimation = {\n                    startSize: particle.size * 0.1,\n                    endSize: particle.size * 2,\n                    curve: 'ease-out'\n                };\n                particle.alphaAnimation = {\n                    startAlpha: 1.0,\n                    endAlpha: 0.0,\n                    curve: 'ease-in'\n                };\n                break;\n                \n            case ParticleType.Thrust:\n                particle.sizeAnimation = {\n                    startSize: particle.size,\n                    endSize: particle.size * 0.1,\n                    curve: 'linear'\n                };\n                particle.alphaAnimation = {\n                    startAlpha: 0.8,\n                    endAlpha: 0.0,\n                    curve: 'linear'\n                };\n                break;\n                \n            case ParticleType.Smoke:\n                particle.sizeAnimation = {\n                    startSize: particle.size * 0.5,\n                    endSize: particle.size * 2,\n                    curve: 'ease-out'\n                };\n                particle.alphaAnimation = {\n                    startAlpha: 0.6,\n                    endAlpha: 0.0,\n                    curve: 'ease-in'\n                };\n                break;\n                \n            case ParticleType.Spark:\n                particle.alphaAnimation = {\n                    startAlpha: 1.0,\n                    endAlpha: 0.0,\n                    curve: 'ease-in'\n                };\n                break;\n        }\n    }\n\n    /**\n     * Update particles\n     */\n    private updateParticles(deltaTime: number): void {\n        this.particles.forEach((particle, particleId) => {\n            const dt = deltaTime / 1000; // Convert to seconds\n            \n            // Update age\n            particle.age += deltaTime;\n            \n            // Apply physics\n            this.updateParticlePhysics(particle, dt);\n            \n            // Update animations\n            this.updateParticleAnimations(particle);\n            \n            // Update rotation\n            particle.rotation += particle.rotationSpeed * dt;\n        });\n    }\n\n    /**\n     * Update particle physics\n     */\n    private updateParticlePhysics(particle: Particle, dt: number): void {\n        // Apply gravity\n        particle.acceleration.y += particle.gravity * dt;\n        \n        // Apply acceleration to velocity\n        particle.velocity.x += particle.acceleration.x * dt;\n        particle.velocity.y += particle.acceleration.y * dt;\n        \n        // Apply friction\n        particle.velocity.x *= particle.friction;\n        particle.velocity.y *= particle.friction;\n        \n        // Apply velocity to position\n        particle.position.x += particle.velocity.x * dt;\n        particle.position.y += particle.velocity.y * dt;\n        \n        // Reset acceleration\n        particle.acceleration.x = 0;\n        particle.acceleration.y = 0;\n    }\n\n    /**\n     * Update particle animations\n     */\n    private updateParticleAnimations(particle: Particle): void {\n        const progress = Math.min(1, particle.age / particle.maxAge);\n        \n        // Size animation\n        if (particle.sizeAnimation) {\n            const t = this.applyEasing(progress, particle.sizeAnimation.curve);\n            particle.size = this.lerp(\n                particle.sizeAnimation.startSize,\n                particle.sizeAnimation.endSize,\n                t\n            );\n        }\n        \n        // Alpha animation\n        if (particle.alphaAnimation) {\n            const t = this.applyEasing(progress, particle.alphaAnimation.curve);\n            particle.alpha = this.lerp(\n                particle.alphaAnimation.startAlpha,\n                particle.alphaAnimation.endAlpha,\n                t\n            );\n        }\n        \n        // Color animation\n        if (particle.colorAnimation) {\n            const t = this.applyEasing(progress, particle.colorAnimation.curve);\n            particle.color = {\n                r: Math.floor(this.lerp(particle.colorAnimation.startColor.r, particle.colorAnimation.endColor.r, t)),\n                g: Math.floor(this.lerp(particle.colorAnimation.startColor.g, particle.colorAnimation.endColor.g, t)),\n                b: Math.floor(this.lerp(particle.colorAnimation.startColor.b, particle.colorAnimation.endColor.b, t))\n            };\n        }\n    }\n\n    /**\n     * Apply easing curves\n     */\n    private applyEasing(t: number, curve: string): number {\n        switch (curve) {\n            case 'ease-in':\n                return t * t;\n            case 'ease-out':\n                return 1 - (1 - t) * (1 - t);\n            case 'ease-in-out':\n                return t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2;\n            default:\n                return t; // linear\n        }\n    }\n\n    /**\n     * Linear interpolation\n     */\n    private lerp(start: number, end: number, t: number): number {\n        return start + (end - start) * t;\n    }\n\n    /**\n     * Clean up expired particles\n     */\n    private cleanupParticles(): void {\n        this.particles.forEach((particle, particleId) => {\n            if (particle.age >= particle.maxAge || particle.alpha <= 0) {\n                this.particles.delete(particleId);\n                this.events.onParticleDied?.(particle);\n            }\n        });\n    }\n\n    /**\n     * Create explosion effect\n     */\n    createExplosion(position: { x: number, y: number }, intensity: number = 1.0): string {\n        const emitterId = `explosion_${this.nextEmitterId++}`;\n        \n        const emitter: ParticleEmitter = {\n            id: emitterId,\n            type: ParticleType.Explosion,\n            position: { ...position },\n            emissionRate: 0, // Burst only\n            burstCount: Math.floor(50 * intensity * this.config.qualityScale),\n            velocityRange: {\n                min: { x: -100 * intensity, y: -100 * intensity },\n                max: { x: 100 * intensity, y: 100 * intensity }\n            },\n            sizeRange: { min: 2, max: 8 * intensity },\n            lifeRange: { min: 500, max: 1500 },\n            colorVariation: 0.3,\n            active: true,\n            duration: 0.1, // Very short duration\n            startTime: Date.now(),\n            shape: 'circle',\n            shapeData: { radius: 5 * intensity }\n        };\n        \n        this.emitters.set(emitterId, emitter);\n        this.logger.debug(`💥 Created explosion at (${position.x}, ${position.y})`);\n        \n        return emitterId;\n    }\n\n    /**\n     * Create thrust effect\n     */\n    createThrustTrail(position: { x: number, y: number }, direction: number, intensity: number = 1.0): string {\n        const emitterId = `thrust_${this.nextEmitterId++}`;\n        \n        const emitter: ParticleEmitter = {\n            id: emitterId,\n            type: ParticleType.Thrust,\n            position: { ...position },\n            emissionRate: 60 * intensity * this.config.qualityScale,\n            burstCount: 0,\n            velocityRange: {\n                min: { x: Math.cos(direction) * -50 * intensity, y: Math.sin(direction) * -50 * intensity },\n                max: { x: Math.cos(direction) * -100 * intensity, y: Math.sin(direction) * -100 * intensity }\n            },\n            sizeRange: { min: 1, max: 3 * intensity },\n            lifeRange: { min: 100, max: 400 },\n            colorVariation: 0.2,\n            active: true,\n            duration: -1, // Continuous\n            startTime: Date.now(),\n            shape: 'cone',\n            shapeData: { \n                direction: direction + Math.PI, // Opposite direction\n                angle: Math.PI / 6, // 30 degrees\n                radius: 3 * intensity\n            }\n        };\n        \n        this.emitters.set(emitterId, emitter);\n        \n        return emitterId;\n    }\n\n    /**\n     * Create laser beam effect\n     */\n    createLaserBeam(start: { x: number, y: number }, end: { x: number, y: number }): string {\n        const emitterId = `laser_${this.nextEmitterId++}`;\n        \n        const distance = Math.sqrt((end.x - start.x) ** 2 + (end.y - start.y) ** 2);\n        const particleCount = Math.floor(distance / 5); // One particle every 5 pixels\n        \n        const emitter: ParticleEmitter = {\n            id: emitterId,\n            type: ParticleType.Laser,\n            position: { ...start },\n            emissionRate: 0,\n            burstCount: particleCount * this.config.qualityScale,\n            velocityRange: {\n                min: { x: 0, y: 0 },\n                max: { x: 0, y: 0 }\n            },\n            sizeRange: { min: 1, max: 2 },\n            lifeRange: { min: 100, max: 200 },\n            colorVariation: 0.1,\n            active: true,\n            duration: 0.05,\n            startTime: Date.now(),\n            shape: 'rectangle',\n            shapeData: { \n                width: distance,\n                height: 2\n            }\n        };\n        \n        this.emitters.set(emitterId, emitter);\n        \n        return emitterId;\n    }\n\n    /**\n     * Update emitter position (for continuous effects)\n     */\n    updateEmitterPosition(emitterId: string, position: { x: number, y: number }): void {\n        const emitter = this.emitters.get(emitterId);\n        if (emitter) {\n            emitter.position = { ...position };\n        }\n    }\n\n    /**\n     * Stop emitter\n     */\n    stopEmitter(emitterId: string): void {\n        const emitter = this.emitters.get(emitterId);\n        if (emitter) {\n            emitter.active = false;\n        }\n    }\n\n    /**\n     * Remove emitter\n     */\n    removeEmitter(emitterId: string): void {\n        this.emitters.delete(emitterId);\n    }\n\n    /**\n     * Render particles\n     */\n    render(renderer: Renderer): void {\n        // Sort particles by type for optimal rendering\n        const sortedParticles = Array.from(this.particles.values()).sort((a, b) => {\n            return a.type.localeCompare(b.type);\n        });\n        \n        sortedParticles.forEach(particle => {\n            this.renderParticle(renderer, particle);\n        });\n    }\n\n    /**\n     * Render individual particle\n     */\n    private renderParticle(renderer: Renderer, particle: Particle): void {\n        if (particle.alpha <= 0) return;\n        \n        const color = {\n            ...particle.color,\n            // Apply alpha if renderer supports it\n        };\n        \n        if (this.config.pixelPerfect) {\n            // Pixel-perfect rendering for retro style\n            const x = Math.floor(particle.position.x);\n            const y = Math.floor(particle.position.y);\n            const size = Math.max(1, Math.floor(particle.size));\n            \n            renderer.fillRect(x - size/2, y - size/2, size, size, color);\n        } else {\n            // Smooth rendering\n            renderer.drawCircle(\n                particle.position.x,\n                particle.position.y,\n                particle.size,\n                color,\n                true\n            );\n        }\n    }\n\n    /**\n     * Utility: Random between values\n     */\n    private randomBetween(min: number, max: number): number {\n        return min + Math.random() * (max - min);\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(newConfig: Partial<ParticleSystemConfig>): void {\n        Object.assign(this.config, newConfig);\n        this.logger.info('✨ Particle system config updated', newConfig);\n    }\n\n    /**\n     * Get particle system statistics\n     */\n    getStats(): {\n        activeParticles: number;\n        activeEmitters: number;\n        maxParticles: number;\n        qualityScale: number;\n    } {\n        return {\n            activeParticles: this.particles.size,\n            activeEmitters: Array.from(this.emitters.values()).filter(e => e.active).length,\n            maxParticles: this.config.maxParticles,\n            qualityScale: this.config.qualityScale\n        };\n    }\n\n    /**\n     * Clear all particles and emitters\n     */\n    clear(): void {\n        this.particles.clear();\n        this.emitters.clear();\n        this.logger.info('✨ Particle system cleared');\n    }\n\n    /**\n     * Dispose particle system\n     */\n    dispose(): void {\n        this.clear();\n        this.logger.info('✨ Particle system disposed');\n    }\n}","/**\n * Main Game Class - Core Engine Controller\n * Orchestrates all game systems and manages the game lifecycle\n */\n\nimport { Renderer } from '@core/Renderer';\nimport { InputManager } from '@core/InputManager';\nimport { SpacePhysics } from '@core/Physics';\nimport { AudioEngine } from '@core/AudioEngine';\nimport { GameStateManager, GameState } from '@core/GameStateManager';\nimport { Platform, PlatformDetector } from '@utils/Platform';\nimport { Logger } from '@utils/Logger';\nimport { PlayerShip } from '@entities/PlayerShip';\nimport { GalaxyManager } from '@procedural/GalaxyManager';\nimport { CockpitStatusBar } from '@ui/CockpitStatusBar';\nimport { ShipSection, SystemType } from '@entities/ShipSystems';\nimport { CelestialManager } from '@managers/CelestialManager';\nimport { SpaceBackground } from '@rendering/SpaceBackground';\nimport { ItemDatabase } from '@items/ItemSystem';\nimport { InventoryManager } from '@inventory/InventoryManager';\nimport { CraftingSystem } from '@crafting/CraftingSystem';\nimport { CombatManager } from '@combat/CombatManager';\nimport { PlayerProgression } from '@rpg/PlayerProgression';\nimport { ResearchSystem } from '@rpg/ResearchSystem';\nimport { CrewManagement } from '@rpg/CrewManagement';\nimport { DiplomacySystem } from '@diplomacy/DiplomacySystem';\nimport { AlienAI, AlienSpecies } from '@ai/AlienAI';\nimport { ProceduralAudio, SoundType } from '@audio/ProceduralAudio';\nimport { PerformanceMonitor } from '@optimization/PerformanceMonitor';\nimport { ParticleSystem } from '@effects/ParticleSystem';\n\nexport interface GameConfig {\n    targetFPS: number;\n    enableDebug: boolean;\n    enablePerformanceMonitoring: boolean;\n    enableAutoSave: boolean;\n    autoSaveInterval: number;\n}\n\nexport class Game {\n    private canvas: HTMLCanvasElement;\n    private platform: Platform;\n    private config: GameConfig;\n    \n    // Core systems\n    private renderer!: Renderer;\n    private input!: InputManager;\n    private physics!: SpacePhysics;\n    private audio!: AudioEngine;\n    private stateManager!: GameStateManager;\n    \n    // Game entities\n    private playerShip: PlayerShip | null = null;\n    \n    // Galaxy system\n    private galaxyManager: GalaxyManager | null = null;\n    \n    // UI systems\n    private cockpitStatusBar: CockpitStatusBar | null = null;\n    \n    // Celestial systems\n    private celestialManager: CelestialManager | null = null;\n    \n    // Background rendering\n    private spaceBackground: SpaceBackground | null = null;\n    \n    // Item and inventory systems\n    private itemDatabase: ItemDatabase | null = null;\n    private inventoryManager: InventoryManager | null = null;\n    private craftingSystem: CraftingSystem | null = null;\n    \n    // Combat system\n    private combatManager: CombatManager | null = null;\n    \n    // RPG systems\n    private playerProgression: PlayerProgression | null = null;\n    private researchSystem: ResearchSystem | null = null;\n    private crewManagement: CrewManagement | null = null;\n    \n    // AI & Diplomacy systems\n    private diplomacySystem: DiplomacySystem | null = null;\n    private alienAI: AlienAI | null = null;\n    \n    // Polish systems\n    private proceduralAudio: ProceduralAudio | null = null;\n    private performanceMonitor: PerformanceMonitor | null = null;\n    private particleSystem: ParticleSystem | null = null;\n    \n    // Game loop\n    private isRunning = false;\n    private isPaused = false;\n    private lastTime = 0;\n    private deltaTime = 0;\n    private frameCount = 0;\n    private fpsCounter = 0;\n    private lastFpsUpdate = 0;\n    \n    // Performance monitoring\n    private performanceStats = {\n        averageFPS: 0,\n        frameTime: 0,\n        renderTime: 0,\n        updateTime: 0,\n        memoryUsage: 0\n    };\n    \n    private logger: Logger;\n    private perfLogger: ReturnType<Logger['createPerformanceLogger']>;\n\n    constructor(canvas: HTMLCanvasElement, platform: Platform) {\n        this.canvas = canvas;\n        this.platform = platform;\n        this.logger = new Logger('Game');\n        this.perfLogger = this.logger.createPerformanceLogger();\n        \n        // Get platform-specific configuration\n        const platformConfig = PlatformDetector.getConfig();\n        this.config = {\n            targetFPS: platformConfig.performance.targetFPS,\n            enableDebug: import.meta.env.DEV,\n            enablePerformanceMonitoring: import.meta.env.DEV,\n            enableAutoSave: platformConfig.storage.enableAutoSave,\n            autoSaveInterval: platformConfig.storage.saveInterval\n        };\n\n        this.logger.info('🎮 Game instance created', {\n            platform: platform,\n            canvasSize: `${canvas.width}x${canvas.height}`,\n            config: this.config\n        });\n\n        // Initialize core systems\n        this.initializeSystems();\n    }\n\n    /**\n     * Initialize all game systems\n     */\n    private initializeSystems(): void {\n        this.logger.info('🔧 Initializing game systems...');\n        \n        try {\n            // Initialize renderer first\n            this.renderer = new Renderer(this.canvas, this.platform);\n            this.logger.info('✅ Renderer initialized');\n            \n            // Initialize input system\n            this.input = new InputManager(this.canvas, this.platform);\n            this.logger.info('✅ Input system initialized');\n            \n            // Initialize physics engine\n            this.physics = new SpacePhysics();\n            this.logger.info('✅ Physics engine initialized');\n            \n            // Initialize audio engine\n            this.audio = new AudioEngine(this.platform);\n            this.logger.info('✅ Audio engine initialized');\n            \n            // Initialize game state manager with audio and particles\n            this.stateManager = new GameStateManager(this.proceduralAudio || undefined, this.particleSystem || undefined);\n            this.logger.info('✅ Game state manager initialized');\n            \n            this.logger.info('🎯 All core systems initialized successfully');\n            \n        } catch (error) {\n            this.logger.critical('❌ Failed to initialize core systems', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Initialize the game (async setup)\n     */\n    async initialize(): Promise<void> {\n        this.logger.info('🚀 Starting game initialization...');\n        \n        try {\n            // Initialize renderer context and shaders\n            await this.perfLogger.measureAsync('renderer-init', async () => {\n                await this.renderer.initialize();\n            });\n            \n            // Initialize audio context\n            await this.perfLogger.measureAsync('audio-init', async () => {\n                await this.audio.initialize();\n            });\n            \n            // Load initial game state\n            await this.perfLogger.measureAsync('state-init', async () => {\n                await this.stateManager.initialize();\n            });\n            \n            // Setup auto-save if enabled\n            if (this.config.enableAutoSave) {\n                this.setupAutoSave();\n            }\n            \n            // Initialize galaxy manager\n            await this.perfLogger.measureAsync('galaxy-init', async () => {\n                this.galaxyManager = new GalaxyManager();\n                await this.galaxyManager.initialize();\n            });\n            \n            // Initialize cockpit UI\n            this.cockpitStatusBar = new CockpitStatusBar({\n                screenWidth: this.canvas.width,\n                screenHeight: this.canvas.height\n            }, {\n                onPowerAllocationChange: (allocation) => {\n                    if (this.playerShip) {\n                        this.playerShip.setPowerAllocation(allocation);\n                        this.logger.debug('Power allocation changed', allocation);\n                    }\n                },\n                onSystemToggle: (system, state) => {\n                    if (this.playerShip) {\n                        this.playerShip.toggleSystem(system as any, state);\n                        this.logger.debug(`System ${system} ${state ? 'enabled' : 'disabled'}`);\n                    }\n                },\n                onInventoryOpen: () => {\n                    this.logger.info('📦 Inventory requested');\n                    // TODO: Open inventory screen\n                },\n                onCodexOpen: () => {\n                    this.logger.info('📚 Codex requested');\n                    // TODO: Open codex screen\n                },\n                onResearchOpen: () => {\n                    this.logger.info('🔬 Research requested');\n                    // TODO: Open research screen\n                },\n                onCrewOpen: () => {\n                    this.logger.info('👥 Crew management requested');\n                    // TODO: Open crew screen\n                },\n                onGalaxyMapOpen: () => {\n                    this.logger.info('🌌 Galaxy map requested');\n                    // TODO: Open galaxy map\n                },\n                onRadarZoom: (zoomLevel) => {\n                    this.logger.debug(`Radar zoom: ${zoomLevel}x`);\n                    // TODO: Update radar zoom\n                }\n            });\n            \n            // Initialize celestial manager\n            this.celestialManager = new CelestialManager({\n                renderDistance: 2000,\n                interactionDistance: 150,\n                showOrbitLines: true,\n                enableInteractions: true\n            }, {\n                onEnterOrbit: (bodyId) => {\n                    this.logger.info(`🛰️ Entering orbit around ${bodyId}`);\n                    // TODO: Handle orbit mechanics\n                },\n                onLand: (bodyId) => {\n                    this.logger.info(`🚁 Landing on ${bodyId}`);\n                    // TODO: Handle landing mechanics\n                },\n                onContinueFlight: () => {\n                    this.logger.info('🚀 Continuing flight');\n                },\n                onStartMining: (bodyId) => {\n                    this.logger.info(`⛏️ Mining on ${bodyId}`);\n                    // TODO: Add resources to inventory\n                },\n                onPerformScan: (bodyId) => {\n                    this.logger.info(`🔍 Scanned ${bodyId}`);\n                    // TODO: Add scan data to codex\n                }\n            });\n            \n            // Initialize space background\n            this.spaceBackground = new SpaceBackground({\n                starCount: 300,\n                starLayers: 5,\n                parallaxStrength: 0.3,\n                enableDistortion: true,\n                galaxyBandIntensity: 0.4,\n                nebulaOpacity: 0.2\n            });\n            \n            // Initialize item systems\n            this.itemDatabase = new ItemDatabase();\n            \n            this.inventoryManager = new InventoryManager({\n                maxSlots: 50,\n                gridWidth: 10,\n                gridHeight: 5,\n                maxWeight: 1000,\n                maxVolume: 500,\n                allowStacking: true\n            }, {\n                onItemAdded: (item, quantity) => {\n                    this.logger.info(`📦 Added ${quantity}x ${item.name} to inventory`);\n                },\n                onItemRemoved: (item, quantity) => {\n                    this.logger.info(`📦 Removed ${quantity}x ${item.name} from inventory`);\n                },\n                onInventoryFull: () => {\n                    this.logger.warn('📦 Inventory is full!');\n                }\n            }, this.itemDatabase);\n            \n            this.craftingSystem = new CraftingSystem(\n                this.itemDatabase,\n                this.inventoryManager,\n                {\n                    onCraftingStarted: (attempt) => {\n                        this.logger.info(`🔧 Started crafting: ${attempt.recipeId}`);\n                    },\n                    onCraftingCompleted: (item, success) => {\n                        if (success) {\n                            this.logger.info(`✅ Successfully crafted ${item.name}`);\n                        } else {\n                            this.logger.warn(`❌ Failed to craft ${item.name}`);\n                        }\n                    }\n                }\n            );\n            \n            // Initialize combat system (will be initialized after RPG systems)\n            this.combatManager = null;\n            \n            // Initialize RPG systems\n            this.playerProgression = new PlayerProgression({\n                onLevelUp: (level, rewards) => {\n                    this.logger.info(`🎉 Level up! Level ${level}`, rewards);\n                },\n                onSkillLevelUp: (skill, level) => {\n                    this.logger.info(`📈 Skill up: ${skill.name} → ${level}`);\n                },\n                onAchievementUnlocked: (achievement) => {\n                    this.logger.info(`🏆 Achievement: ${achievement.name}`);\n                }\n            });\n            \n            this.researchSystem = new ResearchSystem({\n                onTechnologyUnlocked: (tech) => {\n                    this.logger.info(`🔬 Technology unlocked: ${tech.name}`);\n                },\n                onDiscoveryMade: (discovery) => {\n                    this.logger.info(`🔍 Discovery: ${discovery.name}`);\n                }\n            });\n            \n            this.crewManagement = new CrewManagement({\n                onCrewJoined: (crew) => {\n                    this.logger.info(`👤 Crew joined: ${crew.name} (${crew.role})`);\n                },\n                onCrewEvent: (event) => {\n                    this.logger.info(`📰 Crew event: ${event.description}`);\n                },\n                onMoraleAlert: (morale) => {\n                    this.logger.warn(`😟 Low crew morale: ${morale.toFixed(0)}%`);\n                }\n            });\n            \n            // Initialize diplomacy and alien AI systems\n            this.diplomacySystem = new DiplomacySystem({\n                onFirstContact: (faction) => {\n                    this.logger.info(`🤝 First contact with: ${faction.name}`);\n                },\n                onReputationChanged: (factionId, oldRep, newRep) => {\n                    const change = newRep - oldRep;\n                    this.logger.info(`🤝 Reputation ${change > 0 ? '+' : ''}${change}: ${factionId}`);\n                },\n                onNegotiationStarted: (session) => {\n                    this.logger.info(`💬 Negotiation started with faction`);\n                },\n                onEncounterGenerated: (encounter) => {\n                    this.logger.info(`🎭 Diplomatic encounter: ${encounter.type}`);\n                }\n            });\n            \n            this.alienAI = new AlienAI({\n                onFirstContact: (species, encounter) => {\n                    this.logger.info(`👽 First contact with: ${species}`);\n                },\n                onCommunicationBreakthrough: (species, method) => {\n                    this.logger.info(`📡 Communication breakthrough: ${species} via ${method}`);\n                },\n                onTechnologyDiscovered: (species, technology) => {\n                    this.logger.info(`🔬 Technology discovered from ${species}: ${technology}`);\n                },\n                onCulturalInsight: (species, insight) => {\n                    this.logger.info(`🎭 Cultural insight about ${species}: ${insight}`);\n                }\n            });\n            \n            // Initialize polish systems\n            this.proceduralAudio = new ProceduralAudio({\n                onSoundPlayed: (type, config) => {\n                    this.logger.debug(`🔊 Sound played: ${type}`);\n                },\n                onTrackChanged: (trackName) => {\n                    this.logger.info(`🎵 Music track changed: ${trackName}`);\n                },\n                onAudioError: (error) => {\n                    this.logger.error('🔊 Audio error', error);\n                }\n            });\n            \n            this.performanceMonitor = new PerformanceMonitor({\n                onPerformanceUpdate: (metrics) => {\n                    // Update game metrics for audio system\n                    // TODO: Add setGameMetrics method to ProceduralAudio if needed\n                    // this.proceduralAudio?.setGameMetrics?.({\n                    //     activeSounds: metrics.activeSounds\n                    // });\n                },\n                onThresholdExceeded: (metric, value, threshold) => {\n                    this.logger.warn(`⚠️ Performance threshold exceeded: ${metric} = ${value} (threshold: ${threshold})`);\n                },\n                onOptimizationRecommended: (recommendations) => {\n                    this.logger.info(`🔧 Performance recommendations: ${recommendations.length} suggestions`);\n                },\n                onSettingsChanged: (settings) => {\n                    this.logger.info('⚙️ Performance settings updated');\n                }\n            });\n            \n            // Initialize audio system\n            await this.proceduralAudio.initialize();\n            \n            // Initialize particle system\n            this.particleSystem = new ParticleSystem({\n                maxParticles: 1000,\n                qualityScale: 1.0,\n                enableTrails: true,\n                pixelPerfect: true\n            });\n            \n            // Initialize performance monitoring\n            this.performanceMonitor.initialize();\n            \n            // Start ambient space music\n            this.proceduralAudio.startAmbientTrack('deep_space');\n            \n            // Initialize combat system with RPG integration\n            this.combatManager = new CombatManager(\n                this.itemDatabase,\n                this.inventoryManager,\n                {\n                    onEncounterStarted: (encounter) => {\n                        this.logger.info(`🚨 Combat encounter: ${encounter.name}`);\n                    },\n                    onEncounterCompleted: (encounter, success) => {\n                        this.logger.info(`${success ? '✅' : '❌'} Encounter ${encounter.name} ${success ? 'completed' : 'failed'}`);\n                        // Award experience for completed encounters\n                        if (success && this.playerProgression) {\n                            this.playerProgression.addExperience(encounter.rewards.experience);\n                            this.playerProgression.updateStatistics({ enemiesDefeated: 1 });\n                        }\n                    },\n                    onEnemyDestroyed: (enemyId, rewards) => {\n                        this.logger.info(`💰 Enemy destroyed: +${rewards.experience} XP, ${rewards.items.length} items`);\n                        // Award experience and update stats\n                        if (this.playerProgression) {\n                            this.playerProgression.addExperience(rewards.experience);\n                            this.playerProgression.updateStatistics({ enemiesDefeated: 1 });\n                            // Award skill experience based on combat\n                            this.playerProgression.addSkillExperience('weapon_proficiency', 10);\n                            this.playerProgression.addSkillExperience('tactical_combat', 5);\n                        }\n                    },\n                    onPlayerDamaged: (damage, damageType) => {\n                        this.logger.warn(`💥 Player hit: ${damage} ${damageType} damage`);\n                    }\n                }\n            );\n            \n            // Setup demo content\n            this.setupDemoContent();\n            \n            this.logger.info('✅ Game initialization completed successfully');\n            \n        } catch (error) {\n            this.logger.critical('❌ Game initialization failed', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Start the game loop\n     */\n    async start(): Promise<void> {\n        if (this.isRunning) {\n            this.logger.warn('Game is already running');\n            return;\n        }\n        \n        this.logger.info('🎮 Starting game...');\n        \n        try {\n            // Transition to main menu state instead of playing directly\n            await this.stateManager.setState(GameState.MainMenu);\n            \n            // Start the game loop\n            this.isRunning = true;\n            this.isPaused = false;\n            this.lastTime = performance.now();\n            \n            // Start the main loop\n            this.gameLoop();\n            \n            this.logger.info('✅ Game started successfully');\n            \n        } catch (error) {\n            this.logger.critical('❌ Failed to start game', error);\n            this.isRunning = false;\n            throw error;\n        }\n    }\n\n    /**\n     * Main game loop\n     */\n    private gameLoop(): void {\n        if (!this.isRunning) {\n            return;\n        }\n\n        const currentTime = performance.now();\n        this.deltaTime = (currentTime - this.lastTime) / 1000; // Convert to seconds\n        this.lastTime = currentTime;\n\n        // Cap delta time to prevent large jumps\n        this.deltaTime = Math.min(this.deltaTime, 1/15); // Max 15 FPS minimum\n\n        if (!this.isPaused) {\n            try {\n                // Update performance stats\n                if (this.config.enablePerformanceMonitoring) {\n                    this.updatePerformanceStats(currentTime);\n                }\n\n                // Update game systems\n                this.perfLogger.measure('update', () => {\n                    this.update(this.deltaTime);\n                });\n\n                // Render frame\n                this.perfLogger.measure('render', () => {\n                    this.render();\n                });\n\n                this.frameCount++;\n\n            } catch (error) {\n                this.logger.error('Game loop error', error);\n                this.handleError(error);\n            }\n        }\n\n        // Schedule next frame\n        requestAnimationFrame(() => this.gameLoop());\n    }\n\n    /**\n     * Update all game systems\n     */\n    private update(deltaTime: number): void {\n        // Update input state\n        this.input.update(deltaTime);\n        \n        // Update game state\n        this.stateManager.update(deltaTime, this.input);\n        \n        // Update physics simulation\n        this.physics.update(deltaTime);\n        \n        // Update audio\n        this.audio.update(deltaTime);\n        \n        // Update game entities\n        if (this.playerShip && this.stateManager.isGameActive()) {\n            this.playerShip.update(deltaTime);\n            \n            // Handle weapon firing\n            this.playerShip.fireWeapon();\n            \n            // Demo damage testing (press 'T' to test damage)\n            if (this.input.isKeyPressed('KeyT')) {\n                this.playerShip.applyDamage(15, Math.random() > 0.5 ? \n                    ShipSection.Engineering : ShipSection.Weapons\n                );\n                this.logger.info('🧪 Demo damage applied');\n            }\n            \n            // Demo system toggle (press 'Y' to toggle engines)\n            if (this.input.isKeyPressed('KeyY')) {\n                const currentStatus = this.playerShip.getSystemStatus();\n                this.playerShip.toggleSystem(SystemType.Engines, !currentStatus.enginesOnline);\n                this.logger.info(`🧪 Engines ${!currentStatus.enginesOnline ? 'enabled' : 'disabled'}`);\n            }\n            \n            // Demo celestial interactions (press 'P' to perform action on nearby body)\n            if (this.input.isKeyPressed('KeyP') && this.celestialManager) {\n                const nearbyBodies = this.celestialManager.getNearbyBodies();\n                if (nearbyBodies.length > 0) {\n                    const body = nearbyBodies[0];\n                    this.celestialManager.performAction(body.id, 'scan', this.playerShip.getPosition());\n                    this.logger.info(`🔍 Demo scan of ${body.name}`);\n                }\n            }\n            \n            // Demo warp drive (press 'W' for warp toggle - already handled in PlayerShip)\n            // Just log current warp state for debugging\n            if (this.input.isKeyPressed('KeyW')) {\n                const warpState = this.playerShip.getWarpState();\n                this.logger.info(`🌌 Warp state: ${warpState}`);\n            }\n            \n            // Demo inventory system (press 'I' to toggle inventory)\n            if (this.input.isKeyPressed('KeyI') && this.inventoryManager) {\n                const isVisible = this.inventoryManager.isInventoryVisible();\n                this.inventoryManager.setVisible(!isVisible);\n                this.logger.info(`📦 Inventory ${!isVisible ? 'opened' : 'closed'}`);\n            }\n            \n            // Demo crafting system (press 'C' to toggle crafting)\n            if (this.input.isKeyPressed('KeyC') && this.craftingSystem) {\n                const isVisible = this.craftingSystem.isCraftingVisible();\n                this.craftingSystem.setVisible(!isVisible);\n                if (!isVisible) {\n                    this.craftingSystem.selectStation('basic_fabricator');\n                }\n                this.logger.info(`🔧 Crafting ${!isVisible ? 'opened' : 'closed'}`);\n            }\n            \n            // Demo item generation (press 'R' to add random items)\n            if (this.input.isKeyPressed('KeyR') && this.inventoryManager && this.itemDatabase) {\n                const randomItem = this.itemDatabase.generateRandomItem();\n                if (randomItem) {\n                    const quantity = Math.floor(Math.random() * 5) + 1;\n                    const added = this.inventoryManager.addItem(randomItem, quantity);\n                    if (added) {\n                        this.logger.info(`🎲 Added ${quantity}x ${randomItem.name} (${randomItem.rarity})`);\n                    }\n                }\n            }\n            \n            // Demo auto-crafting (press 'X' to start crafting if possible)\n            if (this.input.isKeyPressed('KeyX') && this.craftingSystem) {\n                // Try to craft an energy cell (simple recipe)\n                const success = this.craftingSystem.startCrafting('craft_energy_cell', 'basic_fabricator');\n                if (success) {\n                    this.logger.info('🔧 Started crafting Energy Cell');\n                } else {\n                    this.logger.warn('🔧 Cannot start crafting - check materials');\n                }\n            }\n            \n            // Demo combat controls\n            if (this.combatManager) {\n                // Fire primary weapon (left mouse or space)\n                if (this.input.isKeyPressed('Space')) {\n                    const fired = this.combatManager.firePlayerWeapon('player_laser_1');\n                    if (fired) {\n                        this.logger.debug('🔫 Fired laser cannon');\n                    }\n                }\n                \n                // Fire secondary weapon (right mouse or shift)\n                if (this.input.isKeyPressed('ShiftLeft')) {\n                    const fired = this.combatManager.firePlayerWeapon('player_cannon_1');\n                    if (fired) {\n                        this.logger.debug('🔫 Fired mass driver');\n                    }\n                }\n                \n                // Spawn random enemy (press 'E' for demo)\n                if (this.input.isKeyPressed('KeyE')) {\n                    this.combatManager.startRandomEncounter();\n                    this.logger.info('🛸 Spawned random encounter');\n                }\n                \n                // Clear all enemies (press 'Q' for demo)\n                if (this.input.isKeyPressed('KeyQ')) {\n                    this.combatManager.clearCombat();\n                    this.logger.info('🧹 Cleared all combat');\n                }\n            }\n            \n            // Demo AI & Diplomacy controls\n            if (this.diplomacySystem) {\n                // Generate random diplomatic encounter (press 'K' for demo)\n                if (this.input.isKeyPressed('KeyK')) {\n                    const playerPos = this.playerShip?.getPosition() || { x: 0, y: 0 };\n                    const encounter = this.diplomacySystem.generateRandomEncounter(playerPos);\n                    if (encounter) {\n                        this.logger.info(`🎭 Generated diplomatic encounter with ${encounter.factionId}`);\n                    }\n                }\n                \n                // Modify faction reputation (press 'L' for demo)\n                if (this.input.isKeyPressed('KeyL')) {\n                    const factions = this.diplomacySystem.getAllFactions();\n                    if (factions.length > 0) {\n                        const randomFaction = factions[Math.floor(Math.random() * factions.length)];\n                        const change = Math.floor(Math.random() * 21) - 10; // -10 to +10\n                        this.diplomacySystem.modifyReputation(randomFaction.id, change, 'Random diplomatic action');\n                    }\n                }\n            }\n            \n            if (this.alienAI) {\n                // Generate alien encounter (press 'M' for demo)\n                if (this.input.isKeyPressed('KeyM')) {\n                    const playerPos = this.playerShip?.getPosition() || { x: 0, y: 0 };\n                    const species = Object.values(AlienSpecies)[Math.floor(Math.random() * Object.values(AlienSpecies).length)];\n                    const encounter = this.alienAI.generateEncounter(species, playerPos, 'routine');\n                    this.logger.info(`👽 Generated alien encounter: ${species}`);\n                }\n                \n                // Simulate alien communication (press 'N' for demo)\n                if (this.input.isKeyPressed('KeyN')) {\n                    const encounters = this.alienAI.getActiveEncounters();\n                    if (encounters.length > 0) {\n                        const encounter = encounters[0];\n                        const response = this.alienAI.processPlayerAction(\n                            encounter.id,\n                            'communicate',\n                            50,\n                            'peaceful_greeting'\n                        );\n                        this.logger.info(`📡 Alien response: ${response.type} - ${response.description}`);\n                    }\n                }\n            }\n            \n            // Demo Audio & Polish controls\n            if (this.proceduralAudio) {\n                // Play laser sound (press 'O' for demo)\n                if (this.input.isKeyPressed('KeyO')) {\n                    this.proceduralAudio.playRetroSound(SoundType.Laser, 1.0);\n                }\n                \n                // Play explosion sound (press 'P' for demo)\n                if (this.input.isKeyPressed('KeyP')) {\n                    this.proceduralAudio.playRetroSound(SoundType.Explosion, 1.0);\n                }\n                \n                // Cycle ambient tracks (press 'U' for demo)\n                if (this.input.isKeyPressed('KeyU')) {\n                    const tracks = ['deep_space', 'nebula_drift', 'void_silence'];\n                    const currentTrack = this.proceduralAudio.getAudioStats().currentTrack;\n                    const currentIndex = tracks.indexOf(currentTrack || 'deep_space');\n                    const nextTrack = tracks[(currentIndex + 1) % tracks.length];\n                    this.proceduralAudio.startAmbientTrack(nextTrack);\n                }\n            }\n            \n            if (this.performanceMonitor) {\n                // Toggle auto-optimization (press 'Y' for demo)\n                if (this.input.isKeyPressed('KeyY')) {\n                    const settings = this.performanceMonitor.getSettings();\n                    this.performanceMonitor.updateSettings({\n                        autoOptimize: !settings.autoOptimize\n                    });\n                    this.logger.info(`🔧 Auto-optimization: ${!settings.autoOptimize ? 'ON' : 'OFF'}`);\n                }\n                \n                // Get performance summary (press 'T' for demo)\n                if (this.input.isKeyPressed('KeyT')) {\n                    const summary = this.performanceMonitor.getPerformanceSummary();\n                    this.logger.info(`📊 Performance: ${summary.performanceGrade} (${Math.round(summary.averageFPS)} FPS, ${Math.round(summary.averageMemoryUsage)}% memory)`);\n                }\n            }\n            \n            // Demo RPG system controls\n            if (this.playerProgression) {\n                // Add experience (press 'F' for demo)\n                if (this.input.isKeyPressed('KeyF')) {\n                    this.playerProgression.addExperience(100);\n                    this.logger.info('📈 Added 100 XP');\n                }\n                \n                // Add skill experience (press 'G' for demo)\n                if (this.input.isKeyPressed('KeyG')) {\n                    this.playerProgression.addSkillExperience('weapon_proficiency', 25);\n                    this.logger.info('🔧 Added weapon proficiency XP');\n                }\n            }\n            \n            if (this.researchSystem) {\n                // Start basic research (press 'H' for demo)\n                if (this.input.isKeyPressed('KeyH')) {\n                    const started = this.researchSystem.startResearch('basic_sensors', 'basic_lab', ['dr_smith']);\n                    if (started) {\n                        this.logger.info('🔬 Started basic sensors research');\n                    } else {\n                        this.logger.warn('🔬 Cannot start research');\n                    }\n                }\n            }\n            \n            if (this.crewManagement) {\n                // Auto-assign crew (press 'J' for demo)\n                if (this.input.isKeyPressed('KeyJ')) {\n                    const crew = this.crewManagement.getAllCrew();\n                    if (crew.length > 0) {\n                        const randomCrew = crew[Math.floor(Math.random() * crew.length)];\n                        const stations = this.crewManagement.getAllStations();\n                        const availableStation = stations.find(s => s.assignedCrew.length < s.maxCrew);\n                        \n                        if (availableStation) {\n                            const assigned = this.crewManagement.assignCrewToStation(randomCrew.id, availableStation.stationId);\n                            if (assigned) {\n                                this.logger.info(`👥 Assigned ${randomCrew.name} to ${availableStation.stationId}`);\n                            }\n                        }\n                    }\n                }\n            }\n            \n            // Handle pause input\n            if (this.input.isPausePressed()) {\n                if (this.stateManager.canPause()) {\n                    this.stateManager.setState(GameState.Paused);\n                } else if (this.stateManager.canResume()) {\n                    this.stateManager.setState(GameState.Playing);\n                }\n            }\n        }\n        \n        // Update cockpit UI\n        if (this.cockpitStatusBar) {\n            this.cockpitStatusBar.update(deltaTime, this.input);\n            \n            // Update UI with current ship status\n            if (this.playerShip) {\n                this.cockpitStatusBar.updateSystemStatus(this.playerShip.getSystemStatus());\n                this.cockpitStatusBar.updateDamageReports(this.playerShip.getShipSystems().getDamageReports());\n            }\n        }\n        \n        // Update celestial bodies\n        if (this.celestialManager && this.playerShip) {\n            this.celestialManager.update(deltaTime, this.input, this.playerShip.getPosition());\n        }\n        \n        // Update space background\n        if (this.spaceBackground) {\n            this.spaceBackground.update(deltaTime);\n            \n            // Handle warp distortion effects\n            if (this.playerShip && this.playerShip.isWarpActive()) {\n                const warpDistortion = this.playerShip.getWarpDrive().getSpaceDistortion();\n                this.spaceBackground.updateWarpDistortion(warpDistortion);\n            } else if (this.playerShip && this.playerShip.getWarpState() === 'deactivating') {\n                // Gradually restore background during warp deactivation\n                const progress = this.playerShip.getWarpDrive().getWarpProgress();\n                this.spaceBackground.gradualRestore(progress);\n            }\n        }\n        \n        // Update inventory and crafting systems\n        if (this.craftingSystem) {\n            this.craftingSystem.update(deltaTime);\n        }\n        \n        // Update combat system\n        if (this.combatManager && this.playerShip) {\n            const shipSystems = this.playerShip.getSystemStatus();\n            this.combatManager.updatePlayer(\n                this.playerShip.getPosition(),\n                this.playerShip.getVelocity(),\n                20, // Player ship size\n                shipSystems.hull,\n                100 // Max hull\n            );\n            this.combatManager.update(deltaTime);\n        }\n        \n        // Update RPG systems\n        if (this.researchSystem) {\n            this.researchSystem.update(deltaTime);\n        }\n        \n        if (this.crewManagement) {\n            this.crewManagement.update(deltaTime);\n        }\n        \n        // Update polish systems\n        this.performanceMonitor?.update(deltaTime);\n        this.particleSystem?.update(deltaTime);\n        \n        // Update performance metrics for monitoring\n        if (this.performanceMonitor) {\n            const audioStats = this.proceduralAudio?.getAudioStats();\n            this.performanceMonitor.setGameMetrics({\n                activeEntities: (this.celestialManager?.getActiveBodies()?.length || 0) + 1, // +1 for player\n                activeSounds: audioStats?.activeSounds || 0,\n                drawCalls: 1, // Simplified for now\n                triangles: 100, // Simplified for now\n                textureMemory: 10 // Simplified for now\n            });\n        }\n    }\n\n    /**\n     * Render the current frame\n     */\n    private render(): void {\n        // Clear canvas and setup rendering\n        this.renderer.beginFrame();\n        \n        // Render space background first\n        if (this.spaceBackground && this.playerShip && this.stateManager.isGameActive()) {\n            this.spaceBackground.render(this.renderer, this.playerShip.getPosition());\n        }\n        \n        // Render current game state\n        this.stateManager.render(this.renderer);\n        \n        // Render game entities\n        if (this.playerShip && this.stateManager.isGameActive()) {\n            // Render thrust particles\n            this.playerShip.renderThrustParticles(this.renderer);\n            \n            // Render warp effects (on top of ship)\n            this.playerShip.renderWarpEffects(this.renderer);\n        }\n        \n        // Render celestial bodies\n        if (this.celestialManager && this.playerShip && this.stateManager.isGameActive()) {\n            this.celestialManager.render(this.renderer, this.playerShip.getPosition());\n        }\n        \n        // Render cockpit status bar\n        if (this.cockpitStatusBar) {\n            this.cockpitStatusBar.render(this.renderer);\n        }\n        \n        // Render inventory and crafting UIs\n        if (this.inventoryManager && this.inventoryManager.isInventoryVisible()) {\n            this.inventoryManager.render(this.renderer);\n        }\n        \n        if (this.craftingSystem && this.craftingSystem.isCraftingVisible()) {\n            this.craftingSystem.render(this.renderer);\n        }\n        \n        // Render combat effects\n        if (this.combatManager) {\n            this.combatManager.render(this.renderer);\n        }\n        \n        // Render debug information if enabled\n        if (this.config.enableDebug) {\n            this.renderDebugInfo();\n        }\n        \n        // Render particles on top of everything\n        if (this.particleSystem) {\n            this.particleSystem.render(this.renderer);\n        }\n        \n        // Finalize frame\n        this.renderer.endFrame();\n    }\n\n    /**\n     * Render debug information\n     */\n    private renderDebugInfo(): void {\n        const debugInfo = [\n            `FPS: ${this.performanceStats.averageFPS.toFixed(1)}`,\n            `Frame Time: ${this.performanceStats.frameTime.toFixed(2)}ms`,\n            `Render Time: ${this.performanceStats.renderTime.toFixed(2)}ms`,\n            `Update Time: ${this.performanceStats.updateTime.toFixed(2)}ms`,\n            `Platform: ${this.platform}`,\n            `State: ${this.stateManager.getCurrentState()}`,\n            `Objects: ${this.physics.getObjectCount()}`\n        ];\n\n        this.renderer.renderDebugText(debugInfo, 10, 10);\n    }\n\n    /**\n     * Update performance statistics\n     */\n    private updatePerformanceStats(currentTime: number): void {\n        // Update FPS counter\n        this.fpsCounter++;\n        \n        if (currentTime - this.lastFpsUpdate >= 1000) {\n            this.performanceStats.averageFPS = this.fpsCounter;\n            this.fpsCounter = 0;\n            this.lastFpsUpdate = currentTime;\n            \n            // Update memory usage if available\n            if ((performance as any).memory) {\n                this.performanceStats.memoryUsage = (performance as any).memory.usedJSHeapSize / 1024 / 1024;\n            }\n        }\n        \n        // Update frame timing\n        this.performanceStats.frameTime = this.deltaTime * 1000;\n        this.performanceStats.renderTime = this.perfLogger.end('render') || 0;\n        this.performanceStats.updateTime = this.perfLogger.end('update') || 0;\n    }\n\n    /**\n     * Pause the game\n     */\n    pause(): void {\n        if (!this.isRunning || this.isPaused) {\n            return;\n        }\n        \n        this.isPaused = true;\n        this.audio.pauseAll();\n        this.logger.info('⏸️ Game paused');\n    }\n\n    /**\n     * Check if game is paused\n     */\n    getPaused(): boolean {\n        return this.isPaused;\n    }\n\n    /**\n     * Resume the game\n     */\n    resume(): void {\n        if (!this.isRunning || !this.isPaused) {\n            return;\n        }\n        \n        this.isPaused = false;\n        this.lastTime = performance.now(); // Reset timing\n        this.audio.resumeAll();\n        this.logger.info('▶️ Game resumed');\n    }\n\n    /**\n     * Stop the game\n     */\n    stop(): void {\n        if (!this.isRunning) {\n            return;\n        }\n        \n        this.isRunning = false;\n        this.isPaused = false;\n        this.audio.stopAll();\n        this.logger.info('⏹️ Game stopped');\n    }\n\n    /**\n     * Handle window resize\n     */\n    handleResize(): void {\n        this.renderer.handleResize();\n        this.logger.debug('📐 Game resized');\n    }\n\n    /**\n     * Setup demo content for FÁZE 1\n     */\n    private setupDemoContent(): void {\n        this.logger.info('🎮 Setting up demo content...');\n        \n        try {\n            // Create player ship in current system\n            let shipPosition = { x: 512, y: 384 }; // Default center\n            \n            if (this.galaxyManager) {\n                const currentSystem = this.galaxyManager.getCurrentSystem();\n                if (currentSystem) {\n                    // Position ship in the system\n                    shipPosition = {\n                        x: currentSystem.star.position.x + 100, // Offset from star\n                        y: currentSystem.star.position.y + 100\n                    };\n                }\n            }\n            \n            this.playerShip = new PlayerShip(\n                this.physics,\n                this.input,\n                this.audio,\n                shipPosition\n            );\n            \n            // Create planets from current galaxy system\n            const demoPlanets: any[] = [];\n            \n            if (this.galaxyManager) {\n                const currentSystem = this.galaxyManager.getCurrentSystem();\n                if (currentSystem) {\n                    // Add central star\n                    const starObj = this.physics.createPlanet(\n                        currentSystem.star.id, \n                        { x: 512, y: 384 }, // Center the star on screen\n                        currentSystem.star.mass * 1000000, \n                        Math.min(currentSystem.star.radius * 20, 80) // Scale for visibility\n                    );\n                    this.physics.addObject(starObj);\n                    this.physics.addGravityWell(currentSystem.star.id, {\n                        position: starObj.position,\n                        mass: starObj.mass,\n                        radius: 300\n                    });\n                    demoPlanets.push(starObj);\n                    \n                    // Add planets\n                    currentSystem.planets.forEach((planet, index) => {\n                        const angle = (index * Math.PI * 2) / currentSystem.planets.length;\n                        const distance = 150 + (planet.orbitDistance * 30); // Scale orbit distance\n                        \n                        const planetPos = {\n                            x: 512 + Math.cos(angle) * distance,\n                            y: 384 + Math.sin(angle) * distance\n                        };\n                        \n                        const planetObj = this.physics.createPlanet(\n                            planet.id,\n                            planetPos,\n                            planet.mass * 100000,\n                            Math.max(planet.radius * 10, 15) // Scale for visibility\n                        );\n                        \n                        this.physics.addObject(planetObj);\n                        demoPlanets.push(planetObj);\n                    });\n                    \n                    this.logger.info(`✅ Generated system: ${currentSystem.name} with ${currentSystem.planets.length} planets`);\n                }\n            }\n            \n                        // Load celestial system\n            if (this.galaxyManager && this.celestialManager) {\n                const currentSystem = this.galaxyManager.getCurrentSystem();\n                if (currentSystem) {\n                    this.celestialManager.loadSystem({\n                        systemData: currentSystem,\n                        cameraPosition: { x: 512, y: 384 }\n                    });\n                    \n                    // Discover all bodies for demo\n                    this.celestialManager.discoverAllBodies();\n                    \n                    this.logger.info(`🌌 Loaded celestial system: ${currentSystem.name}`);\n                }\n            }\n\n            // Fallback demo planets if no galaxy system\n            if (demoPlanets.length === 0) {\n                const planet1 = this.physics.createPlanet('demo_planet_1', { x: 300, y: 200 }, 1000000, 50);\n                const planet2 = this.physics.createPlanet('demo_planet_2', { x: 700, y: 500 }, 800000, 40);\n\n                this.physics.addObject(planet1);\n                this.physics.addObject(planet2);\n\n                this.physics.addGravityWell('demo_planet_1', {\n                    position: planet1.position,\n                    mass: planet1.mass,\n                    radius: 200\n                });\n\n                this.physics.addGravityWell('demo_planet_2', {\n                    position: planet2.position,\n                    mass: planet2.mass,\n                    radius: 180\n                });\n\n                demoPlanets.push(planet1, planet2);\n            }\n\n            // Pass demo entities to state manager for rendering\n            this.stateManager.setDemoShip(this.playerShip.getPhysicsObject());\n            this.stateManager.setDemoPlanets(demoPlanets);\n            \n            this.logger.info('✅ Demo content setup completed');\n            \n        } catch (error) {\n            this.logger.error('❌ Failed to setup demo content', error);\n        }\n    }\n\n    /**\n     * Handle errors\n     */\n    handleError(error: any): void {\n        this.logger.error('Game error handled', error);\n        \n        // Try to recover gracefully\n        try {\n            // Pause the game\n            this.pause();\n            \n            // Show error state\n            this.stateManager.setState(GameState.Error);\n            \n        } catch (recoveryError) {\n            this.logger.critical('Failed to recover from error', recoveryError);\n            // Full stop if recovery fails\n            this.stop();\n        }\n    }\n\n    /**\n     * Setup auto-save functionality\n     */\n    private setupAutoSave(): void {\n        setInterval(() => {\n            if (this.isRunning && !this.isPaused) {\n                this.saveGame();\n            }\n        }, this.config.autoSaveInterval);\n    }\n\n    /**\n     * Save game state\n     */\n    async saveGame(): Promise<void> {\n        try {\n            await this.stateManager.save();\n            this.logger.debug('💾 Game saved');\n        } catch (error) {\n            this.logger.error('Failed to save game', error);\n        }\n    }\n\n    /**\n     * Load game state\n     */\n    async loadGame(): Promise<void> {\n        try {\n            await this.stateManager.load();\n            this.logger.info('📁 Game loaded');\n        } catch (error) {\n            this.logger.error('Failed to load game', error);\n        }\n    }\n\n    /**\n     * Cleanup resources\n     */\n    async cleanup(): Promise<void> {\n        this.logger.info('🧹 Cleaning up game resources...');\n        \n        this.stop();\n        \n        if (this.renderer) {\n            this.renderer.cleanup();\n        }\n        \n        if (this.audio) {\n            this.audio.cleanup();\n        }\n        \n        if (this.input) {\n            this.input.cleanup();\n        }\n        \n        if (this.playerShip) {\n            this.playerShip.cleanup();\n        }\n        \n        if (this.galaxyManager) {\n            await this.galaxyManager.cleanup();\n        }\n        \n        if (this.celestialManager) {\n            this.celestialManager.cleanup();\n        }\n        \n        // Cleanup inventory and crafting systems (save state if needed)\n        if (this.inventoryManager) {\n            this.inventoryManager.clearInventory();\n        }\n        \n        this.logger.info('✅ Game cleanup completed');\n    }\n\n    // Getters for external access\n    getIsPaused(): boolean {\n        return this.isPaused;\n    }\n\n    isGameRunning(): boolean {\n        return this.isRunning;\n    }\n\n    getPerformanceStats() {\n        return { ...this.performanceStats };\n    }\n\n    getRenderer(): Renderer {\n        return this.renderer;\n    }\n\n    getInput(): InputManager {\n        return this.input;\n    }\n\n    getPhysics(): SpacePhysics {\n        return this.physics;\n    }\n\n    getAudio(): AudioEngine {\n        return this.audio;\n    }\n\n    getStateManager(): GameStateManager {\n        return this.stateManager;\n    }\n}","/**\n * Space Explorer 16-Bit - Main Entry Point\n * AI-Generated 2D space exploration game with retro CRT aesthetic\n */\n\nimport { Game } from '@core/Game';\nimport { Platform, PlatformDetector } from '@utils/Platform';\nimport { Logger } from '@utils/Logger';\n\n// Global game instance\nlet game: Game | null = null;\n\n/**\n * Loading progress management\n */\nclass LoadingManager {\n    private progressElement: HTMLElement;\n    private textElement: HTMLElement;\n    private currentProgress = 0;\n\n    constructor() {\n        this.progressElement = document.getElementById('loadingProgress')!;\n        this.textElement = document.getElementById('loadingText')!;\n    }\n\n    updateProgress(progress: number, text?: string): void {\n        this.currentProgress = Math.max(this.currentProgress, progress);\n        this.progressElement.style.width = `${this.currentProgress}%`;\n        \n        if (text) {\n            this.textElement.textContent = text;\n        }\n    }\n\n    hide(): void {\n        const loadingScreen = document.getElementById('loadingScreen')!;\n        loadingScreen.classList.add('hidden');\n        \n        setTimeout(() => {\n            loadingScreen.style.display = 'none';\n        }, 500);\n    }\n}\n\n/**\n * Initialize the game with proper error handling and loading\n */\nasync function initializeGame(): Promise<void> {\n    const loader = new LoadingManager();\n    const logger = new Logger('Main');\n    \n    try {\n        logger.info('🚀 Starting Space Explorer 16-Bit initialization...');\n        \n        // Detect platform for adaptive features\n        loader.updateProgress(10, 'DETECTING PLATFORM...');\n        const platform = PlatformDetector.detect();\n        logger.info(`Platform detected: ${platform}`);\n        \n        // Initialize canvas and context\n        loader.updateProgress(20, 'INITIALIZING GRAPHICS...');\n        const canvas = document.getElementById('gameCanvas') as HTMLCanvasElement;\n        if (!canvas) {\n            throw new Error('Game canvas not found');\n        }\n        \n        // Adjust canvas for mobile\n        if (platform === Platform.Mobile) {\n            adjustCanvasForMobile(canvas);\n        }\n        \n        // Pre-load critical resources\n        loader.updateProgress(40, 'LOADING CORE SYSTEMS...');\n        await preloadCriticalResources();\n        \n        // Initialize game engine\n        loader.updateProgress(60, 'INITIALIZING GAME ENGINE...');\n        game = new Game(canvas, platform);\n        \n        // Initialize procedural generators\n        loader.updateProgress(80, 'GENERATING GALAXY...');\n        \n        // Add additional progress updates during galaxy generation\n        const progressInterval = setInterval(() => {\n            const currentProgress = Math.min(95, 80 + Math.floor(Math.random() * 10));\n            loader.updateProgress(currentProgress, 'GENERATING GALAXY...');\n        }, 1000);\n        \n        try {\n            await game.initialize();\n            clearInterval(progressInterval);\n        } catch (error) {\n            clearInterval(progressInterval);\n            throw error;\n        }\n        \n        // Final setup\n        loader.updateProgress(95, 'FINAL PREPARATIONS...');\n        setupEventListeners();\n        \n        // Start the game\n        loader.updateProgress(100, 'LAUNCHING SPACE EXPLORER...');\n        await new Promise(resolve => setTimeout(resolve, 500)); // Brief pause for effect\n        \n        loader.hide();\n        await game.start();\n        \n        logger.info('✅ Game successfully initialized and started');\n        \n    } catch (error) {\n        logger.error('❌ Failed to initialize game:', error);\n        showErrorScreen(error as Error);\n    }\n}\n\n/**\n * Adjust canvas size and settings for mobile devices\n */\nfunction adjustCanvasForMobile(canvas: HTMLCanvasElement): void {\n    const container = document.getElementById('gameContainer')!;\n    const containerRect = container.getBoundingClientRect();\n    \n    // Calculate optimal size maintaining aspect ratio\n    const targetRatio = 1024 / 768;\n    let width = containerRect.width - 20; // margin\n    let height = width / targetRatio;\n    \n    if (height > containerRect.height - 20) {\n        height = containerRect.height - 20;\n        width = height * targetRatio;\n    }\n    \n    canvas.style.width = `${width}px`;\n    canvas.style.height = `${height}px`;\n    \n    // Maintain internal resolution for pixel-perfect rendering\n    canvas.width = 1024;\n    canvas.height = 768;\n}\n\n/**\n * Pre-load any critical resources\n */\nasync function preloadCriticalResources(): Promise<void> {\n    // For now, just simulate loading time\n    // In future phases, this will load essential assets\n    return new Promise(resolve => {\n        setTimeout(resolve, 200);\n    });\n}\n\n/**\n * Setup global event listeners\n */\nfunction setupEventListeners(): void {\n    // Handle window resize\n    window.addEventListener('resize', () => {\n        if (game && PlatformDetector.detect() === Platform.Mobile) {\n            const canvas = document.getElementById('gameCanvas') as HTMLCanvasElement;\n            adjustCanvasForMobile(canvas);\n            game.handleResize();\n        }\n    });\n    \n    // Handle visibility changes (pause when tab not visible)\n    document.addEventListener('visibilitychange', () => {\n        if (game) {\n            if (document.hidden) {\n                game.pause();\n            } else {\n                game.resume();\n            }\n        }\n    });\n    \n    // Handle page unload\n    window.addEventListener('beforeunload', () => {\n        if (game) {\n            game.cleanup();\n        }\n    });\n    \n    // Handle errors\n    window.addEventListener('error', (event) => {\n        const logger = new Logger('GlobalError');\n        logger.error('Unhandled error:', event.error);\n        \n        if (game) {\n            game.handleError(event.error);\n        }\n    });\n}\n\n/**\n * Show error screen with debugging information\n */\nfunction showErrorScreen(error: Error): void {\n    const loadingScreen = document.getElementById('loadingScreen')!;\n    const loadingText = document.getElementById('loadingText')!;\n    const loadingBar = document.getElementById('loadingBar')!;\n    \n    loadingText.textContent = '❌ INITIALIZATION FAILED';\n    loadingText.style.color = '#f00';\n    loadingBar.style.display = 'none';\n    \n    // Create error details\n    const errorDetails = document.createElement('div');\n    errorDetails.style.cssText = `\n        color: #f00;\n        font-family: monospace;\n        font-size: 12px;\n        margin-top: 20px;\n        text-align: left;\n        background: rgba(255, 0, 0, 0.1);\n        padding: 10px;\n        border: 1px solid #f00;\n        max-width: 80%;\n        overflow-wrap: break-word;\n    `;\n    errorDetails.innerHTML = `\n        <div><strong>Error:</strong> ${error.message}</div>\n        <div><strong>Stack:</strong></div>\n        <pre style=\"font-size: 10px; margin-top: 5px;\">${error.stack}</pre>\n        <div style=\"margin-top: 10px; color: #ff0;\">\n            Please check the browser console for more details.\n        </div>\n    `;\n    \n    loadingScreen.appendChild(errorDetails);\n}\n\n/**\n * Development helpers (only in dev mode)\n */\nif (import.meta.env.DEV) {\n    // Expose game instance for debugging\n    (window as any).__SPACE_EXPLORER_GAME__ = () => game;\n    \n    // Add debug key bindings\n    document.addEventListener('keydown', (event) => {\n        if (event.key === 'F12' || (event.ctrlKey && event.shiftKey && event.key === 'I')) {\n            // Allow developer tools\n            return;\n        }\n        \n        if (game && event.ctrlKey) {\n            switch (event.key) {\n                case 'r':\n                    // Restart game\n                    event.preventDefault();\n                    location.reload();\n                    break;\n                case 'p':\n                    // Toggle pause\n                    event.preventDefault();\n                    if (game.getPaused()) {\n                        game.resume();\n                    } else {\n                        game.pause();\n                    }\n                    break;\n            }\n        }\n    });\n}\n\n// Start the game when DOM is ready\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initializeGame);\n} else {\n    initializeGame();\n}\n\n// Export for potential external access\nexport { game };"],"names":["Platform","_PlatformDetector","detect","this","cachedPlatform","window","__TAURI__","cordova","isMobile","isDesktop","getFeatures","cachedFeatures","platform","hasKeyboard","hasTouch","hasFileSystem","hasFullscreen","canVibrate","preferredInputMethod","getPreferredInput","storageType","getStorageType","userAgent","navigator","vendor","opera","test","maxTouchPoints","smallScreen","innerWidth","innerHeight","largeScreen","desktopOS","document","fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled","getConfig","features","canvas","pixelRatio","devicePixelRatio","maxWidth","maxHeight","scalingMode","input","enableKeyboard","enableTouch","enableGamepad","touchSensitivity","keyRepeatDelay","keyRepeatRate","performance","targetFPS","enableParticles","enablePostProcessing","enableShadows","enableDithering","renderScale","audio","enableAudio","enableMusic","enableSFX","enableSpatialAudio","audioFormat","maxChannels","storage","type","enableAutoSave","saveInterval","maxSaveSlots","compressionEnabled","supports","feature","Boolean","getPlatformName","reset","PlatformDetector","LogLevel","_Logger","constructor","module","configure","config","level","globalLevel","maxEntries","enableConsole","enableStorage","setLevel","debug","message","data","log","info","warn","error","stack","Error","name","critical","entry","timestamp","Date","now","addEntry","outputToConsole","storeEntry","entries","push","length","shift","prefix","toISOString","consoleMethod","style","console","groupCollapsed","groupEnd","stored","localStorage","getItem","logs","JSON","parse","splice","setItem","stringify","getEntries","getEntriesByLevel","filter","getEntriesByModule","clear","removeItem","exported","loadFromStorage","slice","createPerformanceLogger","start","end","measure","fn","measureAsync","timers","Map","set","logger","startTime","get","duration","delete","toFixed","result","Logger","Renderer","gl","shaderPrograms","colorPalette","renderStats","drawCalls","triangles","sprites","particles","ctx","getContext","enablePixelPerfect","enableCRT","Mobile","Desktop","backgroundColor","canvasSize","width","height","initialize","setupPixelPerfectCanvas","generateColorPalette","initializeWebGL","createRenderBuffers","imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","scale","size","r","g","b","backBuffer","createImageData","frontBuffer","clearBuffer","hexToColor","beginFrame","fillStyle","fillRect","endFrame","applyDithering","putImageData","applyCRTEffect","buffer","color","i","a","setPixel","x","y","Math","floor","index","py","px","drawLine","x0","y0","x1","y1","dx","abs","dy","sx","sy","err","e2","drawCircle","centerX","centerY","radius","filled","d","renderText","text","save","font","colorToHex","textBaseline","shadowColor","shadowBlur","fillText","restore","renderDebugText","lines","textColor","max","map","line","forEach","generateShipSprite","imageData","shipColor","drawSprite","sprite","oldR","oldG","oldB","newColor","findNearestPaletteColor","errorR","errorG","errorB","distributeError","factor","min","nearestColor","minDistance","Number","MAX_VALUE","paletteColor","distance","sqrt","pow","handleResize","hex","exec","parseInt","toHex","c","round","toString","getRenderStats","drawRect","cleanup","program","deleteProgram","InputManager","gamepads","touchZones","activeTouches","enableMouse","eventListeners","currentState","createEmptyInputState","previousState","configureForPlatform","setupEventListeners","setupTouchZones","Tauri","Cordova","Web","keyDownHandler","e","handleKeyDown","keyUpHandler","handleKeyUp","addEventListener","removeEventListener","mouseMoveHandler","handleMouseMove","mouseDownHandler","handleMouseDown","mouseUpHandler","handleMouseUp","wheelHandler","handleWheel","touchStartHandler","handleTouchStart","touchMoveHandler","handleTouchMove","touchEndHandler","handleTouchEnd","passive","gamepadConnectedHandler","handleGamepadConnected","gamepadDisconnectedHandler","handleGamepadDisconnected","focusHandler","handleFocus","blurHandler","handleBlur","canvasRect","getBoundingClientRect","update","deltaTime","deepCopyInputState","keysPressed","keysReleased","mouseButtonsPressed","mouseButtonsReleased","mouseWheel","touchStarted","touchEnded","updateGamepadState","updateVirtualControls","key","code","keys","has","add","isGameKey","preventDefault","rect","mousePosition","clientX","left","clientY","top","button","mouseButtons","deltaY","touches","Array","from","changedTouches","touch","identifier","id","startPosition","currentPosition","zone","getTouchZone","touchInfo","gamepad","connected","axes","buttons","getGamepads","state","pressed","virtualThrust","virtualRotation","virtualAction","touchId","deltaX","Set","includes","zoneName","isKeyDown","isKeyPressed","isKeyReleased","isMouseButtonDown","isMouseButtonPressed","getMousePosition","getMouseWheel","getTouchCount","getVirtualThrust","getVirtualRotation","getThrustInput","thrust","values","getRotationInput","rotation","isActionPressed","isPausePressed","SpacePhysics","objects","gravityWells","GRAVITATIONAL_CONSTANT","SPACE_DRAG","MIN_VELOCITY","MAX_VELOCITY","collisionPairs","addObject","object","removeObject","removed","getObject","addGravityWell","well","removeGravityWell","isStatic","updateObject","detectCollisions","resolveCollisions","acceleration","applyGravity","applyDrag","velocity","speed","getVectorMagnitude","position","distanceSquared","force","mass","forceX","forceY","drag","objectArray","j","objA","objB","collision","checkCollision","objectA","objectB","penetration","normal","point","resolveCollision","onCollision","separationA","separationB","relativeVelocity","velocityAlongNormal","impulse","restitution","impulseVector","applyThrust","objectId","thrustVector","thrustPower","magnitude","normalizedThrust","calculateOrbitalVelocity","centralMass","calculateEscapeVelocity","getObjectsInRadius","center","getDistance","raycast","direction","maxDistance","normalizedDirection","normalizeVector","vector","getStats","objectCount","gravityWellCount","collisionCount","activeObjects","obj","getObjectCount","getAllObjects","createShip","friction","health","createPlanet","createProjectile","AudioEngine","context","masterGain","musicGain","sfxGain","soundEffects","activeSources","musicTrack","ambientTrack","synthNodes","isInitialized","masterVolume","musicVolume","sfxVolume","sampleRate","AudioContext","webkitAudioContext","setupUserInteractionHandler","createGain","connect","destination","setMasterVolume","setMusicVolume","setSfxVolume","generateBasicSounds","resumeAudio","async","resume","once","engineBuffer","generateEngineSound","loop","volume","pitch","laserBuffer","generateLaserSound","explosionBuffer","generateExplosionSound","beepBuffer","generateBeepSound","samples","createBuffer","getChannelData","t","baseFreq","sin","harmonic1","PI","harmonic2","harmonic3","noise","random","progress","freq","amplitude","exp","rumble","frequency","playSfx","soundId","soundEffect","source","createBufferSource","gainNode","sourceId","pannerNode","playbackRate","value","gain","createPanner","panningModel","distanceModel","refDistance","rolloffFactor","positionX","positionY","positionZ","audioSource","node","isPlaying","currentTime","onended","stopSound","stop","updateSpatialAudio","setListenerPosition","orientation","listener","forwardX","cos","forwardY","forwardZ","upX","upY","upZ","playEngineSound","playLaserSound","playExplosion","playUIBeep","pauseAll","suspend","resumeAll","stopAll","contextState","close","SoundType","ProceduralAudio","events","audioContext","soundEffectsGain","currentTrack","ambientLayers","activeSounds","noiseBuffer","convolver","reverbBuffer","createNoiseBuffer","createReverbBuffer","onAudioError","bufferSize","output","channel","channelData","decay","createConvolver","playSound","sourceGain","filterNode","distortionNode","waveform","createNoiseSource","createOscillatorSource","createBiquadFilter","Q","resonance","distortion","createDistortion","z","currentNode","applyEnvelope","frequencyModulation","OscillatorNode","applyFrequencyModulation","onSoundPlayed","oscillator","createOscillator","harmonics","harmonic","harmonicOsc","harmonicGain","amount","createWaveShaper","curve","Float32Array","deg","oversample","gainParam","attack","sustain","release","setValueAtTime","linearRampToValueAtTime","sustainEnd","modConfig","modOscillator","modGain","rate","depth","playRetroSound","intensity","configs","engine","laser","explosion","beep","warning","warp","reverb","roomSize","dampening","wetness","shield","impact","communication","ambient","ui","startAmbientTrack","trackName","stopAmbientTrack","deep_space","fadeInTime","fadeOutTime","crossfadeTime","layers","baseFrequency","pan","frequencyVariation","volumeVariation","minFreq","maxFreq","nebula_drift","void_silence","createAmbientLayers","onTrackChanged","layerConfig","layerGain","panner","createStereoPanner","startLayerModulation","freqModOsc","freqModGain","filterModOsc","filterModGain","layer","setTimeout","setSFXVolume","getAudioStats","stopAllSounds","sound","AudioScheduledSourceNode","dispose","MainMenu","selectedButtonIndex","animationTime","transitionProgress","isTransitioning","backgroundParticles","titleGlow","screenFlicker","saveSlots","newGameSettings","getDefaultNewGameSettings","gameSettings","getDefaultGameSettings","loadSaveSlots","initializeMainMenu","startBackgroundEffects","updateVisualEffects","updateTransition","handleInput","updateParticleEffects","navigateUp","navigateDown","selectButton","goBack","handleNewGameInput","handleSettingsInput","handleHotkeys","playUISound","enabled","updateButtonHighlights","action","onExit","transitionToState","highlighted","hotkey","hasSaveGames","updateButtonPositions","initializeNewGameMenu","playerName","editPlayerName","difficulty","toUpperCase","cycleDifficulty","galaxySize","cycleGalaxySize","enemyFrequency","cycleEnemyFrequency","enablePermadeath","togglePermadeath","enableTutorial","toggleTutorial","startNewGame","initializeLoadGameMenu","slot","exists","system","playtime","loadGame","initializeSettingsMenu","adjustRenderScale","adjustMasterVolume","adjustMusicVolume","adjustSfxVolume","showFPS","toggleShowFPS","vsync","toggleVSync","applySettings","resetToDefaults","generateRandomSeed","adjustSettingDown","adjustSettingUp","newState","createTransitionEffect","initializeMenuForState","updateBackgroundParticles","createExplosion","emitterId","createThrustTrail","Beep","UI","Communication","Warning","names","currentIndex","indexOf","updateNewGameMenuText","difficulties","sizes","frequencies","galaxySeed","substring","onNewGame","settingId","updateSettingsMenuText","onSettings","saveSettings","onLoadGame","find","startingResources","fullscreen","mouseSensitivity","autoSave","autoSaveInterval","colorblindMode","subtitles","reducedMotion","keyBindings","forward","backward","right","fire","some","date","loadSettings","saved","render","renderer","renderMainMenu","renderNewGameMenu","renderLoadGameMenu","renderSettingsMenu","renderGameStart","renderTransition","titleColor","renderButtons","hint","progressWidth","loadingTexts","textIndex","currentText","onGameStart","wipeHeight","renderButton","hotkeyText","replace","align","fontSize","textX","charX","getCurrentState","getGameSettings","setNewGameSettings","settings","Object","assign","removeEmitter","GameState","GameStateManager","stateStack","transitions","stateStartTime","mainMenu","demoShip","demoPlanets","gameTimeStarted","gameData","createDefaultGameData","initializeMenuSystem","setupStateTransitions","menuEvents","handleNewGame","saveSlot","handleLoadGame","handleSettingsChange","handleExit","setState","loadGameData","setupDemoContent","playerShip","fuel","resources","currentSystem","gameTime","experience","discoveries","technologies","stats","timePlayedSeconds","systemsVisited","aliensEncountered","battlesWon","resourcesCollected","addTransition","to","condition","transitionKey","transition","onStateEnter","pushState","popState","poppedState","pop","startGameTimeTracking","pauseGameTimeTracking","updatePlayingState","updateLoadingState","catch","renderLoadingState","renderPlayingState","renderPausedState","renderErrorState","renderDefaultState","dots","repeat","renderMenuState","renderMenuBackground","item","renderSpaceBackground","shipSprite","planet","renderBasicHUD","brightness","gradient","twinkle","twinkleColor","minutes","seconds","padStart","saveData","version","serialized","load","resourcesArray","isArray","toLowerCase","saveKey","getPreviousState","getGameData","isInState","setDemoShip","ship","setDemoPlanets","planets","canPause","canResume","isGameActive","isInMenu","ShipSection","SystemType","ShipSystems","damage","heatGeneration","powerConsumption","fuelConsumption","updateTimer","lastUpdateTime","maxHull","maxShields","maxPower","maxFuel","maxHeat","enginePower","engineEfficiency","shieldRegenRate","shieldPowerDrain","weaponCount","weaponPower","weaponHeatGeneration","status","hull","shields","power","heat","enginesOnline","shieldsOnline","weaponsOnline","lifeSupport","warpDrive","shieldStrength","weaponAccuracy","sensorRange","powerAllocation","engines","weapons","sensors","section","updatePowerConsumption","updateThermalManagement","updateShields","updateFuelConsumption","updateSystemEfficiency","checkCriticalSystems","updatePerformanceModifiers","totalConsumption","handlePowerFailure","handleOverheat","regenRate","consumption","emergencyShutdown","engineDamage","getSectionDamageLevel","coreDamage","weaponDamage","bridgeDamage","heatPenalty","powerLevel","powerPenalty","onCriticalDamage","onPowerFailure","onOverheat","applyDamage","damageType","actualDamage","shieldAbsorption","addDamageReport","severity","calculateDamageSeverity","systemsAffected","getAffectedSystems","damageReport","repairCost","calculateRepairCost","repairTime","calculateRepairTime","sectionDamage","onSystemDamage","bow","stern","port","starboard","core","bridge","engineering","minor","metal","electronics","crystals","moderate","major","nanobots","destroyed","damages","totalDamage","repairDamage","damageIndex","hasEnoughResources","onSystemRepaired","available","required","setPowerAllocation","allocation","total","reduce","sum","val","toggleSystem","getSystemState","getStatus","getPowerAllocation","getDamageReports","getDiagnostics","totalDamageReports","reports","criticalSystems","getCriticalSystems","addFuel","addPower","emergencyRepair","WarpDrive","stateTimer","isCharging","isActive","accretionParticles","blackHoleRadius","shipPosition","shipSize","originalSpeed","PHASE_PARTICLE_ABSORPTION","PHASE_BLACK_HOLE_GROWTH","PHASE_ACCRETION_FORMATION","PHASE_SHUTDOWN","particleIntensity","blackHoleIntensity","accretionIntensity","distortionIntensity","speedMultiplier","energyCost","particleCount","maxRange","cooldownTime","activateWarp","initializeParticles","onWarpStart","deactivateWarp","angle","colors","life","absorbed","updateChargingPhase","updateBlackHoleGrowth","updateAccretionFormation","updateActiveWarp","updateDeactivation","updateParticles","updateAccretionDisk","updateSpaceDistortion","particle","toCenter","initializeAccretionDisk","totalGrowthProgress","onBlackHoleFormed","onSpaceDistorted","reverseProgress","addDissolutionParticles","clearAllEffects","onWarpEnd","getAccretionColor","fromCenter","p","renderSpaceDistortion","renderParticles","renderAccretionDisk","renderBlackHole","alpha","glowRadius","glowColor","baseRadius","getState","isWarpActive","isWarpCharging","getWarpProgress","getSpaceDistortion","PlayerShip","physics","thrustLevel","engineSoundId","thrustParticles","maxHealth","rotationSpeed","maxVelocity","currentFuel","physicsObject","other","handleCollision","shipSystems","warpSpeedMultiplier","updateRotation","updateMovement","updateThrustParticles","updateAudio","consumeFuel","handleWarpInput","thrustInput","rotationInput","systemStatus","thrustDirection","thrustForce","createThrustParticles","currentSpeed","maxLife","collisionDamage","takeDamage","destroy","heal","fireWeapon","spawnOffset","spawnX","spawnY","projectileSpeed","projectileVelocity","projectile","renderThrustParticles","getShipData","getPhysicsObject","getPosition","getVelocity","getRotation","isAlive","getSystemStatus","getShipSystems","Core","getWarpDrive","getWarpState","renderWarpEffects","StarType","PlanetType","GalaxyGenerator","stars","starSystems","galaxyMap","seed","starCount","spiralArms","armTightness","coreSize","starDensity","SeededRandom","generateGalaxy","progressCallback","generateStarPositions","generateStarProperties","generateStarSystems","generateAnomalies","endTime","systems","generateSpiralPosition","starId","star","generateStarName","luminosity","temperature","age","metallicity","normalizedRadius","next","spiralAngle","angleNoise","radiusNoise","finalAngle","finalRadius","prefixes","suffixes","suffix","number","distanceFromCore","coreInfluence","range","generateStellarMass","getStarTypeFromMass","calculateLuminosity","calculateTemperature","calculateRadius","generateStellarAge","getStarColor","O","B","A","F","G","K","M","lifetime","systemCount","batch","generateStarSystem","Promise","resolve","asteroidBelts","habitableZoneInner","habitableZoneOuter","systemAge","planetCount","currentOrbit","generatePlanet","innerRadius","outerRadius","density","composition","choice","orbitDistance","planetId","planetType","generatePlanetMass","calculatePlanetRadius","calculatePlanetTemperature","numberToRoman","orbitPeriod","calculateOrbitPeriod","hasAtmosphere","determineAtmosphere","hasRings","moons","surfaceType","determineSurfaceType","surfaceColor","generateSurfaceColor","hasWater","hasLife","atmosphereType","determineAtmosphereType","moonCount","generateMoonCount","generateMoon","solarConstant","starMass","String","fromCharCode","tidallyLocked","num","symbols","getStarsInRadius","getStarSystem","getAllStars","getAllSystems","getGalaxyConfig","array","integer","GalaxyPersistence","cachedSaveData","loadedChunks","saveGalaxy","generator","playerData","explorationData","exploredSystems","discoveredPlanets","visitedLocations","reputation","tradeRoutes","compressStarData","compressSystemData","saveToStorage","calculateSaveSize","loadGalaxy","validateSaveData","restoreGalaxyData","loadGalaxyChunk","options","chunkKey","getChunkKey","limitedStars","maxSystems","includeUnexplored","isSystemExplored","pos","temp","compressPlanetData","explored","orbit","hasAtmo","saveToWebStorage","saveToFileSystem","saveToCordovaFile","loadFromWebStorage","loadFromFileSystem","loadFromCordovaFile","saveToIndexedDB","localStorageError","loadFromIndexedDB","reject","request","indexedDB","open","onerror","onupgradeneeded","db","objectStoreNames","contains","createObjectStore","onsuccess","putRequest","transaction","objectStore","put","getRequest","split","bytes","Blob","systemId","clearCache","getStorageStats","cacheSize","lastSaveTime","exportGalaxy","importGalaxy","GalaxyManager","loadedSystems","nearbyStars","autoSaveTimer","chunkLoadRadius","maxLoadedSystems","galaxyConfig","persistence","currentSystemId","homeSystemId","totalSystemsVisited","totalPlanetsExplored","totalDistanceTraveled","galaxyDiscoveryProgress","timeoutPromise","_","initPromise","doInitialize","race","initializeFallbackGalaxy","savedData","setupNewGame","loadCurrentArea","setupAutoSave","centerStars","startingSystem","exploreSystem","chunkOptions","nearbySystems","travelToSystem","targetSystem","currentPos","coordinates","discoverPlanet","updateExplorationProgress","totalSystems","getNearbyStars","getLoadedSystems","getCurrentSystem","getSystem","findSystemsInRadius","isPlanetDiscovered","getGalaxyStats","totalStars","allSystems","distanceTraveled","currentSystemName","explorationProgress","clearInterval","setInterval","getPlayerData","getExplorationData","searchSystems","query","lowercaseQuery","getSystemDistance","systemId1","systemId2","system1","system2","getHomeSystem","updateConfig","newConfig","isGalaxyInitialized","CockpitStatusBar","interactions","panels","interactiveElements","flickerTimer","scanlineOffset","glitchTimer","hoveredElement","selectedElement","isDragging","damageReports","cargoLoad","radarZoom","radarMode","screenWidth","screenHeight","panelHeight","panelSpacing","enableInteraction","crtEffects","setupPanels","setupInteractiveElements","panelWidth","startY","title","setupSystemsPanel","setupControlPanel","setupDamagePanel","setupWeaponsPanel","setupRadarPanel","panel","addElement","label","mousePos","element","isPointInElement","handleElementClick","handleSliderDrag","elementId","handleButtonClick","handleToggleClick","onInventoryOpen","onCodexOpen","onResearchOpen","onCrewOpen","onGalaxyMapOpen","onRadarZoom","systemName","engines_toggle","shields_toggle","weapons_toggle","warp_toggle","radar_mode","onSystemToggle","localX","percentage","onPowerAllocationChange","renderPanelBase","renderPanel","renderCRTEffects","baseY","baseHeight","panelIndex","renderSystemsPanel","renderControlPanel","renderDamagePanel","renderWeaponsPanel","renderRadarPanel","renderStatusBar","renderWarningLight","renderToggle","thrustSlider","shieldSlider","renderSlider","renderDamageDisplay","renderRadarDisplay","isHeat","fillWidth","fillColor","bgColor","sliderPos","isHovered","shipX","shipY","maxRadius","updateSystemStatus","updateDamageReports","updateCargoLoad","CelestialBody","orbitRadius","orbitSpeed","orbitAngle","currentRotation","interactionZones","mineralDeposits","isDiscovered","isScanned","isLanded","resourcesDepleted","planetData","starData","moonData","initializeFromData","generateInteractionZones","generateResources","updatePlanetVisuals","getDarkStarColor","Terrestrial","atmosphereColor","Ocean","Desert","Volcanic","Frozen","GasGiant","ringColor","IceGiant","Toxic","bodyId","canEnter","requirements","canLand","canShipLand","getResourceTypes","resourceType","richness","accessibility","extractionDifficulty","generateSurfaceConditions","baseResources","gravity","radiation","weather","landingDifficulty","surfaceConditions","orbitCenter","cameraPosition","getDistanceFrom","renderDistance","screenPos","baseSize","scaledSize","minPixelSize","maxPixelSize","showOrbitLines","renderOrbitLine","atmoSize","renderRings","renderSurfaceDetails","renderStarGlow","centerScreen","orbitColor","featureX","featureY","featureColor","checkInteraction","performMining","miningEfficiency","interaction","availableResources","deposit","resource","extractedQuantity","quantity","quality","depletion","performScan","atmosphere","atmosphereData","biologicalSigns","anomalies","setOrbit","getInteractionInfo","InteractionPanel","isVisible","currentBody","currentZone","opacity","targetOpacity","panelX","panelY","hoveredButton","selectedButton","bodyInfo","scanData","miningResults","enableAnimations","fadeSpeed","showInteraction","body","calculatePanelPosition","setupButtons","hideInteraction","bodyPosition","screenBodyX","screenBodyY","buttonHeight","currentY","isPointInButton","buttonId","onEnterOrbit","onLand","onContinueFlight","onPerformScan","onStartMining","mineButton","borderColor","renderPanelBorder","renderBodyInfo","renderScanData","renderMiningResults","highlightColor","join","lastResult","buttonAlpha","textY","scanlineColor","isInteractionVisible","getCurrentBody","CelestialManager","panelInteractions","bodies","systemCenter","nearbyBodies","currentInteraction","frameCount","interactionDistance","enableInteractions","celestialBodyConfig","orbitLineOpacity","animationSpeed","interactionPanel","loadSystem","systemConfig","systemData","clearSystem","createStar","createMoon","setupOrbitalMechanics","getPlanetColor","parentPlanet","parentBody","moon","originalSetOrbit","bind","updateInteractions","closestInteraction","closestDistance","Infinity","sort","distA","getBody","getAllBodies","getNearbyBodies","getCurrentInteraction","discoverAllBodies","getSystemStats","discoveredBodies","scannedBodies","bodyCount","hasActiveInteraction","performAction","getActiveBodies","SpaceBackground","galaxyBand","nebulaClouds","isDistorted","distortionData","time","starLayers","parallaxStrength","enableDistortion","galaxyBandIntensity","nebulaOpacity","generateBackground","generateStars","generateGalaxyBand","generateNebulae","getStarSize","originalPosition","bandWidth","bandOffset","getGalaxyBandColor","getNebulaColor","applyWarpDistortion","distortStars","restoreFromDistortion","gradualRestore","restoreAmount","restoreStarsGradually","pullStrength","renderNebulae","renderGalaxyBand","renderStarLayer","nebula","screenX","screenY","pixelCount","renderStar","parallaxFactor","halfCore","dimColor","updateWarpDistortion","galaxyBandStars","nebulaCount","regenerateBackground","ItemType","ItemRarity","ItemDatabase","items","recipes","categories","initializeDatabase","totalItems","generateComponents","generateEquipment","generateWeapons","generateTools","generateConsumables","generateBlueprints","generateArtifacts","description","category","rarity","maxStack","purity","radioactivity","stability","res","createItem","iconColor","isUnique","isTradeable","isConsumable","addItem","durability","efficiency","defense","comp","eq","wp","tool","cons","bp","lore","art","loreText","generateItemSprite","baseColor","pixels","drawResourceSprite","drawComponentSprite","drawEquipmentSprite","drawWeaponSprite","drawToolSprite","drawConsumableSprite","drawBlueprintSprite","drawArtifactSprite","darkColor","darkenColor","lightColor","lightenColor","recipe","getItemsByCategory","getItemsByType","getItemsByRarity","getAllItems","getRecipe","itemId","searchItems","lowerQuery","generateRandomItem","candidateItems","rarityWeights","common","uncommon","rare","epic","legendary","artifact","totalWeight","weight","currentWeight","selectedRarity","renderItemSprite","pixel","itemsByType","itemsByRarity","InventoryManager","itemDatabase","slots","totalVolume","selectedSlot","draggedItem","sortOptions","by","descending","groupByType","slotSize","slotSpacing","maxSlots","gridWidth","gridHeight","maxWeight","maxVolume","allowStacking","initializeSlots","locked","reserved","remainingQuantity","canAdd","emptySlot","findEmptySlot","onInventoryFull","stackSize","addedWeight","addedVolume","onWeightExceeded","onVolumeExceeded","Equipment","onItemAdded","canRemove","removedWeight","removedVolume","removedItem","onItemRemoved","moveItem","fromSlot","toSlot","canStack","getItemCount","hasItem","getFilteredItems","searchText","search","comparison","localeCompare","rarityOrder","compactInventory","autoSort","aRarity","bRarity","usedSlots","uniqueItems","totalSlots","itemCount","fillPercentage","weightPercentage","volumePercentage","renderBackground","renderHeader","renderGrid","renderItems","renderSelection","renderDraggedItem","buttonY","gridStartX","gridStartY","slotX","slotY","slotIndex","spriteX","spriteY","quantityText","rarityColor","getRarityColor","conditionWidth","conditionColor","Common","Uncommon","Rare","Epic","Legendary","Artifact","statsY","setVisible","visible","isInventoryVisible","selectSlot","onSlotSelected","getSelectedSlot","useSelectedItem","setFilter","clearFilter","setSortOptions","setSlotLocked","setSlotReserved","clearInventory","saveState","modifiers","loadState","slotData","CraftingSystem","inventory","stations","activeAttempts","knownRecipes","selectedStation","selectedRecipe","initializeStations","initializeBasicRecipes","availableRecipes","energyRequired","station","basicRecipes","requiredItems","metal_iron","crystal_quartz","craftingTime","successRate","comp_circuit","gas_hydrogen","metal_titanium","crystal_dilithium","basicStation","advancedStation","updateItemRecipes","targetItem","findTargetItemForRecipe","recipeId","craft_circuit_from_metal","craft_repair_kit","craft_energy_cell","craft_shield_emitter","craft_plasma_conduit","startCrafting","stationId","onCraftingFailed","attempt","onCraftingStarted","completedAttempts","completeCrafting","onCraftingCompleted","returnQuantity","ceil","learnRecipe","getAvailableRecipes","canCraftRecipe","canCraft","missingItems","hasStation","hasAllItems","getCraftingProgress","elapsed","timeRemaining","itemName","renderCraftingPanel","renderCraftingProgress","stationY","stationColor","statusText","recipeY","craftability","missingText","count","progressItems","progressY","progressX","isCraftingVisible","selectStation","getSelectedStation","setStationActive","active","activeStations","s","totalStations","activeCrafting","stationData","WeaponType","DamageType","WeaponSystem","projectiles","weaponStates","nextProjectileId","targetingMode","currentTarget","targetPosition","targets","addWeapon","weapon","chargeProgress","lastFired","ammo","ammoCapacity","isOverheated","cooldownEnd","removeWeapon","weaponId","projId","sourcePosition","fireRate","onAmmoEmpty","chargeTime","finalTargetPos","calculateFiringDirection","spread","onWeaponOverheat","onWeaponFired","targetDistance","calculateDistance","sourcePos","targetPos","projectileId","isHoming","homingStrength","getProjectileSize","targetId","trail","weaponType","spreadRad","updateWeaponStates","updateProjectiles","checkProjectileHits","cleanupProjectiles","updateHomingProjectile","target","predictedPos","targetDirection","currentDirection","homingFactor","newDirection","newLength","calculateDamage","finalDamage","criticalHit","penetrated","shieldsHit","hullHit","onProjectileHit","setTargetingMode","mode","setTargetPosition","setTarget","updateTarget","removeTarget","getWeapon","getAllWeapons","reloadWeapon","renderProjectiles","renderWeaponCharges","trailColor","getProjectileColor","pos1","pos2","weaponsByType","totalWeapons","activeProjectiles","targetsTracked","clearProjectiles","clearTargets","AIBehavior","ShipClass","EnemyAI","weaponSystem","enemies","playerPosition","playerVelocity","playerSize","factionRelations","initializeFactions","factions","faction1","faction2","relation","spawnEnemy","enemy","lastDecisionTime","lastShotTime","weaponCooldowns","waypoint","patrolCenter","patrolRadius","lastDamageTime","onEnemySpawned","shipClass","faction","behavior","updatePlayer","updateEnemy","cleanupDeadEnemies","reactionTime","makeDecision","executeState","updateCombat","distanceToPlayer","inRange","engagementRange","hasLineOfSight","preferredRange","changeState","oldState","generatePatrolWaypoint","generateRetreatWaypoint","onEnemyStateChanged","executePatrol","executePursue","executeAttack","executeEvade","executeRetreat","executeCircleStrafe","executeRamming","moveToward","predictedPlayerPos","predictPlayerPosition","retreatPoint","calculateRetreatPoint","evasionPoint","calculateEvasionPoint","toPlayer","strafeDirection","targetPoint","desiredSpeed","maxSpeed","desiredVelocity","targetRotation","atan2","lerpAngle","turnRate","weaponConfig","cooldownKey","accuracy","intelligence","enemyId","armor","shieldDamage","onEnemyDamaged","destroyEnemy","onEnemyDestroyed","awayFromPlayer","away","perpendicular","diff","renderEnemy","getShipColor","points","getTrianglePoints","drawTriangle","drawShip","drawHealthBar","drawStateIndicator","pirates","aliens","rebels","corporation","military","halfWidth","halfHeight","corners","frontX","frontY","barWidth","barY","healthPercent","healthWidth","healthColor","shieldWidth","patrol","pursue","evade","retreat","ramming","getAllEnemies","getEnemy","enemiesByFaction","enemiesByState","aliveCount","totalEnemies","aliveEnemies","clearEnemies","CombatManager","activeEncounters","combatStats","totalDamageDealt","totalDamageReceived","enemiesDestroyed","shotsHit","shotsFired","encountersCompleted","experienceGained","playerHull","playerMaxHull","handleProjectileHit","enemyAI","handleEnemyDestroyed","initializePlayerWeapons","basicLaser","Energy","mountPoint","hardpointSize","basicProjectile","Projectile","Kinetic","reloadTime","cannon","onPlayerDamaged","hullRemaining","onCombatStatsUpdated","rewards","calculateRewards","checkEncounterCompletion","enemyConfig","Drone","Fighter","Corvette","Frigate","Destroyer","Cruiser","Battleship","randomItem","possibleLoot","lootId","lootItem","startEncounter","encounter","enemyConfigs","spawnPos","spawnPositions","onEncounterStarted","encounterId","completionTime","onEncounterCompleted","generateEncounters","encounters","createEnemyConfig","Aggressive","Kamikaze","credits","dropRate","Evasive","Defensive","Support","classStats","createBasicWeapon","Missile","Plasma","aggression","baseStats","Beam","Torpedo","firePlayerWeapon","startRandomEncounter","randomIndex","getCombatStats","getActiveEncounters","getPlayerWeapons","w","startsWith","getEnemies","clearCombat","resetStats","AttributeType","PlayerProgression","levelExperienceTable","skillExperienceTable","generateExperienceTables","initializeCharacter","initializeSkills","initializeAchievements","baseXP","multiplier","character","experienceToNext","skillPoints","attributePoints","totalPlayTime","enemiesDefeated","systemsExplored","creditsEarned","itemsCrafted","skills","attributes","achievements","attrType","baseValue","maxLevel","bonuses","prerequisite","prerequisiteLevel","skill","current","unlocked","hidden","achievement","addExperience","levelUp","skillPointsGained","attributePointsGained","onLevelUp","addSkillExperience","skillId","requiredXP","onSkillLevelUp","levelUpSkill","prereqSkill","cost","increaseAttribute","attribute","oldValue","recalculateAttribute","onAttributeChanged","addAttributeModifier","modifier","removeAttributeModifier","mod","updateAchievementProgress","req","isAchievementCompleted","unlockAchievement","every","achievementId","unlockedDate","reward","onAchievementUnlocked","updateStatistics","playTime","getSkillBonus","bonusType","bonus","getCategoryBonus","getAttributeValue","getCharacterSheet","getAvailableSkills","getUnlockedAchievements","getAchievementProgress","saveCharacter","loadCharacter","getProgressionStats","totalSkillLevels","highestSkillLevel","totalAttributePoints","attr","achievementsUnlocked","totalAchievements","maxSkillLevels","progressionPercentage","ResearchField","ResearchSystem","projects","facilities","scientists","totalResearchPoints","researchMultipliers","initializeResearchMultipliers","initializeTechnologies","initializeFacilities","initializeScientists","field","tier","researchCost","researchTime","prerequisites","requiredFacilities","unlocks","isUnlocked","isResearching","researchProgress","researchStartTime","tech","specialization","maxProjects","isOperational","currentProjects","maintenanceLevel","upgradeLevel","facility","expertise","isAvailable","fatigue","morale","scientist","startResearch","technologyId","facilityId","scientistIds","technology","prereq","prereqTech","missingPrereq","specializations","validScientists","scientistId","assignedProject","assignedFacility","scientistBonus","fieldMultiplier","estimatedTime","projectId","project","assignedScientists","estimatedCompletion","estimatedHours","totalDuration","completeResearch","makeRandomDiscovery","completedTime","applyTechnologyUnlocks","onTechnologyUnlocked","onResearchCompleted","getTierUnlockCount","onBreakthroughAchieved","unlock","unlockFacility","applyUpgrade","unlockAbility","unlockRecipe","facilityType","quantum_lab","bio_lab","testing_chamber","observatory","upgradeType","abilityId","researchBonus","grantsResources","unlocksTechnology","discovery","discoveryObj","discoveryTime","onDiscoveryMade","getAvailableTechnologies","prereqId","getActiveProjects","getUnlockedTechnologies","getTechnology","getFacilities","getAvailableScientists","getRecentDiscoveries","limit","getResearchStats","fieldProgress","totalTechnologies","unlockedTechnologies","activeProjects","cancelResearch","saveResearchData","loadResearchData","CrewSkill","CrewManagement","crew","traits","shipMorale","disciplineLevel","crewQuarters","managementEvents","initializeTraits","initializeStartingCrew","effects","trait","maxCrew","requiredSkills","assignedCrew","role","species","preferredStation","crewData","createCrewMember","addCrewMember","traitIds","crewId","substr","allSkills","memberTraits","traitId","effect","stress","workEfficiency","preferences","preferredShift","personalityType","workStyle","relationships","rank","commendations","background","homeworld","generateHomeworld","joinDate","roleBackgrounds","captain","pilot","engineer","security","medic","communications","homeworlds","Human","Centaurian","Vulcan","Andorian","speciesWorlds","existingCrew","relationship","calculateInitialRelationship","onCrewJoined","crew1","crew2","assignCrewToStation","currentStation","removeCrewFromStation","calculateWorkEfficiency","updateStationEfficiency","skillTotal","skillCount","skillLevel","totalEfficiency","crewCount","optimalCrew","onStationEfficiencyChanged","updateCrewStatus","updateRelationships","checkCrewEvents","updateShipMorale","stressChange","relationshipStress","relationshipCount","avgRelationship","moraleChange","crewArray","improvement","modifyRelationship","change","crewId1","crewId2","current1","current2","generateCrewEvent","eventTypes","event","generateConflictEvent","generateAchievementEvent","generateDiscoveryEvent","generatePromotionEvent","onCrewEvent","involvedCrew","conflictTypes","conflictType","resolved","eligibleCrew","totalMorale","averageMorale","onMoraleAlert","getCrewMember","getAllCrew","getCrewByRole","getCrewByStation","getStation","getAllStations","getRecentEvents","getCrewStats","totalCrew","totalHealth","totalFatigue","totalStress","roleDistribution","stationEfficiency","averageHealth","averageFatigue","averageStress","saveCrewData","loadCrewData","DiplomacySystem","treaties","negotiations","diplomaticActions","PLAYER_FACTION_ID","initializePlayerFaction","government","ideology","stance","trustLevel","territory","economic","technological","influence","recentActions","personality","cooperation","trustworthiness","pride","greed","xenophobia","lastContact","homeSystem","playerFaction","modifyReputation","factionId","reason","oldReputation","calculateDiplomaticStance","recordDiplomaticAction","actor","reputationChange","successful","onReputationChanged","actionData","targetFaction","startNegotiation","playerOffer","playerSkill","crewBonus","sessionId","reputationModifier","session","participants","currentOffer","proposer","terms","totalValue","calculateOfferValue","priority","calculateOfferPriority","rounds","maxRounds","counterOffer","generateCounterOffer","onNegotiationStarted","playerValue","aiValue","term","playerOfferValue","factionDemand","calculateFactionDemand","counterTerms","difference","giver","receiver","baseDemand","powerRatio","continueNegotiation","acceptCounter","newOffer","applyNegotiationResults","onNegotiationCompleted","acceptChance","calculateAIAcceptanceChance","acceptanceChance","agreedOffer","otherFaction","generateRandomEncounter","activeFactions","f","encounterTypes","encounterType","location","generateEncounterDescription","availableActions","generateEncounterActions","consequences","onEncounterGenerated","descriptions","routine_patrol","distress_call","trade_opportunity","territorial_dispute","first_contact","typeDescriptions","baseActions","skillCheck","resolveEncounterAction","actionId","skillValue","consequence","resolution","getFaction","getAllFactions","getPlayerFaction","getActiveNegotiations","n","getRecentDiplomaticActions","getDiplomacyStats","allied","hostile","avgReputation","totalFactions","alliedFactions","hostileFactions","activeNegotiations","activeTreaties","totalEncounters","averageReputation","saveDiplomacyData","loadDiplomacyData","AlienSpecies","AlienAI","speciesProfiles","knowledgeBase","encounterPatterns","adaptiveBehaviors","initializeSpeciesProfiles","initializeKnowledgeBase","profiles","physiology","lifespan","environment","culture","taboos","rituals","artForms","primary","secondary","linguisticComplexity","translationDifficulty","emotionalRange","weaknesses","uniqueTech","energySource","psychology","emotionalStability","socialComplexity","memoryType","decisionMaking","behaviorPatterns","aggressionTriggers","friendshipFactors","fearFactors","profile","knowledge","physicalTraits","culturalTraits","technologicalCapabilities","communicationMethods","languageComprehension","culturalUnderstanding","technologicalUnderstanding","psychologicalProfile","totalContacts","successfulCommunications","hostileEncounters","peacefulEncounters","researchPoints","discoveredSecrets","lastUpdate","generateEncounter","isFirstContact","phase","calculateInitialIntensity","suspicion","calculateInitialSuspicion","interest","calculateInitialInterest","communicationEstablished","languageBarrier","translationProgress","actions","responses","success","knowledge_gained","technology_exchanged","cultural_insights","onFirstContact","firstContact","positiveRatio","processPlayerAction","actionType","generateActionDescription","complexity","calculateActionComplexity","risk","calculateActionRisk","expectedResponse","predictAlienResponse","culturalContext","response","generateAlienResponse","updateEncounterState","scan","communicate","approach","gift","demonstrate","threaten","probe","responseType","culturalReason","evaluation","evaluateAction","generateResponseDescription","culturalFactor","psychologicalState","determineAlienPsychologicalState","triggers","checkCulturalTriggers","positive","trigger","actionMatchesTrigger","actionMatchesFactor","threat_display","territorial_intrusion","aggressive_scanning","communication_disruption","unknown_entities","peaceful_intentions","cultural_exchange","respect_for_knowledge","technological_sharing","mutual_benefit","speciesName","negative","curious","confused","neutral","states","onCommunicationBreakthrough","updateEncounterPhase","updateKnowledgeBase","oldPhase","onCulturalInsight","getEncounter","getSpeciesProfile","getSpeciesKnowledge","getKnownSpecies","completeEncounter","awardEncounterRewards","knowledgeGained","availableTech","newTech","onTechnologyDiscovered","newSecret","getAlienAIStats","knownSpecies","successfulContacts","totalKnowledge","saveAlienAIData","loadAlienAIData","PerformanceMonitor","metrics","maxHistory","frameStartTime","lastFrameTime","fpsHistory","fpsCounter","fpsTimer","memoryObserver","lastOptimizationCheck","optimizationInterval","thresholds","getDefaultThresholds","getDefaultSettings","currentMetrics","createEmptyMetrics","setupMemoryObserver","startMonitoring","autoOptimize","enableAutoOptimization","PerformanceObserver","list","entryType","observe","entryTypes","updateFrameTiming","updateMemoryUsage","updateSystemMetrics","updateCurrentMetrics","storeMetrics","checkThresholds","performOptimizationCheck","onPerformanceUpdate","frameTime","fps","getAverageFPS","memory","memoryUsed","usedJSHeapSize","memoryTotal","totalJSHeapSize","memoryPercentage","estimateMemoryUsage","estimateTotalMemory","cpuUsage","getBattery","then","battery","batteryLevel","thermalState","estimateThermalState","poor","onThresholdExceeded","recommendations","generateOptimizationRecommendations","onOptimizationRecommended","rec","automaticApply","applyRecommendation","acceptable","particleQuality","postProcessing","high","maxAudioSources","maxRenderDistance","mobileLowPowerMode","audioQuality","recommendation","onSettingsChanged","excellent","good","low","medium","baseSettings","shadowQuality","bloom","antiAliasing","lodBias","physicsSteps","collisionComplexity","adaptiveQuality","activeEntities","textureMemory","setGameMetrics","getCurrentMetrics","getMetricsHistory","cutoff","m","getPerformanceSummary","recentMetrics","averageFPS","minFPS","maxFPS","averageFrameTime","averageMemoryUsage","performanceGrade","updateSettings","newSettings","changes","getSettings","disconnect","ParticleSystem","emitters","nextParticleId","nextEmitterId","maxParticles","qualityScale","enableTrails","enableBloom","pixelPerfect","updateEmitters","cleanupParticles","emitter","onEmitterCompleted","emissionRate","particlesToEmit","fullParticles","fractionalChance","emitParticle","burstCount","oldestId","particleId","spawnPosition","calculateSpawnPosition","calculateSpawnVelocity","randomBetween","sizeRange","generateParticleColor","colorVariation","maxAge","lifeRange","getParticleGravity","bounce","getParticleBounce","getParticleFriction","addParticleAnimations","onParticleSpawned","shape","shapeData","coneAngle","coneRadius","velocityRange","variation","spark","smoke","debris","starfield","warp_trail","beam","variationAmount","sizeAnimation","startSize","endSize","alphaAnimation","startAlpha","endAlpha","dt","updateParticlePhysics","updateParticleAnimations","applyEasing","lerp","colorAnimation","startColor","endColor","onParticleDied","createLaserBeam","updateEmitterPosition","stopEmitter","renderParticle","activeParticles","activeEmitters","Game","galaxyManager","cockpitStatusBar","celestialManager","spaceBackground","inventoryManager","craftingSystem","combatManager","playerProgression","researchSystem","crewManagement","diplomacySystem","alienAI","proceduralAudio","performanceMonitor","particleSystem","isRunning","isPaused","lastTime","lastFpsUpdate","performanceStats","renderTime","updateTime","memoryUsage","perfLogger","platformConfig","enableDebug","enablePerformanceMonitoring","initializeSystems","stateManager","zoomLevel","oldRep","newRep","method","insight","metric","threshold","gameLoop","updatePerformanceStats","handleError","requestAnimationFrame","Engineering","Weapons","currentStatus","Engines","warpState","playerPos","randomFaction","Laser","Explosion","tracks","nextTrack","summary","randomCrew","availableStation","Paused","Playing","warpDistortion","audioStats","renderDebugInfo","debugInfo","pause","getPaused","starObj","planetPos","planetObj","planet1","planet2","recoveryError","saveGame","getIsPaused","isGameRunning","getPerformanceStats","getRenderer","getInput","getPhysics","getAudio","getStateManager","game","LoadingManager","currentProgress","progressElement","getElementById","textElement","updateProgress","textContent","hide","loadingScreen","classList","display","initializeGame","loader","adjustCanvasForMobile","preloadCriticalResources","progressInterval","loadingText","loadingBar","errorDetails","createElement","cssText","innerHTML","appendChild","showErrorScreen","containerRect","targetRatio","readyState"],"mappings":"+rBAKO,IAAKA,GAAAA,IACRA,EAAA,QAAU,UACVA,EAAA,OAAS,SACTA,EAAA,IAAM,MACNA,EAAA,MAAQ,QACRA,EAAA,QAAU,UALFA,IAAAA,GAAA,CAAA,GAkBL,MAAMC,EAAN,MAOH,aAAOC,GACH,OAAIC,KAAKC,eACED,KAAKC,eAIXC,OAAeC,WAChBH,KAAKC,eAAiB,QACfD,KAAKC,gBAIXC,OAAeE,SAChBJ,KAAKC,eAAiB,UACfD,KAAKC,gBAIZD,KAAKK,YACLL,KAAKC,eAAiB,SACfD,KAAKC,gBAIZD,KAAKM,aACLN,KAAKC,eAAiB,UACfD,KAAKC,iBAIhBD,KAAKC,eAAiB,MACfD,KAAKC,eAChB,CAKA,kBAAOM,GACH,GAAIP,KAAKQ,eACL,OAAOR,KAAKQ,eAGhB,MAAMC,EAAWT,KAAKD,SAYtB,OAVAC,KAAKQ,eAAiB,CAClBE,YAAaV,KAAKU,YAAYD,GAC9BE,SAAUX,KAAKW,WACfC,cAAeZ,KAAKY,cAAcH,GAClCI,cAAeb,KAAKa,gBACpBC,WAAYd,KAAKc,aACjBC,qBAAsBf,KAAKgB,kBAAkBP,GAC7CQ,YAAajB,KAAKkB,eAAeT,IAG9BT,KAAKQ,cAChB,CAKA,eAAeH,GAEX,MAAMc,EAAYC,UAAUD,WAAaC,UAAUC,QAAWnB,OAAeoB,MAI7E,GADoB,iEACJC,KAAKJ,GACjB,OAAO,EAIX,MAAMR,EAAW,iBAAkBT,QAAUkB,UAAUI,eAAiB,EAClEC,EAAcvB,OAAOwB,YAAc,KAAOxB,OAAOyB,aAAe,IAEtE,OAAOhB,GAAYc,CACvB,CAKA,gBAAenB,GAEX,MAAMI,GAAeV,KAAKK,WACpBuB,EAAc1B,OAAOwB,WAAa,KAAOxB,OAAOyB,YAAc,IAG9DR,EAAYC,UAAUD,UACtBU,EAAY,qBAAqBN,KAAKJ,GAE5C,OAAOT,GAAekB,GAAeC,CACzC,CAKA,kBAAenB,CAAYD,GACvB,OAAQA,GACJ,IAAK,UACL,IAAK,QAOL,QACI,OAAO,EANX,IAAK,SACL,IAAK,UACD,OAAO,EACX,IAAK,MACD,OAAQT,KAAKK,WAIzB,CAKA,eAAeM,GACX,MAAO,iBAAkBT,QAAUkB,UAAUI,eAAiB,CAClE,CAKA,oBAAeZ,CAAcH,GACzB,OAAQA,GACJ,IAAK,QACL,IAAK,UACD,OAAO,EACX,QACI,OAAO,EAEnB,CAKA,oBAAeI,GACX,SACIiB,SAASC,mBACRD,SAAiBE,yBACjBF,SAAiBG,sBACjBH,SAAiBI,oBAE1B,CAKA,iBAAepB,GACX,MAAO,YAAaM,SACxB,CAKA,wBAAeJ,CAAkBP,GAC7B,OAAQA,GACJ,IAAK,UACL,IAAK,QACD,MAAO,WACX,IAAK,SACL,IAAK,UACD,MAAO,QACX,IAAK,MACD,OAAOT,KAAKW,WAAa,SAAW,WACxC,QACI,MAAO,SAEnB,CAKA,qBAAeO,CAAeT,GAC1B,OAAQA,GACJ,IAAK,QACL,IAAK,UACD,MAAO,aACX,IAAK,UACL,IAAK,SACL,IAAK,MACD,MAAO,YACX,QACI,MAAO,eAEnB,CAKA,gBAAO0B,GACH,MAAM1B,EAAWT,KAAKD,SAChBqC,EAAWpC,KAAKO,cAEtB,MAAO,CACHE,WACA2B,WACAC,OAAQ,CAEJC,WAAYpC,OAAOqC,kBAAoB,EACvCC,SAAUJ,EAASzB,SAAW,IAAM,KACpC8B,UAAWL,EAASzB,SAAW,IAAM,IACrC+B,YAAaN,EAASzB,SAAW,MAAQ,UAE7CgC,MAAO,CAEHC,eAAgBR,EAAS1B,YACzBmC,YAAaT,EAASzB,SACtBmC,cAA4B,YAAbrC,GAA8C,UAAbA,EAChDsC,iBAAkBX,EAASzB,SAAW,EAAM,EAC5CqC,eAAgB,IAChBC,cAAe,IAEnBC,YAAa,CAETC,UAAwB,WAAb1C,EAA+B,GAAK,GAC/C2C,gBAA8B,WAAb3C,EACjB4C,qBAAmC,YAAb5C,GAA8C,UAAbA,EACvD6C,cAA4B,YAAb7C,EACf8C,iBAAiB,EACjBC,YAAapB,EAASzB,SAAW,GAAM,GAE3C8C,MAAO,CAEHC,aAAa,EACbC,aAAa,EACbC,WAAW,EACXC,mBAAiC,YAAbpD,EACpBqD,YAAa,OACbC,YAA0B,WAAbtD,EAA+B,EAAI,IAEpDuD,QAAS,CAELC,KAAM7B,EAASnB,YACfiD,gBAAgB,EAChBC,aAAc,IACdC,aAA2B,WAAb3D,EAA+B,EAAI,GACjD4D,oBAAoB,GAGhC,CAKA,eAAOC,CAASC,GACZ,OAAOC,QAAQxE,KAAKO,cAAcgE,GACtC,CAKA,sBAAOE,GACH,OAAQzE,KAAKD,UACT,IAAK,UACD,MAAO,kBACX,IAAK,SACD,MAAO,iBACX,IAAK,MACD,MAAO,cACX,IAAK,QACD,MAAO,sBACX,IAAK,UACD,MAAO,qBACX,QACI,MAAO,mBAEnB,CAKA,YAAO2E,GACH1E,KAAKC,eAAiB,KACtBD,KAAKQ,eAAiB,IAC1B,GAtRAV,EAAeG,eAAkC,KACjDH,EAAeU,eAA0C,KAFtD,IAAMmE,EAAN7E,EClBA,IAAK8E,GAAAA,IACRA,EAAAA,QAAQ,GAAR,QACAA,EAAAA,OAAO,GAAP,OACAA,EAAAA,OAAO,GAAP,OACAA,EAAAA,QAAQ,GAAR,QACAA,EAAAA,WAAW,GAAX,WALQA,IAAAA,GAAA,CAAA,GAiBL,MAAMC,EAAN,MAAMA,EAST,WAAAC,CAAYC,GACR/E,KAAK+E,OAASA,CAClB,CAKA,gBAAOC,CAAUC,QAMQ,IAAjBA,EAAOC,QAAqBL,EAAOM,YAAcF,EAAOC,YAClC,IAAtBD,EAAOG,aAA0BP,EAAOO,WAAaH,EAAOG,iBACnC,IAAzBH,EAAOI,gBAA6BR,EAAOQ,cAAgBJ,EAAOI,oBACzC,IAAzBJ,EAAOK,gBAA6BT,EAAOS,cAAgBL,EAAOK,cAC1E,CAKA,eAAOC,CAASL,GACZL,EAAOM,YAAcD,CACzB,CAKA,KAAAM,CAAMC,EAAiBC,GACnB1F,KAAK2F,IAAI,EAAgBF,EAASC,EACtC,CAKA,IAAAE,CAAKH,EAAiBC,GAClB1F,KAAK2F,IAAI,EAAeF,EAASC,EACrC,CAKA,IAAAG,CAAKJ,EAAiBC,GAClB1F,KAAK2F,IAAI,EAAeF,EAASC,EACrC,CAKA,KAAAI,CAAML,EAAiBK,GACnB,IAAIC,EACAL,EAAOI,EAEPA,aAAiBE,QACjBD,EAAQD,EAAMC,MACdL,EAAO,CACHO,KAAMH,EAAMG,KACZR,QAASK,EAAML,QACfM,MAAOD,EAAMC,QAIrB/F,KAAK2F,IAAI,EAAgBF,EAASC,EAAMK,EAC5C,CAKA,QAAAG,CAAST,EAAiBK,GACtB,IAAIC,EACAL,EAAOI,EAEPA,aAAiBE,QACjBD,EAAQD,EAAMC,MACdL,EAAO,CACHO,KAAMH,EAAMG,KACZR,QAASK,EAAML,QACfM,MAAOD,EAAMC,QAIrB/F,KAAK2F,IAAI,EAAmBF,EAASC,EAAMK,EAC/C,CAKQ,GAAAJ,CAAIT,EAAiBO,EAAiBC,EAAYK,GAEtD,GAAIb,EAAQL,EAAOM,YACf,OAGJ,MAAMgB,EAAkB,CACpBC,UAAWC,KAAKC,MAChBpB,QACAH,OAAQ/E,KAAK+E,OACbU,UACAC,OACAK,SAIJlB,EAAO0B,SAASJ,GAGZtB,EAAOQ,eACPR,EAAO2B,gBAAgBL,GAIvBtB,EAAOS,eACPT,EAAO4B,WAAWN,EAE1B,CAKA,eAAeI,CAASJ,GACpBnG,KAAK0G,QAAQC,KAAKR,GAGdnG,KAAK0G,QAAQE,OAAS5G,KAAKoF,YAC3BpF,KAAK0G,QAAQG,OAErB,CAKA,sBAAeL,CAAgBL,GAC3B,MAEMW,EAAS,IAFG,IAAIT,KAAKF,EAAMC,WAAWW,mBAC1BnC,EAASuB,EAAMjB,YACgBiB,EAAMpB,UAGvD,IAAIiC,EACAC,EAAQ,GAEZ,OAAQd,EAAMjB,OACV,KAAK,EACD8B,EAAgB,QAChBC,EAAQ,gCACR,MACJ,KAAK,EACDD,EAAgB,MAChBC,EAAQ,kCACR,MACJ,KAAK,EACDD,EAAgB,OAChBC,EAAQ,kCACR,MACJ,KAAK,EACDD,EAAgB,QAChBC,EAAQ,kCACR,MACJ,KAAK,EACDD,EAAgB,QAChBC,EAAQ,oDACR,MACJ,QACID,EAAgB,WAIL,IAAfb,EAAMT,KACNwB,QAAQF,GAAe,KAAKF,KAAUX,EAAMV,UAAWwB,EAAOd,EAAMT,MAEpEwB,QAAQF,GAAe,KAAKF,KAAUX,EAAMV,UAAWwB,IAIvDd,EAAMJ,OAA0B,IAAhBI,EAAMjB,OAA4C,IAAhBiB,EAAMjB,QACxDgC,QAAQC,eAAe,eACvBD,QAAQpB,MAAMK,EAAMJ,OACpBmB,QAAQE,WAEhB,CAKA,uBAAqBX,CAAWN,GAC5B,IAEI,MAAMkB,EAASC,aAAaC,QAAQ,sBAC9BC,EAAOH,EAASI,KAAKC,MAAML,GAAU,GAE3CG,EAAKb,KAAKR,GAGNqB,EAAKZ,OAAS5G,KAAKoF,YACnBoC,EAAKG,OAAO,EAAGH,EAAKZ,OAAS5G,KAAKoF,YAGtCkC,aAAaM,QAAQ,qBAAsBH,KAAKI,UAAUL,GAC9D,OAAS1B,GAELoB,QAAQrB,KAAK,6BAA8BC,EAC/C,CACJ,CAKA,iBAAOgC,GACH,MAAO,IAAI9H,KAAK0G,QACpB,CAKA,wBAAOqB,CAAkB7C,GACrB,OAAOlF,KAAK0G,QAAQsB,OAAO7B,GAASA,EAAMjB,QAAUA,EACxD,CAKA,yBAAO+C,CAAmBlD,GACtB,OAAO/E,KAAK0G,QAAQsB,OAAO7B,GAASA,EAAMpB,SAAWA,EACzD,CAKA,YAAOmD,GAGH,GAFAlI,KAAK0G,QAAU,GAEX1G,KAAKsF,cACL,IACIgC,aAAaa,WAAW,qBAC5B,OAASrC,GAET,CAER,CAKA,aAAO,GACH,OAAO2B,KAAKI,UAAU,CAClBO,UAAA,IAAc/B,MAAOU,cACrBtG,SAAUW,UAAUD,UACpBuF,QAAS1G,KAAK0G,SACf,KAAM,EACb,CAKA,4BAAa2B,GACT,IACI,MAAMhB,EAASC,aAAaC,QAAQ,sBACpC,GAAIF,EAAQ,CACR,MAAMG,EAAOC,KAAKC,MAAML,GACxBrH,KAAK0G,QAAUc,EAAKc,OAAOtI,KAAKoF,WACpC,CACJ,OAASU,GACLoB,QAAQrB,KAAK,oCAAqCC,EACtD,CACJ,CAyDA,uBAAAyC,GACI,MAAO,CACHC,MAAQvC,GAAiBpB,EAAO3B,YAAYsF,MAAM,GAAGxI,KAAK+E,UAAUkB,KACpEwC,IAAMxC,GAAiBpB,EAAO3B,YAAYuF,IAAI,GAAGzI,KAAK+E,UAAUkB,IAAQjG,MACxE0I,QAAS,CAAIzC,EAAc0C,IACvB9D,EAAO3B,YAAYwF,QAAQ,GAAG1I,KAAK+E,UAAUkB,IAAQ0C,EAAI3I,MAC7D4I,aAAc,CAAI3C,EAAc0C,IAC5B9D,EAAO3B,YAAY0F,aAAa,GAAG5I,KAAK+E,UAAUkB,IAAQ0C,EAAI3I,MAE1E,GAlVA6E,EAAeM,YAAwB,EACvCN,EAAe6B,QAAsB,GACrC7B,EAAeO,WAAa,IAC5BP,EAAeQ,eAAgB,EAC/BR,EAAeS,eAAgB,EAiR/BT,EAAO3B,YAAc,CACjB2F,WAAYC,IAEZ,KAAAN,CAAMvC,GACFjG,KAAK6I,OAAOE,IAAI9C,EAAM/C,YAAYoD,MACtC,EAEA,GAAAmC,CAAIxC,EAAc+C,GACd,MAAMC,EAAYjJ,KAAK6I,OAAOK,IAAIjD,GAClC,QAAkB,IAAdgD,EAEA,OADA/B,QAAQrB,KAAK,UAAUI,sBAChB,EAGX,MAAMkD,EAAWjG,YAAYoD,MAAQ2C,EAOrC,OANAjJ,KAAK6I,OAAOO,OAAOnD,GAEf+C,GACAA,EAAOxD,MAAM,gBAAgBS,UAAakD,EAASE,QAAQ,QAGxDF,CACX,EAEA,OAAAT,CAAWzC,EAAc0C,EAAaK,GAClChJ,KAAKwI,MAAMvC,GACX,IACI,MAAMqD,EAASX,IAEf,OADA3I,KAAKyI,IAAIxC,EAAM+C,GACRM,CACX,OAASxD,GAEL,MADA9F,KAAKyI,IAAIxC,EAAM+C,GACTlD,CACV,CACJ,EAEA,kBAAM8C,CAAgB3C,EAAc0C,EAAsBK,GACtDhJ,KAAKwI,MAAMvC,GACX,IACI,MAAMqD,QAAeX,IAErB,OADA3I,KAAKyI,IAAIxC,EAAM+C,GACRM,CACX,OAASxD,GAEL,MADA9F,KAAKyI,IAAIxC,EAAM+C,GACTlD,CACV,CACJ,GApUD,IAAMyD,EAAN1E,EA8VH0E,EAAOvE,UAAU,CACbE,MAAO,EACPG,eAAe,EACfC,eAAe,IAKvBiE,EAAOlB,kBCzVA,MAAMmB,EA2BT,WAAA1E,CAAYzC,EAA2B5B,GApBvCT,KAAQyJ,GAAmC,KAC3CzJ,KAAQ0J,mBAAgDZ,IAGxD9I,KAAQ2J,aAAwB,GAOhC3J,KAAQ4J,YAAc,CAClBC,UAAW,EACXC,UAAW,EACXC,QAAS,EACTC,UAAW,GAMXhK,KAAKqC,OAASA,EACdrC,KAAKS,SAAWA,EAChBT,KAAKgJ,OAAS,IAAIO,EAAO,YAGzB,MAAMU,EAAM5H,EAAO6H,WAAW,MAC9B,IAAKD,EACD,MAAM,IAAIjE,MAAM,sCAEpBhG,KAAKiK,IAAMA,EAGXjK,KAAKiF,OAAS,CACV3C,WAAYpC,OAAOqC,kBAAoB,EACvC4H,oBAAoB,EACpB5G,iBAAiB,EACjB6G,UAAW3J,IAAaZ,EAASwK,OACjChH,qBAAsB5C,IAAaZ,EAASyK,QAC5CC,gBAAiB,WAGrBvK,KAAKgJ,OAAOpD,KAAK,0BAA2B,CACxC4E,WAAY,GAAGnI,EAAOoI,SAASpI,EAAOqI,SACtCjK,WACAwE,OAAQjF,KAAKiF,QAErB,CAKA,gBAAM0F,GACF3K,KAAKgJ,OAAOpD,KAAK,+BAEjB,IAEI5F,KAAK4K,0BAGL5K,KAAK6K,wBAGD7K,KAAKiF,OAAOmF,WAAapK,KAAKiF,OAAO5B,uBACrCrD,KAAK8K,kBAIT9K,KAAK+K,sBAEL/K,KAAKgJ,OAAOpD,KAAK,sCAErB,OAASE,GAEL,MADA9F,KAAKgJ,OAAOlD,MAAM,mCAAoCA,GAChDA,CACV,CACJ,CAKQ,uBAAA8E,GAEJ5K,KAAKiK,IAAIe,uBAAwB,EAChChL,KAAKiK,IAAYgB,6BAA8B,EAC/CjL,KAAKiK,IAAYiB,0BAA2B,EAC5ClL,KAAKiK,IAAYkB,yBAA0B,EAG5C,MAAMC,EAAQpL,KAAKiF,OAAO3C,WAC1BtC,KAAKqC,OAAO4E,MAAMwD,MAAQ,GAAGzK,KAAKqC,OAAOoI,UACzCzK,KAAKqC,OAAO4E,MAAMyD,OAAS,GAAG1K,KAAKqC,OAAOqI,WAC1C1K,KAAKqC,OAAOoI,OAASW,EACrBpL,KAAKqC,OAAOqI,QAAUU,EACtBpL,KAAKiK,IAAImB,MAAMA,EAAOA,GAEtBpL,KAAKgJ,OAAOxD,MAAM,gDAAiD,CAC/D4F,QACAC,KAAM,GAAGrL,KAAKqC,OAAOoI,SAASzK,KAAKqC,OAAOqI,UAElD,CAKQ,oBAAAG,GACJ7K,KAAK2J,aAAe,CAEhB,CAAE2B,EAAG,EAAGC,EAAG,EAAGC,EAAG,GACjB,CAAEF,EAAG,EAAGC,EAAG,EAAGC,EAAG,GACjB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAGnB,CAAEF,EAAG,EAAGC,EAAG,GAAIC,EAAG,GAClB,CAAEF,EAAG,EAAGC,EAAG,GAAIC,EAAG,GAClB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAGnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,GACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,GACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAGnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,GACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,GACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,IAAKC,EAAG,GAAIC,EAAG,IAGpB,CAAEF,EAAG,GAAIC,EAAG,EAAGC,EAAG,GAClB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAGnB,CAAEF,EAAG,EAAGC,EAAG,GAAIC,EAAG,IAClB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAGnB,CAAEF,EAAG,EAAGC,EAAG,GAAIC,EAAG,IAClB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAGnB,CAAEF,EAAG,GAAIC,EAAG,EAAGC,EAAG,IAClB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAGnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAGvBxL,KAAKgJ,OAAOxD,MAAM,kDAAkDxF,KAAK2J,aAAa/C,gBAC1F,CAKQ,eAAAkE,GACJ,IACI9K,KAAKyJ,GAAKzJ,KAAKqC,OAAO6H,WAAW,UAAYlK,KAAKqC,OAAO6H,WAAW,sBAEhElK,KAAKyJ,GACLzJ,KAAKgJ,OAAOpD,KAAK,mDAGjB5F,KAAKgJ,OAAOnD,KAAK,0DACjB7F,KAAKiF,OAAOmF,WAAY,EACxBpK,KAAKiF,OAAO5B,sBAAuB,EAE3C,OAASyC,GACL9F,KAAKgJ,OAAOnD,KAAK,iCAAkCC,GACnD9F,KAAKyJ,GAAK,KACVzJ,KAAKiF,OAAOmF,WAAY,EACxBpK,KAAKiF,OAAO5B,sBAAuB,CACvC,CACJ,CAKQ,mBAAA0H,GACJ,MAAMN,EAAQzK,KAAKqC,OAAOoI,MACpBC,EAAS1K,KAAKqC,OAAOqI,OAE3B1K,KAAKyL,WAAazL,KAAKiK,IAAIyB,gBAAgBjB,EAAOC,GAClD1K,KAAK2L,YAAc3L,KAAKiK,IAAIyB,gBAAgBjB,EAAOC,GAGnD1K,KAAK4L,YAAY5L,KAAKyL,WAAYzL,KAAK6L,WAAW7L,KAAKiF,OAAOsF,kBAE9DvK,KAAKgJ,OAAOxD,MAAM,yBAA0B,CAAEiF,QAAOC,UACzD,CAKA,UAAAoB,GAEI9L,KAAK4J,YAAYC,UAAY,EAC7B7J,KAAK4J,YAAYE,UAAY,EAC7B9J,KAAK4J,YAAYG,QAAU,EAC3B/J,KAAK4J,YAAYI,UAAY,EAG7BhK,KAAKiK,IAAI8B,UAAY/L,KAAKiF,OAAOsF,gBACjCvK,KAAKiK,IAAI+B,SAAS,EAAG,EAAGhM,KAAKqC,OAAOoI,MAAOzK,KAAKqC,OAAOqI,QAGvD1K,KAAK4L,YAAY5L,KAAKyL,WAAYzL,KAAK6L,WAAW7L,KAAKiF,OAAOsF,iBAClE,CAKA,QAAA0B,GAEQjM,KAAKiF,OAAO1B,iBACZvD,KAAKkM,eAAelM,KAAKyL,YAI7BzL,KAAKiK,IAAIkC,aAAanM,KAAKyL,WAAY,EAAG,GAGtCzL,KAAKiF,OAAOmF,WAAapK,KAAKyJ,IAC9BzJ,KAAKoM,iBAGTpM,KAAK4J,YAAYC,WACrB,CAKQ,WAAA+B,CAAYS,EAAmBC,GACnC,MAAM5G,EAAO2G,EAAO3G,KACpB,IAAA,IAAS6G,EAAI,EAAGA,EAAI7G,EAAKkB,OAAQ2F,GAAK,EAClC7G,EAAK6G,GAAKD,EAAMhB,EAChB5F,EAAK6G,EAAI,GAAKD,EAAMf,EACpB7F,EAAK6G,EAAI,GAAKD,EAAMd,EACpB9F,EAAK6G,EAAI,QAAiB,IAAZD,EAAME,EAAkBF,EAAME,EAAI,GAExD,CAKA,QAAAC,CAASC,EAAWC,EAAWL,GAI3B,GAHAI,EAAIE,KAAKC,MAAMH,GACfC,EAAIC,KAAKC,MAAMF,GAEXD,EAAI,GAAKA,GAAK1M,KAAKqC,OAAOoI,OAASkC,EAAI,GAAKA,GAAK3M,KAAKqC,OAAOqI,OAC7D,OAGJ,MAAMoC,EAAsC,GAA7BH,EAAI3M,KAAKqC,OAAOoI,MAAQiC,GACjChH,EAAO1F,KAAKyL,WAAW/F,KAE7BA,EAAKoH,GAASR,EAAMhB,EACpB5F,EAAKoH,EAAQ,GAAKR,EAAMf,EACxB7F,EAAKoH,EAAQ,GAAKR,EAAMd,EACxB9F,EAAKoH,EAAQ,QAAiB,IAAZR,EAAME,EAAkBF,EAAME,EAAI,GACxD,CAKA,QAAAR,CAASU,EAAWC,EAAWlC,EAAeC,EAAgB4B,GAC1D,IAAA,IAASS,EAAKJ,EAAGI,EAAKJ,EAAIjC,EAAQqC,IAC9B,IAAA,IAASC,EAAKN,EAAGM,EAAKN,EAAIjC,EAAOuC,IAC7BhN,KAAKyM,SAASO,EAAID,EAAIT,GAG9BtM,KAAK4J,YAAYC,WACrB,CAKA,QAAAoD,CAASC,EAAYC,EAAYC,EAAYC,EAAYf,GACrDY,EAAKN,KAAKC,MAAMK,GAChBC,EAAKP,KAAKC,MAAMM,GAChBC,EAAKR,KAAKC,MAAMO,GAChBC,EAAKT,KAAKC,MAAMQ,GAEhB,MAAMC,EAAKV,KAAKW,IAAIH,EAAKF,GACnBM,EAAKZ,KAAKW,IAAIF,EAAKF,GACnBM,EAAKP,EAAKE,EAAK,GAAI,EACnBM,EAAKP,EAAKE,EAAK,GAAI,EACzB,IAAIM,EAAML,EAAKE,EAEXd,EAAIQ,EACJP,EAAIQ,EAER,KACInN,KAAKyM,SAASC,EAAGC,EAAGL,GAEhBI,IAAMU,GAAMT,IAAMU,GAHb,CAKT,MAAMO,EAAK,EAAID,EACXC,GAAMJ,IACNG,GAAOH,EACPd,GAAKe,GAELG,EAAKN,IACLK,GAAOL,EACPX,GAAKe,EAEb,CAEA1N,KAAK4J,YAAYC,WACrB,CAKA,UAAAgE,CAAWC,EAAiBC,EAAiBC,EAAgB1B,EAAc2B,GAAkB,GAKzF,GAJAH,EAAUlB,KAAKC,MAAMiB,GACrBC,EAAUnB,KAAKC,MAAMkB,GACrBC,EAASpB,KAAKC,MAAMmB,GAEhBC,EAEA,IAAA,IAAStB,GAAKqB,EAAQrB,GAAKqB,EAAQrB,IAC/B,IAAA,IAASD,GAAKsB,EAAQtB,GAAKsB,EAAQtB,IAC3BA,EAAIA,EAAIC,EAAIA,GAAKqB,EAASA,GAC1BhO,KAAKyM,SAASqB,EAAUpB,EAAGqB,EAAUpB,EAAGL,OAIjD,CAEH,IAAII,EAAI,EACJC,EAAIqB,EACJE,EAAI,EAAI,EAAIF,EAEhB,KAAOrB,GAAKD,GAER1M,KAAKyM,SAASqB,EAAUpB,EAAGqB,EAAUpB,EAAGL,GACxCtM,KAAKyM,SAASqB,EAAUpB,EAAGqB,EAAUpB,EAAGL,GACxCtM,KAAKyM,SAASqB,EAAUpB,EAAGqB,EAAUpB,EAAGL,GACxCtM,KAAKyM,SAASqB,EAAUpB,EAAGqB,EAAUpB,EAAGL,GACxCtM,KAAKyM,SAASqB,EAAUnB,EAAGoB,EAAUrB,EAAGJ,GACxCtM,KAAKyM,SAASqB,EAAUnB,EAAGoB,EAAUrB,EAAGJ,GACxCtM,KAAKyM,SAASqB,EAAUnB,EAAGoB,EAAUrB,EAAGJ,GACxCtM,KAAKyM,SAASqB,EAAUnB,EAAGoB,EAAUrB,EAAGJ,GAExCI,IACIwB,EAAI,GACJvB,IACAuB,EAAIA,EAAI,GAAKxB,EAAIC,GAAK,IAEtBuB,EAAIA,EAAI,EAAIxB,EAAI,CAG5B,CAEA1M,KAAK4J,YAAYC,WACrB,CAKA,UAAAsE,CAAWC,EAAc1B,EAAWC,EAAWL,EAAcjB,EAAe,IAExErL,KAAKiK,IAAIoE,OAGTrO,KAAKiK,IAAIqE,KAAO,GAAGjD,+BACnBrL,KAAKiK,IAAI8B,UAAY/L,KAAKuO,WAAWjC,GACrCtM,KAAKiK,IAAIuE,aAAe,MAGxBxO,KAAKiK,IAAIwE,YAAczO,KAAKuO,WAAWjC,GACvCtM,KAAKiK,IAAIyE,WAAa,EAGtB1O,KAAKiK,IAAI0E,SAASP,EAAM1B,EAAGC,GAG3B3M,KAAKiK,IAAI2E,UAET5O,KAAK4J,YAAYC,WACrB,CAKA,eAAAgF,CAAgBC,EAAiBpC,EAAWC,GACxC,MAEMoC,EAAY,CAAEzD,EAAG,EAAGC,EAAG,IAAKC,EAAG,GAG/BhJ,EAAyD,EAA9CoK,KAAKoC,OAAOF,EAAMG,IAAIC,GAAQA,EAAKtI,SACpD5G,KAAKgM,SAASU,EAAI,EAAGC,EAAI,EAAGnK,EAAW,EANpB,GAMuBsM,EAAMlI,OAAsB,EAL9C,CAAE0E,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAAGgB,EAAG,MAQ/CsC,EAAMK,QAAQ,CAACD,EAAMpC,KACjB9M,KAAKmO,WAAWe,EAAMxC,EAAGC,EAVV,GAUcG,EAAoBiC,EAAW,KAEpE,CAKA,kBAAAK,CAAmBnL,EAAmCoH,EAAe,IACjE,MAAMgE,EAAYrP,KAAKiK,IAAIyB,gBAAgBL,EAAMA,GAC3C3F,EAAO2J,EAAU3J,KAGvB,IAAA,IAAS6G,EAAI,EAAGA,EAAI7G,EAAKkB,OAAQ2F,GAAK,EAClC7G,EAAK6G,EAAI,GAAK,EAIlB,IAAI+C,EACJ,OAAQrL,GACJ,IAAK,SACDqL,EAAY,CAAEhE,EAAG,EAAGC,EAAG,IAAKC,EAAG,GAC/B,MACJ,IAAK,QACD8D,EAAY,CAAEhE,EAAG,IAAKC,EAAG,EAAGC,EAAG,GAC/B,MACJ,IAAK,OACD8D,EAAY,CAAEhE,EAAG,EAAGC,EAAG,IAAKC,EAAG,KAKvC,MAAMsC,EAAUzC,EAAO,EACjB0C,EAAU1C,EAAO,EAGvB,IAAA,IAASsB,EAAI,EAAGA,EAAItB,EAAMsB,IACtB,IAAA,IAASD,EAAI,EAAGA,EAAIrB,EAAMqB,IAAK,CAC3B,MAAMY,EAAKZ,EAAIoB,EACTN,EAAKb,EAAIoB,EAGf,GAAIP,EAAgB,IAAVO,GAAiBP,EAAe,GAAVO,EAAe,CAC3C,MAAMtD,EAA+B,IAAZ,GAAVsD,EAAgBP,GAC/B,GAAIZ,KAAKW,IAAID,GAAM7C,EAAO,CACtB,MAAMqC,EAAyB,GAAhBH,EAAItB,EAAOqB,GAC1BhH,EAAKoH,GAASwC,EAAUhE,EACxB5F,EAAKoH,EAAQ,GAAKwC,EAAU/D,EAC5B7F,EAAKoH,EAAQ,GAAKwC,EAAU9D,EAC5B9F,EAAKoH,EAAQ,GAAK,GACtB,CACJ,CACJ,CAIJ,OADA9M,KAAK4J,YAAYG,UACV,CACHrE,KAAM2J,EACN5E,MAAOY,EACPX,OAAQW,EAEhB,CAKA,UAAAkE,CAAWC,EAAgB9C,EAAWC,GAClC3M,KAAKiK,IAAIkC,aAAaqD,EAAO9J,KAAMgH,EAAGC,GACtC3M,KAAK4J,YAAYG,SACrB,CAKQ,cAAAmC,CAAeG,GACnB,IAAKrM,KAAKiF,OAAO1B,gBAAiB,OAElC,MAAMmC,EAAO2G,EAAO3G,KACd+E,EAAQ4B,EAAO5B,MACfC,EAAS2B,EAAO3B,OAGtB,IAAA,IAASiC,EAAI,EAAGA,EAAIjC,EAAS,EAAGiC,IAC5B,IAAA,IAASD,EAAI,EAAGA,EAAIjC,EAAQ,EAAGiC,IAAK,CAChC,MAAMI,EAA0B,GAAjBH,EAAIlC,EAAQiC,GAGrB+C,EAAO/J,EAAKoH,GACZ4C,EAAOhK,EAAKoH,EAAQ,GACpB6C,EAAOjK,EAAKoH,EAAQ,GAGpB8C,EAAW5P,KAAK6P,wBAAwB,CAAEvE,EAAGmE,EAAMlE,EAAGmE,EAAMlE,EAAGmE,IAGrEjK,EAAKoH,GAAS8C,EAAStE,EACvB5F,EAAKoH,EAAQ,GAAK8C,EAASrE,EAC3B7F,EAAKoH,EAAQ,GAAK8C,EAASpE,EAG3B,MAAMsE,EAASL,EAAOG,EAAStE,EACzByE,EAASL,EAAOE,EAASrE,EACzByE,EAASL,EAAOC,EAASpE,EAG/BxL,KAAKiQ,gBAAgBvK,EAAM+E,EAAOiC,EAAI,EAAGC,EAAGmD,EAAQC,EAAQC,EAAQ,EAAE,IACtEhQ,KAAKiQ,gBAAgBvK,EAAM+E,EAAOiC,EAAI,EAAGC,EAAI,EAAGmD,EAAQC,EAAQC,EAAQ,EAAE,IAC1EhQ,KAAKiQ,gBAAgBvK,EAAM+E,EAAOiC,EAAGC,EAAI,EAAGmD,EAAQC,EAAQC,EAAQ,EAAE,IACtEhQ,KAAKiQ,gBAAgBvK,EAAM+E,EAAOiC,EAAI,EAAGC,EAAI,EAAGmD,EAAQC,EAAQC,EAAQ,EAAE,GAC9E,CAER,CAKQ,eAAAC,CAAgBvK,EAAyB+E,EAAeiC,EAAWC,EACrDmD,EAAgBC,EAAgBC,EAAgBE,GAClE,MAAMpD,EAA0B,GAAjBH,EAAIlC,EAAQiC,GACvBI,GAAS,GAAKA,EAAQpH,EAAKkB,OAAS,IACpClB,EAAKoH,GAASF,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAKzK,EAAKoH,GAASgD,EAASI,IAC/DxK,EAAKoH,EAAQ,GAAKF,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAKzK,EAAKoH,EAAQ,GAAKiD,EAASG,IACvExK,EAAKoH,EAAQ,GAAKF,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAKzK,EAAKoH,EAAQ,GAAKkD,EAASE,IAE/E,CAKQ,uBAAAL,CAAwBvD,GAC5B,IAAI8D,EAAepQ,KAAK2J,aAAa,GACjC0G,EAAcC,OAAOC,UAEzB,IAAA,MAAWC,KAAgBxQ,KAAK2J,aAAc,CAC1C,MAAM8G,EAAW7D,KAAK8D,KAClB9D,KAAK+D,IAAIrE,EAAMhB,EAAIkF,EAAalF,EAAG,GACnCsB,KAAK+D,IAAIrE,EAAMf,EAAIiF,EAAajF,EAAG,GACnCqB,KAAK+D,IAAIrE,EAAMd,EAAIgF,EAAahF,EAAG,IAGnCiF,EAAWJ,IACXA,EAAcI,EACdL,EAAeI,EAEvB,CAEA,OAAOJ,CACX,CAKQ,cAAAhE,GAGJpM,KAAKgJ,OAAOxD,MAAM,iCACtB,CAKA,YAAAoL,GAEI5Q,KAAK+K,sBACL/K,KAAKgJ,OAAOxD,MAAM,mBACtB,CAKQ,UAAAqG,CAAWgF,GACf,MAAMvH,EAAS,4CAA4CwH,KAAKD,GAChE,OAAOvH,EAAS,CACZgC,EAAGyF,SAASzH,EAAO,GAAI,IACvBiC,EAAGwF,SAASzH,EAAO,GAAI,IACvBkC,EAAGuF,SAASzH,EAAO,GAAI,KACvB,CAAEgC,EAAG,EAAGC,EAAG,EAAGC,EAAG,EACzB,CAKQ,UAAA+C,CAAWjC,GACf,MAAM0E,EAASC,IACX,MAAMJ,EAAMjE,KAAKsE,MAAMD,GAAGE,SAAS,IACnC,OAAsB,IAAfN,EAAIjK,OAAe,IAAMiK,EAAMA,GAE1C,MAAO,IAAIG,EAAM1E,EAAMhB,KAAK0F,EAAM1E,EAAMf,KAAKyF,EAAM1E,EAAMd,IAC7D,CAKA,cAAA4F,GACI,MAAO,IAAKpR,KAAK4J,YACrB,CAKA,QAAAyH,CAAS3E,EAAWC,EAAWlC,EAAeC,EAAgB4B,GAC1DtM,KAAKiK,IAAI8B,UAAY/L,KAAKuO,WAAWjC,GACrCtM,KAAKiK,IAAI+B,SAASU,EAAGC,EAAGlC,EAAOC,EACnC,CAOA,OAAA4G,GAEQtR,KAAKyJ,KACLzJ,KAAK0J,eAAeyF,QAAQoC,IACxBvR,KAAKyJ,GAAI+H,cAAcD,KAE3BvR,KAAK0J,eAAexB,SAGxBlI,KAAKgJ,OAAOpD,KAAK,gCACrB,ECxnBG,MAAM6L,EA2BT,WAAA3M,CAAYzC,EAA2B5B,GApBvCT,KAAQ0R,aAA0C5I,IAGlD9I,KAAQ2R,eAAyC7I,IACjD9I,KAAQ4R,kBAA4C9I,IAGpD9I,KAAQiF,OAAS,CACbrC,gBAAgB,EAChBiP,aAAa,EACbhP,aAAa,EACbC,eAAe,EACfC,iBAAkB,EAClBC,eAAgB,IAChBC,cAAe,IAInBjD,KAAQ8R,eAAoC,GAGxC9R,KAAKqC,OAASA,EACdrC,KAAKS,SAAWA,EAChBT,KAAKgJ,OAAS,IAAIO,EAAO,gBAGzBvJ,KAAK+R,aAAe/R,KAAKgS,wBACzBhS,KAAKiS,cAAgBjS,KAAKgS,wBAG1BhS,KAAKkS,uBAGLlS,KAAKmS,sBAGDnS,KAAKiF,OAAOpC,aACZ7C,KAAKoS,kBAGTpS,KAAKgJ,OAAOpD,KAAK,+BAAgC,CAC7CnF,WACAwE,OAAQjF,KAAKiF,QAErB,CAKQ,oBAAAiN,GACJ,OAAQlS,KAAKS,UACT,KAAKZ,EAASyK,QACd,KAAKzK,EAASwS,MACVrS,KAAKiF,OAAOrC,gBAAiB,EAC7B5C,KAAKiF,OAAO4M,aAAc,EAC1B7R,KAAKiF,OAAOpC,aAAc,EAC1B7C,KAAKiF,OAAOnC,eAAgB,EAC5B,MAEJ,KAAKjD,EAASwK,OACd,KAAKxK,EAASyS,QACVtS,KAAKiF,OAAOrC,gBAAiB,EAC7B5C,KAAKiF,OAAO4M,aAAc,EAC1B7R,KAAKiF,OAAOpC,aAAc,EAC1B7C,KAAKiF,OAAOnC,eAAgB,EAC5B9C,KAAKiF,OAAOlC,iBAAmB,IAC/B,MAEJ,KAAKlD,EAAS0S,IAEVvS,KAAKiF,OAAOrC,gBAAiB,EAC7B5C,KAAKiF,OAAO4M,aAAc,EAC1B7R,KAAKiF,OAAOpC,YAAc,iBAAkB3C,OAC5CF,KAAKiF,OAAOnC,cAAgB,gBAAiB1B,UAGzD,CAKQ,mBAAA+Q,GAEJ,GAAInS,KAAKiF,OAAOrC,eAAgB,CAC5B,MAAM4P,EAAkBC,GAAqBzS,KAAK0S,cAAcD,GAC1DE,EAAgBF,GAAqBzS,KAAK4S,YAAYH,GAE5D3Q,SAAS+Q,iBAAiB,UAAWL,GACrC1Q,SAAS+Q,iBAAiB,QAASF,GAEnC3S,KAAK8R,eAAenL,KAAK,KACrB7E,SAASgR,oBAAoB,UAAWN,GACxC1Q,SAASgR,oBAAoB,QAASH,IAE9C,CAGA,GAAI3S,KAAKiF,OAAO4M,YAAa,CACzB,MAAMkB,EAAoBN,GAAkBzS,KAAKgT,gBAAgBP,GAC3DQ,EAAoBR,GAAkBzS,KAAKkT,gBAAgBT,GAC3DU,EAAkBV,GAAkBzS,KAAKoT,cAAcX,GACvDY,EAAgBZ,GAAkBzS,KAAKsT,YAAYb,GAEzDzS,KAAKqC,OAAOwQ,iBAAiB,YAAaE,GAC1C/S,KAAKqC,OAAOwQ,iBAAiB,YAAaI,GAC1CjT,KAAKqC,OAAOwQ,iBAAiB,UAAWM,GACxCnT,KAAKqC,OAAOwQ,iBAAiB,QAASQ,GAEtCrT,KAAK8R,eAAenL,KAAK,KACrB3G,KAAKqC,OAAOyQ,oBAAoB,YAAaC,GAC7C/S,KAAKqC,OAAOyQ,oBAAoB,YAAaG,GAC7CjT,KAAKqC,OAAOyQ,oBAAoB,UAAWK,GAC3CnT,KAAKqC,OAAOyQ,oBAAoB,QAASO,IAEjD,CAGA,GAAIrT,KAAKiF,OAAOpC,YAAa,CACzB,MAAM0Q,EAAqBd,GAAkBzS,KAAKwT,iBAAiBf,GAC7DgB,EAAoBhB,GAAkBzS,KAAK0T,gBAAgBjB,GAC3DkB,EAAmBlB,GAAkBzS,KAAK4T,eAAenB,GAE/DzS,KAAKqC,OAAOwQ,iBAAiB,aAAcU,EAAmB,CAAEM,SAAS,IACzE7T,KAAKqC,OAAOwQ,iBAAiB,YAAaY,EAAkB,CAAEI,SAAS,IACvE7T,KAAKqC,OAAOwQ,iBAAiB,WAAYc,EAAiB,CAAEE,SAAS,IAErE7T,KAAK8R,eAAenL,KAAK,KACrB3G,KAAKqC,OAAOyQ,oBAAoB,aAAcS,GAC9CvT,KAAKqC,OAAOyQ,oBAAoB,YAAaW,GAC7CzT,KAAKqC,OAAOyQ,oBAAoB,WAAYa,IAEpD,CAGA,GAAI3T,KAAKiF,OAAOnC,cAAe,CAC3B,MAAMgR,EAA2BrB,GAAoBzS,KAAK+T,uBAAuBtB,GAC3EuB,EAA8BvB,GAAoBzS,KAAKiU,0BAA0BxB,GAEvFvS,OAAO2S,iBAAiB,mBAAoBiB,GAC5C5T,OAAO2S,iBAAiB,sBAAuBmB,GAE/ChU,KAAK8R,eAAenL,KAAK,KACrBzG,OAAO4S,oBAAoB,mBAAoBgB,GAC/C5T,OAAO4S,oBAAoB,sBAAuBkB,IAE1D,CAGA,MAAME,EAAe,IAAMlU,KAAKmU,cAC1BC,EAAc,IAAMpU,KAAKqU,aAE/BnU,OAAO2S,iBAAiB,QAASqB,GACjChU,OAAO2S,iBAAiB,OAAQuB,GAEhCpU,KAAK8R,eAAenL,KAAK,KACrBzG,OAAO4S,oBAAoB,QAASoB,GACpChU,OAAO4S,oBAAoB,OAAQsB,IAE3C,CAKQ,eAAAhC,GACJ,MAAMkC,EAAatU,KAAKqC,OAAOkS,wBAG/BvU,KAAK2R,WAAW5I,IAAI,SAAU,CAC1B2D,EAAG,EACHC,EAAG,EACHlC,MAAO6J,EAAW7J,MAAQ,EAC1BC,OAAQ4J,EAAW5J,OACnBzG,KAAM,aAIVjE,KAAK2R,WAAW5I,IAAI,WAAY,CAC5B2D,EAAG4H,EAAW7J,MAAQ,EACtBkC,EAAG,EACHlC,MAAO6J,EAAW7J,MAAQ,EAC1BC,OAAQ4J,EAAW5J,OACnBzG,KAAM,aAGVjE,KAAKgJ,OAAOxD,MAAM,6CACtB,CAKA,MAAAgP,CAAOC,GAEHzU,KAAKiS,cAAgBjS,KAAK0U,mBAAmB1U,KAAK+R,cAGlD/R,KAAK+R,aAAa4C,YAAYzM,QAC9BlI,KAAK+R,aAAa6C,aAAa1M,QAC/BlI,KAAK+R,aAAa8C,oBAAoB3M,QACtClI,KAAK+R,aAAa+C,qBAAqB5M,QACvClI,KAAK+R,aAAagD,WAAa,EAC/B/U,KAAK+R,aAAaiD,cAAe,EACjChV,KAAK+R,aAAakD,YAAa,EAG3BjV,KAAKiF,OAAOnC,eACZ9C,KAAKkV,qBAILlV,KAAKiF,OAAOpC,aACZ7C,KAAKmV,uBAEb,CAKQ,aAAAzC,CAAcD,GAClB,MAAM2C,EAAM3C,EAAE4C,KAETrV,KAAK+R,aAAauD,KAAKC,IAAIH,KAC5BpV,KAAK+R,aAAa4C,YAAYa,IAAIJ,GAClCpV,KAAKgJ,OAAOxD,MAAM,gBAAgB4P,MAGtCpV,KAAK+R,aAAauD,KAAKE,IAAIJ,GAGvBpV,KAAKyV,UAAUL,IACf3C,EAAEiD,gBAEV,CAEQ,WAAA9C,CAAYH,GAChB,MAAM2C,EAAM3C,EAAE4C,KAEVrV,KAAK+R,aAAauD,KAAKC,IAAIH,KAC3BpV,KAAK+R,aAAa6C,aAAaY,IAAIJ,GACnCpV,KAAKgJ,OAAOxD,MAAM,iBAAiB4P,MAGvCpV,KAAK+R,aAAauD,KAAKlM,OAAOgM,GAE1BpV,KAAKyV,UAAUL,IACf3C,EAAEiD,gBAEV,CAKQ,eAAA1C,CAAgBP,GACpB,MAAMkD,EAAO3V,KAAKqC,OAAOkS,wBACzBvU,KAAK+R,aAAa6D,cAAgB,CAC9BlJ,EAAG+F,EAAEoD,QAAUF,EAAKG,KACpBnJ,EAAG8F,EAAEsD,QAAUJ,EAAKK,IAE5B,CAEQ,eAAA9C,CAAgBT,GACpB,MAAMwD,EAASxD,EAAEwD,OAEZjW,KAAK+R,aAAamE,aAAaX,IAAIU,IACpCjW,KAAK+R,aAAa8C,oBAAoBW,IAAIS,GAG9CjW,KAAK+R,aAAamE,aAAaV,IAAIS,GACnCxD,EAAEiD,gBACN,CAEQ,aAAAtC,CAAcX,GAClB,MAAMwD,EAASxD,EAAEwD,OAEbjW,KAAK+R,aAAamE,aAAaX,IAAIU,IACnCjW,KAAK+R,aAAa+C,qBAAqBU,IAAIS,GAG/CjW,KAAK+R,aAAamE,aAAa9M,OAAO6M,GACtCxD,EAAEiD,gBACN,CAEQ,WAAApC,CAAYb,GAChBzS,KAAK+R,aAAagD,WAAatC,EAAE0D,OACjC1D,EAAEiD,gBACN,CAKQ,gBAAAlC,CAAiBf,GACrBzS,KAAK+R,aAAaiD,cAAe,EACjChV,KAAK+R,aAAaqE,QAAUC,MAAMC,KAAK7D,EAAE2D,SAEzC,IAAA,IAAS7J,EAAI,EAAGA,EAAIkG,EAAE8D,eAAe3P,OAAQ2F,IAAK,CAC9C,MAAMiK,EAAQ/D,EAAE8D,eAAehK,GAC/BvM,KAAK4R,cAAc7I,IAAIyN,EAAMC,WAAY,CACrCC,GAAIF,EAAMC,WACVE,cAAe,CAAEjK,EAAG8J,EAAMX,QAASlJ,EAAG6J,EAAMT,SAC5Ca,gBAAiB,CAAElK,EAAG8J,EAAMX,QAASlJ,EAAG6J,EAAMT,SAC9Cc,KAAM7W,KAAK8W,aAAaN,EAAMX,QAASW,EAAMT,UAErD,CAEAtD,EAAEiD,gBACN,CAEQ,eAAAhC,CAAgBjB,GACpBzS,KAAK+R,aAAaqE,QAAUC,MAAMC,KAAK7D,EAAE2D,SAEzC,IAAA,IAAS7J,EAAI,EAAGA,EAAIkG,EAAE8D,eAAe3P,OAAQ2F,IAAK,CAC9C,MAAMiK,EAAQ/D,EAAE8D,eAAehK,GACzBwK,EAAY/W,KAAK4R,cAAc1I,IAAIsN,EAAMC,YAE3CM,IACAA,EAAUH,gBAAkB,CAAElK,EAAG8J,EAAMX,QAASlJ,EAAG6J,EAAMT,SAEjE,CAEAtD,EAAEiD,gBACN,CAEQ,cAAA9B,CAAenB,GACnBzS,KAAK+R,aAAakD,YAAa,EAC/BjV,KAAK+R,aAAaqE,QAAUC,MAAMC,KAAK7D,EAAE2D,SAEzC,IAAA,IAAS7J,EAAI,EAAGA,EAAIkG,EAAE8D,eAAe3P,OAAQ2F,IAAK,CAC9C,MAAMiK,EAAQ/D,EAAE8D,eAAehK,GAC/BvM,KAAK4R,cAAcxI,OAAOoN,EAAMC,WACpC,CAEAhE,EAAEiD,gBACN,CAKQ,sBAAA3B,CAAuBtB,GAC3BzS,KAAKgJ,OAAOpD,KAAK,sBAAsB6M,EAAEuE,QAAQN,MACjD1W,KAAK0R,SAAS3I,IAAI0J,EAAEuE,QAAQlK,MAAO,CAC/BmK,WAAW,EACXC,KAAM,GACNC,QAAS,IAEjB,CAEQ,yBAAAlD,CAA0BxB,GAC9BzS,KAAKgJ,OAAOpD,KAAK,yBAAyB6M,EAAEuE,QAAQN,MACpD1W,KAAK0R,SAAStI,OAAOqJ,EAAEuE,QAAQlK,MACnC,CAKQ,kBAAAoI,GACJ,MAAMxD,EAAWtQ,UAAUgW,cAE3B,IAAA,IAAS7K,EAAI,EAAGA,EAAImF,EAAS9K,OAAQ2F,IAAK,CACtC,MAAMyK,EAAUtF,EAASnF,GACzB,GAAIyK,GAAWhX,KAAK0R,SAAS6D,IAAIhJ,GAAI,CACjC,MAAM8K,EAAQrX,KAAK0R,SAASxI,IAAIqD,GAChC8K,EAAMH,KAAOb,MAAMC,KAAKU,EAAQE,MAChCG,EAAMF,QAAUH,EAAQG,QAAQlI,IAAIgH,GAAUA,EAAOqB,QACzD,CACJ,CACJ,CAKQ,qBAAAnC,GACJnV,KAAK+R,aAAawF,cAAgB,EAClCvX,KAAK+R,aAAayF,gBAAkB,EACpCxX,KAAK+R,aAAa0F,eAAgB,EAElC,IAAA,MAAYC,EAASX,KAAc/W,KAAK4R,cAAe,CACnD,MAAM+F,EAASZ,EAAUH,gBAAgBlK,EAAIqK,EAAUJ,cAAcjK,EAC/DyJ,EAASY,EAAUH,gBAAgBjK,EAAIoK,EAAUJ,cAAchK,EAE9C,WAAnBoK,EAAUF,MAEV7W,KAAK+R,aAAawF,eAAiBpB,EAAS,IAAMnW,KAAKiF,OAAOlC,iBAC9D/C,KAAK+R,aAAawF,cAAgB3K,KAAKoC,KAAI,EAAIpC,KAAKuD,IAAI,EAAGnQ,KAAK+R,aAAawF,iBACnD,aAAnBR,EAAUF,OAEjB7W,KAAK+R,aAAayF,gBAAkBG,EAAS,IAAM3X,KAAKiF,OAAOlC,iBAC/D/C,KAAK+R,aAAayF,gBAAkB5K,KAAKoC,KAAI,EAAIpC,KAAKuD,IAAI,EAAGnQ,KAAK+R,aAAayF,kBAEvF,CACJ,CAKQ,WAAArD,GACJnU,KAAKgJ,OAAOxD,MAAM,iCACtB,CAEQ,UAAA6O,GAEJrU,KAAK+R,aAAauD,KAAKpN,QACvBlI,KAAK+R,aAAamE,aAAahO,QAC/BlI,KAAK4R,cAAc1J,QACnBlI,KAAKgJ,OAAOxD,MAAM,iCACtB,CAKQ,qBAAAwM,GACJ,MAAO,CACHsD,SAAUsC,IACVjD,gBAAiBiD,IACjBhD,iBAAkBgD,IAClBhC,cAAe,CAAElJ,EAAG,EAAGC,EAAG,GAC1BuJ,iBAAkB0B,IAClB/C,wBAAyB+C,IACzB9C,yBAA0B8C,IAC1B7C,WAAY,EACZqB,QAAS,GACTpB,cAAc,EACdC,YAAY,EACZsC,cAAe,EACfC,gBAAiB,EACjBC,eAAe,EAEvB,CAEQ,kBAAA/C,CAAmB2C,GACvB,MAAO,CACH/B,KAAM,IAAIsC,IAAIP,EAAM/B,MACpBX,gBAAiBiD,IACjBhD,iBAAkBgD,IAClBhC,cAAe,IAAKyB,EAAMzB,eAC1BM,aAAc,IAAI0B,IAAIP,EAAMnB,cAC5BrB,wBAAyB+C,IACzB9C,yBAA0B8C,IAC1B7C,WAAY,EACZqB,QAAS,IAAIiB,EAAMjB,SACnBpB,cAAc,EACdC,YAAY,EACZsC,cAAeF,EAAME,cACrBC,gBAAiBH,EAAMG,gBACvBC,cAAeJ,EAAMI,cAE7B,CAEQ,SAAAhC,CAAUL,GAMd,MALiB,CACb,UAAW,YAAa,YAAa,aACrC,OAAQ,OAAQ,OAAQ,OACxB,QAAS,QAAS,UAENyC,SAASzC,EAC7B,CAEQ,YAAA0B,CAAapK,EAAWC,GAC5B,IAAA,MAAYmL,EAAUjB,KAAS7W,KAAK2R,WAChC,GAAIjF,GAAKmK,EAAKnK,GAAKA,EAAImK,EAAKnK,EAAImK,EAAKpM,OACjCkC,GAAKkK,EAAKlK,GAAKA,EAAIkK,EAAKlK,EAAIkK,EAAKnM,OACjC,OAAOoN,EAGf,OAAO,IACX,CAKA,SAAAC,CAAU3C,GACN,OAAOpV,KAAK+R,aAAauD,KAAKC,IAAIH,EACtC,CAEA,YAAA4C,CAAa5C,GACT,OAAOpV,KAAK+R,aAAa4C,YAAYY,IAAIH,EAC7C,CAEA,aAAA6C,CAAc7C,GACV,OAAOpV,KAAK+R,aAAa6C,aAAaW,IAAIH,EAC9C,CAEA,iBAAA8C,CAAkBjC,GACd,OAAOjW,KAAK+R,aAAamE,aAAaX,IAAIU,EAC9C,CAEA,oBAAAkC,CAAqBlC,GACjB,OAAOjW,KAAK+R,aAAa8C,oBAAoBU,IAAIU,EACrD,CAEA,gBAAAmC,GACI,MAAO,IAAKpY,KAAK+R,aAAa6D,cAClC,CAEA,aAAAyC,GACI,OAAOrY,KAAK+R,aAAagD,UAC7B,CAEA,aAAAuD,GACI,OAAOtY,KAAK+R,aAAaqE,QAAQxP,MACrC,CAEA,gBAAA2R,GACI,OAAOvY,KAAK+R,aAAawF,aAC7B,CAEA,kBAAAiB,GACI,OAAOxY,KAAK+R,aAAayF,eAC7B,CAGA,cAAAiB,GACI,GAAIzY,KAAKiF,OAAOpC,YACZ,OAAO7C,KAAK+R,aAAawF,cAG7B,IAAImB,EAAS,GACT1Y,KAAK+X,UAAU,YAAc/X,KAAK+X,UAAU,WAASW,GAAU,IAC/D1Y,KAAK+X,UAAU,cAAgB/X,KAAK+X,UAAU,WAASW,GAAU,GAGrE,IAAA,MAAW1B,KAAWhX,KAAK0R,SAASiH,SAC5B3B,EAAQC,WAAaD,EAAQE,KAAKtQ,OAAS,IAC3C8R,IAAW1B,EAAQE,KAAK,IAIhC,OAAOtK,KAAKoC,KAAI,EAAIpC,KAAKuD,IAAI,EAAGuI,GACpC,CAEA,gBAAAE,GACI,GAAI5Y,KAAKiF,OAAOpC,YACZ,OAAO7C,KAAK+R,aAAayF,gBAG7B,IAAIqB,EAAW,GACX7Y,KAAK+X,UAAU,cAAgB/X,KAAK+X,UAAU,WAASc,GAAY,IACnE7Y,KAAK+X,UAAU,eAAiB/X,KAAK+X,UAAU,WAASc,GAAY,GAGxE,IAAA,MAAW7B,KAAWhX,KAAK0R,SAASiH,SAC5B3B,EAAQC,WAAaD,EAAQE,KAAKtQ,OAAS,IAC3CiS,GAAY7B,EAAQE,KAAK,IAIjC,OAAOtK,KAAKoC,KAAI,EAAIpC,KAAKuD,IAAI,EAAG0I,GACpC,CAEA,eAAAC,GACI,OAAO9Y,KAAKgY,aAAa,UAClBhY,KAAKmY,qBAAqB,IAC1BnY,KAAK+R,aAAa0F,aAC7B,CAEA,cAAAsB,GACI,OAAO/Y,KAAKgY,aAAa,WAAahY,KAAKgY,aAAa,OAC5D,CAKA,OAAA1G,GAEItR,KAAK8R,eAAe3C,QAAQmC,GAAWA,KACvCtR,KAAK8R,eAAiB,GAGtB9R,KAAK4R,cAAc1J,QACnBlI,KAAK0R,SAASxJ,QAEdlI,KAAKgJ,OAAOpD,KAAK,qCACrB,EC1jBG,MAAMoT,EAeT,WAAAlU,GAdA9E,KAAQiZ,YAA0CnQ,IAClD9I,KAAQkZ,iBAA6CpQ,IAGrD9I,KAAiBmZ,uBAAyB,QAC1CnZ,KAAiBoZ,WAAa,KAC9BpZ,KAAiBqZ,aAAe,IAChCrZ,KAAiBsZ,aAAe,IAGhCtZ,KAAQuZ,eAAkC,GAKtCvZ,KAAKgJ,OAAS,IAAIO,EAAO,gBACzBvJ,KAAKgJ,OAAOpD,KAAK,sCACrB,CAKA,SAAA4T,CAAUC,GACNzZ,KAAKiZ,QAAQlQ,IAAI0Q,EAAO/C,GAAI+C,GAC5BzZ,KAAKgJ,OAAOxD,MAAM,yBAAyBiU,EAAO/C,OAAO+C,EAAOxV,QACpE,CAKA,YAAAyV,CAAahD,GACT,MAAMiD,EAAU3Z,KAAKiZ,QAAQ7P,OAAOsN,GAIpC,OAHIiD,GACA3Z,KAAKgJ,OAAOxD,MAAM,2BAA2BkR,KAE1CiD,CACX,CAKA,SAAAC,CAAUlD,GACN,OAAO1W,KAAKiZ,QAAQ/P,IAAIwN,EAC5B,CAKA,cAAAmD,CAAenD,EAAYoD,GACvB9Z,KAAKkZ,aAAanQ,IAAI2N,EAAIoD,GAC1B9Z,KAAKgJ,OAAOxD,MAAM,uBAAuBkR,IAC7C,CAKA,iBAAAqD,CAAkBrD,GACd,OAAO1W,KAAKkZ,aAAa9P,OAAOsN,EACpC,CAKA,MAAAlC,CAAOC,GAEHA,EAAY7H,KAAKuD,IAAIsE,EAAW,EAAE,IAGlCzU,KAAKuZ,eAAiB,GAGtB,IAAA,MAAWE,KAAUzZ,KAAKiZ,QAAQN,SACzBc,EAAOO,UACRha,KAAKia,aAAaR,EAAQhF,GAKlCzU,KAAKka,mBACLla,KAAKma,mBACT,CAKQ,YAAAF,CAAaR,EAAuBhF,GAExCgF,EAAOW,aAAe,CAAE1N,EAAG,EAAGC,EAAG,GAGjC3M,KAAKqa,aAAaZ,GAGlBzZ,KAAKsa,UAAUb,GAGfA,EAAOc,SAAS7N,GAAK+M,EAAOW,aAAa1N,EAAI+H,EAC7CgF,EAAOc,SAAS5N,GAAK8M,EAAOW,aAAazN,EAAI8H,EAG7C,MAAM+F,EAAQxa,KAAKya,mBAAmBhB,EAAOc,UAC7C,GAAIC,EAAQxa,KAAKsZ,aAAc,CAC3B,MAAMlO,EAAQpL,KAAKsZ,aAAekB,EAClCf,EAAOc,SAAS7N,GAAKtB,EACrBqO,EAAOc,SAAS5N,GAAKvB,CACzB,CAGIoP,EAAQxa,KAAKqZ,eACbI,EAAOc,SAAW,CAAE7N,EAAG,EAAGC,EAAG,IAIjC8M,EAAOiB,SAAShO,GAAK+M,EAAOc,SAAS7N,EAAI+H,EACzCgF,EAAOiB,SAAS/N,GAAK8M,EAAOc,SAAS5N,EAAI8H,CAC7C,CAKQ,YAAA4F,CAAaZ,GACjB,IAAA,MAAWK,KAAQ9Z,KAAKkZ,aAAaP,SAAU,CAC3C,MAAMrL,EAAKwM,EAAKY,SAAShO,EAAI+M,EAAOiB,SAAShO,EACvCc,EAAKsM,EAAKY,SAAS/N,EAAI8M,EAAOiB,SAAS/N,EACvCgO,EAAkBrN,EAAKA,EAAKE,EAAKA,EACjCiD,EAAW7D,KAAK8D,KAAKiK,GAG3B,GAAIlK,EAAyB,GAAdqJ,EAAK9L,OAAc,SAIlC,MAAM4M,EAAS5a,KAAKmZ,uBAAyBW,EAAKe,KAAOpB,EAAOoB,KAAQF,EAGlEG,EAAUxN,EAAKmD,EAAYmK,EAC3BG,EAAUvN,EAAKiD,EAAYmK,EAGjCnB,EAAOW,aAAa1N,GAAKoO,EAASrB,EAAOoB,KACzCpB,EAAOW,aAAazN,GAAKoO,EAAStB,EAAOoB,IAC7C,CACJ,CAKQ,SAAAP,CAAUb,GAEdA,EAAOc,SAAS7N,GAAM1M,KAAKoZ,WAAaK,EAAOuB,KAC/CvB,EAAOc,SAAS5N,GAAM3M,KAAKoZ,WAAaK,EAAOuB,IACnD,CAKQ,gBAAAd,GACJ,MAAMe,EAAc5E,MAAMC,KAAKtW,KAAKiZ,QAAQN,UAE5C,IAAA,IAASpM,EAAI,EAAGA,EAAI0O,EAAYrU,OAAQ2F,IACpC,IAAA,IAAS2O,EAAI3O,EAAI,EAAG2O,EAAID,EAAYrU,OAAQsU,IAAK,CAC7C,MAAMC,EAAOF,EAAY1O,GACnB6O,EAAOH,EAAYC,GAEnBG,EAAYrb,KAAKsb,eAAeH,EAAMC,GACxCC,GACArb,KAAKuZ,eAAe5S,KAAK0U,EAEjC,CAER,CAKQ,cAAAC,CAAeH,EAAqBC,GACxC,MAAM9N,EAAK8N,EAAKV,SAAShO,EAAIyO,EAAKT,SAAShO,EACrCc,EAAK4N,EAAKV,SAAS/N,EAAIwO,EAAKT,SAAS/N,EACrC8D,EAAW7D,KAAK8D,KAAKpD,EAAKA,EAAKE,EAAKA,GACpC6C,EAAc8K,EAAKnN,OAASoN,EAAKpN,OAEvC,GAAIyC,EAAWJ,EAAa,CAYxB,MAAO,CACHkL,QAASJ,EACTK,QAASJ,EACTK,YAbgBpL,EAAcI,EAc9BiL,OAbWjL,EAAW,EACtB,CAAE/D,EAAGY,EAAKmD,EAAU9D,EAAGa,EAAKiD,GAC5B,CAAE/D,EAAG,EAAGC,EAAG,GAYXgP,MAVU,CACVjP,EAAGyO,EAAKT,SAAShO,EAAIY,GAAM6N,EAAKnN,OAASqC,GACzC1D,EAAGwO,EAAKT,SAAS/N,EAAIa,GAAM2N,EAAKnN,OAASqC,IAUjD,CAEA,OAAO,IACX,CAKQ,iBAAA8J,GACJ,IAAA,MAAWkB,KAAarb,KAAKuZ,eACzBvZ,KAAK4b,iBAAiBP,GAGlBA,EAAUE,QAAQM,aAClBR,EAAUE,QAAQM,YAAYR,EAAUG,SAExCH,EAAUG,QAAQK,aAClBR,EAAUG,QAAQK,YAAYR,EAAUE,QAGpD,CAKQ,gBAAAK,CAAiBP,GACrB,MAAME,QAAEA,EAAAC,QAASA,EAAAC,YAASA,EAAAC,OAAaA,GAAWL,EAGlD,GAAKE,EAAQvB,UAAawB,EAAQxB,SAStBuB,EAAQvB,SAIRwB,EAAQxB,WAEhBwB,EAAQd,SAAShO,GAAKgP,EAAOhP,EAAI+O,EACjCD,EAAQd,SAAS/N,GAAK+O,EAAO/O,EAAI8O,IALjCF,EAAQb,SAAShO,GAAKgP,EAAOhP,EAAI+O,EACjCF,EAAQb,SAAS/N,GAAK+O,EAAO/O,EAAI8O,OAZO,CAExC,MAAMK,EAA4B,GAAdL,EACdM,EAA4B,GAAdN,EAEpBF,EAAQb,SAAShO,GAAKgP,EAAOhP,EAAIoP,EACjCP,EAAQb,SAAS/N,GAAK+O,EAAO/O,EAAImP,EACjCN,EAAQd,SAAShO,GAAKgP,EAAOhP,EAAIqP,EACjCP,EAAQd,SAAS/N,GAAK+O,EAAO/O,EAAIoP,CACrC,CAWA,MAAMC,EACCR,EAAQjB,SAAS7N,EAAI6O,EAAQhB,SAAS7N,EADvCsP,EAECR,EAAQjB,SAAS5N,EAAI4O,EAAQhB,SAAS5N,EAIvCsP,EAAsBD,EAAqBN,EAAOhP,EAAIsP,EAAqBN,EAAO/O,EAGxF,GAAIsP,EAAsB,EAAG,OAM7B,IAAIC,IAAY,EAHItP,KAAKuD,IAAIoL,EAAQY,YAAaX,EAAQW,cAGvBF,EAG9BV,EAAQvB,UAAawB,EAAQxB,WAC9BkC,GAAY,EAAIX,EAAQV,KAAO,EAAIW,EAAQX,MAI/C,MAAMuB,EAAqBF,EAAUR,EAAOhP,EAAtC0P,EAA4CF,EAAUR,EAAO/O,EAE9D4O,EAAQvB,WACTuB,EAAQhB,SAAS7N,GAAK0P,EAAkBb,EAAQV,KAChDU,EAAQhB,SAAS5N,GAAKyP,EAAkBb,EAAQV,MAG/CW,EAAQxB,WACTwB,EAAQjB,SAAS7N,GAAK0P,EAAkBZ,EAAQX,KAChDW,EAAQjB,SAAS5N,GAAKyP,EAAkBZ,EAAQX,KAExD,CAKA,WAAAwB,CAAYC,EAAkBC,EAAuBC,GACjD,MAAM/C,EAASzZ,KAAKiZ,QAAQ/P,IAAIoT,GAChC,IAAK7C,GAAUA,EAAOO,SAAU,OAGhC,MAAMyC,EAAYzc,KAAKya,mBAAmB8B,GAC1C,GAAkB,IAAdE,EAAiB,OAErB,MAAMC,EACCH,EAAa7P,EAAI+P,EADlBC,EAECH,EAAa5P,EAAI8P,EAIxBhD,EAAOW,aAAa1N,GAAKgQ,EAAqBF,EAAc/C,EAAOoB,KACnEpB,EAAOW,aAAazN,GAAK+P,EAAqBF,EAAc/C,EAAOoB,IACvE,CAKA,wBAAA8B,CAAyBlM,EAAkBmM,GAEvC,OAAOhQ,KAAK8D,KAAK1Q,KAAKmZ,uBAAyByD,EAAcnM,EACjE,CAKA,uBAAAoM,CAAwBpM,EAAkBmM,GAEtC,OAAOhQ,KAAK8D,KAAK,EAAI1Q,KAAKmZ,uBAAyByD,EAAcnM,EACrE,CAKA,kBAAAqM,CAAmBC,EAAiB/O,GAChC,MAAM1E,EAA0B,GAEhC,IAAA,MAAWmQ,KAAUzZ,KAAKiZ,QAAQN,SAAU,CACvB3Y,KAAKgd,YAAYD,EAAQtD,EAAOiB,WACjC1M,GACZ1E,EAAO3C,KAAK8S,EAEpB,CAEA,OAAOnQ,CACX,CAKA,OAAA2T,CAAQzU,EAAgB0U,EAAoBC,GACxC,MAAMC,EAAsBpd,KAAKqd,gBAAgBH,GAGjD,IAAA,IAASzM,EAAW,EAAGA,EAAW0M,EAAa1M,GAFlC,EAEoD,CAC7D,MAAMkL,EAAQ,CACVjP,EAAGlE,EAAMkE,EAAI0Q,EAAoB1Q,EAAI+D,EACrC9D,EAAGnE,EAAMmE,EAAIyQ,EAAoBzQ,EAAI8D,GAGzC,IAAA,MAAWgJ,KAAUzZ,KAAKiZ,QAAQN,SAAU,CAExC,GADuB3Y,KAAKgd,YAAYrB,EAAOlC,EAAOiB,WAChCjB,EAAOzL,OACzB,OAAOyL,CAEf,CACJ,CAEA,OAAO,IACX,CAKQ,kBAAAgB,CAAmB6C,GACvB,OAAO1Q,KAAK8D,KAAK4M,EAAO5Q,EAAI4Q,EAAO5Q,EAAI4Q,EAAO3Q,EAAI2Q,EAAO3Q,EAC7D,CAEQ,eAAA0Q,CAAgBC,GACpB,MAAMb,EAAYzc,KAAKya,mBAAmB6C,GAC1C,OAAkB,IAAdb,EAAwB,CAAE/P,EAAG,EAAGC,EAAG,GAChC,CAAED,EAAG4Q,EAAO5Q,EAAI+P,EAAW9P,EAAG2Q,EAAO3Q,EAAI8P,EACpD,CAEQ,WAAAO,CAAYxQ,EAAYhB,GAC5B,MAAM8B,EAAK9B,EAAEkB,EAAIF,EAAEE,EACbc,EAAKhC,EAAEmB,EAAIH,EAAEG,EACnB,OAAOC,KAAK8D,KAAKpD,EAAKA,EAAKE,EAAKA,EACpC,CAKA,QAAA+P,GACI,MAAO,CACHC,YAAaxd,KAAKiZ,QAAQ5N,KAC1BoS,iBAAkBzd,KAAKkZ,aAAa7N,KACpCqS,eAAgB1d,KAAKuZ,eAAe3S,OACpC+W,cAAetH,MAAMC,KAAKtW,KAAKiZ,QAAQN,UAAU3Q,OAAO4V,IAAQA,EAAI5D,UAAUpT,OAEtF,CAKA,cAAAiX,GACI,OAAO7d,KAAKiZ,QAAQ5N,IACxB,CAKA,aAAAyS,GACI,OAAOzH,MAAMC,KAAKtW,KAAKiZ,QAAQN,SACnC,CAKA,KAAAzQ,GACIlI,KAAKiZ,QAAQ/Q,QACblI,KAAKkZ,aAAahR,QAClBlI,KAAKuZ,eAAiB,GACtBvZ,KAAKgJ,OAAOxD,MAAM,6BACtB,CAKA,UAAAuY,CAAWrH,EAAYgE,EAAmBG,EAAe,KACrD,MAAO,CACHnE,KACAgE,SAAU,IAAKA,GACfH,SAAU,CAAE7N,EAAG,EAAGC,EAAG,GACrByN,aAAc,CAAE1N,EAAG,EAAGC,EAAG,GACzBkO,OACA7M,OAAQ,GACRgM,UAAU,EACV/V,KAAM,OACN+W,KAAM,KACNmB,YAAa,GACb6B,SAAU,GACVC,OAAQ,IAEhB,CAKA,YAAAC,CAAaxH,EAAYgE,EAAmBG,EAAc7M,GACtD,MAAO,CACH0I,KACAgE,SAAU,IAAKA,GACfH,SAAU,CAAE7N,EAAG,EAAGC,EAAG,GACrByN,aAAc,CAAE1N,EAAG,EAAGC,EAAG,GACzBkO,OACA7M,SACAgM,UAAU,EACV/V,KAAM,SACN+W,KAAM,EACNmB,YAAa,GACb6B,SAAU,GAElB,CAKA,gBAAAG,CAAiBzH,EAAYgE,EAAmBH,EAAmBM,EAAe,GAC9E,MAAO,CACHnE,KACAgE,SAAU,IAAKA,GACfH,SAAU,IAAKA,GACfH,aAAc,CAAE1N,EAAG,EAAGC,EAAG,GACzBkO,OACA7M,OAAQ,EACRgM,UAAU,EACV/V,KAAM,aACN+W,KAAM,EACNmB,YAAa,GACb6B,SAAU,EAElB,ECleG,MAAMI,EAwBT,WAAAtZ,CAAYrE,GAvBZT,KAAQqe,QAA+B,KAKvCre,KAAQse,WAA8B,KACtCte,KAAQue,UAA6B,KACrCve,KAAQwe,QAA2B,KAGnCxe,KAAQye,iBAA6C3V,IACrD9I,KAAQ0e,kBAA8C5V,IAGtD9I,KAAQ2e,WAAiC,KACzC3e,KAAQ4e,aAAmC,KAG3C5e,KAAQ6e,eAA8C/V,IAGtD9I,KAAQ8e,eAAgB,EAGpB9e,KAAKS,SAAWA,EAChBT,KAAKgJ,OAAS,IAAIO,EAAO,eAGzBvJ,KAAKiF,OAAS,CACV8Z,aAAc,EACdC,YAAa,GACbC,UAAW,GACXpb,mBAAoBpD,IAAaZ,EAASyK,QAC1CvG,YAAatD,IAAaZ,EAASwK,OAAS,EAAI,GAChD6U,WAAY,OAGhBlf,KAAKgJ,OAAOpD,KAAK,0BAA2B,CACxCnF,WACAwE,OAAQjF,KAAKiF,QAErB,CAKA,gBAAM0F,GACF3K,KAAKgJ,OAAOpD,KAAK,mCAEjB,IAEI5F,KAAKqe,QAAU,IAAKne,OAAOif,cAAiBjf,OAAekf,oBAAoB,CAC3EF,WAAYlf,KAAKiF,OAAOia,aAID,cAAvBlf,KAAKqe,QAAQhH,QACbrX,KAAKgJ,OAAOpD,KAAK,4DACjB5F,KAAKqf,+BAITrf,KAAKse,WAAate,KAAKqe,QAAQiB,aAC/Btf,KAAKue,UAAYve,KAAKqe,QAAQiB,aAC9Btf,KAAKwe,QAAUxe,KAAKqe,QAAQiB,aAG5Btf,KAAKue,UAAUgB,QAAQvf,KAAKse,YAC5Bte,KAAKwe,QAAQe,QAAQvf,KAAKse,YAC1Bte,KAAKse,WAAWiB,QAAQvf,KAAKqe,QAAQmB,aAGrCxf,KAAKyf,gBAAgBzf,KAAKiF,OAAO8Z,cACjC/e,KAAK0f,eAAe1f,KAAKiF,OAAO+Z,aAChChf,KAAK2f,aAAa3f,KAAKiF,OAAOga,iBAGxBjf,KAAK4f,sBAEX5f,KAAK8e,eAAgB,EACrB9e,KAAKgJ,OAAOpD,KAAK,0CAErB,OAASE,GAEL,MADA9F,KAAKgJ,OAAOlD,MAAM,uCAAwCA,GACpDA,CACV,CACJ,CAKQ,2BAAAuZ,GACJ,MAAMQ,EAAcC,UACZ9f,KAAKqe,SAAkC,cAAvBre,KAAKqe,QAAQhH,cACvBrX,KAAKqe,QAAQ0B,SACnB/f,KAAKgJ,OAAOpD,KAAK,yBAGjB9D,SAASgR,oBAAoB,QAAS+M,GACtC/d,SAASgR,oBAAoB,UAAW+M,GACxC/d,SAASgR,oBAAoB,aAAc+M,KAInD/d,SAAS+Q,iBAAiB,QAASgN,EAAa,CAAEG,MAAM,IACxDle,SAAS+Q,iBAAiB,UAAWgN,EAAa,CAAEG,MAAM,IAC1Dle,SAAS+Q,iBAAiB,aAAcgN,EAAa,CAAEG,MAAM,GACjE,CAKA,yBAAcJ,GACV,IAAK5f,KAAKqe,QAAS,OAGnB,MAAM4B,EAAejgB,KAAKkgB,oBAAoB,GAC9ClgB,KAAKye,aAAa1V,IAAI,gBAAiB,CACnC2N,GAAI,gBACJrK,OAAQ4T,EACRE,MAAM,EACNC,OAAQ,GACRC,MAAO,EACPpc,KAAM,WAIV,MAAMqc,EAActgB,KAAKugB,qBACzBvgB,KAAKye,aAAa1V,IAAI,eAAgB,CAClC2N,GAAI,eACJrK,OAAQiU,EACRH,MAAM,EACNC,OAAQ,GACRC,MAAO,EACPpc,KAAM,WAIV,MAAMuc,EAAkBxgB,KAAKygB,yBAC7BzgB,KAAKye,aAAa1V,IAAI,YAAa,CAC/B2N,GAAI,YACJrK,OAAQmU,EACRL,MAAM,EACNC,OAAQ,EACRC,MAAO,EACPpc,KAAM,cAIV,MAAMyc,EAAa1gB,KAAK2gB,kBAAkB,IAAK,IAC/C3gB,KAAKye,aAAa1V,IAAI,UAAW,CAC7B2N,GAAI,UACJrK,OAAQqU,EACRP,MAAM,EACNC,OAAQ,GACRC,MAAO,EACPpc,KAAM,OAGVjE,KAAKgJ,OAAOxD,MAAM,gCACtB,CAKQ,mBAAA0a,CAAoB/W,GACxB,IAAKnJ,KAAKqe,QAAS,MAAM,IAAIrY,MAAM,iCAEnC,MAAMkZ,EAAalf,KAAKqe,QAAQa,WAC1B0B,EAAUhU,KAAKC,MAAMqS,EAAa/V,GAClCkD,EAASrM,KAAKqe,QAAQwC,aAAa,EAAGD,EAAS1B,GAC/CxZ,EAAO2G,EAAOyU,eAAe,GAEnC,IAAA,IAASvU,EAAI,EAAGA,EAAIqU,EAASrU,IAAK,CAC9B,MAAMwU,EAAIxU,EAAI2S,EAGR8B,EAAW,GAAuB,GAAlBpU,KAAKqU,IAAQ,EAAJF,GACzBG,EAAmD,GAAvCtU,KAAKqU,IAAI,EAAIrU,KAAKuU,GAAKH,EAAWD,GAC9CK,EAAuD,GAA3CxU,KAAKqU,IAAI,EAAIrU,KAAKuU,GAAKH,EAAW,EAAID,GAClDM,EAAuD,GAA3CzU,KAAKqU,IAAI,EAAIrU,KAAKuU,GAAKH,EAAW,EAAID,GAGlDO,EAAgC,IAAvB1U,KAAK2U,SAAW,IAE/B7b,EAAK6G,GAAmD,IAA7C2U,EAAYE,EAAYC,EAAYC,EACnD,CAEA,OAAOjV,CACX,CAKQ,kBAAAkU,GACJ,IAAKvgB,KAAKqe,QAAS,MAAM,IAAIrY,MAAM,iCAEnC,MACMkZ,EAAalf,KAAKqe,QAAQa,WAC1B0B,EAAUhU,KAAKC,MAFJ,GAEUqS,GACrB7S,EAASrM,KAAKqe,QAAQwC,aAAa,EAAGD,EAAS1B,GAC/CxZ,EAAO2G,EAAOyU,eAAe,GAEnC,IAAA,IAASvU,EAAI,EAAGA,EAAIqU,EAASrU,IAAK,CAC9B,MAAMwU,EAAIxU,EAAI2S,EACRsC,EAAWT,EARJ,GAWPU,EAAO,KAAkB,IAAXD,EACdE,EAAY9U,KAAK+U,IAAgB,GAAXH,GAE5B9b,EAAK6G,GAAKK,KAAKqU,IAAI,EAAIrU,KAAKuU,GAAKM,EAAOV,GAAKW,EAAY,EAC7D,CAEA,OAAOrV,CACX,CAKQ,sBAAAoU,GACJ,IAAKzgB,KAAKqe,QAAS,MAAM,IAAIrY,MAAM,iCAEnC,MACMkZ,EAAalf,KAAKqe,QAAQa,WAC1B0B,EAAUhU,KAAKC,MAFJ,EAEUqS,GACrB7S,EAASrM,KAAKqe,QAAQwC,aAAa,EAAGD,EAAS1B,GAC/CxZ,EAAO2G,EAAOyU,eAAe,GAEnC,IAAA,IAASvU,EAAI,EAAGA,EAAIqU,EAASrU,IAAK,CAC9B,MAAMwU,EAAIxU,EAAI2S,EACRsC,EAAWT,EARJ,EAWPW,EAAYF,EAAW,GACd,GAAXA,EACA5U,KAAK+U,IAAwB,IAAlBH,EAAW,KAGpBF,EAAgC,GAAvB1U,KAAK2U,SAAW,IACzBK,EAA0C,GAAjChV,KAAKqU,IAAI,EAAIrU,KAAKuU,GAAK,GAAKJ,GAE3Crb,EAAK6G,IAAc,GAAR+U,EAAuB,GAATM,GAAgBF,EAAY,EACzD,CAEA,OAAOrV,CACX,CAKQ,iBAAAsU,CAAkBkB,EAAmB1Y,GACzC,IAAKnJ,KAAKqe,QAAS,MAAM,IAAIrY,MAAM,iCAEnC,MAAMkZ,EAAalf,KAAKqe,QAAQa,WAC1B0B,EAAUhU,KAAKC,MAAMqS,EAAa/V,GAClCkD,EAASrM,KAAKqe,QAAQwC,aAAa,EAAGD,EAAS1B,GAC/CxZ,EAAO2G,EAAOyU,eAAe,GAEnC,IAAA,IAASvU,EAAI,EAAGA,EAAIqU,EAASrU,IAAK,CAC9B,MAAMwU,EAAIxU,EAAI2S,EACRwC,EAAY9U,KAAK+U,IAAS,IAAJZ,GAE5Brb,EAAK6G,GAAKK,KAAKqU,IAAI,EAAIrU,KAAKuU,GAAKU,EAAYd,GAAKW,EAAY,EAClE,CAEA,OAAOrV,CACX,CAKA,OAAAyV,CAAQC,EAAiBrH,EAAoB2F,EAAgB,EAAKD,EAAiB,GAC/E,IAAKpgB,KAAK8e,gBAAkB9e,KAAKqe,QAE7B,OADAre,KAAKgJ,OAAOnD,KAAK,mDACV,KAGX,MAAMmc,EAAchiB,KAAKye,aAAavV,IAAI6Y,GAC1C,IAAKC,EAED,OADAhiB,KAAKgJ,OAAOnD,KAAK,2BAA2Bkc,KACrC,KAGX,IAEI,MAAME,EAASjiB,KAAKqe,QAAQ6D,qBACtBC,EAAWniB,KAAKqe,QAAQiB,aACxB8C,EAAW,GAAGL,KAAW1b,KAAKC,SAASsG,KAAK2U,WAclD,IAAIc,EAXJJ,EAAO5V,OAAS2V,EAAY3V,OAC5B4V,EAAO9B,KAAO6B,EAAY7B,KAC1B8B,EAAOK,aAAaC,MAAQlC,EAG5B8B,EAASK,KAAKD,MAAQP,EAAY5B,OAASA,EAG3C6B,EAAO1C,QAAQ4C,GAIXniB,KAAKiF,OAAOpB,oBAAsB6W,GAClC2H,EAAariB,KAAKqe,QAAQoE,eAC1BJ,EAAWK,aAAe,OAC1BL,EAAWM,cAAgB,UAC3BN,EAAWO,YAAc,IACzBP,EAAWlF,YAAc,IACzBkF,EAAWQ,cAAgB,EAG3BR,EAAWS,UAAUP,MAAQ7H,EAAShO,EACtC2V,EAAWU,UAAUR,MAAQ7H,EAAS/N,EACtC0V,EAAWW,UAAUT,MAAQ,EAE7BJ,EAAS5C,QAAQ8C,GACjBA,EAAW9C,QAAQvf,KAAKwe,UAExB2D,EAAS5C,QAAQvf,KAAKwe,SAI1B,MAAMyE,EAA2B,CAC7BvM,GAAI0L,EACJc,KAAMjB,EACNE,WACAE,aACA3H,WACAyI,WAAW,EACXhD,KAAM6B,EAAY7B,KAClBlX,UAAWjJ,KAAKqe,QAAQ+E,aAc5B,OAXApjB,KAAK0e,cAAc3V,IAAIqZ,EAAUa,GAGjChB,EAAOoB,QAAU,KACbrjB,KAAK0e,cAActV,OAAOgZ,IAI9BH,EAAOzZ,QAEPxI,KAAKgJ,OAAOxD,MAAM,kBAAkBuc,MAAYK,MACzCA,CAEX,OAAStc,GAEL,OADA9F,KAAKgJ,OAAOlD,MAAM,yBAAyBic,IAAWjc,GAC/C,IACX,CACJ,CAKA,SAAAwd,CAAUlB,GACN,MAAMa,EAAcjjB,KAAK0e,cAAcxV,IAAIkZ,GAC3C,GAAIa,GAAeA,EAAYE,UAC3B,IACIF,EAAYC,KAAKK,OACjBN,EAAYE,WAAY,EACxBnjB,KAAK0e,cAActV,OAAOgZ,GAC1BpiB,KAAKgJ,OAAOxD,MAAM,kBAAkB4c,IACxC,OAAStc,GACL9F,KAAKgJ,OAAOlD,MAAM,yBAAyBsc,IAAYtc,EAC3D,CAER,CAKA,kBAAA0d,CAAmBpB,EAAkB1H,GACjC,MAAMuI,EAAcjjB,KAAK0e,cAAcxV,IAAIkZ,GACvCa,GAAeA,EAAYZ,aAC3BY,EAAYZ,WAAWS,UAAUP,MAAQ7H,EAAShO,EAClDuW,EAAYZ,WAAWU,UAAUR,MAAQ7H,EAAS/N,EAClDsW,EAAYvI,SAAWA,EAE/B,CAKA,mBAAA+I,CAAoB/I,EAAmBgJ,EAAsB,GACzD,IAAK1jB,KAAKqe,UAAYre,KAAKiF,OAAOpB,mBAAoB,OAEtD,MAAM8f,EAAW3jB,KAAKqe,QAAQsF,SAC1BA,EAASb,YACTa,EAASb,UAAUP,MAAQ7H,EAAShO,EACpCiX,EAASZ,UAAUR,MAAQ7H,EAAS/N,EACpCgX,EAASX,UAAUT,MAAQ,EAG3BoB,EAASC,SAASrB,MAAQ3V,KAAKiX,IAAIH,GACnCC,EAASG,SAASvB,MAAQ3V,KAAKqU,IAAIyC,GACnCC,EAASI,SAASxB,MAAQ,EAE1BoB,EAASK,IAAIzB,MAAQ,EACrBoB,EAASM,IAAI1B,MAAQ,EACrBoB,EAASO,IAAI3B,MAAQ,EAE7B,CAKA,eAAA9C,CAAgBW,GACZpgB,KAAKiF,OAAO8Z,aAAenS,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,EAAGiQ,IAC/CpgB,KAAKse,aACLte,KAAKse,WAAWkE,KAAKD,MAAQviB,KAAKiF,OAAO8Z,aAEjD,CAEA,cAAAW,CAAeU,GACXpgB,KAAKiF,OAAO+Z,YAAcpS,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,EAAGiQ,IAC9CpgB,KAAKue,YACLve,KAAKue,UAAUiE,KAAKD,MAAQviB,KAAKiF,OAAO+Z,YAEhD,CAEA,YAAAW,CAAaS,GACTpgB,KAAKiF,OAAOga,UAAYrS,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,EAAGiQ,IAC5CpgB,KAAKwe,UACLxe,KAAKwe,QAAQgE,KAAKD,MAAQviB,KAAKiF,OAAOga,UAE9C,CAKA,eAAAkF,GACI,OAAOnkB,KAAK8hB,QAAQ,qBAAiB,EAAW,EAAK,GACzD,CAEA,cAAAsC,CAAe1J,GACX,OAAO1a,KAAK8hB,QAAQ,eAAgBpH,EAAU,EAA8B,IAAvB9N,KAAK2U,SAAW,IACzE,CAEA,aAAA8C,CAAc3J,GACV,OAAO1a,KAAK8hB,QAAQ,YAAapH,EAAU,EAAK,GACpD,CAEA,UAAA4J,GACI,OAAOtkB,KAAK8hB,QAAQ,UACxB,CAKA,MAAAtN,CAAOC,GAEH,IAAA,MAAYiC,EAAIuL,KAAWjiB,KAAK0e,cACvBuD,EAAOkB,WAAclB,EAAO9B,MAC7BngB,KAAK0e,cAActV,OAAOsN,EAGtC,CAKA,QAAA6N,GACQvkB,KAAKqe,SAAkC,YAAvBre,KAAKqe,QAAQhH,QAC7BrX,KAAKqe,QAAQmG,UACbxkB,KAAKgJ,OAAOxD,MAAM,gBAE1B,CAKA,SAAAif,GACQzkB,KAAKqe,SAAkC,cAAvBre,KAAKqe,QAAQhH,QAC7BrX,KAAKqe,QAAQ0B,SACb/f,KAAKgJ,OAAOxD,MAAM,iBAE1B,CAKA,OAAAkf,GACI,IAAA,MAAYhO,EAAIuL,KAAWjiB,KAAK0e,cAC5B,GAAIuD,EAAOkB,UACP,IACIlB,EAAOiB,KAAKK,MAChB,OAASzd,GAET,CAGR9F,KAAK0e,cAAcxW,QACnBlI,KAAKgJ,OAAOxD,MAAM,oBACtB,CAKA,QAAA+X,GACI,MAAO,CACHuB,cAAe9e,KAAK8e,cACpB6F,aAAc3kB,KAAKqe,SAAShH,OAAS,OACrCqH,cAAe1e,KAAK0e,cAAcrT,KAClCoT,aAAcze,KAAKye,aAAapT,KAChCpG,OAAQ,IAAKjF,KAAKiF,QAE1B,CAKA,OAAAqM,GACItR,KAAK0kB,UAED1kB,KAAKqe,SACLre,KAAKqe,QAAQuG,QAGjB5kB,KAAKye,aAAavW,QAClBlI,KAAK6e,WAAW3W,QAEhBlI,KAAKgJ,OAAOpD,KAAK,oCACrB,EC5iBG,IAAKif,GAAAA,IACRA,EAAA,OAAS,SACTA,EAAA,MAAQ,QACRA,EAAA,UAAY,YACZA,EAAA,KAAO,OACPA,EAAA,QAAU,UACVA,EAAA,KAAO,OACPA,EAAA,OAAS,SACTA,EAAA,OAAS,SACTA,EAAA,cAAgB,gBAChBA,EAAA,QAAU,UACVA,EAAA,GAAK,KACLA,EAAA,OAAS,SAZDA,IAAAA,GAAA,CAAA,GA4GL,MAAMC,EAiCT,WAAAhgB,CAAYigB,EAAsB,IAhClC/kB,KAAQglB,aAAoC,KAC5ChlB,KAAQse,WAA8B,KACtCte,KAAQilB,iBAAoC,KAC5CjlB,KAAQue,UAA6B,KAGrCve,KAAQklB,aAA8B,KACtCllB,KAAQmlB,kBAKCrc,IAGT9I,KAAQolB,iBAAmCxN,IAG3C5X,KAAQqlB,YAAkC,KAG1CrlB,KAAQslB,UAAkC,KAC1CtlB,KAAQulB,aAAmC,KAG3CvlB,KAAQ+e,aAAuB,GAC/B/e,KAAQgf,YAAsB,GAC9Bhf,KAAQif,UAAoB,GAMxBjf,KAAKgJ,OAAS,IAAIO,EAAO,mBACzBvJ,KAAK+kB,OAASA,CAClB,CAKA,gBAAMpa,GACF,IAEI3K,KAAKglB,aAAe,IAAK9kB,OAAOif,cAAiBjf,OAAekf,oBAEhC,cAA5Bpf,KAAKglB,aAAa3N,aACZrX,KAAKglB,aAAajF,SAI5B/f,KAAKse,WAAate,KAAKglB,aAAa1F,aACpCtf,KAAKilB,iBAAmBjlB,KAAKglB,aAAa1F,aAC1Ctf,KAAKue,UAAYve,KAAKglB,aAAa1F,aAGnCtf,KAAKilB,iBAAiB1F,QAAQvf,KAAKse,YACnCte,KAAKue,UAAUgB,QAAQvf,KAAKse,YAC5Bte,KAAKse,WAAWiB,QAAQvf,KAAKglB,aAAaxF,aAG1Cxf,KAAKse,WAAWkE,KAAKD,MAAQviB,KAAK+e,aAClC/e,KAAKilB,iBAAiBzC,KAAKD,MAAQviB,KAAKif,UACxCjf,KAAKue,UAAUiE,KAAKD,MAAQviB,KAAKgf,kBAG3Bhf,KAAKwlB,0BAGLxlB,KAAKylB,qBAEXzlB,KAAKgJ,OAAOpD,KAAK,yCAErB,OAASE,GACL9F,KAAKgJ,OAAOlD,MAAM,oCAAqCA,GACvD9F,KAAK+kB,OAAOW,eAAe5f,EAC/B,CACJ,CAKA,uBAAc0f,GACV,IAAKxlB,KAAKglB,aAAc,OAExB,MAAMW,EAA4C,EAA/B3lB,KAAKglB,aAAa9F,WACrClf,KAAKqlB,YAAcrlB,KAAKglB,aAAanE,aAAa,EAAG8E,EAAY3lB,KAAKglB,aAAa9F,YAEnF,MAAM0G,EAAS5lB,KAAKqlB,YAAYvE,eAAe,GAC/C,IAAA,IAASvU,EAAI,EAAGA,EAAIoZ,EAAYpZ,IAC5BqZ,EAAOrZ,GAAqB,EAAhBK,KAAK2U,SAAe,CAExC,CAKA,wBAAckE,GACV,IAAKzlB,KAAKglB,aAAc,OAExB,MAAMpe,EAAwC,EAA/B5G,KAAKglB,aAAa9F,WACjClf,KAAKulB,aAAevlB,KAAKglB,aAAanE,aAAa,EAAGja,EAAQ5G,KAAKglB,aAAa9F,YAEhF,IAAA,IAAS2G,EAAU,EAAGA,EAAU,EAAGA,IAAW,CAC1C,MAAMC,EAAc9lB,KAAKulB,aAAazE,eAAe+E,GACrD,IAAA,IAAStZ,EAAI,EAAGA,EAAI3F,EAAQ2F,IAAK,CAC7B,MAAMwZ,EAAQnZ,KAAK+D,IAAI,EAAIpE,EAAI3F,EAAQ,GACvCkf,EAAYvZ,IAAsB,EAAhBK,KAAK2U,SAAe,GAAKwE,CAC/C,CACJ,CAEA/lB,KAAKslB,UAAYtlB,KAAKglB,aAAagB,kBACnChmB,KAAKslB,UAAUjZ,OAASrM,KAAKulB,YACjC,CAKA,SAAAU,CAAUhhB,GACN,GAAKjF,KAAKglB,cAAiBhlB,KAAKilB,iBAKhC,IACI,MAAM3e,EAAMtG,KAAKglB,aAAa5B,YAC9B,IAAInB,EACAiE,EAcAC,EASAC,EAMA/D,EAzBAJ,EADoB,UAApBhd,EAAOohB,SACErmB,KAAKsmB,oBAELtmB,KAAKumB,uBAAuBthB,GAIzCihB,EAAalmB,KAAKglB,aAAa1F,aAC/B4G,EAAW1D,KAAKD,MAAQ,EAIpBtd,EAAO+C,SACPme,EAAanmB,KAAKglB,aAAawB,qBAC/BL,EAAWliB,KAAOgB,EAAO+C,OAAO/D,KAChCkiB,EAAWtE,UAAUU,MAAQtd,EAAO+C,OAAO6Z,UAC3CsE,EAAWM,EAAElE,MAAQtd,EAAO+C,OAAO0e,WAKnCzhB,EAAO0hB,YAAc1hB,EAAO0hB,WAAa,IACzCP,EAAiBpmB,KAAK4mB,iBAAiB3hB,EAAO0hB,aAK9C1hB,EAAOyV,WACP2H,EAAariB,KAAKglB,aAAavC,eAC/BJ,EAAWK,aAAe,OAC1BL,EAAWS,UAAUP,MAAQtd,EAAOyV,SAAShO,EAC7C2V,EAAWU,UAAUR,MAAQtd,EAAOyV,SAAS/N,EAC7C0V,EAAWW,UAAUT,MAAQtd,EAAOyV,SAASmM,EAC7CxE,EAAWlF,YAAclY,EAAOkY,aAAe,KAInD,IAAI2J,EAAyB7E,EAEzBkE,IACAW,EAAYvH,QAAQ4G,GACpBW,EAAcX,GAGdC,IACAU,EAAYvH,QAAQ6G,GACpBU,EAAcV,GAGlBU,EAAYvH,QAAQ2G,GAEhB7D,GACA6D,EAAW3G,QAAQ8C,GACnBA,EAAW9C,QAAQvf,KAAKilB,mBAExBiB,EAAW3G,QAAQvf,KAAKilB,kBAI5BjlB,KAAK+mB,cAAcb,EAAW1D,KAAMvd,EAAQqB,GAGxCrB,EAAO+hB,qBAAuB/E,aAAkBgF,gBAChDjnB,KAAKknB,yBAAyBjF,EAAQhd,EAAO+hB,oBAAqB1gB,GAItE2b,EAAOzZ,MAAMlC,GACb2b,EAAOsB,KAAKjd,EAAMrB,EAAOkE,UAGzBnJ,KAAKolB,aAAa5P,IAAIyM,GACtBA,EAAOpP,iBAAiB,QAAS,KAC7B7S,KAAKolB,aAAahc,OAAO6Y,KAG7BjiB,KAAK+kB,OAAOoC,gBAAgBliB,EAAOhB,KAAMgB,EAE7C,OAASa,GACL9F,KAAKgJ,OAAOlD,MAAM,uBAAwBA,EAC9C,MA1FI9F,KAAKgJ,OAAOnD,KAAK,+BA2FzB,CAKQ,sBAAA0gB,CAAuBthB,GAC3B,MAAMmiB,EAAapnB,KAAKglB,aAAcqC,mBAuBtC,OAtBAD,EAAWnjB,KAAOgB,EAAOohB,SACzBe,EAAWvF,UAAUU,MAAQtd,EAAO4c,UAGhC5c,EAAOqiB,WAEPriB,EAAOqiB,UAAUnY,QAAQ,CAACoY,EAAUza,KAChC,GAAIya,EAAW,EAAG,CACd,MAAMC,EAAcxnB,KAAKglB,aAAcqC,mBACjCI,EAAeznB,KAAKglB,aAAc1F,aAExCkI,EAAYvjB,KAAOgB,EAAOohB,SAC1BmB,EAAY3F,UAAUU,MAAQtd,EAAO4c,WAAa/U,EAAQ,GAC1D2a,EAAajF,KAAKD,MAAQgF,EAE1BC,EAAYjI,QAAQkI,EAGxB,IAIDL,CACX,CAKQ,iBAAAd,GACJ,MAAMrE,EAASjiB,KAAKglB,aAAc9C,qBAGlC,OAFAD,EAAO5V,OAASrM,KAAKqlB,YACrBpD,EAAO9B,MAAO,EACP8B,CACX,CAKQ,gBAAA2E,CAAiBc,GACrB,MAAMf,EAAa3mB,KAAKglB,aAAc2C,mBAChC/G,EAAU,MACVgH,EAAQ,IAAIC,aAAajH,GACzBkH,EAAMlb,KAAKuU,GAAK,IAEtB,IAAA,IAAS5U,EAAI,EAAGA,EAAIqU,EAASrU,IAAK,CAC9B,MAAMG,EAAS,EAAJH,EAASqU,EAAU,EAC9BgH,EAAMrb,IAAO,EAAImb,GAAUhb,EAAI,GAAKob,GAAQlb,KAAKuU,GAAKuG,EAAS9a,KAAKW,IAAIb,GAC5E,CAKA,OAHAia,EAAWiB,MAAQA,EACnBjB,EAAWoB,WAAa,KAEjBpB,CACX,CAKQ,aAAAI,CAAciB,EAAuB/iB,EAAqBgE,GAC9D,MAAMgf,OAAEA,EAAAlC,MAAQA,EAAAmC,QAAOA,UAASC,EAAA/H,OAASA,EAAAjX,SAAQA,GAAalE,EAG9D+iB,EAAUI,eAAe,EAAGnf,GAC5B+e,EAAUK,wBAAwBjI,EAAQnX,EAAYgf,GAGtDD,EAAUK,wBAAwBjI,EAAS8H,EAASjf,EAAYgf,EAASlC,GAGzE,MAAMuC,EAAa1b,KAAKoC,IAAI/F,EAAYgf,EAASlC,EAAO9c,EAAYE,EAAWgf,GAC/EH,EAAUI,eAAehI,EAAS8H,EAASI,GAG3CN,EAAUK,wBAAwB,EAAGpf,EAAYE,EACrD,CAKQ,wBAAA+d,CACJE,EACAmB,EACAtf,GAEA,MAAMuf,EAAgBxoB,KAAKglB,aAAcqC,mBACnCoB,EAAUzoB,KAAKglB,aAAc1F,aAEnCkJ,EAAcvkB,KAAOskB,EAAUlC,SAC/BmC,EAAc3G,UAAUU,MAAQgG,EAAUG,KAC1CD,EAAQjG,KAAKD,MAAQgG,EAAUI,MAE/BH,EAAcjJ,QAAQkJ,GACtBA,EAAQlJ,QAAQ6H,EAAWvF,WAE3B2G,EAAchgB,MAAMS,GACpBuf,EAAcjF,KAAKta,EAAY,GACnC,CAKA,cAAA2f,CAAe3kB,EAAiB4kB,EAAoB,GAChD,MAAMC,EAA+C,CACjDC,OAAoB,CAChB9kB,KAAM,SACN4d,UAAW,GAAiB,GAAZgH,EAChB1f,SAAU,GACViX,OAAQ,GAAMyI,EACdxC,SAAU,WACV4B,OAAQ,GACRlC,MAAO,GACPmC,QAAS,GACTC,QAAS,GACTngB,OAAQ,CACJ/D,KAAM,UACN4d,UAAW,IAAkB,IAAZgH,EACjBnC,UAAW,IAGnBsC,MAAmB,CACf/kB,KAAM,QACN4d,UAAW,IACX1Y,SAAU,IACViX,OAAQ,GAAMyI,EACdxC,SAAU,SACV4B,OAAQ,IACRlC,MAAO,IACPmC,QAAS,GACTC,QAAS,IACTnB,oBAAqB,CACjB0B,KAAM,GACNC,MAAO,IACPtC,SAAU,SAGlB4C,UAAuB,CACnBhlB,KAAM,YACN4d,UAAW,IACX1Y,SAAU,GACViX,OAAQ,GAAMyI,EACdxC,SAAU,QACV4B,OAAQ,IACRlC,MAAO,GACPmC,QAAS,GACTC,QAAS,IACTngB,OAAQ,CACJ/D,KAAM,UACN4d,UAAW,IAAmB,IAAZgH,EAClBnC,UAAW,GAEfC,WAAY,IAEhBuC,KAAkB,CACdjlB,KAAM,OACN4d,UAAW,IACX1Y,SAAU,GACViX,OAAQ,GAAMyI,EACdxC,SAAU,SACV4B,OAAQ,IACRlC,MAAO,IACPmC,QAAS,GACTC,QAAS,KAEbgB,QAAqB,CACjBllB,KAAM,UACN4d,UAAW,IACX1Y,SAAU,GACViX,OAAQ,GAAMyI,EACdxC,SAAU,SACV4B,OAAQ,IACRlC,MAAO,GACPmC,QAAS,GACTC,QAAS,IACTnB,oBAAqB,CACjB0B,KAAM,EACNC,MAAO,IACPtC,SAAU,aAGlB+C,KAAkB,CACdnlB,KAAM,OACN4d,UAAW,IACX1Y,SAAU,EACViX,OAAQ,GAAMyI,EACdxC,SAAU,OACV4B,OAAQ,GACRlC,MAAO,GACPmC,QAAS,GACTC,QAAS,EACTnB,oBAAqB,CACjB0B,KAAM,GACNC,MAAO,IACPtC,SAAU,QAEdgD,OAAQ,CACJC,SAAU,GACVC,UAAW,GACXC,QAAS,KAGjBC,OAAoB,CAChBxlB,KAAM,SACN4d,UAAW,IACX1Y,SAAU,GACViX,OAAQ,GAAMyI,EACdxC,SAAU,WACV4B,OAAQ,GACRlC,MAAO,GACPmC,QAAS,GACTC,QAAS,GACTngB,OAAQ,CACJ/D,KAAM,WACN4d,UAAW,IACX6E,UAAW,IAGnBgD,OAAoB,CAChBzlB,KAAM,SACN4d,UAAW,GACX1Y,SAAU,GACViX,OAAQ,GAAMyI,EACdxC,SAAU,QACV4B,OAAQ,IACRlC,MAAO,IACPmC,QAAS,GACTC,QAAS,IACTngB,OAAQ,CACJ/D,KAAM,UACN4d,UAAW,IACX6E,UAAW,GAEfC,WAAY,IAEhBgD,cAA2B,CACvB1lB,KAAM,gBACN4d,UAAW,KACX1Y,SAAU,GACViX,OAAQ,IAAOyI,EACfxC,SAAU,OACV4B,OAAQ,GACRlC,MAAO,GACPmC,QAAS,GACTC,QAAS,GACTnB,oBAAqB,CACjB0B,KAAM,EACNC,MAAO,GACPtC,SAAU,aAGlBuD,QAAqB,CACjB3lB,KAAM,UACN4d,UAAW,IACX1Y,SAAU,EACViX,OAAQ,GAAMyI,EACdxC,SAAU,OACV4B,OAAQ,EACRlC,MAAO,EACPmC,QAAS,GACTC,QAAS,GAEb0B,GAAgB,CACZ5lB,KAAM,KACN4d,UAAW,IACX1Y,SAAU,IACViX,OAAQ,GAAMyI,EACdxC,SAAU,SACV4B,OAAQ,IACRlC,MAAO,IACPmC,QAAS,GACTC,QAAS,KAEbzP,OAAoB,CAChBzU,KAAM,SACN4d,UAAW,IAAkB,GAAZgH,EACjB1f,SAAU,GACViX,OAAQ,GAAMyI,EACdxC,SAAU,WACV4B,OAAQ,IACRlC,MAAO,GACPmC,QAAS,GACTC,QAAS,IACTngB,OAAQ,CACJ/D,KAAM,UACN4d,UAAW,IAAkB,IAAZgH,EACjBnC,UAAW,KAKvB1mB,KAAKimB,UAAU6C,EAAQ7kB,GAC3B,CAKA,iBAAA6lB,CAAkBC,GACd,GAAI/pB,KAAKklB,eAAiB6E,EAAW,OAErC/pB,KAAKgqB,mBAEL,MAiIM/kB,EAjIsD,CACxDglB,WAAc,CACVhkB,KAAM,aACNikB,WAAY,EACZC,YAAa,EACbC,cAAe,EACfC,OAAQ,CACJ,CACI3T,GAAI,aACJ2P,SAAU,OACViE,cAAe,GACflK,OAAQ,GACRmK,IAAK,EACLC,mBAAoB,GACpBC,gBAAiB,GACjB5I,UAAW,CAAE1R,IAAK,GAAInB,IAAK,GAAIwL,MAAO,IACtCxS,OAAQ,CACJ/D,KAAM,UACNymB,QAAS,IACTC,QAAS,IACTnQ,MAAO,IACPkM,UAAW,IAGnB,CACIhQ,GAAI,cACJ2P,SAAU,QACViE,cAAe,IACflK,OAAQ,IACRmK,KAAK,GACLC,mBAAoB,GACpBC,gBAAiB,GACjB5I,UAAW,CAAE1R,IAAK,IAAKnB,IAAK,IAAKwL,MAAO,IACxCxS,OAAQ,CACJ/D,KAAM,WACNymB,QAAS,IACTC,QAAS,IACTnQ,MAAO,GACPkM,UAAW,IAGnB,CACIhQ,GAAI,oBACJ2P,SAAU,WACViE,cAAe,IACflK,OAAQ,GACRmK,IAAK,GACLC,mBAAoB,GACpBC,gBAAiB,GACjB5I,UAAW,CAAE1R,IAAK,IAAKnB,IAAK,IAAKwL,MAAO,KACxCxS,OAAQ,CACJ/D,KAAM,WACNymB,QAAS,IACTC,QAAS,KACTnQ,MAAO,GACPkM,UAAW,OAK3BkE,aAAgB,CACZ3kB,KAAM,eACNikB,WAAY,EACZC,YAAa,EACbC,cAAe,EACfC,OAAQ,CACJ,CACI3T,GAAI,cACJ2P,SAAU,OACViE,cAAe,GACflK,OAAQ,IACRmK,IAAK,EACLC,mBAAoB,GACpBC,gBAAiB,GACjB5I,UAAW,CAAE1R,IAAK,GAAInB,IAAK,IAAKwL,MAAO,KACvCxS,OAAQ,CACJ/D,KAAM,UACNymB,QAAS,IACTC,QAAS,KACTnQ,MAAO,IACPkM,UAAW,IAGnB,CACIhQ,GAAI,mBACJ2P,SAAU,WACViE,cAAe,IACflK,OAAQ,GACRmK,KAAK,GACLC,mBAAoB,GACpBC,gBAAiB,GACjB5I,UAAW,CAAE1R,IAAK,IAAKnB,IAAK,KAAMwL,MAAO,IACzCxS,OAAQ,CACJ/D,KAAM,WACNymB,QAAS,IACTC,QAAS,IACTnQ,MAAO,GACPkM,UAAW,MAK3BmE,aAAgB,CACZ5kB,KAAM,eACNikB,WAAY,EACZC,YAAa,EACbC,cAAe,EACfC,OAAQ,CACJ,CACI3T,GAAI,kBACJ2P,SAAU,OACViE,cAAe,GACflK,OAAQ,IACRmK,IAAK,EACLC,mBAAoB,IACpBC,gBAAiB,GACjB5I,UAAW,CAAE1R,IAAK,GAAInB,IAAK,GAAIwL,MAAO,KACtCxS,OAAQ,CACJ/D,KAAM,UACNymB,QAAS,IACTC,QAAS,IACTnQ,MAAO,IACPkM,UAAW,OAOHqD,GACvB9kB,GAKLjF,KAAKklB,aAAe6E,EACpB/pB,KAAK8qB,oBAAoB7lB,GAEzBjF,KAAK+kB,OAAOgG,iBAAiBhB,GAC7B/pB,KAAKgJ,OAAOpD,KAAK,6BAA6BmkB,MAR1C/pB,KAAKgJ,OAAOnD,KAAK,0BAA0BkkB,IASnD,CAKQ,mBAAAe,CAAoB7lB,GACxB,IAAKjF,KAAKglB,eAAiBhlB,KAAKue,UAAW,OAE3C,MAAMjY,EAAMtG,KAAKglB,aAAa5B,YAE9Bne,EAAOolB,OAAOlb,QAAQ6b,IAClB,IAAI/I,EAEJ,GAA6B,UAAzB+I,EAAY3E,SACZpE,EAASjiB,KAAKglB,aAAc9C,qBAC3BD,EAAiC5V,OAASrM,KAAKqlB,YAC/CpD,EAAiC9B,MAAO,MACtC,CACH,MAAMiH,EAAapnB,KAAKglB,aAAcqC,mBACtCD,EAAWnjB,KAAO+mB,EAAY3E,SAC9Be,EAAWvF,UAAUU,MAAQyI,EAAYV,cACzCrI,EAASmF,CACb,CAGA,MAAM6D,EAAYjrB,KAAKglB,aAAc1F,aACrC2L,EAAUzI,KAAKD,MAAQ,EAGvB,MAAM2I,EAASlrB,KAAKglB,aAAcmG,qBAIlC,IAAInjB,EAHJkjB,EAAOX,IAAIhI,MAAQyI,EAAYT,IAI3BS,EAAYhjB,SACZA,EAAShI,KAAKglB,aAAcwB,qBAC5Bxe,EAAO/D,KAAO+mB,EAAYhjB,OAAO/D,KACjC+D,EAAO6Z,UAAUU,MAAQyI,EAAYhjB,OAAO0iB,QAC5C1iB,EAAOye,EAAElE,MAAQyI,EAAYhjB,OAAO0e,WAIxC,IAAII,EAAyB7E,EAEzBja,IACA8e,EAAYvH,QAAQvX,GACpB8e,EAAc9e,GAGlB8e,EAAYvH,QAAQ0L,GACpBA,EAAU1L,QAAQ2L,GAClBA,EAAO3L,QAAQvf,KAAKue,WAGpB0M,EAAUzI,KAAK6F,wBACX2C,EAAY5K,OACZ9Z,EAAMrB,EAAOilB,YAIjBjI,EAAOzZ,MAAMlC,GAGbtG,KAAKmlB,cAAcpc,IAAIiiB,EAAYtU,GAAI,CACnC0Q,WAAYnF,EACZO,KAAMyI,EACNjjB,SACAkjB,WAIAjJ,aAAkBgF,gBAClBjnB,KAAKorB,qBAAqBnJ,EAAQ+I,EAAahjB,IAG3D,CAKQ,oBAAAojB,CACJhE,EACAniB,EACA+C,GAEA,IAAKhI,KAAKglB,aAAc,OAGxB,MAAMqG,EAAarrB,KAAKglB,aAAaqC,mBAC/BiE,EAActrB,KAAKglB,aAAa1F,aAWtC,GATA+L,EAAWpnB,KAAO,OAClBonB,EAAWxJ,UAAUU,MAAQtd,EAAO4c,UAAUrH,MAC9C8Q,EAAY9I,KAAKD,OAAStd,EAAO4c,UAAU7S,IAAM/J,EAAO4c,UAAU1R,KAAO,EAEzEkb,EAAW9L,QAAQ+L,GACnBA,EAAY/L,QAAQ6H,EAAWvF,WAC/BwJ,EAAW7iB,QAGPR,GAAU/C,EAAO+C,OAAQ,CACzB,MAAMujB,EAAevrB,KAAKglB,aAAaqC,mBACjCmE,EAAgBxrB,KAAKglB,aAAa1F,aAExCiM,EAAatnB,KAAO,WACpBsnB,EAAa1J,UAAUU,MAAQtd,EAAO+C,OAAOwS,MAC7CgR,EAAchJ,KAAKD,OAAStd,EAAO+C,OAAO2iB,QAAU1lB,EAAO+C,OAAO0iB,SAAW,EAE7Ea,EAAahM,QAAQiM,GACrBA,EAAcjM,QAAQvX,EAAO6Z,WAC7B0J,EAAa/iB,OACjB,CACJ,CAKA,gBAAAwhB,GACI,IAAKhqB,KAAKklB,eAAiBllB,KAAKglB,aAAc,OAE9C,MAAM1e,EAAMtG,KAAKglB,aAAa5B,YAI9BpjB,KAAKmlB,cAAchW,QAAQsc,IACvBA,EAAMjJ,KAAKA,KAAK6F,wBAAwB,EAAG/hB,EAJ9B,GAKbmlB,EAAMrE,WAAW7D,KAAKjd,EALT,EAK0B,MAI3ColB,WAAW,KACP1rB,KAAKmlB,cAAcjd,SACvB,MAEAlI,KAAKklB,aAAe,KACpBllB,KAAKgJ,OAAOpD,KAAK,2BACrB,CAKA,eAAA6Z,CAAgBW,GACZpgB,KAAK+e,aAAenS,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,EAAGiQ,IACxCpgB,KAAKse,aACLte,KAAKse,WAAWkE,KAAKD,MAAQviB,KAAK+e,aAE1C,CAKA,cAAAW,CAAeU,GACXpgB,KAAKgf,YAAcpS,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,EAAGiQ,IACvCpgB,KAAKue,YACLve,KAAKue,UAAUiE,KAAKD,MAAQviB,KAAKgf,YAEzC,CAKA,YAAA2M,CAAavL,GACTpgB,KAAKif,UAAYrS,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,EAAGiQ,IACrCpgB,KAAKilB,mBACLjlB,KAAKilB,iBAAiBzC,KAAKD,MAAQviB,KAAKif,UAEhD,CAKA,aAAA2M,GASI,MAAO,CACHjH,aAAc3kB,KAAKglB,cAAc3N,OAAS,kBAC1C+N,aAAcplB,KAAKolB,aAAa/Z,KAChC6Z,aAAcllB,KAAKklB,aACnBC,cAAenlB,KAAKmlB,cAAc9Z,KAClC0T,aAAc/e,KAAK+e,aACnBC,YAAahf,KAAKgf,YAClBC,UAAWjf,KAAKif,UAExB,CAKA,aAAA4M,GAEI7rB,KAAKolB,aAAajW,QAAQ2c,IACtB,GAAIA,aAAiBC,yBACjB,IACID,EAAMvI,MACV,OAAS9Q,GAET,IAGRzS,KAAKolB,aAAald,QAGlBlI,KAAKgqB,kBACT,CAKA,OAAAgC,GACIhsB,KAAK6rB,gBAED7rB,KAAKglB,eACLhlB,KAAKglB,aAAaJ,QAClB5kB,KAAKglB,aAAe,MAGxBhlB,KAAKgJ,OAAOpD,KAAK,2BACrB,EC54BG,MAAMqmB,EAoCT,WAAAnnB,CACIigB,EACAthB,EACAuG,GAtCJhK,KAAQ+R,aAA0B,YAClC/R,KAAQiS,cAAkC,KAG1CjS,KAAQmX,QAAwB,GAChCnX,KAAQksB,oBAA8B,EACtClsB,KAAQmsB,cAAwB,EAChCnsB,KAAQosB,mBAA6B,EACrCpsB,KAAQqsB,iBAA2B,EAOnCrsB,KAAQssB,oBAAgC,GACxCtsB,KAAQusB,UAAoB,EAC5BvsB,KAAQwsB,cAAwB,EAGhCxsB,KAAQysB,UAQH,GAGLzsB,KAAQyD,MAAgC,KACxCzD,KAAQgK,UAAmC,KAQvChK,KAAKgJ,OAAS,IAAIO,EAAO,YACzBvJ,KAAK+kB,OAASA,EACd/kB,KAAKyD,MAAQA,GAAS,KACtBzD,KAAKgK,UAAYA,GAAa,KAG9BhK,KAAK0sB,gBAAkB1sB,KAAK2sB,4BAC5B3sB,KAAK4sB,aAAe5sB,KAAK6sB,yBAGzB7sB,KAAK8sB,gBAGL9sB,KAAK+sB,qBAGL/sB,KAAKgtB,yBAELhtB,KAAKgJ,OAAOpD,KAAK,kCACrB,CAKA,MAAA4O,CAAOC,EAAmB9R,GACtB3C,KAAKmsB,eAAiB1X,EAGtBzU,KAAKitB,oBAAoBxY,GAGrBzU,KAAKqsB,gBACLrsB,KAAKktB,iBAAiBzY,IAK1BzU,KAAKmtB,YAAYxqB,GAGjB3C,KAAKotB,sBAAsB3Y,GAC/B,CAKQ,WAAA0Y,CAAYxqB,GAmBhB,OAjBIA,EAAMqV,aAAa,YAAcrV,EAAMqV,aAAa,QACpDhY,KAAKqtB,cACE1qB,EAAMqV,aAAa,cAAgBrV,EAAMqV,aAAa,UAC7DhY,KAAKstB,gBAIL3qB,EAAMqV,aAAa,UAAYrV,EAAMqV,aAAa,WAClDhY,KAAKutB,eAIL5qB,EAAMqV,aAAa,WACnBhY,KAAKwtB,SAIDxtB,KAAK+R,cACT,IAAK,WACD/R,KAAKytB,mBAAmB9qB,GACxB,MACJ,IAAK,WACD3C,KAAK0tB,oBAAoB/qB,GAKjC3C,KAAK2tB,cAAchrB,EACvB,CAKQ,UAAA0qB,GACJ,GAA4B,IAAxBrtB,KAAKmX,QAAQvQ,OAAjB,CAEA5G,KAAK4tB,YAAY,cAEjB,GACI5tB,KAAKksB,qBAAuBlsB,KAAKksB,oBAAsB,EAAIlsB,KAAKmX,QAAQvQ,QAAU5G,KAAKmX,QAAQvQ,cACzF5G,KAAKmX,QAAQnX,KAAKksB,qBAAqB2B,SAEjD7tB,KAAK8tB,wBAR0B,CASnC,CAKQ,YAAAR,GACJ,GAA4B,IAAxBttB,KAAKmX,QAAQvQ,OAAjB,CAEA5G,KAAK4tB,YAAY,cAEjB,GACI5tB,KAAKksB,qBAAuBlsB,KAAKksB,oBAAsB,GAAKlsB,KAAKmX,QAAQvQ,cACnE5G,KAAKmX,QAAQnX,KAAKksB,qBAAqB2B,SAEjD7tB,KAAK8tB,wBAR0B,CASnC,CAKQ,YAAAP,GACJ,GAA4B,IAAxBvtB,KAAKmX,QAAQvQ,QAAgB5G,KAAKksB,qBAAuBlsB,KAAKmX,QAAQvQ,OAAQ,OAElF,MAAMqP,EAASjW,KAAKmX,QAAQnX,KAAKksB,qBAC5BjW,EAAO4X,UAEZ7tB,KAAK4tB,YAAY,UACjB3X,EAAO8X,SACX,CAKQ,MAAAP,GAGJ,GAFAxtB,KAAK4tB,YAAY,QAGR,cADD5tB,KAAK+R,aAGL/R,KAAK+kB,OAAOiJ,gBAGZhuB,KAAKiuB,kBAAkB,YAGnC,CAKQ,kBAAAlB,GACJ/sB,KAAKmX,QAAU,CACX,CACIT,GAAI,WACJtI,KAAM,WACN1B,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAKiuB,kBAAkB,YACrCE,OAAQ,QAEZ,CACIzX,GAAI,YACJtI,KAAM,aACN1B,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,QAAS7tB,KAAKouB,eACdF,aAAa,EACbH,OAAQ,IAAM/tB,KAAKiuB,kBAAkB,aACrCE,OAAQ,QAEZ,CACIzX,GAAI,WACJtI,KAAM,YACN1B,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAKiuB,kBAAkB,YACrCE,OAAQ,QAEZ,CACIzX,GAAI,OACJtI,KAAM,UACN1B,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAK+kB,OAAOiJ,WAC1BG,OAAQ,SAIhBnuB,KAAKksB,oBAAsB,EAC3BlsB,KAAKquB,wBACLruB,KAAK8tB,wBACT,CAKQ,qBAAAQ,GACJtuB,KAAKmX,QAAU,CACX,CACIT,GAAI,cACJtI,KAAM,iBAAiBpO,KAAK0sB,gBAAgB6B,aAC5C7hB,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAKwuB,kBAEvB,CACI9X,GAAI,aACJtI,KAAM,eAAepO,KAAK0sB,gBAAgB+B,WAAWC,gBACrDhiB,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAK2uB,mBAEvB,CACIjY,GAAI,cACJtI,KAAM,gBAAgBpO,KAAK0sB,gBAAgBkC,WAAWF,gBACtDhiB,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAK6uB,mBAEvB,CACInY,GAAI,kBACJtI,KAAM,aAAapO,KAAK0sB,gBAAgBoC,eAAeJ,gBACvDhiB,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAK+uB,uBAEvB,CACIrY,GAAI,aACJtI,KAAM,gBAAepO,KAAK0sB,gBAAgBsC,iBAAmB,KAAO,OACpEtiB,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAKivB,oBAEvB,CACIvY,GAAI,WACJtI,KAAM,cAAapO,KAAK0sB,gBAAgBwC,eAAiB,KAAO,OAChExiB,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAKmvB,kBAEvB,CACIzY,GAAI,aACJtI,KAAM,gBACN1B,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAKovB,gBAEvB,CACI1Y,GAAI,OACJtI,KAAM,OACN1B,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAKiuB,kBAAkB,eAI7CjuB,KAAKksB,oBAAsB,EAC3BlsB,KAAKquB,wBACLruB,KAAK8tB,wBACT,CAKQ,sBAAAuB,GACJrvB,KAAKmX,QAAU,GAGf,IAAA,IAAS5K,EAAI,EAAGA,EAAIvM,KAAKysB,UAAU7lB,OAAQ2F,IAAK,CAC5C,MAAM+iB,EAAOtvB,KAAKysB,UAAUlgB,GAE5BvM,KAAKmX,QAAQxQ,KAAK,CACd+P,GAAI,aAAa4Y,EAAKA,OACtBlhB,KAAMkhB,EAAKC,OACP,QAAQD,EAAKA,SAASA,EAAKrpB,UAAUqpB,EAAKE,WAAWF,EAAKG,YAC1D,QAAQH,EAAKA,cACjB5iB,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,QAASyB,EAAKC,OACdrB,aAAa,EACbH,OAAQ,IAAM/tB,KAAK0vB,SAASJ,EAAKA,OAEzC,CAGAtvB,KAAKmX,QAAQxQ,KAAK,CACd+P,GAAI,OACJtI,KAAM,OACN1B,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAKiuB,kBAAkB,eAGzCjuB,KAAKksB,oBAAsB,EAC3BlsB,KAAKquB,wBACLruB,KAAK8tB,wBACT,CAKQ,sBAAA6B,GACJ3vB,KAAKmX,QAAU,CACX,CACIT,GAAI,eACJtI,KAAM,mBAAmBxB,KAAKsE,MAAsC,IAAhClR,KAAK4sB,aAAappB,gBACtDkJ,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAK4vB,qBAEvB,CACIlZ,GAAI,gBACJtI,KAAM,kBAAkBxB,KAAKsE,MAAuC,IAAjClR,KAAK4sB,aAAa7N,iBACrDrS,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAK6vB,sBAEvB,CACInZ,GAAI,eACJtI,KAAM,iBAAiBxB,KAAKsE,MAAsC,IAAhClR,KAAK4sB,aAAa5N,gBACpDtS,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAK8vB,qBAEvB,CACIpZ,GAAI,aACJtI,KAAM,eAAexB,KAAKsE,MAAoC,IAA9BlR,KAAK4sB,aAAa3N,cAClDvS,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAK+vB,mBAEvB,CACIrZ,GAAI,WACJtI,KAAM,cAAapO,KAAK4sB,aAAaoD,QAAU,KAAO,OACtDtjB,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAKiwB,iBAEvB,CACIvZ,GAAI,QACJtI,KAAM,WAAUpO,KAAK4sB,aAAasD,MAAQ,KAAO,OACjDxjB,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAKmwB,eAEvB,CACIzZ,GAAI,iBACJtI,KAAM,gBACN1B,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAKowB,iBAEvB,CACI1Z,GAAI,iBACJtI,KAAM,oBACN1B,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAKqwB,mBAEvB,CACI3Z,GAAI,OACJtI,KAAM,OACN1B,EAAG,EAAGC,EAAG,EAAGlC,MAAO,IAAKC,OAAQ,GAChCmjB,SAAS,EACTK,aAAa,EACbH,OAAQ,IAAM/tB,KAAKiuB,kBAAkB,eAI7CjuB,KAAKksB,oBAAsB,EAC3BlsB,KAAKquB,wBACLruB,KAAK8tB,wBACT,CAOQ,qBAAAO,GAKJ,IAAA,IAAS9hB,EAAI,EAAGA,EAAIvM,KAAKmX,QAAQvQ,OAAQ2F,IAAK,CAC1C,MAAM0J,EAASjW,KAAKmX,QAAQ5K,GAC5B0J,EAAOvJ,EANK,IAMSuJ,EAAOxL,MAAQ,EACpCwL,EAAOtJ,EANI,IACC,GAKQJ,CACxB,CACJ,CAKQ,sBAAAuhB,GACJ,IAAA,IAASvhB,EAAI,EAAGA,EAAIvM,KAAKmX,QAAQvQ,OAAQ2F,IACrCvM,KAAKmX,QAAQ5K,GAAG2hB,YAAe3hB,IAAMvM,KAAKksB,mBAElD,CAKQ,kBAAAuB,CAAmB9qB,GAEnBA,EAAMqV,aAAa,SACnBhY,KAAKswB,oBAEb,CAKQ,mBAAA5C,CAAoB/qB,GACxB,MAAMsT,EAASjW,KAAKmX,QAAQnX,KAAKksB,qBAC5BjW,IAGDtT,EAAMqV,aAAa,aACnBhY,KAAKuwB,kBAAkBta,EAAOS,IACvB/T,EAAMqV,aAAa,eAC1BhY,KAAKwwB,gBAAgBva,EAAOS,IAEpC,CAKQ,aAAAiX,CAAchrB,GAClB,GAA0B,cAAtB3C,KAAK+R,aAET,IAAA,MAAWkE,KAAUjW,KAAKmX,QACtB,GAAIlB,EAAOkY,QAAUxrB,EAAMqV,aAAa/B,EAAOkY,SAAWlY,EAAO4X,QAAS,CACtE7tB,KAAK4tB,YAAY,UACjB3X,EAAO8X,SACP,KACJ,CAER,CAKQ,iBAAAE,CAAkBwC,GAClBzwB,KAAKqsB,kBAETrsB,KAAKiS,cAAgBjS,KAAK+R,aAC1B/R,KAAKqsB,iBAAkB,EACvBrsB,KAAKosB,mBAAqB,EAG1BpsB,KAAK4tB,YAAY,cACjB5tB,KAAK0wB,yBAGLhF,WAAW,KACP1rB,KAAK+R,aAAe0e,EACpBzwB,KAAK2wB,uBAAuBF,IAC7B,KACP,CAKQ,sBAAAE,CAAuBtZ,GAC3B,OAAQA,GACJ,IAAK,YACDrX,KAAK+sB,qBACL,MACJ,IAAK,WACD/sB,KAAKsuB,wBACL,MACJ,IAAK,YACDtuB,KAAKqvB,yBACL,MACJ,IAAK,WACDrvB,KAAK2vB,yBAGjB,CAKQ,gBAAAzC,CAAiBzY,GACrBzU,KAAKosB,oBAAsB3X,EAAY,IAEnCzU,KAAKosB,oBAAsB,IAC3BpsB,KAAKosB,mBAAqB,EAC1BpsB,KAAKqsB,iBAAkB,EAE/B,CAKQ,mBAAAY,CAAoBxY,GAExBzU,KAAKusB,UAAyD,IAA5C3f,KAAKqU,IAAyB,KAArBjhB,KAAKmsB,eAAyB,GAGzDnsB,KAAKwsB,cAAgC,IAAhB5f,KAAK2U,SAG1BvhB,KAAK4wB,0BAA0Bnc,EACnC,CAKQ,qBAAA2Y,CAAsB3Y,GAC1B,GAAKzU,KAAKgK,YAEVhK,KAAKgK,UAAUwK,OAAOC,GAGlB7H,KAAK2U,SAAW,KAAM,CACtB,MAAM7U,EAAoB,IAAhBE,KAAK2U,SACT5U,EAAoB,IAAhBC,KAAK2U,SACfvhB,KAAKgK,UAAU6mB,gBAAgB,CAAEnkB,IAAGC,KAAK,GAC7C,CACJ,CAKQ,sBAAAqgB,GACJ,GAAKhtB,KAAKgK,UAAV,CAGA,IAAA,IAASuC,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,MAAMG,EAAoB,IAAhBE,KAAK2U,SACT5U,EAAoB,IAAhBC,KAAK2U,SACTuP,EAAY9wB,KAAKgK,UAAU+mB,kBAC7B,CAAErkB,IAAGC,KACLC,KAAK2U,SAAW3U,KAAKuU,GAAK,EAC1B,IAEJnhB,KAAKssB,oBAAoB3lB,KAAKmqB,EAClC,CAGI9wB,KAAKyD,OACLzD,KAAKyD,MAAMqmB,kBAAkB,eAhBZ,CAkBzB,CAKQ,yBAAA8G,CAA0Bnc,GAGlC,CAKQ,sBAAAic,GACJ,GAAK1wB,KAAKgK,UAGV,IAAA,IAASuC,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB,MAAMG,EAAoB,IAAhBE,KAAK2U,SACT5U,EAAoB,IAAhBC,KAAK2U,SACfvhB,KAAKgK,UAAU6mB,gBAAgB,CAAEnkB,IAAGC,KAAK,GAC7C,CACJ,CAKQ,WAAAihB,CAAY3pB,GAChB,GAAKjE,KAAKyD,MAEV,OAAQQ,GACJ,IAAK,aACDjE,KAAKyD,MAAMmlB,eAAe/D,EAAUmM,KAAM,IAC1C,MACJ,IAAK,SACDhxB,KAAKyD,MAAMmlB,eAAe/D,EAAUoM,GAAI,IACxC,MACJ,IAAK,OACDjxB,KAAKyD,MAAMmlB,eAAe/D,EAAUoM,GAAI,IACxC,MACJ,IAAK,aACDjxB,KAAKyD,MAAMmlB,eAAe/D,EAAUqM,cAAe,IACnD,MACJ,IAAK,QACDlxB,KAAKyD,MAAMmlB,eAAe/D,EAAUsM,QAAS,IAGzD,CAKQ,cAAA3C,GAEJ,MAAM4C,EAAQ,CAAC,YAAa,UAAW,UAAW,QAAS,YACrDC,EAAeD,EAAME,QAAQtxB,KAAK0sB,gBAAgB6B,YACxDvuB,KAAK0sB,gBAAgB6B,WAAa6C,GAAOC,EAAe,GAAKD,EAAMxqB,QACnE5G,KAAKuxB,uBACT,CAEQ,eAAA5C,GACJ,MAAM6C,EAAgD,CAAC,OAAQ,SAAU,OAAQ,aAC3EH,EAAeG,EAAaF,QAAQtxB,KAAK0sB,gBAAgB+B,YAC/DzuB,KAAK0sB,gBAAgB+B,WAAa+C,GAAcH,EAAe,GAAKG,EAAa5qB,QACjF5G,KAAKuxB,uBACT,CAEQ,eAAA1C,GACJ,MAAM4C,EAAyC,CAAC,QAAS,SAAU,QAAS,QACtEJ,EAAeI,EAAMH,QAAQtxB,KAAK0sB,gBAAgBkC,YACxD5uB,KAAK0sB,gBAAgBkC,WAAa6C,GAAOJ,EAAe,GAAKI,EAAM7qB,QACnE5G,KAAKuxB,uBACT,CAEQ,mBAAAxC,GACJ,MAAM2C,EAAmD,CAAC,MAAO,SAAU,OAAQ,WAC7EL,EAAeK,EAAYJ,QAAQtxB,KAAK0sB,gBAAgBoC,gBAC9D9uB,KAAK0sB,gBAAgBoC,eAAiB4C,GAAaL,EAAe,GAAKK,EAAY9qB,QACnF5G,KAAKuxB,uBACT,CAEQ,gBAAAtC,GACJjvB,KAAK0sB,gBAAgBsC,kBAAoBhvB,KAAK0sB,gBAAgBsC,iBAC9DhvB,KAAKuxB,uBACT,CAEQ,cAAApC,GACJnvB,KAAK0sB,gBAAgBwC,gBAAkBlvB,KAAK0sB,gBAAgBwC,eAC5DlvB,KAAKuxB,uBACT,CAEQ,kBAAAjB,GACJtwB,KAAK0sB,gBAAgBiF,WAAa/kB,KAAK2U,SAASpQ,SAAS,IAAIygB,UAAU,EAAG,GAAGlD,cAC7E1uB,KAAKuxB,uBACT,CAEQ,YAAAnC,GACJpvB,KAAK4tB,YAAY,UACjB5tB,KAAK+kB,OAAO8M,YAAY7xB,KAAK0sB,iBAC7B1sB,KAAKiuB,kBAAkB,aAC3B,CAKQ,iBAAAsC,CAAkBuB,GACtB,OAAQA,GACJ,IAAK,eACD9xB,KAAK4sB,aAAappB,YAAcoJ,KAAKoC,IAAI,GAAKhP,KAAK4sB,aAAappB,YAAc,IAC9E,MACJ,IAAK,gBACDxD,KAAK4sB,aAAa7N,aAAenS,KAAKoC,IAAI,EAAGhP,KAAK4sB,aAAa7N,aAAe,IAC9E,MACJ,IAAK,eACD/e,KAAK4sB,aAAa5N,YAAcpS,KAAKoC,IAAI,EAAGhP,KAAK4sB,aAAa5N,YAAc,IAC5E,MACJ,IAAK,aACDhf,KAAK4sB,aAAa3N,UAAYrS,KAAKoC,IAAI,EAAGhP,KAAK4sB,aAAa3N,UAAY,IAGhFjf,KAAK+xB,wBACT,CAEQ,eAAAvB,CAAgBsB,GACpB,OAAQA,GACJ,IAAK,eACD9xB,KAAK4sB,aAAappB,YAAcoJ,KAAKuD,IAAI,EAAKnQ,KAAK4sB,aAAappB,YAAc,IAC9E,MACJ,IAAK,gBACDxD,KAAK4sB,aAAa7N,aAAenS,KAAKuD,IAAI,EAAKnQ,KAAK4sB,aAAa7N,aAAe,IAChF,MACJ,IAAK,eACD/e,KAAK4sB,aAAa5N,YAAcpS,KAAKuD,IAAI,EAAKnQ,KAAK4sB,aAAa5N,YAAc,IAC9E,MACJ,IAAK,aACDhf,KAAK4sB,aAAa3N,UAAYrS,KAAKuD,IAAI,EAAKnQ,KAAK4sB,aAAa3N,UAAY,IAGlFjf,KAAK+xB,wBACT,CAEQ,iBAAAnC,GACJ5vB,KAAK4sB,aAAappB,YAAcxD,KAAK4sB,aAAappB,aAAe,EAAM,GAAMxD,KAAK4sB,aAAappB,YAAc,IAC7GxD,KAAK+xB,wBACT,CAEQ,kBAAAlC,GACJ7vB,KAAK4sB,aAAa7N,cAAgB/e,KAAK4sB,aAAa7N,aAAe,IAAO,IACtE/e,KAAK4sB,aAAa7N,aAAe,IAAK/e,KAAK4sB,aAAa7N,aAAe,GAC3E/e,KAAK+xB,wBACT,CAEQ,iBAAAjC,GACJ9vB,KAAK4sB,aAAa5N,aAAehf,KAAK4sB,aAAa5N,YAAc,IAAO,IACpEhf,KAAK4sB,aAAa5N,YAAc,IAAKhf,KAAK4sB,aAAa5N,YAAc,GACzEhf,KAAK+xB,wBACT,CAEQ,eAAAhC,GACJ/vB,KAAK4sB,aAAa3N,WAAajf,KAAK4sB,aAAa3N,UAAY,IAAO,IAChEjf,KAAK4sB,aAAa3N,UAAY,IAAKjf,KAAK4sB,aAAa3N,UAAY,GACrEjf,KAAK+xB,wBACT,CAEQ,aAAA9B,GACJjwB,KAAK4sB,aAAaoD,SAAWhwB,KAAK4sB,aAAaoD,QAC/ChwB,KAAK+xB,wBACT,CAEQ,WAAA5B,GACJnwB,KAAK4sB,aAAasD,OAASlwB,KAAK4sB,aAAasD,MAC7ClwB,KAAK+xB,wBACT,CAEQ,aAAA3B,GACJpwB,KAAK4tB,YAAY,UACjB5tB,KAAK+kB,OAAOiN,aAAahyB,KAAK4sB,cAC9B5sB,KAAKiyB,cACT,CAEQ,eAAA5B,GACJrwB,KAAK4sB,aAAe5sB,KAAK6sB,yBACzB7sB,KAAK+xB,yBACL/xB,KAAK4tB,YAAY,SACrB,CAKQ,QAAA8B,CAASJ,GACbtvB,KAAK4tB,YAAY,UACjB5tB,KAAK+kB,OAAOmN,aAAa5C,GACzBtvB,KAAKiuB,kBAAkB,aAC3B,CAKQ,qBAAAsD,GACJ,GAA0B,aAAtBvxB,KAAK+R,aAAoC,OAEvB,CAClB,CAAE2E,GAAI,cAAetI,KAAM,iBAAiBpO,KAAK0sB,gBAAgB6B,cACjE,CAAE7X,GAAI,aAActI,KAAM,eAAepO,KAAK0sB,gBAAgB+B,WAAWC,iBACzE,CAAEhY,GAAI,cAAetI,KAAM,gBAAgBpO,KAAK0sB,gBAAgBkC,WAAWF,iBAC3E,CAAEhY,GAAI,kBAAmBtI,KAAM,aAAapO,KAAK0sB,gBAAgBoC,eAAeJ,iBAChF,CAAEhY,GAAI,aAActI,KAAM,gBAAepO,KAAK0sB,gBAAgBsC,iBAAmB,KAAO,QACxF,CAAEtY,GAAI,WAAYtI,KAAM,cAAapO,KAAK0sB,gBAAgBwC,eAAiB,KAAO,SAGxE/f,QAAQqF,IAClB,MAAMyB,EAASjW,KAAKmX,QAAQgb,QAAU3mB,EAAEkL,KAAOlC,EAAOkC,IAClDT,IAAQA,EAAO7H,KAAOoG,EAAOpG,OAEzC,CAEQ,sBAAA2jB,GACJ,GAA0B,aAAtB/xB,KAAK+R,aAAqC,OAExB,CAClB,CAAE2E,GAAI,eAAgBtI,KAAM,mBAAmBxB,KAAKsE,MAAsC,IAAhClR,KAAK4sB,aAAappB,iBAC5E,CAAEkT,GAAI,gBAAiBtI,KAAM,kBAAkBxB,KAAKsE,MAAuC,IAAjClR,KAAK4sB,aAAa7N,kBAC5E,CAAErI,GAAI,eAAgBtI,KAAM,iBAAiBxB,KAAKsE,MAAsC,IAAhClR,KAAK4sB,aAAa5N,iBAC1E,CAAEtI,GAAI,aAActI,KAAM,eAAexB,KAAKsE,MAAoC,IAA9BlR,KAAK4sB,aAAa3N,eACtE,CAAEvI,GAAI,WAAYtI,KAAM,cAAapO,KAAK4sB,aAAaoD,QAAU,KAAO,QACxE,CAAEtZ,GAAI,QAAStI,KAAM,WAAUpO,KAAK4sB,aAAasD,MAAQ,KAAO,SAGtD/gB,QAAQqF,IAClB,MAAMyB,EAASjW,KAAKmX,QAAQgb,QAAU3mB,EAAEkL,KAAOlC,EAAOkC,IAClDT,IAAQA,EAAO7H,KAAOoG,EAAOpG,OAEzC,CAKQ,yBAAAue,GACJ,MAAO,CACH4B,WAAY,YACZE,WAAY,SACZkD,WAAY/kB,KAAK2U,SAASpQ,SAAS,IAAIygB,UAAU,EAAG,GAAGlD,cACvDE,WAAY,SACZwD,kBAAmB,WACnBtD,eAAgB,SAChBE,kBAAkB,EAClBE,gBAAgB,EAExB,CAEQ,sBAAArC,GACJ,MAAO,CACHrpB,YAAa,EACb0sB,OAAO,EACPmC,YAAY,EACZtT,aAAc,GACdC,YAAa,GACbC,UAAW,GACXwP,WAAY,SACZ6D,iBAAkB,EAClBtC,SAAS,EACTuC,UAAU,EACVC,iBAAkB,IAClBC,eAAgB,OAChBC,WAAW,EACXC,eAAe,EACfC,YAAa,CACTC,QAAS,OACTC,SAAU,OACVhd,KAAM,OACNid,MAAO,OACPC,KAAM,QACN5J,KAAM,QAGlB,CAEQ,YAAAgF,GACJ,OAAOpuB,KAAKysB,UAAUwG,KAAK3D,GAAQA,EAAKC,OAC5C,CAEQ,aAAAzC,GAEJ9sB,KAAKysB,UAAY,CACb,CACI6C,KAAM,EACNrpB,KAAM,eACNitB,KAAM,aACNzD,SAAU,UACVvqB,MAAO,GACPsqB,OAAQ,iBACRD,QAAQ,GAEZ,CACID,KAAM,EACNrpB,KAAM,gBACNitB,KAAM,aACNzD,SAAU,SACVvqB,MAAO,EACPsqB,OAAQ,aACRD,QAAQ,GAEZ,CACID,KAAM,EACNrpB,KAAM,GACNitB,KAAM,GACNzD,SAAU,GACVvqB,MAAO,EACPsqB,OAAQ,GACRD,QAAQ,GAGpB,CAEQ,YAAA0C,GACJ,IACI3qB,aAAaM,QAAQ,eAAgBH,KAAKI,UAAU7H,KAAK4sB,eACzD5sB,KAAKgJ,OAAOpD,KAAK,oBACrB,OAASE,GACL9F,KAAKgJ,OAAOlD,MAAM,0BAA2BA,EACjD,CACJ,CAEQ,YAAAqtB,GACJ,IACI,MAAMC,EAAQ9rB,aAAaC,QAAQ,gBAC/B6rB,IACApzB,KAAK4sB,aAAe,IAAK5sB,KAAK6sB,4BAA6BplB,KAAKC,MAAM0rB,IACtEpzB,KAAKgJ,OAAOpD,KAAK,sBAEzB,OAASE,GACL9F,KAAKgJ,OAAOnD,KAAK,0CAA2CC,EAChE,CACJ,CAKA,MAAAutB,CAAOC,GAWH,OATAA,EAAStnB,SAAS,EAAG,EAAG,IAAK,IAAK,CAAEV,EAAG,EAAGC,EAAG,EAAGC,EAAG,IAG/CxL,KAAKwsB,cAAgB,MACAxsB,KAAKwsB,cAC1B8G,EAAStnB,SAAS,EAAG,EAAG,IAAK,IAAK,CAAEV,EAAG,GAAIC,EAAG,GAAIC,EAAG,MAIjDxL,KAAK+R,cACT,IAAK,YACD/R,KAAKuzB,eAAeD,GACpB,MACJ,IAAK,WACDtzB,KAAKwzB,kBAAkBF,GACvB,MACJ,IAAK,YACDtzB,KAAKyzB,mBAAmBH,GACxB,MACJ,IAAK,WACDtzB,KAAK0zB,mBAAmBJ,GACxB,MACJ,IAAK,aACDtzB,KAAK2zB,gBAAgBL,GAKzBtzB,KAAKqsB,iBACLrsB,KAAK4zB,iBAAiBN,GAItBtzB,KAAKgK,WACLhK,KAAKgK,UAAUqpB,OAAOC,EAE9B,CAKQ,cAAAC,CAAeD,GAEnB,MAAMO,EAAa,CACfvoB,EAAG,GAAKsB,KAAKC,MAAuB,GAAjB7M,KAAKusB,WACxBhhB,EAAG,GAAKqB,KAAKC,MAAuB,GAAjB7M,KAAKusB,WACxB/gB,EAAG,GAAKoB,KAAKC,MAAuB,EAAjB7M,KAAKusB,YAa5B,GAVAvsB,KAAKmO,WAAWmlB,EAAU,sBAAuB,IAAK,IAAK,QAASO,EAAY,UAChF7zB,KAAKmO,WAAWmlB,EAAU,mCAAoC,IAAK,IAAK,SAAU,CAAEhoB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,UAG3GxL,KAAKmO,WAAWmlB,EAAU,eAAgB,IAAK,IAAK,QAAS,CAAEhoB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,SAGtFxL,KAAK8zB,cAAcR,GAGO,cAAtBtzB,KAAK+R,aAAqC,CAC5B,CACV,iEACA,0EAGE5C,QAAQ,CAAC4kB,EAAMjnB,KACjB9M,KAAKmO,WAAWmlB,EAAUS,EAAM,IAAK,IAAc,GAARjnB,EAAY,QAAS,CAAExB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,WAEjG,CACJ,CAKQ,iBAAAgoB,CAAkBF,GACtBtzB,KAAKmO,WAAWmlB,EAAU,oBAAqB,IAAK,GAAI,QAAS,CAAEhoB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,UAG1FxL,KAAK8zB,cAAcR,GAGnBtzB,KAAKmO,WAAWmlB,EAAU,gBAAgBtzB,KAAK0sB,gBAAgBiF,aAAc,IAAK,IAAK,SAAU,CAAErmB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,UAC1HxL,KAAKmO,WAAWmlB,EAAU,kCAAmC,IAAK,IAAK,QAAS,CAAEhoB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,SAC7G,CAKQ,kBAAAioB,CAAmBH,GACvBtzB,KAAKmO,WAAWmlB,EAAU,eAAgB,IAAK,GAAI,QAAS,CAAEhoB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,UAGrF,IAAA,IAASe,EAAI,EAAGA,EAAIvM,KAAKysB,UAAU7lB,OAAQ2F,IAAK,CAC5C,MAAM+iB,EAAOtvB,KAAKysB,UAAUlgB,GACtBI,EAAI,IAAU,GAAJJ,EAEZ+iB,EAAKC,QAELvvB,KAAKmO,WAAWmlB,EAAU,QAAQhE,EAAKA,SAASA,EAAKrpB,OAAQ,GAAI0G,EAAG,SAAU,CAAErB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,QACvGxL,KAAKmO,WAAWmlB,EAAU,aAAahE,EAAKE,SAAU,GAAI7iB,EAAI,GAAI,QAAS,CAAErB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,QACpGxL,KAAKmO,WAAWmlB,EAAU,aAAahE,EAAKG,WAAY,IAAK9iB,EAAI,GAAI,QAAS,CAAErB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,QACvGxL,KAAKmO,WAAWmlB,EAAU,SAAShE,EAAK4D,OAAQ,IAAKvmB,EAAI,GAAI,QAAS,CAAErB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,SAE/FxL,KAAKmO,WAAWmlB,EAAU,QAAQhE,EAAKA,cAAe,GAAI3iB,EAAG,SAAU,CAAErB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,OAExG,CAGAxL,KAAK8zB,cAAcR,EACvB,CAKQ,kBAAAI,CAAmBJ,GACvBtzB,KAAKmO,WAAWmlB,EAAU,uBAAwB,IAAK,GAAI,QAAS,CAAEhoB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,UAG7FxL,KAAK8zB,cAAcR,GAGnBtzB,KAAKmO,WAAWmlB,EAAU,yCAA0C,IAAK,IAAK,QAAS,CAAEhoB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,SACpH,CAOQ,eAAAmoB,CAAgBL,GACpBtzB,KAAKmO,WAAWmlB,EAAU,gCAAiC,IAAK,IAAK,QAAS,CAAEhoB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,UAGvG,MAAMgW,EAAYxhB,KAAKmsB,cAAgB,IAAQ,IAO/CmH,EAASjiB,SAJI,IACA,IAHI,IACC,GAKiC,CAAE/F,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAGtE,MAAMwoB,EATW,IASgBxS,EACjC8R,EAAStnB,SARI,IACA,IAOiBgoB,EATZ,GASsC,CAAE1oB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAG3E,MAAMyoB,EAAe,CACjB,uBACA,mCACA,gCACA,gCACA,yBACA,iCACA,kBAGEC,EAAYtnB,KAAKC,MAAM2U,EAAWyS,EAAartB,QAC/CutB,EAAcF,EAAarnB,KAAKuD,IAAI+jB,EAAWD,EAAartB,OAAS,IAE3E5G,KAAKmO,WAAWmlB,EAAUa,EAAa,IAAK,IAAK,SAAU,CAAE7oB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,UAGhFgW,GAAY,KACZkK,WAAW,IAAM1rB,KAAK+kB,OAAOqP,gBAAiB,IAEtD,CAKQ,gBAAAR,CAAiBN,GACrB,MAKMe,EAAa,KALLr0B,KAAKosB,mBAAqB,GACV,EAA1BpsB,KAAKosB,mBAC2B,GAA/B,EAAIpsB,KAAKosB,qBAIdkH,EAAStnB,SAAS,EAAG,EAAG,IAAKqoB,EAAY,CAAE/oB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAC5D8nB,EAAStnB,SAAS,EAAG,IAAMqoB,EAAY,IAAKA,EAAY,CAAE/oB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC/E,CAKQ,aAAAsoB,CAAcR,GAClB,IAAA,MAAWrd,KAAUjW,KAAKmX,QACtBnX,KAAKs0B,aAAahB,EAAUrd,EAEpC,CAKQ,YAAAqe,CAAahB,EAAoBrd,GACrC,MAAM3J,EAAQ2J,EAAOiY,YACjB,CAAE5iB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnByK,EAAO4X,QACH,CAAEviB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAY3B,GATIyK,EAAOiY,cACPoF,EAAStnB,SAASiK,EAAOvJ,EAAI,EAAGuJ,EAAOtJ,EAAI,EAAGsJ,EAAOxL,MAAQ,GAAIwL,EAAOvL,OAAS,GAAI,CAAEY,EAAG,GAAIC,EAAG,GAAIC,EAAG,KACxG8nB,EAASjiB,SAAS4E,EAAOvJ,EAAI,EAAGuJ,EAAOtJ,EAAI,EAAGsJ,EAAOxL,MAAQ,GAAIwL,EAAOvL,OAAS,GAAI4B,IAIzFtM,KAAKmO,WAAWmlB,EAAUrd,EAAO7H,KAAM6H,EAAOvJ,EAAIuJ,EAAOxL,MAAQ,EAAGwL,EAAOtJ,EAAIsJ,EAAOvL,OAAS,EAAG,SAAU4B,EAAO,UAG/G2J,EAAOkY,QAAUlY,EAAO4X,QAAS,CACjC,MAAM0G,EAAa,IAAIte,EAAOkY,OAAOqG,QAAQ,MAAO,OACpDx0B,KAAKmO,WAAWmlB,EAAUiB,EAAYte,EAAOvJ,EAAIuJ,EAAOxL,MAAQ,GAAIwL,EAAOtJ,EAAIsJ,EAAOvL,OAAS,EAAG,QAAS,CAAEY,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,OACxI,CACJ,CAKQ,UAAA2C,CACJmlB,EACAllB,EACA1B,EACAC,EACAtB,EACAiB,EACAmoB,GAEA,MAAMC,EAAoB,UAATrpB,EAAmB,GAAc,WAATA,EAAoB,GAAK,GAGlE,IAAIspB,EAAQjoB,EACE,WAAV+nB,EACAE,EAAQjoB,EAAK0B,EAAKxH,OAAS8tB,EAAW,GACrB,UAAVD,IACPE,EAAQjoB,EAAK0B,EAAKxH,OAAS8tB,EAAW,IAI1C,IAAA,IAASnoB,EAAI,EAAGA,EAAI6B,EAAKxH,OAAQ2F,IAAK,CAClC,MAAMqoB,EAAQD,EAAQpoB,EAAImoB,EAAW,GAErB,MAAZtmB,EAAK7B,IACL+mB,EAAStnB,SAAS4oB,EAAOjoB,EAAI+nB,EAAW,EAAc,GAAXA,EAAgBA,EAAUpoB,EAE7E,CACJ,CAKA,eAAAuoB,GACI,OAAO70B,KAAK+R,YAChB,CAKA,eAAA+iB,GACI,MAAO,IAAK90B,KAAK4sB,aACrB,CAKA,kBAAAmI,CAAmBC,GACfC,OAAOC,OAAOl1B,KAAK0sB,gBAAiBsI,GACV,aAAtBh1B,KAAK+R,cACL/R,KAAKuxB,uBAEb,CAKA,OAAAvF,GAEQhsB,KAAKgK,WACLhK,KAAKssB,oBAAoBnd,QAAQuH,IAC7B1W,KAAKgK,UAAWmrB,cAAcze,KAItC1W,KAAKgJ,OAAOpD,KAAK,+BACrB,EC9wCG,IAAKwvB,GAAAA,IACRA,EAAA,SAAW,YACXA,EAAA,QAAU,UACVA,EAAA,QAAU,UACVA,EAAA,OAAS,SACTA,EAAA,UAAY,YACZA,EAAA,SAAW,WACXA,EAAA,WAAa,aACbA,EAAA,UAAY,YACZA,EAAA,SAAW,WACXA,EAAA,QAAU,UACVA,EAAA,QAAU,WACVA,EAAA,SAAW,YACXA,EAAA,MAAQ,QAbAA,IAAAA,GAAA,CAAA,GAkEL,MAAMC,EAqBT,WAAAvwB,CAAYrB,EAAyBuG,GApBrChK,KAAQ+R,aAA0B,YAClC/R,KAAQiS,cAA2B,YAInCjS,KAAQs1B,WAA0B,GAClCt1B,KAAQu1B,gBAAgDzsB,IACxD9I,KAAQw1B,eAAyBnvB,KAAKC,MAGtCtG,KAAQy1B,SAA4B,KAGpCz1B,KAAQ01B,SAAiC,KACzC11B,KAAQ21B,YAA+B,GAGvC31B,KAAQ8e,eAAgB,EACxB9e,KAAQmE,aAAe,IA2lBvBnE,KAAQ41B,iBAAkB,EAxlBtB51B,KAAKgJ,OAAS,IAAIO,EAAO,oBAGzBvJ,KAAK61B,SAAW71B,KAAK81B,wBAGrB91B,KAAK+1B,qBAAqBtyB,EAAOuG,GAGjChK,KAAKg2B,wBAELh2B,KAAKgJ,OAAOpD,KAAK,gCACrB,CAKQ,oBAAAmwB,CAAqBtyB,EAAyBuG,GAClD,MAAMisB,EAAyB,CAC3BpE,UAAW/R,MAAOkV,UACRh1B,KAAKk2B,cAAclB,IAE7B9C,WAAYpS,MAAOqW,UACTn2B,KAAKo2B,eAAeD,IAE9BnE,WAAagD,IACTh1B,KAAKq2B,qBAAqBrB,IAE9BhH,OAAQ,KACJhuB,KAAKs2B,cAETlC,YAAatU,gBACH9f,KAAKu2B,SAAS,aAI5Bv2B,KAAKy1B,SAAW,IAAIxJ,EAASgK,EAAYxyB,EAAOuG,GAChDhK,KAAKgJ,OAAOpD,KAAK,6BACrB,CAKA,gBAAM+E,GACF3K,KAAKgJ,OAAOpD,KAAK,yCAEjB,IAEI,UACU5F,KAAKw2B,eACXx2B,KAAKgJ,OAAOpD,KAAK,4BACrB,OAASE,GACL9F,KAAKgJ,OAAOpD,KAAK,uDACjB5F,KAAK61B,SAAW71B,KAAK81B,uBACzB,CAGA91B,KAAKy2B,mBAELz2B,KAAK8e,eAAgB,EACrB9e,KAAKgJ,OAAOpD,KAAK,mCAErB,OAASE,GAEL,MADA9F,KAAKgJ,OAAOlD,MAAM,6CAA8CA,GAC1DA,CACV,CACJ,CAKQ,qBAAAgwB,GACJ,MAAO,CACHY,WAAY,CACRhgB,GAAI,cACJgE,SAAU,CAAEhO,EAAG,IAAKC,EAAG,KACvB4N,SAAU,CAAE7N,EAAG,EAAGC,EAAG,GACrBsR,OAAQ,IACR0Y,KAAM,IACNC,cAAe9tB,IAAI,CACf,CAAC,UAAW,KACZ,CAAC,OAAQ,KACT,CAAC,QAAS,IACV,CAAC,WAAY,OAGrB+tB,cAAe,CACXngB,GAAI,aACJzQ,KAAM,aACNhC,KAAM,eAEV6yB,SAAU,EACV5xB,MAAO,EACP6xB,WAAY,EACZC,YAAa,GACbC,aAAc,CAAC,gBAAiB,iBAChCjC,SAAU,CACNjW,aAAc,EACdC,YAAa,GACbC,UAAW,GACXwP,WAAY,UAEhByI,MAAO,CACHC,kBAAmB,EACnBC,eAAgB,EAChBC,kBAAmB,EACnBC,WAAY,EACZC,mBAAoB,GAGhC,CAKQ,qBAAAvB,GAEJh2B,KAAKw3B,cAAc,UAAmB,aAGtCx3B,KAAKw3B,cAAc,YAAoB,WACvCx3B,KAAKw3B,cAAc,UAAmB,aAGtCx3B,KAAKw3B,cAAc,UAAmB,UACtCx3B,KAAKw3B,cAAc,SAAkB,WAGrCx3B,KAAKw3B,cAAc,UAAmB,aACtCx3B,KAAKw3B,cAAc,UAAmB,YACtCx3B,KAAKw3B,cAAc,UAAmB,cACtCx3B,KAAKw3B,cAAc,UAAmB,aAGtCx3B,KAAKw3B,cAAc,YAAqB,WACxCx3B,KAAKw3B,cAAc,WAAoB,WACvCx3B,KAAKw3B,cAAc,aAAsB,WACzCx3B,KAAKw3B,cAAc,YAAqB,WAGxCx3B,KAAKw3B,cAAc,UAAmB,SACtCx3B,KAAKw3B,cAAc,QAAiB,aAEpCx3B,KAAKgJ,OAAOxD,MAAM,+BACtB,CAKQ,aAAAgyB,CAAclhB,EAAiBmhB,EAAeC,EAA2B3J,GAC7E,MAAM3Y,EAAM,GAAGkB,MAASmhB,IACxBz3B,KAAKu1B,YAAYxsB,IAAIqM,EAAK,CAAEkB,OAAMmhB,KAAIC,YAAW3J,UACrD,CAKQ,gBAAA0I,GAGJz2B,KAAKgJ,OAAOxD,MAAM,8BACtB,CAKA,cAAM+wB,CAAS9F,GACX,MAAMkH,EAAgB,GAAG33B,KAAK+R,iBAAiB0e,IACzCmH,EAAa53B,KAAKu1B,YAAYrsB,IAAIyuB,GAEnCC,GAMDA,EAAWF,WAAcE,EAAWF,aAKxC13B,KAAKgJ,OAAOpD,KAAK,qBAAqB5F,KAAK+R,kBAAkB0e,KAG7DzwB,KAAKiS,cAAgBjS,KAAK+R,aAGtB6lB,EAAW7J,QACX6J,EAAW7J,SAIf/tB,KAAK+R,aAAe0e,QAGdzwB,KAAK63B,aAAapH,IAlBpBzwB,KAAKgJ,OAAOxD,MAAM,iCAAiCmyB,KANnD33B,KAAKgJ,OAAOnD,KAAK,6BAA6B7F,KAAK+R,kBAAkB0e,IAyB7E,CAKA,SAAAqH,CAAUrH,GACNzwB,KAAKs1B,WAAW3uB,KAAK3G,KAAK+R,cAC1B/R,KAAK+R,aAAe0e,EACpBzwB,KAAKgJ,OAAOxD,MAAM,iBAAiBirB,mBAA0BzwB,KAAKs1B,WAAW1uB,UACjF,CAKA,QAAAmxB,GACI,GAA+B,IAA3B/3B,KAAKs1B,WAAW1uB,OAEhB,OADA5G,KAAKgJ,OAAOnD,KAAK,oCACV,KAGX,MAAMmyB,EAAch4B,KAAK+R,aAIzB,OAHA/R,KAAK+R,aAAe/R,KAAKs1B,WAAW2C,MACpCj4B,KAAKgJ,OAAOxD,MAAM,iBAAiBwyB,OAAiBh4B,KAAK+R,gBAElDimB,CACX,CAKA,kBAAcH,CAAaxgB,GACvB,OAAQA,GACJ,IAAK,UAEDrX,KAAKk4B,wBACL,MAEJ,IAAK,SAEDl4B,KAAKm4B,wBACL,MAEJ,IAAK,kBAEKn4B,KAAKqO,OACX,MAEJ,IAAK,QAEDrO,KAAKgJ,OAAOlD,MAAM,uBAG9B,CAKA,MAAA0O,CAAOC,EAAmB9R,GACtB,GAAK3C,KAAK8e,cASV,OAN0B,YAAtB9e,KAAK+R,eACL/R,KAAK61B,SAASiB,UAAYriB,EAC1BzU,KAAK61B,SAASqB,MAAMC,mBAAqB1iB,GAIrCzU,KAAK+R,cACT,IAAK,YACL,IAAK,WACL,IAAK,YACL,IAAK,WACL,IAAK,UACG/R,KAAKy1B,UAAY9yB,GACjB3C,KAAKy1B,SAASjhB,OAAOC,EAAW9R,GAEpC,MAEJ,IAAK,UACD3C,KAAKo4B,mBAAmB3jB,GACxB,MAEJ,IAAK,UACDzU,KAAKq4B,mBAAmB5jB,GAGpC,CAKQ,kBAAA2jB,CAAmB3jB,GAEnBzU,KAAK01B,WACL11B,KAAK61B,SAASa,WAAWhc,SAAW,IAAK1a,KAAK01B,SAAShb,UACvD1a,KAAK61B,SAASa,WAAWnc,SAAW,IAAKva,KAAK01B,SAASnb,eAG1B,IAAzBva,KAAK01B,SAASzX,SACdje,KAAK61B,SAASa,WAAWzY,OAASje,KAAK01B,SAASzX,QAG5D,CAKQ,kBAAAoa,CAAmB5jB,GAEHpO,KAAKC,MAAQtG,KAAKw1B,eAEpB,KACdx1B,KAAKu2B,SAAS,WAAmB+B,MAAMxyB,IACnC9F,KAAKgJ,OAAOlD,MAAM,wCAAyCA,IAGvE,CAKA,MAAAutB,CAAOC,GACH,GAAKtzB,KAAK8e,cAKV,OAAQ9e,KAAK+R,cACT,IAAK,YACL,IAAK,WACL,IAAK,YACL,IAAK,WACL,IAAK,UACG/R,KAAKy1B,UACLz1B,KAAKy1B,SAASpC,OAAOC,GAEzB,MAEJ,IAAK,UACDtzB,KAAKu4B,mBAAmBjF,GACxB,MAEJ,IAAK,UACDtzB,KAAKw4B,mBAAmBlF,GACxB,MAEJ,IAAK,SACDtzB,KAAKy4B,kBAAkBnF,GACvB,MAEJ,IAAK,QACDtzB,KAAK04B,iBAAiBpF,GACtB,MAEJ,QACItzB,KAAK24B,mBAAmBrF,QAhC5BtzB,KAAKu4B,mBAAmBjF,EAkChC,CAKQ,kBAAAiF,CAAmBjF,GAIvBA,EAASnlB,WAAW,iCAAkCL,IAAeC,IACjE,CAAEzC,EAAG,IAAKC,EAAG,IAAKC,EAAG,KAAO,IAGhC,MAAMotB,EAAO,IAAIC,OAAQjsB,KAAKC,MAAMxG,KAAKC,MAAQ,KAAO,GACxDgtB,EAASnlB,WAAW,UAAUyqB,IAAQ9qB,IAPtB,IAQZ,CAAExC,EAAG,IAAKC,EAAG,IAAKC,EAAG,KAAO,GACpC,CAKQ,eAAAstB,CAAgBxF,GAKpBtzB,KAAK+4B,qBAAqBzF,GAG1BA,EAASnlB,WAAW,wBAAyBL,IAAeC,IACxD,CAAEzC,EAAG,IAAKC,EAAG,IAAKC,EAAG,KAAO,IAGd,CACd,uBACA,iBACA,WACA,QAGM2D,QAAQ,CAAC6pB,EAAMlsB,KACrB,MAAMH,EAAIoB,IAAuB,GAARjB,EACnBR,EAAkB,IAAVQ,EAAc,CAAExB,EAAG,IAAKC,EAAG,IAAKC,EAAG,KAAQ,CAAEF,EAAG,IAAKC,EAAG,IAAKC,EAAG,KAC9E8nB,EAASnlB,WAAW6qB,EAAMlrB,IAAcnB,EAAGL,EAAO,MAItDgnB,EAASnlB,WAAW,8CAChBL,IAAeC,IAAe,CAAEzC,EAAG,IAAKC,EAAG,IAAKC,EAAG,KAAO,GAClE,CAKQ,kBAAAgtB,CAAmBlF,GAKvB,GAHAtzB,KAAKi5B,sBAAsB3F,GAGvBtzB,KAAK01B,SAAU,CACf,MAAMwD,EAAa5F,EAASlkB,mBAAmB,SAAU,IACzDkkB,EAAS/jB,WAAW2pB,EAAYl5B,KAAK01B,SAAShb,SAAShO,EAAI,GAAI1M,KAAK01B,SAAShb,SAAS/N,EAAI,GAC9F,CAGA3M,KAAK21B,YAAYxmB,QAAQgqB,IACrB7F,EAASzlB,WAAWsrB,EAAOze,SAAShO,EAAGysB,EAAOze,SAAS/N,EAAGwsB,EAAOnrB,OAC7D,CAAE1C,EAAG,GAAIC,EAAG,IAAKC,EAAG,MAAO,KAInCxL,KAAKo5B,eAAe9F,EACxB,CAKQ,iBAAAmF,CAAkBnF,GAEtBtzB,KAAKw4B,mBAAmBlF,GAOxBA,EAAStnB,SAAS8B,IAAeC,IAAc,IAAK,IAAK,CAAEzC,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAAGgB,EAAG,MAGhF8mB,EAASnlB,WAAW,cAAeL,IAAcC,IAC7C,CAAEzC,EAAG,IAAKC,EAAG,IAAKC,EAAG,GAAK,IAE9B8nB,EAASnlB,WAAW,sBAAuBL,IAAcC,IACrD,CAAEzC,EAAG,EAAGC,EAAG,IAAKC,EAAG,GAAK,GAChC,CAKQ,gBAAAktB,CAAiBpF,GAKrBA,EAAStnB,SAAS,EAAG,EAAG,KAAM,IAAK,CAAEV,EAAG,GAAIC,EAAG,EAAGC,EAAG,IAGrD8nB,EAASnlB,WAAW,eAAgBL,IAAcC,IAC9C,CAAEzC,EAAG,IAAKC,EAAG,EAAGC,EAAG,GAAK,IAE5B8nB,EAASnlB,WAAW,mCAAoCL,IAAeC,IACnE,CAAEzC,EAAG,IAAKC,EAAG,GAAIC,EAAG,IAAM,IAE9B8nB,EAASnlB,WAAW,qCAAsCL,IAAeC,IACrE,CAAEzC,EAAG,IAAKC,EAAG,IAAKC,EAAG,KAAO,GACpC,CAKQ,kBAAAmtB,CAAmBrF,GAIvBA,EAASnlB,WAAW,kBAAkBnO,KAAK+R,eAAgBjE,IAF3C,IAGZ,CAAExC,EAAG,IAAKC,EAAG,EAAGC,EAAG,KAAO,GAClC,CAKQ,qBAAAytB,CAAsB3F,GAE1B,IAAA,IAAS/mB,EAAI,EAAGA,EAAI,IAAKA,IAAK,CAC1B,MAAMG,EAAS,GAAJH,EAAU,KACfI,EAAS,IAAJJ,EAAW,IAChB8sB,EAAc9sB,EAAI,EAAK,EACvBD,EAAQ,CACVhB,EAAgB,GAAb+tB,EACH9tB,EAAgB,GAAb8tB,EACH7tB,EAAgB,GAAb6tB,GAGP/F,EAAS7mB,SAASC,EAAGC,EAAGL,EAC5B,CACJ,CAKQ,oBAAAysB,CAAqBzF,GAMzB,IAAA,IAAS3mB,EAAI,EAAGA,EAAI,IAAKA,IACrB,IAAA,IAASD,EAAI,EAAGA,EAAI,KAAMA,IAAK,CAE3B,MAAM4sB,EAAW1sB,KAAKC,MAAOF,EAAI,IAAO,IAClCL,EAAQ,CACVhB,EAAGguB,EAAW,EACd/tB,EAAG+tB,EAAW,EACd9tB,EAAG8tB,GAEPhG,EAAS7mB,SAASC,EAAGC,EAAGL,EAC5B,CAIJ,IAAA,IAASC,EAAI,EAAGA,EAAI,IAAKA,IAAK,CAC1B,MAAMG,EAAS,GAAJH,EAAU,KACfI,EAAS,IAAJJ,EAAW,IAChB8sB,EAAc9sB,EAAI,EAAK,EACvBD,EAAQ,CACVhB,EAAgB,GAAb+tB,EACH9tB,EAAgB,GAAb8tB,EACH7tB,EAAgB,GAAb6tB,GAMP,GAHA/F,EAAS7mB,SAASC,EAAGC,EAAGL,GAGpBC,EAAI,GAAM,EAAG,CACb,MAAMgtB,EAA4C,GAAlC3sB,KAAKqU,IAAI5a,KAAKC,MAAQ,IAAOiG,GAAU,GACjDitB,EAAe,CACjBluB,EAAGiuB,EACHhuB,EAAa,GAAVguB,EACH/tB,EAAa,IAAV+tB,GAEPjG,EAAS7mB,SAASC,EAAGC,EAAG6sB,EAC5B,CACJ,CAGA,IAAA,IAAS9sB,EAAI,EAAGA,EAAI,KAAMA,IACtB,IAAA,IAASC,EAAI,IAAKA,EAAI,IAAKA,IAAK,CAC5B,MAAM8D,EAAW7D,KAAKW,IAAIZ,EAAI,KACxBkc,EAAYjc,KAAKoC,IAAI,EAAG,IAAMyB,GAAY,IAC1CnE,EAAQ,CACVhB,EAAe,GAAZud,EACHtd,EAAe,GAAZsd,EACHrd,EAAe,GAAZqd,GAEHA,EAAY,IACZyK,EAAS7mB,SAASC,EAAGC,EAAGL,EAEhC,CAER,CAKQ,cAAA8sB,CAAe9F,GAEnB,MAAMrV,EAASje,KAAK61B,SAASa,WAAWzY,OAClC0Y,EAAO32B,KAAK61B,SAASa,WAAWC,KAEtCrD,EAASnlB,WAAW,WAAW8P,EAAO5U,QAAQ,MAAO,GAAI,GACrD4U,EAAS,GAAK,CAAE3S,EAAG,EAAGC,EAAG,IAAKC,EAAG,GAAM,CAAEF,EAAG,IAAKC,EAAG,EAAGC,EAAG,GAAK,IAEnE8nB,EAASnlB,WAAW,SAASwoB,EAAKttB,QAAQ,KAAM,GAAI,GAChDstB,EAAO,IAAM,CAAErrB,EAAG,EAAGC,EAAG,IAAKC,EAAG,GAAM,CAAEF,EAAG,IAAKC,EAAG,IAAKC,EAAG,GAAK,IAGpE8nB,EAASnlB,WAAW,YAAYnO,KAAK61B,SAASa,WAAWE,UAAU1tB,IAAI,YAAc,IACjF,GAAI,GAAI,CAAEoC,EAAG,IAAKC,EAAG,IAAKC,EAAG,GAAK,IAGtC,MAAMiuB,EAAU7sB,KAAKC,MAAM7M,KAAK61B,SAASiB,SAAW,IAC9C4C,EAAU9sB,KAAKC,MAAM7M,KAAK61B,SAASiB,SAAW,IACpDxD,EAASnlB,WAAW,SAASsrB,KAAWC,EAAQvoB,WAAWwoB,SAAS,EAAG,OACnE,GAAI,GAAI,CAAEruB,EAAG,EAAGC,EAAG,IAAKC,EAAG,KAAO,IAGtC8nB,EAASnlB,WAAW,WAAWnO,KAAK61B,SAASgB,cAAc5wB,OACvD,GAAI,GAAI,CAAEqF,EAAG,EAAGC,EAAG,IAAKC,EAAG,KAAO,IAGtC8nB,EAASnlB,WAAW,gBAAiBnO,KAAK61B,SAASqB,MAAME,gBAAkB,YACvE,GAAI,IAAK,CAAE9rB,EAAG,IAAKC,EAAG,IAAKC,EAAG,KAAO,GAC7C,CAOQ,qBAAA0sB,GACJl4B,KAAK41B,iBAAkB,EACvB51B,KAAKgJ,OAAOxD,MAAM,6BACtB,CAEQ,qBAAA2yB,GACJn4B,KAAK41B,iBAAkB,EACvB51B,KAAKgJ,OAAOxD,MAAM,4BACtB,CAKA,UAAM6I,GACF,IACI,MAAMurB,EAAW,CACbC,QAAS,QACTzzB,UAAWC,KAAKC,MAChBuvB,SAAU71B,KAAK61B,UAGbiE,EAAaryB,KAAKI,UAAU+xB,GAClCtyB,aAAaM,QAAQ,qBAAsBkyB,GAE3C95B,KAAKgJ,OAAOxD,MAAM,0BAEtB,OAASM,GAEL,MADA9F,KAAKgJ,OAAOlD,MAAM,sBAAuBA,GACnCA,CACV,CACJ,CAKA,UAAMi0B,GACF,UACU/5B,KAAKw2B,eACXx2B,KAAKgJ,OAAOpD,KAAK,2BAErB,OAASE,GACL9F,KAAKgJ,OAAOnD,KAAK,sCAAuCC,GACxD9F,KAAK61B,SAAW71B,KAAK81B,uBACzB,CACJ,CAKA,kBAAcU,GACV,MAAMpD,EAAQ9rB,aAAaC,QAAQ,sBACnC,IAAK6rB,EACD,MAAM,IAAIptB,MAAM,sBAGpB,MAAM4zB,EAAWnyB,KAAKC,MAAM0rB,GAG5B,IAAKwG,EAAS/D,SACV,MAAM,IAAI7vB,MAAM,4BAIpB,GAAI4zB,EAAS/D,SAASa,WAAWE,UAAW,CACxC,MAAMoD,EAAiBJ,EAAS/D,SAASa,WAAWE,UAChDvgB,MAAM4jB,QAAQD,GACdJ,EAAS/D,SAASa,WAAWE,UAAY,IAAI9tB,IAAIkxB,GAGjDJ,EAAS/D,SAASa,WAAWE,UAAY,IAAI9tB,IAAImsB,OAAOvuB,QAAQszB,GAExE,CAEAh6B,KAAK61B,SAAW+D,EAAS/D,SACzB71B,KAAKgJ,OAAOxD,MAAM,gCACtB,CAKA,mBAAc0wB,CAAclB,GAQxB,OAPAh1B,KAAKgJ,OAAOpD,KAAK,uBAAwBovB,GAGzCh1B,KAAK61B,SAAW71B,KAAK81B,wBACrB91B,KAAK61B,SAASa,WAAWhgB,GAAK,QAAQse,EAASzG,WAAW2L,gBAGlDlF,EAASvG,YACb,IAAK,OACDzuB,KAAK61B,SAASa,WAAWzY,OAAS,IAClCje,KAAK61B,SAASa,WAAWC,KAAO,IAChC,MACJ,IAAK,OACD32B,KAAK61B,SAASa,WAAWzY,OAAS,GAClCje,KAAK61B,SAASa,WAAWC,KAAO,IAChC,MACJ,IAAK,YACD32B,KAAK61B,SAASa,WAAWzY,OAAS,GAClCje,KAAK61B,SAASa,WAAWC,KAAO,GAChC,MACJ,QACI32B,KAAK61B,SAASa,WAAWzY,OAAS,IAClCje,KAAK61B,SAASa,WAAWC,KAAO,IAIxC32B,KAAK61B,SAASgB,cAAc5wB,KAAO,UAAU+uB,EAASrD,mBAEhD3xB,KAAKu2B,SAAS,UACxB,CAEA,oBAAcH,CAAeD,GACzBn2B,KAAKgJ,OAAOpD,KAAK,6BAA6BuwB,KAE9C,IACI,MAAMgE,EAAU,uBAAuBhE,IACjCyD,EAAWtyB,aAAaC,QAAQ4yB,GAElCP,GACA55B,KAAK61B,SAAWpuB,KAAKC,MAAMkyB,SACrB55B,KAAKu2B,SAAS,YAEpBv2B,KAAKgJ,OAAOnD,KAAK,qBAEzB,OAASC,GACL9F,KAAKgJ,OAAOlD,MAAM,sBAAuBA,EAC7C,CACJ,CAEQ,oBAAAuwB,CAAqBrB,GACzBh1B,KAAKgJ,OAAOpD,KAAK,uBAAwBovB,GAGzCh1B,KAAK61B,SAASb,SAAW,CACrBjW,aAAciW,EAASjW,aACvBC,YAAagW,EAAShW,YACtBC,UAAW+V,EAAS/V,UACpBwP,WAAYuG,EAASvG,YAAc,UAIvC,IACInnB,aAAaM,QAAQ,0BAA2BH,KAAKI,UAAUmtB,GACnE,OAASlvB,GACL9F,KAAKgJ,OAAOlD,MAAM,0BAA2BA,EACjD,CACJ,CAEA,gBAAcwwB,GACVt2B,KAAKgJ,OAAOpD,KAAK,yBAGX5F,KAAKqO,OAGP,UAAWnO,QACVA,OAAe0kB,OAExB,CAKA,eAAAiQ,GACI,OAAO70B,KAAK+R,YAChB,CAEA,gBAAAqoB,GACI,OAAOp6B,KAAKiS,aAChB,CAEA,WAAAooB,GACI,OAAOr6B,KAAK61B,QAChB,CAEA,SAAAyE,CAAUjjB,GACN,OAAOrX,KAAK+R,eAAiBsF,CACjC,CAKA,WAAAkjB,CAAYC,GACRx6B,KAAK01B,SAAW8E,CACpB,CAEA,cAAAC,CAAeC,GACX16B,KAAK21B,YAAc,IAAI+E,EAC3B,CAKA,QAAAC,GACI,MAA6B,YAAtB36B,KAAK+R,YAChB,CAEA,SAAA6oB,GACI,MAA6B,WAAtB56B,KAAK+R,YAChB,CAEA,YAAA8oB,GACI,MAA6B,YAAtB76B,KAAK+R,YAChB,CAIA,QAAA+oB,GACI,MAA6B,cAAtB96B,KAAK+R,YAChB,CAKA,OAAAT,GAEItR,KAAKqO,OAAOiqB,MAAMxyB,IACd9F,KAAKgJ,OAAOlD,MAAM,gCAAiCA,KAGvD9F,KAAKgJ,OAAOpD,KAAK,0CACrB,EC71BG,IAAKm1B,GAAAA,IACRA,EAAA,IAAM,MACNA,EAAA,MAAQ,QACRA,EAAA,KAAO,OACPA,EAAA,UAAY,YACZA,EAAA,KAAO,OACPA,EAAA,OAAS,SACTA,EAAA,YAAc,cACdA,EAAA,QAAU,UARFA,IAAAA,GAAA,CAAA,GAWAC,GAAAA,IACRA,EAAA,QAAU,UACVA,EAAA,QAAU,UACVA,EAAA,QAAU,UACVA,EAAA,YAAc,eACdA,EAAA,QAAU,UACVA,EAAA,WAAa,aACbA,EAAA,eAAiB,iBACjBA,EAAA,UAAY,aARJA,IAAAA,GAAA,CAAA,GAmCL,MAAMC,EAoBT,WAAAn2B,CAAYG,EAAqC,GAAI8f,EAAqC,CAAA,GAjB1F/kB,KAAQk7B,WAA+CpyB,IAIvD9I,KAAQm7B,eAAyB,EACjCn7B,KAAQo7B,iBAA2B,EACnCp7B,KAAQq7B,gBAA0B,EAGlCr7B,KAAQs7B,YAAsB,EAC9Bt7B,KAAQu7B,eAAyB,EAGjCv7B,KAAQ+kB,OAAqC,CAAA,EAKzC/kB,KAAKgJ,OAAS,IAAIO,EAAO,eACzBvJ,KAAK+kB,OAASA,EAGd/kB,KAAKiF,OAAS,CACVu2B,QAAS,IACTC,WAAY,IACZC,SAAU,IACVC,QAAS,IACTC,QAAS,IACTC,YAAa,IACbC,iBAAkB,GAClBC,gBAAiB,EACjBC,iBAAkB,EAClBC,YAAa,EACbC,YAAa,GACbC,qBAAsB,MACnBl3B,GAIPjF,KAAKo8B,OAAS,CACVC,KAAM,IACNC,QAAS,IACTC,MAAO,IACP5F,KAAM,IACN6F,KAAM,EACNC,eAAe,EACfC,eAAe,EACfC,eAAe,EACfC,aAAa,EACbC,WAAW,EACXf,iBAAkB,EAClBgB,eAAgB,EAChBC,eAAgB,EAChBC,YAAa,GAIjBh9B,KAAKi9B,gBAAkB,CACnBC,QAAS,GACTZ,QAAS,GACTa,QAAS,GACTP,YAAa,GACbQ,QAAS,IAIbnI,OAAOtc,OAAOoiB,GAAa5rB,QAAQkuB,IAC/Br9B,KAAKk7B,OAAOnyB,IAAIs0B,EAAS,MAG7Br9B,KAAKgJ,OAAOpD,KAAK,8BAA+B,CAC5CX,OAAQjF,KAAKiF,OACbm3B,OAAQp8B,KAAKo8B,QAErB,CAKA,MAAA5nB,CAAOC,GACHzU,KAAKu7B,eAAiB9mB,EAGtBzU,KAAKs9B,yBAGLt9B,KAAKu9B,wBAAwB9oB,GAG7BzU,KAAKw9B,cAAc/oB,GAGnBzU,KAAKy9B,sBAAsBhpB,GAG3BzU,KAAK09B,yBAGL19B,KAAK29B,uBAGL39B,KAAK49B,4BACT,CAKQ,sBAAAN,GACJ,IAAIO,EAAmB,EAGvBA,GAAqB79B,KAAKi9B,gBAAgBL,YAAc,IAAO,GAG3D58B,KAAKo8B,OAAOK,gBACZoB,GAAqB79B,KAAKi9B,gBAAgBC,QAAU,IAAO,IAI3Dl9B,KAAKo8B,OAAOM,gBACZmB,GAAqB79B,KAAKi9B,gBAAgBX,QAAU,IAAOt8B,KAAKiF,OAAO+2B,kBAIvEh8B,KAAKo8B,OAAOO,gBACZkB,GAAqB79B,KAAKi9B,gBAAgBE,QAAU,IAAO,IAI/DU,GAAqB79B,KAAKi9B,gBAAgBG,QAAU,IAAO,EAE3Dp9B,KAAKo7B,iBAAmByC,EAGxB79B,KAAKo8B,OAAOG,MAAQ3vB,KAAKoC,IAAI,EAAGhP,KAAKo8B,OAAOG,MAASsB,EAAmB79B,KAAKu7B,gBAGzEv7B,KAAKo8B,OAAOG,MAAQ,IACpBv8B,KAAK89B,oBAEb,CAKQ,uBAAAP,CAAwB9oB,GAE5BzU,KAAKm7B,eAAiB,EAGlBn7B,KAAKo8B,OAAOK,gBACZz8B,KAAKm7B,gBAAmBn7B,KAAKi9B,gBAAgBC,QAAU,IAAO,GAI9Dl9B,KAAKo8B,OAAOM,gBACZ18B,KAAKm7B,gBAAmBn7B,KAAKi9B,gBAAgBX,QAAU,IAAO,GAI9Dt8B,KAAKo8B,OAAOO,gBACZ38B,KAAKm7B,gBAAmBn7B,KAAKi9B,gBAAgBE,QAAU,IAAO,GAIlEn9B,KAAKo8B,OAAOI,KAAO5vB,KAAKuD,IAAInQ,KAAKiF,OAAO22B,QACpC57B,KAAKo8B,OAAOI,KAAOx8B,KAAKm7B,eAAiB1mB,GAI7CzU,KAAKo8B,OAAOI,KAAO5vB,KAAKoC,IAAI,EAAGhP,KAAKo8B,OAAOI,KADvB,GAC4C/nB,GAG5DzU,KAAKo8B,OAAOI,KAAO,IACnBx8B,KAAK+9B,gBAEb,CAKQ,aAAAP,CAAc/oB,GAClB,GAAIzU,KAAKo8B,OAAOM,eAAiB18B,KAAKo8B,OAAOG,MAAQ,EAAG,CAEpD,MAAMyB,EAAYh+B,KAAKiF,OAAO82B,iBAAmB/7B,KAAKi9B,gBAAgBX,QAAU,KAChFt8B,KAAKo8B,OAAOE,QAAU1vB,KAAKuD,IAAInQ,KAAKiF,OAAOw2B,WACvCz7B,KAAKo8B,OAAOE,QAAU0B,EAAYvpB,EAC1C,CACJ,CAKQ,qBAAAgpB,CAAsBhpB,GAC1B,GAAIzU,KAAKo8B,OAAOK,cAAe,CAE3B,IAAIwB,EAAc,GAGlBA,GAAgBj+B,KAAKi9B,gBAAgBC,QAAU,IAAO,EAGtDe,GAAgB,EAAMj+B,KAAKo8B,OAAON,iBAElC97B,KAAKq7B,gBAAkB4C,EACvBj+B,KAAKo8B,OAAOzF,KAAO/pB,KAAKoC,IAAI,EAAGhP,KAAKo8B,OAAOzF,KAAOsH,EAAcxpB,GAGvC,IAArBzU,KAAKo8B,OAAOzF,MACZ32B,KAAKk+B,mBAEb,CACJ,CAKQ,sBAAAR,GAEJ,MAAMS,EAAen+B,KAAKo+B,sBAAsB,eAChDp+B,KAAKo8B,OAAON,iBAAmBlvB,KAAKoC,IAAI,GAAK,EAAsB,GAAfmvB,GAGpD,MAAME,EAAar+B,KAAKo+B,sBAAsB,QAC9Cp+B,KAAKo8B,OAAOU,eAAiBlwB,KAAKoC,IAAI,GAAK,EAAoB,GAAbqvB,GAGlD,MAAMC,EAAet+B,KAAKo+B,sBAAsB,WAChDp+B,KAAKo8B,OAAOW,eAAiBnwB,KAAKoC,IAAI,GAAK,EAAsB,GAAfsvB,GAGlD,MAAMC,EAAev+B,KAAKo+B,sBAAsB,UAChDp+B,KAAKo8B,OAAOY,YAAcpwB,KAAKoC,IAAI,GAAK,EAAsB,GAAfuvB,EACnD,CAKQ,0BAAAX,GAEJ,MAAMY,EAAc5xB,KAAKoC,IAAI,GAAIhP,KAAKo8B,OAAOI,KAAO,IAAM,IAE1Dx8B,KAAKo8B,OAAON,kBAAqB,EAAkB,GAAd0C,EACrCx+B,KAAKo8B,OAAOU,gBAAmB,EAAkB,GAAd0B,EACnCx+B,KAAKo8B,OAAOW,gBAAmB,EAAkB,GAAdyB,EAGnC,MAAMC,EAAaz+B,KAAKo8B,OAAOG,MAAQ,IACvC,GAAIkC,EAAa,GAAK,CAClB,MAAMC,EAAoC,GAApB,GAAMD,GAC5Bz+B,KAAKo8B,OAAON,kBAAqB,EAAmB,GAAf4C,EACrC1+B,KAAKo8B,OAAOU,gBAAmB,EAAmB,GAAf4B,EACnC1+B,KAAKo8B,OAAOW,gBAAmB,EAAmB,GAAf2B,CACvC,CACJ,CAKQ,oBAAAf,GAEA39B,KAAKo8B,OAAOC,KAAO,KACnBr8B,KAAKgJ,OAAOnD,KAAK,oCACjB7F,KAAK+kB,OAAO4Z,mBAAmB,WAI9B3+B,KAAKo8B,OAAOQ,aAAe58B,KAAKo8B,OAAOG,MAAQ,IAChDv8B,KAAKgJ,OAAOlD,MAAM,4BAItBmvB,OAAOvuB,QAAQq0B,GAAa5rB,QAAQ,EAAEiG,EAAKioB,MACnBr9B,KAAKo+B,sBAAsBf,GAC7B,KACdr9B,KAAKgJ,OAAOnD,KAAK,yBAAyBw3B,aAC1Cr9B,KAAK+kB,OAAO4Z,mBAAmBtB,KAG3C,CAKQ,kBAAAS,GACJ99B,KAAKgJ,OAAOlD,MAAM,mDAGlB9F,KAAKo8B,OAAOO,eAAgB,EAC5B38B,KAAKi9B,gBAAgBE,QAAU,EAC/Bn9B,KAAKi9B,gBAAgBG,QAAU,EAG/Bp9B,KAAKi9B,gBAAgBC,QAAUtwB,KAAKuD,IAAInQ,KAAKi9B,gBAAgBC,QAAS,IACtEl9B,KAAKi9B,gBAAgBX,QAAU1vB,KAAKuD,IAAInQ,KAAKi9B,gBAAgBX,QAAS,IAEtEt8B,KAAK+kB,OAAO6Z,kBAChB,CAKQ,cAAAb,GACJ/9B,KAAKgJ,OAAOlD,MAAM,0CAGlB9F,KAAKi9B,gBAAgBC,SAAW,GAChCl9B,KAAKi9B,gBAAgBE,SAAW,GAG5Bn9B,KAAKo8B,OAAOI,KAAO,KACnBx8B,KAAKo8B,OAAOO,eAAgB,EAC5B38B,KAAKi9B,gBAAgBE,QAAU,GAGnCn9B,KAAK+kB,OAAO8Z,cAChB,CAKQ,iBAAAX,GACJl+B,KAAKgJ,OAAOlD,MAAM,mCAElB9F,KAAKo8B,OAAOK,eAAgB,EAC5Bz8B,KAAKo8B,OAAOO,eAAgB,EAC5B38B,KAAKo8B,OAAOM,eAAgB,EAG5B18B,KAAKi9B,gBAAkB,CACnBC,QAAS,EACTZ,QAAS,EACTa,QAAS,EACTP,YAAa,IACbQ,QAAS,EAEjB,CAKA,WAAA0B,CAAYzB,EAAsB3V,EAAgBqX,EAA+C,WAE7F,IAAIC,EAAetX,EAEnB,GAAI1nB,KAAKo8B,OAAOM,eAAiB18B,KAAKo8B,OAAOE,QAAU,EAAG,CACtD,MAAM2C,EAAmBryB,KAAKuD,IAAInQ,KAAKo8B,OAAOE,QAAS5U,EAAS1nB,KAAKo8B,OAAOU,gBAC5E98B,KAAKo8B,OAAOE,SAAW2C,EACvBD,GAAgBC,EAEhBj/B,KAAKgJ,OAAOxD,MAAM,oBAAoBy5B,EAAiB51B,QAAQ,YACnE,CAEI21B,EAAe,IAEfh/B,KAAKo8B,OAAOC,KAAOzvB,KAAKoC,IAAI,EAAGhP,KAAKo8B,OAAOC,KAAO2C,GAGlDh/B,KAAKk/B,gBAAgB7B,EAAS2B,GAE9Bh/B,KAAKgJ,OAAOnD,KAAK,GAAGw3B,kBAAwB2B,EAAa31B,QAAQ,MAAM01B,YAE/E,CAKQ,eAAAG,CAAgB7B,EAAsBnC,GAC1C,MAAMiE,EAAWn/B,KAAKo/B,wBAAwBlE,GACxCmE,EAAkBr/B,KAAKs/B,mBAAmBjC,GAE1CkC,EAA6B,CAC/BlC,UACA8B,WACAE,kBACAG,WAAYx/B,KAAKy/B,oBAAoBN,GACrCO,WAAY1/B,KAAK2/B,oBAAoBR,IAGnCS,EAAgB5/B,KAAKk7B,OAAOhyB,IAAIm0B,IAAY,GAClDuC,EAAcj5B,KAAK44B,GACnBv/B,KAAKk7B,OAAOnyB,IAAIs0B,EAASuC,GAGzBP,EAAgBlwB,QAAQqgB,IACpBxvB,KAAK+kB,OAAO8a,iBAAiBrQ,EAAQ2P,IAE7C,CAKQ,uBAAAC,CAAwBlE,GAC5B,OAAIA,GAAU,GAAW,WACrBA,GAAU,GAAW,QACrBA,GAAU,GAAW,WAClB,OACX,CAKQ,kBAAAoE,CAAmBjC,GAYvB,MAXqD,CACjDyC,IAAmB,CAAC,UAAoB,cACxCC,MAAqB,CAAC,WACtBC,KAAoB,GACpBC,UAAyB,GACzBC,KAAoB,CAAC,eAAwB,WAC7CC,OAAsB,CAAC,aAAuB,iBAA2B,WACzEC,YAA2B,CAAC,UAAoB,cAChDjD,QAAuB,CAAC,YAGXE,IAAY,EACjC,CAKQ,mBAAAoC,CAAoBN,GASxB,MARiB,CACbkB,MAAwB,CAAEC,MAAO,EAAGC,YAAa,EAAGC,SAAU,GAC9DC,SAA2B,CAAEH,MAAO,GAAIC,YAAa,EAAGC,SAAU,GAClEE,MAAwB,CAAEJ,MAAO,GAAIC,YAAa,GAAIC,SAAU,GAChEt6B,SAA2B,CAAEo6B,MAAO,GAAIC,YAAa,GAAIC,SAAU,GAAIG,SAAU,GACjFC,UAA4B,CAAEN,MAAO,IAAKC,YAAa,GAAIC,SAAU,GAAIG,SAAU,KAGvExB,EACpB,CAKQ,mBAAAQ,CAAoBR,GASxB,MARkB,CACdkB,MAAwB,GACxBI,SAA2B,IAC3BC,MAAwB,IACxBx6B,SAA2B,IAC3B06B,UAA4B,MAGfzB,EACrB,CAKQ,qBAAAf,CAAsBf,GAC1B,MAAMwD,EAAU7gC,KAAKk7B,OAAOhyB,IAAIm0B,IAAY,GAC5C,IAAIyD,EAAc,EAalB,OAXAD,EAAQ1xB,QAAQ+rB,IAQZ4F,GAPuB,CACnBT,MAAwB,GACxBI,SAA2B,IAC3BC,MAAwB,GACxBx6B,SAA2B,GAC3B06B,UAA4B,GAEF1F,EAAOiE,YAGlCvyB,KAAKuD,IAAI,EAAK2wB,EACzB,CAKA,YAAAC,CAAa1D,EAAsB2D,EAAqBpK,GACpD,MAAMiK,EAAU7gC,KAAKk7B,OAAOhyB,IAAIm0B,GAChC,IAAKwD,IAAYA,EAAQG,GAAc,OAAO,EAE9C,MAAMzB,EAAesB,EAAQG,GAG7B,QAAKhhC,KAAKihC,mBAAmBrK,EAAW2I,EAAaC,cAKrDqB,EAAQl5B,OAAOq5B,EAAa,GAC5BhhC,KAAKk7B,OAAOnyB,IAAIs0B,EAASwD,GAGzB7gC,KAAKo8B,OAAOC,KAAOzvB,KAAKuD,IAAInQ,KAAKiF,OAAOu2B,QAASx7B,KAAKo8B,OAAOC,KAAO,IAGpEkD,EAAaF,gBAAgBlwB,QAAQqgB,IACjCxvB,KAAK+kB,OAAOmc,mBAAmB1R,KAGnCxvB,KAAKgJ,OAAOpD,KAAK,YAAY25B,EAAaJ,sBAAsB9B,cACzD,EACX,CAKQ,kBAAA4D,CAAmBE,EAAuBC,GAC9C,OAAOD,EAAUb,OAASc,EAASd,OAC5Ba,EAAUZ,aAAea,EAASb,aAClCY,EAAUX,UAAYY,EAASZ,gBACR,IAAtBY,EAAST,WAA2BQ,EAAUR,UAAY,IAAMS,EAAST,SACrF,CAKA,kBAAAU,CAAmBC,GACfthC,KAAKi9B,gBAAkB,IAAKj9B,KAAKi9B,mBAAoBqE,GAGrD,MAAMC,EAAQtM,OAAOtc,OAAO3Y,KAAKi9B,iBAAiBuE,OAAO,CAACC,EAAKC,IAAQD,EAAMC,EAAK,GAClF,GAAIH,EAAQ,IAAK,CAEb,MAAMn2B,EAAQ,IAAMm2B,EACpBtM,OAAO3f,KAAKtV,KAAKi9B,iBAAiB9tB,QAAQiG,IACrCpV,KAAKi9B,gBAAwB7nB,IAAQhK,GAE9C,CAEApL,KAAKgJ,OAAOxD,MAAM,2BAA4BxF,KAAKi9B,gBACvD,CAKA,YAAA0E,CAAanS,EAAoBnY,GAC7B,MAAMoZ,OAAqB,IAAVpZ,EAAsBA,GAASrX,KAAK4hC,eAAepS,GAEpE,OAAQA,GACJ,IAAK,UACDxvB,KAAKo8B,OAAOK,cAAgBhM,EAC5B,MACJ,IAAK,UACDzwB,KAAKo8B,OAAOM,cAAgBjM,EAC5B,MACJ,IAAK,UACDzwB,KAAKo8B,OAAOO,cAAgBlM,EAC5B,MACJ,IAAK,eACDzwB,KAAKo8B,OAAOQ,YAAcnM,EAC1B,MACJ,IAAK,aACDzwB,KAAKo8B,OAAOS,UAAYpM,EAIhCzwB,KAAKgJ,OAAOxD,MAAM,GAAGgqB,KAAUiB,EAAW,UAAY,aAC1D,CAKQ,cAAAmR,CAAepS,GACnB,OAAQA,GACJ,IAAK,UAAoB,OAAOxvB,KAAKo8B,OAAOK,cAC5C,IAAK,UAAoB,OAAOz8B,KAAKo8B,OAAOM,cAC5C,IAAK,UAAoB,OAAO18B,KAAKo8B,OAAOO,cAC5C,IAAK,eAAwB,OAAO38B,KAAKo8B,OAAOQ,YAChD,IAAK,aAAsB,OAAO58B,KAAKo8B,OAAOS,UAC9C,QAAS,OAAO,EAExB,CAKA,SAAAgF,GACI,MAAO,IAAK7hC,KAAKo8B,OACrB,CAKA,kBAAA0F,GACI,MAAO,IAAK9hC,KAAKi9B,gBACrB,CAKA,gBAAA8E,GACI,OAAO,IAAIj5B,IAAI9I,KAAKk7B,OACxB,CAKA,cAAA8G,GACI,MAAO,CACH5G,iBAAkBp7B,KAAKo7B,iBACvBD,eAAgBn7B,KAAKm7B,eACrBE,gBAAiBr7B,KAAKq7B,gBACtB4G,mBAAoB5rB,MAAMC,KAAKtW,KAAKk7B,OAAOviB,UAAU6oB,OAAO,CAACC,EAAKS,IAAYT,EAAMS,EAAQt7B,OAAQ,GACpGu7B,gBAAiBniC,KAAKoiC,qBAE9B,CAKQ,kBAAAA,GACJ,MAAMl8B,EAAyB,GAQ/B,OANIlG,KAAKo8B,OAAOC,KAAO,IAAIn2B,EAASS,KAAK,gBACrC3G,KAAKo8B,OAAOG,MAAQ,IAAIr2B,EAASS,KAAK,WACtC3G,KAAKo8B,OAAOI,KAAO,IAAIt2B,EAASS,KAAK,WACpC3G,KAAKo8B,OAAOK,eAAev2B,EAASS,KAAK,WACzC3G,KAAKo8B,OAAOQ,aAAa12B,EAASS,KAAK,gBAErCT,CACX,CAKA,OAAAm8B,CAAQ3a,GACJ1nB,KAAKo8B,OAAOzF,KAAO/pB,KAAKuD,IAAInQ,KAAKiF,OAAO02B,QAAS37B,KAAKo8B,OAAOzF,KAAOjP,EACxE,CAKA,QAAA4a,CAAS5a,GACL1nB,KAAKo8B,OAAOG,MAAQ3vB,KAAKuD,IAAInQ,KAAKiF,OAAOy2B,SAAU17B,KAAKo8B,OAAOG,MAAQ7U,EAC3E,CAKA,eAAA6a,GACIviC,KAAKo8B,OAAOC,KAAOzvB,KAAKoC,IAAIhP,KAAKo8B,OAAOC,KAAM,IAC9Cr8B,KAAKo8B,OAAOG,MAAQ3vB,KAAKoC,IAAIhP,KAAKo8B,OAAOG,MAAO,IAChDv8B,KAAKo8B,OAAOI,KAAO5vB,KAAKuD,IAAInQ,KAAKo8B,OAAOI,KAAM,IAG9Cx8B,KAAKo8B,OAAOK,eAAgB,EAC5Bz8B,KAAKo8B,OAAOQ,aAAc,EAE1B58B,KAAKgJ,OAAOpD,KAAK,gCACrB,EC5rBG,MAAM48B,EAmCT,WAAA19B,CACIG,EAAmC,GACnC8f,EAAqB,CAAA,GAhCzB/kB,KAAQqX,MAAmB,OAC3BrX,KAAQyiC,WAAqB,EAC7BziC,KAAQ0iC,YAAsB,EAC9B1iC,KAAQ2iC,UAAoB,EAG5B3iC,KAAQgK,UAA4B,GACpChK,KAAQ4iC,mBAA0C,GAClD5iC,KAAQ6iC,gBAA0B,EAClC7iC,KAAQ2mB,WAA8B,CAAEkC,UAAW,EAAG7a,OAAQ,EAAG+O,OAAQ,CAAErQ,EAAG,EAAGC,EAAG,IAGpF3M,KAAQ8iC,aAAwB,CAAEp2B,EAAG,EAAGC,EAAG,GAC3C3M,KAAQ+iC,SAAmB,GAC3B/iC,KAAQgjC,cAAwB,EAGhChjC,KAAiBijC,0BAA4B,EAC7CjjC,KAAiBkjC,wBAA0B,EAC3CljC,KAAiBmjC,0BAA4B,EAC7CnjC,KAAiBojC,eAAiB,EAGlCpjC,KAAQqjC,kBAA4B,EACpCrjC,KAAQsjC,mBAA6B,EACrCtjC,KAAQujC,mBAA6B,EACrCvjC,KAAQwjC,oBAA8B,EAQlCxjC,KAAKgJ,OAAS,IAAIO,EAAO,aACzBvJ,KAAK+kB,OAASA,EAEd/kB,KAAKiF,OAAS,CACVw+B,gBAAiB,GACjBC,WAAY,GACZC,cAAe,GACfC,SAAU,IACVC,aAAc,MACX5+B,GAGPjF,KAAKgJ,OAAOpD,KAAK,mCAAoC,CACjD69B,gBAAiBzjC,KAAKiF,OAAOw+B,gBAC7BE,cAAe3jC,KAAKiF,OAAO0+B,eAEnC,CAKA,YAAAG,CAAahB,EAAuBC,GAChC,MAAmB,SAAf/iC,KAAKqX,OACLrX,KAAKgJ,OAAOnD,KAAK,uCACV,IAGX7F,KAAK8iC,aAAe,IAAKA,GACzB9iC,KAAK+iC,SAAWA,EAChB/iC,KAAKqX,MAAQ,WACbrX,KAAKyiC,WAAa,EAClBziC,KAAK0iC,YAAa,EAGlB1iC,KAAK+jC,sBAEL/jC,KAAKgJ,OAAOpD,KAAK,6CACjB5F,KAAK+kB,OAAOif,iBAEL,EACX,CAKA,cAAAC,GACuB,WAAfjkC,KAAKqX,QACLrX,KAAKqX,MAAQ,eACbrX,KAAKyiC,WAAa,EAClBziC,KAAK2iC,UAAW,EAEhB3iC,KAAKgJ,OAAOpD,KAAK,+CAEzB,CAKQ,mBAAAm+B,GACJ/jC,KAAKgK,UAAY,GAGjB,IAAA,IAASuC,EAAI,EAAGA,EAAIvM,KAAKiF,OAAO0+B,cAAep3B,IAAK,CAEhD,MAAM23B,EAAmB,EAAVt3B,KAAKuU,GAAS5U,EAAKvM,KAAKiF,OAAO0+B,cAAgC,GAAhB/2B,KAAK2U,SAC7D9Q,EALU,IAK+B,GAAhB7D,KAAK2U,SAE9B7G,EAAW,CACbhO,EAAG1M,KAAK8iC,aAAap2B,EAAIE,KAAKiX,IAAIqgB,GAASzzB,EAC3C9D,EAAG3M,KAAK8iC,aAAan2B,EAAIC,KAAKqU,IAAIijB,GAASzzB,GAIzC0zB,EAAS,CACX,CAAE74B,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAGvBxL,KAAKgK,UAAUrD,KAAK,CAChB+T,SAAU,IAAKA,GACfH,SAAU,CAAE7N,EAAG,EAAGC,EAAG,GACrBL,MAAO63B,EAAOv3B,KAAKC,MAAMD,KAAK2U,SAAW4iB,EAAOv9B,SAChDw9B,KAAM,EACN/4B,KAAsB,EAAhBuB,KAAK2U,SAAe,EAC1B8iB,UAAU,GAElB,CACJ,CAKA,MAAA7vB,CAAOC,EAAmBquB,GAItB,OAHA9iC,KAAK8iC,aAAe,IAAKA,GACzB9iC,KAAKyiC,YAAchuB,EAEXzU,KAAKqX,OACT,IAAK,WACDrX,KAAKskC,oBAAoB7vB,GACzB,MAEJ,IAAK,SACDzU,KAAKukC,sBAAsB9vB,GAC3B,MAEJ,IAAK,YACDzU,KAAKwkC,yBAAyB/vB,GAC9B,MAEJ,IAAK,SACDzU,KAAKykC,iBAAiBhwB,GACtB,MAEJ,IAAK,eACDzU,KAAK0kC,mBAAmBjwB,GAUhC,OALAzU,KAAK2kC,gBAAgBlwB,GACrBzU,KAAK4kC,oBAAoBnwB,GACzBzU,KAAK6kC,sBAAsBpwB,GAGpBzU,KAAK2iC,SAAW3iC,KAAKiF,OAAOw+B,gBAAkB,CACzD,CAKQ,mBAAAa,CAAoB7vB,GACxB,MAAM+M,EAAWxhB,KAAKyiC,WAAaziC,KAAKijC,0BACxCjjC,KAAKqjC,kBAAoBz2B,KAAKuD,IAAI,EAAKqR,GAGvCxhB,KAAKgK,UAAUmF,QAAQ21B,IACnB,IAAKA,EAAST,SAAU,CACpB,MAAMU,EAAW,CACbr4B,EAAG1M,KAAK8iC,aAAap2B,EAAIo4B,EAASpqB,SAAShO,EAC3CC,EAAG3M,KAAK8iC,aAAan2B,EAAIm4B,EAASpqB,SAAS/N,GAEzC8D,EAAW7D,KAAK8D,KAAKq0B,EAASr4B,EAAIq4B,EAASr4B,EAAIq4B,EAASp4B,EAAIo4B,EAASp4B,GAE3E,GAAI8D,EAAW,EAAG,CAEd,MAAM+J,EAAQ,GAAiB,IAAXgH,EACpBsjB,EAASvqB,SAAS7N,EAAKq4B,EAASr4B,EAAI+D,EAAY+J,EAChDsqB,EAASvqB,SAAS5N,EAAKo4B,EAASp4B,EAAI8D,EAAY+J,EAGhDsqB,EAASpqB,SAAShO,GAAKo4B,EAASvqB,SAAS7N,EAAI+H,EAC7CqwB,EAASpqB,SAAS/N,GAAKm4B,EAASvqB,SAAS5N,EAAI8H,CACjD,MACIqwB,EAAST,UAAW,CAE5B,IAIArkC,KAAKyiC,YAAcziC,KAAKijC,4BACxBjjC,KAAKqX,MAAQ,SACbrX,KAAKyiC,WAAa,EAClBziC,KAAKgJ,OAAOxD,MAAM,0CAE1B,CAKQ,qBAAA++B,CAAsB9vB,GAC1B,MAAM+M,EAAWxhB,KAAKyiC,WAAaziC,KAAKkjC,wBACxCljC,KAAKsjC,mBAAqB12B,KAAKuD,IAAI,EAAKqR,GAGxCxhB,KAAK6iC,gBAAmB7iC,KAAK+iC,SAAW,EAAK/iC,KAAKsjC,mBAG9CtjC,KAAKyiC,YAAcziC,KAAKkjC,0BACxBljC,KAAKqX,MAAQ,YACbrX,KAAKyiC,WAAa,EAClBziC,KAAKglC,0BACLhlC,KAAKgJ,OAAOxD,MAAM,6CAE1B,CAKQ,wBAAAg/B,CAAyB/vB,GAC7B,MAAM+M,EAAWxhB,KAAKyiC,WAAaziC,KAAKmjC,0BACxCnjC,KAAKujC,mBAAqB32B,KAAKuD,IAAI,EAAKqR,GAGxC,MAAMyjB,GAAuBjlC,KAAKkjC,wBAA0BljC,KAAKyiC,aACtCziC,KAAKkjC,wBAA0BljC,KAAKmjC,2BAC/DnjC,KAAK6iC,gBAAkB7iC,KAAK+iC,SAAWkC,EAGnCjlC,KAAKyiC,YAAcziC,KAAKmjC,4BACxBnjC,KAAKqX,MAAQ,SACbrX,KAAKyiC,WAAa,EAClBziC,KAAK2iC,UAAW,EAChB3iC,KAAK0iC,YAAa,EAGlB1iC,KAAK2mB,WAAW5J,OAAS,IAAK/c,KAAK8iC,cACnC9iC,KAAK2mB,WAAW3Y,OAAS,IAEzBhO,KAAKgJ,OAAOpD,KAAK,yDACjB5F,KAAK+kB,OAAOmgB,sBACZllC,KAAK+kB,OAAOogB,qBAEpB,CAKQ,gBAAAV,CAAiBhwB,GAErBzU,KAAKqjC,kBAAoB,EACzBrjC,KAAKsjC,mBAAqB,EAC1BtjC,KAAKujC,mBAAqB,EAC1BvjC,KAAKwjC,oBAAsB,EAG3BxjC,KAAK2mB,WAAW5J,OAAS,IAAK/c,KAAK8iC,aACvC,CAKQ,kBAAA4B,CAAmBjwB,GACvB,MAAM+M,EAAWxhB,KAAKyiC,WAAaziC,KAAKojC,eAClCgC,EAAkB,EAAM5jB,EAG9BxhB,KAAKwjC,oBAAsB4B,EAC3BplC,KAAKsjC,mBAAqB12B,KAAKoC,IAAI,EAAGo2B,EAAkB,IACxDplC,KAAKujC,mBAAqB32B,KAAKoC,IAAI,EAAGo2B,EAAkB,IACxDplC,KAAKqjC,kBAAoBz2B,KAAKoC,IAAI,EAAGo2B,EAAkB,IAGnD5jB,EAAW,IAAO5U,KAAK2U,SAAW,IAClCvhB,KAAKqlC,0BAILrlC,KAAKyiC,YAAcziC,KAAKojC,iBACxBpjC,KAAKqX,MAAQ,OACbrX,KAAKyiC,WAAa,EAClBziC,KAAKslC,kBAELtlC,KAAKgJ,OAAOpD,KAAK,sCACjB5F,KAAK+kB,OAAOwgB,cAEpB,CAKQ,uBAAAP,GACJhlC,KAAK4iC,mBAAqB,GAG1B,IAAA,IAASr2B,EAAI,EAAGA,EAFM,GAEaA,IAC/BvM,KAAK4iC,mBAAmBj8B,KAAK,CACzBu9B,MAAOt3B,KAAK2U,SAAW3U,KAAKuU,GAAK,EACjCnT,OAAQ,GAAqB,GAAhBpB,KAAK2U,SAClB/G,MAAO,EAAoB,EAAhB5N,KAAK2U,SAChBjV,MAAOtM,KAAKwlC,oBACZn6B,KAAsB,EAAhBuB,KAAK2U,SAAe,EAC1B6iB,KAAM,GAGlB,CAKQ,iBAAAoB,GACJ,MAAMrB,EAAS,CACX,CAAE74B,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAEvB,OAAO24B,EAAOv3B,KAAKC,MAAMD,KAAK2U,SAAW4iB,EAAOv9B,QACpD,CAKQ,eAAA+9B,CAAgBlwB,GACpBzU,KAAKgK,UAAUmF,QAAQ21B,IACnB,GAAmB,iBAAf9kC,KAAKqX,QAAqCytB,EAAST,SAAU,CAE7D,MAAMoB,EAAa,CACf/4B,EAAGo4B,EAASpqB,SAAShO,EAAI1M,KAAK8iC,aAAap2B,EAC3CC,EAAGm4B,EAASpqB,SAAS/N,EAAI3M,KAAK8iC,aAAan2B,GAEzC8D,EAAW7D,KAAK8D,KAAK+0B,EAAW/4B,EAAI+4B,EAAW/4B,EAAI+4B,EAAW94B,EAAI84B,EAAW94B,GAEnF,GAAI8D,EAAW,EAAG,CACd,MAAM+J,EAAQ,IACdsqB,EAASvqB,SAAS7N,EAAK+4B,EAAW/4B,EAAI+D,EAAY+J,EAClDsqB,EAASvqB,SAAS5N,EAAK84B,EAAW94B,EAAI8D,EAAY+J,EAElDsqB,EAASpqB,SAAShO,GAAKo4B,EAASvqB,SAAS7N,EAAI+H,EAC7CqwB,EAASpqB,SAAS/N,GAAKm4B,EAASvqB,SAAS5N,EAAI8H,CACjD,CAEAqwB,EAASV,MAAoB,EAAZ3vB,CACrB,GAER,CAKQ,mBAAAmwB,CAAoBnwB,GACxBzU,KAAK4iC,mBAAmBzzB,QAAQ21B,IAE5BA,EAASZ,OAASY,EAAStqB,MAAQ/F,GAAa,GAAsB,GAAhB7H,KAAK2U,UAG3DujB,EAAS92B,QAAyC,EAA/BpB,KAAKqU,IAAqB,EAAjB6jB,EAASZ,OAAiBzvB,EAGnC,iBAAfzU,KAAKqX,QACLytB,EAAS92B,QAAU,GAAKyG,EACxBqwB,EAASV,MAAoB,IAAZ3vB,KAKzBzU,KAAK4iC,mBAAqB5iC,KAAK4iC,mBAAmB56B,OAAO09B,GAAKA,EAAEtB,KAAO,EAC3E,CAKQ,qBAAAS,CAAsBpwB,GACtBzU,KAAKwjC,oBAAsB,IAE3BxjC,KAAK2mB,WAAWkC,UAAY7oB,KAAKwjC,qBAAuB,GAAsC,GAAhC52B,KAAKqU,IAAsB,EAAlBjhB,KAAKyiC,aAEpF,CAKQ,uBAAA4C,GACJ,IAAA,IAAS94B,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAM23B,EAAQt3B,KAAK2U,SAAW3U,KAAKuU,GAAK,EAClC1Q,EAA2B,GAAhB7D,KAAK2U,SAEtBvhB,KAAKgK,UAAUrD,KAAK,CAChB+T,SAAU,CACNhO,EAAG1M,KAAK8iC,aAAap2B,EAAIE,KAAKiX,IAAIqgB,GAASzzB,EAC3C9D,EAAG3M,KAAK8iC,aAAan2B,EAAIC,KAAKqU,IAAIijB,GAASzzB,GAE/C8J,SAAU,CACN7N,EAAqB,GAAlBE,KAAKiX,IAAIqgB,GACZv3B,EAAqB,GAAlBC,KAAKqU,IAAIijB,IAEhB53B,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC1B44B,KAAM,GACN/4B,KAAsB,EAAhBuB,KAAK2U,SAAe,EAC1B8iB,UAAU,GAElB,CACJ,CAKQ,eAAAiB,GACJtlC,KAAKgK,UAAY,GACjBhK,KAAK4iC,mBAAqB,GAC1B5iC,KAAK6iC,gBAAkB,EACvB7iC,KAAKqjC,kBAAoB,EACzBrjC,KAAKsjC,mBAAqB,EAC1BtjC,KAAKujC,mBAAqB,EAC1BvjC,KAAKwjC,oBAAsB,CAC/B,CAKA,MAAAnQ,CAAOC,GACgB,SAAftzB,KAAKqX,QAGLrX,KAAKwjC,oBAAsB,GAC3BxjC,KAAK2lC,sBAAsBrS,GAI3BtzB,KAAKqjC,kBAAoB,GACzBrjC,KAAK4lC,gBAAgBtS,GAIrBtzB,KAAKujC,mBAAqB,GAC1BvjC,KAAK6lC,oBAAoBvS,GAIzBtzB,KAAKsjC,mBAAqB,GAC1BtjC,KAAK8lC,gBAAgBxS,GAE7B,CAKQ,eAAAsS,CAAgBtS,GACpBtzB,KAAKgK,UAAUmF,QAAQ21B,IACnB,GAAIA,EAASV,KAAO,EAAG,CACnB,MAAM2B,EAAQjB,EAASV,KAAOpkC,KAAKqjC,kBAC7B/2B,EAAQ,CACVhB,EAAGsB,KAAKC,MAAMi4B,EAASx4B,MAAMhB,EAAIy6B,GACjCx6B,EAAGqB,KAAKC,MAAMi4B,EAASx4B,MAAMf,EAAIw6B,GACjCv6B,EAAGoB,KAAKC,MAAMi4B,EAASx4B,MAAMd,EAAIu6B,IAGrCzS,EAAStnB,SACL84B,EAASpqB,SAAShO,EAAIo4B,EAASz5B,KAAK,EACpCy5B,EAASpqB,SAAS/N,EAAIm4B,EAASz5B,KAAK,EACpCy5B,EAASz5B,KACTy5B,EAASz5B,KACTiB,EAER,GAER,CAKQ,eAAAw5B,CAAgBxS,GACpB,MAAMtlB,EAAShO,KAAK6iC,gBAAkB7iC,KAAKsjC,mBAC3C,GAAIt1B,EAAS,EAAG,CAEZslB,EAASzlB,WAAW7N,KAAK8iC,aAAap2B,EAAG1M,KAAK8iC,aAAan2B,EAAGqB,EAAQ,CAAE1C,EAAG,EAAGC,EAAG,EAAGC,EAAG,IAAK,GAG5F,MAAMw6B,EAAsB,IAATh4B,EACbi4B,EAAY,CAAE36B,EAAG,EAAGC,EAAG,EAAGC,EAAG,GACnC8nB,EAASzlB,WAAW7N,KAAK8iC,aAAap2B,EAAG1M,KAAK8iC,aAAan2B,EAAGq5B,EAAYC,GAAW,EACzF,CACJ,CAKQ,mBAAAJ,CAAoBvS,GACxBtzB,KAAK4iC,mBAAmBzzB,QAAQ21B,IAC5B,GAAIA,EAASV,KAAO,EAAG,CACnB,MAAM13B,EAAI1M,KAAK8iC,aAAap2B,EAAIE,KAAKiX,IAAIihB,EAASZ,OAASY,EAAS92B,OAC9DrB,EAAI3M,KAAK8iC,aAAan2B,EAAIC,KAAKqU,IAAI6jB,EAASZ,OAASY,EAAS92B,OAE9D+3B,EAAQjB,EAASV,KAAOpkC,KAAKujC,mBAC7Bj3B,EAAQ,CACVhB,EAAGsB,KAAKC,MAAMi4B,EAASx4B,MAAMhB,EAAIy6B,GACjCx6B,EAAGqB,KAAKC,MAAMi4B,EAASx4B,MAAMf,EAAIw6B,GACjCv6B,EAAGoB,KAAKC,MAAMi4B,EAASx4B,MAAMd,EAAIu6B,IAGrCzS,EAAStnB,SACLU,EAAIo4B,EAASz5B,KAAK,EAClBsB,EAAIm4B,EAASz5B,KAAK,EAClBy5B,EAASz5B,KACTy5B,EAASz5B,KACTiB,EAER,GAER,CAKQ,qBAAAq5B,CAAsBrS,GAK1B,MAAMzK,EAAY7oB,KAAK2mB,WAAWkC,UAClC,GAAIA,EAAY,EAAG,CACf,MAAM/Z,EAAQ,EACd,IAAA,IAASvC,EAAI,EAAGA,EAAIuC,EAAOvC,IAAK,CAC5B,MAAM23B,EAAmB,EAAVt3B,KAAKuU,GAAS5U,EAAKuC,EAC5Bo3B,EAAalmC,KAAK2mB,WAAW3Y,OAEnC,IAAA,IAAS1C,EAAiB,GAAb46B,EAAkB56B,EAAiB,IAAb46B,EAAkB56B,GAAK,GAAI,CAC1D,MAAMqb,EAAa/Z,KAAKqU,IAAsB,EAAlBjhB,KAAKyiC,WAAqB,GAAJn3B,GAAWud,EAAY,EACnEnc,EAAI1M,KAAK2mB,WAAW5J,OAAOrQ,EAAIE,KAAKiX,IAAIqgB,IAAU54B,EAAIqb,GACtDha,EAAI3M,KAAK2mB,WAAW5J,OAAOpQ,EAAIC,KAAKqU,IAAIijB,IAAU54B,EAAIqb,GAEtDof,EAAoB,GAAZld,GAAmB,GAAKvd,EAAiB,GAAb46B,GAAqBA,GACzD55B,EAAQ,CACVhB,EAAGsB,KAAKC,MAAM,GAAKk5B,GACnBx6B,EAAGqB,KAAKC,MAAM,GAAKk5B,GACnBv6B,EAAGoB,KAAKC,MAAM,GAAKk5B,IAGvBzS,EAAStnB,SAASU,EAAI,EAAGC,EAAI,EAAG,EAAG,EAAGL,EAC1C,CACJ,CACJ,CACJ,CAKA,QAAA65B,GACI,OAAOnmC,KAAKqX,KAChB,CAKA,YAAA+uB,GACI,OAAOpmC,KAAK2iC,QAChB,CAKA,cAAA0D,GACI,OAAOrmC,KAAK0iC,UAChB,CAKA,eAAA4D,GACI,OAAQtmC,KAAKqX,OACT,IAAK,WACD,OAAOrX,KAAKyiC,WAAaziC,KAAKijC,0BAClC,IAAK,SACD,OAAOjjC,KAAKyiC,WAAaziC,KAAKkjC,wBAClC,IAAK,YACD,OAAOljC,KAAKyiC,WAAaziC,KAAKmjC,0BAClC,IAAK,eACD,OAAO,EAAOnjC,KAAKyiC,WAAaziC,KAAKojC,eACzC,IAAK,SACD,OAAO,EACX,QACI,OAAO,EAEnB,CAKA,kBAAAmD,GACI,MAAO,IAAKvmC,KAAK2mB,WACrB,CAKA,iBAAAuX,GACuB,SAAfl+B,KAAKqX,QACLrX,KAAKqX,MAAQ,eACbrX,KAAKyiC,WAAa,EAClBziC,KAAK2iC,UAAW,EAChB3iC,KAAK0iC,YAAa,EAElB1iC,KAAKgJ,OAAOnD,KAAK,wCAEzB,EC5oBG,MAAM2gC,EAsBT,WAAA1hC,CACI2hC,EACA9jC,EACAc,EACAkT,EACAugB,GAdJl3B,KAAQ6Y,SAAmB,EAC3B7Y,KAAQ0mC,YAAsB,EAC9B1mC,KAAQ2mC,cAA+B,KAGvC3mC,KAAQ4mC,gBAAoC,GAWxC5mC,KAAKymC,QAAUA,EACfzmC,KAAK2C,MAAQA,EACb3C,KAAKyD,MAAQA,EACbzD,KAAKgJ,OAAS,IAAIO,EAAO,cAGzBvJ,KAAKk3B,MAAQ,CACT2P,UAAW,IACXlL,QAAS,IACTnf,YAAa,IACbsqB,cAAe,EACfC,YAAa,IACblsB,KAAM,OACHqc,GAGPl3B,KAAKgnC,YAAchnC,KAAKk3B,MAAMyE,QAG9B37B,KAAKinC,cAAgBjnC,KAAKymC,QAAQ1oB,WAAW,cAAepH,EAAe3W,KAAKk3B,MAAMrc,MACtF7a,KAAKinC,cAAchpB,OAASje,KAAKk3B,MAAM2P,UAGvC7mC,KAAKinC,cAAcprB,YAAeqrB,GAAUlnC,KAAKmnC,gBAAgBD,GAGjElnC,KAAKymC,QAAQjtB,UAAUxZ,KAAKinC,eAG5BjnC,KAAKonC,YAAc,IAAInM,EAAY,CAC/BO,QAASx7B,KAAKk3B,MAAM2P,UACpBlL,QAAS37B,KAAKk3B,MAAMyE,QACpBE,YAAa77B,KAAKk3B,MAAM1a,YACxBsf,iBAAkB,KACnB,CACC+D,eAAgB,CAACrQ,EAAQ2P,KACrBn/B,KAAKgJ,OAAOnD,KAAK,MAAM2pB,qBAA0B2P,KACjDn/B,KAAKyD,MAAM6gB,cAEfqa,iBAAmBtB,IACfr9B,KAAKgJ,OAAOlD,MAAM,yBAAyBu3B,eAE/CuB,eAAgB,KACZ5+B,KAAKgJ,OAAOlD,MAAM,oDAEtB+4B,WAAY,KACR7+B,KAAKgJ,OAAOnD,KAAK,2CAKzB7F,KAAK68B,UAAY,IAAI2F,EAAU,CAC3BiB,gBAAiB,GACjBC,WAAY,GACZC,cAAe,IAChB,CACCK,YAAa,KACThkC,KAAKgJ,OAAOpD,KAAK,gDAErB2/B,UAAW,KACPvlC,KAAKgJ,OAAOpD,KAAK,uCAErBs/B,kBAAmB,KACfllC,KAAKgJ,OAAOpD,KAAK,sCAErBu/B,iBAAkB,KACdnlC,KAAKgJ,OAAOpD,KAAK,4CAIzB5F,KAAKgJ,OAAOpD,KAAK,yBAA0B,CACvC8U,SAAU/D,EACVugB,MAAOl3B,KAAKk3B,OAEpB,CAKA,MAAA1iB,CAAOC,GAEHzU,KAAKonC,YAAY5yB,OAAOC,GAGxB,MAAM4yB,EAAsBrnC,KAAK68B,UAAUroB,OAAOC,EAAWzU,KAAKinC,cAAcvsB,UAGhF1a,KAAKmtB,YAAY1Y,GAGjBzU,KAAKsnC,eAAe7yB,GAGpBzU,KAAKunC,eAAe9yB,EAAW4yB,GAG/BrnC,KAAKwnC,sBAAsB/yB,GAG3BzU,KAAKynC,cAGLznC,KAAK0nC,YAAYjzB,EACrB,CAKQ,WAAA0Y,CAAY1Y,IAEZzU,KAAK2C,MAAMqV,aAAa,SAAWhY,KAAK2C,MAAMmW,oBAC9C9Y,KAAK2nC,kBAIT,MAAMC,EAAc5nC,KAAK2C,MAAM8V,iBACzBovB,EAAgB7nC,KAAK2C,MAAMiW,mBASjC,IANA5Y,KAAK0mC,YAAc95B,KAAKoC,IAAI,EAAG44B,GAG/B5nC,KAAK6Y,UAAYgvB,EAAgB7nC,KAAKk3B,MAAM4P,cAAgBryB,EAGrDzU,KAAK6Y,SAAW,GAAG7Y,KAAK6Y,UAAsB,EAAVjM,KAAKuU,GAChD,KAAOnhB,KAAK6Y,SAAqB,EAAVjM,KAAKuU,IAAQnhB,KAAK6Y,UAAsB,EAAVjM,KAAKuU,EAC9D,CAKQ,cAAAmmB,CAAe7yB,GAGvB,CAKQ,eAAAkzB,GACJ,MAAMG,EAAe9nC,KAAKonC,YAAYvF,YAGjCiG,EAAajL,UAKdiL,EAAavL,MAAQ,GACrBv8B,KAAKgJ,OAAOnD,KAAK,wCAKjB7F,KAAK68B,UAAUuJ,eACfpmC,KAAK68B,UAAUoH,iBACPjkC,KAAK68B,UAAUwJ,kBACvBrmC,KAAK68B,UAAUiH,aAAa9jC,KAAKinC,cAAcvsB,SAAU,IAbzD1a,KAAKgJ,OAAOnD,KAAK,wBAezB,CAKQ,cAAA0hC,CAAe9yB,EAAmBgvB,EAA0B,GAChE,GAAIzjC,KAAK0mC,YAAc,GAAK1mC,KAAKgnC,YAAc,EAAG,CAE9C,MAAMe,EAA2B,CAC7Br7B,EAAGE,KAAKiX,IAAI7jB,KAAK6Y,SAAWjM,KAAKuU,GAAK,GACtCxU,EAAGC,KAAKqU,IAAIjhB,KAAK6Y,SAAWjM,KAAKuU,GAAK,IAIpC6mB,EAAchoC,KAAK0mC,YAAc1mC,KAAKk3B,MAAM1a,YAAcinB,EAChEzjC,KAAKymC,QAAQpqB,YAAYrc,KAAKinC,cAAcvwB,GAAIqxB,EAAiBC,GAGjEhoC,KAAKioC,uBACT,CAGA,MAAMC,EAAet7B,KAAK8D,KACtB1Q,KAAKinC,cAAc1sB,SAAS7N,GAAK,EAAI1M,KAAKinC,cAAc1sB,SAAS5N,GAAK,GAG1E,GAAIu7B,EAAeloC,KAAKk3B,MAAM6P,YAAa,CACvC,MAAM37B,EAAQpL,KAAKk3B,MAAM6P,YAAcmB,EACvCloC,KAAKinC,cAAc1sB,SAAS7N,GAAKtB,EACjCpL,KAAKinC,cAAc1sB,SAAS5N,GAAKvB,CACrC,CACJ,CAKQ,qBAAAo8B,CAAsB/yB,GAE1B,IAAA,IAASlI,EAAIvM,KAAK4mC,gBAAgBhgC,OAAS,EAAG2F,GAAK,EAAGA,IAAK,CACvD,MAAMu4B,EAAW9kC,KAAK4mC,gBAAgBr6B,GAGtCu4B,EAASpqB,SAAShO,GAAKo4B,EAASvqB,SAAS7N,EAAI+H,EAC7CqwB,EAASpqB,SAAS/N,GAAKm4B,EAASvqB,SAAS5N,EAAI8H,EAC7CqwB,EAASV,MAAQ3vB,EAGbqwB,EAASV,MAAQ,GACjBpkC,KAAK4mC,gBAAgBj/B,OAAO4E,EAAG,EAEvC,CACJ,CAKQ,qBAAA07B,GACJ,GAAIjoC,KAAK4mC,gBAAgBhgC,OAAS,GAAI,OAGtC,MAKMk+B,EAA2B,CAC7BpqB,SAAU,CAAEhO,EALC1M,KAAKinC,cAAcvsB,SAAShO,EADvB,GAC2BE,KAAKiX,IAAI7jB,KAAK6Y,SAAWjM,KAAKuU,GAAK,GAKvDxU,EAJZ3M,KAAKinC,cAAcvsB,SAAS/N,EAFvB,GAE2BC,KAAKqU,IAAIjhB,KAAK6Y,SAAWjM,KAAKuU,GAAK,IAKhF5G,SAAU,CACN7N,EAA4C,KAAxCE,KAAKiX,IAAI7jB,KAAK6Y,SAAWjM,KAAKuU,GAAK,GAAmC,IAAvBvU,KAAK2U,SAAW,IACnE5U,EAA4C,KAAxCC,KAAKqU,IAAIjhB,KAAK6Y,SAAWjM,KAAKuU,GAAK,GAAmC,IAAvBvU,KAAK2U,SAAW,KAEvE6iB,KAAM,GACN+D,QAAS,IAGbnoC,KAAK4mC,gBAAgBjgC,KAAKm+B,EAC9B,CAKQ,WAAA2C,GACAznC,KAAK0mC,YAAc,GAAK1mC,KAAKgnC,YAAc,EAEtChnC,KAAK2mC,gBACN3mC,KAAK2mC,cAAgB3mC,KAAKyD,MAAM0gB,mBAIhCnkB,KAAK2mC,gBACL3mC,KAAKyD,MAAM6f,UAAUtjB,KAAK2mC,eAC1B3mC,KAAK2mC,cAAgB,KAGjC,CAKQ,WAAAe,CAAYjzB,GAChB,GAAIzU,KAAK0mC,YAAc,EAAG,CACtB,MAAMrL,EAAqC,GAAnBr7B,KAAK0mC,YAAmBjyB,EAChDzU,KAAKgnC,YAAcp6B,KAAKoC,IAAI,EAAGhP,KAAKgnC,YAAc3L,GAEzB,IAArBr7B,KAAKgnC,aACLhnC,KAAKgJ,OAAOnD,KAAK,oBAEzB,CACJ,CAKQ,eAAAshC,CAAgBD,GAGpB,OAFAlnC,KAAKgJ,OAAOxD,MAAM,uBAAuB0hC,EAAMjjC,SAASijC,EAAMxwB,MAEtDwwB,EAAMjjC,MACV,IAAK,SACL,IAAK,WAED,MAAMmkC,EAAkB,GACxBpoC,KAAKqoC,WAAWD,GAGhBpoC,KAAKyD,MAAM4gB,cAAcrkB,KAAKinC,cAAcvsB,UAC5C,MAEJ,IAAK,aAED1a,KAAKqoC,WAAW,GAG5B,CAKA,UAAAA,CAAW3gB,GACH1nB,KAAKinC,cAAchpB,SACnBje,KAAKinC,cAAchpB,OAASrR,KAAKoC,IAAI,EAAGhP,KAAKinC,cAAchpB,OAASyJ,GACpE1nB,KAAKgJ,OAAOxD,MAAM,aAAakiB,qBAA0B1nB,KAAKinC,cAAchpB,UAE1C,IAA9Bje,KAAKinC,cAAchpB,QACnBje,KAAKsoC,UAGjB,CAKA,IAAAC,CAAK7gB,GACG1nB,KAAKinC,cAAchpB,SACnBje,KAAKinC,cAAchpB,OAASrR,KAAKuD,IAAInQ,KAAKk3B,MAAM2P,UAAW7mC,KAAKinC,cAAchpB,OAASyJ,GACvF1nB,KAAKgJ,OAAOxD,MAAM,eAAekiB,cAAmB1nB,KAAKinC,cAAchpB,UAE/E,CAKA,OAAAokB,CAAQ3a,GACJ1nB,KAAKgnC,YAAcp6B,KAAKuD,IAAInQ,KAAKk3B,MAAMyE,QAAS37B,KAAKgnC,YAActf,GACnE1nB,KAAKgJ,OAAOxD,MAAM,SAASkiB,oBAAyB1nB,KAAKgnC,cAC7D,CAKA,UAAAwB,GACI,GAAIxoC,KAAK2C,MAAMmW,kBAAmB,CAE9B,MAAM2vB,EAAc,GACdC,EAAS1oC,KAAKinC,cAAcvsB,SAAShO,EAAIE,KAAKiX,IAAI7jB,KAAK6Y,SAAWjM,KAAKuU,GAAK,GAAKsnB,EACjFE,EAAS3oC,KAAKinC,cAAcvsB,SAAS/N,EAAIC,KAAKqU,IAAIjhB,KAAK6Y,SAAWjM,KAAKuU,GAAK,GAAKsnB,EAGjFG,EAAkB,IAClBC,EAA8B,CAChCn8B,EAAGE,KAAKiX,IAAI7jB,KAAK6Y,SAAWjM,KAAKuU,GAAK,GAAKynB,EAAkB5oC,KAAKinC,cAAc1sB,SAAS7N,EACzFC,EAAGC,KAAKqU,IAAIjhB,KAAK6Y,SAAWjM,KAAKuU,GAAK,GAAKynB,EAAkB5oC,KAAKinC,cAAc1sB,SAAS5N,GAIvFm8B,EAAa9oC,KAAKymC,QAAQtoB,iBAC5B,cAAc9X,KAAKC,QACnB,CAAEoG,EAAGg8B,EAAQ/7B,EAAGg8B,GAChBE,GAIJ7oC,KAAKymC,QAAQjtB,UAAUsvB,GAGvB9oC,KAAKyD,MAAM2gB,eAAepkB,KAAKinC,cAAcvsB,UAE7C1a,KAAKgJ,OAAOxD,MAAM,eACtB,CACJ,CAKQ,OAAA8iC,GACJtoC,KAAKgJ,OAAOnD,KAAK,mBAGjB7F,KAAKyD,MAAM4gB,cAAcrkB,KAAKinC,cAAcvsB,UAGxC1a,KAAK2mC,gBACL3mC,KAAKyD,MAAM6f,UAAUtjB,KAAK2mC,eAC1B3mC,KAAK2mC,cAAgB,MAIzB3mC,KAAKymC,QAAQ/sB,aAAa1Z,KAAKinC,cAAcvwB,GACjD,CAKA,qBAAAqyB,CAAsBzV,GAClBtzB,KAAK4mC,gBAAgBz3B,QAAQ21B,IACzB,MAAMiB,EAAQjB,EAASV,KAAOU,EAASqD,QACjC77B,EAAQ,CACVhB,EAAG,IACHC,EAAGqB,KAAKC,MAAM,IAAMk5B,GACpBv6B,EAAG,EACHgB,EAAGI,KAAKC,MAAM,IAAMk5B,IAGxBzS,EAAS7mB,SACLG,KAAKC,MAAMi4B,EAASpqB,SAAShO,GAC7BE,KAAKC,MAAMi4B,EAASpqB,SAAS/N,GAC7BL,IAGZ,CAKA,WAAA08B,GACI,MAAO,CACHtuB,SAAU,IAAK1a,KAAKinC,cAAcvsB,UAClCH,SAAU,IAAKva,KAAKinC,cAAc1sB,UAClC1B,SAAU7Y,KAAK6Y,SACfoF,OAAQje,KAAKinC,cAAchpB,QAAU,EACrC0Y,KAAM32B,KAAKgnC,YACXN,YAAa1mC,KAAK0mC,YAClBG,UAAW7mC,KAAKk3B,MAAM2P,UACtBlL,QAAS37B,KAAKk3B,MAAMyE,QAE5B,CAKA,gBAAAsN,GACI,OAAOjpC,KAAKinC,aAChB,CAKA,WAAAiC,GACI,MAAO,IAAKlpC,KAAKinC,cAAcvsB,SACnC,CAKA,WAAAyuB,GACI,MAAO,IAAKnpC,KAAKinC,cAAc1sB,SACnC,CAKA,WAAA6uB,GACI,OAAOppC,KAAK6Y,QAChB,CAKA,OAAAwwB,GACI,OAAOrpC,KAAKonC,YAAYvF,YAAYxF,KAAO,CAC/C,CAKA,eAAAiN,GACI,OAAOtpC,KAAKonC,YAAYvF,WAC5B,CAKA,cAAA0H,GACI,OAAOvpC,KAAKonC,WAChB,CAKA,WAAAtI,CAAYpX,EAAgB2V,EAAuBtC,EAAYyO,KAAMzK,EAA+C,WAChH/+B,KAAKonC,YAAYtI,YAAYzB,EAAS3V,EAAQqX,GAG9C/+B,KAAKinC,cAAchpB,OAASje,KAAKonC,YAAYvF,YAAYxF,IAC7D,CAKA,kBAAAgF,CAAmBC,GACfthC,KAAKonC,YAAY/F,mBAAmBC,EACxC,CAKA,YAAAK,CAAanS,EAAoBnY,GAC7BrX,KAAKonC,YAAYzF,aAAanS,EAAQnY,EAC1C,CAKA,YAAAoyB,GACI,OAAOzpC,KAAK68B,SAChB,CAKA,YAAAuJ,GACI,OAAOpmC,KAAK68B,UAAUuJ,cAC1B,CAKA,YAAAsD,GACI,OAAO1pC,KAAK68B,UAAUsJ,UAC1B,CAKA,iBAAAwD,CAAkBrW,GACdtzB,KAAK68B,UAAUxJ,OAAOC,EAC1B,CAKA,OAAAhiB,GAEQtR,KAAK2mC,eACL3mC,KAAKyD,MAAM6f,UAAUtjB,KAAK2mC,eAI9B3mC,KAAKymC,QAAQ/sB,aAAa1Z,KAAKinC,cAAcvwB,IAE7C1W,KAAKgJ,OAAOpD,KAAK,mCACrB,EC7eG,IAAKgkC,GAAAA,IACRA,EAAA,EAAI,IACJA,EAAA,EAAI,IACJA,EAAA,EAAI,IACJA,EAAA,EAAI,IACJA,EAAA,EAAI,IACJA,EAAA,EAAI,IACJA,EAAA,EAAI,IACJA,EAAA,GAAK,KACLA,EAAA,GAAK,KACLA,EAAA,GAAK,KAVGA,IAAAA,GAAA,CAAA,GAaAC,GAAAA,IACRA,EAAA,YAAc,cACdA,EAAA,SAAW,YACXA,EAAA,SAAW,YACXA,EAAA,OAAS,SACTA,EAAA,MAAQ,QACRA,EAAA,SAAW,WACXA,EAAA,OAAS,SACTA,EAAA,MAAQ,QARAA,IAAAA,GAAA,CAAA,GAyDL,MAAMC,EAUT,WAAAhlC,CAAYG,EAAgC,IAJ5CjF,KAAQ+pC,UAAmCjhC,IAC3C9I,KAAQgqC,gBAA+ClhC,IACvD9I,KAAQiqC,UAAwB,GAG5BjqC,KAAKgJ,OAAS,IAAIO,EAAO,mBAGzBvJ,KAAKiF,OAAS,CACVilC,KAAM,GACN7+B,KAAM,IACN8+B,UAAW,GACXC,WAAY,EACZC,aAAc,GACdC,SAAU,IACVC,YAAa,MACVtlC,GAGPjF,KAAKuhB,OAAS,IAAIipB,EAAaxqC,KAAKiF,OAAOilC,MAE3ClqC,KAAKgJ,OAAOpD,KAAK,kCAAmC,CAChDskC,KAAMlqC,KAAKiF,OAAOilC,KAClB7+B,KAAMrL,KAAKiF,OAAOoG,KAClB8+B,UAAWnqC,KAAKiF,OAAOklC,WAE/B,CAKA,oBAAMM,CAAeC,GACjB1qC,KAAKgJ,OAAOpD,KAAK,2BAEjB,MAAMqD,EAAY/F,YAAYoD,MAE9B,IAEIokC,IAAmB,GAAI,8BACvB1qC,KAAK2qC,wBAGLD,IAAmB,GAAI,qCACvB1qC,KAAK4qC,yBAGLF,IAAmB,GAAI,yCACjB1qC,KAAK6qC,oBAAoBH,GAG/BA,IAAmB,GAAI,8BACvB1qC,KAAK8qC,oBAELJ,IAAmB,IAAK,+BAExB,MAAMK,EAAU7nC,YAAYoD,MAC5BtG,KAAKgJ,OAAOpD,KAAK,0BAA0BmlC,EAAU9hC,GAAWI,QAAQ,OAAQ,CAC5E0gC,MAAO/pC,KAAK+pC,MAAM1+B,KAClB2/B,QAAShrC,KAAKgqC,YAAY3+B,MAGlC,OAASvF,GAEL,MADA9F,KAAKgJ,OAAOlD,MAAM,6BAA8BA,GAC1CA,CACV,CACJ,CAKQ,qBAAA6kC,GACJ3qC,KAAKgJ,OAAOxD,MAAM,gCAElB,IAAA,IAAS+G,EAAI,EAAGA,EAAIvM,KAAKiF,OAAOklC,UAAW59B,IAAK,CAC5C,MAAMmO,EAAW1a,KAAKirC,uBAAuB1+B,GACvC2+B,EAAS,QAAQ3+B,EAAE4E,WAAWwoB,SAAS,EAAG,OAG1CwR,EAAiB,CACnBz0B,GAAIw0B,EACJjlC,KAAMjG,KAAKorC,iBAAiB7+B,GAC5BmO,WACAzW,KAAM,IACN4W,KAAM,EACNwwB,WAAY,EACZC,YAAa,KACbC,IAAK,KACLC,YAAa,IACbl/B,MAAO,CAAEhB,EAAG,IAAKC,EAAG,IAAKC,EAAG,KAC5B6tB,WAAY,EACZrrB,OAAQ,GAGZhO,KAAK+pC,MAAMhhC,IAAImiC,EAAQC,GACvBnrC,KAAKiqC,UAAUtjC,KAAKwkC,EACxB,CAEAnrC,KAAKgJ,OAAOxD,MAAM,aAAaxF,KAAK+pC,MAAM1+B,sBAC9C,CAKQ,sBAAA4/B,CAAuBn+B,GAE3B,MAAM2+B,EAAmB7+B,KAAK+D,IAAI3Q,KAAKuhB,OAAOmqB,OAAQ,IAChD19B,EAASy9B,EAAmBzrC,KAAKiF,OAAOoG,KAOxCsgC,EAH6B,EADlB/+B,KAAKC,MAAM7M,KAAKuhB,OAAOmqB,OAAS1rC,KAAKiF,OAAOmlC,YACtBx9B,KAAKuU,GAAMnhB,KAAKiF,OAAOmlC,WAGzBqB,EAAmBzrC,KAAKiF,OAAOolC,aAAe,EAAIz9B,KAAKuU,GAGtFyqB,EAA0C,IAA5B5rC,KAAKuhB,OAAOmqB,OAAS,IACnCG,EAA2C,IAA5B7rC,KAAKuhB,OAAOmqB,OAAS,IAAa19B,EAEjD89B,EAAaH,EAAcC,EAC3BG,EAAcn/B,KAAKoC,IAAI,EAAGhB,EAAS69B,GAEzC,MAAO,CACHn/B,EAAGE,KAAKiX,IAAIioB,GAAcC,EAC1Bp/B,EAAGC,KAAKqU,IAAI6qB,GAAcC,EAElC,CAKQ,gBAAAX,CAAiBt+B,GACrB,MAAMk/B,EAAW,CAAC,QAAS,OAAQ,QAAS,QAAS,UAAW,OAAQ,MAAO,QAAS,OAAQ,SAC1FC,EAAW,CAAC,WAAY,WAAY,QAAS,QAAS,UAAW,UAAW,QAAS,eAErFnlC,EAASklC,EAASl/B,EAAQk/B,EAASplC,QACnCslC,EAASD,EAASr/B,KAAKC,MAAMC,EAAQk/B,EAASplC,QAAUqlC,EAASrlC,QACjEulC,EAASv/B,KAAKC,MAAMC,GAASk/B,EAASplC,OAASqlC,EAASrlC,SAAW,EAEzE,OAAOulC,EAAS,EAAI,GAAGrlC,KAAUolC,KAAUC,IAAW,GAAGrlC,KAAUolC,GACvE,CAKQ,sBAAAtB,GACJ5qC,KAAKgJ,OAAOxD,MAAM,iCAElB,IAAA,MAAW2lC,KAAQnrC,KAAK+pC,MAAMpxB,SAAU,CAEpC,MAAMyzB,EAAmBx/B,KAAK8D,KAAKy6B,EAAKzwB,SAAShO,GAAK,EAAIy+B,EAAKzwB,SAAS/N,GAAK,GACvE0/B,EAAgBz/B,KAAKoC,IAAI,EAAG,EAAIo9B,EAAmBpsC,KAAKiF,OAAOqlC,UAGrEa,EAAKK,YAAc5+B,KAAKoC,IAAI,KAAO,KAAQ,GAAsB,GAAhBq9B,GAAuBrsC,KAAKuhB,OAAO+qB,MAAM,GAAK,MAG/FnB,EAAKtwB,KAAO7a,KAAKusC,sBAGjBpB,EAAKlnC,KAAOjE,KAAKwsC,oBAAoBrB,EAAKtwB,MAG1CswB,EAAKE,WAAarrC,KAAKysC,oBAAoBtB,EAAKtwB,KAAMswB,EAAKlnC,MAC3DknC,EAAKG,YAActrC,KAAK0sC,qBAAqBvB,EAAKtwB,KAAMswB,EAAKlnC,MAC7DknC,EAAKn9B,OAAShO,KAAK2sC,gBAAgBxB,EAAKtwB,KAAMswB,EAAKE,WAAYF,EAAKG,aACpEH,EAAKI,IAAMvrC,KAAK4sC,mBAAmBzB,EAAKtwB,KAAMswB,EAAKlnC,MAGnDknC,EAAK7+B,MAAQtM,KAAK6sC,aAAa1B,EAAKG,aACpCH,EAAK9R,WAAazsB,KAAKuD,IAAI,EAAKg7B,EAAKE,WAAa,IACtD,CAEArrC,KAAKgJ,OAAOxD,MAAM,4BACtB,CAKQ,mBAAA+mC,GAEJ,MAAM7/B,EAAI1M,KAAKuhB,OAAOmqB,OACtB,OAAIh/B,EAAI,GAEG,GAAO,GAAME,KAAK+D,IAAIjE,EAAI,GAAK,GAC/BA,EAAI,IAEJ,GAAO,IAAME,KAAK+D,KAAKjE,EAAI,IAAO,IAAM,KAGxC,EAAK,GAAKE,KAAK+D,KAAKjE,EAAI,KAAQ,IAAM,EAErD,CAKQ,mBAAA8/B,CAAoB3xB,GACxB,OAAIA,EAAO,GAAW,IAClBA,EAAO,GAAW,IAClBA,EAAO,IAAY,IACnBA,EAAO,IAAY,IACnBA,EAAO,GAAY,IACnBA,EAAO,GAAY,IAChB,GACX,CAKQ,mBAAA4xB,CAAoB5xB,EAAc5W,GAEtC,IAAI8hC,EAAQ,IAEZ,OAAQ9hC,GACJ,IAAK,IACL,IAAK,IAOL,IAAK,IACD8hC,EAAQ,EACR,MANJ,IAAK,IACL,IAAK,IACDA,EAAQ,IACR,MAIJ,IAAK,IACL,IAAK,IACDA,EAAQ,IAIhB,OAAOn5B,KAAK+D,IAAIkK,EAAMkrB,EAC1B,CAKQ,oBAAA2G,CAAqB7xB,EAAc5W,GAYvC,OAXkB,CACd6oC,EAAc,KACdC,EAAc,IACdC,EAAc,KACdC,EAAc,KACdC,EAAc,KACdC,EAAc,IACdC,EAAc,KAGkBnpC,IAAS,MAC3BjE,KAAKuhB,OAAO+qB,MAAM,GAAK,IAC7C,CAKQ,eAAAK,CAAgB9xB,EAAcwwB,EAAoBC,GAItD,OAAO1+B,KAAK8D,KAAK26B,GAAcz+B,KAAK+D,IADlB,KACkC26B,EAAa,EACrE,CAKQ,kBAAAsB,CAAmB/xB,EAAc5W,GAErC,MACMopC,EADgB,IACWzgC,KAAK+D,IAAIkK,GAAM,KAGhD,OAAO7a,KAAKuhB,OAAOmqB,OAAS2B,CAChC,CAKQ,YAAAR,CAAavB,GAEjB,OAAIA,EAAc,KAAc,CAAEhgC,EAAG,IAAKC,EAAG,IAAKC,EAAG,KACjD8/B,EAAc,IAAc,CAAEhgC,EAAG,IAAKC,EAAG,IAAKC,EAAG,KACjD8/B,EAAc,KAAa,CAAEhgC,EAAG,IAAKC,EAAG,IAAKC,EAAG,KAChD8/B,EAAc,IAAa,CAAEhgC,EAAG,IAAKC,EAAG,IAAKC,EAAG,KAChD8/B,EAAc,IAAa,CAAEhgC,EAAG,IAAKC,EAAG,IAAKC,EAAG,KACrB,CAAEF,EAAG,IAAKC,EAAG,IAAKC,EAAG,IAExD,CAKA,yBAAcq/B,CAAoBH,GAC9B1qC,KAAKgJ,OAAOxD,MAAM,8BAElB,IAAI8nC,EAAc,EAClB,MAAMvD,EAAQ1zB,MAAMC,KAAKtW,KAAK+pC,MAAMpxB,UAGpC,IAAA,IAASpM,EAAI,EAAGA,EAAIw9B,EAAMnjC,OAAQ2F,GAFhB,EAEgC,CAC9C,MAAMghC,EAAQxD,EAAMzhC,MAAMiE,EAAGA,EAHf,GAMd,IAAA,MAAW4+B,KAAQoC,EAEf,GAAIvtC,KAAKuhB,OAAOmqB,OAAS,GAAK,CAC1B,MAAMlc,QAAexvB,KAAKwtC,mBAAmBrC,GAC7CnrC,KAAKgqC,YAAYjhC,IAAIoiC,EAAKz0B,GAAI8Y,GAC9B8d,GACJ,CAIJ,MAAM9rB,EAAW,GAAK5U,KAAKC,MAAON,EAAIw9B,EAAMnjC,OAAU,IACtD8jC,IAAmBlpB,EAAU,aAAa8rB,2BAGpC,IAAIG,QAAQC,GAAWhiB,WAAWgiB,EAAS,GACrD,CAEA1tC,KAAKgJ,OAAOxD,MAAM,aAAa8nC,iBACnC,CAKA,wBAAcE,CAAmBrC,GAC7B,MAAM3b,EAAyB,CAC3B9Y,GAAIy0B,EAAKz0B,GACTzQ,KAAM,GAAGklC,EAAKllC,cACdyU,SAAUywB,EAAKzwB,SACfywB,OACAzQ,QAAS,GACTiT,cAAe,GACfC,mBAAoB,EACpBC,mBAAoB,EACpBC,UAAW3C,EAAKI,IAChBC,YAAaL,EAAKK,aAIhBH,EAAaF,EAAKE,WACxB7b,EAAOoe,mBAAqBhhC,KAAK8D,KAAK26B,EAAa,KACnD7b,EAAOqe,mBAAqBjhC,KAAK8D,KAAK26B,EAAa,KAGnD,MAAM0C,EAAcnhC,KAAKC,MAAM7M,KAAKuhB,OAAO+qB,MAAM,EAAG,IACpD,IAAI0B,EAAehuC,KAAKuhB,OAAO+qB,MAAM,GAAK,IAE1C,IAAA,IAAS//B,EAAI,EAAGA,EAAIwhC,EAAaxhC,IAAK,CAClC,MAAM4sB,EAASn5B,KAAKiuC,eAAe9C,EAAM3b,EAAQjjB,EAAGyhC,GACpDxe,EAAOkL,QAAQ/zB,KAAKwyB,GAGpB6U,GAAgBhuC,KAAKuhB,OAAO+qB,MAAM,IAAK,EAC3C,CAaA,OAVItsC,KAAKuhB,OAAOmqB,OAAS,IACrBlc,EAAOme,cAAchnC,KAAK,CACtB+P,GAAI,GAAGy0B,EAAKz0B,YACZw3B,YAAaF,EACbG,YAA4B,IAAfH,EACbI,QAASpuC,KAAKuhB,OAAO+qB,MAAM,GAAK,IAChC+B,YAAaruC,KAAKuhB,OAAO+sB,OAAO,CAAC,QAAS,WAAY,UAIvD9e,CACX,CAKQ,cAAAye,CAAe9C,EAAgB3b,EAAwB1iB,EAAeyhC,GAC1E,MAAMC,EAAW,GAAGrD,EAAKz0B,aAAa5J,IAGtC,IAAI2hC,EAEAA,EADAF,EAA4C,GAA5B/e,EAAOoe,mBACV,WACNW,EAA4C,EAA5B/e,EAAOqe,mBACjB7tC,KAAKuhB,OAAO+sB,OAAO,CAAC,YAAqB,YAAqB,WACpEC,GAAiB/e,EAAOoe,oBAAsBW,GAAiB/e,EAAOqe,mBAChE7tC,KAAKuhB,OAAO+sB,OAAO,CAAC,cAAwB,QAAkB,WAE9DtuC,KAAKuhB,OAAO+sB,OAAO,CAAC,cAAwB,SAAmB,WAIhF,MAAMzzB,EAAO7a,KAAK0uC,mBAAmBD,GAC/BzgC,EAAShO,KAAK2uC,sBAAsB9zB,EAAM4zB,GAC1CnD,EAActrC,KAAK4uC,2BAA2BzD,EAAMoD,GAEpDpV,EAAqB,CACvBziB,GAAI83B,EACJvoC,KAAM,GAAGklC,EAAKllC,QAAQjG,KAAK6uC,cAAc/hC,EAAQ,KACjDo+B,OAAQC,EAAKz0B,GACb63B,gBACAO,YAAa9uC,KAAK+uC,qBAAqBR,EAAepD,EAAKtwB,MAC3D7M,SACA6M,OACA5W,KAAMwqC,EACNnD,cACA0D,cAAehvC,KAAKivC,oBAAoBR,EAAY5zB,EAAMywB,GAC1D4D,SAAUlvC,KAAKuhB,OAAOmqB,OAAS,GAC/ByD,MAAO,GACPC,YAAapvC,KAAKqvC,qBAAqBZ,EAAYnD,GACnDgE,aAActvC,KAAKuvC,qBAAqBd,GACxCe,SAAUlE,EAAc,KAAOA,EAAc,KAAsB,cAAfmD,EACpDgB,SAAS,GAITtW,EAAO6V,gBACP7V,EAAOuW,eAAiB1vC,KAAK2vC,wBAAwBlB,EAAYnD,IAIrE,MAAMsE,EAAY5vC,KAAK6vC,kBAAkBpB,EAAY5zB,GACrD,IAAA,IAASK,EAAI,EAAGA,EAAI00B,EAAW10B,IAC3Bie,EAAOgW,MAAMxoC,KAAK3G,KAAK8vC,aAAa3W,EAAQje,IAGhD,OAAOie,CACX,CAKQ,kBAAAuV,CAAmBzqC,GACvB,OAAQA,GACJ,IAAK,YACD,OAAOjE,KAAKuhB,OAAO+qB,MAAM,GAAI,KACjC,IAAK,YACD,OAAOtsC,KAAKuhB,OAAO+qB,MAAM,GAAI,IACjC,IAAK,cACL,IAAK,QACL,IAAK,SACL,IAAK,WACL,IAAK,SACL,IAAK,QACD,OAAOtsC,KAAKuhB,OAAO+qB,MAAM,GAAK,GAClC,QACI,OAAO,EAEnB,CAKQ,qBAAAqC,CAAsB9zB,EAAc5W,GACxC,OACW2I,KAAK+D,IAAIkK,EAAM,IAI9B,CAKQ,0BAAA+zB,CAA2BzD,EAAgB16B,GAE/C,MAAMs/B,EAAgB5E,EAAKE,YAAc56B,EAAWA,GAIpD,OAHiB,MAAQ7D,KAAK+D,IAAIo/B,EAAe,KAG/B/vC,KAAKuhB,OAAO+qB,MAAM,GAAK,IAC7C,CAKQ,oBAAAyC,CAAqBt+B,EAAkBu/B,GAE3C,OAAqD,OAA9CpjC,KAAK8D,KAAK9D,KAAK+D,IAAIF,EAAU,GAAKu/B,EAC7C,CAKQ,mBAAAf,CAAoBhrC,EAAkB4W,EAAcywB,GACxD,MAAa,cAATrnC,GAAyC,cAATA,KAChC4W,EAAO,QACPywB,EAAc,MACXtrC,KAAKuhB,OAAOmqB,OAAS,GAChC,CAEQ,oBAAA2D,CAAqBprC,EAAkBqnC,GAC3C,OAAQrnC,GACJ,IAAK,QAAkB,MAAO,QAC9B,IAAK,SAAmB,MAAO,SAC/B,IAAK,WAAqB,MAAO,OACjC,IAAK,SAAmB,MAAO,MAC/B,IAAK,YACL,IAAK,YAAqB,MAAO,MACjC,IAAK,QAAkB,MAAO,QAC9B,QAAS,MAAO,QAExB,CAEQ,oBAAAsrC,CAAqBtrC,GACzB,OAAQA,GACJ,IAAK,QAAkB,MAAO,CAAEqH,EAAG,EAAGC,EAAG,IAAKC,EAAG,KACjD,IAAK,SAAmB,MAAO,CAAEF,EAAG,IAAKC,EAAG,IAAKC,EAAG,KACpD,IAAK,WAAqB,MAAO,CAAEF,EAAG,IAAKC,EAAG,GAAIC,EAAG,GACrD,IAAK,SAAmB,MAAO,CAAEF,EAAG,IAAKC,EAAG,IAAKC,EAAG,KACpD,IAAK,YAAqB,MAAO,CAAEF,EAAG,IAAKC,EAAG,IAAKC,EAAG,KACtD,IAAK,YAAqB,MAAO,CAAEF,EAAG,IAAKC,EAAG,IAAKC,EAAG,KACtD,IAAK,QAAkB,MAAO,CAAEF,EAAG,IAAKC,EAAG,IAAKC,EAAG,IACnD,QAAS,MAAO,CAAEF,EAAG,IAAKC,EAAG,IAAKC,EAAG,IAE7C,CAEQ,uBAAAmkC,CAAwB1rC,EAAkBqnC,GAC9C,OAAIA,EAAc,IAAa,QAClB,cAATrnC,EAAqC,WAC5B,cAATA,EAAqC,UACrCqnC,EAAc,IAAY,OACvB,gBACX,CAEQ,iBAAAuE,CAAkBpB,EAAwB5zB,GAC9C,MAAmB,cAAf4zB,EAA2C7hC,KAAKC,MAAM7M,KAAKuhB,OAAO+qB,MAAM,EAAG,KAC5D,cAAfmC,EAA2C7hC,KAAKC,MAAM7M,KAAKuhB,OAAO+qB,MAAM,EAAG,KAC3EzxB,EAAO,EAAYjO,KAAKC,MAAM7M,KAAKuhB,OAAO+qB,MAAM,EAAG,IAChDtsC,KAAKuhB,OAAOmqB,OAAS,GAAM,EAAI,CAC1C,CAEQ,YAAAoE,CAAa3W,EAAoBrsB,GACrC,MAAO,CACH4J,GAAI,GAAGyiB,EAAOziB,WAAW5J,IACzB7G,KAAM,GAAGkzB,EAAOlzB,QAAQgqC,OAAOC,aAAa,GAAKpjC,KACjD0hC,SAAUrV,EAAOziB,GACjB63B,cAAevuC,KAAKuhB,OAAO+qB,MAAM,EAAG,IACpCwC,YAAa9uC,KAAKuhB,OAAO+qB,MAAM,GAAI,KACnCt+B,OAAQhO,KAAKuhB,OAAO+qB,MAAM,GAAK,IAC/BzxB,KAAM7a,KAAKuhB,OAAO+qB,MAAM,IAAM,IAC9BroC,KAAMjE,KAAKuhB,OAAO+sB,OAAO,CAAC,QAAS,MAAO,sBAC1C6B,cAAenwC,KAAKuhB,OAAOmqB,OAAS,GAE5C,CAEQ,iBAAAZ,GAGR,CAEQ,aAAA+D,CAAcuB,GAClB,MAAMz3B,EAAS,CAAC,GAAI,EAAG,EAAG,EAAG,GACvB03B,EAAU,CAAC,IAAK,KAAM,IAAK,KAAM,KACvC,IAAI/mC,EAAS,GAEb,IAAA,IAASiD,EAAI,EAAGA,EAAIoM,EAAO/R,OAAQ2F,IAC/B,KAAO6jC,GAAOz3B,EAAOpM,IACjBjD,GAAU+mC,EAAQ9jC,GAClB6jC,GAAOz3B,EAAOpM,GAGtB,OAAOjD,CACX,CAKA,gBAAAgnC,CAAiBvzB,EAAiB/O,GAC9B,OAAOhO,KAAKiqC,UAAUjiC,OAAOmjC,GACRv+B,KAAK8D,KAClB9D,KAAK+D,IAAIw6B,EAAKzwB,SAAShO,EAAIqQ,EAAOrQ,EAAG,GACrCE,KAAK+D,IAAIw6B,EAAKzwB,SAAS/N,EAAIoQ,EAAOpQ,EAAG,KAEtBqB,EAE3B,CAEA,aAAAuiC,CAAcrF,GACV,OAAOlrC,KAAKgqC,YAAY9gC,IAAIgiC,EAChC,CAEA,WAAAsF,GACI,MAAO,IAAIxwC,KAAKiqC,UACpB,CAEA,aAAAwG,GACI,OAAOp6B,MAAMC,KAAKtW,KAAKgqC,YAAYrxB,SACvC,CAEA,eAAA+3B,GACI,MAAO,IAAK1wC,KAAKiF,OACrB,EAMJ,MAAMulC,EAGF,WAAA1lC,CAAYolC,GACRlqC,KAAKkqC,KAAOA,CAChB,CAEA,IAAAwB,GAEI,OADA1rC,KAAKkqC,MAAoB,KAAZlqC,KAAKkqC,KAAc,OAAS,OAClClqC,KAAKkqC,KAAO,MACvB,CAEA,KAAAoC,CAAMn8B,EAAanB,GACf,OAAOmB,EAAMnQ,KAAK0rC,QAAU18B,EAAMmB,EACtC,CAEA,MAAAm+B,CAAUqC,GACN,OAAOA,EAAM/jC,KAAKC,MAAM7M,KAAK0rC,OAASiF,EAAM/pC,QAChD,CAEA,OAAAgqC,CAAQzgC,EAAanB,GACjB,OAAOpC,KAAKC,MAAM7M,KAAKssC,MAAMn8B,EAAKnB,EAAM,GAC5C,EC5qBG,MAAM6hC,EAST,WAAA/rC,GAJA9E,KAAQ8wC,eAAwC,KAChD9wC,KAAQ+wC,iBAAkDjoC,IAItD9I,KAAKS,SAAWkE,EAAiB5E,SACjCC,KAAKgJ,OAAS,IAAIO,EAAO,qBACzBvJ,KAAKqE,oBAAqB,EAE1BrE,KAAKgJ,OAAOpD,KAAK,2CAA4C,CACzDnF,SAAUT,KAAKS,SACf4D,mBAAoBrE,KAAKqE,oBAEjC,CAKA,gBAAM2sC,CACFC,EACAC,EACAC,GAMAnxC,KAAKgJ,OAAOpD,KAAK,4BAEjB,MAAMqD,EAAY/F,YAAYoD,MAE9B,IAEI,MAAMszB,EAA2B,CAC7BC,QAAS,QACTzzB,UAAWC,KAAKC,MAChBrB,OAAQgsC,EAAUP,kBAClBQ,WAAY,IAAKA,GACjBnH,MAAO,GACPiB,QAAS,GACToG,gBAAiB,IAAID,EAAgBC,iBACrCC,kBAAmB,IAAIF,EAAgBE,mBACvCC,iBAAkB,IAAIH,EAAgBG,kBACtCC,eAAgBzoC,IAChB0oC,YAAa,IAIjB5X,EAASmQ,MAAQ/pC,KAAKyxC,iBAAiBR,EAAUT,eACjD5W,EAASoR,QAAUhrC,KAAK0xC,mBAAmBT,EAAUR,iBAGrDzwC,KAAK8wC,eAAiBlX,QAGhB55B,KAAK2xC,cAAc/X,GAEzB,MAAMmR,EAAU7nC,YAAYoD,MAC5BtG,KAAKgJ,OAAOpD,KAAK,mCAAmCmlC,EAAU9hC,GAAWI,QAAQ,OAAQ,CACrF0gC,MAAOnQ,EAASmQ,MAAMnjC,OACtBokC,QAASpR,EAASoR,QAAQpkC,OAC1ByE,KAAMrL,KAAK4xC,kBAAkBhY,IAGrC,OAAS9zB,GAEL,MADA9F,KAAKgJ,OAAOlD,MAAM,0BAA2BA,GACvCA,CACV,CACJ,CAKA,gBAAM+rC,GASF7xC,KAAKgJ,OAAOpD,KAAK,6BAEjB,MAAMqD,EAAY/F,YAAYoD,MAE9B,IAEI,MAAMszB,QAAiB55B,KAAKqI,kBAC5B,IAAKuxB,EAED,OADA55B,KAAKgJ,OAAOnD,KAAK,6BACV,KAIX7F,KAAK8xC,iBAAiBlY,GAGtB,MAAMqX,EAAY,IAAInH,EAAgBlQ,EAAS30B,cAGzCjF,KAAK+xC,kBAAkBd,EAAWrX,GAExC,MAAMmR,EAAU7nC,YAAYoD,MAG5B,OAFAtG,KAAKgJ,OAAOpD,KAAK,oCAAoCmlC,EAAU9hC,GAAWI,QAAQ,QAE3E,CACH4nC,YACAC,WAAYtX,EAASsX,WACrBC,gBAAiB,CACbC,gBAAiBxX,EAASwX,gBAC1BC,kBAAmBzX,EAASyX,kBAC5BC,iBAAkB1X,EAAS0X,kBAIvC,OAASxrC,GAEL,OADA9F,KAAKgJ,OAAOlD,MAAM,0BAA2BA,GACtC,IACX,CACJ,CAKA,qBAAMksC,CACFf,EACAgB,GAEA,MAAMC,EAAWlyC,KAAKmyC,YAAYF,EAAQl1B,OAAQk1B,EAAQjkC,QAG1D,GAAIhO,KAAK+wC,aAAax7B,IAAI28B,GACtB,OAAOlyC,KAAK+wC,aAAa7nC,IAAIgpC,GAGjClyC,KAAKgJ,OAAOxD,MAAM,yBAAyB0sC,KAE3C,IAEI,MAGME,EAHgBnB,EAAUX,iBAAiB2B,EAAQl1B,OAAQk1B,EAAQjkC,QAGtC1F,MAAM,EAAG2pC,EAAQI,YAG9CrH,EAA4B,GAClC,IAAA,MAAWG,KAAQiH,EAAc,CAC7B,MAAM5iB,EAASyhB,EAAUV,cAAcpF,EAAKz0B,IACxC8Y,IAEIyiB,EAAQK,mBAAqBtyC,KAAKuyC,iBAAiB/iB,EAAO9Y,MAC1Ds0B,EAAQrkC,KAAK6oB,EAGzB,CAMA,OAHAxvB,KAAK+wC,aAAahoC,IAAImpC,EAAUlH,GAEhChrC,KAAKgJ,OAAOxD,MAAM,qBAAqBwlC,EAAQpkC,kBACxCokC,CAEX,OAASllC,GAEL,OADA9F,KAAKgJ,OAAOlD,MAAM,gCAAgCosC,IAAYpsC,GACvD,EACX,CACJ,CAKQ,gBAAA2rC,CAAiB1H,GACrB,OAAOA,EAAM96B,IAAIk8B,IAAA,CACbz0B,GAAIy0B,EAAKz0B,GACTzQ,KAAMklC,EAAKllC,KACXusC,IAAK,CAAC5lC,KAAKsE,MAAMi6B,EAAKzwB,SAAShO,GAAIE,KAAKsE,MAAMi6B,EAAKzwB,SAAS/N,IAC5D1I,KAAMknC,EAAKlnC,KACX4W,KAAMjO,KAAKsE,MAAkB,IAAZi6B,EAAKtwB,MAAc,IACpC43B,KAAM7lC,KAAKsE,MAAMi6B,EAAKG,aACtBh/B,MAAO,CAAC6+B,EAAK7+B,MAAMhB,EAAG6/B,EAAK7+B,MAAMf,EAAG4/B,EAAK7+B,MAAMd,KAEvD,CAKQ,kBAAAkmC,CAAmB1G,GACvB,OAAOA,EAAQ/7B,IAAIugB,IAAA,CACf9Y,GAAI8Y,EAAO9Y,GACXgkB,QAAS16B,KAAK0yC,mBAAmBljB,EAAOkL,SACxCiY,SAAU3yC,KAAKuyC,iBAAiB/iB,EAAO9Y,MAE/C,CAKQ,kBAAAg8B,CAAmBhY,GACvB,OAAOA,EAAQzrB,IAAIkqB,IAAA,CACfziB,GAAIyiB,EAAOziB,GACXzQ,KAAMkzB,EAAOlzB,KACbhC,KAAMk1B,EAAOl1B,KACb2uC,MAAOhmC,KAAKsE,MAA6B,IAAvBioB,EAAOoV,eAAuB,IAChDvgC,OAAQpB,KAAKsE,MAAsB,IAAhBioB,EAAOnrB,QAAgB,IAC1CykC,KAAM7lC,KAAKsE,MAAMioB,EAAOmS,aACxBuH,QAAS1Z,EAAO6V,cAChBG,MAAOhW,EAAOgW,MAAMvoC,OACpB0F,MAAO,CAAC6sB,EAAOmW,aAAahkC,EAAG6tB,EAAOmW,aAAa/jC,EAAG4tB,EAAOmW,aAAa9jC,KAElF,CAKA,uBAAcumC,CAAkBd,EAA4BrX,GAKxD55B,KAAKgJ,OAAOxD,MAAM,yDAIZyrC,EAAUxG,iBAEhBzqC,KAAKgJ,OAAOxD,MAAM,oCACtB,CAKA,mBAAcmsC,CAAc/X,GACxB,MAAME,EAAaryB,KAAKI,UAAU+xB,GAElC,OAAQ55B,KAAKS,UACT,KAAKZ,EAASyK,QACd,KAAKzK,EAAS0S,IACd,KAAK1S,EAASwK,aAEJrK,KAAK8yC,iBAAiBhZ,GAC5B,MAEJ,KAAKj6B,EAASwS,YAEJrS,KAAK+yC,iBAAiBjZ,GAC5B,MAEJ,KAAKj6B,EAASyS,cAEJtS,KAAKgzC,kBAAkBlZ,GAC7B,MAEJ,QACI,MAAM,IAAI9zB,MAAM,oCAAoChG,KAAKS,YAErE,CAKA,qBAAc4H,GACV,OAAQrI,KAAKS,UACT,KAAKZ,EAASyK,QACd,KAAKzK,EAAS0S,IACd,KAAK1S,EAASwK,OACV,aAAarK,KAAKizC,qBAEtB,KAAKpzC,EAASwS,MACV,aAAarS,KAAKkzC,qBAEtB,KAAKrzC,EAASyS,QACV,aAAatS,KAAKmzC,sBAEtB,QACI,MAAM,IAAIntC,MAAM,qCAAqChG,KAAKS,YAEtE,CAKA,sBAAcqyC,CAAiBptC,GAC3B,IAEQ,cAAexF,aACTF,KAAKozC,gBAAgB1tC,GAG3B4B,aAAaM,QAAQ,uBAAwBlC,EAErD,OAASI,GAEL,IACIwB,aAAaM,QAAQ,uBAAwBlC,EACjD,OAAS2tC,GACL,MAAM,IAAIrtC,MAAM,oDACpB,CACJ,CACJ,CAKA,wBAAcitC,GACV,IAEI,GAAI,cAAe/yC,OAAQ,CACvB,MAAMwF,QAAa1F,KAAKszC,oBACxB,GAAI5tC,EAAM,OAAOA,CACrB,CAGA,MAAM2B,EAASC,aAAaC,QAAQ,wBACpC,OAAOF,EAASI,KAAKC,MAAML,GAAU,IAEzC,OAASvB,GAEL,OADA9F,KAAKgJ,OAAOlD,MAAM,kCAAmCA,GAC9C,IACX,CACJ,CAKA,qBAAcstC,CAAgB1tC,GAC1B,OAAO,IAAI+nC,QAAQ,CAACC,EAAS6F,KACzB,MAAMC,EAAUC,UAAUC,KAAK,kBAAmB,GAElDF,EAAQG,QAAU,IAAMJ,EAAOC,EAAQ1tC,OAEvC0tC,EAAQI,gBAAkB,KACtB,MAAMC,EAAKL,EAAQlqC,OACduqC,EAAGC,iBAAiBC,SAAS,WAC9BF,EAAGG,kBAAkB,WAI7BR,EAAQS,UAAY,KAChB,MAIMC,EAJKV,EAAQlqC,OACI6qC,YAAY,CAAC,UAAW,aACrBC,YAAY,UAEbC,IAAI3uC,EAAM,cACnCwuC,EAAWD,UAAY,IAAMvG,IAC7BwG,EAAWP,QAAU,IAAMJ,EAAOW,EAAWpuC,SAGzD,CAKA,uBAAcwtC,GACV,OAAO,IAAI7F,QAAQ,CAACC,EAAS6F,KACzB,MAAMC,EAAUC,UAAUC,KAAK,kBAAmB,GAElDF,EAAQG,QAAU,IAAMjG,EAAQ,MAEhC8F,EAAQS,UAAY,KAChB,MAAMJ,EAAKL,EAAQlqC,OAEnB,IAAKuqC,EAAGC,iBAAiBC,SAAS,UAE9B,YADArG,EAAQ,MAIZ,MAGM4G,EAHcT,EAAGM,YAAY,CAAC,UAAW,YACrBC,YAAY,UAEblrC,IAAI,cAC7BorC,EAAWL,UAAY,KACnB,MAAMvuC,EAAO4uC,EAAWhrC,OACxBokC,EAAQhoC,EAAO+B,KAAKC,MAAMhC,GAAQ,OAEtC4uC,EAAWX,QAAU,IAAMjG,EAAQ,QAG/C,CAKA,sBAAcqF,CAAiBrtC,GAI3B,MADA1F,KAAKgJ,OAAOnD,KAAK,wCACX,IAAIG,MAAM,mCACpB,CAKA,wBAAcktC,GAGV,OADAlzC,KAAKgJ,OAAOnD,KAAK,wCACV,IACX,CAKA,uBAAcmtC,CAAkBttC,GAG5B,MADA1F,KAAKgJ,OAAOnD,KAAK,yCACX,IAAIG,MAAM,oCACpB,CAKA,yBAAcmtC,GAGV,OADAnzC,KAAKgJ,OAAOnD,KAAK,yCACV,IACX,CAKQ,gBAAAisC,CAAiBlY,GACrB,IAAKA,EAASC,QACV,MAAM,IAAI7zB,MAAM,sCAGpB,IAAK4zB,EAAS30B,SAAW20B,EAASmQ,QAAUnQ,EAASoR,QACjD,MAAM,IAAIhlC,MAAM,wCAIpB,MAAO06B,GAAS9G,EAASC,QAAQ0a,MAAM,KAAKtlC,IAAIqB,QAChD,GAAc,IAAVowB,EACA,MAAM,IAAI16B,MAAM,8BAA8B4zB,EAASC,UAE/D,CAKQ,iBAAA+X,CAAkBhY,GACtB,MAAME,EAAaryB,KAAKI,UAAU+xB,GAC5B4a,EAAQ,IAAIC,KAAK,CAAC3a,IAAazuB,KAErC,OAAImpC,EAAQ,KAAa,GAAGA,MACxBA,EAAQ,QAAoB,IAAIA,EAAQ,MAAMnrC,QAAQ,QACnD,IAAImrC,EAAA,SAAuBnrC,QAAQ,OAC9C,CAKQ,WAAA8oC,CAAYp1B,EAAiB/O,GAIjC,MAAO,SAHiC,IAA9BpB,KAAKsE,MAAM6L,EAAOrQ,EAAI,QACQ,IAA9BE,KAAKsE,MAAM6L,EAAOpQ,EAAI,QACK,IAA3BC,KAAKsE,MAAMlD,EAAS,MAElC,CAKQ,gBAAAukC,CAAiBmC,GACrB,QAAK10C,KAAK8wC,gBACH9wC,KAAK8wC,eAAeM,gBAAgBv5B,SAAS68B,EACxD,CAKA,UAAAC,GACI30C,KAAK8wC,eAAiB,KACtB9wC,KAAK+wC,aAAa7oC,QAClBlI,KAAKgJ,OAAOxD,MAAM,mCACtB,CAKA,eAAAovC,GAKI,MAAO,CACHC,UAAW70C,KAAK8wC,eAAiB,EAAI,EACrCC,aAAc/wC,KAAK+wC,aAAa1lC,KAChCypC,aAAc90C,KAAK8wC,gBAAgB1qC,UAE3C,CAKA,kBAAM2uC,GACF,IAAK/0C,KAAK8wC,eACN,MAAM,IAAI9qC,MAAM,4BAGpB,OAAOyB,KAAKI,UAAU7H,KAAK8wC,eAAgB,KAAM,EACrD,CAKA,kBAAMkE,CAAatvC,GACf,IACI,MAAMk0B,EAA2BnyB,KAAKC,MAAMhC,GAC5C1F,KAAK8xC,iBAAiBlY,SAEhB55B,KAAK2xC,cAAc/X,GACzB55B,KAAK8wC,eAAiBlX,EAEtB55B,KAAKgJ,OAAOpD,KAAK,oCAErB,OAASE,GAEL,MADA9F,KAAKgJ,OAAOlD,MAAM,+BAAgCA,GAC5CA,CACV,CACJ,EC3jBG,MAAMmvC,EAoBT,WAAAnwC,CAAYG,EAAuC,IAZnDjF,KAAQ8e,eAAgB,EAGxB9e,KAAQk1C,kBAAiDpsC,IACzD9I,KAAQm1C,YAA0B,GAClCn1C,KAAQ62B,cAAuC,KAG/C72B,KAAQo1C,cAA+B,KAKnCp1C,KAAKgJ,OAAS,IAAIO,EAAO,iBAGzBvJ,KAAKiF,OAAS,CACVf,gBAAgB,EAChBsuB,iBAAkB,IAClB6iB,gBAAiB,IACjBC,iBAAkB,IAClBC,aAAc,CACVrL,KAAMt9B,KAAKC,MAAsB,IAAhBD,KAAK2U,UACtB4oB,UAAW,GACX9+B,KAAM,QAEPpG,GAIPjF,KAAKixC,UAAY,IAAInH,EAAgB9pC,KAAKiF,OAAOswC,cACjDv1C,KAAKw1C,YAAc,IAAI3E,EAGvB7wC,KAAKmxC,gBAAkB,CACnBC,oBAAqBx5B,IACrBy5B,sBAAuBz5B,IACvB05B,iBAAkB,GAClBmE,gBAAiB,GACjBC,aAAc,IAIlB11C,KAAKkxC,WAAa,CACduE,gBAAiB,GACjBC,aAAc,GACdC,oBAAqB,EACrBC,qBAAsB,EACtBC,sBAAuB,EACvBC,wBAAyB,GAG7B91C,KAAKgJ,OAAOpD,KAAK,gCAAiC,CAC9CX,OAAQjF,KAAKiF,QAErB,CAKA,gBAAM0F,GACF3K,KAAKgJ,OAAOpD,KAAK,6BAEjB,IAEI,MAAMmwC,EAAiB,IAAItI,QAAQ,CAACuI,EAAGzC,KACnC7nB,WAAW,IAAM6nB,EAAO,IAAIvtC,MAAM,8BAA+B,OAG/DiwC,EAAcj2C,KAAKk2C,qBAGnBzI,QAAQ0I,KAAK,CAACF,EAAaF,GAErC,OAASjwC,GACL9F,KAAKgJ,OAAOlD,MAAM,iDAAkDA,GAGpE9F,KAAKk1C,cAAchtC,cAGblI,KAAKo2C,0BACf,CACJ,CAEA,kBAAcF,GAEV,MAAMG,QAAkBr2C,KAAKw1C,YAAY3D,aAErCwE,GAEAr2C,KAAKgJ,OAAOpD,KAAK,iCACjB5F,KAAKixC,UAAYoF,EAAUpF,UAC3BjxC,KAAKkxC,WAAamF,EAAUnF,WAG5BlxC,KAAKmxC,gBAAkB,CACnBC,gBAAiB,IAAIx5B,IAAIy+B,EAAUlF,gBAAgBC,iBACnDC,kBAAmB,IAAIz5B,IAAIy+B,EAAUlF,gBAAgBE,mBACrDC,iBAAkB+E,EAAUlF,gBAAgBG,iBAC5CmE,gBAAiBY,EAAUnF,WAAWuE,gBACtCC,aAAcW,EAAUnF,WAAWwE,gBAKvC11C,KAAKgJ,OAAOpD,KAAK,qCACX5F,KAAKixC,UAAUxG,uBAGfzqC,KAAKs2C,sBAITt2C,KAAKu2C,kBAGPv2C,KAAKiF,OAAOf,gBACZlE,KAAKw2C,gBAGTx2C,KAAK8e,eAAgB,EACrB9e,KAAKgJ,OAAOpD,KAAK,oCACrB,CAEA,8BAAcwwC,GACVp2C,KAAKgJ,OAAOpD,KAAK,iCAGjB5F,KAAKixC,UAAY,IAAInH,EAAgB,IAC9B9pC,KAAKiF,OAAOswC,aACfpL,UAAW,UAGTnqC,KAAKixC,UAAUxG,uBACfzqC,KAAKs2C,eAEXt2C,KAAK8e,eAAgB,EACrB9e,KAAKgJ,OAAOpD,KAAK,0BACrB,CAKA,kBAAc0wC,GAEV,MAAMG,EAAcz2C,KAAKixC,UAAUX,iBAAiB,CAAE5jC,EAAG,EAAGC,EAAG,GAAK,KAGpE,IAAI+pC,EAAwC,KAC5C,IAAA,MAAWvL,KAAQsL,EACf,GAAItL,EAAKlnC,OAAS2lC,EAASsD,EAAG,CAC1B,MAAM1d,EAASxvB,KAAKixC,UAAUV,cAAcpF,EAAKz0B,IACjD,GAAI8Y,GAAUA,EAAOkL,QAAQ9zB,OAAS,EAAG,CACrC8vC,EAAiBlnB,EACjB,KACJ,CACJ,CAIJ,IAAKknB,EACD,IAAA,MAAWvL,KAAQsL,EAAa,CAC5B,MAAMjnB,EAASxvB,KAAKixC,UAAUV,cAAcpF,EAAKz0B,IACjD,GAAI8Y,GAAUA,EAAOkL,QAAQ9zB,OAAS,EAAG,CACrC8vC,EAAiBlnB,EACjB,KACJ,CACJ,CAGJ,IAAKknB,EACD,MAAM,IAAI1wC,MAAM,2CAIpBhG,KAAKmxC,gBAAgBsE,gBAAkBiB,EAAehgC,GACtD1W,KAAKmxC,gBAAgBuE,aAAegB,EAAehgC,GACnD1W,KAAKkxC,WAAWuE,gBAAkBiB,EAAehgC,GACjD1W,KAAKkxC,WAAWwE,aAAegB,EAAehgC,GAG9C1W,KAAK22C,cAAcD,EAAehgC,IAElC1W,KAAKgJ,OAAOpD,KAAK,2BAA2B8wC,EAAezwC,OAC/D,CAKA,qBAAcswC,GACV,IAAKv2C,KAAKmxC,gBAAgBsE,gBAAiB,OAI3C,GADAz1C,KAAK62B,cAAgB72B,KAAKixC,UAAUV,cAAcvwC,KAAKmxC,gBAAgBsE,kBAAoB,MACtFz1C,KAAK62B,cAEN,YADA72B,KAAKgJ,OAAOlD,MAAM,4BAKtB,MAAM8wC,EAAiC,CACnC75B,OAAQ/c,KAAK62B,cAAcnc,SAC3B1M,OAAQhO,KAAKiF,OAAOowC,gBACpBhD,WAAYryC,KAAKiF,OAAOqwC,iBACxBhD,mBAAmB,GAGjBuE,QAAsB72C,KAAKw1C,YAAYxD,gBAAgBhyC,KAAKixC,UAAW2F,GAG7E52C,KAAKk1C,cAAchtC,QACnB,IAAA,MAAWsnB,KAAUqnB,EACjB72C,KAAKk1C,cAAcnsC,IAAIymB,EAAO9Y,GAAI8Y,GAItCxvB,KAAKm1C,YAAcn1C,KAAKixC,UAAUX,iBAC9BtwC,KAAK62B,cAAcnc,SACnB1a,KAAKiF,OAAOowC,gBAAkB,GAGlCr1C,KAAKgJ,OAAOxD,MAAM,UAAUqxC,EAAcjwC,sBAAsB5G,KAAKm1C,YAAYvuC,eACrF,CAKA,oBAAMkwC,CAAepC,GACjB,MAAMqC,EAAe/2C,KAAKixC,UAAUV,cAAcmE,GAClD,IAAKqC,EAED,OADA/2C,KAAKgJ,OAAOlD,MAAM,qBAAqB4uC,MAChC,EAIX,MAAMsC,EAAah3C,KAAK62B,eAAenc,UAAY,CAAEhO,EAAG,EAAGC,EAAG,GACxD8D,EAAW7D,KAAK8D,KAClB9D,KAAK+D,IAAIomC,EAAar8B,SAAShO,EAAIsqC,EAAWtqC,EAAG,GACjDE,KAAK+D,IAAIomC,EAAar8B,SAAS/N,EAAIqqC,EAAWrqC,EAAG,IA2BrD,OAvBA3M,KAAKmxC,gBAAgBsE,gBAAkBf,EACvC10C,KAAKkxC,WAAWuE,gBAAkBf,EAClC10C,KAAKkxC,WAAW2E,uBAAyBplC,EAGpCzQ,KAAKmxC,gBAAgBC,gBAAgB77B,IAAIm/B,IAC1C10C,KAAKkxC,WAAWyE,sBAIpB31C,KAAK22C,cAAcjC,GAGnB10C,KAAKmxC,gBAAgBG,iBAAiB3qC,KAAK,CACvC+tC,WACAtuC,UAAWC,KAAKC,MAChB2wC,YAAaF,EAAar8B,iBAIxB1a,KAAKu2C,kBAEXv2C,KAAKgJ,OAAOpD,KAAK,kBAAkBmxC,EAAa9wC,SAASwK,EAASpH,QAAQ,WACnE,CACX,CAKA,aAAAstC,CAAcjC,GACV,IAAK10C,KAAKmxC,gBAAgBC,gBAAgB77B,IAAIm/B,GAAW,CACrD10C,KAAKmxC,gBAAgBC,gBAAgB57B,IAAIk/B,GAGzC,MAAMllB,EAASxvB,KAAKixC,UAAUV,cAAcmE,GAC5C,GAAIllB,EACA,IAAA,MAAW2J,KAAU3J,EAAOkL,QACxB16B,KAAKk3C,eAAe/d,EAAOziB,IAInC1W,KAAKm3C,4BACLn3C,KAAKgJ,OAAOxD,MAAM,oBAAoBkvC,IAC1C,CACJ,CAKA,cAAAwC,CAAe1I,GACNxuC,KAAKmxC,gBAAgBE,kBAAkB97B,IAAIi5B,KAC5CxuC,KAAKmxC,gBAAgBE,kBAAkB77B,IAAIg5B,GAC3CxuC,KAAKkxC,WAAW0E,uBAEhB51C,KAAKgJ,OAAOxD,MAAM,sBAAsBgpC,KAEhD,CAKQ,yBAAA2I,GACJ,MAAMC,EAAep3C,KAAKixC,UAAUR,gBAAgB7pC,OAC9CwqC,EAAkBpxC,KAAKmxC,gBAAgBC,gBAAgB/lC,KAE7DrL,KAAKkxC,WAAW4E,wBAA0BsB,EAAe,EAAIhG,EAAkBgG,EAAe,CAClG,CAKA,cAAAC,GACI,MAAO,IAAIr3C,KAAKm1C,YACpB,CAKA,gBAAAmC,GACI,OAAOjhC,MAAMC,KAAKtW,KAAKk1C,cAAcv8B,SACzC,CAKA,gBAAA4+B,GACI,OAAOv3C,KAAK62B,aAChB,CAKA,SAAA2gB,CAAU9C,GACN,OAAO10C,KAAKk1C,cAAchsC,IAAIwrC,IAAa10C,KAAKixC,UAAUV,cAAcmE,EAC5E,CAKA,mBAAA+C,CAAoB16B,EAAiB/O,GACjC,MAAMmnC,EAAcn1C,KAAKixC,UAAUX,iBAAiBvzB,EAAQ/O,GACtDg9B,EAA4B,GAElC,IAAA,MAAWG,KAAQgK,EAAa,CAC5B,MAAM3lB,EAASxvB,KAAKixC,UAAUV,cAAcpF,EAAKz0B,IAC7C8Y,GACAwb,EAAQrkC,KAAK6oB,EAErB,CAEA,OAAOwb,CACX,CAKA,gBAAAuH,CAAiBmC,GACb,OAAO10C,KAAKmxC,gBAAgBC,gBAAgB77B,IAAIm/B,EACpD,CAKA,kBAAAgD,CAAmBlJ,GACf,OAAOxuC,KAAKmxC,gBAAgBE,kBAAkB97B,IAAIi5B,EACtD,CAKA,cAAAmJ,GACI,MAAMC,EAAa53C,KAAKixC,UAAUT,cAAc5pC,OAC1CixC,EAAa73C,KAAKixC,UAAUR,gBAC5B2G,EAAeS,EAAWjxC,OAGhC,OAFqBixC,EAAWrW,OAAO,CAACC,EAAKjS,IAAWiS,EAAMjS,EAAOkL,QAAQ9zB,OAAQ,GAE9E,CACHgxC,aACAR,eACAhG,gBAAiBpxC,KAAKmxC,gBAAgBC,gBAAgB/lC,KACtDgmC,kBAAmBrxC,KAAKmxC,gBAAgBE,kBAAkBhmC,KAC1D+rB,eAAgBp3B,KAAKkxC,WAAWyE,oBAChCmC,iBAAkB93C,KAAKkxC,WAAW2E,sBAClCkC,kBAAmB/3C,KAAK62B,eAAe5wB,MAAQ,UAC/C2oB,WAAY5uB,KAAKixC,UAAUP,kBAAkBrlC,KAC7C2sC,oBAAqBh4C,KAAKkxC,WAAW4E,wBAE7C,CAKA,gBAAM9E,GACF,GAAKhxC,KAAK8e,cAEV,IAEI,MAAMqyB,EAAkB,CACpBC,gBAAiB/6B,MAAMC,KAAKtW,KAAKmxC,gBAAgBC,iBACjDC,kBAAmBh7B,MAAMC,KAAKtW,KAAKmxC,gBAAgBE,mBACnDC,iBAAkBtxC,KAAKmxC,gBAAgBG,wBAGrCtxC,KAAKw1C,YAAYxE,WACnBhxC,KAAKixC,UACLjxC,KAAKkxC,WACLC,GAGJnxC,KAAKgJ,OAAOxD,MAAM,4BAEtB,OAASM,GACL9F,KAAKgJ,OAAOlD,MAAM,wBAAyBA,EAC/C,CACJ,CAKQ,aAAA0wC,GACAx2C,KAAKo1C,eACL6C,cAAcj4C,KAAKo1C,eAGvBp1C,KAAKo1C,cAAgBl1C,OAAOg4C,YAAYp4B,gBAC9B9f,KAAKgxC,cACZhxC,KAAKiF,OAAOutB,kBAEfxyB,KAAKgJ,OAAOxD,MAAM,sBAAsBxF,KAAKiF,OAAOutB,+BACxD,CAKA,aAAA2lB,GACI,MAAO,IAAKn4C,KAAKkxC,WACrB,CAKA,kBAAAkH,GACI,MAAO,CACHhH,gBAAiB,IAAIx5B,IAAI5X,KAAKmxC,gBAAgBC,iBAC9CC,kBAAmB,IAAIz5B,IAAI5X,KAAKmxC,gBAAgBE,mBAChDC,iBAAkB,IAAItxC,KAAKmxC,gBAAgBG,kBAC3CmE,gBAAiBz1C,KAAKmxC,gBAAgBsE,gBACtCC,aAAc11C,KAAKmxC,gBAAgBuE,aAE3C,CAKA,kBAAMX,GACF,aAAa/0C,KAAKw1C,YAAYT,cAClC,CAKA,kBAAMC,CAAatvC,SACT1F,KAAKw1C,YAAYR,aAAatvC,GAGpC1F,KAAK8e,eAAgB,QACf9e,KAAK2K,YACf,CAKA,eAAAiqC,GACI,OAAO50C,KAAKw1C,YAAYZ,iBAC5B,CAKA,aAAAyD,CAAcC,GACV,MAAMT,EAAa73C,KAAKixC,UAAUR,gBAC5B8H,EAAiBD,EAAMpe,cAE7B,OAAO2d,EAAW7vC,OAAOwnB,GACrBA,EAAOvpB,KAAKi0B,cAAcriB,SAAS0gC,IACnC/oB,EAAO2b,KAAKllC,KAAKi0B,cAAcriB,SAAS0gC,IAC1CjwC,MAAM,EAAG,GACf,CAKA,iBAAAkwC,CAAkBC,EAAmBC,GACjC,MAAMC,EAAU34C,KAAKw3C,UAAUiB,GACzBG,EAAU54C,KAAKw3C,UAAUkB,GAE/B,OAAKC,GAAYC,EAEVhsC,KAAK8D,KACR9D,KAAK+D,IAAIioC,EAAQl+B,SAAShO,EAAIisC,EAAQj+B,SAAShO,EAAG,GAClDE,KAAK+D,IAAIioC,EAAQl+B,SAAS/N,EAAIgsC,EAAQj+B,SAAS/N,EAAG,KAJrB,CAMrC,CAKA,aAAAksC,GACI,OAAK74C,KAAKmxC,gBAAgBuE,cACnB11C,KAAKw3C,UAAUx3C,KAAKmxC,gBAAgBuE,eADI,IAEnD,CAKA,YAAAoD,CAAaC,GACT/4C,KAAKiF,OAAS,IAAKjF,KAAKiF,UAAW8zC,GAG/BA,EAAUvmB,kBAAoBxyB,KAAKiF,OAAOf,gBAC1ClE,KAAKw2C,gBAGTx2C,KAAKgJ,OAAOxD,MAAM,uCACtB,CAKA,aAAM8L,SAEItR,KAAKgxC,aAGPhxC,KAAKo1C,gBACL6C,cAAcj4C,KAAKo1C,eACnBp1C,KAAKo1C,cAAgB,MAIzBp1C,KAAKk1C,cAAchtC,QACnBlI,KAAKm1C,YAAc,GACnBn1C,KAAKw1C,YAAYb,aAEjB30C,KAAKgJ,OAAOpD,KAAK,sCACrB,CAKA,mBAAAozC,GACI,OAAOh5C,KAAK8e,aAChB,ECjjBG,MAAMm6B,EAyBT,WAAAn0C,CACIG,EAAmC,GACnCi0C,EAAiC,CAAA,GAzBrCl5C,KAAQm5C,OAAsB,GAC9Bn5C,KAAQo5C,wBAA2DtwC,IAInE9I,KAAQq5C,aAAe,EACvBr5C,KAAQs5C,eAAiB,EACzBt5C,KAAQu5C,YAAc,EAGtBv5C,KAAQw5C,eAAgC,KACxCx5C,KAAQy5C,gBAAiC,KACzCz5C,KAAQ05C,YAAa,EAIrB15C,KAAQ25C,kBAAsD7wC,IAC9D9I,KAAQ45C,UAAY,EACpB55C,KAAQ65C,UAAY,EACpB75C,KAAQ85C,UAAuC,SAQ3C95C,KAAKgJ,OAAS,IAAIO,EAAO,oBACzBvJ,KAAKk5C,aAAeA,EAGpBl5C,KAAKiF,OAAS,CACV80C,YAAa,KACbC,aAAc,IACdC,YAAa,IACbC,aAAc,EACdC,mBAAmB,EACnBC,YAAY,KACTn1C,GAIPjF,KAAK8nC,aAAe,CAChBzL,KAAM,IACNC,QAAS,IACTC,MAAO,IACP5F,KAAM,IACN6F,KAAM,EACNC,eAAe,EACfC,eAAe,EACfC,eAAe,EACfC,aAAa,EACbC,WAAW,EACXf,iBAAkB,EAClBgB,eAAgB,EAChBC,eAAgB,EAChBC,YAAa,GAGjBh9B,KAAKq6C,cACLr6C,KAAKs6C,2BAELt6C,KAAKgJ,OAAOpD,KAAK,qCAAsC,CACnDuzC,OAAQn5C,KAAKm5C,OAAOvyC,OACpBwyC,oBAAqBp5C,KAAKo5C,oBAAoB/tC,MAEtD,CAKQ,WAAAgvC,GACJ,MACME,GADav6C,KAAKiF,OAAO80C,YAC8B,EAA3B/5C,KAAKiF,OAAOi1C,cAAqB,EAC7DM,EAASx6C,KAAKiF,OAAO+0C,aAAeh6C,KAAKiF,OAAOg1C,YAEtDj6C,KAAKm5C,OAAS,CACV,CACIzsC,EAAG1M,KAAKiF,OAAOi1C,aACfvtC,EAAG6tC,EACH/vC,MAAO8vC,EACP7vC,OAAQ1K,KAAKiF,OAAOg1C,YACpBQ,MAAO,gBAEX,CACI/tC,EAAG1M,KAAKiF,OAAOi1C,aAAyD,GAAzCK,EAAav6C,KAAKiF,OAAOi1C,cACxDvtC,EAAG6tC,EACH/vC,MAAO8vC,EACP7vC,OAAQ1K,KAAKiF,OAAOg1C,YACpBQ,MAAO,gBAEX,CACI/tC,EAAG1M,KAAKiF,OAAOi1C,aAAyD,GAAzCK,EAAav6C,KAAKiF,OAAOi1C,cACxDvtC,EAAG6tC,EACH/vC,MAAO8vC,EACP7vC,OAAQ1K,KAAKiF,OAAOg1C,YACpBQ,MAAO,kBAEX,CACI/tC,EAAG1M,KAAKiF,OAAOi1C,aAAyD,GAAzCK,EAAav6C,KAAKiF,OAAOi1C,cACxDvtC,EAAG6tC,EACH/vC,MAAO8vC,EACP7vC,OAAQ1K,KAAKiF,OAAOg1C,YACpBQ,MAAO,WAEX,CACI/tC,EAAG1M,KAAKiF,OAAOi1C,aAAyD,GAAzCK,EAAav6C,KAAKiF,OAAOi1C,cACxDvtC,EAAG6tC,EACH/vC,MAAO8vC,EACP7vC,OAAQ1K,KAAKiF,OAAOg1C,YACpBQ,MAAO,eAGnB,CAKQ,wBAAAH,GACJt6C,KAAK06C,oBACL16C,KAAK26C,oBACL36C,KAAK46C,mBACL56C,KAAK66C,oBACL76C,KAAK86C,iBACT,CAKQ,iBAAAJ,GACJ,MAAMK,EAAQ/6C,KAAKm5C,OAAO,GAK1Bn5C,KAAKg7C,WAAW,iBAAkBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAJrC,GACC,EAGqE,UAAW,QACtG3M,KAAKg7C,WAAW,oBAAqBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GALxC,GACC,EAIwE,UAAW,WACzG3M,KAAKg7C,WAAW,kBAAmBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GANtC,GACC,EAKsE,UAAW,SACvG3M,KAAKg7C,WAAW,iBAAkBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAPrC,GACC,EAMqE,UAAW,QACtG3M,KAAKg7C,WAAW,iBAAkBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GARrC,GACC,EAOqE,UAAW,QAGtG3M,KAAKg7C,WAAW,kBAAmBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,QACjF3M,KAAKg7C,WAAW,eAAgBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,QAC9E3M,KAAKg7C,WAAW,iBAAkBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,QAChF3M,KAAKg7C,WAAW,eAAgBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,OAClF,CAKQ,iBAAAguC,GACJ,MAAMI,EAAQ/6C,KAAKm5C,OAAO,GAG1Bn5C,KAAKg7C,WAAW,iBAAkBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,WAChF3M,KAAKg7C,WAAW,iBAAkBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,WAChF3M,KAAKg7C,WAAW,iBAAkBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,WAChF3M,KAAKg7C,WAAW,cAAeD,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,QAG9E3M,KAAKg7C,WAAW,gBAAiBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,UAC/E3M,KAAKg7C,WAAW,gBAAiBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,WAG/E3M,KAAKg7C,WAAW,eAAgBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,gBAClF,CAKQ,gBAAAiuC,GACJ,MAAMG,EAAQ/6C,KAAKm5C,OAAO,GAG1Bn5C,KAAKg7C,WAAW,iBAAkBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,UAAW,UAGjF3M,KAAKg7C,WAAW,kBAAmBD,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,UAAW,SAGnF3M,KAAKg7C,WAAW,gBAAiBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,OAC/E3M,KAAKg7C,WAAW,YAAaD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,SAC3E3M,KAAKg7C,WAAW,eAAgBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,QAC9E3M,KAAKg7C,WAAW,WAAYD,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,OAC/E,CAKQ,iBAAAkuC,GACJ,MAAME,EAAQ/6C,KAAKm5C,OAAO,GAG1Bn5C,KAAKg7C,WAAW,cAAeD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,SAC7E3M,KAAKg7C,WAAW,cAAeD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,UAC7E3M,KAAKg7C,WAAW,cAAeD,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,WAG9E3M,KAAKg7C,WAAW,iBAAkBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,IAAK,GAAI,UAAW,eAGlF3M,KAAKg7C,WAAW,mBAAoBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,OAClF3M,KAAKg7C,WAAW,eAAgBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,QAC9E3M,KAAKg7C,WAAW,iBAAkBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,OAGhF3M,KAAKg7C,WAAW,cAAeD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,OACjF,CAKQ,eAAAmuC,GACJ,MAAMC,EAAQ/6C,KAAKm5C,OAAO,GAG1Bn5C,KAAKg7C,WAAW,gBAAiBD,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,UAAW,SAGhF3M,KAAKg7C,WAAW,UAAWD,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,MAC1E3M,KAAKg7C,WAAW,WAAYD,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,MAC3E3M,KAAKg7C,WAAW,aAAcD,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,QAC7E3M,KAAKg7C,WAAW,aAAcD,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,SACjF,CAKQ,UAAAquC,CACJtkC,EACAhK,EACAC,EACAlC,EACAC,EACAzG,EACAg3C,GAEAj7C,KAAKo5C,oBAAoBrwC,IAAI2N,EAAI,CAC7BhK,IAAGC,IAAGlC,QAAOC,SAAQzG,OAAMyS,KAAIukC,QAC/B14B,MAAgB,WAATte,EAAoB,QAAK,EAChCoT,MAAgB,WAATpT,QAA2B,GAE1C,CAKA,MAAAuQ,CAAOC,EAAmB9R,GAEtB3C,KAAKitB,oBAAoBxY,GAGrBzU,KAAKiF,OAAOk1C,mBACZn6C,KAAKmtB,YAAYxqB,EAEzB,CAKQ,mBAAAsqB,CAAoBxY,GACxBzU,KAAKq5C,cAAgB5kC,EACrBzU,KAAKs5C,gBAA8B,IAAZ7kC,EACvBzU,KAAKu5C,aAAe9kC,EAGhBzU,KAAKq5C,aAAe,KAAIr5C,KAAKq5C,aAAe,GAC5Cr5C,KAAKs5C,eAAiB,MAAMt5C,KAAKs5C,eAAiB,GAClDt5C,KAAKu5C,YAAc,IAAGv5C,KAAKu5C,YAAc,EACjD,CAKQ,WAAApsB,CAAYxqB,GAChB,MAAMu4C,EAAWv4C,EAAMyV,mBAGvBpY,KAAKw5C,eAAiB,KACtB,IAAA,MAAY9iC,EAAIykC,KAAYn7C,KAAKo5C,oBAC7B,GAAIp5C,KAAKo7C,iBAAiBF,EAAUC,GAAU,CAC1Cn7C,KAAKw5C,eAAiB9iC,EACtB,KACJ,CAWJ,GAPI/T,EAAMwV,qBAAqB,IACvBnY,KAAKw5C,gBACLx5C,KAAKq7C,mBAAmBr7C,KAAKw5C,gBAKjC72C,EAAMuV,kBAAkB,IAAMlY,KAAKy5C,gBAAiB,CACpD,MAAM0B,EAAUn7C,KAAKo5C,oBAAoBlwC,IAAIlJ,KAAKy5C,iBAC9C0B,GAA4B,WAAjBA,EAAQl3C,MACnBjE,KAAKs7C,iBAAiBH,EAASD,EAEvC,MACIl7C,KAAKy5C,gBAAkB,KACvBz5C,KAAK05C,YAAa,CAE1B,CAKQ,gBAAA0B,CAAiBz/B,EAAgBw/B,GACrC,OAAOx/B,EAAMjP,GAAKyuC,EAAQzuC,GACnBiP,EAAMjP,GAAKyuC,EAAQzuC,EAAIyuC,EAAQ1wC,OAC/BkR,EAAMhP,GAAKwuC,EAAQxuC,GACnBgP,EAAMhP,GAAKwuC,EAAQxuC,EAAIwuC,EAAQzwC,MAC1C,CAKQ,kBAAA2wC,CAAmBE,GACvB,MAAMJ,EAAUn7C,KAAKo5C,oBAAoBlwC,IAAIqyC,GAC7C,GAAKJ,EAIL,OAFAn7C,KAAKy5C,gBAAkB8B,EAEfJ,EAAQl3C,MACZ,IAAK,SACDjE,KAAKw7C,kBAAkBD,GACvB,MACJ,IAAK,SACDv7C,KAAKy7C,kBAAkBF,EAAWJ,GAClC,MACJ,IAAK,SACDn7C,KAAK05C,YAAa,EAG9B,CAKQ,iBAAA8B,CAAkBD,GACtB,OAAQA,GACJ,IAAK,eAEDv7C,KAAKgJ,OAAOnD,KAAK,uCACjB,MACJ,IAAK,gBACD7F,KAAKk5C,aAAawC,oBAClB,MACJ,IAAK,YACD17C,KAAKk5C,aAAayC,gBAClB,MACJ,IAAK,eACD37C,KAAKk5C,aAAa0C,mBAClB,MACJ,IAAK,WACD57C,KAAKk5C,aAAa2C,eAClB,MACJ,IAAK,aACD77C,KAAKk5C,aAAa4C,oBAClB,MACJ,IAAK,UACD97C,KAAK65C,UAAYjtC,KAAKuD,IAAI,EAAsB,IAAjBnQ,KAAK65C,WACpC75C,KAAKk5C,aAAa6C,cAAc/7C,KAAK65C,WACrC,MACJ,IAAK,WACD75C,KAAK65C,UAAYjtC,KAAKoC,IAAI,GAAKhP,KAAK65C,UAAY,KAChD75C,KAAKk5C,aAAa6C,cAAc/7C,KAAK65C,WAGjD,CAKQ,iBAAA4B,CAAkBF,EAAmBJ,GACzCA,EAAQ9jC,OAAS8jC,EAAQ9jC,MAEzB,MAQM2kC,EARoC,CACtCC,eAAkB,UAClBC,eAAkB,UAClBC,eAAkB,UAClBC,YAAe,aACfC,WAAc,cAGWd,GACzBS,IACmB,eAAfA,EACAh8C,KAAK85C,UAA+B,WAAnB95C,KAAK85C,UAAyB,eAAiB,SAEhE95C,KAAKk5C,aAAaoD,iBAAiBN,EAAYb,EAAQ9jC,OAGnE,CAKQ,gBAAAikC,CAAiBH,EAA6BD,GAClD,MAAMqB,EAASrB,EAASxuC,EAAIyuC,EAAQzuC,EAC9B8vC,EAAa5vC,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAMosC,EAASpB,EAAQ1wC,MAAS,MACxE0wC,EAAQ54B,MAAQi6B,EAGG,kBAAfrB,EAAQzkC,GACR1W,KAAKk5C,aAAauD,0BAA0B,CAAEvf,QAASsf,IACjC,kBAAfrB,EAAQzkC,IACf1W,KAAKk5C,aAAauD,0BAA0B,CAAEngB,QAASkgB,GAE/D,CAKA,MAAAnpB,CAAOC,GAEHtzB,KAAK08C,gBAAgBppB,GAGrBtzB,KAAKm5C,OAAOhqC,QAAQ,CAAC4rC,EAAOjuC,KACxB9M,KAAK28C,YAAYrpB,EAAUynB,EAAOjuC,KAIlC9M,KAAKiF,OAAOm1C,YACZp6C,KAAK48C,iBAAiBtpB,EAE9B,CAKQ,eAAAopB,CAAgBppB,GACpB,MAAMupB,EAAQ78C,KAAKiF,OAAO+0C,aAAeh6C,KAAKiF,OAAOg1C,YAAc,GAC7D6C,EAAa98C,KAAKiF,OAAOg1C,YAAc,GAG7C3mB,EAAStnB,SAAS,EAAG6wC,EAAO78C,KAAKiF,OAAO80C,YAAa+C,EAAY,CAAExxC,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAGpF8nB,EAAStnB,SAAS,EAAG6wC,EAAO78C,KAAKiF,OAAO80C,YAAa,EAAG,CAAEzuC,EAAG,EAAGC,EAAG,GAAIC,EAAG,IAG1E,IAAA,IAASe,EAAI,EAAGA,EAAIvM,KAAKm5C,OAAOvyC,OAAQ2F,IAAK,CACzC,MAAMG,EAAI1M,KAAKm5C,OAAO5sC,GAAGG,EAAI1M,KAAKiF,OAAOi1C,aAAe,EACxD5mB,EAAStnB,SAASU,EAAGmwC,EAAQ,EAAG,EAAGC,EAAa,GAAI,CAAExxC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC3E,CACJ,CAKQ,WAAAmxC,CAAYrpB,EAAoBynB,EAAkBgC,GAUtD,OARAzpB,EAAStnB,SAAS+uC,EAAMruC,EAAGquC,EAAMpuC,EAAGouC,EAAMtwC,MAAOswC,EAAMrwC,OAAQ,CAAEY,EAAG,EAAGC,EAAG,GAAIC,EAAG,IACjF8nB,EAASrmB,SAAS8tC,EAAMruC,EAAGquC,EAAMpuC,EAAGouC,EAAMruC,EAAIquC,EAAMtwC,MAAOswC,EAAMpuC,EAAG,CAAErB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KACvF8nB,EAASrmB,SAAS8tC,EAAMruC,EAAGquC,EAAMpuC,EAAGouC,EAAMruC,EAAGquC,EAAMpuC,EAAIouC,EAAMrwC,OAAQ,CAAEY,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAGxF8nB,EAASnlB,WAAW4sC,EAAMN,MAAOM,EAAMruC,EAAI,EAAGquC,EAAMpuC,EAAI,EAAG,CAAErB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,GAG5EuxC,GACJ,KAAK,EAAG/8C,KAAKg9C,mBAAmB1pB,EAAUynB,GAAQ,MAClD,KAAK,EAAG/6C,KAAKi9C,mBAAmB3pB,EAAUynB,GAAQ,MAClD,KAAK,EAAG/6C,KAAKk9C,kBAAkB5pB,EAAUynB,GAAQ,MACjD,KAAK,EAAG/6C,KAAKm9C,mBAAmB7pB,EAAUynB,GAAQ,MAClD,KAAK,EAAG/6C,KAAKo9C,iBAAiB9pB,EAAUynB,GAEhD,CAKQ,kBAAAiC,CAAmB1pB,EAAoBynB,GAE3C/6C,KAAKq9C,gBAAgB/pB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,EAAG3M,KAAK8nC,aAAazL,KAAM,QAC1Fr8B,KAAKq9C,gBAAgB/pB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,EAAG3M,KAAK8nC,aAAaxL,QAAS,QAC7Ft8B,KAAKq9C,gBAAgB/pB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,EAAG3M,KAAK8nC,aAAavL,MAAO,OAC3Fv8B,KAAKq9C,gBAAgB/pB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,EAAG3M,KAAK8nC,aAAanR,KAAM,QAC1F32B,KAAKq9C,gBAAgB/pB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,EAAG3M,KAAK8nC,aAAatL,KAAM,QAAQ,GAGlGx8B,KAAKs9C,mBAAmBhqB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI3M,KAAK8nC,aAAavL,MAAQ,IACxFv8B,KAAKs9C,mBAAmBhqB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI3M,KAAK8nC,aAAazL,KAAO,IACvFr8B,KAAKs9C,mBAAmBhqB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,IAAK3M,KAAK8nC,aAAapL,eACjF18B,KAAKs9C,mBAAmBhqB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,IAAK3M,KAAK8nC,aAAajL,UACrF,CAKQ,kBAAAogB,CAAmB3pB,EAAoBynB,GAE3C/6C,KAAKu9C,aAAajqB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI3M,KAAK8nC,aAAarL,cAAe,OACjGz8B,KAAKu9C,aAAajqB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI3M,KAAK8nC,aAAapL,cAAe,QACjG18B,KAAKu9C,aAAajqB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI3M,KAAK8nC,aAAanL,cAAe,OACjG38B,KAAKu9C,aAAajqB,EAAUynB,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI3M,KAAK8nC,aAAajL,UAAW,QAG9F,MAAM2gB,EAAex9C,KAAKo5C,oBAAoBlwC,IAAI,iBAC5Cu0C,EAAez9C,KAAKo5C,oBAAoBlwC,IAAI,iBAE9Cs0C,GACAx9C,KAAK09C,aAAapqB,EAAUkqB,EAAcA,EAAaj7B,OAAS,GAAI,UAEpEk7B,GACAz9C,KAAK09C,aAAapqB,EAAUmqB,EAAcA,EAAal7B,OAAS,GAAI,WAIxEviB,KAAKs0B,aAAahB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,WAAY,CAAErB,EAAG,IAAKC,EAAG,EAAGC,EAAG,GACnG,CAKQ,iBAAA0xC,CAAkB5pB,EAAoBynB,GAE1C/6C,KAAK29C,oBAAoBrqB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,IAGnE2mB,EAASnlB,WAAW,UAAUnO,KAAK45C,UAAUvwC,QAAQ,MACjD0xC,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,CAAErB,EAAG,IAAKC,EAAG,IAAKC,EAAG,GAAK,IAG3DxL,KAAKs0B,aAAahB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,MAAO,CAAErB,EAAG,EAAGC,EAAG,IAAKC,EAAG,MAC1FxL,KAAKs0B,aAAahB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,QAAS,CAAErB,EAAG,EAAGC,EAAG,IAAKC,EAAG,MAC5FxL,KAAKs0B,aAAahB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,OAAQ,CAAErB,EAAG,EAAGC,EAAG,IAAKC,EAAG,MAC3FxL,KAAKs0B,aAAahB,EAAUynB,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,OAAQ,CAAErB,EAAG,EAAGC,EAAG,IAAKC,EAAG,KAChG,CAKQ,kBAAA2xC,CAAmB7pB,EAAoBynB,GAE3C/6C,KAAKs0B,aAAahB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,QAAS,CAAErB,EAAG,EAAGC,EAAG,IAAKC,EAAG,IAC5FxL,KAAKs0B,aAAahB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,CAAErB,EAAG,IAAKC,EAAG,IAAKC,EAAG,MAC/FxL,KAAKs0B,aAAahB,EAAUynB,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,UAAW,CAAErB,EAAG,IAAKC,EAAG,IAAKC,EAAG,MAGjG8nB,EAAStnB,SAAS+uC,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,IAAK,GAAI,CAAErB,EAAG,EAAGC,EAAG,GAAIC,EAAG,IACzE8nB,EAASnlB,WAAW,qBAAsB4sC,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,CAAErB,EAAG,EAAGC,EAAG,IAAKC,EAAG,GAAK,GAC9F8nB,EAASnlB,WAAW,sBAAuB4sC,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,CAAErB,EAAG,EAAGC,EAAG,IAAKC,EAAG,GAAK,GAG/FxL,KAAKs9C,mBAAmBhqB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI3M,KAAK8nC,aAAatL,KAAO,IACvFx8B,KAAKs9C,mBAAmBhqB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,IAAI,GAC9D3M,KAAKs9C,mBAAmBhqB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI3M,KAAK8nC,aAAavL,MAAQ,GAC5F,CAKQ,gBAAA6gB,CAAiB9pB,EAAoBynB,GAEzC/6C,KAAK49C,mBAAmBtqB,EAAUynB,EAAMruC,EAAI,GAAIquC,EAAMpuC,EAAI,GAAI,GAAI,IAGlE3M,KAAKs0B,aAAahB,EAAUynB,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,KAAM,CAAErB,EAAG,EAAGC,EAAG,IAAKC,EAAG,MAC1FxL,KAAKs0B,aAAahB,EAAUynB,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,KAAM,CAAErB,EAAG,EAAGC,EAAG,IAAKC,EAAG,MAC1FxL,KAAKu9C,aAAajqB,EAAUynB,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAuB,iBAAnB3M,KAAK85C,UAA8B,QACpG95C,KAAKs0B,aAAahB,EAAUynB,EAAMruC,EAAI,IAAKquC,EAAMpuC,EAAI,GAAI,GAAI,GAAI,SAAU,CAAErB,EAAG,IAAKC,EAAG,IAAKC,EAAG,GACpG,CAKQ,eAAA6xC,CACJ/pB,EACA5mB,EACAC,EACAlC,EACAC,EACA6X,EACA04B,EACA4C,GAAS,GAGTvqB,EAAStnB,SAASU,EAAGC,EAAGlC,EAAOC,EAAQ,CAAEY,EAAG,EAAGC,EAAG,EAAGC,EAAG,IAGxD,MAAMsyC,EAAav7B,EAAQ,IAAO9X,EAClC,IAAIszC,EAIAA,EAFAF,EAEYt7B,EAAQ,GAAK,CAAEjX,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACjC+W,EAAQ,GAAK,CAAEjX,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACpB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAG9B+W,EAAQ,GAAK,CAAEjX,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACjC+W,EAAQ,GAAK,CAAEjX,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACpB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAG9C8nB,EAAStnB,SAASU,EAAGC,EAAGmxC,EAAWpzC,EAAQqzC,GAG3CzqB,EAASrmB,SAASP,EAAGC,EAAGD,EAAIjC,EAAOkC,EAAG,CAAErB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KACzD8nB,EAASrmB,SAASP,EAAGC,EAAIjC,EAAQgC,EAAIjC,EAAOkC,EAAIjC,EAAQ,CAAEY,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAG3E8nB,EAASnlB,WAAW,GAAGoU,EAAMlZ,QAAQ,KAAMqD,EAAIjC,EAAQ,EAAGkC,EAAG,CAAErB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,EAC1F,CAKQ,kBAAA8xC,CAAmBhqB,EAAoB5mB,EAAWC,EAAWg2B,GACjE,MAAMr2B,EAAQq2B,EACV,CAAEr3B,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,EAAGC,EAAG,GAEtB8nB,EAAStnB,SAASU,EAAGC,EAAG,EAAG,EAAGL,GAG1Bq2B,GAAY/1B,KAAKqU,IAAwB,GAApBjhB,KAAKq5C,cAAqB,IAC/C/lB,EAAStnB,SAASU,EAAI,EAAGC,EAAI,EAAG,EAAG,EAAG,CAAErB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAEjE,CAKQ,YAAA+xC,CACJjqB,EACA5mB,EACAC,EACAlC,EACAC,EACA2M,EACA4jC,GAEA,MAAM+C,EAAU3mC,EAAQ,CAAE/L,EAAG,EAAGC,EAAG,GAAIC,EAAG,GAAM,CAAEF,EAAG,GAAIC,EAAG,EAAGC,EAAG,GAC5DuD,EAAYsI,EAAQ,CAAE/L,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAO,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAEvE8nB,EAAStnB,SAASU,EAAGC,EAAGlC,EAAOC,EAAQszC,GACvC1qB,EAASnlB,WAAW8sC,EAAOvuC,EAAI,EAAGC,EAAI,EAAGoC,EAAW,EACxD,CAKQ,YAAA2uC,CACJpqB,EACA6nB,EACA54B,EACA04B,GAGA3nB,EAAStnB,SAASmvC,EAAQzuC,EAAGyuC,EAAQxuC,EAAGwuC,EAAQ1wC,MAAO0wC,EAAQzwC,OAAQ,CAAEY,EAAG,EAAGC,EAAG,EAAGC,EAAG,IAGxF,MAAMyyC,EAAa17B,EAAQ,IAAO44B,EAAQ1wC,MAC1C6oB,EAAStnB,SAASmvC,EAAQzuC,EAAGyuC,EAAQxuC,EAAGsxC,EAAW9C,EAAQzwC,OAAQ,CAAEY,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAGtF8nB,EAAStnB,SAASmvC,EAAQzuC,EAAIuxC,EAAY,EAAG9C,EAAQxuC,EAAI,EAAG,EAAGwuC,EAAQzwC,OAAS,EAAG,CAAEY,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAGtG8nB,EAASnlB,WAAW8sC,EAAOE,EAAQzuC,EAAGyuC,EAAQxuC,EAAI,GAAI,CAAErB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,GAC/E8nB,EAASnlB,WAAW,GAAGoU,EAAMlZ,QAAQ,MAAO8xC,EAAQzuC,EAAIyuC,EAAQ1wC,MAAQ,GAAI0wC,EAAQxuC,EAAI,GAAI,CAAErB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,EACzH,CAKQ,YAAA8oB,CACJhB,EACA5mB,EACAC,EACAlC,EACAC,EACAuwC,EACA3uC,GAEA,MAAM4xC,EAAYl+C,KAAKw5C,gBAAgB3hC,SAASojC,EAAM/gB,eAChD8jB,EAAUE,EACZ,CAAE5yC,EAAGgB,EAAMhB,EAAI,GAAIC,EAAGe,EAAMf,EAAI,GAAIC,EAAGc,EAAMd,EAAI,IACjD,CAAEF,EAAGgB,EAAMhB,EAAI,EAAGC,EAAGe,EAAMf,EAAI,EAAGC,EAAGc,EAAMd,EAAI,GAEnD8nB,EAAStnB,SAASU,EAAGC,EAAGlC,EAAOC,EAAQszC,GACvC1qB,EAASnlB,WAAW8sC,EAAOvuC,EAAI,EAAGC,EAAI,EAAGL,EAAO,EACpD,CAKQ,mBAAAqxC,CAAoBrqB,EAAoB5mB,EAAWC,EAAWlC,EAAeC,GAEjF4oB,EAAStnB,SAASU,EAAGC,EAAGlC,EAAOC,EAAQ,CAAEY,EAAG,EAAGC,EAAG,GAAIC,EAAG,IAGzD,MAAM2yC,EAAQzxC,EAAIjC,EAAQ,EACpB2zC,EAAQzxC,EAAIjC,EAAS,EAGV,CACb,CAAEzE,KAAM,MAAOyG,EAAGyxC,EAAOxxC,EAAGyxC,EAAQ,GAAI9xC,MAAO,CAAEhB,EAAG,EAAGC,EAAG,IAAKC,EAAG,IAClE,CAAEvF,KAAM,QAASyG,EAAGyxC,EAAOxxC,EAAGyxC,EAAQ,GAAI9xC,MAAO,CAAEhB,EAAG,EAAGC,EAAG,IAAKC,EAAG,IACpE,CAAEvF,KAAM,OAAQyG,EAAGyxC,EAAQ,GAAIxxC,EAAGyxC,EAAO9xC,MAAO,CAAEhB,EAAG,EAAGC,EAAG,IAAKC,EAAG,IACnE,CAAEvF,KAAM,OAAQyG,EAAGyxC,EAAQ,GAAIxxC,EAAGyxC,EAAO9xC,MAAO,CAAEhB,EAAG,EAAGC,EAAG,IAAKC,EAAG,IACnE,CAAEvF,KAAM,OAAQyG,EAAGyxC,EAAOxxC,EAAGyxC,EAAO9xC,MAAO,CAAEhB,EAAG,EAAGC,EAAG,IAAKC,EAAG,IAC9D,CAAEvF,KAAM,OAAQyG,EAAGyxC,EAAQ,EAAGxxC,EAAGyxC,EAAQ,EAAG9xC,MAAO,CAAEhB,EAAG,EAAGC,EAAG,IAAKC,EAAG,IACtE,CAAEvF,KAAM,MAAOyG,EAAGyxC,EAAQ,EAAGxxC,EAAGyxC,EAAQ,EAAG9xC,MAAO,CAAEhB,EAAG,EAAGC,EAAG,IAAKC,EAAG,IACrE,CAAEvF,KAAM,MAAOyG,EAAGyxC,EAAQ,EAAGxxC,EAAGyxC,EAAQ,EAAG9xC,MAAO,CAAEhB,EAAG,EAAGC,EAAG,IAAKC,EAAG,KAGhE2D,QAAQkuB,IACb/J,EAAStnB,SAASqxB,EAAQ3wB,EAAI,EAAG2wB,EAAQ1wB,EAAI,EAAG,EAAG,EAAG0wB,EAAQ/wB,OAC9DgnB,EAASnlB,WAAWkvB,EAAQp3B,KAAMo3B,EAAQ3wB,EAAI,GAAI2wB,EAAQ1wB,EAAI,EAAG,CAAErB,EAAG,EAAGC,EAAG,IAAKC,EAAG,GAAK,IAEjG,CAKQ,kBAAAoyC,CAAmBtqB,EAAoB5mB,EAAWC,EAAWlC,EAAeC,GAEhF4oB,EAAStnB,SAASU,EAAGC,EAAGlC,EAAOC,EAAQ,CAAEY,EAAG,EAAGC,EAAG,EAAGC,EAAG,IAGxD,MAAMsC,EAAUpB,EAAIjC,EAAQ,EACtBsD,EAAUpB,EAAIjC,EAAS,EACvB2zC,EAAYzxC,KAAKuD,IAAI1F,EAAOC,GAAU,EAAI,EAGhD,IAAA,IAAS6B,EAAI,EAAGA,GAAK,EAAGA,IAAK,CACzB,MAAMyB,EAAUqwC,EAAY,EAAK9xC,EACjC+mB,EAASzlB,WAAWC,EAASC,EAASC,EAAQ,CAAE1C,EAAG,EAAGC,EAAG,GAAIC,EAAG,GACpE,CAGA8nB,EAASrmB,SAASa,EAAUuwC,EAAWtwC,EAASD,EAAUuwC,EAAWtwC,EAAS,CAAEzC,EAAG,EAAGC,EAAG,GAAIC,EAAG,IAChG8nB,EAASrmB,SAASa,EAASC,EAAUswC,EAAWvwC,EAASC,EAAUswC,EAAW,CAAE/yC,EAAG,EAAGC,EAAG,GAAIC,EAAG,IAGhG8nB,EAAStnB,SAAS8B,EAAU,EAAGC,EAAU,EAAG,EAAG,EAAG,CAAEzC,EAAG,EAAGC,EAAG,IAAKC,EAAG,IAGrE8nB,EAAStnB,SAAS8B,EAAU,GAAIC,EAAU,GAAI,EAAG,EAAG,CAAEzC,EAAG,IAAKC,EAAG,IAAKC,EAAG,IACzE8nB,EAAStnB,SAAS8B,EAAU,GAAIC,EAAU,EAAG,EAAG,EAAG,CAAEzC,EAAG,IAAKC,EAAG,IAAKC,EAAG,IAGxE8nB,EAASnlB,WAAWnO,KAAK85C,UAAUprB,cAAehiB,EAAI,EAAGC,EAAIjC,EAAS,GAAI,CAAEY,EAAG,EAAGC,EAAG,IAAKC,EAAG,GAAK,GAClG8nB,EAASnlB,WAAW,SAASnO,KAAK65C,UAAUxwC,QAAQ,MAAOqD,EAAI,EAAGC,EAAIjC,EAAS,GAAI,CAAEY,EAAG,EAAGC,EAAG,IAAKC,EAAG,GAAK,EAC/G,CAKQ,gBAAAoxC,CAAiBtpB,GAGrB,IAAItzB,KAAK8nC,aAAazL,KAAO,IAAMr8B,KAAK8nC,aAAavL,MAAQ,KAErD3vB,KAAK2U,SAAW,GAAK,CACrB,MAAM7U,EAAIE,KAAK2U,SAAWvhB,KAAKiF,OAAO80C,YAChCptC,EAAI3M,KAAKiF,OAAO+0C,aAAeh6C,KAAKiF,OAAOg1C,YAAcrtC,KAAK2U,SAAWvhB,KAAKiF,OAAOg1C,YAC3F3mB,EAAS7mB,SAASC,EAAGC,EAAG,CAAErB,EAAG,IAAKC,EAAG,IAAKC,EAAG,KACjD,CAER,CAKA,kBAAA8yC,CAAmBliB,GACfp8B,KAAK8nC,aAAe,IAAK1L,EAC7B,CAKA,mBAAAmiB,CAAoBrc,GAChBliC,KAAK25C,cAAgB,IAAI7wC,IAAIo5B,EACjC,CAKA,eAAAsc,CAAgBzkB,GACZ/5B,KAAK45C,UAAYhtC,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAK4pB,GAC/C,CAKA,kBAAA+H,GACI,MAAM0b,EAAex9C,KAAKo5C,oBAAoBlwC,IAAI,iBAC5Cu0C,EAAez9C,KAAKo5C,oBAAoBlwC,IAAI,iBAElD,MAAO,CACHg0B,QAASsgB,GAAcj7B,OAAS,GAChC+Z,QAASmhB,GAAcl7B,OAAS,GAChC4a,QAAS,GACTP,YAAa,GACbQ,QAAS,GAEjB,EC/wBG,MAAMqhB,EA8CT,WAAA35C,CAAYG,GAzCZjF,KAAOua,SAAoB,CAAE7N,EAAG,EAAGC,EAAG,GAMtC3M,KAAOgvC,eAAyB,EAChChvC,KAAOkvC,UAAoB,EAK3BlvC,KAAO0+C,YAAsB,EAC7B1+C,KAAO2+C,WAAqB,EAC5B3+C,KAAO4+C,WAAqB,EAC5B5+C,KAAO8mC,cAAwB,EAC/B9mC,KAAO6+C,gBAA0B,EAKjC7+C,KAAO8+C,iBAAsC,GAQ7C9+C,KAAO++C,gBAAoC,GAK3C/+C,KAAOg/C,cAAwB,EAC/Bh/C,KAAOi/C,WAAqB,EAC5Bj/C,KAAOk/C,UAAoB,EAC3Bl/C,KAAOm/C,kBAA4B,EAgB/Bn/C,KAAK0W,GAAKzR,EAAOyR,GACjB1W,KAAKiG,KAAOhB,EAAOgB,KACnBjG,KAAKiE,KAAOgB,EAAOhB,KACnBjE,KAAK0a,SAAW,IAAKzV,EAAOyV,UAC5B1a,KAAKgO,OAAS/I,EAAO+I,OACrBhO,KAAK6a,KAAO5V,EAAO4V,KACnB7a,KAAKsM,MAAQ,IAAKrH,EAAOqH,OAEzBtM,KAAKo/C,WAAan6C,EAAOm6C,WACzBp/C,KAAKq/C,SAAWp6C,EAAOo6C,SACvBr/C,KAAKs/C,SAAWr6C,EAAOq6C,SAEvBt/C,KAAKgJ,OAAS,IAAIO,EAAO,iBAAiBtE,EAAOgB,QAEjDjG,KAAKu/C,qBACLv/C,KAAKw/C,2BACLx/C,KAAKy/C,oBAELz/C,KAAKgJ,OAAOxD,MAAM,WAAWxF,KAAKiE,SAASjE,KAAKiG,OAAQ,CACpD+H,OAAQhO,KAAKgO,OACb6M,KAAM7a,KAAK6a,KACXm0B,cAAehvC,KAAKgvC,eAE5B,CAKQ,kBAAAuQ,GACAv/C,KAAKo/C,aACLp/C,KAAKgvC,cAAgBhvC,KAAKo/C,WAAWpQ,cACrChvC,KAAKkvC,SAAWlvC,KAAKo/C,WAAWlQ,SAGhClvC,KAAK0/C,sBAGD1/C,KAAKo/C,WAAW7Q,cAAgB,IAChCvuC,KAAK0+C,YAA8C,GAAhC1+C,KAAKo/C,WAAW7Q,cACnCvuC,KAAK2+C,WAAa,EAAI/xC,KAAKuU,IAAMnhB,KAAKo/C,WAAWtQ,YAAc,OAInE9uC,KAAK8mC,cAAiB,EAAIl6B,KAAKuU,GAAM,IAGrCnhB,KAAKq/C,WAELr/C,KAAKsM,MAAQtM,KAAK2/C,iBAAiB3/C,KAAKq/C,SAAS/T,aACjDtrC,KAAK8mC,cAAiB,EAAIl6B,KAAKuU,GAAM,IAGrCnhB,KAAKs/C,WAELt/C,KAAK0+C,YAA4C,EAA9B1+C,KAAKs/C,SAAS/Q,cACjCvuC,KAAK2+C,WAAa,EAAI/xC,KAAKuU,IAAMnhB,KAAKs/C,SAASxQ,YAAc,IAC7D9uC,KAAK8mC,cAAgB9mC,KAAKs/C,SAASnP,cAAgBnwC,KAAK2+C,WAAc,EAAI/xC,KAAKuU,GAAM,GAE7F,CAKQ,mBAAAu+B,GACJ,GAAK1/C,KAAKo/C,WAGV,OAAQp/C,KAAKo/C,WAAWn7C,MACpB,KAAK4lC,EAAW+V,YACZ5/C,KAAKsM,MAAQ,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC5BxL,KAAKgvC,gBACLhvC,KAAK6/C,gBAAkB,CAAEv0C,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9C,MAEJ,KAAKq+B,EAAWiW,MACZ9/C,KAAKsM,MAAQ,CAAEhB,EAAG,EAAGC,EAAG,GAAIC,EAAG,IAC/BxL,KAAK6/C,gBAAkB,CAAEv0C,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC1C,MAEJ,KAAKq+B,EAAWkW,OACZ//C,KAAKsM,MAAQ,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAChC,MAEJ,KAAKq+B,EAAWmW,SACZhgD,KAAKsM,MAAQ,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,GAChC,MAEJ,KAAKq+B,EAAWoW,OACZjgD,KAAKsM,MAAQ,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAChC,MAEJ,KAAKq+B,EAAWqW,SACZlgD,KAAKsM,MAAQ,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAChCxL,KAAK6/C,gBAAkB,CAAEv0C,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACtCxL,KAAKkvC,WACLlvC,KAAKmgD,UAAY,CAAE70C,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAExC,MAEJ,KAAKq+B,EAAWuW,SACZpgD,KAAKsM,MAAQ,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAChCxL,KAAK6/C,gBAAkB,CAAEv0C,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC1C,MAEJ,KAAKq+B,EAAWwW,MACZrgD,KAAKsM,MAAQ,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAChCxL,KAAK6/C,gBAAkB,CAAEv0C,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAGtD,CAKQ,gBAAAm0C,CAAiBrU,GAErB,OAAIA,EAAc,KAAc,CAAEhgC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC/C8/B,EAAc,IAAc,CAAEhgC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC/C8/B,EAAc,KAAa,CAAEhgC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC9C8/B,EAAc,IAAa,CAAEhgC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC9C8/B,EAAc,IAAa,CAAEhgC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC9C8/B,EAAc,KAAa,CAAEhgC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC3C,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,GAC9B,CAKQ,wBAAAg0C,GAyBJ,GAxBAx/C,KAAK8+C,iBAAmB,GAGxB9+C,KAAK8+C,iBAAiBn4C,KAAK,CACvB25C,OAAQtgD,KAAK0W,GACbzS,KAAM,QACN+J,OAAsB,EAAdhO,KAAKgO,OACbyC,SAAU,EACV8vC,UAAU,IAIVvgD,KAAKgvC,eACLhvC,KAAK8+C,iBAAiBn4C,KAAK,CACvB25C,OAAQtgD,KAAK0W,GACbzS,KAAM,aACN+J,OAAsB,IAAdhO,KAAKgO,OACbyC,SAAU,EACV8vC,UAAU,EACVC,aAAc,CAAC,oBAKL,SAAdxgD,KAAKiE,KAAiB,CACtB,MAAMw8C,EAAUzgD,KAAK0gD,cACrB1gD,KAAK8+C,iBAAiBn4C,KAAK,CACvB25C,OAAQtgD,KAAK0W,GACbzS,KAAM,UACN+J,OAAQhO,KAAKgO,OACbyC,SAAU,EACV8vC,SAAUE,EACVD,aAAcC,EAAU,GAAK,CAAC,0BAEtC,CACJ,CAKQ,WAAAC,GACJ,MAAkB,SAAd1gD,KAAKiE,OACS,aAAdjE,KAAKiE,QAELjE,KAAKo/C,YAEDp/C,KAAKo/C,WAAWn7C,OAAS4lC,EAAWqW,UACpClgD,KAAKo/C,WAAWn7C,OAAS4lC,EAAWuW,YAKpCpgD,KAAKo/C,WAAW9T,YAAc,MAM1C,CAKQ,iBAAAmU,GAGJ,GAFAz/C,KAAK++C,gBAAkB,GAEL,SAAd/+C,KAAKiE,KAAiB,OAGJjE,KAAK2gD,mBAEbxxC,QAAQyxC,IAClB5gD,KAAK++C,gBAAgBp4C,KAAK,CACtB1C,KAAM28C,EACNC,SAA0B,GAAhBj0C,KAAK2U,SAAiB,GAChCu/B,cAA+B,GAAhBl0C,KAAK2U,SAAiB,GACrCw/B,qBAAsC,GAAhBn0C,KAAK2U,SAAiB,OAKpDvhB,KAAKghD,2BACT,CAKQ,gBAAAL,GACJ,MAAMM,EAAgB,CAAC,QAAS,YAEhC,GAAkB,aAAdjhD,KAAKiE,KACL,MAAO,IAAIg9C,EAAe,cAAe,OAG7C,GAAIjhD,KAAKo/C,WACL,OAAQp/C,KAAKo/C,WAAWn7C,MACpB,KAAK4lC,EAAW+V,YACZ,MAAO,IAAIqB,EAAe,aAAc,eAC5C,KAAKpX,EAAWmW,SACZ,MAAO,IAAIiB,EAAe,SAAU,eACxC,KAAKpX,EAAWoW,OACZ,MAAO,IAAIgB,EAAe,MAAO,gBACrC,KAAKpX,EAAWkW,OACZ,MAAO,IAAIkB,EAAe,UAAW,cACzC,KAAKpX,EAAWiW,MACZ,MAAO,IAAImB,EAAe,YAAa,aAC3C,QACI,OAAOA,EAInB,OAAOA,CACX,CAKQ,yBAAAD,GACJ,GAAkB,SAAdhhD,KAAKiE,KAAiB,OAE1B,IAAIqnC,EAAc,IACd4V,EAAU,EACVC,EAAY,EACZC,EAAU,OACVC,EAAoB,GAEpBrhD,KAAKo/C,aACL9T,EAActrC,KAAKo/C,WAAW9T,YAC9B4V,EAAUt0C,KAAK8D,KAAK1Q,KAAKo/C,WAAWvkC,MAGpCsmC,EAAYnhD,KAAKgvC,cAAgB,GAAM,GAGnChvC,KAAKgvC,gBACkBoS,EAAnB9V,EAAc,IAAe,eACxBA,EAAc,IAAe,SACvB,UAInB+V,EAAoBz0C,KAAKuD,IAAI,GACxBvD,KAAKW,IAAI+9B,EAAc,KAAO,IACN,GAAxB1+B,KAAKW,IAAI2zC,EAAU,GACP,GAAZC,IAITnhD,KAAKshD,kBAAoB,CACrBhW,cACA4V,UACAC,YACAC,UACAC,oBAER,CAKA,MAAA7sC,CAAOC,GAECzU,KAAKuhD,aAAevhD,KAAK0+C,YAAc,IACvC1+C,KAAK4+C,YAAc5+C,KAAK2+C,WAAalqC,EAErCzU,KAAK0a,SAAShO,EAAI1M,KAAKuhD,YAAY70C,EAAIE,KAAKiX,IAAI7jB,KAAK4+C,YAAc5+C,KAAK0+C,YACxE1+C,KAAK0a,SAAS/N,EAAI3M,KAAKuhD,YAAY50C,EAAIC,KAAKqU,IAAIjhB,KAAK4+C,YAAc5+C,KAAK0+C,aAI5E1+C,KAAK6+C,iBAAmB7+C,KAAK8mC,cAAgBryB,EACzCzU,KAAK6+C,gBAAkB,EAAIjyC,KAAKuU,KAChCnhB,KAAK6+C,iBAAmB,EAAIjyC,KAAKuU,IAIjCnhB,KAAKinC,gBACLjnC,KAAKinC,cAAcvsB,SAAW,IAAK1a,KAAK0a,UAEhD,CAKA,MAAA2Y,CAAOC,EAAoBkuB,EAAyBv8C,GAChD,MAAMwL,EAAWzQ,KAAKyhD,gBAAgBD,GAGtC,GAAI/wC,EAAWxL,EAAOy8C,eAAgB,OAGtC,MAAMC,EAAY,CACdj1C,EAAG1M,KAAK0a,SAAShO,EAAI80C,EAAe90C,EAAI,IACxCC,EAAG3M,KAAK0a,SAAS/N,EAAI60C,EAAe70C,EAAI,KAItCi1C,EAAW5hD,KAAKgO,OAChB6zC,EAAaj1C,KAAKoC,IAAI/J,EAAO68C,aAC/Bl1C,KAAKuD,IAAIlL,EAAO88C,aAAcH,GAAY38C,EAAOy8C,eAAiBjxC,KAQtE,GALIxL,EAAO+8C,gBAAkBhiD,KAAKuhD,aAAe9wC,EAAW,KACxDzQ,KAAKiiD,gBAAgB3uB,EAAUkuB,EAAgBv8C,GAI/CjF,KAAKgvC,eAAiBhvC,KAAK6/C,gBAAiB,CAC5C,MAAMqC,EAAwB,IAAbL,EACjBvuB,EAASzlB,WAAW8zC,EAAUj1C,EAAGi1C,EAAUh1C,EAAGu1C,EAAUliD,KAAK6/C,iBAAiB,EAClF,CAGI7/C,KAAKkvC,UAAYlvC,KAAKmgD,WACtBngD,KAAKmiD,YAAY7uB,EAAUquB,EAAWE,GAI1CvuB,EAASzlB,WAAW8zC,EAAUj1C,EAAGi1C,EAAUh1C,EAAGk1C,EAAY7hD,KAAKsM,OAAO,GAGpD,WAAdtM,KAAKiE,MAAqB49C,EAAa,GACvC7hD,KAAKoiD,qBAAqB9uB,EAAUquB,EAAWE,GAIjC,SAAd7hD,KAAKiE,MACLjE,KAAKqiD,eAAe/uB,EAAUquB,EAAWE,GAIzCpxC,EAAWxL,EAAOy8C,eAAiB,GAAK1hD,KAAKg/C,cAC7C1rB,EAASnlB,WAAWnO,KAAKiG,KAAM07C,EAAUj1C,EAAI,GAAIi1C,EAAUh1C,EAAIk1C,EAAa,GACxE,CAAEv2C,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,EAErC,CAKQ,eAAAy2C,CAAgB3uB,EAAoBkuB,EAAyBv8C,GACjE,IAAKjF,KAAKuhD,YAAa,OAEvB,MAAMe,EAAe,CACjB51C,EAAG1M,KAAKuhD,YAAY70C,EAAI80C,EAAe90C,EAAI,IAC3CC,EAAG3M,KAAKuhD,YAAY50C,EAAI60C,EAAe70C,EAAI,KAIzC41C,EAAa,CACfj3C,EAAGsB,KAAKC,MAAqB,GAAf7M,KAAKsM,MAAMhB,GACzBC,EAAGqB,KAAKC,MAAqB,GAAf7M,KAAKsM,MAAMf,GACzBC,EAAGoB,KAAKC,MAAqB,GAAf7M,KAAKsM,MAAMd,IAG7B8nB,EAASzlB,WAAWy0C,EAAa51C,EAAG41C,EAAa31C,EAAG3M,KAAK0+C,YAAa6D,GAAY,EACtF,CAKQ,WAAAJ,CAAY7uB,EAAoBquB,EAAoBt2C,GACxD,IAAKrL,KAAKmgD,UAAW,OAErB,MAAMjS,EAAqB,IAAP7iC,EACd8iC,EAAqB,IAAP9iC,EAGpB,IAAA,IAAS2C,EAASkgC,EAAalgC,EAASmgC,EAAangC,GAAU,EAAG,CAC9D,MAAM+3B,EAAQ,GAAM/3B,EAASkgC,IAAgBC,EAAcD,GAAgB,GACrEiS,EAAY,CACd70C,EAAGsB,KAAKC,MAAM7M,KAAKmgD,UAAU70C,EAAIy6B,GACjCx6B,EAAGqB,KAAKC,MAAM7M,KAAKmgD,UAAU50C,EAAIw6B,GACjCv6B,EAAGoB,KAAKC,MAAM7M,KAAKmgD,UAAU30C,EAAIu6B,IAGrCzS,EAASzlB,WAAW8zC,EAAUj1C,EAAGi1C,EAAUh1C,EAAGqB,EAAQmyC,GAAW,EACrE,CACJ,CAKQ,oBAAAiC,CAAqB9uB,EAAoBquB,EAAoBt2C,GAC3CuB,KAAKC,MAAO7M,KAAK6+C,iBAAmB,EAAIjyC,KAAKuU,IAAO,IAG1E,IAAA,IAAS5U,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,MAAM23B,EAAa,EAAJ33B,EAAQK,KAAKuU,GAAK,EAAKnhB,KAAK6+C,gBACrC2D,EAAWb,EAAUj1C,EAAIE,KAAKiX,IAAIqgB,IAAiB,GAAP74B,GAC5Co3C,EAAWd,EAAUh1C,EAAIC,KAAKqU,IAAIijB,IAAiB,GAAP74B,GAG5Cq3C,EAAe,CACjBp3C,EAAGsB,KAAKoC,IAAI,EAAGhP,KAAKsM,MAAMhB,EAAI,GAC9BC,EAAGqB,KAAKoC,IAAI,EAAGhP,KAAKsM,MAAMf,EAAI,GAC9BC,EAAGoB,KAAKoC,IAAI,EAAGhP,KAAKsM,MAAMd,EAAI,IAGlC8nB,EAAStnB,SAASw2C,EAAW,EAAGC,EAAW,EAAG,EAAG,EAAGC,EACxD,CACJ,CAKQ,cAAAL,CAAe/uB,EAAoBquB,EAAoBt2C,GAE3D,MAAM46B,EAAY,CACd36B,EAAGsB,KAAKuD,IAAI,GAAInQ,KAAKsM,MAAMhB,EAAI,IAC/BC,EAAGqB,KAAKuD,IAAI,GAAInQ,KAAKsM,MAAMf,EAAI,IAC/BC,EAAGoB,KAAKuD,IAAI,GAAInQ,KAAKsM,MAAMd,EAAI,KAGnC8nB,EAASzlB,WAAW8zC,EAAUj1C,EAAGi1C,EAAUh1C,EAAU,IAAPtB,EAAY46B,GAAW,EACzE,CAKA,gBAAA0c,CAAiB7f,GACb,MAAMryB,EAAWzQ,KAAKyhD,gBAAgB3e,GAGtC,IAAA,MAAWjsB,KAAQ7W,KAAK8+C,iBACpB,GAAIruC,GAAYoG,EAAK7I,OAEjB,OADA6I,EAAKpG,SAAWA,EACToG,EAIf,OAAO,IACX,CAKA,aAAA+rC,CAAc9f,EAAuB+f,EAA2B,GAC5D,MAAMC,EAAc9iD,KAAK2iD,iBAAiB7f,GAE1C,IAAKggB,GAAoC,YAArBA,EAAY7+C,KAC5B,OAAO,KAIX,MAAM8+C,EAAqB/iD,KAAK++C,gBAAgB/2C,OAAOg7C,GACnDA,EAAQnC,SAAW7gD,KAAKm/C,mBAG5B,GAAkC,IAA9B4D,EAAmBn8C,OACnB,OAAO,KAGX,MAAMq8C,EAAWF,EAAmB,GAC9BG,EAAoBD,EAASpC,SAAWoC,EAASnC,cAAgB+B,EAMvE,OAHAI,EAASpC,SAAWj0C,KAAKoC,IAAI,EAAGi0C,EAASpC,SAAW,KACpD7gD,KAAKm/C,kBAAoBvyC,KAAKuD,IAAI,EAAGnQ,KAAKm/C,kBAAoB,KAEvD,CACHyB,aAAcqC,EAASh/C,KACvBk/C,SAAUD,EACVE,QAASH,EAASnC,cAClBuC,UAAWrjD,KAAKm/C,kBAExB,CAKA,WAAAmE,GAGI,OAFAtjD,KAAKi/C,WAAY,EAEV,CACH5Q,YAAaruC,KAAK2gD,mBAClB4C,WAAYvjD,KAAKwjD,eACjBlC,kBAAmBthD,KAAKshD,kBACxBmC,gBAAiBzjD,KAAKo/C,YAAY3P,UAAW,EAC7CiU,UAAW,GACX3E,gBAAiB,IAAI/+C,KAAK++C,iBAElC,CAKA,eAAA0C,CAAgB/mC,GACZ,MAAMpN,EAAKtN,KAAK0a,SAAShO,EAAIgO,EAAShO,EAChCc,EAAKxN,KAAK0a,SAAS/N,EAAI+N,EAAS/N,EACtC,OAAOC,KAAK8D,KAAKpD,EAAKA,EAAKE,EAAKA,EACpC,CAKA,QAAAm2C,CAAS5mC,EAAiB/O,EAAgBwM,GACtCxa,KAAKuhD,YAAc,IAAKxkC,GACxB/c,KAAK0+C,YAAc1wC,EACnBhO,KAAK2+C,WAAankC,CACtB,CAKA,kBAAAopC,GACI,IAAK5jD,KAAKg/C,aAAc,MAAO,iBAE/B,IAAIp5C,EAAO,GAAG5F,KAAKiG,SAASjG,KAAKiE,KAAKyqB,iBAWtC,OATI1uB,KAAKshD,oBACL17C,GAAQ,WAAW5F,KAAKshD,kBAAkBhW,YAAYjiC,QAAQ,MAC9DzD,GAAQ,cAAc5F,KAAKshD,kBAAkBJ,QAAQ73C,QAAQ,MAEzDrJ,KAAK++C,gBAAgBn4C,OAAS,IAC9BhB,GAAQ,gBAAgB5F,KAAK++C,gBAAgBn4C,iBAI9ChB,CACX,ECroBG,MAAMi+C,EA6BT,WAAA/+C,CACIG,EAA0C,GAC1Ci0C,EAAkC,CAAA,GA1BtCl5C,KAAQ8jD,WAAqB,EAC7B9jD,KAAQ+jD,YAAoC,KAC5C/jD,KAAQgkD,YAAsC,KAC9ChkD,KAAQikD,QAAkB,EAC1BjkD,KAAQkkD,cAAwB,EAGhClkD,KAAQmkD,OAAiB,EACzBnkD,KAAQokD,OAAiB,EACzBpkD,KAAQu6C,WAAqB,EAC7Bv6C,KAAQi6C,YAAsB,EAG9Bj6C,KAAQmX,QAA+B,GACvCnX,KAAQqkD,cAA+B,KACvCrkD,KAAQskD,eAAgC,KAGxCtkD,KAAQukD,SAAmB,GAC3BvkD,KAAQwkD,SAA8B,KACtCxkD,KAAQykD,cAAgC,GAQpCzkD,KAAKgJ,OAAS,IAAIO,EAAO,oBACzBvJ,KAAKk5C,aAAeA,EAEpBl5C,KAAKiF,OAAS,CACVy/C,kBAAkB,EAClBC,UAAW,EACXniD,SAAU,IACVC,UAAW,OACRwC,GAGPjF,KAAKgJ,OAAOpD,KAAK,mCACrB,CAKA,eAAAg/C,CAAgBC,EAAqBhuC,EAAuBisB,GACxD9iC,KAAK+jD,YAAcc,EACnB7kD,KAAKgkD,YAAcntC,EACnB7W,KAAKukD,SAAWM,EAAKjB,qBAGrB5jD,KAAK8kD,uBAAuBD,EAAKnqC,SAAUooB,GAG3C9iC,KAAK+kD,eAGL/kD,KAAKkkD,cAAgB,EACrBlkD,KAAK8jD,WAAY,EAEjB9jD,KAAKgJ,OAAOxD,MAAM,2BAA2Bq/C,EAAK5+C,OAAQ,CACtDhC,KAAM4S,EAAK5S,KACXs8C,SAAU1pC,EAAK0pC,UAEvB,CAKA,eAAAyE,GACIhlD,KAAKkkD,cAAgB,EAGrBx4B,WAAW,KACoB,IAAvB1rB,KAAKkkD,gBACLlkD,KAAK8jD,WAAY,EACjB9jD,KAAK+jD,YAAc,KACnB/jD,KAAKgkD,YAAc,KACnBhkD,KAAKwkD,SAAW,KAChBxkD,KAAKykD,cAAgB,KAE1BzkD,KAAKiF,OAAOy/C,iBAAmB,IAAM,GAExC1kD,KAAKgJ,OAAOxD,MAAM,2BACtB,CAKQ,sBAAAs/C,CAAuBG,EAAuBniB,GAElD,MAAMoiB,EAAcD,EAAav4C,EAAIo2B,EAAap2B,EAAI,IAChDy4C,EAAcF,EAAat4C,EAAIm2B,EAAan2B,EAAI,IAGtD3M,KAAKu6C,WAAa3tC,KAAKuD,IAAInQ,KAAKiF,OAAOzC,SAAU,KACjDxC,KAAKi6C,YAAcrtC,KAAKuD,IAAInQ,KAAKiF,OAAOxC,UAAW,KAGnDzC,KAAKmkD,OAASe,EAAc,GAC5BllD,KAAKokD,OAASe,EAAcnlD,KAAKi6C,YAAc,EAG3Cj6C,KAAKmkD,OAASnkD,KAAKu6C,WAAa,OAChCv6C,KAAKmkD,OAASe,EAAcllD,KAAKu6C,WAAa,IAG9Cv6C,KAAKokD,OAAS,KAAIpkD,KAAKokD,OAAS,IAChCpkD,KAAKokD,OAASpkD,KAAKi6C,YAAc,MACjCj6C,KAAKokD,OAAS,IAAMpkD,KAAKi6C,YAEjC,CAKQ,YAAA8K,GAGJ,GAFA/kD,KAAKmX,QAAU,IAEVnX,KAAKgkD,cAAgBhkD,KAAK+jD,YAAa,OAE5C,MACMqB,EAAe,GAErB,IAAIC,EAAWrlD,KAAKokD,OAAS,GAGC,UAA1BpkD,KAAKgkD,YAAY//C,MAAoBjE,KAAKgkD,YAAYzD,WACtDvgD,KAAKmX,QAAQxQ,KAAK,CACd+P,GAAI,cACJukC,MAAO,cACPvuC,EAAG1M,KAAKmkD,OAAS,GACjBx3C,EAAG04C,EACH56C,MAZY,GAaZC,OAAQ06C,EACRv3B,SAAS,EACTvhB,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,MAE9B65C,GAAYD,IAIc,YAA1BplD,KAAKgkD,YAAY//C,MAAsBjE,KAAKgkD,YAAYzD,WACxDvgD,KAAKmX,QAAQxQ,KAAK,CACd+P,GAAI,OACJukC,MAAO,OACPvuC,EAAG1M,KAAKmkD,OAAS,GACjBx3C,EAAG04C,EACH56C,MA3BY,GA4BZC,OAAQ06C,EACRv3B,SAAS,EACTvhB,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,MAE9B65C,GAAYD,IAIhBplD,KAAKmX,QAAQxQ,KAAK,CACd+P,GAAI,OACJukC,MAAO,OACPvuC,EAAG1M,KAAKmkD,OAAS,IACjBx3C,EAAG3M,KAAKokD,OAAS,GACjB35C,MAzCgB,GA0ChBC,OAAQ06C,EACRv3B,SAAS,EACTvhB,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,MAIA,YAA1BxL,KAAKgkD,YAAY//C,MAAgD,eAA1BjE,KAAKgkD,YAAY//C,MACpDjE,KAAK+jD,YAAYhF,gBAAgBn4C,OAAS,GAC1C5G,KAAKmX,QAAQxQ,KAAK,CACd+P,GAAI,OACJukC,MAAO,OACPvuC,EAAG1M,KAAKmkD,OAAS,IACjBx3C,EAAG3M,KAAKokD,OAAS,IACjB35C,MAvDQ,GAwDRC,OAAQ06C,EACRv3B,QAAS7tB,KAAK+jD,YAAY5E,kBAAoB,GAC9C7yC,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,MAMtCxL,KAAKmX,QAAQxQ,KAAK,CACd+P,GAAI,WACJukC,MAAO,WACPvuC,EAAG1M,KAAKmkD,OAAS,GACjBx3C,EAAG3M,KAAKokD,OAASpkD,KAAKi6C,YAAc,GACpCxvC,MAAOzK,KAAKu6C,WAAa,GACzB7vC,OAAQ06C,EACRv3B,SAAS,EACTvhB,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAElC,CAKA,MAAAgJ,CAAOC,EAAmB9R,IACjB3C,KAAK8jD,WAAoC,IAAvB9jD,KAAKkkD,iBAGxBlkD,KAAKiF,OAAOy/C,iBACR1kD,KAAKikD,QAAUjkD,KAAKkkD,cACpBlkD,KAAKikD,QAAUr3C,KAAKuD,IAAInQ,KAAKkkD,cAAelkD,KAAKikD,QAAUjkD,KAAKiF,OAAO0/C,UAAYlwC,GAC5EzU,KAAKikD,QAAUjkD,KAAKkkD,gBAC3BlkD,KAAKikD,QAAUr3C,KAAKoC,IAAIhP,KAAKkkD,cAAelkD,KAAKikD,QAAUjkD,KAAKiF,OAAO0/C,UAAYlwC,IAGvFzU,KAAKikD,QAAUjkD,KAAKkkD,cAIpBlkD,KAAK8jD,WAAa9jD,KAAKikD,QAAU,IACjCjkD,KAAKmtB,YAAYxqB,GAEzB,CAKQ,WAAAwqB,CAAYxqB,GAChB,MAAMu4C,EAAWv4C,EAAMyV,mBAGvBpY,KAAKqkD,cAAgB,KACrB,IAAA,MAAWpuC,KAAUjW,KAAKmX,QACtB,GAAInX,KAAKslD,gBAAgBpK,EAAUjlC,GAAS,CACxCjW,KAAKqkD,cAAgBpuC,EAAOS,GAC5B,KACJ,CAIA/T,EAAMwV,qBAAqB,IAAMnY,KAAKqkD,eACtCrkD,KAAKw7C,kBAAkBx7C,KAAKqkD,eAI5B1hD,EAAMqV,aAAa,QACnBhY,KAAKw7C,kBAAkB,eAChB74C,EAAMqV,aAAa,QAC1BhY,KAAKw7C,kBAAkB,QAChB74C,EAAMqV,aAAa,QAC1BhY,KAAKw7C,kBAAkB,QAChB74C,EAAMqV,aAAa,QAC1BhY,KAAKw7C,kBAAkB,SAChB74C,EAAMqV,aAAa,SAAWrV,EAAMqV,aAAa,YACxDhY,KAAKw7C,kBAAkB,WAE/B,CAKQ,eAAA8J,CAAgB3pC,EAAgB1F,GACpC,OAAO0F,EAAMjP,GAAKuJ,EAAOvJ,GAClBiP,EAAMjP,GAAKuJ,EAAOvJ,EAAIuJ,EAAOxL,OAC7BkR,EAAMhP,GAAKsJ,EAAOtJ,GAClBgP,EAAMhP,GAAKsJ,EAAOtJ,EAAIsJ,EAAOvL,MACxC,CAKQ,iBAAA8wC,CAAkB+J,GACtB,IAAKvlD,KAAK+jD,YAAa,OAEvB,MAAM9tC,EAASjW,KAAKmX,QAAQgb,KAAK3mB,GAAKA,EAAEkL,KAAO6uC,GAC/C,GAAKtvC,GAAWA,EAAO4X,QAEvB,OAAQ03B,GACJ,IAAK,cACDvlD,KAAKk5C,aAAasM,eAAexlD,KAAK+jD,YAAYrtC,IAClD1W,KAAKgJ,OAAOpD,KAAK,6BAA6B5F,KAAK+jD,YAAY99C,QAC/DjG,KAAKglD,kBACL,MAEJ,IAAK,OACDhlD,KAAKk5C,aAAauM,SAASzlD,KAAK+jD,YAAYrtC,IAC5C1W,KAAKgJ,OAAOpD,KAAK,iBAAiB5F,KAAK+jD,YAAY99C,QACnDjG,KAAKglD,kBACL,MAEJ,IAAK,OACDhlD,KAAKsjD,cACL,MAEJ,IAAK,OACDtjD,KAAK4iD,gBACL,MAEJ,IAAK,WACD5iD,KAAKk5C,aAAawM,qBAClB1lD,KAAKglD,kBAGjB,CAKQ,WAAA1B,GACCtjD,KAAK+jD,cAEV/jD,KAAKwkD,SAAWxkD,KAAK+jD,YAAYT,cACjCtjD,KAAK+jD,YAAY/E,cAAe,EAEhCh/C,KAAKk5C,aAAayM,gBAAgB3lD,KAAK+jD,YAAYrtC,IAEnD1W,KAAKgJ,OAAOpD,KAAK,cAAc5F,KAAK+jD,YAAY99C,OAAQ,CACpDooC,YAAaruC,KAAKwkD,SAASnW,YAC3BoV,gBAAiBzjD,KAAKwkD,SAASf,kBAInCzjD,KAAKukD,SAAWvkD,KAAK+jD,YAAYH,qBACrC,CAKQ,aAAAhB,GACJ,IAAK5iD,KAAK+jD,YAAa,OAEvB,MACMz6C,EAAStJ,KAAK+jD,YAAYnB,cADX,CAAEl2C,EAAG,EAAGC,EAAG,GAC4B,GAE5D,GAAIrD,IACAtJ,KAAKykD,cAAc99C,KAAK2C,GACxBtJ,KAAKk5C,aAAa0M,gBAAgB5lD,KAAK+jD,YAAYrtC,IAEnD1W,KAAKgJ,OAAOpD,KAAK,YAAY0D,EAAO65C,SAAS95C,QAAQ,MAAMC,EAAOs3C,eAAgB,CAC9EwC,QAAS95C,EAAO85C,QAChBC,UAAW/5C,EAAO+5C,YAIlB/5C,EAAO+5C,UAAY,IAAK,CACxB,MAAMwC,EAAa7lD,KAAKmX,QAAQgb,KAAK3mB,GAAc,SAATA,EAAEkL,IACxCmvC,IACAA,EAAWh4B,SAAU,EACrBg4B,EAAWv5C,MAAQ,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAE9C,CAER,CAKA,MAAA6nB,CAAOC,GACH,IAAKtzB,KAAK8jD,WAAa9jD,KAAKikD,SAAW,EAAG,OAG1C,MAAMle,EAAQ/lC,KAAKikD,QAGbjG,EAAU,CACZ1yC,EAAGsB,KAAKC,MAAM,EAAIk5B,GAClBx6B,EAAGqB,KAAKC,MAAM,GAAKk5B,GACnBv6B,EAAGoB,KAAKC,MAAM,EAAIk5B,IAEtBzS,EAAStnB,SAAShM,KAAKmkD,OAAQnkD,KAAKokD,OAAQpkD,KAAKu6C,WAAYv6C,KAAKi6C,YAAa+D,GAG/E,MAAM8H,EAAc,CAChBx6C,EAAGsB,KAAKC,MAAM,GAAKk5B,GACnBx6B,EAAGqB,KAAKC,MAAM,GAAKk5B,GACnBv6B,EAAGoB,KAAKC,MAAM,GAAKk5B,IAEvB/lC,KAAK+lD,kBAAkBzyB,EAAUwyB,GAGjC,MAAMjyB,EAAa,CACfvoB,EAAGsB,KAAKC,MAAM,GAAKk5B,GACnBx6B,EAAGqB,KAAKC,MAAM,GAAKk5B,GACnBv6B,EAAGoB,KAAKC,MAAM,GAAKk5B,IAEvBzS,EAASnlB,WAAW,kBAAmBnO,KAAKmkD,OAAS,GAAInkD,KAAKokD,OAAS,GAAIvwB,EAAY,IAGnF7zB,KAAKukD,UACLvkD,KAAKgmD,eAAe1yB,EAAUyS,GAI9B/lC,KAAKwkD,UACLxkD,KAAKimD,eAAe3yB,EAAUyS,GAI9B/lC,KAAKykD,cAAc79C,OAAS,GAC5B5G,KAAKkmD,oBAAoB5yB,EAAUyS,GAIvC/lC,KAAK8zB,cAAcR,EAAUyS,GAG7B/lC,KAAK48C,iBAAiBtpB,EAAUyS,EACpC,CAKQ,iBAAAggB,CAAkBzyB,EAAoBhnB,GAE1CgnB,EAAStnB,SAAShM,KAAKmkD,OAAQnkD,KAAKokD,OAAQpkD,KAAKu6C,WAAY,EAAGjuC,GAChEgnB,EAAStnB,SAAShM,KAAKmkD,OAAQnkD,KAAKokD,OAASpkD,KAAKi6C,YAAc,EAAGj6C,KAAKu6C,WAAY,EAAGjuC,GAGvFgnB,EAAStnB,SAAShM,KAAKmkD,OAAQnkD,KAAKokD,OAAQ,EAAGpkD,KAAKi6C,YAAa3tC,GACjEgnB,EAAStnB,SAAShM,KAAKmkD,OAASnkD,KAAKu6C,WAAa,EAAGv6C,KAAKokD,OAAQ,EAAGpkD,KAAKi6C,YAAa3tC,GAGvF,MAAM65C,EAAiB,CAAE76C,EAAGgB,EAAMhB,EAAI,EAAGC,EAAGe,EAAMf,EAAI,EAAGC,EAAGc,EAAMd,EAAI,GACtE8nB,EAAStnB,SAAShM,KAAKmkD,OAAQnkD,KAAKokD,OAAQ,EAAG,EAAG+B,GAClD7yB,EAAStnB,SAAShM,KAAKmkD,OAAQnkD,KAAKokD,OAAQ,EAAG,EAAG+B,EACtD,CAKQ,cAAAH,CAAe1yB,EAAoByS,GACvC,MAAMh3B,EAAY,CACdzD,EAAGsB,KAAKC,MAAM,GAAKk5B,GACnBx6B,EAAGqB,KAAKC,MAAM,GAAKk5B,GACnBv6B,EAAGoB,KAAKC,MAAM,GAAKk5B,IAGjBj3B,EAAQ9O,KAAKukD,SAAShQ,MAAM,MAClC,IAAI5nC,EAAI3M,KAAKokD,OAAS,GAEtBt1C,EAAMK,QAAQD,IACVokB,EAASnlB,WAAWe,EAAMlP,KAAKmkD,OAAS,GAAIx3C,EAAGoC,EAAW,GAC1DpC,GAAK,IAEb,CAKQ,cAAAs5C,CAAe3yB,EAAoByS,GACvC,IAAK/lC,KAAKwkD,SAAU,OAEpB,MAAMz1C,EAAY,CACdzD,EAAGsB,KAAKC,MAAM,GAAKk5B,GACnBx6B,EAAGqB,KAAKC,MAAM,GAAKk5B,GACnBv6B,EAAGoB,KAAKC,MAAM,GAAKk5B,IAGvB,IAAIp5B,EAAI3M,KAAKokD,OAAS,GAEtB9wB,EAASnlB,WAAW,SAASnO,KAAKwkD,SAASnW,YAAY+X,KAAK,QACxDpmD,KAAKmkD,OAAS,GAAIx3C,EAAGoC,EAAW,GACpCpC,GAAK,GAED3M,KAAKwkD,SAASf,kBACdnwB,EAASnlB,WAAW,gBAAiBnO,KAAKmkD,OAAS,GAAIx3C,EACnD,CAAErB,EAAGsB,KAAKC,MAAM,GAAKk5B,GAAQx6B,EAAGqB,KAAKC,MAAM,GAAKk5B,GAAQv6B,EAAGoB,KAAKC,MAAM,GAAKk5B,IAAU,GACzFp5B,GAAK,IAGT2mB,EAASnlB,WAAW,aAAanO,KAAKwkD,SAASzF,gBAAgBn4C,SAC3D5G,KAAKmkD,OAAS,GAAIx3C,EAAGoC,EAAW,EACxC,CAKQ,mBAAAm3C,CAAoB5yB,EAAoByS,GAC5C,MAAMh3B,EAAY,CACdzD,EAAGsB,KAAKC,MAAM,GAAKk5B,GACnBx6B,EAAGqB,KAAKC,MAAM,GAAKk5B,GACnBv6B,EAAGoB,KAAKC,MAAM,GAAKk5B,IAGjBsgB,EAAarmD,KAAKykD,cAAczkD,KAAKykD,cAAc79C,OAAS,GAC5D+F,EAAI3M,KAAKokD,OAASpkD,KAAKi6C,YAAc,GAE3C3mB,EAASnlB,WAAW,UAAUk4C,EAAWlD,SAAS95C,QAAQ,MAAMg9C,EAAWzF,eACvE5gD,KAAKmkD,OAAS,GAAIx3C,EAAGoC,EAAW,EACxC,CAKQ,aAAA+kB,CAAcR,EAAoByS,GACtC/lC,KAAKmX,QAAQhI,QAAQ8G,IACjB,MAAMioC,EAAYl+C,KAAKqkD,gBAAkBpuC,EAAOS,GAC1C4vC,EAAcrwC,EAAO4X,QAAUkY,EAAgB,GAARA,EAGvCiY,EAAUE,EACZ,CACI5yC,EAAGsB,KAAKC,OAAOoJ,EAAO3J,MAAMhB,EAAI,IAAMg7C,GACtC/6C,EAAGqB,KAAKC,OAAOoJ,EAAO3J,MAAMf,EAAI,IAAM+6C,GACtC96C,EAAGoB,KAAKC,OAAOoJ,EAAO3J,MAAMd,EAAI,IAAM86C,IAE1C,CACIh7C,EAAGsB,KAAKC,MAAMoJ,EAAO3J,MAAMhB,EAAIg7C,GAC/B/6C,EAAGqB,KAAKC,MAAMoJ,EAAO3J,MAAMf,EAAI+6C,GAC/B96C,EAAGoB,KAAKC,MAAMoJ,EAAO3J,MAAMd,EAAI86C,IAGvChzB,EAAStnB,SAASiK,EAAOvJ,EAAGuJ,EAAOtJ,EAAGsJ,EAAOxL,MAAOwL,EAAOvL,OAAQszC,GAGnE,MAAM8H,EAAc,CAChBx6C,EAAGsB,KAAKC,OAAOoJ,EAAO3J,MAAMhB,EAAI,IAAMg7C,GACtC/6C,EAAGqB,KAAKC,OAAOoJ,EAAO3J,MAAMf,EAAI,IAAM+6C,GACtC96C,EAAGoB,KAAKC,OAAOoJ,EAAO3J,MAAMd,EAAI,IAAM86C,IAE1ChzB,EAASrmB,SAASgJ,EAAOvJ,EAAGuJ,EAAOtJ,EAAGsJ,EAAOvJ,EAAIuJ,EAAOxL,MAAOwL,EAAOtJ,EAAGm5C,GACzExyB,EAASrmB,SAASgJ,EAAOvJ,EAAGuJ,EAAOtJ,EAAGsJ,EAAOvJ,EAAGuJ,EAAOtJ,EAAIsJ,EAAOvL,OAAQo7C,GAG1E,MAAM/2C,EAAYkH,EAAO4X,QACrB,CACIviB,EAAGsB,KAAKC,MAAM,GAAKk5B,GACnBx6B,EAAGqB,KAAKC,MAAM,GAAKk5B,GACnBv6B,EAAGoB,KAAKC,MAAM,GAAKk5B,IAEvB,CACIz6B,EAAGsB,KAAKC,MAAM,GAAKk5B,GACnBx6B,EAAGqB,KAAKC,MAAM,GAAKk5B,GACnBv6B,EAAGoB,KAAKC,MAAM,GAAKk5B,IAGrBpR,EAAQ1e,EAAOvJ,GAAKuJ,EAAOxL,MAA8B,EAAtBwL,EAAOglC,MAAMr0C,QAAc,EAC9D2/C,EAAQtwC,EAAOtJ,GAAKsJ,EAAOvL,OAAS,GAAK,EAC/C4oB,EAASnlB,WAAW8H,EAAOglC,MAAOtmB,EAAO4xB,EAAOx3C,EAAW,IAEnE,CAKQ,gBAAA6tC,CAAiBtpB,EAAoByS,GAEzC,IAAA,IAASp5B,EAAI3M,KAAKokD,OAAQz3C,EAAI3M,KAAKokD,OAASpkD,KAAKi6C,YAAattC,GAAK,EAAG,CAClE,MAAM65C,EAAgB,CAClBl7C,EAAGsB,KAAKC,MAAM,EAAIk5B,GAClBx6B,EAAGqB,KAAKC,MAAM,EAAIk5B,GAClBv6B,EAAGoB,KAAKC,MAAM,EAAIk5B,IAEtBzS,EAAStnB,SAAShM,KAAKmkD,OAAQx3C,EAAG3M,KAAKu6C,WAAY,EAAGiM,EAC1D,CACJ,CAKA,oBAAAC,GACI,OAAOzmD,KAAK8jD,SAChB,CAKA,cAAA4C,GACI,OAAO1mD,KAAK+jD,WAChB,ECtkBG,MAAM4C,EAmBT,WAAA7hD,CACIG,EAA0C,GAC1C2hD,EAAuC,CAAA,GApB3C5mD,KAAQ6mD,WAAyC/9C,IAKjD9I,KAAQ62B,cAAuC,KAC/C72B,KAAQ8mD,aAAwB,CAAEp6C,EAAG,IAAKC,EAAG,KAG7C3M,KAAQ+mD,aAAgC,GACxC/mD,KAAQgnD,mBAA4E,KAGpFhnD,KAAQu7B,eAAyB,EACjCv7B,KAAQinD,WAAqB,EAQzBjnD,KAAKgJ,OAAS,IAAIO,EAAO,oBAEzBvJ,KAAKiF,OAAS,CACVy8C,eAAgB,IAChBwF,oBAAqB,IACrBlF,gBAAgB,EAChBmF,oBAAoB,EACpBC,oBAAqB,CACjB1F,eAAgB,IAChB2F,iBAAkB,GAClBrF,gBAAgB,EAChBsF,eAAgB,EAChBxF,aAAc,EACdC,aAAc,OAEf98C,GAIPjF,KAAKunD,iBAAmB,IAAI1D,EAAiB,CACzCa,kBAAkB,EAClBC,UAAW,EACXniD,SAAU,IACVC,UAAW,KACZmkD,GAEH5mD,KAAKgJ,OAAOpD,KAAK,mCAAoC,CACjD87C,eAAgB1hD,KAAKiF,OAAOy8C,eAC5ByF,mBAAoBnnD,KAAKiF,OAAOkiD,oBAExC,CAKA,UAAAK,CAAWC,GACPznD,KAAKgJ,OAAOpD,KAAK,2BAA2B6hD,EAAaC,WAAWzhD,QAGpEjG,KAAK2nD,cAGL3nD,KAAK62B,cAAgB4wB,EAAaC,WAClC1nD,KAAK8mD,aAAeW,EAAajG,eAGjCxhD,KAAK4nD,WAAWH,EAAaC,WAAWvc,MAGxCsc,EAAaC,WAAWhtB,QAAQvrB,QAAQ,CAACiwC,EAAYtyC,KACjD9M,KAAKke,aAAakhC,EAAYtyC,KAIlC26C,EAAaC,WAAWhtB,QAAQvrB,QAAQiwC,IAChCA,EAAWjQ,OAASiQ,EAAWjQ,MAAMvoC,OAAS,GAC9Cw4C,EAAWjQ,MAAMhgC,QAAQmwC,IACrBt/C,KAAK6nD,WAAWvI,EAAUF,OAMtCp/C,KAAK8nD,wBAEL9nD,KAAKgJ,OAAOpD,KAAK,oBAAoB5F,KAAK6mD,OAAOx7C,gCACrD,CAKQ,UAAAu8C,CAAWvI,GACf,MAAMlU,EAAO,IAAIsT,EAAc,CAC3B/nC,GAAI2oC,EAAS3oC,GACbzQ,KAAMo5C,EAASp5C,KACfhC,KAAM,OACNyW,SAAU,IAAK1a,KAAK8mD,cACpB94C,OAAQpB,KAAKuD,IAAsB,GAAlBkvC,EAASrxC,OAAa,IACvC6M,KAAsB,IAAhBwkC,EAASxkC,KACfvO,MAAOtM,KAAK6sC,aAAawS,EAAS/T,aAClC+T,aAIJlU,EAAK6T,cAAe,EAEpBh/C,KAAK6mD,OAAO99C,IAAIoiC,EAAKz0B,GAAIy0B,GACzBnrC,KAAKgJ,OAAOxD,MAAM,mBAAmB2lC,EAAKllC,OAC9C,CAKQ,YAAA4mC,CAAavB,GAEjB,OAAIA,EAAc,KAAc,CAAEhgC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC/C8/B,EAAc,IAAc,CAAEhgC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC/C8/B,EAAc,KAAa,CAAEhgC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC9C8/B,EAAc,IAAa,CAAEhgC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC9C8/B,EAAc,IAAa,CAAEhgC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC9C8/B,EAAc,KAAa,CAAEhgC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC3C,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,GAC9B,CAKQ,YAAA0S,CAAakhC,EAAwBtyC,GAEzC,MAAMo3B,EAASp3B,EAAQF,KAAKuU,GAAK,GAAMnhB,KAAK62B,eAAe6D,QAAQ9zB,QAAU,GACvE2nC,EAAgB,IAAkC,GAA3B6Q,EAAW7Q,cAElC7zB,EAAW,CACbhO,EAAG1M,KAAK8mD,aAAap6C,EAAIE,KAAKiX,IAAIqgB,GAASqK,EAC3C5hC,EAAG3M,KAAK8mD,aAAan6C,EAAIC,KAAKqU,IAAIijB,GAASqK,GAGzCpV,EAAS,IAAIslB,EAAc,CAC7B/nC,GAAI0oC,EAAW1oC,GACfzQ,KAAMm5C,EAAWn5C,KACjBhC,KAAM,SACNyW,WACA1M,OAAQpB,KAAKoC,IAAwB,GAApBowC,EAAWpxC,OAAa,IACzC6M,KAAwB,IAAlBukC,EAAWvkC,KACjBvO,MAAOtM,KAAK+nD,eAAe3I,GAC3BA,eAIJjmB,EAAOwqB,SACH,IAAK3jD,KAAK8mD,cACVvY,EACA,EAAI3hC,KAAKuU,IAAMi+B,EAAWtQ,YAAc,OAG5C9uC,KAAK6mD,OAAO99C,IAAIowB,EAAOziB,GAAIyiB,GAC3Bn5B,KAAKgJ,OAAOxD,MAAM,sBAAsB2zB,EAAOlzB,OACnD,CAKQ,cAAA8hD,CAAe3I,GAGnB,OADoBA,EAAWhQ,aAE3B,IAAK,QAML,IAAK,QAAS,MAAO,CAAE9jC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IALxC,IAAK,SAAU,MAAO,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACzC,IAAK,QAAS,MAAO,CAAEF,EAAG,EAAGC,EAAG,GAAIC,EAAG,IACvC,IAAK,MAAO,MAAO,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACtC,IAAK,OAAQ,MAAO,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,GACvC,IAAK,MAAO,MAAO,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAEtC,IAAK,cAAe,MAAO,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC9C,QAAS,MAAO,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAE3C,CAKQ,UAAAq8C,CAAWvI,EAAe0I,GAC9B,MAAMC,EAAajoD,KAAK6mD,OAAO39C,IAAI8+C,EAAatxC,IAChD,IAAKuxC,EAAY,OAGjB,MAAM/jB,EAAQt3B,KAAK2U,SAAW3U,KAAKuU,GAAK,EAClCotB,EAAyC,EAAzB+Q,EAAS/Q,cAEzB7zB,EAAW,CACbhO,EAAGu7C,EAAWvtC,SAAShO,EAAIE,KAAKiX,IAAIqgB,GAASqK,EAC7C5hC,EAAGs7C,EAAWvtC,SAAS/N,EAAIC,KAAKqU,IAAIijB,GAASqK,GAG3C2Z,EAAO,IAAIzJ,EAAc,CAC3B/nC,GAAI4oC,EAAS5oC,GACbzQ,KAAMq5C,EAASr5C,KACfhC,KAAM,OACNyW,WACA1M,OAAQpB,KAAKoC,IAAsB,EAAlBswC,EAAStxC,OAAY,GACtC6M,KAAsB,IAAhBykC,EAASzkC,KACfvO,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC1B8zC,aAIJ4I,EAAKvE,SACD,IAAKsE,EAAWvtC,UAChB6zB,EACA,EAAI3hC,KAAKuU,IAAMm+B,EAASxQ,YAAc,KAG1C9uC,KAAK6mD,OAAO99C,IAAIm/C,EAAKxxC,GAAIwxC,GACzBloD,KAAKgJ,OAAOxD,MAAM,oBAAoB0iD,EAAKjiD,gBAAgB+hD,EAAa/hD,QAC5E,CAKQ,qBAAA6hD,GAEJ9nD,KAAK6mD,OAAO13C,QAAQ01C,IAChB,GAAkB,SAAdA,EAAK5gD,MAAmB4gD,EAAKvF,SAAU,CACvC,MAAM0I,EAAe3xC,MAAMC,KAAKtW,KAAK6mD,OAAOluC,UAAUwZ,KAAKgH,GACvC,WAAhBA,EAAOl1B,MAAqBk1B,EAAOimB,YAAYjQ,OAAOlc,KAAKi1B,GAAQA,EAAKxxC,KAAOmuC,EAAKnuC,KAGxF,GAAIsxC,EAAc,CAEd,MAAMG,EAAmBtD,EAAKlB,SAASyE,KAAKvD,GAC5CA,EAAKlB,SAAW,CAAC5mC,EAAQ/O,EAAQwM,KAE7B2tC,EAAiBH,EAAattC,SAAU1M,EAAQwM,GAExD,CACJ,GAER,CAKA,MAAAhG,CAAOC,EAAmB9R,EAAqBmgC,GAC3C9iC,KAAKu7B,eAAiB9mB,EACtBzU,KAAKinD,aAGLjnD,KAAK6mD,OAAO13C,QAAQ01C,IAChBA,EAAKrwC,OAAOC,KAIZzU,KAAKiF,OAAOkiD,oBACZnnD,KAAKqoD,mBAAmBvlB,EAAcngC,GAI1C3C,KAAKunD,iBAAiB/yC,OAAOC,EAAW9R,EAC5C,CAKQ,kBAAA0lD,CAAmBvlB,EAAuBngC,GAE9C3C,KAAK+mD,aAAe,GACpB,IAAIuB,EAA4E,KAC5EC,EAAkBC,IAkBtB,GAhBAxoD,KAAK6mD,OAAO13C,QAAQ01C,IAChB,MAAMp0C,EAAWo0C,EAAKpD,gBAAgB3e,GAEtC,GAAIryB,GAAYzQ,KAAKiF,OAAOiiD,oBAAqB,CAC7ClnD,KAAK+mD,aAAapgD,KAAKk+C,GAGvB,MAAMhuC,EAAOguC,EAAKlC,iBAAiB7f,GAC/BjsB,GAAQpG,EAAW83C,IACnBA,EAAkB93C,EAClB63C,EAAqB,CAAEzD,OAAMhuC,QAErC,IAIAyxC,GAAsBA,IAAuBtoD,KAAKgnD,mBAAoB,CAEtEhnD,KAAKgnD,mBAAqBsB,EAC1B,MAAMxF,EAAcwF,EACpBtoD,KAAKunD,iBAAiB3C,gBAClB9B,EAAY+B,KACZ/B,EAAYjsC,KACZisB,GAGJ9iC,KAAKgJ,OAAOxD,MAAM,uBAAuBs9C,EAAY+B,KAAK5+C,SAAS68C,EAAYjsC,KAAK5S,QAExF,MAAYqkD,GAAsBtoD,KAAKgnD,qBAEnChnD,KAAKgnD,mBAAqB,KAC1BhnD,KAAKunD,iBAAiBvC,kBAEtBhlD,KAAKgJ,OAAOxD,MAAM,4BAE1B,CAKA,MAAA6tB,CAAOC,EAAoBkuB,GAEFnrC,MAAMC,KAAKtW,KAAK6mD,OAAOluC,UAAU8vC,KAAK,CAACj8C,EAAGhB,KAC3D,MAAMk9C,EAAQl8C,EAAEi1C,gBAAgBD,GAEhC,OADch2C,EAAEi2C,gBAAgBD,GACjBkH,IAINv5C,QAAQ01C,IACjBA,EAAKxxB,OAAOC,EAAUkuB,EAAgBxhD,KAAKiF,OAAOmiD,uBAItDpnD,KAAKunD,iBAAiBl0B,OAAOC,EACjC,CAKQ,WAAAq0B,GACJ3nD,KAAK6mD,OAAO3+C,QACZlI,KAAK+mD,aAAe,GACpB/mD,KAAKgnD,mBAAqB,KAC1BhnD,KAAKunD,iBAAiBvC,kBAEtBhlD,KAAKgJ,OAAOxD,MAAM,oBACtB,CAKA,OAAAmjD,CAAQrI,GACJ,OAAOtgD,KAAK6mD,OAAO39C,IAAIo3C,EAC3B,CAKA,YAAAsI,GACI,OAAOvyC,MAAMC,KAAKtW,KAAK6mD,OAAOluC,SAClC,CAKA,eAAAkwC,GACI,MAAO,IAAI7oD,KAAK+mD,aACpB,CAKA,qBAAA+B,GACI,OAAO9oD,KAAKgnD,kBAChB,CAKA,iBAAA+B,GACI/oD,KAAK6mD,OAAO13C,QAAQ01C,IAChBA,EAAK7F,cAAe,IAExBh/C,KAAKgJ,OAAOpD,KAAK,2BACrB,CAKA,cAAAojD,GAOI,MAAMC,EAAmB5yC,MAAMC,KAAKtW,KAAK6mD,OAAOluC,UAAU3Q,OAAOwD,GAAKA,EAAEwzC,cAAcp4C,OAChFsiD,EAAgB7yC,MAAMC,KAAKtW,KAAK6mD,OAAOluC,UAAU3Q,OAAOwD,GAAKA,EAAEyzC,WAAWr4C,OAEhF,MAAO,CACHuiD,UAAWnpD,KAAK6mD,OAAOx7C,KACvB49C,mBACAC,gBACAnC,aAAc/mD,KAAK+mD,aAAangD,OAChCwiD,qBAAkD,OAA5BppD,KAAKgnD,mBAEnC,CAKA,YAAAlO,CAAaC,GACT/4C,KAAKiF,OAAS,IAAKjF,KAAKiF,UAAW8zC,GACnC/4C,KAAKgJ,OAAOxD,MAAM,iBAAkBuzC,EACxC,CAKA,gBAAAxB,GACI,OAAOv3C,KAAK62B,aAChB,CAKA,aAAAwyB,CAAc/I,EAAgBvyB,EAAkC+U,GAC5D,MAAM+hB,EAAO7kD,KAAK6mD,OAAO39C,IAAIo3C,GAC7B,IAAKuE,EAAM,OAAO,EAElB,OAAQ92B,GACJ,IAAK,OAID,OAHA82B,EAAKvB,cACLuB,EAAK7F,cAAe,EACpBh/C,KAAKgJ,OAAOpD,KAAK,cAAci/C,EAAK5+C,SAC7B,EAEX,IAAK,OACD,GAAI68B,EAAc,CACd,MAAMx5B,EAASu7C,EAAKjC,cAAc9f,GAClC,GAAIx5B,EAEA,OADAtJ,KAAKgJ,OAAOpD,KAAK,YAAY0D,EAAO65C,SAAS95C,QAAQ,MAAMC,EAAOs3C,qBAAqBiE,EAAK5+C,SACrF,CAEf,CACA,OAAO,EAEX,IAAK,OACD,MAAM68C,EAAc+B,EAAKlC,iBAAiB7f,GAAgB,CAAEp2B,EAAG,EAAGC,EAAG,IACrE,SAAIm2C,GAAoC,YAArBA,EAAY7+C,OAAsB6+C,EAAYvC,YAC7DsE,EAAK3F,UAAW,EAChBl/C,KAAKgJ,OAAOpD,KAAK,gBAAgBi/C,EAAK5+C,SAC/B,GAIf,QACI,OAAO,EAEnB,CAKA,eAAAqjD,GACI,OAAOjzC,MAAMC,KAAKtW,KAAK6mD,OAAOluC,SAClC,CAKA,OAAArH,GACItR,KAAK2nD,cACL3nD,KAAKgJ,OAAOpD,KAAK,yCACrB,EC7cG,MAAM2jD,EAeT,WAAAzkD,CAAYG,EAAyC,IAbrDjF,KAAQ+pC,MAA0B,GAClC/pC,KAAQwpD,WAA+B,GACvCxpD,KAAQypD,aAA4E,GAGpFzpD,KAAQ0pD,aAAuB,EAC/B1pD,KAAQ2pD,eAA6C,KAGrD3pD,KAAQ4pD,KAAe,EAKnB5pD,KAAKgJ,OAAS,IAAIO,EAAO,mBAEzBvJ,KAAKiF,OAAS,CACVklC,UAAW,IACX0f,WAAY,EACZC,iBAAkB,GAClBC,kBAAkB,EAClBC,oBAAqB,GACrBC,cAAe,MACZhlD,GAGPjF,KAAKkqD,qBAELlqD,KAAKgJ,OAAOpD,KAAK,kCAAmC,CAChDukC,UAAWnqC,KAAK+pC,MAAMnjC,OACtByjB,OAAQrqB,KAAKiF,OAAO4kD,YAE5B,CAKQ,kBAAAK,GACJlqD,KAAKmqD,gBACLnqD,KAAKoqD,qBACLpqD,KAAKqqD,iBACT,CAKQ,aAAAF,GACJnqD,KAAK+pC,MAAQ,GAEb,IAAA,IAASx9B,EAAI,EAAGA,EAAIvM,KAAKiF,OAAOklC,UAAW59B,IAAK,CAC5C,MAAMmO,EAAW,CACbhO,EAAmB,KAAhBE,KAAK2U,SACR5U,EAAmB,KAAhBC,KAAK2U,UAGNkK,EAAQ7e,KAAKC,MAAMD,KAAK2U,SAAWvhB,KAAKiF,OAAO4kD,YAC/Cx+C,EAAOrL,KAAKsqD,YAAY7+B,GACxBnf,EAAQtM,KAAK6sC,eAEnB7sC,KAAK+pC,MAAMpjC,KAAK,CACZ+T,SAAU,IAAKA,GACf6vC,iBAAkB,IAAK7vC,GACvBpO,QACAjB,OACAogB,QACA8N,QAAS3sB,KAAK2U,SAAW3U,KAAKuU,GAAK,GAE3C,CACJ,CAKQ,kBAAAipC,GACJpqD,KAAKwpD,WAAa,GAIlB,IAAA,IAASj9C,EAAI,EAAGA,EAHE,GAGaA,IAAK,CAChC,MAAMiV,EAAWjV,EAJH,GAKRi+C,EAAY,IACZC,EAAgD,GAAnC79C,KAAKqU,IAAIO,EAAW5U,KAAKuU,GAAK,GAE3CzG,EAAW,CACbhO,EAAc,KAAX8U,EAAkBipC,EACrB99C,EAAG,IAAM89C,GAAc79C,KAAK2U,SAAW,IAAOipC,GAI5Cl+C,EAAQtM,KAAK0qD,qBAEnB1qD,KAAKwpD,WAAW7iD,KAAK,CACjB+T,SAAU,IAAKA,GACf6vC,iBAAkB,IAAK7vC,GACvBpO,QACAjB,KAAsB,IAAhBuB,KAAK2U,SAAiB,GAC5BkK,MAAO,EACP8N,QAAS3sB,KAAK2U,SAAW3U,KAAKuU,GAAK,GAE3C,CACJ,CAKQ,eAAAkpC,GACJrqD,KAAKypD,aAAe,GAGpB,IAAA,IAASl9C,EAAI,EAAGA,EAFI,EAEaA,IAC7BvM,KAAKypD,aAAa9iD,KAAK,CACnB+F,EAAmB,KAAhBE,KAAK2U,SACR5U,EAAmB,KAAhBC,KAAK2U,SACRlW,KAAsB,IAAhBuB,KAAK2U,SAAiB,IAC5BjV,MAAOtM,KAAK2qD,kBAGxB,CAKQ,WAAAL,CAAY7+B,GAEhB,MADkB,CAAC,EAAG,IAAK,EAAG,IAAK,GAClBA,GAAyB,GAAhB7e,KAAK2U,QACnC,CAKQ,YAAAsrB,GACJ,MAAM1I,EAAS,CACX,CAAE74B,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAEvB,OAAO24B,EAAOv3B,KAAKC,MAAMD,KAAK2U,SAAW4iB,EAAOv9B,QACpD,CAKQ,kBAAA8jD,GACJ,MAAMvmB,EAAS,CACX,CAAE74B,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAEvB,OAAO24B,EAAOv3B,KAAKC,MAAMD,KAAK2U,SAAW4iB,EAAOv9B,QACpD,CAKQ,cAAA+jD,GACJ,MAAMxmB,EAAS,CACX,CAAE74B,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAEvB,OAAO24B,EAAOv3B,KAAKC,MAAMD,KAAK2U,SAAW4iB,EAAOv9B,QACpD,CAKA,MAAA4N,CAAOC,GACHzU,KAAK4pD,MAAQn1C,EAGbzU,KAAK+pC,MAAM56B,QAAQg8B,IACfA,EAAK5R,SAAW9kB,GAAa,GAAsB,GAAhB7H,KAAK2U,YAG5CvhB,KAAKwpD,WAAWr6C,QAAQg8B,IACpBA,EAAK5R,SAAuB,GAAZ9kB,GAExB,CAKA,mBAAAm2C,CAAoBjB,GACX3pD,KAAKiF,OAAO8kD,mBAEjB/pD,KAAK2pD,eAAiB,IAAKA,GAC3B3pD,KAAK0pD,aAAc,EAGnB1pD,KAAK6qD,aAAa7qD,KAAK+pC,MAAO4f,GAC9B3pD,KAAK6qD,aAAa7qD,KAAKwpD,WAAYG,GAEnC3pD,KAAKgJ,OAAOxD,MAAM,4CACtB,CAKA,qBAAAslD,GACS9qD,KAAK0pD,cAGV1pD,KAAK+pC,MAAM56B,QAAQg8B,IACfA,EAAKzwB,SAAW,IAAKywB,EAAKof,oBAG9BvqD,KAAKwpD,WAAWr6C,QAAQg8B,IACpBA,EAAKzwB,SAAW,IAAKywB,EAAKof,oBAG9BvqD,KAAK0pD,aAAc,EACnB1pD,KAAK2pD,eAAiB,KAEtB3pD,KAAKgJ,OAAOxD,MAAM,+CACtB,CAKA,cAAAulD,CAAevpC,GACX,IAAKxhB,KAAK0pD,cAAgB1pD,KAAK2pD,eAAgB,OAE/C,MAAMqB,EAAgB,EAAMxpC,EAG5BxhB,KAAKirD,sBAAsBjrD,KAAK+pC,MAAOihB,GACvChrD,KAAKirD,sBAAsBjrD,KAAKwpD,WAAYwB,EAChD,CAKQ,YAAAH,CAAa9gB,EAAyB4f,GAC1C5f,EAAM56B,QAAQg8B,IACV,MAAM79B,EAAK69B,EAAKof,iBAAiB79C,EAAIi9C,EAAe5sC,OAAOrQ,EACrDc,EAAK29B,EAAKof,iBAAiB59C,EAAIg9C,EAAe5sC,OAAOpQ,EACrD8D,EAAW7D,KAAK8D,KAAKpD,EAAKA,EAAKE,EAAKA,GAE1C,GAAIiD,EAAWk5C,EAAe37C,OAAQ,CAElC,MAGMk9C,EAAoC,KAHd,EAAIz6C,EAAWk5C,EAAe37C,QAAU27C,EAAe9gC,YAGnCsiB,EAAK1f,MAAQ,GAE7D0f,EAAKzwB,SAAShO,EAAIy+B,EAAKof,iBAAiB79C,EAAKY,EAAKmD,EAAYy6C,EAC9D/f,EAAKzwB,SAAS/N,EAAIw+B,EAAKof,iBAAiB59C,EAAKa,EAAKiD,EAAYy6C,CAClE,GAER,CAKQ,qBAAAD,CAAsBlhB,EAAyBihB,GACnDjhB,EAAM56B,QAAQg8B,IAEVA,EAAKzwB,SAAShO,EAAIy+B,EAAKzwB,SAAShO,GAAKy+B,EAAKof,iBAAiB79C,EAAIy+B,EAAKzwB,SAAShO,GAAKs+C,EAAgB,GAClG7f,EAAKzwB,SAAS/N,EAAIw+B,EAAKzwB,SAAS/N,GAAKw+B,EAAKof,iBAAiB59C,EAAIw+B,EAAKzwB,SAAS/N,GAAKq+C,EAAgB,IAE1G,CAKA,MAAA33B,CAAOC,EAAoBkuB,GAEvBxhD,KAAKmrD,cAAc73B,EAAUkuB,GAG7BxhD,KAAKorD,iBAAiB93B,EAAUkuB,GAGhC,IAAA,IAAS/1B,EAAQzrB,KAAKiF,OAAO4kD,WAAa,EAAGp+B,GAAS,EAAGA,IACrDzrB,KAAKqrD,gBAAgB/3B,EAAUkuB,EAAgB/1B,EAEvD,CAKQ,aAAA0/B,CAAc73B,EAAoBkuB,GACtCxhD,KAAKypD,aAAat6C,QAAQm8C,IACtB,MACMC,EAAUD,EAAO5+C,EADA,GACI80C,EAAe90C,EACpC8+C,EAAUF,EAAO3+C,EAFA,GAEI60C,EAAe70C,EAG1C,GAAI4+C,GAAWD,EAAOjgD,MAAQkgD,EAAU,KAAOD,EAAOjgD,MAClDmgD,GAAWF,EAAOjgD,MAAQmgD,EAAU,IAAMF,EAAOjgD,KACjD,OAIJ,MAAMogD,EAAa7+C,KAAKC,MAAMy+C,EAAOjgD,KAAO,GAC5C,IAAA,IAASkB,EAAI,EAAGA,EAAIk/C,EAAYl/C,IAAK,CACjC,MAAM23B,EAAS33B,EAAIk/C,EAAc7+C,KAAKuU,GAAK,EAAgB,GAAZnhB,KAAK4pD,KAC9C57C,EAAUs9C,EAAOjgD,KAAO,EAAKuB,KAAK8D,KAAK9D,KAAK2U,UAE5C7U,EAAI6+C,EAAU3+C,KAAKiX,IAAIqgB,GAASl2B,EAChCrB,EAAI6+C,EAAU5+C,KAAKqU,IAAIijB,GAASl2B,EAEhC+3B,EAAQ/lC,KAAKiF,OAAOglD,eAAiB,EAAIj8C,GAAUs9C,EAAOjgD,KAAO,IACjEiB,EAAQ,CACVhB,EAAGsB,KAAKC,MAAMy+C,EAAOh/C,MAAMhB,EAAIy6B,GAC/Bx6B,EAAGqB,KAAKC,MAAMy+C,EAAOh/C,MAAMf,EAAIw6B,GAC/Bv6B,EAAGoB,KAAKC,MAAMy+C,EAAOh/C,MAAMd,EAAIu6B,KAG/Bz5B,EAAMhB,EAAI,GAAKgB,EAAMf,EAAI,GAAKe,EAAMd,EAAI,IACxC8nB,EAAS7mB,SAASC,EAAGC,EAAGL,EAEhC,GAER,CAKQ,gBAAA8+C,CAAiB93B,EAAoBkuB,GACzCxhD,KAAKwpD,WAAWr6C,QAAQg8B,IACpB,MACMogB,EAAUpgB,EAAKzwB,SAAShO,EADP,GACW80C,EAAe90C,EAC3C8+C,EAAUrgB,EAAKzwB,SAAS/N,EAFP,GAEW60C,EAAe70C,EAGjD,GAAI4+C,GAAU,IAAOA,EAAU,MAAQC,GAAU,IAAOA,EAAU,IAC9D,OAIJ,MAAMjyB,EAAmC,GAAzB3sB,KAAKqU,IAAIkqB,EAAK5R,SAAiB,GACzC1Q,EAAY7oB,KAAKiF,OAAO+kD,oBAAsBzwB,EAE9CjtB,EAAQ,CACVhB,EAAGsB,KAAKC,MAAMs+B,EAAK7+B,MAAMhB,EAAIud,GAC7Btd,EAAGqB,KAAKC,MAAMs+B,EAAK7+B,MAAMf,EAAIsd,GAC7Brd,EAAGoB,KAAKC,MAAMs+B,EAAK7+B,MAAMd,EAAIqd,IAGjC7oB,KAAK0rD,WAAWp4B,EAAUi4B,EAASC,EAAqB,GAAZrgB,EAAK9/B,KAAYiB,IAErE,CAKQ,eAAA++C,CAAgB/3B,EAAoBkuB,EAAyB/1B,GAEjE,MAAMkgC,GAAkBlgC,EAAQ,GAAKzrB,KAAKiF,OAAO6kD,iBAEjD9pD,KAAK+pC,MAAM/hC,OAAOmjC,GAAQA,EAAK1f,QAAUA,GAAOtc,QAAQg8B,IACpD,MAAMogB,EAAUpgB,EAAKzwB,SAAShO,EAAI80C,EAAe90C,EAAIi/C,EAC/CH,EAAUrgB,EAAKzwB,SAAS/N,EAAI60C,EAAe70C,EAAIg/C,EAGrD,GAAIJ,GAAU,IAAOA,EAAU,MAAQC,GAAU,IAAOA,EAAU,IAC9D,OAIJ,MAAMjyB,EAAmC,GAAzB3sB,KAAKqU,IAAIkqB,EAAK5R,SAAiB,GACzCjtB,EAAQ,CACVhB,EAAGsB,KAAKC,MAAMs+B,EAAK7+B,MAAMhB,EAAIiuB,GAC7BhuB,EAAGqB,KAAKC,MAAMs+B,EAAK7+B,MAAMf,EAAIguB,GAC7B/tB,EAAGoB,KAAKC,MAAMs+B,EAAK7+B,MAAMd,EAAI+tB,IAGjCv5B,KAAK0rD,WAAWp4B,EAAUi4B,EAASC,EAASrgB,EAAK9/B,KAAMiB,IAE/D,CAKQ,UAAAo/C,CAAWp4B,EAAoB5mB,EAAWC,EAAWtB,EAAciB,GACvE,GAAIjB,GAAQ,EAERioB,EAAS7mB,SAASC,EAAGC,EAAGL,QAC5B,GAAWjB,GAAQ,EAEfioB,EAAStnB,SAASU,EAAI,EAAGC,EAAI,EAAG,EAAG,EAAGL,OACnC,CAEH,MAAMg+B,EAAW19B,KAAKC,MAAMxB,GACtBugD,EAAWh/C,KAAKC,MAAMy9B,EAAW,GAMvC,GAHAhX,EAAStnB,SAASU,EAAIk/C,EAAUj/C,EAAIi/C,EAAUthB,EAAUA,EAAUh+B,GAG9DjB,EAAO,IAAK,CACZ,MAAMwgD,EAAW,CACbvgD,EAAGsB,KAAKC,MAAgB,GAAVP,EAAMhB,GACpBC,EAAGqB,KAAKC,MAAgB,GAAVP,EAAMf,GACpBC,EAAGoB,KAAKC,MAAgB,GAAVP,EAAMd,IAIxB8nB,EAAStnB,SAASU,EAAIrB,EAAMsB,EAAI,EAAU,EAAPtB,EAAU,EAAGwgD,GAEhDv4B,EAAStnB,SAASU,EAAI,EAAGC,EAAItB,EAAM,EAAU,EAAPA,EAAUwgD,EACpD,CACJ,CACJ,CAKA,oBAAAC,CAAqBnC,GACb3pD,KAAKiF,OAAO8kD,kBACZ/pD,KAAK4qD,oBAAoBjB,EAEjC,CAKA,QAAApsC,GAMI,MAAO,CACH4sB,UAAWnqC,KAAK+pC,MAAMnjC,OACtBmlD,gBAAiB/rD,KAAKwpD,WAAW5iD,OACjColD,YAAahsD,KAAKypD,aAAa7iD,OAC/B8iD,YAAa1pD,KAAK0pD,YAE1B,CAKA,oBAAAuC,GACIjsD,KAAKkqD,qBACLlqD,KAAKgJ,OAAOpD,KAAK,4BACrB,CAKA,YAAAkzC,CAAaC,GACT/4C,KAAKiF,OAAS,IAAKjF,KAAKiF,UAAW8zC,IAG/BA,EAAU5O,WAAa4O,EAAU8Q,aACjC7pD,KAAKisD,sBAEb,ECleG,IAAKC,GAAAA,IACRA,EAAA,SAAW,WACXA,EAAA,UAAY,YACZA,EAAA,UAAY,YACZA,EAAA,OAAS,SACTA,EAAA,KAAO,OACPA,EAAA,WAAa,aACbA,EAAA,UAAY,YACZA,EAAA,SAAW,WARHA,IAAAA,GAAA,CAAA,GAWAC,GAAAA,IACRA,EAAA,OAAS,SACTA,EAAA,SAAW,WACXA,EAAA,KAAO,OACPA,EAAA,KAAO,OACPA,EAAA,UAAY,YACZA,EAAA,SAAW,WANHA,IAAAA,GAAA,CAAA,GA2GL,MAAMC,EAOT,WAAAtnD,GANA9E,KAAQqsD,UAAmCvjD,IAC3C9I,KAAQssD,YAAuCxjD,IAC/C9I,KAAQusD,eAAgDzjD,IAKpD9I,KAAKgJ,OAAS,IAAIO,EAAO,gBACzBvJ,KAAKwsD,qBACLxsD,KAAKgJ,OAAOpD,KAAK,+BAAgC,CAC7C6mD,WAAYzsD,KAAKqsD,MAAMhhD,KACvBkhD,WAAYvsD,KAAKusD,WAAWlhD,MAEpC,CAKQ,kBAAAmhD,GAEJxsD,KAAKy/C,oBAGLz/C,KAAK0sD,qBAGL1sD,KAAK2sD,oBAGL3sD,KAAK4sD,kBAGL5sD,KAAK6sD,gBAGL7sD,KAAK8sD,sBAGL9sD,KAAK+sD,qBAGL/sD,KAAKgtD,mBACT,CAKQ,iBAAAvN,GACc,CACd,CACI/oC,GAAI,aACJzQ,KAAM,WACNgnD,YAAa,mDACbC,SAAU,QACVC,OAAQ,SACRj2B,MAAO,CAAErc,KAAM,EAAGuF,OAAQ,EAAGgtC,SAAU,IAAMC,OAAQ,IACrD/gD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,iBACJzQ,KAAM,WACNgnD,YAAa,wDACbC,SAAU,QACVC,OAAQ,WACRj2B,MAAO,CAAErc,KAAM,GAAKuF,OAAQ,EAAGgtC,SAAU,IAAKC,OAAQ,KACtD/gD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,iBACJzQ,KAAM,iBACNgnD,YAAa,2DACbC,SAAU,UACVC,OAAQ,SACRj2B,MAAO,CAAErc,KAAM,GAAKuF,OAAQ,EAAGgtC,SAAU,IAAKC,OAAQ,IACtD/gD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,oBACJzQ,KAAM,oBACNgnD,YAAa,mDACbC,SAAU,UACVC,OAAQ,OACRj2B,MAAO,CAAErc,KAAM,GAAKuF,OAAQ,EAAGgtC,SAAU,GAAIC,OAAQ,GAAKC,cAAe,IACzEhhD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,eACJzQ,KAAM,WACNgnD,YAAa,6CACbC,SAAU,MACVC,OAAQ,SACRj2B,MAAO,CAAErc,KAAM,GAAKuF,OAAQ,EAAGgtC,SAAU,IAAMC,OAAQ,IACvD/gD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,cACJzQ,KAAM,oBACNgnD,YAAa,wDACbC,SAAU,aACVC,OAAQ,WACRj2B,MAAO,CAAErc,KAAM,GAAKuF,OAAQ,EAAGgtC,SAAU,IAAKG,UAAW,IACzDjhD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,oBACJzQ,KAAM,aACNgnD,YAAa,kDACbC,SAAU,SACVC,OAAQ,OACRj2B,MAAO,CAAErc,KAAM,IAAMuF,OAAQ,EAAGgtC,SAAU,GAAIE,cAAe,GAAKC,UAAW,IAC7EjhD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,MAIxB2D,QAAQq+C,IACd,MAAMx0B,EAAOh5B,KAAKytD,WAAW,CACzB/2C,GAAI82C,EAAI92C,GACRzQ,KAAMunD,EAAIvnD,KACVgnD,YAAaO,EAAIP,YACjBhpD,KAAM,WACNipD,SAAUM,EAAIN,SACdC,OAAQK,EAAIL,OACZj2B,MAAOs2B,EAAIt2B,MACXw2B,UAAWF,EAAIlhD,MACfqhD,UAAU,EACVC,aAAa,EACbC,cAAc,IAElB7tD,KAAK8tD,QAAQ90B,IAErB,CAKQ,kBAAA0zB,GACe,CACf,CACIh2C,GAAI,eACJzQ,KAAM,gBACNgnD,YAAa,+CACbC,SAAU,SACVC,OAAQ,SACRj2B,MAAO,CAAErc,KAAM,GAAKuF,OAAQ,EAAGgtC,SAAU,IAAKW,WAAY,IAC1DzhD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,sBACJzQ,KAAM,iBACNgnD,YAAa,oDACbC,SAAU,UACVC,OAAQ,OACRj2B,MAAO,CAAErc,KAAM,EAAGuF,OAAQ,EAAGgtC,SAAU,GAAI7wB,MAAO,IAAKyxB,WAAY,KACnE1hD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,sBACJzQ,KAAM,iBACNgnD,YAAa,wDACbC,SAAU,SACVC,OAAQ,WACRj2B,MAAO,CAAErc,KAAM,IAAKuF,OAAQ,EAAGgtC,SAAU,GAAIa,QAAS,IAAKD,WAAY,KACvE1hD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,MAIvB2D,QAAQ++C,IACf,MAAMl1B,EAAOh5B,KAAKytD,WAAW,CACzB/2C,GAAIw3C,EAAKx3C,GACTzQ,KAAMioD,EAAKjoD,KACXgnD,YAAaiB,EAAKjB,YAClBhpD,KAAM,YACNipD,SAAUgB,EAAKhB,SACfC,OAAQe,EAAKf,OACbj2B,MAAOg3B,EAAKh3B,MACZw2B,UAAWQ,EAAK5hD,MAChBqhD,UAAU,EACVC,aAAa,EACbC,cAAc,IAElB7tD,KAAK8tD,QAAQ90B,IAErB,CAKQ,iBAAA2zB,GACc,CACd,CACIj2C,GAAI,kBACJzQ,KAAM,iBACNgnD,YAAa,gDACbC,SAAU,SACVC,OAAQ,SACRj2B,MAAO,CAAErc,KAAM,GAAIuF,OAAQ,EAAGgtC,SAAU,EAAG7wB,MAAO,IAAKyxB,WAAY,IACnE1hD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,gBACJzQ,KAAM,yBACNgnD,YAAa,qCACbC,SAAU,SACVC,OAAQ,WACRj2B,MAAO,CAAErc,KAAM,EAAGuF,OAAQ,EAAGgtC,SAAU,EAAGa,QAAS,IAAKD,WAAY,IACpE1hD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,eACJzQ,KAAM,YACNgnD,YAAa,oDACbC,SAAU,YACVC,OAAQ,OACRj2B,MAAO,CAAErc,KAAM,GAAIuF,OAAQ,EAAGgtC,SAAU,EAAG7wB,MAAO,IAAKyxB,WAAY,IACnE1hD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,MAIxB2D,QAAQg/C,IACd,MAAMn1B,EAAOh5B,KAAKytD,WAAW,CACzB/2C,GAAIy3C,EAAGz3C,GACPzQ,KAAMkoD,EAAGloD,KACTgnD,YAAakB,EAAGlB,YAChBhpD,KAAM,YACNipD,SAAUiB,EAAGjB,SACbC,OAAQgB,EAAGhB,OACXj2B,MAAOi3B,EAAGj3B,MACVw2B,UAAWS,EAAG7hD,MACdqhD,UAAU,EACVC,aAAa,EACbC,cAAc,IAElB7tD,KAAK8tD,QAAQ90B,IAErB,CAKQ,eAAA4zB,GACY,CACZ,CACIl2C,GAAI,iBACJzQ,KAAM,qBACNgnD,YAAa,2CACbC,SAAU,SACVC,OAAQ,SACRj2B,MAAO,CAAErc,KAAM,EAAGuF,OAAQ,EAAGgtC,SAAU,EAAGlyB,OAAQ,GAAIoR,MAAO,KAC7DhgC,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,aACJzQ,KAAM,mBACNgnD,YAAa,0CACbC,SAAU,aACVC,OAAQ,OACRj2B,MAAO,CAAErc,KAAM,GAAIuF,OAAQ,EAAGgtC,SAAU,EAAGlyB,OAAQ,IAAKoR,MAAO,KAC/DhgC,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,MAI1B2D,QAAQi/C,IACZ,MAAMp1B,EAAOh5B,KAAKytD,WAAW,CACzB/2C,GAAI03C,EAAG13C,GACPzQ,KAAMmoD,EAAGnoD,KACTgnD,YAAamB,EAAGnB,YAChBhpD,KAAM,SACNipD,SAAUkB,EAAGlB,SACbC,OAAQiB,EAAGjB,OACXj2B,MAAOk3B,EAAGl3B,MACVw2B,UAAWU,EAAG9hD,MACdqhD,UAAU,EACVC,aAAa,EACbC,cAAc,IAElB7tD,KAAK8tD,QAAQ90B,IAErB,CAKQ,aAAA6zB,GACU,CACV,CACIn2C,GAAI,oBACJzQ,KAAM,eACNgnD,YAAa,sDACbC,SAAU,SACVC,OAAQ,WACRj2B,MAAO,CAAErc,KAAM,EAAGuF,OAAQ,EAAGgtC,SAAU,EAAGY,WAAY,GAAKD,WAAY,IACvEzhD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,kBACJzQ,KAAM,aACNgnD,YAAa,wCACbC,SAAU,SACVC,OAAQ,SACRj2B,MAAO,CAAErc,KAAM,EAAGuF,OAAQ,EAAGgtC,SAAU,GAAIY,WAAY,IACvD1hD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,MAI5B2D,QAAQk/C,IACV,MAAMr1B,EAAOh5B,KAAKytD,WAAW,CACzB/2C,GAAI23C,EAAK33C,GACTzQ,KAAMooD,EAAKpoD,KACXgnD,YAAaoB,EAAKpB,YAClBhpD,KAAM,OACNipD,SAAUmB,EAAKnB,SACfC,OAAQkB,EAAKlB,OACbj2B,MAAOm3B,EAAKn3B,MACZw2B,UAAWW,EAAK/hD,MAChBqhD,UAAU,EACVC,aAAa,EACbC,cAAc,IAElB7tD,KAAK8tD,QAAQ90B,IAErB,CAKQ,mBAAA8zB,GACgB,CAChB,CACIp2C,GAAI,mBACJzQ,KAAM,cACNgnD,YAAa,+CACbE,OAAQ,SACRj2B,MAAO,CAAErc,KAAM,GAAKuF,OAAQ,EAAGgtC,SAAU,GAAI7wB,MAAO,KACpDjwB,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,gBACJzQ,KAAM,kBACNgnD,YAAa,8CACbE,OAAQ,OACRj2B,MAAO,CAAErc,KAAM,GAAKuF,OAAQ,EAAGgtC,SAAU,GAAIY,WAAY,IACzD1hD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,MAItB2D,QAAQm/C,IAChB,MAAMt1B,EAAOh5B,KAAKytD,WAAW,CACzB/2C,GAAI43C,EAAK53C,GACTzQ,KAAMqoD,EAAKroD,KACXgnD,YAAaqB,EAAKrB,YAClBhpD,KAAM,aACNipD,SAAU,SACVC,OAAQmB,EAAKnB,OACbj2B,MAAOo3B,EAAKp3B,MACZw2B,UAAWY,EAAKhiD,MAChBqhD,UAAU,EACVC,aAAa,EACbC,cAAc,IAElB7tD,KAAK8tD,QAAQ90B,IAErB,CAKQ,kBAAA+zB,GACe,CACf,CACIr2C,GAAI,qBACJzQ,KAAM,4BACNgnD,YAAa,wDACbE,OAAQ,OACR7gD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAE9B,CACIkL,GAAI,kBACJzQ,KAAM,8BACNgnD,YAAa,+CACbE,OAAQ,OACR7gD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,MAIvB2D,QAAQo/C,IACf,MAAMv1B,EAAOh5B,KAAKytD,WAAW,CACzB/2C,GAAI63C,EAAG73C,GACPzQ,KAAMsoD,EAAGtoD,KACTgnD,YAAasB,EAAGtB,YAChBhpD,KAAM,YACNipD,SAAU,SACVC,OAAQoB,EAAGpB,OACXj2B,MAAO,CAAErc,KAAM,GAAKuF,OAAQ,EAAGgtC,SAAU,GACzCM,UAAWa,EAAGjiD,MACdqhD,UAAU,EACVC,aAAa,EACbC,cAAc,IAElB7tD,KAAK8tD,QAAQ90B,IAErB,CAKQ,iBAAAg0B,GACc,CACd,CACIt2C,GAAI,sBACJzQ,KAAM,sBACNgnD,YAAa,+CACbE,OAAQ,WACRj2B,MAAO,CAAErc,KAAM,EAAGuF,OAAQ,EAAGgtC,SAAU,EAAGE,cAAe,IACzDhhD,MAAO,CAAEhB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC1BgjD,KAAM,kGAIJr/C,QAAQs/C,IACd,MAAMz1B,EAAOh5B,KAAKytD,WAAW,CACzB/2C,GAAI+3C,EAAI/3C,GACRzQ,KAAMwoD,EAAIxoD,KACVgnD,YAAawB,EAAIxB,YACjBhpD,KAAM,WACNipD,SAAU,SACVC,OAAQsB,EAAItB,OACZj2B,MAAOu3B,EAAIv3B,MACXw2B,UAAWe,EAAIniD,MACfqhD,UAAU,EACVC,aAAa,EACbC,cAAc,EACda,SAAUD,EAAID,OAElBxuD,KAAK8tD,QAAQ90B,IAErB,CAKQ,UAAAy0B,CAAWxoD,GAcf,MAAMuK,EAASxP,KAAK2uD,mBAAmB1pD,EAAOhB,KAAMgB,EAAOioD,SAAUjoD,EAAOyoD,WAE5E,MAAO,CACHh3C,GAAIzR,EAAOyR,GACXzQ,KAAMhB,EAAOgB,KACbgnD,YAAahoD,EAAOgoD,YACpBhpD,KAAMgB,EAAOhB,KACbipD,SAAUjoD,EAAOioD,SACjBC,OAAQloD,EAAOkoD,OACf39C,SACAk+C,UAAWzoD,EAAOyoD,UAClBx2B,MAAO,CACHrc,KAAM,EACNuF,OAAQ,EACRgtC,SAAU,KACPnoD,EAAOiyB,OAEdy2B,SAAU1oD,EAAO0oD,SACjBC,YAAa3oD,EAAO2oD,YACpBC,aAAc5oD,EAAO4oD,aACrBa,SAAUzpD,EAAOypD,SAEzB,CAKQ,kBAAAC,CAAmB1qD,EAAgBipD,EAAwB0B,GAC/D,MAEMC,EAAoB,GAG1B,IAAA,IAASliD,EAAI,EAAGA,EAJD,GAIaA,IAAK,CAC7BkiD,EAAOliD,GAAK,GACZ,IAAA,IAASD,EAAI,EAAGA,EAPN,GAOiBA,IACvBmiD,EAAOliD,GAAGD,GAAK,CAAEpB,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAExC,CAGA,OAAQvH,GACJ,IAAK,WACDjE,KAAK8uD,mBAAmBD,EAAQ3B,EAAU0B,GAC1C,MACJ,IAAK,YACD5uD,KAAK+uD,oBAAoBF,EAAQ3B,EAAU0B,GAC3C,MACJ,IAAK,YACD5uD,KAAKgvD,oBAAoBH,EAAQ3B,EAAU0B,GAC3C,MACJ,IAAK,SACD5uD,KAAKivD,iBAAiBJ,EAAQ3B,EAAU0B,GACxC,MACJ,IAAK,OACD5uD,KAAKkvD,eAAeL,EAAQ3B,EAAU0B,GACtC,MACJ,IAAK,aACD5uD,KAAKmvD,qBAAqBN,EAAQD,GAClC,MACJ,IAAK,YACD5uD,KAAKovD,oBAAoBP,EAAQD,GACjC,MACJ,IAAK,WACD5uD,KAAKqvD,mBAAmBR,EAAQD,GAIxC,MAAO,CAAEnkD,MAxCK,GAwCEC,OAvCD,GAuCSmkD,SAC5B,CAKQ,kBAAAC,CAAmBD,EAAmB3B,EAAwB5gD,GAClE,MAAMgjD,EAAYtvD,KAAKuvD,YAAYjjD,EAAO,IACpCkjD,EAAaxvD,KAAKyvD,aAAanjD,EAAO,KAE5C,GAAiB,YAAb4gD,EAAmC,CAEnCltD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGviD,GAC5BtM,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGviD,GAC5BtM,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGS,GAC5BtvD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGviD,GAC5BtM,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGviD,GAC5BtM,KAAKyM,SAASoiD,EAAQ,GAAI,EAAGS,GAE7B,IAAA,IAAS3iD,EAAI,EAAGA,EAAI,GAAIA,IACpB,IAAA,IAASD,EAAI,EAAGA,GAAK,GAAIA,IACX,IAANA,GAAiB,KAANA,OAAeD,SAASoiD,EAAQniD,EAAGC,EAAG2iD,GACtC,IAAN5iD,EAAS1M,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAG6iD,GACzCxvD,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAGL,GAGzCtM,KAAKyM,SAASoiD,EAAQ,EAAG,GAAIS,EACjC,MAEI,IAAA,IAAS3iD,EAAI,EAAGA,EAAI,GAAIA,IACpB,IAAA,IAASD,EAAI,EAAGA,EAAI,GAAIA,KACfA,EAAIC,GAAK,GAAM,OAAQF,SAASoiD,EAAQniD,EAAGC,EAAG6iD,IACzC9iD,EAAIC,GAAK,GAAM,OAAQF,SAASoiD,EAAQniD,EAAGC,EAAGL,GACnDtM,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAG2iD,EAIjD,CAKQ,mBAAAP,CAAoBF,EAAmB3B,EAAwB5gD,GACnE,MAAMgjD,EAAYtvD,KAAKuvD,YAAYjjD,EAAO,IACpCkjD,EAAaxvD,KAAKyvD,aAAanjD,EAAO,KAG5C,IAAA,IAASK,EAAI,EAAGA,EAAI,GAAIA,IACpB,IAAA,IAASD,EAAI,EAAGA,EAAI,GAAIA,IACpB1M,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAG2iD,GAKpC,IAAA,IAAS5iD,EAAI,EAAGA,EAAI,GAAIA,IACpB1M,KAAKyM,SAASoiD,EAAQniD,EAAG,EAAGJ,GAC5BtM,KAAKyM,SAASoiD,EAAQniD,EAAG,EAAGJ,GAEhC,IAAA,IAASK,EAAI,EAAGA,EAAI,GAAIA,IACpB3M,KAAKyM,SAASoiD,EAAQ,EAAGliD,EAAGL,GAC5BtM,KAAKyM,SAASoiD,EAAQ,EAAGliD,EAAGL,GAIhCtM,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,GAAI,EAAGW,GAC7BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,GAAIW,GAC7BxvD,KAAKyM,SAASoiD,EAAQ,GAAI,GAAIW,EAClC,CAKQ,mBAAAR,CAAoBH,EAAmB3B,EAAwB5gD,GACnE,MAAMgjD,EAAYtvD,KAAKuvD,YAAYjjD,EAAO,IACpCkjD,EAAaxvD,KAAKyvD,aAAanjD,EAAO,KAG5C,IAAA,IAASK,EAAI,EAAGA,EAAI,GAAIA,IACpB,IAAA,IAASD,EAAI,EAAGA,EAAI,GAAIA,IACV,IAANC,GAAiB,KAANA,GAAkB,IAAND,GAAiB,KAANA,EAClC1M,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAG2iD,GAE5BtvD,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAGL,GAMxC,GAAiB,WAAb4gD,EAEA,IAAA,IAASvgD,EAAI,EAAGA,EAAI,GAAIA,IACpB3M,KAAKyM,SAASoiD,EAAQ,EAAGliD,EAAG6iD,OAEZ,WAAbtC,IAEPltD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAEpC,CAKQ,gBAAAP,CAAiBJ,EAAmB3B,EAAwB5gD,GAChE,MAAMgjD,EAAYtvD,KAAKuvD,YAAYjjD,EAAO,IACpCkjD,EAAaxvD,KAAKyvD,aAAanjD,EAAO,KAG5C,IAAA,IAASK,EAAI,EAAGA,EAAI,GAAIA,IACpB,IAAA,IAASD,EAAI,EAAGA,EAAI,GAAIA,IACV,IAANC,GAAiB,IAANA,OAAcF,SAASoiD,EAAQniD,EAAGC,EAAG2iD,GAC/CtvD,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAGL,GAKzCtM,KAAKyM,SAASoiD,EAAQ,GAAI,EAAGW,GAC7BxvD,KAAKyM,SAASoiD,EAAQ,GAAI,EAAGW,GAG7B,IAAA,IAAS7iD,EAAI,EAAGA,EAAI,GAAIA,IACpB,IAAA,IAASD,EAAI,EAAGA,EAAI,EAAGA,IACnB1M,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAG2iD,EAGxC,CAKQ,cAAAJ,CAAeL,EAAmB3B,EAAwB5gD,GAC9D,MAAMgjD,EAAYtvD,KAAKuvD,YAAYjjD,EAAO,IACpCkjD,EAAaxvD,KAAKyvD,aAAanjD,EAAO,KAG5C,IAAA,IAASK,EAAI,EAAGA,EAAI,GAAIA,IACpB,IAAA,IAASD,EAAI,EAAGA,EAAI,GAAIA,IACpB1M,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAG2iD,GAKpC,GAAiB,WAAbpC,EAEA,IAAA,IAASvgD,EAAI,EAAGA,EAAI,EAAGA,IACnB3M,KAAKyM,SAASoiD,EAAQ,EAAGliD,EAAGL,GACxBK,EAAI,IACJ3M,KAAKyM,SAASoiD,EAAQ,EAAGliD,EAAG6iD,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,EAAGliD,EAAG6iD,SAKpC,IAAA,IAAS7iD,EAAI,EAAGA,EAAI,EAAGA,IACnB,IAAA,IAASD,EAAI,EAAGA,EAAI,GAAIA,IACpB1M,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAGL,EAI5C,CAKQ,oBAAA6iD,CAAqBN,EAAmBviD,GAC5C,MAAMgjD,EAAYtvD,KAAKuvD,YAAYjjD,EAAO,IACpCkjD,EAAaxvD,KAAKyvD,aAAanjD,EAAO,KAG5C,IAAA,IAASK,EAAI,EAAGA,EAAI,GAAIA,IACpB,IAAA,IAASD,EAAI,EAAGA,EAAI,GAAIA,IACV,IAANC,GAAiB,KAANA,GAAkB,IAAND,GAAiB,KAANA,EAClC1M,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAG2iD,GAE5BtvD,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAGL,GAMxCtM,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,EAChC,CAKQ,mBAAAJ,CAAoBP,EAAmBviD,GAC3C,MAAMgjD,EAAYtvD,KAAKuvD,YAAYjjD,EAAO,IACpCkjD,EAAaxvD,KAAKyvD,aAAanjD,EAAO,KAG5C,IAAA,IAASK,EAAI,EAAGA,EAAI,GAAIA,IACpB,IAAA,IAASD,EAAI,EAAGA,EAAI,GAAIA,IACpB1M,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAG2iD,GAKpC,IAAA,IAAS5iD,EAAI,EAAGA,EAAI,GAAIA,IACpB1M,KAAKyM,SAASoiD,EAAQniD,EAAG,EAAGJ,GAC5BtM,KAAKyM,SAASoiD,EAAQniD,EAAG,EAAGJ,GAC5BtM,KAAKyM,SAASoiD,EAAQniD,EAAG,GAAIJ,GAIjCtM,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,GAAI,EAAGW,EACjC,CAKQ,kBAAAH,CAAmBR,EAAmBviD,GAC1C,MAAMgjD,EAAYtvD,KAAKuvD,YAAYjjD,EAAO,IACpCkjD,EAAaxvD,KAAKyvD,aAAanjD,EAAO,KAG5C,IAAA,IAASK,EAAI,EAAGA,EAAI,GAAIA,IACpB,IAAA,IAASD,EAAI,EAAGA,EAAI,GAAIA,KACfA,EAAIC,GAAK,GAAM,OAAQF,SAASoiD,EAAQniD,EAAGC,EAAGL,GAC9CtM,KAAKyM,SAASoiD,EAAQniD,EAAGC,EAAG2iD,GAKzCtvD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,EAAGW,GAC5BxvD,KAAKyM,SAASoiD,EAAQ,GAAI,EAAGW,GAC7BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,GAAIW,GAC7BxvD,KAAKyM,SAASoiD,EAAQ,EAAG,GAAIW,EACjC,CAKQ,QAAA/iD,CAASoiD,EAAmBniD,EAAWC,EAAWL,GAClDI,GAAK,GAAKA,EAAI,IAAMC,GAAK,GAAKA,EAAI,KAClCkiD,EAAOliD,GAAGD,GAAK,IAAKJ,GAE5B,CAEQ,WAAAijD,CAAYjjD,EAAc4D,GAC9B,MAAO,CACH5E,EAAGsB,KAAKC,MAAMP,EAAMhB,EAAI4E,GACxB3E,EAAGqB,KAAKC,MAAMP,EAAMf,EAAI2E,GACxB1E,EAAGoB,KAAKC,MAAMP,EAAMd,EAAI0E,GAEhC,CAEQ,YAAAu/C,CAAanjD,EAAc4D,GAC/B,MAAO,CACH5E,EAAGsB,KAAKuD,IAAI,IAAKvD,KAAKC,MAAMP,EAAMhB,EAAI4E,IACtC3E,EAAGqB,KAAKuD,IAAI,IAAKvD,KAAKC,MAAMP,EAAMf,EAAI2E,IACtC1E,EAAGoB,KAAKuD,IAAI,IAAKvD,KAAKC,MAAMP,EAAMd,EAAI0E,IAE9C,CASA,OAAA49C,CAAQ90B,GACJh5B,KAAKqsD,MAAMtjD,IAAIiwB,EAAKtiB,GAAIsiB,GAEnBh5B,KAAKusD,WAAWh3C,IAAIyjB,EAAKk0B,WAC1BltD,KAAKusD,WAAWxjD,IAAIiwB,EAAKk0B,SAAU,IAEvCltD,KAAKusD,WAAWrjD,IAAI8vB,EAAKk0B,UAAWvmD,KAAKqyB,GAErCA,EAAK02B,QACL1vD,KAAKssD,QAAQvjD,IAAIiwB,EAAKtiB,GAAIsiB,EAAK02B,OAEvC,CAKA,OAAAnoD,CAAQmP,GACJ,OAAO1W,KAAKqsD,MAAMnjD,IAAIwN,EAC1B,CAKA,kBAAAi5C,CAAmBzC,GACf,OAAOltD,KAAKusD,WAAWrjD,IAAIgkD,IAAa,EAC5C,CAKA,cAAA0C,CAAe3rD,GACX,OAAOoS,MAAMC,KAAKtW,KAAKqsD,MAAM1zC,UAAU3Q,OAAOgxB,GAAQA,EAAK/0B,OAASA,EACxE,CAKA,gBAAA4rD,CAAiB1C,GACb,OAAO92C,MAAMC,KAAKtW,KAAKqsD,MAAM1zC,UAAU3Q,OAAOgxB,GAAQA,EAAKm0B,SAAWA,EAC1E,CAKA,WAAA2C,GACI,OAAOz5C,MAAMC,KAAKtW,KAAKqsD,MAAM1zC,SACjC,CAKA,SAAAo3C,CAAUC,GACN,OAAOhwD,KAAKssD,QAAQpjD,IAAI8mD,EAC5B,CAKA,WAAAC,CAAY3X,GACR,MAAM4X,EAAa5X,EAAMpe,cACzB,OAAO7jB,MAAMC,KAAKtW,KAAKqsD,MAAM1zC,UAAU3Q,OAAOgxB,GAC1CA,EAAK/yB,KAAKi0B,cAAcriB,SAASq4C,IACjCl3B,EAAKi0B,YAAY/yB,cAAcriB,SAASq4C,GAEhD,CAKA,kBAAAC,CAAmBhD,GACf,IAAIiD,EAEJ,GAAIjD,EACAiD,EAAiBpwD,KAAK6vD,iBAAiB1C,OACpC,CAEH,MAAMkD,EAAgB,CAClBC,OAAqB,GACrBC,SAAuB,GACvBC,KAAmB,GACnBC,KAAmB,EACnBC,UAAwB,IACxBC,SAAuB,IAGrBC,EAAc37B,OAAOtc,OAAO03C,GAAe7uB,OAAO,CAACC,EAAKovB,IAAWpvB,EAAMovB,EAAQ,GACjFtvC,EAAS3U,KAAK2U,SAAWqvC,EAE/B,IAAIE,EAAgB,EAChBC,EAA6B,SAEjC,IAAA,MAAY5D,EAAQ0D,KAAW57B,OAAOvuB,QAAQ2pD,GAE1C,GADAS,GAAiBD,EACbtvC,GAAUuvC,EAAe,CACzBC,EAAiB5D,EACjB,KACJ,CAGJiD,EAAiBpwD,KAAK6vD,iBAAiBkB,EAC3C,CAEA,GAA8B,IAA1BX,EAAexpD,OAAc,OAAO,KAGxC,OAAOwpD,EADaxjD,KAAKC,MAAMD,KAAK2U,SAAW6uC,EAAexpD,QAElE,CAKA,gBAAAoqD,CAAiB19B,EAAoB0F,EAAgBtsB,EAAWC,EAAWvB,EAAgB,GACvF,MAAMoE,EAASwpB,EAAKxpB,OAEpB,IAAA,IAAS9B,EAAK,EAAGA,EAAK8B,EAAO9E,OAAQgD,IACjC,IAAA,IAASD,EAAK,EAAGA,EAAK+B,EAAO/E,MAAOgD,IAAM,CACtC,MAAMwjD,EAAQzhD,EAAOq/C,OAAOnhD,GAAID,GAChC,GAAIwjD,EAAM3lD,EAAI,GAAK2lD,EAAM1lD,EAAI,GAAK0lD,EAAMzlD,EAAI,EACxC,GAAc,IAAVJ,EACAkoB,EAAS7mB,SAASC,EAAIe,EAAId,EAAIe,EAAIujD,QAGlC,IAAA,IAASzjD,EAAK,EAAGA,EAAKpC,EAAOoC,IACzB,IAAA,IAASF,EAAK,EAAGA,EAAKlC,EAAOkC,IACzBgmB,EAAS7mB,SAASC,EAAIe,EAAKrC,EAAQkC,EAAIX,EAAIe,EAAKtC,EAAQoC,EAAIyjD,EAKhF,CAER,CAKA,QAAA1zC,GAMI,MAAM2zC,EAA0C,CAAA,EAC1CC,EAA8C,CAAA,EAOpD,OALAnxD,KAAKqsD,MAAMl9C,QAAQ6pB,IACfk4B,EAAYl4B,EAAK/0B,OAASitD,EAAYl4B,EAAK/0B,OAAS,GAAK,EACzDktD,EAAcn4B,EAAKm0B,SAAWgE,EAAcn4B,EAAKm0B,SAAW,GAAK,IAG9D,CACHV,WAAYzsD,KAAKqsD,MAAMhhD,KACvB6lD,cACAC,gBACA5E,WAAYvsD,KAAKusD,WAAWlhD,KAEpC,ECtgCG,MAAM+lD,EAyBT,WAAAtsD,CACIG,EAAmC,CAAA,EACnC8f,EAA0B,CAAA,EAC1BssC,GAtBJrxD,KAAQsxD,MAAyB,GACjCtxD,KAAQ4wD,YAAsB,EAC9B5wD,KAAQuxD,YAAsB,EAG9BvxD,KAAQwxD,cAAuB,EAC/BxxD,KAAQyxD,YAAgC,KACxCzxD,KAAQgI,OAA0B,CAAA,EAClChI,KAAQ0xD,YAAoC,CAAEC,GAAI,OAAQC,YAAY,EAAOC,aAAa,GAC1F7xD,KAAQ8jD,WAAqB,EAG7B9jD,KAAQ8xD,SAAmB,GAC3B9xD,KAAQ+xD,YAAsB,EAC9B/xD,KAAQmkD,OAAiB,GACzBnkD,KAAQokD,OAAiB,GASrBpkD,KAAKgJ,OAAS,IAAIO,EAAO,oBACzBvJ,KAAKqxD,aAAeA,EACpBrxD,KAAK+kB,OAASA,EAEd/kB,KAAKiF,OAAS,CACV+sD,SAAU,GACVC,UAAW,GACXC,WAAY,EACZC,UAAW,IACXC,UAAW,IACXC,eAAe,KACZptD,GAGPjF,KAAKsyD,kBAELtyD,KAAKgJ,OAAOpD,KAAK,mCAAoC,CACjD0rD,MAAOtxD,KAAKiF,OAAO+sD,SACnBG,UAAWnyD,KAAKiF,OAAOktD,UACvBC,UAAWpyD,KAAKiF,OAAOmtD,WAE/B,CAKQ,eAAAE,GACJtyD,KAAKsxD,MAAQ,GAEb,IAAA,IAAS/kD,EAAI,EAAGA,EAAIvM,KAAKiF,OAAO+sD,SAAUzlD,IAAK,CAC3C,MAAMG,EAAIH,EAAIvM,KAAKiF,OAAOgtD,UACpBtlD,EAAIC,KAAKC,MAAMN,EAAIvM,KAAKiF,OAAOgtD,WAErCjyD,KAAKsxD,MAAM3qD,KAAK,CACZmG,MAAOP,EACPysB,KAAM,KACNtsB,IACAC,IACA4lD,QAAQ,EACRC,UAAU,GAElB,CACJ,CAKA,OAAA1E,CAAQ90B,EAAgBmqB,EAAmB,GACvC,GAAIA,GAAY,EAAG,OAAO,EAE1B,IAAIsP,EAAoBtP,EAGxB,GAAInjD,KAAKiF,OAAOotD,eAAiBr5B,EAAK9B,MAAMk2B,SAAW,EACnD,IAAA,MAAW99B,KAAQtvB,KAAKsxD,MACpB,GAAIhiC,EAAK0J,MAAQ1J,EAAK0J,KAAKA,KAAKtiB,KAAOsiB,EAAKtiB,GAAI,CAC5C,MAAMg8C,EAAS9lD,KAAKuD,IAAIsiD,EAAmBz5B,EAAK9B,MAAMk2B,SAAW99B,EAAK0J,KAAKmqB,UAC3E,GAAIuP,EAAS,IACTpjC,EAAK0J,KAAKmqB,UAAYuP,EACtBD,GAAqBC,EAEK,IAAtBD,GAAyB,KAErC,CAKR,KAAOA,EAAoB,GAAG,CAC1B,MAAME,EAAY3yD,KAAK4yD,gBACvB,IAAKD,EAED,OADA3yD,KAAK+kB,OAAO8tC,qBACL,EAGX,MAAMC,EAAYlmD,KAAKuD,IAAIsiD,EAAmBz5B,EAAK9B,MAAMk2B,UAGnD2F,EAAc/5B,EAAK9B,MAAMrc,KAAOi4C,EAChCE,EAAch6B,EAAK9B,MAAM9W,OAAS0yC,EAExC,GAAI9yD,KAAK4wD,YAAcmC,EAAc/yD,KAAKiF,OAAOktD,UAE7C,OADAnyD,KAAK+kB,OAAOkuC,sBACL,EAGX,GAAIjzD,KAAKuxD,YAAcyB,EAAchzD,KAAKiF,OAAOmtD,UAE7C,OADApyD,KAAK+kB,OAAOmuC,sBACL,EAIXP,EAAU35B,KAAO,CACbA,OACAmqB,SAAU2P,EACVp7B,UAAWsB,EAAK/0B,OAASioD,EAASiH,UAAY,OAAM,GAGxDnzD,KAAK4wD,aAAemC,EACpB/yD,KAAKuxD,aAAeyB,EACpBP,GAAqBK,CACzB,CAKA,OAHA9yD,KAAK+kB,OAAOquC,cAAcp6B,EAAMmqB,GAChCnjD,KAAKgJ,OAAOxD,MAAM,SAAS29C,MAAanqB,EAAK/yB,sBAEtC,CACX,CAKA,UAAAkC,CAAW6nD,EAAgB7M,EAAmB,GAC1C,GAAIA,GAAY,EAAG,OAAO,EAE1B,IAAIsP,EAAoBtP,EAExB,IAAA,MAAW7zB,KAAQtvB,KAAKsxD,MACpB,GAAIhiC,EAAK0J,MAAQ1J,EAAK0J,KAAKA,KAAKtiB,KAAOs5C,GAAUyC,EAAoB,EAAG,CACpE,MAAMY,EAAYzmD,KAAKuD,IAAIsiD,EAAmBnjC,EAAK0J,KAAKmqB,UAGlDmQ,EAAgBhkC,EAAK0J,KAAKA,KAAK9B,MAAMrc,KAAOw4C,EAC5CE,EAAgBjkC,EAAK0J,KAAKA,KAAK9B,MAAM9W,OAASizC,EAOpD,GANArzD,KAAK4wD,aAAe0C,EACpBtzD,KAAKuxD,aAAegC,EAEpBjkC,EAAK0J,KAAKmqB,UAAYkQ,EACtBZ,GAAqBY,EAEM,IAAvB/jC,EAAK0J,KAAKmqB,SAAgB,CAC1B,MAAMqQ,EAAclkC,EAAK0J,KAAKA,KAC9B1J,EAAK0J,KAAO,KACZh5B,KAAK+kB,OAAO0uC,gBAAgBD,EAAaH,EAC7C,CACJ,CAGJ,OAA6B,IAAtBZ,CACX,CAKA,QAAAiB,CAASC,EAAkBC,GACvB,GAAID,EAAW,GAAKA,GAAY3zD,KAAKsxD,MAAM1qD,QACvCgtD,EAAS,GAAKA,GAAU5zD,KAAKsxD,MAAM1qD,OACnC,OAAO,EAGX,MAAM0P,EAAOtW,KAAKsxD,MAAMqC,GAClBl8B,EAAKz3B,KAAKsxD,MAAMsC,GAEtB,IAAKt9C,EAAK0iB,MAAQvB,EAAG86B,OAAQ,OAAO,EAGpC,IAAK96B,EAAGuB,KAGJ,OAFAvB,EAAGuB,KAAO1iB,EAAK0iB,KACf1iB,EAAK0iB,KAAO,MACL,EAIX,GAAIh5B,KAAKiF,OAAOotD,eACZ/7C,EAAK0iB,KAAKA,KAAKtiB,KAAO+gB,EAAGuB,KAAKA,KAAKtiB,IACnCJ,EAAK0iB,KAAKA,KAAK9B,MAAMk2B,SAAW,EAAG,CAEnC,MAAMyG,EAAWjnD,KAAKuD,IAClBmG,EAAK0iB,KAAKmqB,SACV7sC,EAAK0iB,KAAKA,KAAK9B,MAAMk2B,SAAW31B,EAAGuB,KAAKmqB,UAG5C,GAAI0Q,EAAW,EAOX,OANAp8B,EAAGuB,KAAKmqB,UAAY0Q,EACpBv9C,EAAK0iB,KAAKmqB,UAAY0Q,EAEK,IAAvBv9C,EAAK0iB,KAAKmqB,WACV7sC,EAAK0iB,KAAO,OAET,CAEf,CAGA,MAAMyZ,EAAOn8B,EAAK0iB,KAIlB,OAHA1iB,EAAK0iB,KAAOvB,EAAGuB,KACfvB,EAAGuB,KAAOyZ,GAEH,CACX,CAKQ,aAAAmgB,GACJ,OAAO5yD,KAAKsxD,MAAMn/B,KAAK7C,IAASA,EAAK0J,OAAS1J,EAAKijC,SAAW,IAClE,CAKA,YAAAuB,CAAa9D,GACT,OAAOhwD,KAAKsxD,MACPtpD,OAAOsnB,GAAQA,EAAK0J,MAAQ1J,EAAK0J,KAAKA,KAAKtiB,KAAOs5C,GAClDxuB,OAAO,CAACD,EAAOjS,IAASiS,EAAQjS,EAAK0J,KAAMmqB,SAAU,EAC9D,CAKA,OAAA4Q,CAAQ/D,EAAgB7M,EAAmB,GACvC,OAAOnjD,KAAK8zD,aAAa9D,IAAW7M,CACxC,CAKA,WAAA2M,GACI,OAAO9vD,KAAKsxD,MACPtpD,OAAOsnB,GAAsB,OAAdA,EAAK0J,MACpB/pB,IAAIqgB,GAAQA,EAAK0J,KAC1B,CAKA,gBAAAg7B,GACI,IAAI3H,EAAQrsD,KAAK8vD,cAWjB,GARI9vD,KAAKgI,OAAO/D,OACZooD,EAAQA,EAAMrkD,OAAOjC,GAASA,EAAMizB,KAAK/0B,OAASjE,KAAKgI,OAAO/D,OAG9DjE,KAAKgI,OAAOmlD,SACZd,EAAQA,EAAMrkD,OAAOjC,GAASA,EAAMizB,KAAKm0B,SAAWntD,KAAKgI,OAAOmlD,SAGhEntD,KAAKgI,OAAOisD,WAAY,CACxB,MAAMC,EAASl0D,KAAKgI,OAAOisD,WAAW/5B,cACtCmyB,EAAQA,EAAMrkD,OAAOjC,GACjBA,EAAMizB,KAAK/yB,KAAKi0B,cAAcriB,SAASq8C,IACvCnuD,EAAMizB,KAAKi0B,YAAY/yB,cAAcriB,SAASq8C,GAEtD,CAyBA,OAtBA7H,EAAM5D,KAAK,CAACj8C,EAAGhB,KACX,IAAI2oD,EAAa,EAEjB,OAAQn0D,KAAK0xD,YAAYC,IACrB,IAAK,OACDwC,EAAa3nD,EAAEwsB,KAAK/yB,KAAKmuD,cAAc5oD,EAAEwtB,KAAK/yB,MAC9C,MACJ,IAAK,OACDkuD,EAAa3nD,EAAEwsB,KAAK/0B,KAAKmwD,cAAc5oD,EAAEwtB,KAAK/0B,MAC9C,MACJ,IAAK,SACD,MAAMowD,EAAc,CAAC,SAAU,WAAY,OAAQ,OAAQ,YAAa,YACxEF,EAAaE,EAAY/iC,QAAQ9kB,EAAEwsB,KAAKm0B,QAAUkH,EAAY/iC,QAAQ9lB,EAAEwtB,KAAKm0B,QAC7E,MACJ,IAAK,WACDgH,EAAa3nD,EAAE22C,SAAW33C,EAAE23C,SAIpC,OAAOnjD,KAAK0xD,YAAYE,YAAcuC,EAAaA,IAGhD9H,CACX,CAKA,gBAAAiI,GACI,MAAMjI,EAAqB,GAG3BrsD,KAAKsxD,MAAMniD,QAAQmgB,IACXA,EAAK0J,OACLqzB,EAAM1lD,KAAK2oB,EAAK0J,MAChB1J,EAAK0J,KAAO,QAKpBh5B,KAAK4wD,YAAc,EACnB5wD,KAAKuxD,YAAc,EAGnBlF,EAAMl9C,QAAQpJ,IACV/F,KAAK8tD,QAAQ/nD,EAAMizB,KAAMjzB,EAAMo9C,YAGnCnjD,KAAKgJ,OAAOpD,KAAK,yBACrB,CAKA,QAAA2uD,GACI,MAAMlI,EAAQrsD,KAAK8vD,cAGnB9vD,KAAKsxD,MAAMniD,QAAQmgB,GAAQA,EAAK0J,KAAO,MACvCh5B,KAAK4wD,YAAc,EACnB5wD,KAAKuxD,YAAc,EAGnBlF,EAAM5D,KAAK,CAACj8C,EAAGhB,KAEX,GAAIgB,EAAEwsB,KAAK/0B,OAASuH,EAAEwtB,KAAK/0B,KACvB,OAAOuI,EAAEwsB,KAAK/0B,KAAKmwD,cAAc5oD,EAAEwtB,KAAK/0B,MAI5C,MAAMowD,EAAc,CAAC,WAAY,YAAa,OAAQ,OAAQ,WAAY,UACpEG,EAAUH,EAAY/iC,QAAQ9kB,EAAEwsB,KAAKm0B,QACrCsH,EAAUJ,EAAY/iC,QAAQ9lB,EAAEwtB,KAAKm0B,QAE3C,OAAIqH,IAAYC,EACLD,EAAUC,EAIdjoD,EAAEwsB,KAAK/yB,KAAKmuD,cAAc5oD,EAAEwtB,KAAK/yB,QAI5ComD,EAAMl9C,QAAQpJ,IACV/F,KAAK8tD,QAAQ/nD,EAAMizB,KAAMjzB,EAAMo9C,YAGnCnjD,KAAKgJ,OAAOpD,KAAK,2BACrB,CAKA,QAAA2X,GAaI,MAAMm3C,EAAY10D,KAAKsxD,MAAMtpD,UAA6B,OAAdsnB,EAAK0J,MAAepyB,OAC1D+tD,EAAc,IAAI/8C,IAAI5X,KAAKsxD,MAC5BtpD,OAAOsnB,GAAQA,EAAK0J,MACpB/pB,IAAIqgB,GAAQA,EAAK0J,KAAMA,KAAKtiB,KAC/BrL,KAEIohD,EAAazsD,KAAKsxD,MACnBtpD,OAAOsnB,GAAQA,EAAK0J,MACpBwI,OAAO,CAACD,EAAOjS,IAASiS,EAAQjS,EAAK0J,KAAMmqB,SAAU,GAE1D,MAAO,CACHuR,YACAE,WAAY50D,KAAKiF,OAAO+sD,SACxBpB,YAAa5wD,KAAK4wD,YAClBuB,UAAWnyD,KAAKiF,OAAOktD,UACvBZ,YAAavxD,KAAKuxD,YAClBa,UAAWpyD,KAAKiF,OAAOmtD,UACvByC,UAAWpI,EACXkI,cACAG,eAAiBJ,EAAY10D,KAAKiF,OAAO+sD,SAAY,IACrD+C,iBAAmB/0D,KAAK4wD,YAAc5wD,KAAKiF,OAAOktD,UAAa,IAC/D6C,iBAAmBh1D,KAAKuxD,YAAcvxD,KAAKiF,OAAOmtD,UAAa,IAEvE,CAKA,MAAA/+B,CAAOC,GACEtzB,KAAK8jD,YAGV9jD,KAAKi1D,iBAAiB3hC,GAGtBtzB,KAAKk1D,aAAa5hC,GAGlBtzB,KAAKm1D,WAAW7hC,GAGhBtzB,KAAKo1D,YAAY9hC,GAGbtzB,KAAKwxD,cAAgB,GACrBxxD,KAAKq1D,gBAAgB/hC,GAIrBtzB,KAAKyxD,aACLzxD,KAAKs1D,kBAAkBhiC,GAI3BtzB,KAAK4J,YAAY0pB,GACrB,CAKQ,gBAAA2hC,CAAiB3hC,GACrB,MAAMinB,EAAav6C,KAAKiF,OAAOgtD,WAAajyD,KAAK8xD,SAAW9xD,KAAK+xD,aAAe,GAC1E9X,EAAcj6C,KAAKiF,OAAOitD,YAAclyD,KAAK8xD,SAAW9xD,KAAK+xD,aAAe,IAGlFz+B,EAAStnB,SAAShM,KAAKmkD,OAAQnkD,KAAKokD,OAAQ7J,EAAYN,EAAa,CAAE3uC,EAAG,EAAGC,EAAG,GAAIC,EAAG,IAGvF8nB,EAASrmB,SAASjN,KAAKmkD,OAAQnkD,KAAKokD,OAAQpkD,KAAKmkD,OAAS5J,EAAYv6C,KAAKokD,OAAQ,CAAE94C,EAAG,GAAIC,EAAG,GAAIC,EAAG,KACtG8nB,EAASrmB,SAASjN,KAAKmkD,OAAQnkD,KAAKokD,OAAQpkD,KAAKmkD,OAAQnkD,KAAKokD,OAASnK,EAAa,CAAE3uC,EAAG,GAAIC,EAAG,GAAIC,EAAG,KACvG8nB,EAASrmB,SAASjN,KAAKmkD,OAAS5J,EAAYv6C,KAAKokD,OAAQpkD,KAAKmkD,OAAS5J,EAAYv6C,KAAKokD,OAASnK,EAAa,CAAE3uC,EAAG,GAAIC,EAAG,GAAIC,EAAG,KACjI8nB,EAASrmB,SAASjN,KAAKmkD,OAAQnkD,KAAKokD,OAASnK,EAAaj6C,KAAKmkD,OAAS5J,EAAYv6C,KAAKokD,OAASnK,EAAa,CAAE3uC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACtI,CAKQ,YAAA0pD,CAAa5hC,GACjBA,EAASnlB,WAAW,YAAanO,KAAKmkD,OAAS,GAAInkD,KAAKokD,OAAS,GAAI,CAAE94C,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,IAG9F,MAAM+pD,EAAUv1D,KAAKokD,OAAS,GAC9B9wB,EAASnlB,WAAW,SAAUnO,KAAKmkD,OAAS,GAAIoR,EAAS,CAAEjqD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,GAClF8nB,EAASnlB,WAAW,YAAanO,KAAKmkD,OAAS,GAAIoR,EAAS,CAAEjqD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,GACrF8nB,EAASnlB,WAAW,WAAYnO,KAAKmkD,OAAS,IAAKoR,EAAS,CAAEjqD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,EACzF,CAKQ,UAAA2pD,CAAW7hC,GACf,MAAMkiC,EAAax1D,KAAKmkD,OAAS,GAC3BsR,EAAaz1D,KAAKokD,OAAS,GAEjC,IAAA,IAASz3C,EAAI,EAAGA,EAAI3M,KAAKiF,OAAOitD,WAAYvlD,IACxC,IAAA,IAASD,EAAI,EAAGA,EAAI1M,KAAKiF,OAAOgtD,UAAWvlD,IAAK,CAC5C,MAAMgpD,EAAQF,EAAa9oD,GAAK1M,KAAK8xD,SAAW9xD,KAAK+xD,aAC/C4D,EAAQF,EAAa9oD,GAAK3M,KAAK8xD,SAAW9xD,KAAK+xD,aAE/C6D,EAAYjpD,EAAI3M,KAAKiF,OAAOgtD,UAAYvlD,EACxC4iB,EAAOtvB,KAAKsxD,MAAMsE,GAGxB,IAAI5X,EAAU,CAAE1yC,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC7B8jB,EAAKijC,OACLvU,EAAU,CAAE1yC,EAAG,GAAIC,EAAG,EAAGC,EAAG,GACrB8jB,EAAKkjC,WACZxU,EAAU,CAAE1yC,EAAG,EAAGC,EAAG,GAAIC,EAAG,IAGhC8nB,EAAStnB,SAAS0pD,EAAOC,EAAO31D,KAAK8xD,SAAU9xD,KAAK8xD,SAAU9T,GAG9D,MAAM8H,EAAc,CAAEx6C,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACvC8nB,EAASrmB,SAASyoD,EAAOC,EAAOD,EAAQ11D,KAAK8xD,SAAU6D,EAAO7P,GAC9DxyB,EAASrmB,SAASyoD,EAAOC,EAAOD,EAAOC,EAAQ31D,KAAK8xD,SAAUhM,GAC9DxyB,EAASrmB,SAASyoD,EAAQ11D,KAAK8xD,SAAU6D,EAAOD,EAAQ11D,KAAK8xD,SAAU6D,EAAQ31D,KAAK8xD,SAAUhM,GAC9FxyB,EAASrmB,SAASyoD,EAAOC,EAAQ31D,KAAK8xD,SAAU4D,EAAQ11D,KAAK8xD,SAAU6D,EAAQ31D,KAAK8xD,SAAUhM,EAClG,CAER,CAKQ,WAAAsP,CAAY9hC,GAChB,MAAMkiC,EAAax1D,KAAKmkD,OAAS,GAC3BsR,EAAaz1D,KAAKokD,OAAS,GAEjCpkD,KAAKsxD,MAAMniD,QAAQ,CAACmgB,EAAMxiB,KACtB,IAAKwiB,EAAK0J,KAAM,OAEhB,MAAM08B,EAAQF,EAAalmC,EAAK5iB,GAAK1M,KAAK8xD,SAAW9xD,KAAK+xD,aACpD4D,EAAQF,EAAanmC,EAAK3iB,GAAK3M,KAAK8xD,SAAW9xD,KAAK+xD,aAGpD8D,EAAUH,GAAS11D,KAAK8xD,SAAW,IAAM,EACzCgE,EAAUH,GAAS31D,KAAK8xD,SAAW,IAAM,EAI/C,GAHA9xD,KAAKqxD,aAAaL,iBAAiB19B,EAAUhE,EAAK0J,KAAKA,KAAM68B,EAASC,EAAS,GAG3ExmC,EAAK0J,KAAKmqB,SAAW,EAAG,CACxB,MAAM4S,EAAezmC,EAAK0J,KAAKmqB,SAAShyC,WACxCmiB,EAASnlB,WAAW4nD,EAAcL,EAAQ11D,KAAK8xD,SAAW,GAAI6D,EAAQ31D,KAAK8xD,SAAW,GAClF,CAAExmD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,EACjC,CAGA,MAAMwqD,EAAch2D,KAAKi2D,eAAe3mC,EAAK0J,KAAKA,KAAKm0B,QAIvD,GAHA75B,EAAStnB,SAAS0pD,EAAQ,EAAGC,EAAQ,EAAG,EAAG,EAAGK,QAGlB,IAAxB1mC,EAAK0J,KAAKtB,UAAyB,CACnC,MAAMw+B,EAAiBtpD,KAAKC,OAAO7M,KAAK8xD,SAAW,GAAKxiC,EAAK0J,KAAKtB,WAC5Dy+B,EAAiB7mC,EAAK0J,KAAKtB,UAAY,GACzC,CAAEpsB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB8jB,EAAK0J,KAAKtB,UAAY,GAClB,CAAEpsB,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAE3B8nB,EAAStnB,SAAS0pD,EAAQ,EAAGC,EAAQ31D,KAAK8xD,SAAW,EAAGoE,EAAgB,EAAGC,EAC/E,GAER,CAKQ,cAAAF,CAAe9I,GACnB,OAAQA,GACJ,KAAKhB,EAAWiK,OAAQ,MAAO,CAAE9qD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAClD,KAAK2gD,EAAWkK,SAAU,MAAO,CAAE/qD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACpD,KAAK2gD,EAAWmK,KAAM,MAAO,CAAEhrD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAChD,KAAK2gD,EAAWoK,KAAM,MAAO,CAAEjrD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAChD,KAAK2gD,EAAWqK,UAAW,MAAO,CAAElrD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACrD,KAAK2gD,EAAWsK,SAAU,MAAO,CAAEnrD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACpD,QAAS,MAAO,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAE3C,CAKQ,eAAA6pD,CAAgB/hC,GACpB,MAAMhE,EAAOtvB,KAAKsxD,MAAMtxD,KAAKwxD,cAC7B,IAAKliC,EAAM,OAEX,MAAMkmC,EAAax1D,KAAKmkD,OAAS,GAC3BsR,EAAaz1D,KAAKokD,OAAS,GAC3BsR,EAAQF,EAAalmC,EAAK5iB,GAAK1M,KAAK8xD,SAAW9xD,KAAK+xD,aACpD4D,EAAQF,EAAanmC,EAAK3iB,GAAK3M,KAAK8xD,SAAW9xD,KAAK+xD,aAGpD5L,EAAiB,CAAE76C,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC1C8nB,EAASrmB,SAASyoD,EAAQ,EAAGC,EAAQ,EAAGD,EAAQ11D,KAAK8xD,SAAW,EAAG6D,EAAQ,EAAGxP,GAC9E7yB,EAASrmB,SAASyoD,EAAQ,EAAGC,EAAQ,EAAGD,EAAQ,EAAGC,EAAQ31D,KAAK8xD,SAAW,EAAG3L,GAC9E7yB,EAASrmB,SAASyoD,EAAQ11D,KAAK8xD,SAAW,EAAG6D,EAAQ,EAAGD,EAAQ11D,KAAK8xD,SAAW,EAAG6D,EAAQ31D,KAAK8xD,SAAW,EAAG3L,GAC9G7yB,EAASrmB,SAASyoD,EAAQ,EAAGC,EAAQ31D,KAAK8xD,SAAW,EAAG4D,EAAQ11D,KAAK8xD,SAAW,EAAG6D,EAAQ31D,KAAK8xD,SAAW,EAAG3L,EAClH,CAKQ,iBAAAmP,CAAkBhiC,GAE1B,CAKQ,WAAA1pB,CAAY0pB,GAChB,MAAM4D,EAAQl3B,KAAKud,WACbm5C,EAAS12D,KAAKokD,OAASpkD,KAAKiF,OAAOitD,YAAclyD,KAAK8xD,SAAW9xD,KAAK+xD,aAAe,GAErFhjD,EAAY,CAAEzD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAErC8nB,EAASnlB,WAAW,UAAU+oB,EAAMw9B,aAAax9B,EAAM09B,aACnD50D,KAAKmkD,OAAS,GAAIuS,EAAQ3nD,EAAW,GAEzCukB,EAASnlB,WAAW,WAAW+oB,EAAM05B,YAAYvnD,QAAQ,MAAM6tB,EAAMi7B,YACjEnyD,KAAKmkD,OAAS,GAAIuS,EAAS,GAAI3nD,EAAW,GAE9CukB,EAASnlB,WAAW,WAAW+oB,EAAMq6B,YAAYloD,QAAQ,MAAM6tB,EAAMk7B,YACjEpyD,KAAKmkD,OAAS,GAAIuS,EAAS,GAAI3nD,EAAW,GAE9CukB,EAASnlB,WAAW,UAAU+oB,EAAM29B,cAAc39B,EAAMy9B,qBACpD30D,KAAKmkD,OAAS,GAAIuS,EAAS,GAAI3nD,EAAW,EAClD,CAKA,UAAA4nD,CAAWC,GACP52D,KAAK8jD,UAAY8S,CACrB,CAKA,kBAAAC,GACI,OAAO72D,KAAK8jD,SAChB,CAKA,UAAAgT,CAAWlB,GACHA,GAAa,GAAKA,EAAY51D,KAAKsxD,MAAM1qD,SACzC5G,KAAKwxD,aAAeoE,EACpB51D,KAAK+kB,OAAOgyC,iBAAiB/2D,KAAKsxD,MAAMsE,IAEhD,CAKA,eAAAoB,GACI,OAAOh3D,KAAKwxD,cAAgB,EAAIxxD,KAAKsxD,MAAMtxD,KAAKwxD,cAAgB,IACpE,CAKA,eAAAyF,GACI,MAAM3nC,EAAOtvB,KAAKg3D,kBAClB,IAAK1nC,IAASA,EAAK0J,KAAM,OAAO,EAEhC,MAAMA,EAAO1J,EAAK0J,KAAKA,KAEvB,QAAIA,EAAK60B,eAEL7tD,KAAKmI,WAAW6wB,EAAKtiB,GAAI,GACzB1W,KAAKgJ,OAAOpD,KAAK,QAAQozB,EAAK/yB,SACvB,EAIf,CAKA,SAAAixD,CAAUlvD,GACNhI,KAAKgI,OAAS,IAAKhI,KAAKgI,UAAWA,EACvC,CAKA,WAAAmvD,GACIn3D,KAAKgI,OAAS,CAAA,CAClB,CAKA,cAAAovD,CAAenlB,GACXjyC,KAAK0xD,YAAc,IAAK1xD,KAAK0xD,eAAgBzf,EACjD,CAKA,aAAAolB,CAAczB,EAAmBrD,GACzBqD,GAAa,GAAKA,EAAY51D,KAAKsxD,MAAM1qD,SACzC5G,KAAKsxD,MAAMsE,GAAWrD,OAASA,EAEvC,CAKA,eAAA+E,CAAgB1B,EAAmBpD,GAC3BoD,GAAa,GAAKA,EAAY51D,KAAKsxD,MAAM1qD,SACzC5G,KAAKsxD,MAAMsE,GAAWpD,SAAWA,EAEzC,CAKA,cAAA+E,GACIv3D,KAAKsxD,MAAMniD,QAAQmgB,GAAQA,EAAK0J,KAAO,MACvCh5B,KAAK4wD,YAAc,EACnB5wD,KAAKuxD,YAAc,EACnBvxD,KAAKwxD,cAAe,EACpBxxD,KAAKgJ,OAAOpD,KAAK,uBACrB,CAKA,SAAA4xD,GACI,MAAO,CACHlG,MAAOtxD,KAAKsxD,MAAMriD,IAAIqgB,IAAA,CAClBxiB,MAAOwiB,EAAKxiB,MACZksB,KAAM1J,EAAK0J,KAAO,CACdg3B,OAAQ1gC,EAAK0J,KAAKA,KAAKtiB,GACvBysC,SAAU7zB,EAAK0J,KAAKmqB,SACpBzrB,UAAWpI,EAAK0J,KAAKtB,UACrB+/B,UAAWnoC,EAAK0J,KAAKy+B,WACrB,KACJlF,OAAQjjC,EAAKijC,OACbC,SAAUljC,EAAKkjC,YAEnB5B,YAAa5wD,KAAK4wD,YAClBW,YAAavxD,KAAKuxD,YAE1B,CAKA,SAAAmG,CAAUrgD,GACNrX,KAAKu3D,iBAELlgD,EAAMi6C,MAAMniD,QAAQ,CAACwoD,EAAe7qD,KAChC,GAAIA,EAAQ9M,KAAKsxD,MAAM1qD,OAAQ,CAC3B,MAAM0oB,EAAOtvB,KAAKsxD,MAAMxkD,GAIxB,GAHAwiB,EAAKijC,OAASoF,EAASpF,SAAU,EACjCjjC,EAAKkjC,SAAWmF,EAASnF,WAAY,EAEjCmF,EAAS3+B,KAAM,CACf,MAAMA,EAAOh5B,KAAKqxD,aAAa9pD,QAAQowD,EAAS3+B,KAAKg3B,QACjDh3B,IACA1J,EAAK0J,KAAO,CACRA,OACAmqB,SAAUwU,EAAS3+B,KAAKmqB,SACxBzrB,UAAWigC,EAAS3+B,KAAKtB,UACzB+/B,UAAWE,EAAS3+B,KAAKy+B,WAGrC,CACJ,IAGJz3D,KAAK4wD,YAAcv5C,EAAMu5C,aAAe,EACxC5wD,KAAKuxD,YAAcl6C,EAAMk6C,aAAe,EAExCvxD,KAAKgJ,OAAOpD,KAAK,4BACrB,EC1wBG,MAAMgyD,EAiBT,WAAA9yD,CACIusD,EACAwG,EACA9yC,EAAyB,CAAA,GAd7B/kB,KAAQ83D,aAA6ChvD,IACrD9I,KAAQ+3D,eAAoC,GAC5C/3D,KAAQg4D,iBAAgCpgD,IAGxC5X,KAAQ8jD,WAAqB,EAC7B9jD,KAAQi4D,gBAAiC,KACzCj4D,KAAQk4D,eAAgC,KASpCl4D,KAAKgJ,OAAS,IAAIO,EAAO,kBACzBvJ,KAAKqxD,aAAeA,EACpBrxD,KAAK63D,UAAYA,EACjB73D,KAAK+kB,OAASA,EAEd/kB,KAAKm4D,qBACLn4D,KAAKo4D,yBAELp4D,KAAKgJ,OAAOpD,KAAK,iCAAkC,CAC/CkyD,SAAU93D,KAAK83D,SAASzsD,KACxB2sD,aAAch4D,KAAKg4D,aAAa3sD,MAExC,CAKQ,kBAAA8sD,GACgC,CAChC,CACIzhD,GAAI,mBACJzQ,KAAM,mBACNhC,KAAM,QACNo0D,iBAAkB,GAClBC,eAAgB,GAChB31B,UAAU,GAEd,CACIjsB,GAAI,iBACJzQ,KAAM,iBACNhC,KAAM,WACNo0D,iBAAkB,GAClBC,eAAgB,GAChB31B,UAAU,GAEd,CACIjsB,GAAI,mBACJzQ,KAAM,mBACNhC,KAAM,aACNo0D,iBAAkB,GAClBC,eAAgB,GAChB31B,UAAU,IAITxzB,QAAQopD,IACbv4D,KAAK83D,SAAS/uD,IAAIwvD,EAAQ7hD,GAAI6hD,IAEtC,CAKQ,sBAAAH,GAEJ,MAAMI,EAA6B,CAC/B,CACI9hD,GAAI,2BACJ+hD,cAAe,CACXC,WAAc,EACdC,eAAkB,GAEtBC,aAAc,EACdl1B,WAAY,GACZm1B,YAAa,IAEjB,CACIniD,GAAI,mBACJ+hD,cAAe,CACXC,WAAc,EACdI,aAAgB,GAEpBF,aAAc,EACdl1B,WAAY,GACZm1B,YAAa,KAEjB,CACIniD,GAAI,oBACJ+hD,cAAe,CACXE,eAAkB,EAClBI,aAAgB,GAEpBH,aAAc,EACdl1B,WAAY,EACZm1B,YAAa,KAEjB,CACIniD,GAAI,uBACJ+hD,cAAe,CACXO,eAAkB,EAClBL,eAAkB,EAClBG,aAAgB,GAEpBF,aAAc,GACdl1B,WAAY,GACZm1B,YAAa,IAEjB,CACIniD,GAAI,uBACJ+hD,cAAe,CACXO,eAAkB,EAClBC,kBAAqB,EACrBH,aAAgB,GAEpBF,aAAc,GACdl1B,WAAY,GACZm1B,YAAa,KAKrBL,EAAarpD,QAAQugD,IAEjB,MAAMwJ,EAAel5D,KAAK83D,SAAS5uD,IAAI,oBAMvC,GALIgwD,GACAA,EAAab,iBAAiB1xD,KAAK+oD,EAAOh5C,IAI1Cg5C,EAAOhsB,WAAa,GAAI,CACxB,MAAMy1B,EAAkBn5D,KAAK83D,SAAS5uD,IAAI,kBACtCiwD,GACAA,EAAgBd,iBAAiB1xD,KAAK+oD,EAAOh5C,GAErD,CAGIg5C,EAAOhsB,YAAc,IACrB1jC,KAAKg4D,aAAaxiD,IAAIk6C,EAAOh5C,MAKrC1W,KAAKo5D,kBAAkBZ,EAC3B,CAKQ,iBAAAY,CAAkB9M,GACtBA,EAAQn9C,QAAQugD,IAEZ,MAAM2J,EAAar5D,KAAKs5D,wBAAwB5J,EAAOh5C,IACnD2iD,IACAA,EAAW3J,OAASA,IAGhC,CAKQ,uBAAA4J,CAAwBC,GAE5B,MAQMvJ,EAR6C,CAC/CwJ,yBAA4B,eAC5BC,iBAAoB,kBACpBC,kBAAqB,mBACrBC,qBAAwB,sBACxBC,qBAAwB,uBAGGL,GAC/B,OAAOvJ,EAAShwD,KAAKqxD,aAAa9pD,QAAQyoD,QAAU,CACxD,CAKA,aAAA6J,CAAcN,EAAkBO,GAC5B,MAAMvB,EAAUv4D,KAAK83D,SAAS5uD,IAAI4wD,GAC5BT,EAAar5D,KAAKs5D,wBAAwBC,GAEhD,IAAKhB,IAAYc,IAAeA,EAAW3J,OAEvC,OADA1vD,KAAK+kB,OAAOg1C,mBAAmB,8BACxB,EAGX,IAAKxB,EAAQ51B,SAET,OADA3iC,KAAK+kB,OAAOg1C,mBAAmB,gCACxB,EAGX,IAAK/5D,KAAKg4D,aAAaziD,IAAIgkD,GAEvB,OADAv5D,KAAK+kB,OAAOg1C,mBAAmB,8BACxB,EAGX,IAAKxB,EAAQF,iBAAiBxgD,SAAS0hD,GAEnC,OADAv5D,KAAK+kB,OAAOg1C,mBAAmB,mCACxB,EAGX,MAAMrK,EAAS2J,EAAW3J,OAG1B,IAAA,MAAYM,EAAQ7M,KAAaluB,OAAOvuB,QAAQgpD,EAAO+I,eACnD,IAAKz4D,KAAK63D,UAAU9D,QAAQ/D,EAAQ7M,GAEhC,OADAnjD,KAAK+kB,OAAOg1C,mBAAmB,gBAAgB/J,WAAgB7M,MACxD,EAQf,IAAA,MAAY6M,EAAQ7M,KAAaluB,OAAOvuB,QAAQgpD,EAAO+I,eACnDz4D,KAAK63D,UAAU1vD,WAAW6nD,EAAQ7M,GAItC,MAAM6W,EAA2B,CAC7BT,WACAhB,UACAtvD,UAAW5C,KAAKC,MAChB6C,SAAgC,IAAtBumD,EAAOkJ,aACjBl1B,WAAYgsB,EAAOhsB,WACnBm1B,YAAanJ,EAAOmJ,aAYxB,OATA74D,KAAK+3D,eAAepxD,KAAKqzD,GACzBh6D,KAAK+kB,OAAOk1C,oBAAoBD,GAEhCh6D,KAAKgJ,OAAOpD,KAAK,uBAAuByzD,EAAWpzD,OAAQ,CACvDsyD,QAASA,EAAQtyD,KACjBkD,SAAUumD,EAAOkJ,aACjBC,YAAanJ,EAAOmJ,eAGjB,CACX,CAKA,MAAArkD,CAAOC,GACH,MAAM2O,EAAc/c,KAAKC,MACnB4zD,EAAuC,GAG7Cl6D,KAAK+3D,eAAe5oD,QAAQ6qD,IACpB52C,GAAe42C,EAAQ/wD,UAAY+wD,EAAQ7wD,UAC3C+wD,EAAkBvzD,KAAKqzD,KAK/BE,EAAkB/qD,QAAQ6qD,IACtBh6D,KAAKm6D,iBAAiBH,KAI1Bh6D,KAAK+3D,eAAiB/3D,KAAK+3D,eAAe/vD,OACtCgyD,IAAYE,EAAkBriD,SAASmiD,GAE/C,CAKQ,gBAAAG,CAAiBH,GACrB,MAAMX,EAAar5D,KAAKs5D,wBAAwBU,EAAQT,UACxD,IAAKF,EAAY,OAKjB,GAFgBzsD,KAAK2U,SAAWy4C,EAAQnB,YAE3B,CAEK74D,KAAK63D,UAAU/J,QAAQuL,EAAY,IAE7Cr5D,KAAKgJ,OAAOpD,KAAK,0BAA0ByzD,EAAWpzD,QACtDjG,KAAK+kB,OAAOq1C,sBAAsBf,GAAY,KAE9Cr5D,KAAKgJ,OAAOnD,KAAK,uBAAuBwzD,EAAWpzD,aACnDjG,KAAK+kB,OAAOg1C,mBAAmB,8BAEvC,MAKI,GAJA/5D,KAAKgJ,OAAOnD,KAAK,sBAAsBwzD,EAAWpzD,QAClDjG,KAAK+kB,OAAOq1C,sBAAsBf,GAAY,GAG1CA,EAAW3J,OACX,IAAA,MAAYM,EAAQ7M,KAAaluB,OAAOvuB,QAAQ2yD,EAAW3J,OAAO+I,eAC9D,GAAI7rD,KAAK2U,SAAW,GAAK,CACrB,MAAM84C,EAAiBztD,KAAK0tD,KAAgB,GAAXnX,GAC3BnqB,EAAOh5B,KAAKqxD,aAAa9pD,QAAQyoD,GACnCh3B,GACAh5B,KAAK63D,UAAU/J,QAAQ90B,EAAMqhC,EAErC,CAIhB,CAKA,WAAAE,CAAYhB,GACR,OAAIv5D,KAAKg4D,aAAaziD,IAAIgkD,KAI1Bv5D,KAAKg4D,aAAaxiD,IAAI+jD,GACtBv5D,KAAKgJ,OAAOpD,KAAK,0BAA0B2zD,MACpC,EACX,CAKA,mBAAAiB,CAAoBV,GAChB,MAAMvB,EAAUv4D,KAAK83D,SAAS5uD,IAAI4wD,GAClC,OAAKvB,EAEEA,EAAQF,iBACVrwD,OAAOuxD,GAAYv5D,KAAKg4D,aAAaziD,IAAIgkD,IACzCtqD,IAAIsqD,GAAYv5D,KAAKs5D,wBAAwBC,IAC7CvxD,OAAOgxB,QAAiB,IAATA,GALC,EAMzB,CAKA,cAAAyhC,CAAelB,GAKX,MAAMF,EAAar5D,KAAKs5D,wBAAwBC,GAChD,IAAKF,IAAeA,EAAW3J,OAC3B,MAAO,CAAEgL,UAAU,EAAOC,aAAc,CAAA,EAAIC,YAAY,GAG5D,MAAMlL,EAAS2J,EAAW3J,OACpBiL,EAA6C,CAAA,EACnD,IAAIE,GAAc,EAGlB,IAAA,MAAY7K,EAAQ5uB,KAAanM,OAAOvuB,QAAQgpD,EAAO+I,eAAgB,CACnE,MAAMt3B,EAAYnhC,KAAK63D,UAAU/D,aAAa9D,GAC1C7uB,EAAYC,IACZu5B,EAAa3K,GAAU5uB,EAAWD,EAClC05B,GAAc,EAEtB,CAGA,MAAMD,EAAavkD,MAAMC,KAAKtW,KAAK83D,SAASn/C,UAAUsa,QAClDslC,EAAQ51B,UAAY41B,EAAQF,iBAAiBxgD,SAAS0hD,IAG1D,MAAO,CACHmB,SAAUG,GAAeD,GAAc56D,KAAKg4D,aAAaziD,IAAIgkD,GAC7DoB,eACAC,aAER,CAKA,mBAAAE,GAMI,MAAM13C,EAAc/c,KAAKC,MAEzB,OAAOtG,KAAK+3D,eAAe9oD,IAAI+qD,IAC3B,MAAMe,EAAU33C,EAAc42C,EAAQ/wD,UAChCuY,EAAW5U,KAAKuD,IAAI,EAAG4qD,EAAUf,EAAQ7wD,UACzC6xD,EAAgBpuD,KAAKoC,IAAI,GAAIgrD,EAAQ7wD,SAAW4xD,GAAW,KAE3D1B,EAAar5D,KAAKs5D,wBAAwBU,EAAQT,UAExD,MAAO,CACHA,SAAUS,EAAQT,SAClB0B,SAAU5B,GAAYpzD,MAAQ,UAC9Bub,WACAw5C,kBAGZ,CAKA,MAAA3nC,CAAOC,GACEtzB,KAAK8jD,YAGV9jD,KAAKk7D,oBAAoB5nC,GAGzBtzB,KAAKm7D,uBAAuB7nC,GAChC,CAKQ,mBAAA4nC,CAAoB5nC,GACxB,MAAM6wB,EAAS,IACTC,EAAS,IACT7J,EAAa,IACbN,EAAc,IAGpB3mB,EAAStnB,SAASm4C,EAAQC,EAAQ7J,EAAYN,EAAa,CAAE3uC,EAAG,EAAGC,EAAG,GAAIC,EAAG,IAG7E,MAAMs6C,EAAc,CAAEx6C,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACvC8nB,EAASrmB,SAASk3C,EAAQC,EAAQD,IAAqBC,EAAQ0B,GAC/DxyB,EAASrmB,SAASk3C,EAAQC,EAAQD,EAAQC,IAAsB0B,GAChExyB,EAASrmB,SAASk3C,IAAqBC,EAAQD,IAAqBC,IAAsB0B,GAC1FxyB,EAASrmB,SAASk3C,EAAQC,IAAsBD,IAAqBC,IAAsB0B,GAG3FxyB,EAASnlB,WAAW,mBAAoBg2C,IAAaC,IAAa,CAAE94C,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,IAG3F,IAAI4vD,EAAWhX,IAaf,GAZApkD,KAAK83D,SAAS3oD,QAAQopD,IAClB,MAAM8C,EAAe9C,EAAQ51B,SACzB,CAAEr3B,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAEjB8vD,EAAa/C,EAAQ51B,SAAW,SAAW,UACjDrP,EAASnlB,WAAW,IAAIoqD,EAAQ7hD,OAAO6hD,EAAQtyD,SAASq1D,IACpDnX,IAAaiX,EAAUC,EAAc,GACzCD,GAAY,KAIZp7D,KAAKi4D,gBAAiB,CACtB,MAAM3L,EAAUtsD,KAAKw6D,oBAAoBx6D,KAAKi4D,iBAE9C3kC,EAASnlB,WAAW,wBAAyBg2C,IAAaiX,EAAW,GACjE,CAAE9vD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,GAE7B,IAAI+vD,EAAUH,EAAW,GACzB9O,EAAQn9C,QAAQ6pB,IACZ,MAAMwiC,EAAex7D,KAAKy6D,eAAezhC,EAAK02B,OAAQh5C,IAChD3H,EAAYysD,EAAad,SAC3B,CAAEpvD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAMvB,GAJA8nB,EAASnlB,WAAW,KAAK6qB,EAAK/yB,OAAQk+C,IAAaoX,EAASxsD,EAAW,GACvEwsD,GAAW,GAGPtmC,OAAO3f,KAAKkmD,EAAab,cAAc/zD,OAAS,EAAG,CACnD,MAAM60D,EAAcxmC,OAAOvuB,QAAQ80D,EAAab,cAC3C1rD,IAAI,EAAEyH,EAAIglD,KAAW,GAAGA,MAAUhlD,KAClC0vC,KAAK,MACV9yB,EAASnlB,WAAW,cAAcstD,IAC9BtX,IAAaoX,EAAS,CAAEjwD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,GACnD+vD,GAAW,EACf,GAER,CACJ,CAKQ,sBAAAJ,CAAuB7nC,GAC3B,MAAMqoC,EAAgB37D,KAAK86D,sBAC3B,GAA6B,IAAzBa,EAAc/0D,OAAc,OAGhC,IAAIg1D,EAAY,IAEhBtoC,EAASnlB,WAAW,2BAHF,GAGyCytD,EACvD,CAAEtwD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,IAC7BowD,GAAa,GAEbD,EAAcxsD,QAAQ6pB,IAElB,MAEM8kB,EAAYlxC,KAAKC,MAFN,IAEuBmsB,EAAKxX,UAG7C8R,EAAStnB,SAdK,GAce4vD,EALZ,IACC,EAI2C,CAAEtwD,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAGhF,MAAMuyC,EAAY/kB,EAAKxX,UAAY,EAC/B,CAAElW,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACvB8nB,EAAStnB,SApBK,GAoBe4vD,EAAW9d,EAVtB,EAU4CC,GAG9DzqB,EAASnlB,WAAW,GAAG6qB,EAAKiiC,cAAcjiC,EAAKgiC,cAAc3xD,QAAQ,MACjEwyD,IAA2BD,EAAW,CAAEtwD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAAM,GAEnEowD,GAAa,IAErB,CAKA,UAAAjF,CAAWC,GACP52D,KAAK8jD,UAAY8S,CACrB,CAKA,iBAAAkF,GACI,OAAO97D,KAAK8jD,SAChB,CAKA,aAAAiY,CAAcjC,GACN95D,KAAK83D,SAASviD,IAAIukD,KAClB95D,KAAKi4D,gBAAkB6B,EAE/B,CAKA,kBAAAkC,GACI,OAAOh8D,KAAKi4D,iBAAkBj4D,KAAK83D,SAAS5uD,IAAIlJ,KAAKi4D,kBAA2B,IACpF,CAKA,gBAAAgE,CAAiBnC,EAAmBoC,GAChC,MAAM3D,EAAUv4D,KAAK83D,SAAS5uD,IAAI4wD,GAC9BvB,IACAA,EAAQ51B,SAAWu5B,EACnBl8D,KAAKgJ,OAAOpD,KAAK,cAAc2yD,EAAQtyD,QAAQi2D,EAAS,YAAc,iBAE9E,CAKA,QAAA3+C,GAMI,MAAM4+C,EAAiB9lD,MAAMC,KAAKtW,KAAK83D,SAASn/C,UAAU3Q,OAAOo0D,GAAKA,EAAEz5B,UAAU/7B,OAElF,MAAO,CACHoxD,aAAch4D,KAAKg4D,aAAa3sD,KAChC8wD,iBACAE,cAAer8D,KAAK83D,SAASzsD,KAC7BixD,eAAgBt8D,KAAK+3D,eAAenxD,OAE5C,CAKA,SAAA4wD,GACI,MAAO,CACHQ,aAAc3hD,MAAMC,KAAKtW,KAAKg4D,cAC9BF,SAAUzhD,MAAMC,KAAKtW,KAAK83D,SAASn/C,UACnCo/C,eAAgB/3D,KAAK+3D,eAE7B,CAKA,SAAAL,CAAUrgD,GACFA,EAAM2gD,eACNh4D,KAAKg4D,aAAe,IAAIpgD,IAAIP,EAAM2gD,eAGlC3gD,EAAMygD,UACNzgD,EAAMygD,SAAS3oD,QAASotD,IACpBv8D,KAAK83D,SAAS/uD,IAAIwzD,EAAY7lD,GAAI6lD,KAItCllD,EAAM0gD,iBACN/3D,KAAK+3D,eAAiB1gD,EAAM0gD,gBAGhC/3D,KAAKgJ,OAAOpD,KAAK,2BACrB,EChoBG,IAAK42D,GAAAA,IACRA,EAAA,OAAS,SACTA,EAAA,WAAa,aACbA,EAAA,QAAU,UACVA,EAAA,OAAS,SACTA,EAAA,KAAO,OACPA,EAAA,QAAU,UANFA,IAAAA,GAAA,CAAA,GASAC,GAAAA,IACRA,EAAA,QAAU,UACVA,EAAA,OAAS,SACTA,EAAA,QAAU,UACVA,EAAA,gBAAkB,kBAClBA,EAAA,UAAY,YALJA,IAAAA,GAAA,CAAA,GA2EL,MAAMC,EAwBT,WAAA53D,CAAYigB,EAAuB,IAvBnC/kB,KAAQm9B,YAAyCr0B,IACjD9I,KAAQ28D,gBAA2C7zD,IACnD9I,KAAQ48D,iBAQC9zD,IAGT9I,KAAQ68D,iBAA2B,EAGnC78D,KAAQ88D,cAA+B,SACvC98D,KAAQ+8D,cAA+B,KACvC/8D,KAAQg9D,eAAiC,KACzCh9D,KAAQi9D,YAAmFn0D,IAKvF9I,KAAKgJ,OAAS,IAAIO,EAAO,gBACzBvJ,KAAK+kB,OAASA,EAEd/kB,KAAKgJ,OAAOpD,KAAK,+BACrB,CAKA,SAAAs3D,CAAUC,GACNn9D,KAAKm9B,QAAQp0B,IAAIo0D,EAAOzmD,GAAIymD,GAC5Bn9D,KAAK48D,aAAa7zD,IAAIo0D,EAAOzmD,GAAI,CAC7BgsB,YAAY,EACZ06B,eAAgB,EAChBC,UAAW,EACX7gC,KAAM,EACN8gC,KAAMH,EAAOjmC,MAAMqmC,eAAgB,EACnCC,cAAc,EACdC,YAAa,IAGjBz9D,KAAKgJ,OAAOpD,KAAK,oBAAoBu3D,EAAOl3D,OAAQ,CAChDhC,KAAMk5D,EAAOl5D,KACbi3B,OAAQiiC,EAAOjmC,MAAMgE,OACrBoR,MAAO6wB,EAAOjmC,MAAMoV,OAE5B,CAKA,YAAAoxB,CAAaC,GACT39D,KAAKm9B,QAAQ/zB,OAAOu0D,GACpB39D,KAAK48D,aAAaxzD,OAAOu0D,GAGzB,IAAA,MAAYC,EAAQ90B,KAAe9oC,KAAK28D,YAAYj2D,UAC5CoiC,EAAW60B,WAAaA,GACxB39D,KAAK28D,YAAYvzD,OAAOw0D,GAIhC59D,KAAKgJ,OAAOpD,KAAK,sBAAsB+3D,IAC3C,CAKA,UAAAn1B,CAAWm1B,EAAkBE,EAAyBb,GAClD,MAAMG,EAASn9D,KAAKm9B,QAAQj0B,IAAIy0D,GAC1BtmD,EAAQrX,KAAK48D,aAAa1zD,IAAIy0D,GAEpC,IAAKR,IAAW9lD,EAAO,OAAO,EAE9B,MAAM+L,EAAc/c,KAAKC,MAAQ,IAGjC,GAAI+Q,EAAMmmD,cAAgBp6C,EAAc/L,EAAMomD,YAC1C,OAAO,EAMX,GAF0Br6C,EAAc/L,EAAMgmD,UAC1B,EAAIF,EAAOjmC,MAAM4mC,SAEjC,OAAO,EAIX,GAAmB,IAAfzmD,EAAMimD,KAEN,OADAt9D,KAAK+kB,OAAOg5C,cAAcZ,IACnB,EAIX,GAAIA,EAAOjmC,MAAM8mC,WAAa,EAAG,CAC7B,IAAK3mD,EAAMqrB,WAGP,OAFArrB,EAAMqrB,YAAa,EACnBrrB,EAAM+lD,eAAiB,GAChB,EACX,GAAW/lD,EAAM+lD,eAAiB,EAC9B,OAAO,CAEf,CAGA,IAAIa,EAAiBjB,EAChBiB,IAEGA,EADAj+D,KAAKg9D,eACYh9D,KAAKg9D,eACfh9D,KAAK+8D,eAAiB/8D,KAAKi9D,QAAQ1nD,IAAIvV,KAAK+8D,eAClC/8D,KAAKi9D,QAAQ/zD,IAAIlJ,KAAK+8D,eAAgBriD,SAGtC,CACbhO,EAAGmxD,EAAenxD,EAAIywD,EAAOjmC,MAAMoV,MACnC3/B,EAAGkxD,EAAelxD,IAM9B,MAAMuQ,EAAYld,KAAKk+D,yBAAyBL,EAAgBI,EAAgBd,EAAOjmC,MAAMinC,QAGvFr1B,EAAa9oC,KAAKme,iBAAiBg/C,EAAQU,EAAgB3gD,EAAW+gD,GA4B5E,OA3BAj+D,KAAK28D,YAAY5zD,IAAI+/B,EAAWpyB,GAAIoyB,GAGpCzxB,EAAMgmD,UAAYj6C,EAClB/L,EAAMmlB,MAAQ,GACdnlB,EAAMqrB,YAAa,EACnBrrB,EAAM+lD,eAAiB,EAEnB/lD,EAAMimD,KAAO,GACbjmD,EAAMimD,OAINjmD,EAAMmlB,KAAO,IACbnlB,EAAMmmD,cAAe,EACrBnmD,EAAMomD,YAAcr6C,EAAc+5C,EAAOjmC,MAAM2M,aAC/C7jC,KAAK+kB,OAAOq5C,mBAAmBjB,IAGnCn9D,KAAK+kB,OAAOs5C,gBAAgBlB,EAAQr0B,GAEpC9oC,KAAKgJ,OAAOxD,MAAM,YAAY23D,EAAOl3D,OAAQ,CACzCi1B,OAAQ4N,EAAW5N,OACnBoR,MAAOxD,EAAWlF,SAClB06B,eAAgBt+D,KAAKu+D,kBAAkBV,EAAgBI,MAGpD,CACX,CAKQ,gBAAA9/C,CAAiBg/C,EAAsBqB,EAAoBthD,EAAoBuhD,GACnF,MAAMC,EAAe,QAAQvB,EAAOzmD,MAAM1W,KAAK68D,qBAG/C,IAAIriD,EAAQ,IACRmkD,GAAW,EACXC,EAAiB,EAErB,OAAQzB,EAAOl5D,MACX,IAAK,SACDuW,EAAQ,IACR,MACJ,IAAK,aACDA,EAAQ,IACR,MACJ,IAAK,UACDA,EAAQ,IACRmkD,GAAW,EACXC,EAAiB,GACjB,MACJ,IAAK,SACDpkD,EAAQ,IACR,MACJ,IAAK,OACDA,EAAQ,KACR,MACJ,IAAK,UACDA,EAAQ,IACRmkD,GAAW,EACXC,EAAiB,IASzB,MAAO,CACHloD,GAAIgoD,EACJhkD,SAAU,IAAK8jD,GACfjkD,SARa,CACb7N,EAAGwQ,EAAUxQ,EAAI8N,EACjB7N,EAAGuQ,EAAUvQ,EAAI6N,GAOjB0gB,OAAQiiC,EAAOjmC,MAAMgE,OACrB6D,WAAYo+B,EAAOp+B,WACnBuN,MAAO,EACP1I,SAAUu5B,EAAOjmC,MAAMoV,MACvBjhC,KAAMrL,KAAK6+D,kBAAkB1B,EAAOl5D,MACpC05D,SAAUR,EAAOzmD,GACjBooD,SAAU9+D,KAAK+8D,oBAAiB,EAChCthD,YAAa0hD,EAAOjmC,MAAMzb,YAC1BkjD,WACAC,iBACAx6B,KAAM,EACN26B,MAAO,GAEf,CAKQ,iBAAAF,CAAkBG,GACtB,OAAQA,GACJ,IAAK,SAML,QAAS,OAAO,EALhB,IAAK,aAGL,IAAK,OAAiB,OAAO,EAF7B,IAAK,UAAoB,OAAO,EAChC,IAAK,SAAmB,OAAO,EAE/B,IAAK,UAAoB,OAAO,EAGxC,CAKQ,wBAAAd,CAAyBM,EAAoBC,EAAoBN,GAErE,MAAM7wD,EAAKmxD,EAAU/xD,EAAI8xD,EAAU9xD,EAC7Bc,EAAKixD,EAAU9xD,EAAI6xD,EAAU7xD,EAC7B8D,EAAW7D,KAAK8D,KAAKpD,EAAKA,EAAKE,EAAKA,GAE1C,GAAiB,IAAbiD,EACA,MAAO,CAAE/D,EAAG,EAAGC,EAAG,GAItB,IAAIuQ,EAAY,CACZxQ,EAAGY,EAAKmD,EACR9D,EAAGa,EAAKiD,GAIZ,GAAI0tD,EAAS,EAAG,CACZ,MAAMc,EAAad,EAASvxD,KAAKuU,GAAK,KAAQvU,KAAK2U,SAAW,IACxDsC,EAAMjX,KAAKiX,IAAIo7C,GACfh+C,EAAMrU,KAAKqU,IAAIg+C,GAErB/hD,EAAY,CACRxQ,EAAGwQ,EAAUxQ,EAAImX,EAAM3G,EAAUvQ,EAAIsU,EACrCtU,EAAGuQ,EAAUxQ,EAAIuU,EAAM/D,EAAUvQ,EAAIkX,EAE7C,CAEA,OAAO3G,CACX,CAKA,MAAA1I,CAAOC,GACHzU,KAAKk/D,mBAAmBzqD,GACxBzU,KAAKm/D,kBAAkB1qD,GACvBzU,KAAKo/D,sBACLp/D,KAAKq/D,oBACT,CAKQ,kBAAAH,CAAmBzqD,GACvB,MAAM2O,EAAc/c,KAAKC,MAAQ,IAEjC,IAAA,MAAYq3D,EAAUtmD,KAAUrX,KAAK48D,aAAal2D,UAAW,CACzD,MAAMy2D,EAASn9D,KAAKm9B,QAAQj0B,IAAIy0D,GAC3BR,IAGD9lD,EAAMmlB,KAAO,IACbnlB,EAAMmlB,KAAO5vB,KAAKoC,IAAI,EAAGqI,EAAMmlB,KAAmB,GAAZ/nB,IAItC4C,EAAMmmD,cAAgBp6C,GAAe/L,EAAMomD,cAC3CpmD,EAAMmmD,cAAe,EACrBnmD,EAAMmlB,KAAO,GAIbnlB,EAAMqrB,YAAcy6B,EAAOjmC,MAAM8mC,WAAa,IAC9C3mD,EAAM+lD,eAAiBxwD,KAAKuD,IAAI,EAAKkH,EAAM+lD,eAAiB3oD,EAAY0oD,EAAOjmC,MAAM8mC,aAE7F,CACJ,CAKQ,iBAAAmB,CAAkB1qD,GACtB,IAAA,MAAYmpD,EAAQ90B,KAAe9oC,KAAK28D,YAAYj2D,UAEhDoiC,EAAWpuB,SAAShO,GAAKo8B,EAAWvuB,SAAS7N,EAAI+H,EACjDq0B,EAAWpuB,SAAS/N,GAAKm8B,EAAWvuB,SAAS5N,EAAI8H,EAGjDq0B,EAAWwD,OAAS1/B,KAAK8D,KACrBo4B,EAAWvuB,SAAS7N,EAAIo8B,EAAWvuB,SAAS7N,EAC5Co8B,EAAWvuB,SAAS5N,EAAIm8B,EAAWvuB,SAAS5N,GAC5C8H,EAGAq0B,EAAWi2B,MAAMn4D,OAAS,IAC1BkiC,EAAWi2B,MAAMl4D,QAErBiiC,EAAWi2B,MAAMp4D,KAAK,IAAKmiC,EAAWpuB,WAGlCouB,EAAW61B,UAAY71B,EAAWg2B,UAAY9+D,KAAKi9D,QAAQ1nD,IAAIuzB,EAAWg2B,WAC1E9+D,KAAKs/D,uBAAuBx2B,EAAYr0B,GAI5Cq0B,EAAW1E,KAAOx3B,KAAKoC,IAAI,EAAG,EAAK85B,EAAWwD,MAAQxD,EAAWlF,SAEzE,CAKQ,sBAAA07B,CAAuBx2B,EAAwBr0B,GACnD,MAAM8qD,EAASv/D,KAAKi9D,QAAQ/zD,IAAI4/B,EAAWg2B,UAC3C,IAAKS,EAAQ,OAGb,MAAMC,EACCD,EAAO7kD,SAAShO,EAAwB,GAApB6yD,EAAOhlD,SAAS7N,EADrC8yD,EAECD,EAAO7kD,SAAS/N,EAAwB,GAApB4yD,EAAOhlD,SAAS5N,EAIrCW,EAAKkyD,EAAiB12B,EAAWpuB,SAAShO,EAC1Cc,EAAKgyD,EAAiB12B,EAAWpuB,SAAS/N,EAC1C8D,EAAW7D,KAAK8D,KAAKpD,EAAKA,EAAKE,EAAKA,GAE1C,GAAIiD,EAAW,EAAG,CACd,MAAMgvD,EAAkB,CACpB/yD,EAAGY,EAAKmD,EACR9D,EAAGa,EAAKiD,GAIN+J,EAAQ5N,KAAK8D,KACfo4B,EAAWvuB,SAAS7N,EAAIo8B,EAAWvuB,SAAS7N,EAC5Co8B,EAAWvuB,SAAS5N,EAAIm8B,EAAWvuB,SAAS5N,GAI1C+yD,EAAmB,CACrBhzD,EAAGo8B,EAAWvuB,SAAS7N,EAAI8N,EAC3B7N,EAAGm8B,EAAWvuB,SAAS5N,EAAI6N,GAGzBmlD,EAAe72B,EAAW81B,eAAiBnqD,EAAY,GACvDmrD,EAAe,CACjBlzD,EAAGgzD,EAAiBhzD,GAAK+yD,EAAgB/yD,EAAIgzD,EAAiBhzD,GAAKizD,EACnEhzD,EAAG+yD,EAAiB/yD,GAAK8yD,EAAgB9yD,EAAI+yD,EAAiB/yD,GAAKgzD,GAIjEE,EAAYjzD,KAAK8D,KAAKkvD,EAAalzD,EAAIkzD,EAAalzD,EAAIkzD,EAAajzD,EAAIizD,EAAajzD,GACxFkzD,EAAY,IACZ/2B,EAAWvuB,SAAS7N,EAAKkzD,EAAalzD,EAAImzD,EAAarlD,EACvDsuB,EAAWvuB,SAAS5N,EAAKizD,EAAajzD,EAAIkzD,EAAarlD,EAE/D,CACJ,CAKQ,mBAAA4kD,GACJ,IAAA,MAAYxB,EAAQ90B,KAAe9oC,KAAK28D,YAAYj2D,UAChD,IAAA,MAAYo4D,EAAUS,KAAWv/D,KAAKi9D,QAAQv2D,UAAW,CAIrD,GAHiB1G,KAAKu+D,kBAAkBz1B,EAAWpuB,SAAU6kD,EAAO7kD,WAClDouB,EAAWz9B,KAAOk0D,EAAOl0D,KAEhB,CAEvB,MAAM6vB,EAASl7B,KAAK8/D,gBAAgBh3B,EAAYy2B,GAC1Cj2D,EAAuB,CACzBw1D,WACA5jC,OAAQA,EAAO6kC,YACfhhC,WAAY+J,EAAW/J,WACvBihC,YAAa9kC,EAAOh1B,SACpB+5D,WAAY/kC,EAAO+kC,WACnBC,WAAYhlC,EAAOglC,WACnBC,QAASjlC,EAAOilC,SAGpBngE,KAAK+kB,OAAOq7C,kBAAkBt3B,EAAYx/B,GAGrC4xB,EAAO+kC,YACRjgE,KAAK28D,YAAYvzD,OAAOw0D,GAG5B59D,KAAKgJ,OAAOxD,MAAM,oBAAqB,CACnCs5D,WACA5jC,OAAQA,EAAO6kC,YACf75D,SAAUg1B,EAAOh1B,WAGrB,KACJ,CACJ,CAER,CAKQ,eAAA45D,CAAgBh3B,EAAwBy2B,GAO5C,IAAIrkC,EAAS4N,EAAW5N,OACpBh1B,GAAW,EACX+5D,GAAa,EAGbrzD,KAAK2U,SAAW,MAChBrb,GAAW,EACXg1B,GAAU,GAYd,OAPAA,GADgBtuB,KAAKoC,IAAI,GAAK,EAAK85B,EAAWwD,MAAQxD,EAAWlF,SAAY,IAIzEkF,EAAWrtB,YAAc,KACzBwkD,EAAarzD,KAAK2U,SAAW,IAG1B,CACHw+C,YAAanzD,KAAKC,MAAMquB,GACxBh1B,WACA+5D,aACAC,YAAY,EACZC,QAASF,EAEjB,CAKQ,kBAAAZ,GACJ,IAAA,MAAYzB,EAAQ90B,KAAe9oC,KAAK28D,YAAYj2D,WAC5CoiC,EAAW1E,MAAQ,GAAK0E,EAAWwD,OAASxD,EAAWlF,WACvD5jC,KAAK28D,YAAYvzD,OAAOw0D,EAGpC,CAKA,gBAAAyC,CAAiBC,GACbtgE,KAAK88D,cAAgBwD,EACrBtgE,KAAKgJ,OAAOxD,MAAM,sBAAsB86D,IAC5C,CAKA,iBAAAC,CAAkB7lD,GACd1a,KAAKg9D,eAAiB,IAAKtiD,EAC/B,CAKA,SAAA8lD,CAAU1B,GACN9+D,KAAK+8D,cAAgB+B,EACrB9+D,KAAKgJ,OAAOxD,MAAM,cAAcs5D,GAAY,SAChD,CAKA,YAAA2B,CAAa3B,EAAkBpkD,EAAmBH,EAAmBlP,GACjErL,KAAKi9D,QAAQl0D,IAAI+1D,EAAU,CAAEpkD,SAAU,IAAKA,GAAYH,SAAU,IAAKA,GAAYlP,QACvF,CAKA,YAAAq1D,CAAa5B,GACT9+D,KAAKi9D,QAAQ7zD,OAAO01D,GAChB9+D,KAAK+8D,gBAAkB+B,IACvB9+D,KAAK+8D,cAAgB,KAE7B,CAKA,SAAA4D,CAAUhD,GACN,MAAMR,EAASn9D,KAAKm9B,QAAQj0B,IAAIy0D,GAC1BtmD,EAAQrX,KAAK48D,aAAa1zD,IAAIy0D,GAEpC,OAAKR,GAAW9lD,EAET,CAAE8lD,SAAQ9lD,SAFa,IAGlC,CAKA,aAAAupD,GACI,MAAMt3D,EAAsD,GAE5D,IAAA,MAAYq0D,EAAUR,KAAWn9D,KAAKm9B,QAAQz2B,UAAW,CACrD,MAAM2Q,EAAQrX,KAAK48D,aAAa1zD,IAAIy0D,GAChCtmD,GACA/N,EAAO3C,KAAK,CAAEw2D,SAAQ9lD,SAE9B,CAEA,OAAO/N,CACX,CAKA,YAAAu3D,CAAalD,GACT,MAAMR,EAASn9D,KAAKm9B,QAAQj0B,IAAIy0D,GAC1BtmD,EAAQrX,KAAK48D,aAAa1zD,IAAIy0D,GAEpC,SAAKR,GAAW9lD,GAAU8lD,EAAOjmC,MAAMqmC,gBAEvClmD,EAAMimD,KAAOH,EAAOjmC,MAAMqmC,aAC1Bv9D,KAAKgJ,OAAOxD,MAAM,eAAe23D,EAAOl3D,SAEjC,EACX,CAKA,MAAAotB,CAAOC,GACHtzB,KAAK8gE,kBAAkBxtC,GACvBtzB,KAAK+gE,oBAAoBztC,EAC7B,CAKQ,iBAAAwtC,CAAkBxtC,GACtB,IAAA,MAAWwV,KAAc9oC,KAAK28D,YAAYhkD,SAAU,CAEhD,GAAImwB,EAAWi2B,MAAMn4D,OAAS,EAC1B,IAAA,IAAS2F,EAAI,EAAGA,EAAIu8B,EAAWi2B,MAAMn4D,OAAQ2F,IAAK,CAC9C,MAAMw5B,EAASx5B,EAAIu8B,EAAWi2B,MAAMn4D,OAAUkiC,EAAW1E,KACnD48B,EAAahhE,KAAKihE,mBAAmBn4B,EAAoB,GAAR/C,GAEvDzS,EAASrmB,SACL67B,EAAWi2B,MAAMxyD,EAAE,GAAGG,EAAGo8B,EAAWi2B,MAAMxyD,EAAE,GAAGI,EAC/Cm8B,EAAWi2B,MAAMxyD,GAAGG,EAAGo8B,EAAWi2B,MAAMxyD,GAAGI,EAC3Cq0D,EAER,CAIJ,MAAM10D,EAAQtM,KAAKihE,mBAAmBn4B,EAAYA,EAAW1E,MACvD/4B,EAAOy9B,EAAWz9B,KAAOy9B,EAAW1E,KAEtC0E,EAAWz9B,KAAO,EAElBioB,EAASzlB,WAAWi7B,EAAWpuB,SAAShO,EAAGo8B,EAAWpuB,SAAS/N,EAAGtB,EAAMiB,GAAO,GAG/EgnB,EAAStnB,SACL88B,EAAWpuB,SAAShO,EAAIrB,EAAK,EAC7By9B,EAAWpuB,SAAS/N,EAAItB,EAAK,EAC7BA,EAAMA,EAAMiB,EAGxB,CACJ,CAKQ,kBAAA20D,CAAmBn4B,EAAwB/C,GAC/C,MAAMo3B,EAASn9D,KAAKm9B,QAAQj0B,IAAI4/B,EAAW60B,UAC3C,IAAKR,EAAQ,MAAO,CAAE7xD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAEvC,IAAIojD,EAEJ,OAAQuO,EAAOl5D,MACX,IAAK,SACD2qD,EAAY,CAAEtjD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC/B,MACJ,IAAK,aACDojD,EAAY,CAAEtjD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC/B,MACJ,IAAK,UACDojD,EAAY,CAAEtjD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC/B,MACJ,IAAK,SACDojD,EAAY,CAAEtjD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC/B,MACJ,IAAK,OACDojD,EAAY,CAAEtjD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC/B,MACJ,IAAK,UACDojD,EAAY,CAAEtjD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC/B,MACJ,QACIojD,EAAY,CAAEtjD,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAGvC,MAAO,CACHF,EAAGsB,KAAKC,MAAM+hD,EAAUtjD,EAAIy6B,GAC5Bx6B,EAAGqB,KAAKC,MAAM+hD,EAAUrjD,EAAIw6B,GAC5Bv6B,EAAGoB,KAAKC,MAAM+hD,EAAUpjD,EAAIu6B,GAEpC,CAKQ,mBAAAg7B,CAAoBztC,GAG5B,CAKQ,iBAAAirC,CAAkB2C,EAAeC,GACrC,MAAM7zD,EAAK4zD,EAAKx0D,EAAIy0D,EAAKz0D,EACnBc,EAAK0zD,EAAKv0D,EAAIw0D,EAAKx0D,EACzB,OAAOC,KAAK8D,KAAKpD,EAAKA,EAAKE,EAAKA,EACpC,CAKA,QAAA+P,GAMI,MAAM6jD,EAA4C,CAAA,EAElD,IAAA,MAAWjE,KAAUn9D,KAAKm9B,QAAQxkB,SAC9ByoD,EAAcjE,EAAOl5D,OAASm9D,EAAcjE,EAAOl5D,OAAS,GAAK,EAGrE,MAAO,CACHo9D,aAAcrhE,KAAKm9B,QAAQ9xB,KAC3Bi2D,kBAAmBthE,KAAK28D,YAAYtxD,KACpCk2D,eAAgBvhE,KAAKi9D,QAAQ5xD,KAC7B+1D,gBAER,CAKA,gBAAAI,GACIxhE,KAAK28D,YAAYz0D,OACrB,CAKA,YAAAu5D,GACIzhE,KAAKi9D,QAAQ/0D,QACblI,KAAK+8D,cAAgB,IACzB,EChxBG,IAAK2E,GAAAA,IACRA,EAAA,WAAa,aACbA,EAAA,UAAY,YACZA,EAAA,QAAU,UACVA,EAAA,OAAS,SACTA,EAAA,MAAQ,QACRA,EAAA,SAAW,WACXA,EAAA,OAAS,SACTA,EAAA,QAAU,UARFA,IAAAA,GAAA,CAAA,GAWAC,GAAAA,IACRA,EAAA,QAAU,UACVA,EAAA,SAAW,WACXA,EAAA,QAAU,UACVA,EAAA,UAAY,YACZA,EAAA,QAAU,UACVA,EAAA,WAAa,aACbA,EAAA,MAAQ,QAPAA,IAAAA,GAAA,CAAA,GAwFL,MAAMC,EAeT,WAAA98D,CAAY+8D,EAA4B98C,EAAmB,IAd3D/kB,KAAQ8hE,YAAsCh5D,IAK9C9I,KAAQ+hE,eAA0B,CAAEr1D,EAAG,EAAGC,EAAG,GAC7C3M,KAAQgiE,eAA0B,CAAEt1D,EAAG,EAAGC,EAAG,GAC7C3M,KAAQiiE,WAAqB,GAG7BjiE,KAAQkiE,qBAAyDp5D,IAK7D9I,KAAKgJ,OAAS,IAAIO,EAAO,WACzBvJ,KAAK6hE,aAAeA,EACpB7hE,KAAK+kB,OAASA,EAEd/kB,KAAKmiE,qBAELniE,KAAKgJ,OAAOpD,KAAK,iCACrB,CAKQ,kBAAAu8D,GACJ,MAAMC,EAAW,CAAC,UAAW,SAAU,SAAU,cAAe,YAEhE,IAAA,MAAWC,KAAYD,EAAU,CACxBpiE,KAAKkiE,iBAAiB3sD,IAAI8sD,IAC3BriE,KAAKkiE,iBAAiBn5D,IAAIs5D,EAAU,IAAIv5D,KAG5C,IAAA,MAAWw5D,KAAYF,EAAU,CAC7B,IAAIG,EAAW,EAGXA,EADAF,IAAaC,EACF,EAEG,YAAbD,GAAuC,aAAbC,GACb,aAAbD,GAAwC,YAAbC,GACd,WAAbD,GAAsC,gBAAbC,GACZ,gBAAbD,GAA2C,WAAbC,GAEpB,EACS,WAAbD,GACI,GAEgB,GAAhBz1D,KAAK2U,SAAiB,GAGrCvhB,KAAKkiE,iBAAiBh5D,IAAIm5D,GAAWt5D,IAAIu5D,EAAUC,EACvD,CACJ,CACJ,CAKA,UAAAC,CAAWv9D,EAAyByV,GAChC,MAAM+nD,EAAmB,CACrBx9D,SACAyV,SAAU,IAAKA,GACfH,SAAU,CAAE7N,EAAG,EAAGC,EAAG,GACrBkM,SAAUjM,KAAK2U,SAAW3U,KAAKuU,GAAK,EAEpC47C,cAAe,KACf1lD,MAAO,OACPorB,WAAY,EACZigC,iBAAkB,EAElBC,aAAc,EACdC,oBAAqB95D,IAErB+5D,SAAU,KACVC,aAAc,IAAKpoD,GACnBqoD,aAAc,IAEd15B,SAAS,EACT25B,eAAgB,GAwBpB,OApBA/9D,EAAOk4B,QAAQhuB,QAAQguD,IACnB,MAAMQ,EAAW,GAAG14D,EAAOyR,MAAMymD,EAAOzmD,KACxC1W,KAAK6hE,aAAa3E,UAAU,IACrBC,EACHzmD,GAAIinD,MAKZ39D,KAAK6hE,aAAapB,aAAax7D,EAAOyR,GAAIgE,EAAU,CAAEhO,EAAG,EAAGC,EAAG,GAAK1H,EAAOoG,MAE3ErL,KAAK8hE,QAAQ/4D,IAAI9D,EAAOyR,GAAI+rD,GAC5BziE,KAAK+kB,OAAOk+C,iBAAiBR,GAE7BziE,KAAKgJ,OAAOpD,KAAK,cAAcX,EAAOi+D,cAAcj+D,EAAOgB,QAAS,CAChEk9D,QAASl+D,EAAOk+D,QAChBC,SAAUn+D,EAAOm+D,SACjB1oD,aAGGzV,EAAOyR,EAClB,CAKA,YAAA2sD,CAAa3oD,EAAmBH,EAAmBlP,GAC/CrL,KAAK+hE,eAAiB,IAAKrnD,GAC3B1a,KAAKgiE,eAAiB,IAAKznD,GAC3Bva,KAAKiiE,WAAa52D,EAGlBrL,KAAK6hE,aAAapB,aAAa,SAAU/lD,EAAUH,EAAUlP,EACjE,CAKA,MAAAmJ,CAAOC,GACH,IAAA,MAAWguD,KAASziE,KAAK8hE,QAAQnpD,SACzB8pD,EAAMp5B,SACNrpC,KAAKsjE,YAAYb,EAAOhuD,GAIhCzU,KAAKujE,oBACT,CAKQ,WAAAD,CAAYb,EAAkBhuD,GAClC,MAAM2O,EAAc/c,KAAKC,MAAQ,IAGjCm8D,EAAMhgC,YAAchuB,EAGhB2O,EAAcq/C,EAAMC,kBAAoBD,EAAMx9D,OAAOu+D,eACrDxjE,KAAKyjE,aAAahB,GAClBA,EAAMC,iBAAmBt/C,GAI7BpjB,KAAK0jE,aAAajB,EAAOhuD,GAGzBzU,KAAKunC,eAAek7B,EAAOhuD,GAG3BzU,KAAK2jE,aAAalB,EAAOhuD,GAGzBzU,KAAK6hE,aAAapB,aAAagC,EAAMx9D,OAAOyR,GAAI+rD,EAAM/nD,SAAU+nD,EAAMloD,SAAUkoD,EAAMx9D,OAAOoG,KACjG,CAKQ,YAAAo4D,CAAahB,GACjB,MAAMmB,EAAmB5jE,KAAKu+D,kBAAkBkE,EAAM/nD,SAAU1a,KAAK+hE,gBAC/D8B,EAAUD,GAAoBnB,EAAMx9D,OAAO6+D,gBAC3CC,EAAiB/jE,KAAK+jE,eAAetB,EAAM/nD,SAAU1a,KAAK+hE,gBAEhE,IAAItxC,EAAWgyC,EAAMprD,MAErB,OAAQorD,EAAMx9D,OAAOm+D,UACjB,IAAK,aAEG3yC,EADAozC,GAAWE,EACA,SACJH,EAAkD,EAA/BnB,EAAMx9D,OAAO6+D,gBAC5B,SAEA,SAEf,MAEJ,IAAK,YAEGrzC,EADAozC,GAAWE,GAAkBtB,EAAMO,eAAiB38D,KAAKC,MAAQ,IAAO,EAC7D,SACJs9D,EAAmBnB,EAAMx9D,OAAO6+D,gBAC5B,QAEA,SAEf,MAEJ,IAAK,UAEGrzC,EADAgyC,EAAMx9D,OAAOo3B,KAA8B,GAAvBomC,EAAMx9D,OAAOu2B,QACtB,UACJqoC,EACI,QAEA,SAEf,MAEJ,IAAK,SAEGpzC,EADAmzC,GAAoBnB,EAAMx9D,OAAO++D,gBAAkBD,EACxC,SACJH,EAAmBnB,EAAMx9D,OAAO++D,eAC5B,UAEA,SAEf,MAEJ,IAAK,WAEGvzC,EADAmzC,EAAmB,IACR,UAEA,SAEf,MAEJ,QACInzC,EAAW,SAGfA,IAAagyC,EAAMprD,OACnBrX,KAAKikE,YAAYxB,EAAOhyC,EAEhC,CAKQ,WAAAwzC,CAAYxB,EAAkBhyC,GAClC,MAAMyzC,EAAWzB,EAAMprD,MAKvB,OAJAorD,EAAMprD,MAAQoZ,EACdgyC,EAAMhgC,WAAa,EAGXhS,GACJ,IAAK,SACDgyC,EAAMI,SAAW7iE,KAAKmkE,uBAAuB1B,GAC7C,MAEJ,IAAK,SAIL,IAAK,SAIL,IAAK,gBACDA,EAAM1F,cAAgB,SACtB,MAEJ,IAAK,UACD0F,EAAMI,SAAW7iE,KAAKokE,wBAAwB3B,GAItDziE,KAAK+kB,OAAOs/C,sBAAsB5B,EAAOyB,EAAUzzC,GAEnDzwB,KAAKgJ,OAAOxD,MAAM,MAAMi9D,EAAMx9D,OAAOgB,eAAei+D,OAAczzC,IACtE,CAKQ,YAAAizC,CAAajB,EAAkBhuD,GACnC,OAAQguD,EAAMprD,OACV,IAAK,OAED,MAEJ,IAAK,SACDrX,KAAKskE,cAAc7B,EAAOhuD,GAC1B,MAEJ,IAAK,SACDzU,KAAKukE,cAAc9B,EAAOhuD,GAC1B,MAEJ,IAAK,SACDzU,KAAKwkE,cAAc/B,EAAOhuD,GAC1B,MAEJ,IAAK,QACDzU,KAAKykE,aAAahC,EAAOhuD,GACzB,MAEJ,IAAK,UACDzU,KAAK0kE,eAAejC,EAAOhuD,GAC3B,MAEJ,IAAK,gBACDzU,KAAK2kE,oBAAoBlC,EAAOhuD,GAChC,MAEJ,IAAK,UACDzU,KAAK4kE,eAAenC,EAAOhuD,GAGvC,CAKQ,aAAA6vD,CAAc7B,EAAkBhuD,KAC/BguD,EAAMI,UAAY7iE,KAAKu+D,kBAAkBkE,EAAM/nD,SAAU+nD,EAAMI,UAAY,MAC5EJ,EAAMI,SAAW7iE,KAAKmkE,uBAAuB1B,IAGjDziE,KAAK6kE,WAAWpC,EAAOA,EAAMI,SAAU,GAC3C,CAKQ,aAAA0B,CAAc9B,EAAkBhuD,GACpC,MAAMqwD,EAAqB9kE,KAAK+kE,sBAAsB,IACtD/kE,KAAK6kE,WAAWpC,EAAOqC,EAAoB,EAC/C,CAKQ,aAAAN,CAAc/B,EAAkBhuD,GACpC,MAAMmvD,EAAmB5jE,KAAKu+D,kBAAkBkE,EAAM/nD,SAAU1a,KAAK+hE,gBAErE,GAAI6B,EAAiD,IAA9BnB,EAAMx9D,OAAO++D,eAEhChkE,KAAK6kE,WAAWpC,EAAOziE,KAAK+hE,eAAgB,QAChD,GAAW6B,EAAiD,GAA9BnB,EAAMx9D,OAAO++D,eAAsB,CAE7D,MAAMgB,EAAehlE,KAAKilE,sBAAsBxC,EAAM/nD,SAAU1a,KAAK+hE,gBACrE/hE,KAAK6kE,WAAWpC,EAAOuC,EAAc,GACzC,MAEIhlE,KAAK2kE,oBAAoBlC,EAAOhuD,EAExC,CAKQ,YAAAgwD,CAAahC,EAAkBhuD,GACnC,MAAMywD,EAAellE,KAAKmlE,sBAAsB1C,GAChDziE,KAAK6kE,WAAWpC,EAAOyC,EAAc,IACzC,CAKQ,cAAAR,CAAejC,EAAkBhuD,GAChCguD,EAAMI,WACPJ,EAAMI,SAAW7iE,KAAKokE,wBAAwB3B,IAGlDziE,KAAK6kE,WAAWpC,EAAOA,EAAMI,SAAU,IAC3C,CAKQ,mBAAA8B,CAAoBlC,EAAkBhuD,GAC1C,MAAM2wD,EAAW,CACb14D,EAAG1M,KAAK+hE,eAAer1D,EAAI+1D,EAAM/nD,SAAShO,EAC1CC,EAAG3M,KAAK+hE,eAAep1D,EAAI81D,EAAM/nD,SAAS/N,GAGxC8D,EAAW7D,KAAK8D,KAAK00D,EAAS14D,EAAI04D,EAAS14D,EAAI04D,EAASz4D,EAAIy4D,EAASz4D,GAC3E,GAAiB,IAAb8D,EAAgB,OAGpB20D,EAAS14D,GAAK+D,EACd20D,EAASz4D,GAAK8D,EAGd,MAAM40D,EAAkB,CACpB34D,GAAI04D,EAASz4D,EACbA,EAAGy4D,EAAS14D,GAIZE,KAAK2U,SAAW,KAChB8jD,EAAgB34D,IAAK,EACrB24D,EAAgB14D,IAAK,GAIzB,MAAM24D,EAAc,CAChB54D,EAAG+1D,EAAM/nD,SAAShO,EAAwB,IAApB24D,EAAgB34D,EACtCC,EAAG81D,EAAM/nD,SAAS/N,EAAwB,IAApB04D,EAAgB14D,GAG1C3M,KAAK6kE,WAAWpC,EAAO6C,EAAa,GACxC,CAKQ,cAAAV,CAAenC,EAAkBhuD,GAErCzU,KAAK6kE,WAAWpC,EAAOziE,KAAK+hE,eAAgB,EAChD,CAKQ,UAAA8C,CAAWpC,EAAkBlD,EAAiB97B,GAClD,MAAMvmB,EAAY,CACdxQ,EAAG6yD,EAAO7yD,EAAI+1D,EAAM/nD,SAAShO,EAC7BC,EAAG4yD,EAAO5yD,EAAI81D,EAAM/nD,SAAS/N,GAG3B8D,EAAW7D,KAAK8D,KAAKwM,EAAUxQ,EAAIwQ,EAAUxQ,EAAIwQ,EAAUvQ,EAAIuQ,EAAUvQ,GAC/E,GAAiB,IAAb8D,EAAgB,OAGpByM,EAAUxQ,GAAK+D,EACfyM,EAAUvQ,GAAK8D,EAGf,MAAM80D,EAAe9C,EAAMx9D,OAAOugE,SAAW/hC,EACvCgiC,EACCvoD,EAAUxQ,EAAI64D,EADfE,EAECvoD,EAAUvQ,EAAI44D,EAIfnrD,EAAeqoD,EAAMx9D,OAAOmV,aAClCqoD,EAAMloD,SAAS7N,IAAM+4D,EAAoBhD,EAAMloD,SAAS7N,GAAK0N,EAAe,KAC5EqoD,EAAMloD,SAAS5N,IAAM84D,EAAoBhD,EAAMloD,SAAS5N,GAAKyN,EAAe,KAG5E,MAAMsrD,EAAiB94D,KAAK+4D,MAAMzoD,EAAUvQ,EAAGuQ,EAAUxQ,GACzD+1D,EAAM5pD,SAAW7Y,KAAK4lE,UAAUnD,EAAM5pD,SAAU6sD,EAAwC,KAAxBjD,EAAMx9D,OAAO4gE,SACjF,CAKQ,cAAAt+B,CAAek7B,EAAkBhuD,GAErCguD,EAAM/nD,SAAShO,GAAK+1D,EAAMloD,SAAS7N,EAAI+H,EACvCguD,EAAM/nD,SAAS/N,GAAK81D,EAAMloD,SAAS5N,EAAI8H,EAIvCguD,EAAMloD,SAAS7N,GADF,IAEb+1D,EAAMloD,SAAS5N,GAFF,GAGjB,CAKQ,YAAAg3D,CAAalB,EAAkBhuD,GACnC,IAAKguD,EAAM1F,cAAe,OAE1B,MAAM35C,EAAc/c,KAAKC,MAAQ,IAC3Bi5D,EAAiC,WAAxBkD,EAAM1F,cAA6B/8D,KAAK+hE,eAAiB,KAExE,IAAKxC,EAAQ,OAEb,MAAM9uD,EAAWzQ,KAAKu+D,kBAAkBkE,EAAM/nD,SAAU6kD,GAClDsE,EAAUpzD,GAAYgyD,EAAMx9D,OAAO6+D,gBACnCC,EAAiB/jE,KAAK+jE,eAAetB,EAAM/nD,SAAU6kD,GAE3D,GAAIsE,GAAWE,EAEX,IAAA,MAAW+B,KAAgBrD,EAAMx9D,OAAOk4B,QAAS,CAC7C,MAAMwgC,EAAW,GAAG8E,EAAMx9D,OAAOyR,MAAMovD,EAAapvD,KAC9CqvD,EAAcpI,EAOpB,GAF0Bv6C,GAJRq/C,EAAMG,gBAAgB15D,IAAI68D,IAAgB,IAMnC,EAHRD,EAAa5uC,MAAM4mC,SAGG,CAEnC,MAAMkI,EAAWvD,EAAMx9D,OAAO+gE,SAAWvD,EAAMx9D,OAAOghE,aAGtD,GAFmBr5D,KAAK2U,SAAWykD,EAEnB,CACEhmE,KAAK6hE,aAAar5B,WAC5Bm1B,EACA8E,EAAM/nD,SACN1a,KAAK+kE,sBAAsBt0D,EAAW,OAItCgyD,EAAMG,gBAAgB75D,IAAIg9D,EAAa3iD,EAE/C,CACJ,CACJ,CAER,CAKA,WAAA0b,CAAYonC,EAAiBhrC,EAAgB6D,GACzC,MAAM0jC,EAAQziE,KAAK8hE,QAAQ54D,IAAIg9D,GAC/B,IAAKzD,IAAUA,EAAMp5B,QAAS,OAAO,EAGrC,IAAI02B,EAAc7kC,EAMlB,GALIunC,EAAMx9D,OAAOkhE,MAAQ,IACrBpG,EAAcnzD,KAAKoC,IAAI,EAAGksB,EAA8B,GAArBunC,EAAMx9D,OAAOkhE,QAIhD1D,EAAMx9D,OAAOq3B,QAAU,EAAG,CAC1B,MAAM8pC,EAAex5D,KAAKuD,IAAI4vD,EAAa0C,EAAMx9D,OAAOq3B,SACxDmmC,EAAMx9D,OAAOq3B,SAAW8pC,EACxBrG,GAAeqG,CACnB,CAYA,OATIrG,EAAc,IACd0C,EAAMx9D,OAAOo3B,MAAQ0jC,GAGzB0C,EAAMO,eAAiB38D,KAAKC,MAAQ,IAEpCtG,KAAK+kB,OAAOshD,iBAAiB5D,EAAOvnC,GAGhCunC,EAAMx9D,OAAOo3B,MAAQ,IACrBr8B,KAAKsmE,aAAaJ,IACX,EAIf,CAKQ,YAAAI,CAAaJ,GACjB,MAAMzD,EAAQziE,KAAK8hE,QAAQ54D,IAAIg9D,GAC1BzD,IAELA,EAAMp5B,SAAU,EAGhBo5B,EAAMx9D,OAAOk4B,QAAQhuB,QAAQguD,IACzBn9D,KAAK6hE,aAAanE,aAAa,GAAGwI,KAAW/I,EAAOzmD,QAIxD1W,KAAK6hE,aAAanB,aAAawF,GAE/BlmE,KAAK+kB,OAAOwhD,mBAAmB9D,GAE/BziE,KAAKgJ,OAAOpD,KAAK,gBAAgB68D,EAAMx9D,OAAOgB,QAClD,CAKQ,kBAAAs9D,GACJ,IAAA,MAAY2C,EAASzD,KAAUziE,KAAK8hE,QAAQp7D,UACnC+7D,EAAMp5B,SACPrpC,KAAK8hE,QAAQ14D,OAAO88D,EAGhC,CAMQ,sBAAA/B,CAAuB1B,GAC3B,MAAMv+B,EAAQt3B,KAAK2U,SAAW3U,KAAKuU,GAAK,EAClCnT,EAASy0D,EAAMM,cAAgB,GAAsB,GAAhBn2D,KAAK2U,UAEhD,MAAO,CACH7U,EAAG+1D,EAAMK,aAAap2D,EAAIE,KAAKiX,IAAIqgB,GAASl2B,EAC5CrB,EAAG81D,EAAMK,aAAan2D,EAAIC,KAAKqU,IAAIijB,GAASl2B,EAEpD,CAEQ,uBAAAo2D,CAAwB3B,GAC5B,MAAM+D,EAAiB,CACnB95D,EAAG+1D,EAAM/nD,SAAShO,EAAI1M,KAAK+hE,eAAer1D,EAC1CC,EAAG81D,EAAM/nD,SAAS/N,EAAI3M,KAAK+hE,eAAep1D,GAGxC8D,EAAW7D,KAAK8D,KAAK81D,EAAe95D,EAAI85D,EAAe95D,EAAI85D,EAAe75D,EAAI65D,EAAe75D,GACnG,OAAiB,IAAb8D,EACO,CAAE/D,EAAG+1D,EAAM/nD,SAAShO,EAAI,IAAKC,EAAG81D,EAAM/nD,SAAS/N,IAG1D65D,EAAe95D,GAAK+D,EACpB+1D,EAAe75D,GAAK8D,EAEb,CACH/D,EAAG+1D,EAAM/nD,SAAShO,EAAuB,IAAnB85D,EAAe95D,EACrCC,EAAG81D,EAAM/nD,SAAS/N,EAAuB,IAAnB65D,EAAe75D,GAE7C,CAEQ,qBAAAs4D,CAAsB3uD,EAAemwD,GACzC,MAAMvpD,EAAY,CACdxQ,EAAG4J,EAAK5J,EAAI+5D,EAAK/5D,EACjBC,EAAG2J,EAAK3J,EAAI85D,EAAK95D,GAGf8D,EAAW7D,KAAK8D,KAAKwM,EAAUxQ,EAAIwQ,EAAUxQ,EAAIwQ,EAAUvQ,EAAIuQ,EAAUvQ,GAC/E,OAAiB,IAAb8D,EAAuB6F,GAE3B4G,EAAUxQ,GAAK+D,EACfyM,EAAUvQ,GAAK8D,EAER,CACH/D,EAAG4J,EAAK5J,EAAkB,IAAdwQ,EAAUxQ,EACtBC,EAAG2J,EAAK3J,EAAkB,IAAduQ,EAAUvQ,GAE9B,CAEQ,qBAAAw4D,CAAsB1C,GAE1B,MAAM2C,EACCplE,KAAK+hE,eAAer1D,EAAI+1D,EAAM/nD,SAAShO,EADxC04D,EAECplE,KAAK+hE,eAAep1D,EAAI81D,EAAM/nD,SAAS/N,EAGxC8D,EAAW7D,KAAK8D,KAAK00D,EAAaA,EAAaA,EAAaA,GAClE,GAAiB,IAAb30D,EAAgB,OAAOgyD,EAAM/nD,SAGjC,MAAMgsD,EAAgB,CAClBh6D,GAAI04D,EAAa30D,EACjB9D,EAAGy4D,EAAa30D,GASpB,OALI7D,KAAK2U,SAAW,KAChBmlD,EAAch6D,IAAK,EACnBg6D,EAAc/5D,IAAK,GAGhB,CACHD,EAAG+1D,EAAM/nD,SAAShO,EAAsB,IAAlBg6D,EAAch6D,EACpCC,EAAG81D,EAAM/nD,SAAS/N,EAAsB,IAAlB+5D,EAAc/5D,EAE5C,CAEQ,qBAAAo4D,CAAsBrrC,GAC1B,MAAO,CACHhtB,EAAG1M,KAAK+hE,eAAer1D,EAAI1M,KAAKgiE,eAAet1D,EAAIgtB,EACnD/sB,EAAG3M,KAAK+hE,eAAep1D,EAAI3M,KAAKgiE,eAAer1D,EAAI+sB,EAE3D,CAEQ,cAAAqqC,CAAeztD,EAAemhB,GAGlC,OAAO,CACX,CAEQ,iBAAA8mC,CAAkB2C,EAAeC,GACrC,MAAM7zD,EAAK4zD,EAAKx0D,EAAIy0D,EAAKz0D,EACnBc,EAAK0zD,EAAKv0D,EAAIw0D,EAAKx0D,EACzB,OAAOC,KAAK8D,KAAKpD,EAAKA,EAAKE,EAAKA,EACpC,CAEQ,SAAAo4D,CAAUtvD,EAAcmhB,EAAYvnB,GACxC,IAAIy2D,EAAOlvC,EAAKnhB,EAGhB,KAAOqwD,EAAO/5D,KAAKuU,IAAIwlD,GAAkB,EAAV/5D,KAAKuU,GACpC,KAAOwlD,GAAQ/5D,KAAKuU,IAAIwlD,GAAkB,EAAV/5D,KAAKuU,GAErC,OAAO7K,EAAOqwD,EAAOz2D,CACzB,CAKA,MAAAmjB,CAAOC,GACH,IAAA,MAAWmvC,KAASziE,KAAK8hE,QAAQnpD,SACzB8pD,EAAMp5B,SACNrpC,KAAK4mE,YAAYtzC,EAAUmvC,EAGvC,CAKQ,WAAAmE,CAAYtzC,EAAoBmvC,GACpC,MAAMjwB,EAAMiwB,EAAM/nD,SACZrP,EAAOo3D,EAAMx9D,OAAOoG,KAGpBiB,EAAQtM,KAAK6mE,aAAapE,EAAMx9D,OAAOk+D,QAASV,EAAMx9D,OAAOi+D,WAGnE,GAA+B,UAA3BT,EAAMx9D,OAAOi+D,UAA+B,CAE5C,MAAM4D,EAAS9mE,KAAK+mE,kBAAkBv0B,EAAY,GAAPnnC,EAAYo3D,EAAM5pD,UAC7D7Y,KAAKgnE,aAAa1zC,EAAUwzC,EAAQx6D,EACxC,MAEItM,KAAKinE,SAAS3zC,EAAUkf,EAAKnnC,EAAMo3D,EAAM5pD,SAAUvM,GAIvDtM,KAAKknE,cAAc5zC,EAAUmvC,GAGT,SAAhBA,EAAMprD,OACNrX,KAAKmnE,mBAAmB7zC,EAAUmvC,EAE1C,CAEQ,YAAAoE,CAAa1D,EAAiBD,GASlC,MARgD,CAC5CkE,QAAS,CAAE97D,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC5B67D,OAAQ,CAAE/7D,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC3B87D,OAAQ,CAAEh8D,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC3B+7D,YAAa,CAAEj8D,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAChCg8D,SAAU,CAAEl8D,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAGZ23D,IAAY,CAAE73D,EAAG,GAAIC,EAAG,GAAIC,EAAG,GACxD,CAEQ,iBAAAu7D,CAAkBhqD,EAAiB1R,EAAcwN,GACrD,MAAMgL,EAAMjX,KAAKiX,IAAIhL,GACfoI,EAAMrU,KAAKqU,IAAIpI,GAErB,MAAO,CACH,CACInM,EAAGqQ,EAAOrQ,EAAImX,EAAMxY,EACpBsB,EAAGoQ,EAAOpQ,EAAIsU,EAAM5V,GAExB,CACIqB,EAAGqQ,EAAOrQ,EAAImX,GAAe,IAAPxY,GAAc4V,GAAc,GAAP5V,GAC3CsB,EAAGoQ,EAAOpQ,EAAIsU,GAAe,IAAP5V,GAAcwY,GAAc,GAAPxY,IAE/C,CACIqB,EAAGqQ,EAAOrQ,EAAImX,GAAe,IAAPxY,GAAc4V,GAAe,IAAP5V,GAC5CsB,EAAGoQ,EAAOpQ,EAAIsU,GAAe,IAAP5V,GAAcwY,GAAe,IAAPxY,IAGxD,CAEQ,YAAA27D,CAAa1zC,EAAoBwzC,EAAmBx6D,GAExD,IAAA,IAASC,EAAI,EAAGA,EAAIu6D,EAAOlgE,OAAQ2F,IAAK,CACpC,MAAMm/B,GAAQn/B,EAAI,GAAKu6D,EAAOlgE,OAC9B0sB,EAASrmB,SAAS65D,EAAOv6D,GAAGG,EAAGo6D,EAAOv6D,GAAGI,EAAGm6D,EAAOp7B,GAAMh/B,EAAGo6D,EAAOp7B,GAAM/+B,EAAGL,EAChF,CACJ,CAEQ,QAAA26D,CAAS3zC,EAAoBkf,EAAcnnC,EAAcwN,EAAkBvM,GAE/E,MAAMuX,EAAMjX,KAAKiX,IAAIhL,GACfoI,EAAMrU,KAAKqU,IAAIpI,GAEf4uD,EAAmB,GAAPp8D,EACZq8D,EAAoB,GAAPr8D,EAEbs8D,EAAU,CACZ,CAAEj7D,EAAG8lC,EAAI9lC,EAAImX,EAAM6jD,EAAazmD,EAAMwmD,EAAW96D,EAAG6lC,EAAI7lC,EAAIsU,EAAMymD,EAAa7jD,EAAM4jD,GACrF,CAAE/6D,EAAG8lC,EAAI9lC,EAAImX,EAAM6jD,EAAazmD,GAAQwmD,EAAY96D,EAAG6lC,EAAI7lC,EAAIsU,EAAMymD,EAAa7jD,GAAQ4jD,GAC1F,CAAE/6D,EAAG8lC,EAAI9lC,EAAImX,GAAQ6jD,EAAczmD,GAAQwmD,EAAY96D,EAAG6lC,EAAI7lC,EAAIsU,GAAQymD,EAAc7jD,GAAQ4jD,GAChG,CAAE/6D,EAAG8lC,EAAI9lC,EAAImX,GAAQ6jD,EAAczmD,EAAMwmD,EAAW96D,EAAG6lC,EAAI7lC,EAAIsU,GAAQymD,EAAc7jD,EAAM4jD,IAI/F,IAAA,IAASl7D,EAAI,EAAGA,EAAIo7D,EAAQ/gE,OAAQ2F,IAAK,CACrC,MAAMm/B,GAAQn/B,EAAI,GAAKo7D,EAAQ/gE,OAC/B0sB,EAASrmB,SAAS06D,EAAQp7D,GAAGG,EAAGi7D,EAAQp7D,GAAGI,EAAGg7D,EAAQj8B,GAAMh/B,EAAGi7D,EAAQj8B,GAAM/+B,EAAGL,EACpF,CAGA,MAAMs7D,EAASp1B,EAAI9lC,EAAImX,EAAM6jD,EACvBG,EAASr1B,EAAI7lC,EAAIsU,EAAMymD,EAC7Bp0C,EAAStnB,SAAS47D,EAAS,EAAGC,EAAS,EAAG,EAAG,EAAGv7D,EACpD,CAEQ,aAAA46D,CAAc5zC,EAAoBmvC,GACtC,MAAMjwB,EAAMiwB,EAAM/nD,SACZrP,EAAOo3D,EAAMx9D,OAAOoG,KAEpBy8D,EAAkB,IAAPz8D,EAEX08D,EAAOv1B,EAAI7lC,EAAW,GAAPtB,EAGrBioB,EAAStnB,SAASwmC,EAAI9lC,EAAIo7D,EAAS,EAAGC,EAAMD,EAJ1B,EAI+C,CAAEx8D,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAGpF,MAAMw8D,EAAgBvF,EAAMx9D,OAAOo3B,KAAOomC,EAAMx9D,OAAOu2B,QACjDysC,EAAcH,EAAWE,EACzBE,EAAcF,EAAgB,GAChC,CAAE18D,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnBw8D,EAAgB,GACZ,CAAE18D,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACnB,CAAEF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAK3B,GAHA8nB,EAAStnB,SAASwmC,EAAI9lC,EAAIo7D,EAAS,EAAGC,EAAME,EAf1B,EAekDC,GAGhEzF,EAAMx9D,OAAOw2B,WAAa,EAAG,CAC7B,MACM0sC,EAAcL,GADErF,EAAMx9D,OAAOq3B,QAAUmmC,EAAMx9D,OAAOw2B,YAE1DnI,EAAStnB,SAASwmC,EAAI9lC,EAAIo7D,EAAS,EAAGC,EAAO,EAAGI,EAAa,EAAG,CAAE78D,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACvF,CACJ,CAEQ,kBAAA27D,CAAmB7zC,EAAoBmvC,GAC3C,MAAMjwB,EAAMiwB,EAAM/nD,SAUZpO,EATwC,CAC1C87D,OAAkB,CAAE98D,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACrC68D,OAAkB,CAAE/8D,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACrCyc,OAAkB,CAAE3c,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACrC88D,MAAiB,CAAEh9D,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACpC+8D,QAAmB,CAAEj9D,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACtCg9D,QAAmB,CAAEl9D,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAGhBi3D,EAAMprD,QAAU,CAAE/L,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC7D8nB,EAAStnB,SAASwmC,EAAI9lC,EAAI,EAAG8lC,EAAI7lC,EAAI81D,EAAMx9D,OAAOoG,KAAO,EAAG,EAAG,EAAGiB,EACtE,CAKA,aAAAm8D,GACI,OAAOpyD,MAAMC,KAAKtW,KAAK8hE,QAAQnpD,UAAU3Q,OAAOyK,GAAKA,EAAE42B,QAC3D,CAKA,QAAAq/B,CAASxC,GACL,OAAOlmE,KAAK8hE,QAAQ54D,IAAIg9D,IAAY,IACxC,CAKA,QAAA3oD,GAMI,MAAMorD,EAAkD,CAAA,EAClDC,EAA8C,CAAA,EAEpD,IAAIC,EAAa,EAEjB,IAAA,MAAWpG,KAASziE,KAAK8hE,QAAQnpD,SACzB8pD,EAAMp5B,UACNw/B,IACAF,EAAiBlG,EAAMx9D,OAAOk+D,UAAYwF,EAAiBlG,EAAMx9D,OAAOk+D,UAAY,GAAK,EACzFyF,EAAenG,EAAMprD,QAAUuxD,EAAenG,EAAMprD,QAAU,GAAK,GAI3E,MAAO,CACHyxD,aAAc9oE,KAAK8hE,QAAQz2D,KAC3B09D,aAAcF,EACdF,mBACAC,iBAER,CAKA,YAAAI,GACI,IAAA,MAAY9C,KAAYlmE,KAAK8hE,QAAQp7D,UACjC1G,KAAKsmE,aAAaJ,GAEtBlmE,KAAK8hE,QAAQ55D,OACjB,ECn7BG,MAAM+gE,EA4BT,WAAAnkE,CACIusD,EACAwG,EACA9yC,EAAuB,CAAA,GAxB3B/kB,KAAQkpE,qBAAqDpgE,IAC7D9I,KAAQmpE,YAA2B,CAC/BC,iBAAkB,EAClBC,oBAAqB,EACrBC,iBAAkB,EAClBC,SAAU,EACVC,WAAY,EACZC,oBAAqB,EACrBC,iBAAkB,GAItB1pE,KAAQ+hE,eAA0B,CAAEr1D,EAAG,EAAGC,EAAG,GAC7C3M,KAAQgiE,eAA0B,CAAEt1D,EAAG,EAAGC,EAAG,GAC7C3M,KAAQiiE,WAAqB,GAC7BjiE,KAAQ2pE,WAAqB,IAC7B3pE,KAAQ4pE,cAAwB,IAU5B5pE,KAAKgJ,OAAS,IAAIO,EAAO,iBACzBvJ,KAAKqxD,aAAeA,EACpBrxD,KAAK63D,UAAYA,EACjB73D,KAAK+kB,OAASA,EAGd/kB,KAAK6hE,aAAe,IAAInF,EAAa,CACjC2B,cAAe,CAAClB,EAAQr0B,KACpB9oC,KAAKmpE,YAAYK,aACjBxpE,KAAKgJ,OAAOxD,MAAM,MAAM23D,EAAOl3D,eAEnCm6D,gBAAiB,CAACt3B,EAAYx/B,KAC1BtJ,KAAK6pE,oBAAoB/gC,EAAYx/B,IAEzC80D,iBAAmBjB,IACfn9D,KAAKgJ,OAAOnD,KAAK,MAAMs3D,EAAOl3D,sBAKtCjG,KAAK8pE,QAAU,IAAIlI,EAAQ5hE,KAAK6hE,aAAc,CAC1CoB,eAAiBR,IACbziE,KAAKgJ,OAAOpD,KAAK,qBAAqB68D,EAAMx9D,OAAOgB,SAEvDsgE,iBAAmB9D,IACfziE,KAAK+pE,qBAAqBtH,IAE9B4D,eAAgB,CAAC5D,EAAOvnC,KACpBl7B,KAAKgJ,OAAOxD,MAAM,MAAMi9D,EAAMx9D,OAAOgB,aAAai1B,eAI1Dl7B,KAAKgqE,0BAELhqE,KAAKgJ,OAAOpD,KAAK,gCACrB,CAKQ,uBAAAokE,GAEJ,MAAMC,EAA2B,CAC7BvzD,GAAI,iBACJzQ,KAAM,qBACNhC,KAAMu4D,EAAW0N,OACjBnrC,WAAY09B,EAAWyN,OACvBhzC,MAAO,CACHgE,OAAQ,GACRoR,MAAO,IACPwxB,SAAU,EACVp6B,WAAY,EACZsiC,SAAU,GACVvqD,YAAa,GACb0iD,OAAQ,EACRH,WAAY,EACZn6B,aAAc,GAElBsmC,WAAY,CAAEz9D,EAAG,EAAGC,GAAG,IACvBy9D,cAAe,SAGbC,EAAgC,CAClC3zD,GAAI,kBACJzQ,KAAM,cACNhC,KAAMu4D,EAAW8N,WACjBvrC,WAAY09B,EAAW8N,QACvBrzC,MAAO,CACHgE,OAAQ,GACRoR,MAAO,IACPwxB,SAAU,EACVp6B,WAAY,EACZsiC,SAAU,GACVvqD,YAAa,GACb0iD,OAAQ,EACRH,WAAY,EACZn6B,aAAc,EACd05B,aAAc,IACdiN,WAAY,GAEhBL,WAAY,CAAEz9D,EAAG,EAAGC,EAAG,IACvBy9D,cAAe,SAGnBpqE,KAAK6hE,aAAa3E,UAAU+M,GAC5BjqE,KAAK6hE,aAAa3E,UAAUmN,GAE5BrqE,KAAKgJ,OAAOpD,KAAK,gCAAiC,CAC9CojB,MAAOihD,EAAWhkE,KAClBwkE,OAAQJ,EAAgBpkE,MAEhC,CAKQ,mBAAA4jE,CAAoB/gC,EAAiBx/B,GAGzC,GAFAtJ,KAAKmpE,YAAYI,WAEO,WAApBjgE,EAAOw1D,SAEP9+D,KAAK2pE,WAAa/8D,KAAKoC,IAAI,EAAGhP,KAAK2pE,WAAargE,EAAO4xB,QACvDl7B,KAAKmpE,YAAYE,qBAAuB//D,EAAO4xB,OAE/Cl7B,KAAK+kB,OAAO2lD,kBAAkBphE,EAAO4xB,OAAQ5xB,EAAOy1B,YAEpD/+B,KAAKgJ,OAAOpD,KAAK,qBAAqB0D,EAAO4xB,UAAU5xB,EAAOy1B,oBAAqB,CAC/E74B,SAAUoD,EAAO02D,YACjBC,WAAY32D,EAAO22D,WACnB0K,cAAe3qE,KAAK2pE,iBAErB,CAEH,MAAM/oC,EAAY5gC,KAAK8pE,QAAQhrC,YAAYx1B,EAAOw1D,SAAUx1D,EAAO4xB,OAAQ5xB,EAAOy1B,YAClF/+B,KAAKmpE,YAAYC,kBAAoB9/D,EAAO4xB,OAExC0F,GACA5gC,KAAKmpE,YAAYG,kBAEzB,CAEAtpE,KAAK+kB,OAAO6lD,uBAAuB5qE,KAAKmpE,YAC5C,CAKQ,oBAAAY,CAAqBtH,GACzB,MAAMoI,EAAU7qE,KAAK8qE,iBAAiBrI,EAAMx9D,QAG5C4lE,EAAQxe,MAAMl9C,QAAQ6pB,IAClBh5B,KAAK63D,UAAU/J,QAAQ90B,EAAM,KAIjCh5B,KAAKmpE,YAAYO,kBAAoBmB,EAAQ9zC,WAE7C/2B,KAAK+kB,OAAOwhD,mBAAmB9D,EAAMx9D,OAAOyR,GAAIm0D,GAGhD7qE,KAAK+qE,2BAEL/qE,KAAKgJ,OAAOpD,KAAK,6BAA8B,CAC3C68D,MAAOA,EAAMx9D,OAAOgB,KACpBomD,MAAOwe,EAAQxe,MAAMzlD,OACrBmwB,WAAY8zC,EAAQ9zC,YAE5B,CAKQ,gBAAA+zC,CAAiBE,GACrB,MAAM3e,EAAoB,GAC1B,IAAIt1B,EAAa,EAajBA,EAVkD,CAC9C,CAAC4qC,EAAUsJ,OAAQ,EACnB,CAACtJ,EAAUuJ,SAAU,GACrB,CAACvJ,EAAUwJ,UAAW,GACtB,CAACxJ,EAAUyJ,SAAU,GACrB,CAACzJ,EAAU0J,WAAY,IACvB,CAAC1J,EAAU2J,SAAU,IACrB,CAAC3J,EAAU4J,YAAa,KAGAP,EAAY9H,YAAc,GAItD,GAAIt2D,KAAK2U,SADU,GACa,CAC5B,MAAMiqD,EAAaxrE,KAAKqxD,aAAalB,qBACjCqb,GACAnf,EAAM1lD,KAAK6kE,EAEnB,CAGA,MAOMC,EAP+C,CACjDrE,QAAS,CAAC,aAAc,gBACxBC,OAAQ,CAAC,oBAAqB,qBAC9BG,SAAU,CAAC,eAAgB,mBAC3BD,YAAa,CAAC,iBAAkB,wBAGHyD,EAAY7H,UAAY,GACzD,GAAIsI,EAAa7kE,OAAS,GAAKgG,KAAK2U,SAAW,GAAK,CAChD,MAAMmqD,EAASD,EAAa7+D,KAAKC,MAAMD,KAAK2U,SAAWkqD,EAAa7kE,SAC9D+kE,EAAW3rE,KAAKqxD,aAAa9pD,QAAQmkE,GACvCC,GACAtf,EAAM1lD,KAAKglE,EAEnB,CAEA,MAAO,CAAEtf,QAAOt1B,aACpB,CAKA,cAAA60C,CAAeC,GACXA,EAAUlpC,UAAW,EACrBkpC,EAAU5iE,UAAY5C,KAAKC,MAG3BulE,EAAUC,aAAa38D,QAAQ,CAAClK,EAAQ6H,KACpC,MAAMi/D,EAAWF,EAAUG,eAAel/D,IAAU,CAAEJ,EAAG,IAAKC,EAAG,KACjE3M,KAAK8pE,QAAQtH,WAAWv9D,EAAQ8mE,KAGpC/rE,KAAKkpE,iBAAiBngE,IAAI8iE,EAAUn1D,GAAIm1D,GACxC7rE,KAAK+kB,OAAOknD,qBAAqBJ,GAEjC7rE,KAAKgJ,OAAOpD,KAAK,gCAAgCimE,EAAU5lE,OAAQ,CAC/DwoB,WAAYo9C,EAAUp9C,WACtBqzC,QAAS+J,EAAUC,aAAallE,QAExC,CAKQ,wBAAAmkE,GACJ,IAAA,MAAYmB,EAAaL,KAAc7rE,KAAKkpE,iBAAiBxiE,UAAW,CACpE,IAAKmlE,EAAUlpC,SAAU,SAMO,IAHP3iC,KAAK8pE,QAAQrB,gBACjCzgE,OAAOy6D,GAASoJ,EAAUC,aAAa74C,QAAehuB,EAAOyR,KAAO+rD,EAAMx9D,OAAOyR,KAEjE9P,SAEjBilE,EAAUlpC,UAAW,EACrBkpC,EAAUM,eAAiB9lE,KAAKC,MAEhCtG,KAAKmpE,YAAYM,sBACjBzpE,KAAK+kB,OAAOqnD,uBAAuBP,GAAW,GAE9C7rE,KAAKgJ,OAAOpD,KAAK,0BAA0BimE,EAAU5lE,OAAQ,CACzDkD,UAAW0iE,EAAUM,eAAiBN,EAAU5iE,WAAa,IAC7D4hE,QAASgB,EAAUhB,UAGvB7qE,KAAKkpE,iBAAiB9/D,OAAO8iE,GAErC,CACJ,CAKA,kBAAAG,GACI,MAAMC,EAAgC,GA2EtC,OAxEAA,EAAW3lE,KAAK,CACZ+P,GAAI,kBACJzQ,KAAM,gBACNwoB,WAAY,EACZq9C,aAAc,CACV9rE,KAAKusE,kBAAkB,mBAAoB,iBAAkB5K,EAAUuJ,QAAS,UAAWxJ,EAAW8K,YACtGxsE,KAAKusE,kBAAkB,iBAAkB,eAAgB5K,EAAUsJ,MAAO,UAAWvJ,EAAW+K,WAEpGT,eAAgB,CACZ,CAAEt/D,EAAG,IAAKC,EAAG,KACb,CAAED,EAAG,IAAKC,EAAG,MAEjBk+D,QAAS,CACL9zC,WAAY,GACZ21C,QAAS,IACTrgB,MAAO,CACH,CAAE2D,OAAQ,aAAc7M,SAAU,EAAGwpB,SAAU,IAC/C,CAAE3c,OAAQ,kBAAmB7M,SAAU,EAAGwpB,SAAU,MAG5DhqC,UAAU,EACV15B,UAAW,IAIfqjE,EAAW3lE,KAAK,CACZ+P,GAAI,gBACJzQ,KAAM,cACNwoB,WAAY,EACZq9C,aAAc,CACV9rE,KAAKusE,kBAAkB,mBAAoB,iBAAkB5K,EAAUwJ,SAAU,SAAUzJ,EAAWkL,UAE1GZ,eAAgB,CACZ,CAAEt/D,EAAG,IAAKC,EAAG,MAEjBk+D,QAAS,CACL9zC,WAAY,GACZ21C,QAAS,IACTrgB,MAAO,CACH,CAAE2D,OAAQ,oBAAqB7M,SAAU,EAAGwpB,SAAU,IACtD,CAAE3c,OAAQ,oBAAqB7M,SAAU,EAAGwpB,SAAU,MAG9DhqC,UAAU,EACV15B,UAAW,IAIfqjE,EAAW3lE,KAAK,CACZ+P,GAAI,kBACJzQ,KAAM,qBACNwoB,WAAY,EACZq9C,aAAc,CACV9rE,KAAKusE,kBAAkB,iBAAkB,oBAAqB5K,EAAUyJ,QAAS,cAAe1J,EAAWmL,WAC3G7sE,KAAKusE,kBAAkB,iBAAkB,oBAAqB5K,EAAUuJ,QAAS,cAAexJ,EAAWoL,UAE/Gd,eAAgB,CACZ,CAAEt/D,EAAG,IAAKC,EAAG,KACb,CAAED,EAAG,IAAKC,EAAG,MAEjBk+D,QAAS,CACL9zC,WAAY,IACZ21C,QAAS,IACTrgB,MAAO,CACH,CAAE2D,OAAQ,sBAAuB7M,SAAU,EAAGwpB,SAAU,IACxD,CAAE3c,OAAQ,iBAAkB7M,SAAU,EAAGwpB,SAAU,MAG3DhqC,UAAU,EACV15B,UAAW,IAGRqjE,CACX,CAKQ,iBAAAC,CACJ71D,EACAzQ,EACAi9D,EACAC,EACAC,GAGA,MAAM2J,EAAqC,CACvC,CAACpL,EAAUsJ,OAAQ,CACf5/D,KAAM,EAAGm6D,SAAU,IAAKnpC,KAAM,GAAIc,QAAS,CAACn9B,KAAKgtE,kBAAkB,cAAexQ,EAAW0N,OAAQ,MAEzG,CAACvI,EAAUuJ,SAAU,CACjB7/D,KAAM,GAAIm6D,SAAU,IAAKnpC,KAAM,GAAIc,QAAS,CAACn9B,KAAKgtE,kBAAkB,iBAAkBxQ,EAAW8N,WAAY,MAEjH,CAAC3I,EAAUwJ,UAAW,CAClB9/D,KAAM,GAAIm6D,SAAU,IAAKnpC,KAAM,IAAKc,QAAS,CACzCn9B,KAAKgtE,kBAAkB,iBAAkBxQ,EAAW0N,OAAQ,IAC5DlqE,KAAKgtE,kBAAkB,oBAAqBxQ,EAAWyQ,QAAS,MAGxE,CAACtL,EAAUyJ,SAAU,CACjB//D,KAAM,GAAIm6D,SAAU,IAAKnpC,KAAM,IAAKc,QAAS,CACzCn9B,KAAKgtE,kBAAkB,iBAAkBxQ,EAAW0Q,OAAQ,IAC5DltE,KAAKgtE,kBAAkB,iBAAkBxQ,EAAW8N,WAAY,OAKtEpzC,EAAQ61C,EAAW7J,IAAc6J,EAAWpL,EAAUuJ,SAE5D,MAAO,CACHx0D,KACAzQ,OACAi9D,YACAC,UAEA93D,KAAM6rB,EAAM7rB,KACZwP,KAAmB,GAAbqc,EAAM7rB,KACZm6D,SAAUtuC,EAAMsuC,SAChBprD,aAAc,GACdyrD,SAAU,EAEVxpC,KAAMnF,EAAMmF,KACZb,QAAStE,EAAMmF,KACfC,QAAS4mC,IAAcvB,EAAUsJ,MAAQ,EAAiB,GAAb/zC,EAAMmF,KACnDZ,WAAYynC,IAAcvB,EAAUsJ,MAAQ,EAAiB,GAAb/zC,EAAMmF,KACtD8pC,MAAOv5D,KAAKC,MAAmB,GAAbqqB,EAAMmF,MAExB+mC,WACA+J,WAAY/J,IAAa1B,EAAW8K,WAAa,GAAM,GACvDvG,aAAc,GACdD,SAAU,IACVxC,aAAc,GAEdrmC,QAASjG,EAAMiG,QACf2mC,gBAA8B,GAAb5sC,EAAM7rB,KACvB24D,eAA6B,GAAb9sC,EAAM7rB,KAE9B,CAKQ,iBAAA2hE,CAAkBt2D,EAAYzS,EAAkBi3B,GACpD,MAAMkyC,EAAY,CACd,CAAC5Q,EAAW0N,QAAS,CAAE59B,MAAO,IAAKwxB,SAAU,IAAKp6B,WAAY,GAC9D,CAAC84B,EAAW8N,YAAa,CAAEh+B,MAAO,IAAKwxB,SAAU,EAAKp6B,WAAY,GAClE,CAAC84B,EAAWyQ,SAAU,CAAE3gC,MAAO,IAAKwxB,SAAU,GAAKp6B,WAAY,IAC/D,CAAC84B,EAAW0Q,QAAS,CAAE5gC,MAAO,IAAKwxB,SAAU,IAAKp6B,WAAY,IAC9D,CAAC84B,EAAW6Q,MAAO,CAAE/gC,MAAO,IAAKwxB,SAAU,EAAKp6B,WAAY,GAC5D,CAAC84B,EAAW8Q,SAAU,CAAEhhC,MAAO,IAAKwxB,SAAU,GAAKp6B,WAAY,KAG7DxM,EAAQk2C,EAAUnpE,IAASmpE,EAAU5Q,EAAW0N,QAEtD,MAAO,CACHxzD,KACAzQ,KAAM,GAAGhC,WACTA,OACA86B,WAAY96B,IAASu4D,EAAW0N,OAASzN,EAAWyN,OAASzN,EAAW8N,QACxErzC,MAAO,CACHgE,SACAoR,MAAOpV,EAAMoV,MACbwxB,SAAU5mC,EAAM4mC,SAChBp6B,WAAYxM,EAAMwM,WAClBsiC,SAAU,GACVvqD,YAAa,GACb0iD,OAAQ,EACRH,WAAY,EACZn6B,aAAc,GAElBsmC,WAAY,CAAEz9D,EAAG,EAAGC,EAAG,GACvBy9D,cAAe,QAEvB,CAKA,MAAA51D,CAAOC,GAEHzU,KAAK6hE,aAAartD,OAAOC,GAGzBzU,KAAK8pE,QAAQzG,aAAarjE,KAAK+hE,eAAgB/hE,KAAKgiE,eAAgBhiE,KAAKiiE,YACzEjiE,KAAK8pE,QAAQt1D,OAAOC,GAGpBzU,KAAK+qE,0BACT,CAKA,YAAA1H,CAAa3oD,EAAmBH,EAAmBlP,EAAcgxB,EAAcb,GAC3Ex7B,KAAK+hE,eAAiB,IAAKrnD,GAC3B1a,KAAKgiE,eAAiB,IAAKznD,GAC3Bva,KAAKiiE,WAAa52D,EAClBrL,KAAK2pE,WAAattC,EAClBr8B,KAAK4pE,cAAgBpuC,CACzB,CAKA,gBAAA+xC,CAAiB5P,EAAkBX,GAC/B,OAAOh9D,KAAK6hE,aAAar5B,WAAWm1B,EAAU39D,KAAK+hE,eAAgB/E,EACvE,CAKA,MAAA3pC,CAAOC,GAEHtzB,KAAK6hE,aAAaxuC,OAAOC,GAGzBtzB,KAAK8pE,QAAQz2C,OAAOC,EACxB,CAKA,oBAAAk6C,GACI,MAAMlB,EAAatsE,KAAKqsE,qBACxB,GAAIC,EAAW1lE,OAAS,EAAG,CACvB,MAAM6mE,EAAc7gE,KAAKC,MAAMD,KAAK2U,SAAW+qD,EAAW1lE,QAC1D5G,KAAK4rE,eAAeU,EAAWmB,GACnC,CACJ,CAKA,cAAAC,GACI,MAAO,IAAK1tE,KAAKmpE,YACrB,CAKA,mBAAAwE,GACI,OAAOt3D,MAAMC,KAAKtW,KAAKkpE,iBAAiBvwD,SAC5C,CAKA,gBAAAi1D,GACI,OAAO5tE,KAAK6hE,aAAajB,gBAAgB54D,OAAO6lE,GAAKA,EAAE1Q,OAAOzmD,GAAGo3D,WAAW,WAChF,CAKA,UAAAC,GACI,OAAO/tE,KAAK8pE,QAAQrB,eACxB,CAKA,WAAAuF,GACIhuE,KAAK6hE,aAAaL,mBAClBxhE,KAAK8pE,QAAQd,eACbhpE,KAAKkpE,iBAAiBhhE,QAEtBlI,KAAKgJ,OAAOpD,KAAK,oBACrB,CAKA,UAAAqoE,GACIjuE,KAAKmpE,YAAc,CACfC,iBAAkB,EAClBC,oBAAqB,EACrBC,iBAAkB,EAClBC,SAAU,EACVC,WAAY,EACZC,oBAAqB,EACrBC,iBAAkB,GAGtB1pE,KAAK+kB,OAAO6lD,uBAAuB5qE,KAAKmpE,YAC5C,EC3lBG,IAAK+E,GAAAA,IACRA,EAAA,SAAW,WACXA,EAAA,aAAe,eACfA,EAAA,UAAY,YACZA,EAAA,WAAa,aACbA,EAAA,SAAW,WACXA,EAAA,UAAY,YANJA,IAAAA,GAAA,CAAA,GAqGL,MAAMC,EAUT,WAAArpE,CAAYigB,EAA4B,IALxC/kB,KAAQouE,qBAAiC,GACzCpuE,KAAQquE,qBAAiC,GAKrCruE,KAAKgJ,OAAS,IAAIO,EAAO,qBACzBvJ,KAAK+kB,OAASA,EAEd/kB,KAAKsuE,2BACLtuE,KAAKuuE,sBACLvuE,KAAKwuE,mBACLxuE,KAAKyuE,yBAELzuE,KAAKgJ,OAAOpD,KAAK,2CACrB,CAKQ,wBAAA0oE,GAEJ,IAAA,IAASppE,EAAQ,EAAGA,GAAS,IAAKA,IAAS,CACvC,MAAMwpE,EAAS,IACTC,EAAa/hE,KAAK+D,IAAI,KAAMzL,EAAQ,GAC1ClF,KAAKouE,qBAAqBznE,KAAKiG,KAAKC,MAAM6hE,EAASC,GACvD,CAGA,IAAA,IAASzpE,EAAQ,EAAGA,GAAS,GAAIA,IAAS,CACtC,MAAMwpE,EAAS,GACTC,EAAa/hE,KAAK+D,IAAI,IAAKzL,EAAQ,GACzClF,KAAKquE,qBAAqB1nE,KAAKiG,KAAKC,MAAM6hE,EAASC,GACvD,CACJ,CAKQ,mBAAAJ,GACJvuE,KAAK4uE,UAAY,CACb3oE,KAAM,UACNf,MAAO,EACP6xB,WAAY,EACZ83C,iBAAkB7uE,KAAKouE,qBAAqB,GAE5CU,YAAa,EACbC,gBAAiB,GAEjBC,cAAe,EACfC,gBAAiB,EACjBC,gBAAiB,EACjBp3B,iBAAkB,EAClBq3B,cAAe,EACfC,aAAc,EAEdC,WAAYvmE,IACZwmE,eAAgBxmE,IAChBymE,iBAAkBzmE,KAItB,IAAA,MAAW0mE,KAAYv6C,OAAOtc,OAAOu1D,GACjCluE,KAAK4uE,UAAUU,WAAWvmE,IAAIymE,EAAU,CACpCvrE,KAAMurE,EACNjtD,MAAO,GACPktD,UAAW,GACXhY,UAAW,IAGvB,CAKQ,gBAAA+W,GACoB,CAEpB,CACI93D,GAAI,qBACJzQ,KAAM,qBACNinD,SAAU,SACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,uCACb0iB,QAAS,CACL,CAAE1rE,KAAM,SAAUse,MAAO,EAAG0qC,YAAa,+BACzC,CAAEhpD,KAAM,WAAYse,MAAO,EAAG0qC,YAAa,4BAGnD,CACIv2C,GAAI,kBACJzQ,KAAM,kBACNinD,SAAU,SACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,4CACb2iB,aAAc,qBACdC,kBAAmB,EACnBF,QAAS,CACL,CAAE1rE,KAAM,aAAcse,MAAO,EAAG0qC,YAAa,mCAC7C,CAAEhpD,KAAM,iBAAkBse,MAAO,EAAG0qC,YAAa,+BAGzD,CACIv2C,GAAI,iBACJzQ,KAAM,iBACNinD,SAAU,SACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,4CACb0iB,QAAS,CACL,CAAE1rE,KAAM,WAAYse,MAAO,EAAG0qC,YAAa,iCAC3C,CAAEhpD,KAAM,aAAcse,MAAO,EAAG0qC,YAAa,qCAKrD,CACIv2C,GAAI,gBACJzQ,KAAM,gBACNinD,SAAU,WACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,0CACb0iB,QAAS,CACL,CAAE1rE,KAAM,QAASse,MAAO,EAAG0qC,YAAa,4BACxC,CAAEhpD,KAAM,aAAcse,MAAO,EAAG0qC,YAAa,6BAGrD,CACIv2C,GAAI,oBACJzQ,KAAM,oBACNinD,SAAU,WACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,uDACb2iB,aAAc,gBACdC,kBAAmB,EACnBF,QAAS,CACL,CAAE1rE,KAAM,aAAcse,MAAO,EAAG0qC,YAAa,kCAGrD,CACIv2C,GAAI,kBACJzQ,KAAM,kBACNinD,SAAU,WACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,oDACb0iB,QAAS,CACL,CAAE1rE,KAAM,iBAAkBse,MAAO,EAAG0qC,YAAa,kCACjD,CAAEhpD,KAAM,QAASse,MAAO,EAAG0qC,YAAa,8BAKhD,CACIv2C,GAAI,gBACJzQ,KAAM,gBACNinD,SAAU,cACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,+CACb0iB,QAAS,CACL,CAAE1rE,KAAM,aAAcse,MAAO,EAAG0qC,YAAa,mCAC7C,CAAEhpD,KAAM,iBAAkBse,MAAO,EAAG0qC,YAAa,+BAGzD,CACIv2C,GAAI,mBACJzQ,KAAM,mBACNinD,SAAU,cACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,0CACb0iB,QAAS,CACL,CAAE1rE,KAAM,WAAYse,MAAO,EAAG0qC,YAAa,gCAC3C,CAAEhpD,KAAM,aAAcse,MAAO,EAAG0qC,YAAa,oCAGrD,CACIv2C,GAAI,oBACJzQ,KAAM,oBACNinD,SAAU,cACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,uDACb2iB,aAAc,gBACdC,kBAAmB,EACnBF,QAAS,CACL,CAAE1rE,KAAM,aAAcse,MAAO,EAAG0qC,YAAa,yCAKrD,CACIv2C,GAAI,kBACJzQ,KAAM,kBACNinD,SAAU,UACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,uCACb0iB,QAAS,CACL,CAAE1rE,KAAM,YAAase,MAAO,EAAG0qC,YAAa,gCAC5C,CAAEhpD,KAAM,aAAcse,MAAO,EAAG0qC,YAAa,iCAGrD,CACIv2C,GAAI,uBACJzQ,KAAM,uBACNinD,SAAU,UACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,sDACb0iB,QAAS,CACL,CAAE1rE,KAAM,aAAcse,MAAO,EAAG0qC,YAAa,kCAKrD,CACIv2C,GAAI,cACJzQ,KAAM,cACNinD,SAAU,QACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,6CACb0iB,QAAS,CACL,CAAE1rE,KAAM,aAAcse,MAAO,EAAG0qC,YAAa,gCAGrD,CACIv2C,GAAI,kBACJzQ,KAAM,kBACNinD,SAAU,QACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,2DACb2iB,aAAc,cACdC,kBAAmB,EACnBF,QAAS,CACL,CAAE1rE,KAAM,YAAase,MAAO,EAAG0qC,YAAa,kCAKpD,CACIv2C,GAAI,sBACJzQ,KAAM,sBACNinD,SAAU,cACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,mDACb0iB,QAAS,CACL,CAAE1rE,KAAM,aAAcse,MAAO,EAAG0qC,YAAa,gCAC7C,CAAEhpD,KAAM,YAAase,MAAO,EAAG0qC,YAAa,uCAGpD,CACIv2C,GAAI,cACJzQ,KAAM,cACNinD,SAAU,cACVhoD,MAAO,EACP6xB,WAAY,EACZ24C,SAAU,GACVziB,YAAa,gDACb2iB,aAAc,sBACdC,kBAAmB,EACnBF,QAAS,CACL,CAAE1rE,KAAM,aAAcse,MAAO,EAAG0qC,YAAa,gDAKlD99C,QAAQ2gE,IACX9vE,KAAK4uE,UAAUS,OAAOtmE,IAAI+mE,EAAMp5D,GAAIo5D,IAE5C,CAKQ,sBAAArB,GACgC,CAChC,CACI/3D,GAAI,cACJzQ,KAAM,cACNgnD,YAAa,gCACbC,SAAU,SACV1M,aAAc,CACV,CAAEv8C,KAAM,eAAgBs7D,OAAQ,EAAGwQ,QAAS,IAEhDlF,QAAS,CACL,CAAE5mE,KAAM,aAAcse,MAAO,IAC7B,CAAEte,KAAM,eAAgBse,MAAO,IAEnCytD,UAAU,EACVC,QAAQ,GAEZ,CACIv5D,GAAI,YACJzQ,KAAM,YACNgnD,YAAa,yBACbC,SAAU,SACV1M,aAAc,CACV,CAAEv8C,KAAM,eAAgBs7D,OAAQ,GAAIwQ,QAAS,IAEjDlF,QAAS,CACL,CAAE5mE,KAAM,aAAcse,MAAO,KAC7B,CAAEte,KAAM,eAAgBse,MAAO,IAEnCytD,UAAU,EACVC,QAAQ,GAEZ,CACIv5D,GAAI,WACJzQ,KAAM,WACNgnD,YAAa,2BACbC,SAAU,cACV1M,aAAc,CACV,CAAEv8C,KAAM,mBAAoBs7D,OAAQ,GAAIwQ,QAAS,IAErDlF,QAAS,CACL,CAAE5mE,KAAM,aAAcse,MAAO,KAC7B,CAAEte,KAAM,mBAAoBse,MAAO,IAEvCytD,UAAU,EACVC,QAAQ,GAEZ,CACIv5D,GAAI,mBACJzQ,KAAM,mBACNgnD,YAAa,kBACbC,SAAU,cACV1M,aAAc,CACV,CAAEv8C,KAAM,cAAes7D,OAAQ,IAAKwQ,QAAS,IAEjDlF,QAAS,CACL,CAAE5mE,KAAM,aAAcse,MAAO,KAC7B,CAAEte,KAAM,eAAgBse,MAAO,IAEnCytD,UAAU,EACVC,QAAQ,GAEZ,CACIv5D,GAAI,cACJzQ,KAAM,cACNgnD,YAAa,yBACbC,SAAU,QACV1M,aAAc,CACV,CAAEv8C,KAAM,eAAgBs7D,OAAQ,IAASwQ,QAAS,IAEtDlF,QAAS,CACL,CAAE5mE,KAAM,aAAcse,MAAO,KAC7B,CAAEte,KAAM,mBAAoBse,MAAO,IAEvCytD,UAAU,EACVC,QAAQ,GAEZ,CACIv5D,GAAI,eACJzQ,KAAM,eACNgnD,YAAa,4BACbC,SAAU,cACV1M,aAAc,CACV,CAAEv8C,KAAM,kBAAmBs7D,OAAQ,IAAQwQ,QAAS,IAExDlF,QAAS,CACL,CAAE5mE,KAAM,aAAcse,MAAO,KAC7B,CAAEte,KAAM,eAAgBse,MAAO,IAEnCytD,UAAU,EACVC,QAAQ,IAIH9gE,QAAQ+gE,IACjBlwE,KAAK4uE,UAAUW,aAAaxmE,IAAImnE,EAAYx5D,GAAIw5D,IAExD,CAKA,aAAAC,CAAczoD,GAIV,IAHA1nB,KAAK4uE,UAAU73C,YAAcrP,EAGtB1nB,KAAK4uE,UAAU73C,YAAc/2B,KAAK4uE,UAAUC,kBAC/C7uE,KAAKowE,UAGTpwE,KAAKgJ,OAAOxD,MAAM,IAAIkiB,gBAAqB1nB,KAAK4uE,UAAU73C,cAC9D,CAKQ,OAAAq5C,GACJpwE,KAAK4uE,UAAU1pE,QACflF,KAAK4uE,UAAU73C,YAAc/2B,KAAK4uE,UAAUC,iBAGxC7uE,KAAK4uE,UAAU1pE,MAAQlF,KAAKouE,qBAAqBxnE,OACjD5G,KAAK4uE,UAAUC,iBAAmB7uE,KAAKouE,qBAAqBpuE,KAAK4uE,UAAU1pE,OAE3ElF,KAAK4uE,UAAUC,iBAAmB7uE,KAAKouE,qBAAqBpuE,KAAKouE,qBAAqBxnE,OAAS,GAInG,MAAMypE,EAAoBrwE,KAAK4uE,UAAU1pE,MAAQ,GAAM,EAAI,EAAI,EACzDorE,EAAwBtwE,KAAK4uE,UAAU1pE,MAAQ,GAAM,EAAI,EAAI,EAEnElF,KAAK4uE,UAAUE,aAAeuB,EAC9BrwE,KAAK4uE,UAAUG,iBAAmBuB,EAElCtwE,KAAK+kB,OAAOwrD,YAAYvwE,KAAK4uE,UAAU1pE,MAAO,CAC1C4pE,YAAauB,EACbtB,gBAAiBuB,IAGrBtwE,KAAKgJ,OAAOpD,KAAK,0BAA0B5F,KAAK4uE,UAAU1pE,QAAS,CAC/D4pE,YAAauB,EACbtB,gBAAiBuB,GAEzB,CAKA,kBAAAE,CAAmBC,EAAiB/oD,GAChC,MAAMooD,EAAQ9vE,KAAK4uE,UAAUS,OAAOnmE,IAAIunE,GACxC,IAAKX,GAASA,EAAM5qE,OAAS4qE,EAAMJ,SAAU,OAE7CI,EAAM/4C,YAAcrP,EAGpB,MAAMgpD,EAAa1wE,KAAKquE,qBAAqByB,EAAM5qE,QAAUlF,KAAKquE,qBAAqBruE,KAAKquE,qBAAqBznE,OAAS,GAEtHkpE,EAAM/4C,YAAc25C,IACpBZ,EAAM5qE,QACN4qE,EAAM/4C,YAAc25C,EAEpB1wE,KAAK+kB,OAAO4rD,iBAAiBb,EAAOA,EAAM5qE,OAE1ClF,KAAKgJ,OAAOpD,KAAK,sBAAsBkqE,EAAM7pE,UAAU6pE,EAAM5qE,SAErE,CAKA,YAAA0rE,CAAaH,GACT,MAAMX,EAAQ9vE,KAAK4uE,UAAUS,OAAOnmE,IAAIunE,GACxC,IAAKX,GAASA,EAAM5qE,OAAS4qE,EAAMJ,SAAU,OAAO,EAGpD,GAAII,EAAMF,aAAc,CACpB,MAAMiB,EAAc7wE,KAAK4uE,UAAUS,OAAOnmE,IAAI4mE,EAAMF,cACpD,IAAKiB,GAAeA,EAAY3rE,OAAS4qE,EAAMD,mBAAqB,GAEhE,OADA7vE,KAAKgJ,OAAOnD,KAAK,yBAAyBiqE,EAAMF,sBAAsBE,EAAMD,sBACrE,CAEf,CAGA,MAAMiB,EAAOlkE,KAAKoC,IAAI,EAAGpC,KAAKC,MAAMijE,EAAM5qE,MAAQ,GAAK,GACvD,OAAIlF,KAAK4uE,UAAUE,YAAcgC,GAC7B9wE,KAAKgJ,OAAOnD,KAAK,iCAAiCirE,WAAc9wE,KAAK4uE,UAAUE,gBACxE,IAIX9uE,KAAK4uE,UAAUE,aAAegC,EAC9BhB,EAAM5qE,QAENlF,KAAK+kB,OAAO4rD,iBAAiBb,EAAOA,EAAM5qE,OAE1ClF,KAAKgJ,OAAOpD,KAAK,4BAA4BkqE,EAAM7pE,UAAU6pE,EAAM5qE,gBAAgB4rE,UAE5E,EACX,CAKA,iBAAAC,CAAkB9sE,EAAqByjB,EAAiB,GACpD,MAAMopD,EAAgB,EAATppD,EACb,GAAI1nB,KAAK4uE,UAAUG,gBAAkB+B,EAEjC,OADA9wE,KAAKgJ,OAAOnD,KAAK,qCAAqCirE,WAAc9wE,KAAK4uE,UAAUG,oBAC5E,EAGX,MAAMiC,EAAYhxE,KAAK4uE,UAAUU,WAAWpmE,IAAIjF,GAChD,IAAK+sE,EAAW,OAAO,EAEvB,MAAMC,EAAWD,EAAUzuD,MAU3B,OATAyuD,EAAUvB,WAAa/nD,EACvB1nB,KAAKkxE,qBAAqBjtE,GAE1BjE,KAAK4uE,UAAUG,iBAAmB+B,EAElC9wE,KAAK+kB,OAAOosD,qBAAqBltE,EAAMgtE,EAAUD,EAAUzuD,OAE3DviB,KAAKgJ,OAAOpD,KAAK,0BAA0B3B,OAAU+sE,EAAUzuD,gBAAgBuuD,UAExE,CACX,CAKA,oBAAAM,CAAqBntE,EAAqBotE,GACtC,MAAML,EAAYhxE,KAAK4uE,UAAUU,WAAWpmE,IAAIjF,GAC3C+sE,IAELA,EAAUvZ,UAAU9wD,KAAK0qE,GACzBrxE,KAAKkxE,qBAAqBjtE,GAE1BjE,KAAKgJ,OAAOxD,MAAM,uBAAuBvB,MAASotE,EAAS9uD,cAAc8uD,EAASpvD,UACtF,CAKA,uBAAAqvD,CAAwBrtE,EAAqBge,GACzC,MAAM+uD,EAAYhxE,KAAK4uE,UAAUU,WAAWpmE,IAAIjF,GAC3C+sE,IAELA,EAAUvZ,UAAYuZ,EAAUvZ,UAAUzvD,OAAOupE,GAAOA,EAAItvD,SAAWA,GACvEjiB,KAAKkxE,qBAAqBjtE,GAE1BjE,KAAKgJ,OAAOxD,MAAM,yBAAyBvB,MAASge,KACxD,CAKQ,oBAAAivD,CAAqBjtE,GACzB,MAAM+sE,EAAYhxE,KAAK4uE,UAAUU,WAAWpmE,IAAIjF,GAChD,IAAK+sE,EAAW,OAEhB,MAAMC,EAAWD,EAAUzuD,MAC3ByuD,EAAUzuD,MAAQyuD,EAAUvB,UAG5BuB,EAAUvZ,UAAUtoD,QAAQoiE,IACxBP,EAAUzuD,OAASgvD,EAAIhvD,QAI3ByuD,EAAUzuD,MAAQ3V,KAAKoC,IAAI,EAAGgiE,EAAUzuD,OAEpC0uD,IAAaD,EAAUzuD,OACvBviB,KAAK+kB,OAAOosD,qBAAqBltE,EAAMgtE,EAAUD,EAAUzuD,MAEnE,CAKA,yBAAAivD,CAA0BvtE,EAAcyjB,EAAgBhiB,GACpD,IAAA,MAAWwqE,KAAelwE,KAAK4uE,UAAUW,aAAa52D,SAClD,IAAIu3D,EAAYF,SAEhB,IAAA,MAAWyB,KAAOvB,EAAY1vB,aACtBixB,EAAIxtE,OAASA,IACbwtE,EAAI1B,QAAUnjE,KAAKuD,IAAIshE,EAAIlS,OAAQkS,EAAI1B,QAAUroD,GAG7C1nB,KAAK0xE,uBAAuBxB,IAC5BlwE,KAAK2xE,kBAAkBzB,EAAYx5D,IAKvD,CAKQ,sBAAAg7D,CAAuBxB,GAC3B,OAAOA,EAAY1vB,aAAaoxB,SAAaH,EAAI1B,SAAW0B,EAAIlS,OACpE,CAKQ,iBAAAoS,CAAkBE,GACtB,MAAM3B,EAAclwE,KAAK4uE,UAAUW,aAAarmE,IAAI2oE,GAC/C3B,IAAeA,EAAYF,WAEhCE,EAAYF,UAAW,EACvBE,EAAY4B,aAAezrE,KAAKC,MAGhC4pE,EAAYrF,QAAQ17D,QAAQ4iE,IACxB,OAAQA,EAAO9tE,MACX,IAAK,aACDjE,KAAKmwE,cAAc4B,EAAOxvD,OAC1B,MACJ,IAAK,eACDviB,KAAK4uE,UAAUE,aAAeiD,EAAOxvD,MACrC,MACJ,IAAK,mBACDviB,KAAK4uE,UAAUG,iBAAmBgD,EAAOxvD,MACzC,MACJ,IAAK,UACDviB,KAAK4uE,UAAUO,eAAiB4C,EAAOxvD,SAKnDviB,KAAK+kB,OAAOitD,wBAAwB9B,GAEpClwE,KAAKgJ,OAAOpD,KAAK,4BAA4BsqE,EAAYjqE,OAAQ,CAC7D4kE,QAASqF,EAAYrF,UAE7B,CAKA,gBAAAoH,CAAiB/6C,GAQTA,EAAMg7C,WAAUlyE,KAAK4uE,UAAUI,eAAiB93C,EAAMg7C,UACtDh7C,EAAM+3C,kBACNjvE,KAAK4uE,UAAUK,iBAAmB/3C,EAAM+3C,gBACxCjvE,KAAKwxE,0BAA0B,eAAgBt6C,EAAM+3C,kBAErD/3C,EAAMg4C,kBACNlvE,KAAK4uE,UAAUM,iBAAmBh4C,EAAMg4C,gBACxClvE,KAAKwxE,0BAA0B,mBAAoBt6C,EAAMg4C,kBAEzDh4C,EAAM4gB,mBACN93C,KAAK4uE,UAAU92B,kBAAoB5gB,EAAM4gB,iBACzC93C,KAAKwxE,0BAA0B,kBAAmBt6C,EAAM4gB,mBAExD5gB,EAAMi4C,gBACNnvE,KAAK4uE,UAAUO,eAAiBj4C,EAAMi4C,cACtCnvE,KAAKwxE,0BAA0B,eAAgBt6C,EAAMi4C,gBAErDj4C,EAAMk4C,eACNpvE,KAAK4uE,UAAUQ,cAAgBl4C,EAAMk4C,aACrCpvE,KAAKwxE,0BAA0B,cAAet6C,EAAMk4C,cAE5D,CAKA,aAAA+C,CAAc1B,EAAiB2B,GAC3B,MAAMtC,EAAQ9vE,KAAK4uE,UAAUS,OAAOnmE,IAAIunE,GACxC,IAAKX,EAAO,OAAO,EAEnB,MAAMuC,EAAQvC,EAAMH,QAAQx9C,KAAK3mB,GAAKA,EAAEvH,OAASmuE,GACjD,OAAKC,EAEEA,EAAM9vD,MAAQutD,EAAM5qE,MAFR,CAGvB,CAKA,gBAAAotE,CAAiBplB,EAAyBklB,GACtC,IAAI7wC,EAAQ,EAEZ,IAAA,MAAWuuC,KAAS9vE,KAAK4uE,UAAUS,OAAO12D,SAClCm3D,EAAM5iB,WAAaA,IACnB3rB,GAASvhC,KAAKmyE,cAAcrC,EAAMp5D,GAAI07D,IAI9C,OAAO7wC,CACX,CAKA,iBAAAgxC,CAAkBtuE,GACd,MAAM+sE,EAAYhxE,KAAK4uE,UAAUU,WAAWpmE,IAAIjF,GAChD,OAAO+sE,EAAYA,EAAUzuD,MAAQ,EACzC,CAKA,iBAAAiwD,GACI,MAAO,IAAKxyE,KAAK4uE,UACrB,CAKA,kBAAA6D,GACI,OAAOp8D,MAAMC,KAAKtW,KAAK4uE,UAAUS,OAAO12D,UAAU3Q,OAAO8nE,IACrD,GAAIA,EAAM5qE,OAAS4qE,EAAMJ,SAAU,OAAO,EAG1C,GAAII,EAAMF,aAAc,CACpB,MAAMiB,EAAc7wE,KAAK4uE,UAAUS,OAAOnmE,IAAI4mE,EAAMF,cACpD,IAAKiB,GAAeA,EAAY3rE,OAAS4qE,EAAMD,mBAAqB,GAChE,OAAO,CAEf,CAEA,OAAO,GAEf,CAKA,uBAAA6C,GACI,OAAOr8D,MAAMC,KAAKtW,KAAK4uE,UAAUW,aAAa52D,UAAU3Q,OAAOwE,GAAKA,EAAEwjE,SAC1E,CAKA,sBAAA2C,GACI,OAAOt8D,MAAMC,KAAKtW,KAAK4uE,UAAUW,aAAa52D,UAAU3Q,WAAawE,EAAEwjE,WAAaxjE,EAAEyjE,OAC1F,CAKA,aAAA2C,GACI,MAAO,CACHhE,UAAW,IACJ5uE,KAAK4uE,UACRS,OAAQh5D,MAAMC,KAAKtW,KAAK4uE,UAAUS,OAAO3oE,WACzC4oE,WAAYj5D,MAAMC,KAAKtW,KAAK4uE,UAAUU,WAAW5oE,WACjD6oE,aAAcl5D,MAAMC,KAAKtW,KAAK4uE,UAAUW,aAAa7oE,YAGjE,CAKA,aAAAmsE,CAAcntE,GACNA,EAAKkpE,YACL5uE,KAAK4uE,UAAY,IACVlpE,EAAKkpE,UACRS,OAAQ,IAAIvmE,IAAIpD,EAAKkpE,UAAUS,QAC/BC,WAAY,IAAIxmE,IAAIpD,EAAKkpE,UAAUU,YACnCC,aAAc,IAAIzmE,IAAIpD,EAAKkpE,UAAUW,eAGzCvvE,KAAKgJ,OAAOpD,KAAK,2BAA4B,CACzCV,MAAOlF,KAAK4uE,UAAU1pE,MACtB6xB,WAAY/2B,KAAK4uE,UAAU73C,aAGvC,CAKA,mBAAA+7C,GAQI,MAAMC,EAAmB18D,MAAMC,KAAKtW,KAAK4uE,UAAUS,OAAO12D,UACrD6oB,OAAO,CAACC,EAAKquC,IAAUruC,EAAMquC,EAAM5qE,MAAO,GAEzC8tE,EAAoBpmE,KAAKoC,OAAOqH,MAAMC,KAAKtW,KAAK4uE,UAAUS,OAAO12D,UAClE1J,IAAI6gE,GAASA,EAAM5qE,QAElB+tE,EAAuB58D,MAAMC,KAAKtW,KAAK4uE,UAAUU,WAAW32D,UAC7D6oB,OAAO,CAACC,EAAKyxC,IAASzxC,EAAMyxC,EAAKzD,UAAW,GAE3C0D,EAAuB98D,MAAMC,KAAKtW,KAAK4uE,UAAUW,aAAa52D,UAC/D3Q,OAAOwE,GAAKA,EAAEwjE,UAAUppE,OAEvBwsE,EAAoBpzE,KAAK4uE,UAAUW,aAAalkE,KAEhDgoE,EAAiBh9D,MAAMC,KAAKtW,KAAK4uE,UAAUS,OAAO12D,UACnD6oB,OAAO,CAACC,EAAKquC,IAAUruC,EAAMquC,EAAMJ,SAAU,GAQlD,MAAO,CACHqD,mBACAC,oBACAC,uBACAE,uBACAC,oBACAE,sBAZ0B1mE,KAAKuD,IAAI,IAClCnQ,KAAK4uE,UAAU1pE,MAAQ,GAAM,GAC7B6tE,EAAmBM,EAAkB,GACrCF,EAAuBC,EAAqB,IAWrD,ECt6BG,IAAKG,GAAAA,IACRA,EAAA,QAAU,UACVA,EAAA,YAAc,cACdA,EAAA,QAAU,UACVA,EAAA,UAAY,YACZA,EAAA,SAAW,WACXA,EAAA,YAAc,cANNA,IAAAA,GAAA,CAAA,GAmHL,MAAMC,EAcT,WAAA1uE,CAAYigB,EAAyB,IAbrC/kB,KAAQi3B,iBAA4CnuB,IACpD9I,KAAQyzE,aAA6C3qE,IACrD9I,KAAQ0zE,eAAgD5qE,IACxD9I,KAAQ2zE,eAAyC7qE,IACjD9I,KAAQg3B,YAA2B,GAGnCh3B,KAAQ4zE,oBAA8B,EACtC5zE,KAAQ6zE,wBAAsD/qE,IAM1D9I,KAAKgJ,OAAS,IAAIO,EAAO,kBACzBvJ,KAAK+kB,OAASA,EAEd/kB,KAAK8zE,gCACL9zE,KAAK+zE,yBACL/zE,KAAKg0E,uBACLh0E,KAAKi0E,uBAELj0E,KAAKgJ,OAAOpD,KAAK,iCACrB,CAKQ,6BAAAkuE,GACJ7+C,OAAOtc,OAAO46D,GAAepkE,QAAQ+kE,IACjCl0E,KAAK6zE,oBAAoB9qE,IAAImrE,EAAO,IAE5C,CAKQ,sBAAAH,GAC+B,CAE/B,CACIr9D,GAAI,gBACJzQ,KAAM,mBACNgnD,YAAa,oDACbinB,MAAO,cACPC,KAAM,EACNC,aAAc,IACdC,aAAc,IACdC,cAAe,GACf7b,cAAe,CACX,CAAEzI,OAAQ,eAAgB7M,SAAU,GACpC,CAAE6M,OAAQ,iBAAkB7M,SAAU,IAE1CoxB,mBAAoB,CAAC,aACrBC,QAAS,CACL,CAAEvwE,KAAM,iBAAkBs7D,OAAQ,mBAAoBtS,YAAa,iCACnE,CAAEhpD,KAAM,UAAWs7D,OAAQ,kBAAmBtS,YAAa,gCAE/DwnB,YAAY,EACZC,eAAe,EACfC,iBAAkB,EAClBC,kBAAmB,GAEvB,CACIl+D,GAAI,gBACJzQ,KAAM,uBACNgnD,YAAa,sDACbinB,MAAO,cACPC,KAAM,EACNC,aAAc,IACdC,aAAc,IACdC,cAAe,GACf7b,cAAe,CACX,CAAEzI,OAAQ,aAAc7M,SAAU,IAClC,CAAE6M,OAAQ,iBAAkB7M,SAAU,IAE1CoxB,mBAAoB,CAAC,YACrBC,QAAS,CACL,CAAEvwE,KAAM,UAAWs7D,OAAQ,gBAAiBh9C,MAAO,GAAI0qC,YAAa,sBACpE,CAAEhpD,KAAM,iBAAkBs7D,OAAQ,kBAAmBtS,YAAa,oCAEtEwnB,YAAY,EACZC,eAAe,EACfC,iBAAkB,EAClBC,kBAAmB,GAEvB,CACIl+D,GAAI,iBACJzQ,KAAM,2BACNgnD,YAAa,wCACbinB,MAAO,WACPC,KAAM,EACNC,aAAc,IACdC,aAAc,IACdC,cAAe,GACf7b,cAAe,CACX,CAAEzI,OAAQ,oBAAqB7M,SAAU,GACzC,CAAE6M,OAAQ,eAAgB7M,SAAU,IAExCoxB,mBAAoB,CAAC,YAAa,YAClCC,QAAS,CACL,CAAEvwE,KAAM,SAAUs7D,OAAQ,gBAAiBtS,YAAa,yBACxD,CAAEhpD,KAAM,UAAWs7D,OAAQ,oBAAqBh9C,MAAO,GAAI0qC,YAAa,kCAE5EwnB,YAAY,EACZC,eAAe,EACfC,iBAAkB,EAClBC,kBAAmB,GAIvB,CACIl+D,GAAI,oBACJzQ,KAAM,oBACNgnD,YAAa,uDACbinB,MAAO,YACPC,KAAM,EACNC,aAAc,IACdC,aAAc,KACdC,cAAe,CAAC,iBAChB7b,cAAe,CACX,CAAEzI,OAAQ,oBAAqB7M,SAAU,GACzC,CAAE6M,OAAQ,yBAA0B7M,SAAU,IAElDoxB,mBAAoB,CAAC,iBACrBC,QAAS,CACL,CAAEvwE,KAAM,WAAYs7D,OAAQ,cAAetS,YAAa,gCACxD,CAAEhpD,KAAM,UAAWs7D,OAAQ,iBAAkBh9C,MAAO,GAAI0qC,YAAa,wBAEzEwnB,YAAY,EACZC,eAAe,EACfC,iBAAkB,EAClBC,kBAAmB,GAEvB,CACIl+D,GAAI,oBACJzQ,KAAM,qBACNgnD,YAAa,qDACbinB,MAAO,UACPC,KAAM,EACNC,aAAc,IACdC,aAAc,IACdC,cAAe,CAAC,gBAAiB,kBACjC7b,cAAe,CACX,CAAEzI,OAAQ,sBAAuB7M,SAAU,GAC3C,CAAE6M,OAAQ,oBAAqB7M,SAAU,IAE7CoxB,mBAAoB,CAAC,mBACrBC,QAAS,CACL,CAAEvwE,KAAM,iBAAkBs7D,OAAQ,mBAAoBtS,YAAa,kCACnE,CAAEhpD,KAAM,UAAWs7D,OAAQ,kBAAmBh9C,MAAO,GAAI0qC,YAAa,yBAE1EwnB,YAAY,EACZC,eAAe,EACfC,iBAAkB,EAClBC,kBAAmB,GAEvB,CACIl+D,GAAI,oBACJzQ,KAAM,0BACNgnD,YAAa,+CACbinB,MAAO,UACPC,KAAM,EACNC,aAAc,IACdC,aAAc,KACdC,cAAe,CAAC,qBAChB7b,cAAe,CACX,CAAEzI,OAAQ,oBAAqB7M,SAAU,GACzC,CAAE6M,OAAQ,iBAAkB7M,SAAU,IAE1CoxB,mBAAoB,CAAC,eACrBC,QAAS,CACL,CAAEvwE,KAAM,UAAWs7D,OAAQ,kBAAmBh9C,MAAO,GAAI0qC,YAAa,wBACtE,CAAEhpD,KAAM,UAAWs7D,OAAQ,iBAAkBtS,YAAa,kCAE9DwnB,YAAY,EACZC,eAAe,EACfC,iBAAkB,EAClBC,kBAAmB,GAIvB,CACIl+D,GAAI,0BACJzQ,KAAM,0BACNgnD,YAAa,0CACbinB,MAAO,YACPC,KAAM,EACNC,aAAc,IACdC,aAAc,KACdC,cAAe,CAAC,oBAAqB,qBACrC7b,cAAe,CACX,CAAEzI,OAAQ,eAAgB7M,SAAU,GACpC,CAAE6M,OAAQ,oBAAqB7M,SAAU,KAE7CoxB,mBAAoB,CAAC,eACrBC,QAAS,CACL,CAAEvwE,KAAM,iBAAkBs7D,OAAQ,eAAgBtS,YAAa,6BAC/D,CAAEhpD,KAAM,UAAWs7D,OAAQ,wBAAyBh9C,MAAO,GAAI0qC,YAAa,2BAEhFwnB,YAAY,EACZC,eAAe,EACfC,iBAAkB,EAClBC,kBAAmB,GAEvB,CACIl+D,GAAI,gBACJzQ,KAAM,yBACNgnD,YAAa,gDACbinB,MAAO,UACPC,KAAM,EACNC,aAAc,KACdC,aAAc,IACdC,cAAe,CAAC,qBAChB7b,cAAe,CACX,CAAEzI,OAAQ,qBAAsB7M,SAAU,GAC1C,CAAE6M,OAAQ,yBAA0B7M,SAAU,IAElDoxB,mBAAoB,CAAC,kBAAmB,eACxCC,QAAS,CACL,CAAEvwE,KAAM,SAAUs7D,OAAQ,iBAAkBtS,YAAa,iCACzD,CAAEhpD,KAAM,UAAWs7D,OAAQ,cAAetS,YAAa,qCAE3DwnB,YAAY,EACZC,eAAe,EACfC,iBAAkB,EAClBC,kBAAmB,GAIvB,CACIl+D,GAAI,yBACJzQ,KAAM,yBACNgnD,YAAa,uDACbinB,MAAO,UACPC,KAAM,EACNC,aAAc,IACdC,aAAc,KACdC,cAAe,CAAC,0BAA2B,iBAC3C7b,cAAe,CACX,CAAEzI,OAAQ,oBAAqB7M,SAAU,GACzC,CAAE6M,OAAQ,eAAgB7M,SAAU,IAExCoxB,mBAAoB,CAAC,cAAe,WACpCC,QAAS,CACL,CAAEvwE,KAAM,UAAWs7D,OAAQ,uBAAwBtS,YAAa,gCAChE,CAAEhpD,KAAM,iBAAkBs7D,OAAQ,mBAAoBtS,YAAa,+BAEvEwnB,YAAY,EACZC,eAAe,EACfC,iBAAkB,EAClBC,kBAAmB,GAIvB,CACIl+D,GAAI,uBACJzQ,KAAM,uBACNgnD,YAAa,iDACbinB,MAAO,UACPC,KAAM,EACNC,aAAc,IACdC,aAAc,IACdC,cAAe,CAAC,0BAChB7b,cAAe,CACX,CAAEzI,OAAQ,4BAA6B7M,SAAU,GACjD,CAAE6M,OAAQ,0BAA2B7M,SAAU,IAEnDoxB,mBAAoB,CAAC,cAAe,kBAAmB,eACvDC,QAAS,CACL,CAAEvwE,KAAM,UAAWs7D,OAAQ,gBAAiBtS,YAAa,8BACzD,CAAEhpD,KAAM,UAAWs7D,OAAQ,gBAAiBtS,YAAa,kCAE7DwnB,YAAY,EACZC,eAAe,EACfC,iBAAkB,EAClBC,kBAAmB,IAIdzlE,QAAQ0lE,IACjB70E,KAAKi3B,aAAaluB,IAAI8rE,EAAKn+D,GAAIm+D,IAEvC,CAKQ,oBAAAb,GACmC,CACnC,CACIt9D,GAAI,YACJzQ,KAAM,mBACNhC,KAAM,aACN+pD,WAAY,EACZ8mB,eAAgB,CAAC,cAA2B,aAC5CC,YAAa,EACbC,eAAe,EACfC,gBAAiB,GACjBC,iBAAkB,EAClBC,aAAc,GAElB,CACIz+D,GAAI,WACJzQ,KAAM,uBACNhC,KAAM,WACN+pD,WAAY,IACZ8mB,eAAgB,CAAC,cAA2B,YAC5CC,YAAa,EACbC,eAAe,EACfC,gBAAiB,GACjBC,iBAAkB,EAClBC,aAAc,GAElB,CACIz+D,GAAI,gBACJzQ,KAAM,gBACNhC,KAAM,gBACN+pD,WAAY,IACZ8mB,eAAgB,CAAC,aACjBC,YAAa,EACbC,eAAe,EACfC,gBAAiB,GACjBC,iBAAkB,EAClBC,aAAc,IAIXhmE,QAAQimE,IACfp1E,KAAK0zE,WAAW3qE,IAAIqsE,EAAS1+D,GAAI0+D,IAEzC,CAKQ,oBAAAnB,GAC4B,CAC5B,CACIv9D,GAAI,WACJzQ,KAAM,kBACNovE,UAAW,cACXvF,MAAO,EACP9hB,WAAY,IACZsnB,aAAa,EACbC,QAAS,EACTC,OAAQ,IAEZ,CACI9+D,GAAI,YACJzQ,KAAM,iBACNovE,UAAW,UACXvF,MAAO,EACP9hB,WAAY,IACZsnB,aAAa,EACbC,QAAS,EACTC,OAAQ,IAEZ,CACI9+D,GAAI,YACJzQ,KAAM,oBACNovE,UAAW,YACXvF,MAAO,EACP9hB,WAAY,IACZsnB,aAAa,EACbC,QAAS,EACTC,OAAQ,KAILrmE,QAAQsmE,IACfz1E,KAAK2zE,WAAW5qE,IAAI0sE,EAAU/+D,GAAI++D,IAE1C,CAKA,aAAAC,CAAcC,EAAsBC,EAAoBC,EAAyB,IAC7E,MAAMC,EAAa91E,KAAKi3B,aAAa/tB,IAAIysE,GACnCP,EAAWp1E,KAAK0zE,WAAWxqE,IAAI0sE,GAErC,IAAKE,IAAeV,EAEhB,OADAp1E,KAAKgJ,OAAOnD,KAAK,8CAA+C,CAAE8vE,eAAcC,gBACzE,EAIX,GAAIE,EAAWrB,YAAcqB,EAAWpB,cAEpC,OADA10E,KAAKgJ,OAAOnD,KAAK,kDAAmD,CAAE8vE,kBAC/D,EAIX,IAAA,MAAWI,KAAUD,EAAWxB,cAAe,CAC3C,MAAM0B,EAAah2E,KAAKi3B,aAAa/tB,IAAI6sE,GACzC,IAAKC,IAAeA,EAAWvB,WAE3B,OADAz0E,KAAKgJ,OAAOnD,KAAK,wBAAyB,CAAE8vE,eAAcM,cAAeF,KAClE,CAEf,CAGA,GAAIX,EAASH,gBAAgBruE,QAAUwuE,EAASL,YAE5C,OADA/0E,KAAKgJ,OAAOnD,KAAK,uBAAwB,CAAE+vE,gBACpC,EAIX,GAAIR,EAASN,eAAeluE,OAAS,IAAMwuE,EAASN,eAAej9D,SAASi+D,EAAW5B,OAMnF,OALAl0E,KAAKgJ,OAAOnD,KAAK,mDAAoD,CACjE+vE,aACA1B,MAAO4B,EAAW5B,MAClBgC,gBAAiBd,EAASN,kBAEvB,EAIX,MAAMqB,EAA4B,GAClC,IAAA,MAAWC,KAAeP,EAAc,CACpC,MAAMJ,EAAYz1E,KAAK2zE,WAAWzqE,IAAIktE,GAClCX,GAAaA,EAAUH,cACvBa,EAAgBxvE,KAAKyvE,GACrBX,EAAUH,aAAc,EACxBG,EAAUY,gBAAkBV,EAC5BF,EAAUa,iBAAmBV,EAErC,CAGA,IAAI5nB,EAAaonB,EAASpnB,WAAaonB,EAASF,iBAGhDiB,EAAgBhnE,QAAQinE,IACpB,MAAMX,EAAYz1E,KAAK2zE,WAAWzqE,IAAIktE,GACtC,GAAIX,EAAW,CACX,IAAIc,EAAiBd,EAAUznB,WAAaynB,EAAUD,QAAU,EAAIC,EAAUF,SAG1EE,EAAUJ,YAAcS,EAAW5B,QACnCqC,GAAkB,KAGtBvoB,GAAcuoB,CAClB,IAIJ,MAAMC,EAAkBx2E,KAAK6zE,oBAAoB3qE,IAAI4sE,EAAW5B,QAAU,EAC1ElmB,GAAcwoB,EAGd,MACMC,EADWX,EAAWzB,aACKrmB,EAG3B0oB,EAAY,WAAWf,KAAgBtvE,KAAKC,QAC5CqwE,EAA2B,CAC7BjgE,GAAIggE,EACJf,eACAC,aACAgB,mBAAoBT,EACpBltE,UAAW5C,KAAKC,MAChBuwE,oBAAqBxwE,KAAKC,MAAwB,IAAhBmwE,EAClCzoB,aACA5xB,OAAQ,UAeZ,OAZAp8B,KAAKyzE,SAAS1qE,IAAI2tE,EAAWC,GAC7BvB,EAASH,gBAAgBtuE,KAAK+vE,GAC9BZ,EAAWpB,eAAgB,EAC3BoB,EAAWlB,kBAAoBvuE,KAAKC,MAEpCtG,KAAKgJ,OAAOpD,KAAK,wBAAwBkwE,EAAW7vE,OAAQ,CACxDmvE,SAAUA,EAASnvE,KACnB0tE,WAAYwC,EAAgBvvE,OAC5BonD,WAAYA,EAAW3kD,QAAQ,GAC/BytE,gBAAiBL,EAAgB,MAAMptE,QAAQ,MAG5C,CACX,CAKA,MAAAmL,CAAOC,GACH,MAAM2O,EAAc/c,KAAKC,MAEzB,IAAA,MAAWqwE,KAAW32E,KAAKyzE,SAAS96D,SAAU,CAC1C,GAAuB,WAAnBg+D,EAAQv6C,OAAqB,SAEjC,MAAM05C,EAAa91E,KAAKi3B,aAAa/tB,IAAIytE,EAAQhB,cACjD,IAAKG,EAAY,SAGjB,MAAM/a,EAAU33C,EAAcuzD,EAAQ1tE,UAChC8tE,EAAgBJ,EAAQE,oBAAsBF,EAAQ1tE,UACtDuY,EAAW5U,KAAKuD,IAAI,EAAK4qD,EAAUgc,GAEzCjB,EAAWnB,iBAAmBnzD,EAG1BA,GAAY,EACZxhB,KAAKg3E,iBAAiBL,EAAQjgE,IAG9BigE,EAAQC,mBAAmBznE,QAAQinE,IAC/B,MAAMX,EAAYz1E,KAAK2zE,WAAWzqE,IAAIktE,GAClCX,IACAA,EAAUF,QAAU3oE,KAAKuD,IAAI,EAAKslE,EAAUF,QAAsB,KAAZ9gE,KAItE,CAGI7H,KAAK2U,SAAW,MAChBvhB,KAAKi3E,qBAEb,CAKQ,gBAAAD,CAAiBN,GACrB,MAAMC,EAAU32E,KAAKyzE,SAASvqE,IAAIwtE,GAClC,IAAKC,EAAS,OAEd,MAAMb,EAAa91E,KAAKi3B,aAAa/tB,IAAIytE,EAAQhB,cAC3CP,EAAWp1E,KAAK0zE,WAAWxqE,IAAIytE,EAAQf,YAE7C,IAAKE,IAAeV,EAAU,OAG9BU,EAAWrB,YAAa,EACxBqB,EAAWpB,eAAgB,EAC3BoB,EAAWnB,iBAAmB,EAC9BmB,EAAWoB,cAAgB7wE,KAAKC,MAGhCqwE,EAAQC,mBAAmBznE,QAAQinE,IAC/B,MAAMX,EAAYz1E,KAAK2zE,WAAWzqE,IAAIktE,GAClCX,IACAA,EAAUH,aAAc,EACxBG,EAAUY,qBAAkB,EAC5BZ,EAAUa,sBAAmB,EAC7Bb,EAAUD,OAAS5oE,KAAKuD,IAAI,EAAKslE,EAAUD,OAAS,OAK5DJ,EAASH,gBAAkBG,EAASH,gBAAgBjtE,OAAO0O,GAAMA,IAAOggE,GAGxEC,EAAQv6C,OAAS,YAGjBp8B,KAAK4zE,qBAAuBkC,EAAW1B,aAGvCp0E,KAAKm3E,uBAAuBrB,GAE5B91E,KAAK+kB,OAAOqyD,uBAAuBtB,GACnC91E,KAAK+kB,OAAOsyD,sBAAsBV,GAElC32E,KAAKgJ,OAAOpD,KAAK,0BAA0BkwE,EAAW7vE,OAAQ,CAC1DkD,WAAY9C,KAAKC,MAAQqwE,EAAQ1tE,WAAa,IAAO,IAAII,QAAQ,GAAK,WACtEmrE,QAASsB,EAAWtB,QAAQ5tE,SAKd,IADA5G,KAAKs3E,mBAAmBxB,EAAW5B,MAAO4B,EAAW3B,OAEnEn0E,KAAK+kB,OAAOwyD,yBAAyBzB,EAAW5B,MAAO4B,EAAW3B,KAE1E,CAKQ,sBAAAgD,CAAuBrB,GAC3BA,EAAWtB,QAAQrlE,QAAQqoE,IACvB,OAAQA,EAAOvzE,MACX,IAAK,WACDjE,KAAKy3E,eAAeD,EAAOjY,QAC3B,MACJ,IAAK,UACDv/D,KAAK03E,aAAaF,EAAOjY,OAAQiY,EAAOj1D,OAAS,GACjD,MACJ,IAAK,UACDviB,KAAK23E,cAAcH,EAAOjY,QAC1B,MACJ,IAAK,SACDv/D,KAAK43E,aAAaJ,EAAOjY,UAIzC,CAKQ,cAAAkY,CAAeI,GACnB,MA+BM5yE,EA/BgE,CAClE6yE,YAAa,CACT7xE,KAAM,uBACNhC,KAAM,aACN+pD,WAAY,EACZ8mB,eAAgB,CAAC,UAAuB,aACxCC,YAAa,GAEjBgD,QAAS,CACL9xE,KAAM,0BACNhC,KAAM,aACN+pD,WAAY,IACZ8mB,eAAgB,CAAC,WACjBC,YAAa,GAEjBiD,gBAAiB,CACb/xE,KAAM,kBACNhC,KAAM,kBACN+pD,WAAY,IACZ8mB,eAAgB,CAAC,WAAwB,eACzCC,YAAa,GAEjBkD,YAAa,CACThyE,KAAM,yBACNhC,KAAM,cACN+pD,WAAY,IACZ8mB,eAAgB,CAAC,cAA2B,WAC5CC,YAAa,IAIU8C,GAC/B,GAAI5yE,EAAQ,CACR,MAAM2wE,EAAa,GAAGiC,KAAgBxxE,KAAKC,QACrC8uE,EAA6B,CAC/B1+D,GAAIk/D,EACJ3vE,KAAMhB,EAAOgB,MAAQ4xE,EACrB5zE,KAAMgB,EAAOhB,MAAQ,aACrB+pD,WAAY/oD,EAAO+oD,YAAc,EACjC8mB,eAAgB7vE,EAAO6vE,gBAAkB,GACzCC,YAAa9vE,EAAO8vE,aAAe,EACnCC,eAAe,EACfC,gBAAiB,GACjBC,iBAAkB,EAClBC,aAAc,GAGlBn1E,KAAK0zE,WAAW3qE,IAAI6sE,EAAYR,GAChCp1E,KAAKgJ,OAAOpD,KAAK,8BAA8BwvE,EAASnvE,OAC5D,CACJ,CAKQ,YAAAyxE,CAAaQ,EAAqB31D,GACtC,OAAQ21D,GACJ,IAAK,iBACDjjD,OAAOtc,OAAO46D,GAAepkE,QAAQ+kE,IACjC,MAAMnE,EAAU/vE,KAAK6zE,oBAAoB3qE,IAAIgrE,IAAU,EACvDl0E,KAAK6zE,oBAAoB9qE,IAAImrE,EAAOnE,GAAW,EAAIxtD,EAAQ,QAE/D,MACJ,IAAK,gBACL,IAAK,kBACL,IAAK,kBAEDviB,KAAKgJ,OAAOpD,KAAK,sBAAsBsyE,MAAgB31D,MAGnE,CAKQ,aAAAo1D,CAAcQ,GAClBn4E,KAAKgJ,OAAOpD,KAAK,4BAA4BuyE,IACjD,CAKQ,YAAAP,CAAare,GACjBv5D,KAAKgJ,OAAOpD,KAAK,2BAA2B2zD,IAChD,CAKQ,mBAAA0d,GACJ,MAAMjgD,EAAc,CAChB,CACI/wB,KAAM,8BACNiuE,MAAO,UACP/mB,OAAQ,OACRirB,cAAe,CAAElE,MAAO,UAAuB7B,MAAO,KAE1D,CACIpsE,KAAM,yBACNiuE,MAAO,UACP/mB,OAAQ,WACRkrB,gBAAiB,CAAC,CAAEroB,OAAQ,qBAAsB7M,SAAU,KAEhE,CACIl9C,KAAM,wBACNiuE,MAAO,YACP/mB,OAAQ,OACRmrB,kBAAmB,2BAEvB,CACIryE,KAAM,gCACNiuE,MAAO,UACP/mB,OAAQ,SACRirB,cAAe,CAAElE,MAAO,UAAuB7B,MAAO,OAIxDkG,EAAYvhD,EAAYpqB,KAAKC,MAAMD,KAAK2U,SAAWyV,EAAYpwB,SAC/D4xE,EAA0B,CAC5B9hE,GAAI,aAAarQ,KAAKC,QACtBL,KAAMsyE,EAAUtyE,KAChBgnD,YAAa,KAAKsrB,EAAUprB,uBAAuBorB,EAAUrE,QAC7DA,MAAOqE,EAAUrE,MACjB/mB,OAAQorB,EAAUprB,OAClBsrB,cAAepyE,KAAKC,MACpB8xE,cAAeG,EAAUH,cACzBE,kBAAmBC,EAAUD,kBAC7BD,gBAAiBE,EAAUF,iBAM/B,GAHAr4E,KAAKg3B,YAAYrwB,KAAK6xE,GAGlBA,EAAaJ,cAAe,CAC5B,MAAMrI,EAAU/vE,KAAK6zE,oBAAoB3qE,IAAIsvE,EAAaJ,cAAclE,QAAU,EAClFl0E,KAAK6zE,oBAAoB9qE,IAAIyvE,EAAaJ,cAAclE,MAAOnE,EAAUyI,EAAaJ,cAAc/F,MACxG,CAEAryE,KAAK+kB,OAAO2zD,kBAAkBF,GAE9Bx4E,KAAKgJ,OAAOpD,KAAK,sBAAsB4yE,EAAavyE,OAAQ,CACxDiuE,MAAOsE,EAAatE,MACpB/mB,OAAQqrB,EAAarrB,QAE7B,CAKA,wBAAAwrB,GACI,OAAOtiE,MAAMC,KAAKtW,KAAKi3B,aAAate,UAAU3Q,OAAO6sE,IAC7CA,EAAKJ,aAAcI,EAAKH,eAGrBG,EAAKP,cAAc1C,MAAMgH,IAC5B,MAAM7C,EAAS/1E,KAAKi3B,aAAa/tB,IAAI0vE,GACrC,OAAO7C,GAAUA,EAAOtB,aAGpC,CAKA,iBAAAoE,GACI,OAAOxiE,MAAMC,KAAKtW,KAAKyzE,SAAS96D,UAAU3Q,OAAO09B,GAAkB,WAAbA,EAAEtJ,OAC5D,CAKA,uBAAA08C,GACI,OAAOziE,MAAMC,KAAKtW,KAAKi3B,aAAate,UAAU3Q,OAAO6sE,GAAQA,EAAKJ,WACtE,CAKA,aAAAsE,CAAcpD,GACV,OAAO31E,KAAKi3B,aAAa/tB,IAAIysE,IAAiB,IAClD,CAKA,aAAAqD,GACI,OAAO3iE,MAAMC,KAAKtW,KAAK0zE,WAAW/6D,SACtC,CAKA,sBAAAsgE,GACI,OAAO5iE,MAAMC,KAAKtW,KAAK2zE,WAAWh7D,UAAU3Q,OAAOo0D,GAAKA,EAAEkZ,YAC9D,CAKA,oBAAA4D,CAAqBC,EAAgB,IACjC,OAAOn5E,KAAKg3B,YACPyxB,KAAK,CAACj8C,EAAGhB,IAAMA,EAAEitE,cAAgBjsE,EAAEisE,eACnCnwE,MAAM,EAAG6wE,EAClB,CAKQ,kBAAA7B,CAAmBpD,EAAsBC,GAC7C,OAAO99D,MAAMC,KAAKtW,KAAKi3B,aAAate,UAC/B3Q,OAAO6sE,GAAQA,EAAKX,QAAUA,GAASW,EAAKV,OAASA,GAAQU,EAAKJ,YAClE7tE,MACT,CAKA,gBAAAwyE,GAUI,MAAMC,EAA0E,CAAA,EAQhF,OANApkD,OAAOtc,OAAO46D,GAAepkE,QAAQ+kE,IACjC,MAAMj9C,EAAe5gB,MAAMC,KAAKtW,KAAKi3B,aAAate,UAAU3Q,OAAO6sE,GAAQA,EAAKX,QAAUA,GACpFlE,EAAW/4C,EAAajvB,OAAO6sE,GAAQA,EAAKJ,YAAY7tE,OAC9DyyE,EAAcnF,GAAS,CAAElE,WAAUzuC,MAAOtK,EAAarwB,UAGpD,CACH0yE,kBAAmBt5E,KAAKi3B,aAAa5rB,KACrCkuE,qBAAsBljE,MAAMC,KAAKtW,KAAKi3B,aAAate,UAAU3Q,OAAO6sE,GAAQA,EAAKJ,YAAY7tE,OAC7F4yE,eAAgBnjE,MAAMC,KAAKtW,KAAKyzE,SAAS96D,UAAU3Q,OAAO09B,GAAkB,WAAbA,EAAEtJ,QAAqBx1B,OACtFgtE,oBAAqB5zE,KAAK4zE,oBAC1B58C,YAAah3B,KAAKg3B,YAAYpwB,OAC9B8sE,WAAY1zE,KAAK0zE,WAAWroE,KAC5BsoE,WAAY3zE,KAAK2zE,WAAWtoE,KAC5BguE,gBAER,CAKA,cAAAI,CAAe/C,GACX,MAAMC,EAAU32E,KAAKyzE,SAASvqE,IAAIwtE,GAClC,IAAKC,GAA8B,WAAnBA,EAAQv6C,OAAqB,OAAO,EAEpD,MAAM05C,EAAa91E,KAAKi3B,aAAa/tB,IAAIytE,EAAQhB,cAC3CP,EAAWp1E,KAAK0zE,WAAWxqE,IAAIytE,EAAQf,YAyB7C,OAvBIE,IACAA,EAAWpB,eAAgB,EAC3BoB,EAAWnB,iBAAmB,GAG9BS,IACAA,EAASH,gBAAkBG,EAASH,gBAAgBjtE,OAAO0O,GAAMA,IAAOggE,IAI5EC,EAAQC,mBAAmBznE,QAAQinE,IAC/B,MAAMX,EAAYz1E,KAAK2zE,WAAWzqE,IAAIktE,GAClCX,IACAA,EAAUH,aAAc,EACxBG,EAAUY,qBAAkB,EAC5BZ,EAAUa,sBAAmB,KAIrCK,EAAQv6C,OAAS,SAEjBp8B,KAAKgJ,OAAOpD,KAAK,yBAAyB+wE,EAAQhB,iBAE3C,CACX,CAKA,gBAAA+D,GACI,MAAO,CACHziD,aAAc5gB,MAAMC,KAAKtW,KAAKi3B,aAAavwB,WAC3C+sE,SAAUp9D,MAAMC,KAAKtW,KAAKyzE,SAAS/sE,WACnCgtE,WAAYr9D,MAAMC,KAAKtW,KAAK0zE,WAAWhtE,WACvCitE,WAAYt9D,MAAMC,KAAKtW,KAAK2zE,WAAWjtE,WACvCswB,YAAah3B,KAAKg3B,YAClB48C,oBAAqB5zE,KAAK4zE,oBAC1BC,oBAAqBx9D,MAAMC,KAAKtW,KAAK6zE,oBAAoBntE,WAEjE,CAKA,gBAAAizE,CAAiBj0E,GACTA,EAAKuxB,eACLj3B,KAAKi3B,aAAe,IAAInuB,IAAIpD,EAAKuxB,eAEjCvxB,EAAK+tE,WACLzzE,KAAKyzE,SAAW,IAAI3qE,IAAIpD,EAAK+tE,WAE7B/tE,EAAKguE,aACL1zE,KAAK0zE,WAAa,IAAI5qE,IAAIpD,EAAKguE,aAE/BhuE,EAAKiuE,aACL3zE,KAAK2zE,WAAa,IAAI7qE,IAAIpD,EAAKiuE,aAE/BjuE,EAAKsxB,cACLh3B,KAAKg3B,YAActxB,EAAKsxB,aAExBtxB,EAAKkuE,sBACL5zE,KAAK4zE,oBAAsBluE,EAAKkuE,qBAEhCluE,EAAKmuE,sBACL7zE,KAAK6zE,oBAAsB,IAAI/qE,IAAIpD,EAAKmuE,sBAG5C7zE,KAAKgJ,OAAOpD,KAAK,0BAA2B,CACxCqxB,aAAcj3B,KAAKi3B,aAAa5rB,KAChCooE,SAAUzzE,KAAKyzE,SAASpoE,MAEhC,ECngCG,IAAKuuE,GAAAA,IACRA,EAAA,WAAa,aACbA,EAAA,SAAW,WACXA,EAAA,YAAc,cACdA,EAAA,QAAU,UACVA,EAAA,OAAS,SACTA,EAAA,SAAW,WACXA,EAAA,eAAiB,iBACjBA,EAAA,WAAa,aARLA,IAAAA,GAAA,CAAA,GAmGL,MAAMC,EAcT,WAAA/0E,CAAYigB,EAA+B,IAb3C/kB,KAAQ85E,SAAoChxE,IAC5C9I,KAAQ83D,aAAoDhvD,IAC5D9I,KAAQ+kB,OAAsB,GAC9B/kB,KAAQ+5E,WAAqCjxE,IAG7C9I,KAAQg6E,WAAqB,GAC7Bh6E,KAAQi6E,gBAA0B,GAClCj6E,KAAQk6E,aAAuB,GAM3Bl6E,KAAKgJ,OAAS,IAAIO,EAAO,kBACzBvJ,KAAKm6E,iBAAmBp1D,EAExB/kB,KAAKo6E,mBACLp6E,KAAKm4D,qBACLn4D,KAAKq6E,yBAELr6E,KAAKgJ,OAAOpD,KAAK,wCACrB,CAKQ,gBAAAw0E,GACwB,CACxB,CACI1jE,GAAI,UACJzQ,KAAM,UACNgnD,YAAa,+CACbqtB,QAAS,CACL,CAAEr2E,KAAM,cAAes7D,OAAQ,MAAOh9C,MAAO,IAC7C,CAAEte,KAAM,oBAAqBse,MAAO,KAExC4qC,OAAQ,YAEZ,CACIz2C,GAAI,iBACJzQ,KAAM,iBACNgnD,YAAa,6CACbqtB,QAAS,CACL,CAAEr2E,KAAM,cAAes7D,OAAQ,aAAsBh9C,MAAO,IAC5D,CAAEte,KAAM,eAAgBse,MAAO,KAEnC4qC,OAAQ,QAEZ,CACIz2C,GAAI,SACJzQ,KAAM,SACNgnD,YAAa,wCACbqtB,QAAS,CACL,CAAEr2E,KAAM,cAAes7D,OAAQ,UAAmBh9C,MAAO,IACzD,CAAEte,KAAM,mBAAoBse,MAAO,KAEvC4qC,OAAQ,aAEZ,CACIz2C,GAAI,YACJzQ,KAAM,YACNgnD,YAAa,8BACbqtB,QAAS,CACL,CAAEr2E,KAAM,cAAes7D,OAAQ,WAAoBh9C,MAAO,IAC1D,CAAEte,KAAM,mBAAoBse,MAAO,KAEvC4qC,OAAQ,QAEZ,CACIz2C,GAAI,aACJzQ,KAAM,aACNgnD,YAAa,+BACbqtB,QAAS,CACL,CAAEr2E,KAAM,mBAAoBse,MAAO,IACnC,CAAEte,KAAM,oBAAqBse,OAAO,KAExC4qC,OAAQ,UAEZ,CACIz2C,GAAI,aACJzQ,KAAM,aACNgnD,YAAa,mCACbqtB,QAAS,CACL,CAAEr2E,KAAM,wBAAyBse,MAAO,IACxC,CAAEte,KAAM,cAAes7D,OAAQ,iBAA0Bh9C,MAAO,KAEpE4qC,OAAQ,YAEZ,CACIz2C,GAAI,iBACJzQ,KAAM,iBACNgnD,YAAa,mCACbqtB,QAAS,CACL,CAAEr2E,KAAM,cAAes7D,OAAQ,SAAkBh9C,MAAO,IACxD,CAAEte,KAAM,oBAAqBse,MAAO,KAExC4qC,OAAQ,YAEZ,CACIz2C,GAAI,gBACJzQ,KAAM,gBACNgnD,YAAa,0CACbqtB,QAAS,CACL,CAAEr2E,KAAM,mBAAoBse,MAAO,IACnC,CAAEte,KAAM,oBAAqBse,OAAO,KAExC4qC,OAAQ,WAITh+C,QAAQorE,IACXv6E,KAAK+5E,OAAOhxE,IAAIwxE,EAAM7jE,GAAI6jE,IAElC,CAKQ,kBAAApiB,GAKC,CACD,CACII,QAAS,SACTiiB,QAAS,EACTC,eAAgB,CAAC,aAAsB,eAE3C,CACIliB,QAAS,cACTiiB,QAAS,EACTC,eAAgB,CAAC,gBAErB,CACIliB,QAAS,SACTiiB,QAAS,EACTC,eAAgB,CAAC,aAErB,CACIliB,QAAS,cACTiiB,QAAS,EACTC,eAAgB,CAAC,YAErB,CACIliB,QAAS,kBACTiiB,QAAS,EACTC,eAAgB,CAAC,WAErB,CACIliB,QAAS,aACTiiB,QAAS,EACTC,eAAgB,CAAC,aAAsB,aAE3C,CACIliB,QAAS,iBACTiiB,QAAS,EACTC,eAAgB,CAAC,mBAErB,CACIliB,QAAS,aACTiiB,QAAS,EACTC,eAAgB,KAITtrE,QAAQlK,IACnBjF,KAAK83D,SAAS/uD,IAAI9D,EAAOszD,QAAS,CAC9BuB,UAAW70D,EAAOszD,QAClBmiB,aAAc,GACdF,QAASv1E,EAAOu1E,QAChBC,eAAgBx1E,EAAOw1E,eACvBzsB,WAAY,EACZ5xB,OAAQ,cAGpB,CAKQ,sBAAAi+C,GACiB,CACjB,CACIp0E,KAAM,wBACN00E,KAAM,UACNC,QAAS,QACTvL,WAAYvmE,IAAI,CACZ,CAAC,aAAsB,IACvB,CAAC,aAAsB,IACvB,CAAC,SAAkB,MAEvBixE,OAAQ,CAAC,kBACTc,iBAAkB,UAEtB,CACI50E,KAAM,yBACN00E,KAAM,QACNC,QAAS,QACTvL,WAAYvmE,IAAI,CACZ,CAAC,WAAoB,IACrB,CAAC,aAAsB,IACvB,CAAC,cAAuB,MAE5BixE,OAAQ,CAAC,aACTc,iBAAkB,cAEtB,CACI50E,KAAM,2BACN00E,KAAM,WACNC,QAAS,aACTvL,WAAYvmE,IAAI,CACZ,CAAC,cAAuB,IACxB,CAAC,UAAmB,IACpB,CAAC,SAAkB,MAEvBixE,OAAQ,CAAC,iBACTc,iBAAkB,eAEtB,CACI50E,KAAM,oBACN00E,KAAM,QACNC,QAAS,QACTvL,WAAYvmE,IAAI,CACZ,CAAC,WAAoB,IACrB,CAAC,UAAmB,IACpB,CAAC,iBAA0B,MAE/BixE,OAAQ,CAAC,cACTc,iBAAkB,WAIb1rE,QAAQ,CAAC2rE,EAAUhuE,KAC5B,MAAMgtE,EAAO95E,KAAK+6E,iBACdD,EAAS70E,KACT60E,EAASH,KACTG,EAASF,QACTE,EAASzL,OACTyL,EAASf,OACTe,EAASD,kBAEb76E,KAAKg7E,cAAclB,IAE3B,CAKQ,gBAAAiB,CACJ90E,EACA00E,EACAC,EACAvL,EACA4L,EAAqB,GACrBJ,GAEA,MAAMK,EAAS,QAAQ70E,KAAKC,SAASsG,KAAK2U,SAASpQ,SAAS,IAAIgqE,OAAO,EAAG,KAGpEC,MAAgBtyE,IACtBmsB,OAAOtc,OAAOihE,GAAWzqE,QAAQ2gE,IAC7BsL,EAAUryE,IAAI+mE,EAAOT,EAAOnmE,IAAI4mE,IAAUljE,KAAKC,MAAsB,GAAhBD,KAAK2U,UAAiB,MAI/E,MAAM85D,EAA4B,GAqBlC,OApBAJ,EAAS9rE,QAAQmsE,IACb,MAAMf,EAAQv6E,KAAK+5E,OAAO7wE,IAAIoyE,GAC1Bf,IACAc,EAAa10E,KAAK4zE,GAClBA,EAAMD,QAAQnrE,QAAQosE,IAClB,GAAoB,gBAAhBA,EAAOt3E,KACP,GAAsB,QAAlBs3E,EAAOhc,OACPtqC,OAAOtc,OAAOihE,GAAWzqE,QAAQ2gE,IAC7B,MAAMC,EAAUqL,EAAUlyE,IAAI4mE,IAAU,EACxCsL,EAAUryE,IAAI+mE,EAAOljE,KAAKuD,IAAI,IAAK4/D,EAAUwL,EAAOh5D,eAE5D,GAAWg5D,EAAOhc,OAAQ,CACtB,MAAMwQ,EAAUqL,EAAUlyE,IAAIqyE,EAAOhc,SAAwB,EAC7D6b,EAAUryE,IAAIwyE,EAAOhc,OAAqB3yD,KAAKuD,IAAI,IAAK4/D,EAAUwL,EAAOh5D,OAC7E,OAMT,CACH7L,GAAIwkE,EACJj1E,OACA00E,OACAC,UACArvC,IAAK3+B,KAAKC,MAAsB,GAAhBD,KAAK2U,UAAiB,GAEtC8tD,OAAQ+L,EAERn9D,OAAQ,IACRu3D,OAAQ5oE,KAAKC,MAAsB,GAAhBD,KAAK2U,UAAiB,GACzCg0D,QAAS3oE,KAAKC,MAAsB,GAAhBD,KAAK2U,UAAiB,GAC1Ci6D,OAAQ5uE,KAAKC,MAAsB,GAAhBD,KAAK2U,UAAiB,EAEzCk6D,eAAgB,EAEhB1B,OAAQsB,EACRK,YAAa,CACTb,iBAAkBA,GAAoB,SACtCc,eAAgB,QAChBC,gBAAiB,CAAC,YAAa,YAAa,YAAYhvE,KAAKC,MAAsB,EAAhBD,KAAK2U,WACxEs6D,UAAW,CAAC,aAAc,WAAY,aAAc,iBAAiBjvE,KAAKC,MAAsB,EAAhBD,KAAK2U,YAEzFu6D,kBAAmBhzE,IAEnBiuB,WAAYnqB,KAAKC,MAAsB,IAAhBD,KAAK2U,UAAmB,IAC/Cw6D,KAAMnvE,KAAKC,MAAsB,EAAhBD,KAAK2U,UAAgB,EACtC20D,gBAAiB,GACjB8F,cAAe,GAEfC,WAAYj8E,KAAKkqD,mBAAmB0wB,EAASD,GAC7CuB,UAAWl8E,KAAKm8E,kBAAkBvB,GAClCwB,SAAU/1E,KAAKC,MAAQsG,KAAKC,MAAsB,IAAhBD,KAAK2U,SAAiB,GAAK,GAAK,GAAK,KAE/E,CAKQ,kBAAA2oC,CAAmB0wB,EAAiBD,GACxC,MAWM0B,EAXc,CAChBC,QAAoB,CAAC,0BAA2B,0BAA2B,oBAC3EC,MAAkB,CAAC,aAAc,eAAgB,iBAAkB,4BACnEC,SAAqB,CAAC,kBAAmB,qBAAsB,oBAAqB,wBACpF/G,UAAsB,CAAC,wBAAyB,sBAAuB,mBAAoB,kBAC3FgH,SAAqB,CAAC,kBAAmB,qBAAsB,gBAAiB,mBAChFC,MAAkB,CAAC,eAAgB,kBAAmB,qBAAsB,eAC5EC,eAA2B,CAAC,iBAAkB,qBAAsB,yBAA0B,0BAC9Fv7E,UAAsB,CAAC,0BAA2B,uBAAwB,oBAAqB,uBAG/Du5E,IAAS,CAAC,uBAC9C,OAAO0B,EAAgBzvE,KAAKC,MAAMD,KAAK2U,SAAW86D,EAAgBz1E,QACtE,CAKQ,iBAAAu1E,CAAkBvB,GACtB,MAAMgC,EAAa,CACfC,MAAS,CAAC,QAAS,OAAQ,iBAAkB,YAAa,mBAC1DC,WAAc,CAAC,iBAAkB,gBAAiB,kBAClDC,OAAU,CAAC,SAAU,aAAc,uBACnCC,SAAY,CAAC,UAAW,mBAAoB,qBAG1CC,EAAiBL,EAAmBhC,IAAYgC,EAAkB,MACxE,OAAOK,EAAcrwE,KAAKC,MAAMD,KAAK2U,SAAW07D,EAAcr2E,QAClE,CAKA,aAAAo0E,CAAclB,GACV,GAAI95E,KAAK85E,KAAKzuE,MAAQrL,KAAKk6E,aAEvB,OADAl6E,KAAKgJ,OAAOnD,KAAK,iDACV,EAGX7F,KAAK85E,KAAK/wE,IAAI+wE,EAAKpjE,GAAIojE,GAGvB,IAAA,MAAWoD,KAAgBl9E,KAAK85E,KAAKnhE,SACjC,GAAIukE,EAAaxmE,KAAOojE,EAAKpjE,GAAI,CAC7B,MAAMymE,EAAen9E,KAAKo9E,6BAA6BtD,EAAMoD,GAC7DpD,EAAKgC,cAAc/yE,IAAIm0E,EAAaxmE,GAAIymE,GACxCD,EAAapB,cAAc/yE,IAAI+wE,EAAKpjE,GAAIymE,EAC5C,CAWJ,OARAn9E,KAAKm6E,iBAAiBkD,eAAevD,GAErC95E,KAAKgJ,OAAOpD,KAAK,0BAA0Bk0E,EAAK7zE,OAAQ,CACpD00E,KAAMb,EAAKa,KACXC,QAASd,EAAKc,QACdb,OAAQD,EAAKC,OAAO9qE,IAAI8R,GAAKA,EAAE9a,SAG5B,CACX,CAKQ,4BAAAm3E,CAA6BE,EAAmBC,GACpD,IAAIJ,EAAe,EAyBnB,OAtBIG,EAAM1C,UAAY2C,EAAM3C,UACxBuC,GAAgB,IAIhBG,EAAM5B,YAAYE,kBAAoB2B,EAAM7B,YAAYE,kBACxDuB,GAAgB,GAIhBG,EAAM5B,YAAYG,YAAc0B,EAAM7B,YAAYG,UAClDsB,GAAgB,EAEiB,kBAAhCG,EAAM5B,YAAYG,WAAiE,kBAAhC0B,EAAM7B,YAAYG,WACtC,eAAhCyB,EAAM5B,YAAYG,WAA8D,eAAhC0B,EAAM7B,YAAYG,YAElEsB,GAAgB,GAIpBA,GAAgBvwE,KAAKC,MAAsB,GAAhBD,KAAK2U,UAAiB,GAE1C3U,KAAKoC,KAAI,GAAKpC,KAAKuD,IAAI,GAAIgtE,GACtC,CAKA,mBAAAK,CAAoBtC,EAAgB3iB,GAChC,MAAMuhB,EAAO95E,KAAK85E,KAAK5wE,IAAIgyE,GACrB3e,EAAcv8D,KAAK83D,SAAS5uD,IAAIqvD,GAEtC,OAAKuhB,GAASvd,GAMVud,EAAK2D,gBACLz9E,KAAK09E,sBAAsBxC,EAAQpB,EAAK2D,gBAIxClhB,EAAYme,aAAa9zE,QAAU21D,EAAYie,SAC/Cx6E,KAAKgJ,OAAOnD,KAAK,sBAAuB,CAAE0yD,aACnC,IAIXuhB,EAAK2D,eAAiBllB,EACtBgE,EAAYme,aAAa/zE,KAAKu0E,GAG9BpB,EAAK2B,eAAiBz7E,KAAK29E,wBAAwB7D,EAAMvhB,GAGzDv4D,KAAK49E,wBAAwBrlB,GAE7Bv4D,KAAKgJ,OAAOpD,KAAK,qBAAqBk0E,EAAK7zE,UAAUsyD,IAAW,CAC5DvK,WAAY8rB,EAAK2B,eAAepyE,QAAQ,MAGrC,KA7BHrJ,KAAKgJ,OAAOnD,KAAK,yCAA0C,CAAEq1E,SAAQ3iB,aAC9D,EA6Bf,CAKQ,qBAAAmlB,CAAsBxC,EAAgB3iB,GAC1C,MAAMgE,EAAcv8D,KAAK83D,SAAS5uD,IAAIqvD,GAClCgE,IACAA,EAAYme,aAAene,EAAYme,aAAa1yE,OAAO0O,GAAMA,IAAOwkE,GACxEl7E,KAAK49E,wBAAwBrlB,IAGjC,MAAMuhB,EAAO95E,KAAK85E,KAAK5wE,IAAIgyE,GACvBpB,IACAA,EAAK2D,oBAAiB,EACtB3D,EAAK2B,eAAiB,EAE9B,CAKQ,uBAAAkC,CAAwB7D,EAAkBvhB,GAC9C,IAAIvK,EAAa,EAGjB,MAAMuO,EAAcv8D,KAAK83D,SAAS5uD,IAAIqvD,GACtC,GAAIgE,EAAa,CACb,IAAIshB,EAAa,EACbC,EAAa,EAQjB,GANAvhB,EAAYke,eAAetrE,QAAQ2gE,IAC/B,MAAMiO,EAAajE,EAAKzK,OAAOnmE,IAAI4mE,IAAU,EAC7C+N,GAAcE,EACdD,MAGAA,EAAa,EAAG,CAEhB9vB,EAAa,GADQ6vB,EAAaC,EACC,IAAO,GAC9C,CACJ,CAsBA,OAnBIhE,EAAK4B,YAAYb,mBAAqBtiB,IACtCvK,GAAc,KAIlBA,GAAe8rB,EAAK77D,OAAS,IAC7B+vC,GAAe8rB,EAAKtE,OAAS,IAC7BxnB,GAAe,EAAI8rB,EAAKvE,QAAU,IAClCvnB,GAAe,EAAI8rB,EAAK0B,OAAS,IAGjC1B,EAAKC,OAAO5qE,QAAQorE,IAChBA,EAAMD,QAAQnrE,QAAQosE,IACE,qBAAhBA,EAAOt3E,OACP+pD,GAAe,EAAIutB,EAAOh5D,MAAQ,SAKvC3V,KAAKoC,IAAI,GAAKpC,KAAKuD,IAAI,IAAK69C,GACvC,CAKQ,uBAAA4vB,CAAwBrlB,GAC5B,MAAMgE,EAAcv8D,KAAK83D,SAAS5uD,IAAIqvD,GACtC,GAAKgE,EAAL,CAEA,GAAwC,IAApCA,EAAYme,aAAa9zE,OACzB21D,EAAYvO,WAAa,EACzBuO,EAAYngC,OAAS,eAClB,CACH,IAAI4hD,EAAkB,EAClBC,EAAY,EAUhB,GARA1hB,EAAYme,aAAavrE,QAAQ+rE,IAC7B,MAAMpB,EAAO95E,KAAK85E,KAAK5wE,IAAIgyE,GACvBpB,IACAkE,GAAmBlE,EAAK2B,eACxBwC,OAIJA,EAAY,EAAG,CACf1hB,EAAYvO,WAAagwB,EAAkBC,EAG3C,MAAMC,EAActxE,KAAK0tD,KAA2B,IAAtBiC,EAAYie,SACtCyD,EAAYC,EACZ3hB,EAAYngC,OAAS,eACd6hD,EAAY1hB,EAAYie,SAC/Bje,EAAYngC,OAAS,cACrBmgC,EAAYvO,YAAc,IAE1BuO,EAAYngC,OAAS,aAE7B,CACJ,CAEAp8B,KAAKm6E,iBAAiBgE,6BAA6B5lB,EAASgE,EAAYvO,WAjCtD,CAkCtB,CAKA,MAAAx5C,CAAOC,GACHzU,KAAKo+E,iBAAiB3pE,GACtBzU,KAAKq+E,oBAAoB5pE,GACzBzU,KAAKs+E,kBACLt+E,KAAKu+E,kBACT,CAKQ,gBAAAH,CAAiB3pE,GACrB,IAAA,MAAWqlE,KAAQ95E,KAAK85E,KAAKnhE,SAAU,CAE/BmhE,EAAK2D,eACL3D,EAAKvE,QAAU3oE,KAAKuD,IAAI,IAAK2pE,EAAKvE,QAAsB,IAAZ9gE,GAG5CqlE,EAAKvE,QAAU3oE,KAAKoC,IAAI,EAAG8qE,EAAKvE,QAAsB,IAAZ9gE,GAI9C,IAAI+pE,EAAe,EAGnB,GAAI1E,EAAK2D,eAAgB,CACrB,MAAMlhB,EAAcv8D,KAAK83D,SAAS5uD,IAAI4wE,EAAK2D,gBACvClhB,GAAsC,iBAAvBA,EAAYngC,SAC3BoiD,GAA4B,IAAZ/pE,EAExB,CAGA,IAAIgqE,EAAqB,EACrBC,EAAoB,EAMxB,GALA5E,EAAKgC,cAAc3sE,QAAQguE,IACvBsB,GAAsBtB,EACtBuB,MAGAA,EAAoB,EAAG,CACvB,MAAMC,EAAkBF,EAAqBC,EACzCC,GAAkB,GAClBH,GAA4B,IAAZ/pE,EACTkqE,EAAkB,KACzBH,GAA4B,IAAZ/pE,EAExB,CAGAqlE,EAAKC,OAAO5qE,QAAQorE,IAChBA,EAAMD,QAAQnrE,QAAQosE,IACE,sBAAhBA,EAAOt3E,OACPu6E,GAAiB,EAAIjD,EAAOh5D,MAAQ,SAKhDu3D,EAAK0B,OAAS5uE,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAK2pE,EAAK0B,OAASgD,IAGtD,IAAII,EAAe,EAGnBA,GAA4B,IAAZnqE,EAGZqlE,EAAK2D,iBAAmB3D,EAAK4B,YAAYb,mBACzC+D,GAA4B,IAAZnqE,GAIhBqlE,EAAK77D,OAAS,KACd2gE,GAA4B,KAAZnqE,GAIhBqlE,EAAK0B,OAAS,KACdoD,GAA4B,IAAZnqE,GAIpBqlE,EAAKC,OAAO5qE,QAAQorE,IAChBA,EAAMD,QAAQnrE,QAAQosE,IACE,iBAAhBA,EAAOt3E,OACP26E,GAAgBnqE,GAAa8mE,EAAOh5D,MAAQ,UAKxDu3D,EAAKtE,OAAS5oE,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAK2pE,EAAKtE,OAASoJ,IAGlD9E,EAAK2D,iBACL3D,EAAK2B,eAAiBz7E,KAAK29E,wBAAwB7D,EAAMA,EAAK2D,gBAEtE,CACJ,CAKQ,mBAAAY,CAAoB5pE,GACxB,MAAMoqE,EAAYxoE,MAAMC,KAAKtW,KAAK85E,KAAKnhE,UAEvC,IAAA,IAASpM,EAAI,EAAGA,EAAIsyE,EAAUj4E,OAAQ2F,IAClC,IAAA,IAAS2O,EAAI3O,EAAI,EAAG2O,EAAI2jE,EAAUj4E,OAAQsU,IAAK,CAC3C,MAAMoiE,EAAQuB,EAAUtyE,GAClBgxE,EAAQsB,EAAU3jE,GAGxB,GAAIoiE,EAAMG,iBAAmBF,EAAME,gBAAkBH,EAAMG,eAAgB,CACvE,MAAMqB,EAA0B,KAAZrqE,EACpBzU,KAAK++E,mBAAmBzB,EAAM5mE,GAAI6mE,EAAM7mE,GAAIooE,EAChD,CAGA,GAAIlyE,KAAK2U,SAAW,KAAO,CACvB,MAAMy9D,EAAiC,GAAvBpyE,KAAK2U,SAAW,IAChCvhB,KAAK++E,mBAAmBzB,EAAM5mE,GAAI6mE,EAAM7mE,GAAIsoE,EAChD,CACJ,CAER,CAKQ,kBAAAD,CAAmBE,EAAiBC,EAAiBF,GACzD,MAAM1B,EAAQt9E,KAAK85E,KAAK5wE,IAAI+1E,GACtB1B,EAAQv9E,KAAK85E,KAAK5wE,IAAIg2E,GAE5B,IAAK5B,IAAUC,EAAO,OAEtB,MAAM4B,EAAW7B,EAAMxB,cAAc5yE,IAAIg2E,IAAY,EAC/CE,EAAW7B,EAAMzB,cAAc5yE,IAAI+1E,IAAY,EAErD3B,EAAMxB,cAAc/yE,IAAIm2E,EAAStyE,KAAKoC,KAAI,IAAMpC,KAAKuD,IAAI,IAAKgvE,EAAWH,KACzEzB,EAAMzB,cAAc/yE,IAAIk2E,EAASryE,KAAKoC,KAAI,IAAMpC,KAAKuD,IAAI,IAAKivE,EAAWJ,IAC7E,CAKQ,eAAAV,GACA1xE,KAAK2U,SAAW,MAChBvhB,KAAKq/E,mBAEb,CAKQ,iBAAAA,GACJ,MAAMR,EAAYxoE,MAAMC,KAAKtW,KAAK85E,KAAKnhE,UACvC,GAAIkmE,EAAUj4E,OAAS,EAAG,OAE1B,MAAM04E,EAAa,CAAC,WAAY,cAAe,YAAa,aAG5D,IAAIC,EAEJ,OAJkBD,EAAW1yE,KAAKC,MAAMD,KAAK2U,SAAW+9D,EAAW14E,UAK/D,IAAK,WACD24E,EAAQv/E,KAAKw/E,sBAAsBX,GACnC,MACJ,IAAK,cACDU,EAAQv/E,KAAKy/E,yBAAyBZ,GACtC,MACJ,IAAK,YACDU,EAAQv/E,KAAK0/E,uBAAuBb,GACpC,MACJ,IAAK,YACDU,EAAQv/E,KAAK2/E,uBAAuBd,GACpC,MACJ,QACI,OAGR7+E,KAAK+kB,OAAOpe,KAAK44E,GACjBv/E,KAAKm6E,iBAAiByF,cAAcL,GAGpCA,EAAMjF,QAAQnrE,QAAQosE,IAClB,MAAMzB,EAAO95E,KAAK85E,KAAK5wE,IAAIqyE,EAAOL,QAClC,GAAIpB,EACA,OAAQyB,EAAOA,QACX,IAAK,SACDzB,EAAKtE,OAAS5oE,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAK2pE,EAAKtE,OAAS+F,EAAOh5D,QAC7D,MACJ,IAAK,SACDu3D,EAAK0B,OAAS5uE,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAK2pE,EAAK0B,OAASD,EAAOh5D,QAC7D,MACJ,IAAK,aACDu3D,EAAK/iD,YAAcwkD,EAAOh5D,SAM1CviB,KAAKgJ,OAAOpD,KAAK,kBAAkB25E,EAAMtyB,cAAe,CACpDhpD,KAAMs7E,EAAMt7E,KACZ47E,aAAcN,EAAMM,aAAaj5E,QAEzC,CAKQ,qBAAA44E,CAAsBX,GAC1B,MAAMvB,EAAQuB,EAAUjyE,KAAKC,MAAMD,KAAK2U,SAAWs9D,EAAUj4E,SACvD22E,EAAQsB,EAAUjyE,KAAKC,MAAMD,KAAK2U,SAAWs9D,EAAUj4E,SAE7D,GAAI02E,EAAM5mE,KAAO6mE,EAAM7mE,GACnB,OAAO1W,KAAKw/E,sBAAsBX,GAGtC,MAAMiB,EAAgB,CAClB,+BACA,oBACA,8BACA,6BAGEC,EAAeD,EAAclzE,KAAKC,MAAMD,KAAK2U,SAAWu+D,EAAcl5E,SAE5E,MAAO,CACH8P,GAAI,SAASrQ,KAAKC,QAClBrC,KAAM,WACN47E,aAAc,CAACvC,EAAM5mE,GAAI6mE,EAAM7mE,IAC/Bu2C,YAAa,GAAGqwB,EAAMr3E,YAAYs3E,EAAMt3E,cAAc85E,IACtDzF,QAAS,CACL,CAAEY,OAAQoC,EAAM5mE,GAAI6kE,OAAQ,SAAUh5D,OAAO,IAC7C,CAAE24D,OAAQqC,EAAM7mE,GAAI6kE,OAAQ,SAAUh5D,OAAO,IAC7C,CAAE24D,OAAQoC,EAAM5mE,GAAI6kE,OAAQ,SAAUh5D,MAAO,IAC7C,CAAE24D,OAAQqC,EAAM7mE,GAAI6kE,OAAQ,SAAUh5D,MAAO,KAEjDnc,UAAWC,KAAKC,MAChB05E,UAAU,EAElB,CAKQ,wBAAAP,CAAyBZ,GAC7B,MAAM/E,EAAO+E,EAAUjyE,KAAKC,MAAMD,KAAK2U,SAAWs9D,EAAUj4E,SAEtD2oE,EAAe,CACjB,wCACA,2CACA,oDACA,oCAGEW,EAAcX,EAAa3iE,KAAKC,MAAMD,KAAK2U,SAAWguD,EAAa3oE,SAEzE,MAAO,CACH8P,GAAI,SAASrQ,KAAKC,QAClBrC,KAAM,cACN47E,aAAc,CAAC/F,EAAKpjE,IACpBu2C,YAAa,GAAG6sB,EAAK7zE,qBAAqBiqE,IAC1CoK,QAAS,CACL,CAAEY,OAAQpB,EAAKpjE,GAAI6kE,OAAQ,SAAUh5D,MAAO,IAC5C,CAAE24D,OAAQpB,EAAKpjE,GAAI6kE,OAAQ,aAAch5D,MAAO,MAEpDnc,UAAWC,KAAKC,MAChB05E,UAAU,EAElB,CAKQ,sBAAAN,CAAuBb,GAC3B,MAAM/E,EAAO+E,EAAUjyE,KAAKC,MAAMD,KAAK2U,SAAWs9D,EAAUj4E,SAEtDowB,EAAc,CAChB,qCACA,oCACA,yCACA,yCAGEuhD,EAAYvhD,EAAYpqB,KAAKC,MAAMD,KAAK2U,SAAWyV,EAAYpwB,SAErE,MAAO,CACH8P,GAAI,SAASrQ,KAAKC,QAClBrC,KAAM,YACN47E,aAAc,CAAC/F,EAAKpjE,IACpBu2C,YAAa,GAAG6sB,EAAK7zE,QAAQsyE,IAC7B+B,QAAS,CACL,CAAEY,OAAQpB,EAAKpjE,GAAI6kE,OAAQ,SAAUh5D,MAAO,IAC5C,CAAE24D,OAAQpB,EAAKpjE,GAAI6kE,OAAQ,aAAch5D,MAAO,KAEpDnc,UAAWC,KAAKC,MAChB05E,UAAU,EAElB,CAKQ,sBAAAL,CAAuBd,GAC3B,MAAMoB,EAAepB,EAAU72E,OAAO8xE,GAAQA,EAAKiC,KAAO,IAAMjC,EAAK/iD,WAAa,KAClF,GAA4B,IAAxBkpD,EAAar5E,OAAc,OAAO5G,KAAKy/E,yBAAyBZ,GAEpE,MAAM/E,EAAOmG,EAAarzE,KAAKC,MAAMD,KAAK2U,SAAW0+D,EAAar5E,SAGlE,OAFAkzE,EAAKiC,OAEE,CACHrlE,GAAI,SAASrQ,KAAKC,QAClBrC,KAAM,YACN47E,aAAc,CAAC/F,EAAKpjE,IACpBu2C,YAAa,GAAG6sB,EAAK7zE,kCAAkC6zE,EAAKiC,OAC5DzB,QAAS,CACL,CAAEY,OAAQpB,EAAKpjE,GAAI6kE,OAAQ,SAAUh5D,MAAO,KAEhDnc,UAAWC,KAAKC,MAChB05E,UAAU,EAElB,CAKQ,gBAAAzB,GACJ,GAAuB,IAAnBv+E,KAAK85E,KAAKzuE,KAEV,YADArL,KAAKg6E,WAAa,IAItB,IAAIkG,EAAc,EAClB,IAAA,MAAWpG,KAAQ95E,KAAK85E,KAAKnhE,SACzBunE,GAAepG,EAAKtE,OAGxB,MAAM2K,EAAgBD,EAAclgF,KAAK85E,KAAKzuE,KAG9CrL,KAAKg6E,WAA+B,GAAlBh6E,KAAKg6E,WAAmC,GAAhBmG,EAGtCngF,KAAKg6E,WAAa,IAClBh6E,KAAKm6E,iBAAiBiG,gBAAgBpgF,KAAKg6E,WAEnD,CAKA,aAAAqG,CAAcnF,GACV,OAAOl7E,KAAK85E,KAAK5wE,IAAIgyE,IAAW,IACpC,CAKA,UAAAoF,GACI,OAAOjqE,MAAMC,KAAKtW,KAAK85E,KAAKnhE,SAChC,CAKA,aAAA4nE,CAAc5F,GACV,OAAOtkE,MAAMC,KAAKtW,KAAK85E,KAAKnhE,UAAU3Q,OAAO8xE,GAAQA,EAAKa,OAASA,EACvE,CAKA,gBAAA6F,CAAiBjoB,GACb,OAAOliD,MAAMC,KAAKtW,KAAK85E,KAAKnhE,UAAU3Q,OAAO8xE,GAAQA,EAAK2D,iBAAmBllB,EACjF,CAKA,UAAAkoB,CAAWloB,GACP,OAAOv4D,KAAK83D,SAAS5uD,IAAIqvD,IAAY,IACzC,CAKA,cAAAmoB,GACI,OAAOrqE,MAAMC,KAAKtW,KAAK83D,SAASn/C,SACpC,CAKA,eAAAgoE,CAAgBxH,EAAgB,IAC5B,OAAOn5E,KAAK+kB,OACP0jC,KAAK,CAACj8C,EAAGhB,IAAMA,EAAEpF,UAAYoG,EAAEpG,WAC/BkC,MAAM,EAAG6wE,EAClB,CAKA,YAAAyH,GAYI,MAAMC,EAAY7gF,KAAK85E,KAAKzuE,KACtBmvE,EAAUx6E,KAAKk6E,aAErB,IAAIgG,EAAc,EACdY,EAAc,EACdC,EAAe,EACfC,EAAc,EAElB,MAAMC,EAA+C,CAAA,EAErD,IAAA,MAAWnH,KAAQ95E,KAAK85E,KAAKnhE,SACzBunE,GAAepG,EAAKtE,OACpBsL,GAAehH,EAAK77D,OACpB8iE,GAAgBjH,EAAKvE,QACrByL,GAAelH,EAAK0B,OAEpByF,EAAiBnH,EAAKa,OAASsG,EAAiBnH,EAAKa,OAAS,GAAK,EAGvE,MAAMuG,EAAmD,CAAA,EACzD,IAAA,MAAY3oB,EAAS7yD,KAAS1F,KAAK83D,SAASpxD,UACxCw6E,EAAkB3oB,GAAW7yD,EAAKsoD,WAGtC,MAAO,CACH6yB,YACArG,UACA2F,cAAeU,EAAY,EAAIX,EAAcW,EAAY,EACzDM,cAAeN,EAAY,EAAIC,EAAcD,EAAY,EACzDO,eAAgBP,EAAY,EAAIE,EAAeF,EAAY,EAC3DQ,cAAeR,EAAY,EAAIG,EAAcH,EAAY,EACzDK,oBACAD,mBACAjH,WAAYh6E,KAAKg6E,WACjBC,gBAAiBj6E,KAAKi6E,gBAE9B,CAKA,YAAAqH,GACI,MAAO,CACHxH,KAAMzjE,MAAMC,KAAKtW,KAAK85E,KAAKpzE,WAAWuI,IAAI,EAAEyH,EAAIojE,KAAU,CACtDpjE,EACA,IACOojE,EACHzK,OAAQh5D,MAAMC,KAAKwjE,EAAKzK,OAAO3oE,WAC/Bo1E,cAAezlE,MAAMC,KAAKwjE,EAAKgC,cAAcp1E,cAGrDoxD,SAAUzhD,MAAMC,KAAKtW,KAAK83D,SAASpxD,WACnCqe,OAAQ/kB,KAAK+kB,OACbi1D,WAAYh6E,KAAKg6E,WACjBC,gBAAiBj6E,KAAKi6E,gBACtBC,aAAcl6E,KAAKk6E,aAE3B,CAKA,YAAAqH,CAAa77E,GACLA,EAAKo0E,OACL95E,KAAK85E,KAAO,IAAIhxE,IAAIpD,EAAKo0E,KAAK7qE,IAAI,EAAEyH,EAAIojE,KAAyB,CAC7DpjE,EACA,IACOojE,EACHzK,OAAQ,IAAIvmE,IAAIgxE,EAAKzK,QACrByM,cAAe,IAAIhzE,IAAIgxE,EAAKgC,oBAIpCp2E,EAAKoyD,WACL93D,KAAK83D,SAAW,IAAIhvD,IAAIpD,EAAKoyD,WAE7BpyD,EAAKqf,SACL/kB,KAAK+kB,OAASrf,EAAKqf,aAEC,IAApBrf,EAAKs0E,aACLh6E,KAAKg6E,WAAat0E,EAAKs0E,iBAEE,IAAzBt0E,EAAKu0E,kBACLj6E,KAAKi6E,gBAAkBv0E,EAAKu0E,sBAEN,IAAtBv0E,EAAKw0E,eACLl6E,KAAKk6E,aAAex0E,EAAKw0E,cAG7Bl6E,KAAKgJ,OAAOpD,KAAK,sBAAuB,CACpCq4E,UAAWj+E,KAAK85E,KAAKzuE,KACrB0Z,OAAQ/kB,KAAK+kB,OAAOne,QAE5B,EC1+BG,MAAM46E,EAaT,WAAA18E,CAAYigB,EAA0B,IAZtC/kB,KAAQoiE,aAAqCt5D,IAC7C9I,KAAQyhF,aAAoC34E,IAC5C9I,KAAQ0hF,iBAAoD54E,IAC5D9I,KAAQssE,eAAmDxjE,IAC3D9I,KAAQ2hF,kBAAwC,GAGhD3hF,KAAiB4hF,kBAAoB,SAMjC5hF,KAAKgJ,OAAS,IAAIO,EAAO,mBACzBvJ,KAAK+kB,OAASA,EAEd/kB,KAAKmiE,qBACLniE,KAAK6hF,0BAEL7hF,KAAKgJ,OAAOpD,KAAK,kCACrB,CAKQ,kBAAAu8D,GACJ,MAAMC,EAAsB,CACxB,CACI1rD,GAAI,oBACJzQ,KAAM,oBACNhC,KAAM,aACNgpD,YAAa,wCACb60B,WAAY,YACZC,SAAU,eACVxwC,WAAY,GACZywC,OAAQ,WACRC,WAAY,GACZ1lD,MAAO,GACP2lD,UAAW,CAAC,aAAc,iBAAkB,mBAC5CtrD,UAAW,CACP4wC,SAAU,GACV2a,SAAU,GACVC,cAAe,GACfC,UAAW,IAEfZ,SAAU,GACVa,cAAe,GACfC,YAAa,CACTpV,WAAY,GACZqV,YAAa,GACbC,gBAAiB,GACjBC,MAAO,GACPC,MAAO,GACPC,WAAY,IAEhBjgD,UAAU,EACVkgD,YAAa,EACbC,WAAY,cAEhB,CACIpsE,GAAI,mBACJzQ,KAAM,mBACNhC,KAAM,SACNgpD,YAAa,gDACb60B,WAAY,YACZC,SAAU,eACVxwC,YAAY,GACZywC,OAAQ,UACRC,WAAY,GACZ1lD,MAAO,GACP2lD,UAAW,CAAC,eAAgB,eAAgB,kBAC5CtrD,UAAW,CACP4wC,SAAU,GACV2a,SAAU,GACVC,cAAe,IACfC,UAAW,IAEfZ,SAAU,GACVa,cAAe,GACfC,YAAa,CACTpV,WAAY,GACZqV,YAAa,GACbC,gBAAiB,GACjBC,MAAO,GACPC,MAAO,GACPC,WAAY,IAEhBjgD,UAAU,EACVkgD,YAAa,EACbC,WAAY,gBAEhB,CACIpsE,GAAI,iBACJzQ,KAAM,iBACNhC,KAAM,UACNgpD,YAAa,iCACb60B,WAAY,UACZC,SAAU,eACVxwC,YAAY,GACZywC,OAAQ,UACRC,WAAY,GACZ1lD,MAAO,GACP2lD,UAAW,CAAC,kBAAmB,iBAC/BtrD,UAAW,CACP4wC,SAAU,GACV2a,SAAU,GACVC,cAAe,GACfC,UAAW,IAEfZ,SAAU,GACVa,cAAe,GACfC,YAAa,CACTpV,WAAY,GACZqV,YAAa,GACbC,gBAAiB,GACjBC,MAAO,GACPC,MAAO,GACPC,WAAY,IAEhBjgD,UAAU,EACVkgD,YAAa,EACbC,WAAY,mBAEhB,CACIpsE,GAAI,gBACJzQ,KAAM,uBACNhC,KAAM,YACNgpD,YAAa,4CACb60B,WAAY,YACZC,SAAU,aACVxwC,WAAY,GACZywC,OAAQ,UACRC,WAAY,GACZ1lD,MAAO,GACP2lD,UAAW,CAAC,kBAAmB,oBAC/BtrD,UAAW,CACP4wC,SAAU,GACV2a,SAAU,IACVC,cAAe,GACfC,UAAW,IAEfZ,SAAU,GACVa,cAAe,GACfC,YAAa,CACTpV,WAAY,GACZqV,YAAa,GACbC,gBAAiB,GACjBC,MAAO,GACPC,MAAO,GACPC,WAAY,IAEhBjgD,UAAU,EACVkgD,YAAa,EACbC,WAAY,mBAEhB,CACIpsE,GAAI,eACJzQ,KAAM,eACNhC,KAAM,YACNgpD,YAAa,2CACb60B,WAAY,YACZC,SAAU,WACVxwC,WAAY,EACZywC,OAAQ,UACRC,WAAY,GACZ1lD,MAAO,GACP2lD,UAAW,CAAC,oBACZtrD,UAAW,CACP4wC,SAAU,GACV2a,SAAU,GACVC,cAAe,GACfC,UAAW,IAEfZ,SAAU,GACVa,cAAe,GACfC,YAAa,CACTpV,WAAY,GACZqV,YAAa,GACbC,gBAAiB,GACjBC,MAAO,GACPC,MAAO,GACPC,WAAY,GAEhBjgD,UAAU,EACVkgD,YAAa,EACbC,WAAY,oBAEhB,CACIpsE,GAAI,mBACJzQ,KAAM,mBACNhC,KAAM,SACNgpD,YAAa,6CACb60B,WAAY,YACZC,SAAU,eACVxwC,YAAY,GACZywC,OAAQ,aACRC,WAAY,GACZ1lD,MAAO,GACP2lD,UAAW,CAAC,qBACZtrD,UAAW,CACP4wC,SAAU,GACV2a,SAAU,GACVC,cAAe,GACfC,UAAW,IAEfZ,SAAU,GACVa,cAAe,GACfC,YAAa,CACTpV,WAAY,GACZqV,YAAa,GACbC,gBAAiB,GACjBC,MAAO,GACPC,MAAO,GACPC,WAAY,IAEhBjgD,UAAU,EACVkgD,YAAa,EACbC,WAAY,sBAIpB1gB,EAASjzD,QAAQg0D,IACbnjE,KAAKoiE,SAASr5D,IAAIo6D,EAAQzsD,GAAIysD,KAGlCnjE,KAAKgJ,OAAOpD,KAAK,mBAAmBw8D,EAASx7D,wBACjD,CAKQ,uBAAAi7E,GACJ,MAAMkB,EAAyB,CAC3BrsE,GAAI1W,KAAK4hF,kBACT37E,KAAM,sBACNhC,KAAM,cACNgpD,YAAa,8BACb60B,WAAY,YACZC,SAAU,aACVxwC,WAAY,EACZywC,OAAQ,UACRC,WAAY,GACZ1lD,MAAO,GACP2lD,UAAW,GACXtrD,UAAW,CACP4wC,SAAU,GACV2a,SAAU,GACVC,cAAe,GACfC,UAAW,IAEfZ,SAAU,GACVa,cAAe,GACfC,YAAa,CACTpV,WAAY,GACZqV,YAAa,GACbC,gBAAiB,GACjBC,MAAO,GACPC,MAAO,GACPC,WAAY,IAEhBjgD,UAAU,EACVkgD,YAAax8E,KAAKC,MAClBw8E,WAAY,mBAGhB9iF,KAAKoiE,SAASr5D,IAAI/I,KAAK4hF,kBAAmBmB,EAC9C,CAKA,gBAAAC,CAAiBC,EAAmBjE,EAAgBkE,GAChD,MAAM/f,EAAUnjE,KAAKoiE,SAASl5D,IAAI+5E,GAClC,IAAK9f,EAAS,OAEd,MAAMggB,EAAgBhgB,EAAQ5xB,WAC9B4xB,EAAQ5xB,WAAa3kC,KAAKoC,KAAI,IAAMpC,KAAKuD,IAAI,IAAKgzD,EAAQ5xB,WAAaytC,IAGvE7b,EAAQ6e,OAAShiF,KAAKojF,0BAA0BjgB,EAAQ5xB,YAGxDvxC,KAAKqjF,uBAAuB,CACxBp/E,KAAM,UACNq/E,MAAOtjF,KAAK4hF,kBACZriB,OAAQ0jB,EACRh2B,YAAai2B,EACbK,iBAAkBvE,EAClBwE,WAAYxE,EAAS,IAGzBh/E,KAAK+kB,OAAO0+D,sBAAsBR,EAAWE,EAAehgB,EAAQ5xB,YAEpEvxC,KAAKgJ,OAAOpD,KAAK,0BAA0Bu9D,EAAQl9D,QAAQk9E,OAAmBhgB,EAAQ5xB,eAAe2xC,KACzG,CAKQ,yBAAAE,CAA0B7xC,GAC9B,OAAIA,GAAc,GAAW,SACzBA,GAAc,GAAW,WACzBA,OAA0B,UAC1BA,OAA0B,aACvB,SACX,CAKQ,sBAAA8xC,CAAuBK,GAC3B,MAAM31D,EAA2B,CAC7BrX,GAAI,UAAUrQ,KAAKC,SAASsG,KAAK2U,SAASpQ,SAAS,IAAIgqE,OAAO,EAAG,KACjE/0E,UAAWC,KAAKC,SACbo9E,GAGP1jF,KAAK2hF,kBAAkBh7E,KAAKonB,GAG5B,MAAM41D,EAAgB3jF,KAAKoiE,SAASl5D,IAAIw6E,EAAWnkB,QAC/CokB,IACAA,EAAcrB,cAAc37E,KAAKonB,GAG7B41D,EAAcrB,cAAc17E,OAAS,IACrC+8E,EAAcrB,cAAcz7E,QAGxC,CAKA,gBAAA+8E,CACIX,EACAh/E,EACA4/E,EACAC,EAAsB,GACtBC,EAAoB,GAEpB,MAAM5gB,EAAUnjE,KAAKoiE,SAASl5D,IAAI+5E,GAClC,IAAK9f,EAED,OADAnjE,KAAKgJ,OAAOnD,KAAK,8CAA+C,CAAEo9E,cAC3D,KAIX,GAAuB,QAAnB9f,EAAQ6e,OAER,OADAhiF,KAAKgJ,OAAOnD,KAAK,oCAAqC,CAAEo9E,cACjD,KAGX,MAAMe,EAAY,eAAe39E,KAAKC,SAAS28E,IACzCgB,EAAqBr3E,KAAKC,MAAMs2D,EAAQ5xB,WAAa,IAErD2yC,EAA8B,CAChCxtE,GAAIstE,EACJG,aAAc,CAACnkF,KAAK4hF,kBAAmBqB,GACvCh/E,OACAmgF,aAAc,CACVC,SAAUrkF,KAAK4hF,kBACf0C,MAAOT,EACPU,WAAYvkF,KAAKwkF,oBAAoBX,GACrCY,SAAUzkF,KAAK0kF,uBAAuBzgF,EAAMk/D,IAEhDwhB,OAAQ,EACRC,UAAW,EACXxoD,OAAQ,SACR0nD,cACAC,YACAE,sBAcJ,OAVAC,EAAQW,aAAe7kF,KAAK8kF,qBAAqBZ,EAAS/gB,GAE1DnjE,KAAK0hF,aAAa34E,IAAIi7E,EAAWE,GACjClkF,KAAK+kB,OAAOggE,uBAAuBb,GAEnClkF,KAAKgJ,OAAOpD,KAAK,2BAA2Bu9D,EAAQl9D,UAAUhC,IAAQ,CAClE+gF,YAAad,EAAQE,aAAaG,WAClCU,QAASf,EAAQW,cAAcN,YAAc,IAG1CL,CACX,CAKQ,mBAAAM,CAAoBF,GACxB,IAAIC,EAAa,EA4BjB,OA1BAD,EAAMn1E,QAAQ+1E,IACV,OAAQA,EAAKjhF,MACT,IAAK,UACDsgF,GAAcW,EAAK3iE,MACnB,MACJ,IAAK,QACDgiE,GAA2B,GAAbW,EAAK3iE,MACnB,MACJ,IAAK,cACDgiE,GAA2B,GAAbW,EAAK3iE,MACnB,MACJ,IAAK,aACDgiE,GAA2B,GAAbW,EAAK3iE,MACnB,MACJ,IAAK,YACDgiE,GAA2B,IAAbW,EAAK3iE,MACnB,MACJ,IAAK,UACDgiE,GAA2B,EAAbW,EAAK3iE,MACnB,MACJ,IAAK,aACDgiE,GAA2B,GAAbW,EAAK3iE,SAKxBgiE,CACX,CAKQ,sBAAAG,CAAuBzgF,EAAuBk/D,GAClD,IAAIshB,EAAW,GAEf,OAAQxgF,GACJ,IAAK,QACDwgF,GAAwC,GAA5BthB,EAAQof,YAAYI,MAChC8B,GAAyC,GAA7BthB,EAAQvsC,UAAUurD,SAC9B,MACJ,IAAK,WACDsC,GAA8C,GAAlCthB,EAAQof,YAAYC,YAChCiC,GAAwC,GAA5BthB,EAAQof,YAAYG,MAChC,MACJ,IAAK,aACD+B,GAAsD,IAAzC,IAAMthB,EAAQvsC,UAAUwrD,eACrCqC,GAA8C,GAAlCthB,EAAQof,YAAYC,YAChC,MACJ,IAAK,eACDiC,GAAkD,GAAtCthB,EAAQof,YAAYE,gBAChCgC,GAA6C,GAAjCthB,EAAQof,YAAYpV,WAChC,MACJ,IAAK,cACDsX,GAA8C,GAAlCthB,EAAQof,YAAYC,YAChCiC,GAA0C,GAA9BthB,EAAQvsC,UAAUyrD,UAOtC,OAFAoC,GAAiC,GAArBthB,EAAQ5xB,WAEb3kC,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAKs0E,GACrC,CAKQ,oBAAAK,CAAqBZ,EAA6B/gB,GACtD,MAAMgiB,EAAmBjB,EAAQE,aAAaG,WACxCa,EAAgBplF,KAAKqlF,uBAAuBnB,EAAS/gB,GAErDmiB,EAA4B,GAGlC,GAAIF,EAAgBD,EAAkB,CAClC,MAAMI,EAAaH,EAAgBD,EAG/BhiB,EAAQof,YAAYI,MAAQ,GAC5B2C,EAAa3+E,KAAK,CACd1C,KAAM,UACNuhF,MAAOxlF,KAAK4hF,kBACZ6D,SAAUtiB,EAAQzsD,GAClBu2C,YAAa,yBAAyBs4B,YACtChjE,MAAOgjE,IAINpiB,EAAQvsC,UAAUyrD,UAAY,GACnCiD,EAAa3+E,KAAK,CACd1C,KAAM,cACNuhF,MAAOxlF,KAAK4hF,kBACZ6D,SAAUtiB,EAAQzsD,GAClBu2C,YAAa,8BACb1qC,MAAO3V,KAAKC,MAAM04E,EAAa,MAKnCD,EAAa3+E,KAAK,CACd1C,KAAM,UACNuhF,MAAOxlF,KAAK4hF,kBACZ6D,SAAUtiB,EAAQzsD,GAClBu2C,YAAa,4BACb1qC,MAAO3V,KAAKC,MAAM04E,EAAa,IAG3C,CAqBA,MAlBqB,UAAjBrB,EAAQjgF,KACRqhF,EAAa3+E,KAAK,CACd1C,KAAM,UACNuhF,MAAOriB,EAAQzsD,GACf+uE,SAAUzlF,KAAK4hF,kBACf30B,YAAa,gBACb1qC,MAAO3V,KAAKC,MAAyB,GAAnBs4E,KAEE,gBAAjBjB,EAAQjgF,MACfqhF,EAAa3+E,KAAK,CACd1C,KAAM,cACNuhF,MAAOriB,EAAQzsD,GACf+uE,SAAUzlF,KAAK4hF,kBACf30B,YAAa,0BACb1qC,MAAO3V,KAAKC,MAAMs4E,EAAmB,MAItC,CACHd,SAAUlhB,EAAQzsD,GAClB4tE,MAAOgB,EACPf,WAAYvkF,KAAKwkF,oBAAoBc,GACrCb,SAAUP,EAAQE,aAAaK,SAEvC,CAKQ,sBAAAY,CAAuBnB,EAA6B/gB,GACxD,IAAIuiB,EAAaxB,EAAQE,aAAaG,WAGtCmB,GAAe,EAAIviB,EAAQof,YAAYI,MAAQ,IAC/C+C,GAAe,EAAIviB,EAAQof,YAAYG,MAAQ,IAG/CgD,GAAe,EAAIviB,EAAQ5xB,WAAa,IAGxC,MAAMwxC,EAAgB/iF,KAAKoiE,SAASl5D,IAAIlJ,KAAK4hF,mBACvC+D,EAAaxiB,EAAQ5mC,MAAQwmD,EAAcxmD,MAGjD,OAFAmpD,GAAc94E,KAAK+D,IAAIg1E,EAAY,IAE5B/4E,KAAKC,MAAM64E,EACtB,CAKA,mBAAAE,CACI5B,EACA6B,EACAC,GAEA,MAAM5B,EAAUlkF,KAAK0hF,aAAax4E,IAAI86E,GACtC,IAAKE,GAA8B,WAAnBA,EAAQ9nD,OAAqB,OAAO,KAEpD,MAAM+mC,EAAUnjE,KAAKoiE,SAASl5D,IAAIg7E,EAAQC,aAAa,IACvD,IAAKhhB,EAAS,OAAO,KAIrB,GAFA+gB,EAAQS,SAEJkB,GAAiB3B,EAAQW,aAEzBX,EAAQ9nD,OAAS,aACjBp8B,KAAK+lF,wBAAwB7B,EAASA,EAAQW,cAC9C7kF,KAAK+kB,OAAOihE,yBAAyB9B,GAAS,GAE9ClkF,KAAKgJ,OAAOpD,KAAK,6BAA6Bu9D,EAAQl9D,aAE1D,GAAW6/E,GAAY5B,EAAQS,OAAST,EAAQU,UAAW,CAEvDV,EAAQE,aAAe,CACnBC,SAAUrkF,KAAK4hF,kBACf0C,MAAOwB,EACPvB,WAAYvkF,KAAKwkF,oBAAoBsB,GACrCrB,SAAUP,EAAQE,aAAaK,UAInC,MAAMwB,EAAejmF,KAAKkmF,4BAA4BhC,EAAS/gB,GAE3Dv2D,KAAK2U,SAAW0kE,GAChB/B,EAAQ9nD,OAAS,aACjBp8B,KAAK+lF,wBAAwB7B,EAASA,EAAQE,cAC9CpkF,KAAK+kB,OAAOihE,yBAAyB9B,GAAS,GAE9ClkF,KAAKgJ,OAAOpD,KAAK,8BAA8Bu9D,EAAQl9D,SAGvDi+E,EAAQW,aAAe7kF,KAAK8kF,qBAAqBZ,EAAS/gB,EAGlE,MAEI+gB,EAAQ9nD,OAAS,SACjBp8B,KAAKgjF,iBAAiB7f,EAAQzsD,IAAI,EAAI,sBACtC1W,KAAK+kB,OAAOihE,yBAAyB9B,GAAS,GAE9ClkF,KAAKgJ,OAAOpD,KAAK,yBAAyBu9D,EAAQl9D,QAGtD,OAAOi+E,CACX,CAKQ,2BAAAgC,CAA4BhC,EAA6B/gB,GAI7D,IAAIgjB,EAAmB,GAoBvB,OAhBAA,GAAuC,IAPpBjC,EAAQE,aAAaG,WACpBvkF,KAAKqlF,uBAAuBnB,EAAS/gB,GAMvB,GAGlCgjB,GAAoBhjB,EAAQof,YAAYC,YAAc,IACtD2D,GAAoBhjB,EAAQof,YAAYG,MAAQ,IAGhDyD,GAAoBhjB,EAAQ5xB,WAAa,IAGzC40C,GAAoBjC,EAAQJ,YAAc,IAC1CqC,GAAoBjC,EAAQH,UAAY,IAGxCoC,GAAqC,GAAjBjC,EAAQS,OAErB/3E,KAAKoC,IAAI,IAAMpC,KAAKuD,IAAI,IAAMg2E,GACzC,CAKQ,uBAAAJ,CAAwB7B,EAA6BkC,GAEzD,MAAMC,EAAenC,EAAQC,aAAahyD,KAAKzb,GAAMA,IAAO1W,KAAK4hF,mBAC7DyE,GACArmF,KAAKgjF,iBAAiBqD,EAAc,GAAI,0BAM5CrmF,KAAKqjF,uBAAuB,CACxBp/E,KAAM,QACNq/E,MAAOtjF,KAAK4hF,kBACZriB,OAAQ8mB,EACRp5B,YAAa,cAAci3B,EAAQjgF,mBACnCs/E,iBAAkB,GAClBC,YAAY,GAEpB,CAKA,uBAAA8C,CAAwBvkB,GACpB,MAAMwkB,EAAiBlwE,MAAMC,KAAKtW,KAAKoiE,SAASzpD,UAAU3Q,OAAOw+E,GAC7DA,EAAE9vE,KAAO1W,KAAK4hF,mBAAqB4E,EAAE7jD,UAGzC,GAA8B,IAA1B4jD,EAAe3/E,OAAc,OAAO,KAExC,MAAMu8D,EAAUojB,EAAe35E,KAAKC,MAAMD,KAAK2U,SAAWglE,EAAe3/E,SACnE6/E,EAAiB,CAAC,iBAAkB,gBAAiB,oBAAqB,uBAC1EC,EAAgBD,EAAe75E,KAAKC,MAAMD,KAAK2U,SAAWklE,EAAe7/E,SAEzEilE,EAAiC,CACnCn1D,GAAI,aAAarQ,KAAKC,SAAS68D,EAAQzsD,KACvCusE,UAAW9f,EAAQzsD,GACnBzS,KAAMyiF,EACNC,SAAU,IAAK5kB,GACf9U,YAAajtD,KAAK4mF,6BAA6BzjB,EAASujB,GACxDG,iBAAkB7mF,KAAK8mF,yBAAyB3jB,EAASujB,GACzDK,aAAc,GACdpkD,UAAU,EACVv8B,UAAWC,KAAKC,OAQpB,OALAtG,KAAKssE,WAAWvjE,IAAI8iE,EAAUn1D,GAAIm1D,GAClC7rE,KAAK+kB,OAAOiiE,uBAAuBnb,GAEnC7rE,KAAKgJ,OAAOpD,KAAK,4BAA4Bu9D,EAAQl9D,UAAUygF,KAExD7a,CACX,CAKQ,4BAAA+a,CAA6BzjB,EAAkBl/D,GACnD,MAAMgjF,EAAe,CACjBC,eAAgB,CACZ,KAAK/jB,EAAQl9D,0CACb,GAAGk9D,EAAQl9D,gEACX,mBAAmBk9D,EAAQl9D,4BAE/BkhF,cAAe,CACX,KAAKhkB,EAAQl9D,8CACb,GAAGk9D,EAAQl9D,+DACX,yBAAyBk9D,EAAQl9D,sBAErCmhF,kBAAmB,CACf,GAAGjkB,EAAQl9D,yCACX,KAAKk9D,EAAQl9D,0CACb,GAAGk9D,EAAQl9D,mDAEfohF,oBAAqB,CACjB,GAAGlkB,EAAQl9D,4CACX,GAAGk9D,EAAQl9D,uDACX,6BAA6Bk9D,EAAQl9D,kBAEzCqhF,cAAe,CACX,8BAA8BnkB,EAAQl9D,cACtC,GAAGk9D,EAAQl9D,gDACX,gCAAgCk9D,EAAQl9D,yBAI1CshF,EAAmBN,EAAahjF,IAASgjF,EAAaC,eAC5D,OAAOK,EAAiB36E,KAAKC,MAAMD,KAAK2U,SAAWgmE,EAAiB3gF,QACxE,CAKQ,wBAAAkgF,CAAyB3jB,EAAkBl/D,GAC/C,MAAMujF,EAAiC,CACnC,CACI9wE,GAAI,sBACJzQ,KAAM,sBACNgnD,YAAa,sDACbw6B,WAAY,CAAE3X,MAAO,iBAAkBrhD,WAAY,IACnDs4D,aAAc,CACV,CACI9iF,KAAM,aACNg/E,UAAW9f,EAAQzsD,GACnB6L,MAAO,EACP0qC,YAAa,0CAIzB,CACIv2C,GAAI,mBACJzQ,KAAM,sBACNgnD,YAAa,mDACb85B,aAAc,CACV,CACI9iF,KAAM,aACNg/E,UAAW9f,EAAQzsD,GACnB6L,OAAO,EACP0qC,YAAa,mDAO7B,OAAQhpD,GACJ,IAAK,gBACDujF,EAAY7gF,KAAK,CACb+P,GAAI,mBACJzQ,KAAM,mBACNgnD,YAAa,uCACbw6B,WAAY,CAAE3X,MAAO,cAAerhD,WAAY,IAChDs4D,aAAc,CACV,CACI9iF,KAAM,aACNg/E,UAAW9f,EAAQzsD,GACnB6L,MAAO,GACP0qC,YAAa,+CAEjB,CACIhpD,KAAM,YACNg/E,UAAW9f,EAAQzsD,GACnB6L,MAAO,IACP0qC,YAAa,sCAIzB,MAEJ,IAAK,oBACDu6B,EAAY7gF,KAAK,CACb+P,GAAI,iBACJzQ,KAAM,iBACNgnD,YAAa,2BACb85B,aAAc,CACV,CACI9iF,KAAM,oBACNg/E,UAAW9f,EAAQzsD,GACnB6L,MAAO,EACP0qC,YAAa,2BAIzB,MAEJ,IAAK,sBACDu6B,EAAY7gF,KAAK,CACb+P,GAAI,oBACJzQ,KAAM,yBACNgnD,YAAa,gEACbzM,aAAc,CACV,CAAEv8C,KAAM,aAAcse,MAAO,EAAG0qC,YAAa,wCAEjDw6B,WAAY,CAAE3X,MAAO,iBAAkBrhD,WAAY,IACnDs4D,aAAc,CACV,CACI9iF,KAAM,aACNg/E,UAAW9f,EAAQzsD,GACnB6L,MAAO,EACP0qC,YAAa,gDAiCjC,OAzBIkW,EAAQ5xB,YAAa,IACrBi2C,EAAY7gF,KAAK,CACb+P,GAAI,sBACJzQ,KAAM,iBACNgnD,YAAa,gDACbzM,aAAc,CACV,CAAEv8C,KAAM,aAAcse,MAAO,GAAI0qC,YAAa,+BAElD85B,aAAc,CACV,CACI9iF,KAAM,SACNg/E,UAAW9f,EAAQzsD,GACnB6L,MAAO,EACP0qC,YAAa,0BAEjB,CACIhpD,KAAM,aACNg/E,UAAW9f,EAAQzsD,GACnB6L,OAAO,GACP0qC,YAAa,sDAMtBu6B,CACX,CAKA,sBAAAE,CAAuBxb,EAAqByb,EAAkBC,EAAqB,IAC/E,MAAM/b,EAAY7rE,KAAKssE,WAAWpjE,IAAIgjE,GACtC,IAAKL,IAAcA,EAAUlpC,eAAiB,GAE9C,MAAM5U,EAAS89C,EAAUgb,iBAAiB10D,KAAK3lB,GAAKA,EAAEkK,KAAOixE,GAC7D,IAAK55D,EAAQ,MAAO,GAEpB,MAAMg5D,EAAuC,IAAIh5D,EAAOg5D,cAGxD,GAAIh5D,EAAO05D,WAAY,CACHG,GAAc75D,EAAO05D,WAAWh5D,WAI5Cs4D,EAAa53E,QAAQ8B,IACF,eAAXA,EAAEhN,MAAyBgN,EAAEsR,MAAQ,IACrCtR,EAAEsR,MAAQ3V,KAAKC,MAAgB,IAAVoE,EAAEsR,UAK/BwkE,EAAa53E,QAAQ8B,IACF,eAAXA,EAAEhN,OACFgN,EAAEsR,MAAQ3V,KAAKC,MAAgB,GAAVoE,EAAEsR,SAIvC,CAkCA,OA/BAwkE,EAAa53E,QAAQ04E,IACjB,GACS,eADDA,EAAY5jF,KAEZjE,KAAKgjF,iBAAiB6E,EAAY5E,UAAW4E,EAAYtlE,MAAOslE,EAAY56B,eAYxF4e,EAAUlpC,UAAW,EACrBkpC,EAAUkb,aAAeA,EAErBA,EAAa9zD,KAAKhiB,GAAgB,WAAXA,EAAEhN,MACzB4nE,EAAUic,WAAa,UAChBf,EAAa9zD,KAAKhiB,GAAgB,eAAXA,EAAEhN,MAAyBgN,EAAEsR,MAAQ,GACnEspD,EAAUic,WAAa,aAEvBjc,EAAUic,WAAa,UAG3B9nF,KAAKgJ,OAAOpD,KAAK,0BAA0B+hF,IAAY,CACnDZ,aAAcA,EAAangF,OAC3BkhF,WAAYjc,EAAUic,aAGnBf,CACX,CAKA,UAAAgB,CAAW9E,GACP,OAAOjjF,KAAKoiE,SAASl5D,IAAI+5E,IAAc,IAC3C,CAKA,cAAA+E,GACI,OAAO3xE,MAAMC,KAAKtW,KAAKoiE,SAASzpD,UAAU3Q,OAAOw+E,GAAKA,EAAE9vE,KAAO1W,KAAK4hF,kBACxE,CAKA,gBAAAqG,GACI,OAAOjoF,KAAKoiE,SAASl5D,IAAIlJ,KAAK4hF,kBAClC,CAKA,qBAAAsG,GACI,OAAO7xE,MAAMC,KAAKtW,KAAK0hF,aAAa/oE,UAAU3Q,OAAOmgF,GAAkB,WAAbA,EAAE/rD,OAChE,CAKA,mBAAAuxC,GACI,OAAOt3D,MAAMC,KAAKtW,KAAKssE,WAAW3zD,UAAU3Q,OAAOyK,GAAKA,EAAEkwB,SAC9D,CAKA,0BAAAylD,CAA2BjP,EAAgB,IACvC,OAAOn5E,KAAK2hF,kBACPl5B,KAAK,CAACj8C,EAAGhB,IAAMA,EAAEpF,UAAYoG,EAAEpG,WAC/BkC,MAAM,EAAG6wE,EAClB,CAKA,iBAAAkP,GASI,MAAMjmB,EAAWpiE,KAAKgoF,iBAChBM,EAASlmB,EAASp6D,UAAyB,WAAbw+E,EAAExE,QAAoCp7E,OACpE2hF,EAAUnmB,EAASp6D,OAAOw+E,GAAkB,YAAbA,EAAExE,QAAoD,QAAbwE,EAAExE,QAAiCp7E,OAC3G4hF,EAAgBpmB,EAAS5gC,OAAO,CAACC,EAAK+kD,IAAM/kD,EAAM+kD,EAAEj1C,WAAY,GAAK6wB,EAASx7D,OAEpF,MAAO,CACH6hF,cAAermB,EAASx7D,OACxB8hF,eAAgBJ,EAChBK,gBAAiBJ,EACjBK,mBAAoB5oF,KAAKkoF,wBAAwBthF,OACjDiiF,eAAgBxyE,MAAMC,KAAKtW,KAAKyhF,SAAS9oE,UAAU3Q,OAAO+Y,GAAkB,WAAbA,EAAEqb,QAAqBx1B,OACtFkiF,gBAAiB9oF,KAAKssE,WAAWjhE,KACjC09E,kBAAmBn8E,KAAKsE,MAAMs3E,GAEtC,CAKA,iBAAAQ,GACI,MAAO,CACH5mB,SAAU/rD,MAAMC,KAAKtW,KAAKoiE,SAAS17D,WACnC+6E,SAAUprE,MAAMC,KAAKtW,KAAKyhF,SAAS/6E,WACnCg7E,aAAcrrE,MAAMC,KAAKtW,KAAK0hF,aAAah7E,WAC3C4lE,WAAYj2D,MAAMC,KAAKtW,KAAKssE,WAAW5lE,WACvCi7E,kBAAmB3hF,KAAK2hF,kBAEhC,CAKA,iBAAAsH,CAAkBvjF,GACVA,EAAK08D,WACLpiE,KAAKoiE,SAAW,IAAIt5D,IAAIpD,EAAK08D,WAE7B18D,EAAK+7E,WACLzhF,KAAKyhF,SAAW,IAAI34E,IAAIpD,EAAK+7E,WAE7B/7E,EAAKg8E,eACL1hF,KAAK0hF,aAAe,IAAI54E,IAAIpD,EAAKg8E,eAEjCh8E,EAAK4mE,aACLtsE,KAAKssE,WAAa,IAAIxjE,IAAIpD,EAAK4mE,aAE/B5mE,EAAKi8E,oBACL3hF,KAAK2hF,kBAAoBj8E,EAAKi8E,mBAGlC3hF,KAAKgJ,OAAOpD,KAAK,2BAA4B,CACzCw8D,SAAUpiE,KAAKoiE,SAAS/2D,KACxBo2E,SAAUzhF,KAAKyhF,SAASp2E,KACxBihE,WAAYtsE,KAAKssE,WAAWjhE,MAEpC,EChtCG,IAAK69E,GAAAA,IACRA,EAAA,UAAY,YACZA,EAAA,YAAc,cACdA,EAAA,SAAW,WACXA,EAAA,WAAa,aACbA,EAAA,KAAO,OACPA,EAAA,OAAS,SACTA,EAAA,QAAU,UACVA,EAAA,QAAU,UARFA,IAAAA,GAAA,CAAA,GAgML,MAAMC,EAYT,WAAArkF,CAAYigB,EAAsB,IAXlC/kB,KAAQopF,oBAA8DtgF,IACtE9I,KAAQkpE,qBAAoDpgE,IAC5D9I,KAAQqpF,kBAAuDvgF,IAG/D9I,KAAQspF,sBAAqDxgF,IAC7D9I,KAAQupF,sBAAgEzgF,IAMpE9I,KAAKgJ,OAAS,IAAIO,EAAO,WACzBvJ,KAAK+kB,OAASA,EAEd/kB,KAAKwpF,4BACLxpF,KAAKypF,0BAELzpF,KAAKgJ,OAAOpD,KAAK,iCACrB,CAKQ,yBAAA4jF,GACJ,MAAME,EAAkC,CACpC,CACI9O,QAAS,YACT30E,KAAM,aACNgnD,YAAa,6DACb08B,WAAY,CACRt+E,KAAM,QACNgjC,YAAa,cACbu7C,SAAU,IACVt+C,YAAa,OACbu+C,YAAa,cAEjBC,QAAS,CACLhI,WAAY,eACZnpE,OAAQ,CAAC,YAAa,YAAa,QAAS,cAC5CoxE,OAAQ,CAAC,QAAS,0BAA2B,uBAC7CC,QAAS,CAAC,+BAAgC,kBAC1CC,SAAU,CAAC,sBAAuB,iBAAkB,oBAExDtgE,cAAe,CACXugE,QAAS,aACTC,UAAW,CAAC,QAA2B,mBACvCC,qBAAsB,EACtBC,sBAAuB,EACvBC,eAAgB,CAAC,WAAY,gBAAiB,iBAAkB,oBAEpExU,WAAY,CACR5wE,MAAO,GACPgxE,gBAAiB,CAAC,WAAY,mBAAoB,sBAAuB,0BACzEqU,WAAY,CAAC,qBAAsB,oBACnCC,WAAY,CAAC,mBAAoB,qBAAsB,uBACvDC,aAAc,qBAElBC,WAAY,CACRzkB,aAAc,GACd0kB,mBAAoB,EACpBC,iBAAkB,EAClBC,WAAY,UACZC,eAAgB,WAEpBC,iBAAkB,CACdb,QAAS,UACTC,UAAW,CAAC,eAAgC,YAC5Ca,mBAAoB,CAAC,2BAA4B,qBAAsB,kBACvEC,kBAAmB,CAAC,wBAAyB,sBAAuB,qBACpEC,YAAa,CAAC,UAAW,sBAAuB,kBAGxD,CACItQ,QAAS,cACT30E,KAAM,mBACNgnD,YAAa,wDACb08B,WAAY,CACRt+E,KAAM,SACNgjC,YAAa,UACbu7C,SAAU,IACVt+C,YAAa,MACbu+C,YAAa,UAEjBC,QAAS,CACLhI,WAAY,aACZnpE,OAAQ,CAAC,aAAc,QAAS,SAAU,cAC1CoxE,OAAQ,CAAC,QAAS,eAAgB,oBAClCC,QAAS,CAAC,0BAA2B,6BACrCC,SAAU,CAAC,qBAAsB,qBAAsB,yBAE3DtgE,cAAe,CACXugE,QAAS,kBACTC,UAAW,CAAC,QAA2B,gBACvCC,qBAAsB,EACtBC,sBAAuB,EACvBC,eAAgB,CAAC,qBAAsB,uBAAwB,eAEnExU,WAAY,CACR5wE,MAAO,EACPgxE,gBAAiB,CAAC,eAAgB,kBAAmB,oBAAqB,oBAC1EqU,WAAY,CAAC,qBAAsB,mBACnCC,WAAY,CAAC,kBAAmB,mBAAoB,4BACpDC,aAAc,cAElBC,WAAY,CACRzkB,aAAc,EACd0kB,mBAAoB,GACpBC,iBAAkB,EAClBC,WAAY,aACZC,eAAgB,WAEpBC,iBAAkB,CACdb,QAAS,WACTC,UAAW,CAAC,UAA2B,UACvCa,mBAAoB,CAAC,qBAAsB,sBAAuB,qBAClEC,kBAAmB,CAAC,sBAAuB,yBAA0B,kBACrEC,YAAa,CAAC,QAAS,gBAAiB,uBAGhD,CACItQ,QAAS,WACT30E,KAAM,eACNgnD,YAAa,uCACb08B,WAAY,CACRt+E,KAAM,SACNgjC,YAAa,SACbu7C,SAAU,IACVt+C,YAAa,SACbu+C,YAAa,WAEjBC,QAAS,CACLhI,WAAY,WACZnpE,OAAQ,CAAC,UAAW,cAAe,gBAAiB,UACpDoxE,OAAQ,CAAC,cAAe,cAAe,wBACvCC,QAAS,CAAC,sBAAuB,iBAAkB,2BACnDC,SAAU,CAAC,oBAAqB,qBAAsB,mBAE1DtgE,cAAe,CACXugE,QAAS,UACTC,UAAW,CAAC,aAAgC,mBAC5CC,qBAAsB,GACtBC,sBAAuB,GACvBC,eAAgB,CAAC,mBAAoB,wBAAyB,sBAAuB,eAEzFxU,WAAY,CACR5wE,MAAO,GACPgxE,gBAAiB,CAAC,mBAAoB,sBAAuB,qBAAsB,sBACnFqU,WAAY,CAAC,uBAAwB,wBACrCC,WAAY,CAAC,oBAAqB,eAAgB,yBAA0B,kBAC5EC,aAAc,qBAElBC,WAAY,CACRzkB,aAAc,GACd0kB,mBAAoB,EACpBC,iBAAkB,GAClBC,WAAY,OACZC,eAAgB,aAEpBC,iBAAkB,CACdb,QAAS,UACTC,UAAW,CAAC,UAA2B,YACvCa,mBAAoB,CAAC,2BAA4B,oBAAqB,2BACtEC,kBAAmB,CAAC,4BAA6B,iBAAkB,yBACnEC,YAAa,CAAC,uBAAwB,eAAgB,+BAG9D,CACItQ,QAAS,OACT30E,KAAM,cACNgnD,YAAa,yDACb08B,WAAY,CACRt+E,KAAM,QACNgjC,YAAa,UACbu7C,SAAU,IACVt+C,YAAa,YACbu+C,YAAa,cAEjBC,QAAS,CACLhI,WAAY,aACZnpE,OAAQ,CAAC,QAAS,aAAc,YAAa,YAC7CoxE,OAAQ,CAAC,gBAAiB,QAAS,cACnCC,QAAS,CAAC,kBAAmB,uBAAwB,6BACrDC,SAAU,CAAC,wBAAyB,qBAAsB,yBAE9DtgE,cAAe,CACXugE,QAAS,WACTC,UAAW,CAAC,aAAgC,YAC5CC,qBAAsB,EACtBC,sBAAuB,EACvBC,eAAgB,CAAC,qBAAsB,oBAAqB,kBAAmB,oBAEnFxU,WAAY,CACR5wE,MAAO,EACPgxE,gBAAiB,CAAC,gBAAiB,gBAAiB,uBAAwB,uBAC5EqU,WAAY,CAAC,qBAAsB,qBACnCC,WAAY,CAAC,eAAgB,gBAAiB,2BAA4B,sBAC1EC,aAAc,cAElBC,WAAY,CACRzkB,aAAc,EACd0kB,mBAAoB,EACpBC,iBAAkB,GAClBC,WAAY,aACZC,eAAgB,cAEpBC,iBAAkB,CACdb,QAAS,eACTC,UAAW,CAAC,aAA8B,YAC1Ca,mBAAoB,CAAC,iBAAkB,uBAAwB,yBAC/DC,kBAAmB,CAAC,iBAAkB,mBAAoB,kBAC1DC,YAAa,CAAC,qBAAsB,cAAe,4BAK/DxB,EAASv6E,QAAQg8E,IACbnrF,KAAKopF,gBAAgBrgF,IAAIoiF,EAAQvQ,QAASuQ,KAG9CnrF,KAAKgJ,OAAOpD,KAAK,kBAAkB8jF,EAAS9iF,gCAChD,CAKQ,uBAAA6iF,GACJ,IAAA,MAAW7O,KAAW3lD,OAAOtc,OAAOuwE,GAAe,CAC/C,MAAMkC,EAA4B,CAC9BxQ,UACAyQ,eAAgB,GAChBC,eAAgB,GAChBC,0BAA2B,GAC3BC,qBAAsB,GACtBT,iBAAkB,GAClBU,sBAAuB,EACvBC,sBAAuB,EACvBC,2BAA4B,EAC5BC,qBAAsB,EACtBC,cAAe,EACfC,yBAA0B,EAC1BC,kBAAmB,EACnBC,mBAAoB,EACpBC,eAAgB,EAChBC,kBAAmB,GACnB3S,qBAAsB,GACtB4S,WAAY9lF,KAAKC,OAGrBtG,KAAKqpF,cAActgF,IAAI6xE,EAASwQ,EACpC,CACJ,CAKA,iBAAAgB,CACIxR,EACAlgE,EACAzW,EAA+B,WAE/B,MAAMknF,EAAUnrF,KAAKopF,gBAAgBlgF,IAAI0xE,GACzC,IAAKuQ,EACD,MAAM,IAAInlF,MAAM,0BAA0B40E,KAG9C,MAAMwQ,EAAYprF,KAAKqpF,cAAcngF,IAAI0xE,GACnCyR,EAA6C,IAA5BjB,EAAUS,cAE3BhgB,EAA4B,CAC9Bn1D,GAAI,aAAarQ,KAAKC,SAASs0E,IAC/BA,UACA32E,KAAMooF,EAAiB,gBAAkBpoF,EACzC0iF,SAAU,IAAKjsE,GACf4xE,MAAO,WACPzjE,UAAW7oB,KAAKusF,0BAA0BpB,EAASlnF,GACnDuoF,UAAWxsF,KAAKysF,0BAA0BtB,EAASC,GACnDsB,SAAU1sF,KAAK2sF,yBAAyBxB,EAASlnF,GACjD2oF,0BAA0B,EAC1BC,gBAAiBjgF,KAAKoC,IAAI,GAAI,IAAMo8E,EAAUK,uBAC9CqB,oBAAqB1B,EAAUK,sBAC/BC,sBAAuBN,EAAUM,sBACjCqB,QAAS,GACTC,UAAW,GACXC,SAAS,EACTC,iBAAkB,GAClBC,qBAAsB,GACtBC,kBAAmB,GACnBhnF,UAAWC,KAAKC,MAChB6C,SAAU,GAed,OAZAnJ,KAAKkpE,iBAAiBngE,IAAI8iE,EAAUn1D,GAAIm1D,GAEpCwgB,GACArsF,KAAK+kB,OAAOsoE,iBAAiBzS,EAAS/O,GAG1C7rE,KAAKgJ,OAAOpD,KAAK,uBAAuBulF,EAAQllF,UAAUhC,IAAQ,CAC9DqpF,aAAcjB,EACdxjE,UAAWgjD,EAAUhjD,UACrB2jE,UAAW3gB,EAAU2gB,YAGlB3gB,CACX,CAKQ,yBAAA0gB,CAA0BpB,EAA8BlnF,GAC5D,IAAI4kB,EAAY,GAGhB,OAAQsiE,EAAQJ,iBAAiBb,SAC7B,IAAK,aACDrhE,GAAa,GACb,MACJ,IAAK,UACDA,GAAa,GACb,MACJ,IAAK,eACDA,GAAa,GACb,MACJ,IAAK,WACDA,GAAa,GAKrB,OAAQ5kB,GACJ,IAAK,gBACD4kB,GAAa,GACb,MACJ,IAAK,cACDA,GAAa,GACb,MACJ,IAAK,WACDA,GAAa,GACb,MACJ,IAAK,aACDA,GAAa,GAOrB,OAFAA,GAA4D,GAA9C,GAAKsiE,EAAQT,WAAWC,oBAE/B/9E,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAK0Y,GACrC,CAKQ,yBAAA4jE,CAA0BtB,EAA8BC,GAC5D,IAAIoB,EAAY,GAGhB,GAAIpB,EAAUS,cAAgB,EAAG,CAC7B,MAAM0B,EAAgBnC,EAAUY,mBAAqBZ,EAAUS,cAC/DW,EAAY5/E,KAAKC,MAAM2/E,GAAa,EAAIe,GAC5C,CAWA,OARIpC,EAAQJ,iBAAiBC,mBAAmBnzE,SAAS,sBACrD20E,GAAa,IAGwB,iBAArCrB,EAAQJ,iBAAiBb,UACzBsC,GAAa,IAGV5/E,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAKq8E,GACrC,CAKQ,wBAAAG,CAAyBxB,EAA8BlnF,GAC3D,IAAIyoF,EAAW,GAGf,OAAQvB,EAAQJ,iBAAiBb,SAC7B,IAAK,UACDwC,GAAY,GACZ,MACJ,IAAK,UACDA,GAAY,GACZ,MACJ,IAAK,SACDA,GAAY,GACZ,MACJ,IAAK,eACDA,GAAY,GAKpB,OAAQzoF,GACJ,IAAK,aACDyoF,GAAY,GACZ,MACJ,IAAK,gBACDA,GAAY,GACZ,MACJ,IAAK,QACDA,GAAY,GAIpB,OAAO9/E,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAKu8E,GACrC,CAKA,mBAAAc,CACIthB,EACAuhB,EACA5kE,EACAxK,GAEA,MAAMwtD,EAAY7rE,KAAKkpE,iBAAiBhgE,IAAIgjE,GAC5C,IAAKL,EACD,MAAM,IAAI7lE,MAAM,wBAAwBkmE,KAG5C,MAAMif,EAAUnrF,KAAKopF,gBAAgBlgF,IAAI2iE,EAAU+O,SAG7C7sD,EAAsB,CACxBrX,GAAI,UAAUrQ,KAAKC,QACnBrC,KAAMwpF,EACNxgC,YAAajtD,KAAK0tF,0BAA0BD,EAAY5kE,EAAWxK,GACnEjY,UAAWC,KAAKC,MAChBuiB,YACA8kE,WAAY3tF,KAAK4tF,0BAA0BH,GAC3CI,KAAM7tF,KAAK8tF,oBAAoBL,EAAY5hB,GAC3CkiB,iBAAkB/tF,KAAKguF,qBAAqB7C,EAASsC,GACrDQ,gBAAiB5vE,GAGrBwtD,EAAUkhB,QAAQpmF,KAAKonB,GAGvB,MAAMmgE,EAAWluF,KAAKmuF,sBAAsBtiB,EAAW99C,EAAQo9D,GAW/D,OAVAtf,EAAUmhB,UAAUrmF,KAAKunF,GAGzBluF,KAAKouF,qBAAqBviB,EAAW99C,EAAQmgE,EAAU/C,GAEvDnrF,KAAKgJ,OAAOxD,MAAM,wBAAwBioF,OAAgBS,EAASjqF,OAAQ,CACvE22E,QAAS/O,EAAU+O,QACnB/xD,UAAWqlE,EAASrlE,YAGjBqlE,CACX,CAKQ,yBAAAR,CACJzpF,EACA4kB,EACAxK,GAEA,MA2CMkpE,EA3Ce,CACjB8G,KAAM,CACF,kCACA,oCACA,sCAEJC,YAAa,CACT,wCACA,4CACA,uCAEJC,SAAU,CACN,gCACA,qCACA,kCAEJhmB,QAAS,CACL,+BACA,8BACA,mCAEJimB,KAAM,CACF,iCACA,gCACA,+BAEJC,YAAa,CACT,wCACA,qCACA,kCAEJC,SAAU,CACN,6BACA,+BACA,qCAEJC,MAAO,CACH,0BACA,4BACA,8BAI8B1qF,IAAS,CAAC,kBAChD,IAAIgpD,EAAcs6B,EAAiB36E,KAAKC,MAAMD,KAAK2U,SAAWgmE,EAAiB3gF,SAY/E,OAVIiiB,EAAY,GACZokC,GAAe,uBACRpkC,EAAY,KACnBokC,GAAe,eAGf5uC,IACA4uC,GAAe,KAAK5uC,MAGjB4uC,CACX,CAKQ,yBAAA2gC,CAA0B3pF,GAY9B,MAXmB,CACfoqF,KAAM,EACNC,YAAa,EACbC,SAAU,EACVhmB,QAAS,EACTimB,KAAM,EACNC,YAAa,EACbC,SAAU,EACVC,MAAO,GAGO1qF,IAAS,CAC/B,CAKQ,mBAAA6pF,CAAoB7pF,EAA2B4nE,GACnD,IAAIgiB,EAAO,EAEX,OAAQ5pF,GACJ,IAAK,WACD4pF,EAAO,GACP,MACJ,IAAK,QACDA,EAAO,GACP,MACJ,IAAK,WACDA,EAAO,GACP,MACJ,IAAK,cACDA,EAAO,GACP,MACJ,IAAK,OACDA,EAAO,GACP,MACJ,QACIA,EAAO,GAMf,OAFAA,GAA8B,GAAtBhiB,EAAU2gB,UAEX5/E,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAK09E,GACrC,CAKQ,oBAAAG,CAAqB7C,EAA8BsC,GACvD,MAAMT,EAAsB,GAG5B,OAAQS,GACJ,IAAK,cACDT,EAAUrmF,KAAK,wBAAyB,iBAAkB,sBAC1D,MACJ,IAAK,OACDqmF,EAAUrmF,KAAK,eAAgB,cAAe,0BAC9C,MACJ,IAAK,WACDqmF,EAAUrmF,KAAK,oBAAqB,iBAAkB,WACtD,MACJ,IAAK,WACDqmF,EAAUrmF,KAAK,iBAAkB,oBAAqB,kBAK9D,OAAQwkF,EAAQJ,iBAAiBb,SAC7B,IAAK,aACD8C,EAAUrmF,KAAK,sBAAuB,uBACtC,MACJ,IAAK,UACDqmF,EAAUrmF,KAAK,sBAAuB,iBACtC,MACJ,IAAK,UACDqmF,EAAUrmF,KAAK,eAAgB,sBAIvC,OAAOqmF,CACX,CAKQ,qBAAAmB,CACJtiB,EACA99C,EACAo9D,GAEA,IAAIyD,EAAsC,UACtC/lE,EAAY,GACZokC,EAAc,GACd4hC,EAAiB,GAGrB,MAAMC,EAAa9uF,KAAK+uF,eAAehhE,EAAQo9D,EAAStf,GAaxD,OAXA+iB,EAAeE,EAAW7qF,KAC1B4kB,EAAYimE,EAAWjmE,UAGvBokC,EAAcjtD,KAAKgvF,4BAA4BJ,EAAczD,EAASp9D,GAGlE+gE,EAAWG,iBACXJ,EAAiBC,EAAWG,gBAGzB,CACHtH,SAAU55D,EAAOrX,GACjBzS,KAAM2qF,EACN3hC,cACApkC,YACAgmE,iBACAK,mBAAoBlvF,KAAKmvF,iCAAiCtjB,EAAWsf,GAE7E,CAKQ,cAAA4D,CACJhhE,EACAo9D,EACAtf,GAEA,IAAIijB,EAAa,CAAE7qF,KAAM,UAAoC4kB,UAAW,IAGxE,MAAMumE,EAAWpvF,KAAKqvF,sBAAsBthE,EAAQo9D,GACpD,GAAIiE,EAAS7G,QAAQ3hF,OAAS,EAG1B,OAFAkoF,EAAW7qF,KAAO,UAClB6qF,EAAWjmE,UAAY,GAChB,IAAKimE,EAAYG,eAAgBG,EAAS7G,QAAQ,IAG7D,GAAI6G,EAASE,SAAS1oF,OAAS,EAG3B,OAFAkoF,EAAW7qF,KAAO,WAClB6qF,EAAWjmE,UAAY,GAChB,IAAKimE,EAAYG,eAAgBG,EAASE,SAAS,IAI9D,OAAQnE,EAAQJ,iBAAiBb,SAC7B,IAAK,UACmB,gBAAhBn8D,EAAO9pB,MAA0C,gBAAhB8pB,EAAO9pB,OACxC6qF,EAAW7qF,KAAO,UAClB6qF,EAAWjmE,UAAY,GAAwB,GAAnBkF,EAAOlF,WAEvC,MAEJ,IAAK,aACmB,aAAhBkF,EAAO9pB,MACP6qF,EAAW7qF,KAAO,UAClB6qF,EAAWjmE,UAAY,IACA,aAAhBkF,EAAO9pB,OACd6qF,EAAW7qF,KAAO,WAClB6qF,EAAWjmE,UAAY,IAE3B,MAEJ,IAAK,UACmB,UAAhBkF,EAAO9pB,MAAoC,gBAAhB8pB,EAAO9pB,OAClC6qF,EAAW7qF,KAAO,UAClB6qF,EAAWjmE,UAAY,GAAyB,EAApBkF,EAAO4/D,YAEvC,MAEJ,IAAK,eACmB,aAAhB5/D,EAAO9pB,MACP6qF,EAAW7qF,KAAO,WAClB6qF,EAAWjmE,UAAY,IACA,YAAhBkF,EAAO9pB,OACd6qF,EAAW7qF,KAAO,WAClB6qF,EAAWjmE,UAAY,IASnC,OAHAimE,EAAWjmE,WAAmC,GAAtBgjD,EAAU2gB,UAClCsC,EAAWjmE,WAAkC,GAArBgjD,EAAU6gB,SAE3BoC,CACX,CAKQ,qBAAAO,CAAsBthE,EAAqBo9D,GAI/C,MAAMiE,EAAW,CAAE7G,QAAS,GAAgB+G,SAAU,IAgBtD,OAbAnE,EAAQJ,iBAAiBC,mBAAmB77E,QAAQogF,IAC5CvvF,KAAKwvF,qBAAqBzhE,EAAQwhE,IAClCH,EAAS7G,QAAQ5hF,KAAK4oF,KAK9BpE,EAAQJ,iBAAiBE,kBAAkB97E,QAAQe,IAC3ClQ,KAAKyvF,oBAAoB1hE,EAAQ7d,IACjCk/E,EAASE,SAAS3oF,KAAKuJ,KAIxBk/E,CACX,CAKQ,oBAAAI,CAAqBzhE,EAAqBwhE,GAS9C,MARgB,CACZG,eAAkC,aAAhB3hE,EAAO9pB,KACzB0rF,sBAAyC,aAAhB5hE,EAAO9pB,MAAuB8pB,EAAOlF,UAAY,GAC1E+mE,oBAAuC,UAAhB7hE,EAAO9pB,MAAoB8pB,EAAOlF,UAAY,GACrEgnE,yBAA4C,gBAAhB9hE,EAAO9pB,MAA0B8pB,EAAOlF,UAAY,GAChFinE,iBAAoC,SAAhB/hE,EAAO9pB,MAAmC,UAAhB8pB,EAAO9pB,MAGjCsrF,KAAY,CACxC,CAKQ,mBAAAE,CAAoB1hE,EAAqB7d,GAS7C,MARgB,CACZ6/E,oBAAuC,SAAhBhiE,EAAO9pB,MAAoC,gBAAhB8pB,EAAO9pB,MAA0B8pB,EAAOlF,UAAY,GACtGmnE,kBAAqC,gBAAhBjiE,EAAO9pB,WAAqD,IAA3B8pB,EAAOkgE,gBAC7DgC,sBAAyC,gBAAhBliE,EAAO9pB,MAA0B8pB,EAAO4/D,WAAa,EAC9EuC,sBAAyC,SAAhBniE,EAAO9pB,MAAmB8pB,EAAOkgE,iBAAiBp2E,SAAS,cACpFs4E,eAAkC,SAAhBpiE,EAAO9pB,MAAmC,gBAAhB8pB,EAAO9pB,MAG/BiM,KAAW,CACvC,CAKQ,2BAAA8+E,CACJ/qF,EACAknF,EACAp9D,GAEA,MAAMqiE,EAAcjF,EAAQllF,KAEtBghF,EAAe,CACjBqI,SAAU,CACN,GAAGc,2CACH,uDACA,GAAGA,4CAEPC,SAAU,CACN,GAAGD,oCACH,6DACA,GAAGA,mDAEPE,QAAS,CACL,GAAGF,4DACH,6DACA,GAAGA,gDAEP7H,QAAS,CACL,GAAG6H,qCACH,wCACA,GAAGA,6CAEPG,SAAU,CACN,GAAGH,sDACH,kDACA,GAAGA,uDAEPI,QAAS,CACL,GAAGJ,sCACH,0CACA,GAAGA,4CAIL7I,EAAmBN,EAAahjF,IAASgjF,EAAauJ,QAC5D,OAAOjJ,EAAiB36E,KAAKC,MAAMD,KAAK2U,SAAWgmE,EAAiB3gF,QACxE,CAKQ,gCAAAuoF,CAAiCtjB,EAA2Bsf,GAChE,MAAMsF,EAAS,GAYf,OAVI5kB,EAAU2gB,UAAY,GAAIiE,EAAO9pF,KAAK,qBACjCklE,EAAU2gB,UAAY,IAAIiE,EAAO9pF,KAAK,YAE3CklE,EAAU6gB,SAAW,GAAI+D,EAAO9pF,KAAK,cAChCklE,EAAU6gB,SAAW,IAAI+D,EAAO9pF,KAAK,cAE1CklE,EAAUhjD,UAAY,GAAI4nE,EAAO9pF,KAAK,YACjCklE,EAAUhjD,UAAY,IAAI4nE,EAAO9pF,KAAK,QAGvCwkF,EAAQJ,iBAAiBb,SAC7B,IAAK,UACDuG,EAAO9pF,KAAK,cACZ,MACJ,IAAK,UACD8pF,EAAO9pF,KAAK,eACZ,MACJ,IAAK,aACD8pF,EAAO9pF,KAAK,eAIpB,OAAO8pF,EAAO7pF,OAAS,EAAI6pF,EAAOrqC,KAAK,MAAQ,SACnD,CAKQ,oBAAAgoC,CACJviB,EACA99C,EACAmgE,EACA/C,GAGA,OAAQ+C,EAASjqF,MACb,IAAK,WACD4nE,EAAU2gB,UAAY5/E,KAAKoC,IAAI,EAAG68D,EAAU2gB,UAAY,IACxD,MACJ,IAAK,WACD3gB,EAAU2gB,UAAY5/E,KAAKuD,IAAI,IAAK07D,EAAU2gB,UAAY,IAC1D,MACJ,IAAK,UACD3gB,EAAU2gB,UAAY5/E,KAAKuD,IAAI,IAAK07D,EAAU2gB,UAAY,IAK9Dz+D,EAAO4/D,WAAa,IACpB9hB,EAAU6gB,SAAW9/E,KAAKuD,IAAI,IAAK07D,EAAU6gB,SAAW,KAIxC,gBAAhB3+D,EAAO9pB,OACP4nE,EAAUihB,oBAAsBlgF,KAAKuD,IAAI,IAAK07D,EAAUihB,oBAAsB,GAC9EjhB,EAAUghB,gBAAkBjgF,KAAKoC,IAAI,EAAG68D,EAAUghB,gBAAkB,GAEhEhhB,EAAUihB,oBAAsB,KAAOjhB,EAAU+gB,2BACjD/gB,EAAU+gB,0BAA2B,EACrC5sF,KAAK+kB,OAAO2rE,8BAA8B7kB,EAAU+O,QAASuQ,EAAQxhE,cAAcugE,WAKvFn8D,EAAOkgE,kBACPpiB,EAAU6f,sBAAwB9+E,KAAKuD,IAAI,IAAK07D,EAAU6f,sBAAwB,IAItF1rF,KAAK2wF,qBAAqB9kB,GAG1B7rE,KAAK4wF,oBAAoB/kB,EAAW99C,EAAQmgE,EAAU/C,EAC1D,CAKQ,oBAAAwF,CAAqB9kB,GACzB,MAAMglB,EAAWhlB,EAAUygB,MAEH,aAApBzgB,EAAUygB,OAAwBzgB,EAAUkhB,QAAQnmF,OAAS,EAC7DilE,EAAUygB,MAAQ,UACS,YAApBzgB,EAAUygB,OAAuBzgB,EAAU+gB,yBAClD/gB,EAAUygB,MAAQ,gBACS,kBAApBzgB,EAAUygB,OAA6BzgB,EAAU6f,sBAAwB,GAChF7f,EAAUygB,MAAQ,cACXzgB,EAAU2gB,UAAY,IAAM3gB,EAAU6gB,SAAW,KACxD7gB,EAAUygB,MAAQ,aAClBzgB,EAAUohB,SAAU,GAGpB4D,IAAahlB,EAAUygB,OACvBtsF,KAAKgJ,OAAOpD,KAAK,+BAA+BirF,OAAchlB,EAAUygB,QAEhF,CAKQ,mBAAAsE,CACJ/kB,EACA99C,EACAmgE,EACA/C,GAEA,MAAMC,EAAYprF,KAAKqpF,cAAcngF,IAAI2iE,EAAU+O,SAGnDwQ,EAAUS,cAAgBj/E,KAAKoC,IAAIo8E,EAAUS,cAAe,GAEtC,aAAlBqC,EAASjqF,MAAyC,YAAlBiqF,EAASjqF,KACzCmnF,EAAUY,qBACe,YAAlBkC,EAASjqF,MAChBmnF,EAAUW,oBAGVlgB,EAAU+gB,0BACVxB,EAAUU,2BAIdV,EAAUK,sBAAwB7+E,KAAKoC,IAAIo8E,EAAUK,sBAAuB5f,EAAUihB,qBACtF1B,EAAUM,sBAAwB9+E,KAAKoC,IAAIo8E,EAAUM,sBAAuB7f,EAAU6f,uBAGlFwC,EAASW,iBAAmBzD,EAAUE,eAAezzE,SAASq2E,EAASW,kBACvEzD,EAAUE,eAAe3kF,KAAKunF,EAASW,gBACvChjB,EAAUuhB,kBAAkBzmF,KAAKunF,EAASW,gBAC1C7uF,KAAK+kB,OAAO+rE,oBAAoBjlB,EAAU+O,QAASsT,EAASW,iBAIhEzD,EAAUa,gBAAkBl+D,EAAO4/D,WAEnCvC,EAAUe,WAAa9lF,KAAKC,KAChC,CAKA,YAAAyqF,CAAa7kB,GACT,OAAOlsE,KAAKkpE,iBAAiBhgE,IAAIgjE,IAAgB,IACrD,CAKA,mBAAAyB,GACI,OAAOt3D,MAAMC,KAAKtW,KAAKkpE,iBAAiBvwD,SAC5C,CAKA,iBAAAq4E,CAAkBpW,GACd,OAAO56E,KAAKopF,gBAAgBlgF,IAAI0xE,IAAY,IAChD,CAKA,mBAAAqW,CAAoBrW,GAChB,OAAO56E,KAAKqpF,cAAcngF,IAAI0xE,IAAY,IAC9C,CAKA,eAAAsW,GACI,OAAO76E,MAAMC,KAAKtW,KAAKqpF,cAAc/zE,QAAQtN,OAAO4yE,GAC9B56E,KAAKqpF,cAAcngF,IAAI0xE,GACxBiR,cAAgB,EAEzC,CAKA,iBAAAsF,CAAkBjlB,GACd,MAAML,EAAY7rE,KAAKkpE,iBAAiBhgE,IAAIgjE,GAC5C,IAAKL,EAAW,OAAO,KAUvB,GARAA,EAAU1iE,SAAW9C,KAAKC,MAAQulE,EAAUzlE,UAGxCylE,EAAU2gB,UAAY,IAAM3gB,EAAU6gB,SAAW,KACjD7gB,EAAUohB,SAAU,GAIpBphB,EAAUohB,QAAS,CACnB,MAAM9B,EAAUnrF,KAAKopF,gBAAgBlgF,IAAI2iE,EAAU+O,SACnD56E,KAAKoxF,sBAAsBvlB,EAAWsf,EAC1C,CAUA,OARAnrF,KAAKkpE,iBAAiB9/D,OAAO8iE,GAE7BlsE,KAAKgJ,OAAOpD,KAAK,2BAA2BimE,EAAU+O,UAAW,CAC7DqS,QAASphB,EAAUohB,QACnB9jF,SAAU0iE,EAAU1iE,SAAW,IAC/BkoF,gBAAiBxlB,EAAUqhB,iBAAiBtmF,SAGzCilE,CACX,CAKQ,qBAAAulB,CAAsBvlB,EAA2Bsf,GACrD,MAAMC,EAAYprF,KAAKqpF,cAAcngF,IAAI2iE,EAAU+O,SAGnD,GAAI/O,EAAU6f,sBAAwB,GAAI,CACtC,MAAM4F,EAAgBnG,EAAQrV,WAAWI,gBAAgBluE,OAAO6sE,IAC3DuW,EAAU7R,qBAAqB1hE,SAASg9D,IAG7C,GAAIyc,EAAc1qF,OAAS,EAAG,CAC1B,MAAM2qF,EAAUD,EAAc1kF,KAAKC,MAAMD,KAAK2U,SAAW+vE,EAAc1qF,SACvEwkF,EAAU7R,qBAAqB5yE,KAAK4qF,GACpC1lB,EAAUshB,qBAAqBxmF,KAAK4qF,GACpCvxF,KAAK+kB,OAAOysE,yBAAyB3lB,EAAU+O,QAAS2W,EAC5D,CACJ,CAMA,GAHAnG,EAAUa,gBAAkBpgB,EAAU6f,sBAAwB7f,EAAUihB,oBAGpEjhB,EAAU6f,sBAAwB,IAAMN,EAAUc,kBAAkBtlF,OAAS,EAAG,CAChF,MACM6qF,EADc,CAAC,iBAAkB,uBAAwB,kBAAmB,yBACpDrG,EAAUc,kBAAkBtlF,QAC1DwkF,EAAUc,kBAAkBvlF,KAAK8qF,GACjC5lB,EAAUqhB,iBAAiBvmF,KAAK8qF,EACpC,CACJ,CAKA,eAAAC,GASI,MAAMC,EAAe3xF,KAAKkxF,kBAC1B,IAAIpI,EAAkB,EAClB8I,EAAqB,EACrB7F,EAAoB,EACpB8F,EAAiB,EACjBtY,EAAuB,EAE3B,IAAA,MAAW6R,KAAaprF,KAAKqpF,cAAc1wE,SACvCmwE,GAAmBsC,EAAUS,cAC7B+F,GAAsBxG,EAAUU,yBAChCC,GAAqBX,EAAUW,kBAC/B8F,GAAkBzG,EAAUa,eAC5B1S,GAAwB6R,EAAU7R,qBAAqB3yE,OAG3D,MAAO,CACHkiF,kBACA5f,iBAAkBlpE,KAAKkpE,iBAAiB79D,KACxCsmF,aAAcA,EAAa/qF,OAC3BgrF,qBACA7F,oBACA8F,iBACAtY,uBAER,CAKA,eAAAuY,GACI,MAAO,CACH5oB,iBAAkB7yD,MAAMC,KAAKtW,KAAKkpE,iBAAiBxiE,WACnD2iF,cAAehzE,MAAMC,KAAKtW,KAAKqpF,cAAc3iF,WAC7C4iF,kBAAmBjzE,MAAMC,KAAKtW,KAAKspF,kBAAkB5iF,WACrD6iF,kBAAmBlzE,MAAMC,KAAKtW,KAAKupF,kBAAkB7iF,WAE7D,CAKA,eAAAqrF,CAAgBrsF,GACRA,EAAKwjE,mBACLlpE,KAAKkpE,iBAAmB,IAAIpgE,IAAIpD,EAAKwjE,mBAErCxjE,EAAK2jF,gBACLrpF,KAAKqpF,cAAgB,IAAIvgF,IAAIpD,EAAK2jF,gBAElC3jF,EAAK4jF,oBACLtpF,KAAKspF,kBAAoB,IAAIxgF,IAAIpD,EAAK4jF,oBAEtC5jF,EAAK6jF,oBACLvpF,KAAKupF,kBAAoB,IAAIzgF,IAAIpD,EAAK6jF,oBAG1CvpF,KAAKgJ,OAAOpD,KAAK,0BAA2B,CACxC0mE,WAAYtsE,KAAKkpE,iBAAiB79D,KAClCsmF,aAAc3xF,KAAKkxF,kBAAkBtqF,QAE7C,EC/sCG,MAAMorF,EAgCT,WAAAltF,CAAYigB,EAA4B,IA9BxC/kB,KAAQiyF,QAAgC,GAExCjyF,KAAQkyF,WAAqB,IAG7BlyF,KAAQmyF,eAAyB,EACjCnyF,KAAQoyF,cAAwB,EAChCpyF,KAAQqyF,WAAuB,GAC/BryF,KAAQsyF,WAAqB,EAC7BtyF,KAAQuyF,SAAmB,EAG3BvyF,KAAQwyF,eAA6C,KAYrDxyF,KAAQyyF,sBAAgC,EACxCzyF,KAAQ0yF,qBAA+B,IAMnC1yF,KAAKgJ,OAAS,IAAIO,EAAO,sBACzBvJ,KAAK+kB,OAASA,EACd/kB,KAAKS,SAAWkE,EAAiB5E,SAGjCC,KAAK2yF,WAAa3yF,KAAK4yF,uBAGvB5yF,KAAKg1B,SAAWh1B,KAAK6yF,qBAGrB7yF,KAAK8yF,eAAiB9yF,KAAK+yF,qBAE3B/yF,KAAKgJ,OAAOpD,KAAK,qCACrB,CAKA,UAAA+E,GACI3K,KAAKgzF,sBACLhzF,KAAKizF,kBAGDjzF,KAAKg1B,SAASk+D,cACdlzF,KAAKmzF,yBAGTnzF,KAAKgJ,OAAOpD,KAAK,oCACrB,CAKQ,mBAAAotF,GACJ,GAAI,wBAAyB9yF,OACzB,IACIF,KAAKwyF,eAAiB,IAAIY,oBAAqBC,IAC3C,IAAA,MAAWltF,KAASktF,EAAKvrF,aACjB3B,EAAMmtF,YAMlBtzF,KAAKwyF,eAAee,QAAQ,CAAEC,WAAY,CAAC,YAC/C,OAAS1tF,GACL9F,KAAKgJ,OAAOnD,KAAK,kCAAmCC,EACxD,CAER,CAKQ,eAAAmtF,GAEJjzF,KAAKmyF,eAAiBjvF,YAAYoD,MAClCtG,KAAKoyF,cAAgBpyF,KAAKmyF,cAC9B,CAKA,MAAA39E,CAAOC,GACH,MAAMnO,EAAMpD,YAAYoD,MAGxBtG,KAAKyzF,kBAAkBntF,EAAKmO,GAG5BzU,KAAK0zF,oBAGL1zF,KAAK2zF,sBAGL3zF,KAAK4zF,qBAAqBttF,GAG1BtG,KAAK6zF,eAGL7zF,KAAK8zF,kBAGD9zF,KAAKg1B,SAASk+D,cAAgB5sF,EAAMtG,KAAKyyF,sBAAwBzyF,KAAK0yF,uBACtE1yF,KAAK+zF,2BACL/zF,KAAKyyF,sBAAwBnsF,GAIjCtG,KAAK+kB,OAAOivE,sBAAsBh0F,KAAK8yF,eAC3C,CAKQ,iBAAAW,CAAkBntF,EAAamO,GACnC,MAAMw/E,EAAY3tF,EAAMtG,KAAKmyF,eAO7B,GANAnyF,KAAKmyF,eAAiB7rF,EAGtBtG,KAAKsyF,aACLtyF,KAAKuyF,UAAY99E,EAEbzU,KAAKuyF,UAAY,IAAM,CACvB,MAAM2B,EAAMl0F,KAAKsyF,YAActyF,KAAKuyF,SAAW,KAC/CvyF,KAAKqyF,WAAW1rF,KAAKutF,GAEjBl0F,KAAKqyF,WAAWzrF,OAAS,IACzB5G,KAAKqyF,WAAWxrF,QAGpB7G,KAAKsyF,WAAa,EAClBtyF,KAAKuyF,SAAW,CACpB,CAEAvyF,KAAK8yF,eAAemB,UAAYA,EAChCj0F,KAAK8yF,eAAer+E,UAAYA,EAChCzU,KAAK8yF,eAAeoB,IAAMl0F,KAAKm0F,eACnC,CAKQ,iBAAAT,GACJ,GAAI,WAAYxwF,YAAa,CACzB,MAAMkxF,EAAUlxF,YAAoBkxF,OAEpCp0F,KAAK8yF,eAAeuB,WAAaD,EAAOE,eAAiB,KAAO,KAChEt0F,KAAK8yF,eAAeyB,YAAcH,EAAOI,gBAAkB,KAAO,KAClEx0F,KAAK8yF,eAAe2B,iBAAoBz0F,KAAK8yF,eAAeuB,WAAar0F,KAAK8yF,eAAeyB,YAAe,GAChH,MAEIv0F,KAAK8yF,eAAeuB,WAAar0F,KAAK00F,sBACtC10F,KAAK8yF,eAAeyB,YAAcv0F,KAAK20F,sBACvC30F,KAAK8yF,eAAe2B,iBAAoBz0F,KAAK8yF,eAAeuB,WAAar0F,KAAK8yF,eAAeyB,YAAe,GAEpH,CAKQ,mBAAAZ,GAGJ3zF,KAAK8yF,eAAe8B,SAAWhoF,KAAKuD,IAAI,IAAMnQ,KAAK8yF,eAAemB,WAD1C,IAAO,IACkE,KAG7F,eAAgB7yF,WACfA,UAAkByzF,aAAaC,KAAMC,IAClC/0F,KAAK8yF,eAAekC,aAA+B,IAAhBD,EAAQ7vF,QAC5CozB,MAAM,QAMbt4B,KAAK8yF,eAAemC,aAAej1F,KAAKk1F,sBAC5C,CAKQ,oBAAAtB,CAAqBttF,GACzBtG,KAAK8yF,eAAe1sF,UAAYE,CACpC,CAKQ,YAAAutF,GACJ7zF,KAAKiyF,QAAQtrF,KAAK,IAAK3G,KAAK8yF,iBAExB9yF,KAAKiyF,QAAQrrF,OAAS5G,KAAKkyF,YAC3BlyF,KAAKiyF,QAAQprF,OAErB,CAKQ,eAAAitF,GAEA9zF,KAAK8yF,eAAeoB,IAAMl0F,KAAK2yF,WAAWuB,IAAIiB,MAC9Cn1F,KAAK+kB,OAAOqwE,sBAAsB,MAAOp1F,KAAK8yF,eAAeoB,IAAKl0F,KAAK2yF,WAAWuB,IAAIiB,MAItFn1F,KAAK8yF,eAAe2B,iBAAmBz0F,KAAK2yF,WAAWyB,OAAOluF,UAC9DlG,KAAK+kB,OAAOqwE,sBAAsB,SAAUp1F,KAAK8yF,eAAe2B,iBAAkBz0F,KAAK2yF,WAAWyB,OAAOluF,UAIzGlG,KAAK8yF,eAAemB,UAAYj0F,KAAK2yF,WAAWsB,UAAU/tF,UAC1DlG,KAAK+kB,OAAOqwE,sBAAsB,YAAap1F,KAAK8yF,eAAemB,UAAWj0F,KAAK2yF,WAAWsB,UAAU/tF,SAEhH,CAKQ,wBAAA6tF,GACJ,MAAMsB,EAAkBr1F,KAAKs1F,sCAEzBD,EAAgBzuF,OAAS,IACzB5G,KAAK+kB,OAAOwwE,4BAA4BF,GAGxCA,EAAgBlmF,QAAQqmF,IAChBA,EAAIC,gBAAmC,aAAjBD,EAAIr2D,UAC1Bn/B,KAAK01F,oBAAoBF,KAIzC,CAKQ,mCAAAF,GACJ,MAAMD,EAAgD,GAoFtD,OAjFIr1F,KAAK8yF,eAAeoB,IAAMl0F,KAAK2yF,WAAWuB,IAAIyB,aAC1C31F,KAAKg1B,SAASxxB,YAAc,KAC5B6xF,EAAgB1uF,KAAK,CACjBumD,SAAU,YACV/tB,SAAU,UACVsb,MAAO,sBACPwS,YAAa,gDACbvjC,OAAQ,OACRsL,SAAU,CAAExxB,YAAaoJ,KAAKoC,IAAI,GAAKhP,KAAKg1B,SAASxxB,YAAc,MACnEiyF,eAAgBz1F,KAAK8yF,eAAeoB,IAAMl0F,KAAK2yF,WAAWuB,IAAIiB,OAIhC,QAAlCn1F,KAAKg1B,SAAS4gE,iBACdP,EAAgB1uF,KAAK,CACjBumD,SAAU,YACV/tB,SAAU,UACVsb,MAAO,0BACPwS,YAAa,wDACbvjC,OAAQ,SACRsL,SAAU,CAAE4gE,gBAAiB,OAC7BH,eAAgBz1F,KAAK8yF,eAAeoB,IAAMl0F,KAAK2yF,WAAWuB,IAAIiB,OAIlEn1F,KAAKg1B,SAAS6gE,gBACdR,EAAgB1uF,KAAK,CACjBumD,SAAU,YACV/tB,SAAU,OACVsb,MAAO,0BACPwS,YAAa,0DACbvjC,OAAQ,SACRsL,SAAU,CAAE6gE,gBAAgB,GAC5BJ,gBAAgB,KAMxBz1F,KAAK8yF,eAAe2B,iBAAmBz0F,KAAK2yF,WAAWyB,OAAO0B,OAC9DT,EAAgB1uF,KAAK,CACjBumD,SAAU,SACV/tB,SAAU,UACVsb,MAAO,uBACPwS,YAAa,iDACbvjC,OAAQ,MACRsL,SAAU,CAAE+gE,gBAAiBnpF,KAAKoC,IAAI,EAAGhP,KAAKg1B,SAAS+gE,gBAAkB,IACzEN,eAAgBz1F,KAAK8yF,eAAe2B,iBAAmBz0F,KAAK2yF,WAAWyB,OAAOluF,WAGlFmvF,EAAgB1uF,KAAK,CACjBumD,SAAU,SACV/tB,SAAU,UACVsb,MAAO,sBACPwS,YAAa,+CACbvjC,OAAQ,SACRsL,SAAU,CAAEghE,kBAAqD,GAAlCh2F,KAAKg1B,SAASghE,mBAC7CP,eAAgBz1F,KAAK8yF,eAAe2B,iBAAmBz0F,KAAK2yF,WAAWyB,OAAOluF,YAKlFlG,KAAKS,WAAaZ,EAASwK,SACtBrK,KAAKg1B,SAASihE,oBAAsBj2F,KAAK8yF,eAAekC,cAAgBh1F,KAAK8yF,eAAekC,aAAe,IAC5GK,EAAgB1uF,KAAK,CACjBumD,SAAU,UACV/tB,SAAU,OACVsb,MAAO,wBACPwS,YAAa,oDACbvjC,OAAQ,SACRsL,SAAU,CACNihE,oBAAoB,EACpBzyF,YAAa,IACboyF,gBAAiB,MACjBM,aAAc,OAElBT,gBAAgB,IAKrBJ,CACX,CAKA,mBAAAK,CAAoBS,GACSn2F,KAAKg1B,SAG9BC,OAAOC,OAAOl1B,KAAKg1B,SAAUmhE,EAAenhE,UAE5Ch1B,KAAK+kB,OAAOqxE,oBAAoBp2F,KAAKg1B,UAErCh1B,KAAKgJ,OAAOpD,KAAK,yBAAyBuwF,EAAe17C,QAAS,CAC9DyS,SAAUipC,EAAejpC,SACzBxjC,OAAQysE,EAAezsE,OACvBsL,SAAUmhE,EAAenhE,UAEjC,CAKQ,oBAAA49D,GACJ,MAAO,CACHsB,IAAK,CACDmC,UAAW,GACXC,KAAM,GACNX,WAAY,GACZR,KAAM,IAEVf,OAAQ,CACJmC,IAAK,GACLC,OAAQ,GACRV,KAAM,GACN5vF,SAAU,IAEd+tF,UAAW,CACP10B,OAAQ,MACRp2C,QAAS,MACTjjB,SAAU,IAGtB,CAKQ,kBAAA2sF,GACJ,MAAM4D,EAAoC,CACtCjzF,YAAa,EACboyF,gBAAiB,OACjBc,cAAe,SACfb,gBAAgB,EAChBc,OAAO,EACPC,cAAc,EACdC,QAAS,EACTb,kBAAmB,IACnBE,aAAc,OACdH,gBAAiB,GACjBe,aAAc,GACdC,oBAAqB,SACrBd,oBAAoB,EACpB/lE,OAAO,EACPgjE,cAAc,EACd8D,iBAAiB,GAIrB,OAAQh3F,KAAKS,UACT,KAAKZ,EAASwK,OACV,MAAO,IACAosF,EACHjzF,YAAa,GACboyF,gBAAiB,SACjBc,cAAe,MACfb,gBAAgB,EAChBc,OAAO,EACPC,cAAc,EACdZ,kBAAmB,IACnBE,aAAc,SACdH,gBAAiB,GACjBe,aAAc,GACdC,oBAAqB,UAG7B,KAAKl3F,EAASyK,QACV,OAAOmsF,EAEX,QACI,MAAO,IACAA,EACHjzF,YAAa,GACboyF,gBAAiB,SACjBc,cAAe,UAG/B,CAKQ,kBAAA3D,GACJ,MAAO,CACHmB,IAAK,EACLD,UAAW,EACXx/E,UAAW,EACX4/E,WAAY,EACZE,YAAa,EACbE,iBAAkB,EAClB5qF,UAAW,EACXC,UAAW,EACX8qF,SAAU,EACVqC,eAAgB,EAChB7xE,aAAc,EACd8xE,cAAe,EACf9wF,UAAW,EAEnB,CAKQ,aAAA+tF,GACJ,GAA+B,IAA3Bn0F,KAAKqyF,WAAWzrF,OAAc,OAAO,EAGzC,OADY5G,KAAKqyF,WAAW7wD,OAAO,CAACh1B,EAAGhB,IAAMgB,EAAIhB,EAAG,GACvCxL,KAAKqyF,WAAWzrF,MACjC,CAKQ,mBAAA8tF,GAMJ,OAJmB10F,KAAKS,WAAaZ,EAASwK,OAAS,GAAK,KACF,GAArCrK,KAAK8yF,eAAemE,eACc,EAAnCj3F,KAAK8yF,eAAe1tE,YAG5C,CAKQ,mBAAAuvE,GACJ,OAAQ30F,KAAKS,UACT,KAAKZ,EAASwK,OACV,OAAO,KACX,KAAKxK,EAASyK,QACV,OAAO,KACX,QACI,OAAO,KAEnB,CAKQ,oBAAA4qF,GAEJ,OAAIl1F,KAAK8yF,eAAe8B,SAAW,GAAW,WAC1C50F,KAAK8yF,eAAe8B,SAAW,GAAW,UAC1C50F,KAAK8yF,eAAe8B,SAAW,GAAW,OACvC,QACX,CAKQ,sBAAAzB,GACJnzF,KAAKg1B,SAASk+D,cAAe,EAC7BlzF,KAAKg1B,SAASgiE,iBAAkB,EAEhCh3F,KAAKgJ,OAAOpD,KAAK,+BACrB,CAKA,cAAAuxF,CAAelF,QAOoB,IAA3BA,EAAQgF,iBAA8Bj3F,KAAK8yF,eAAemE,eAAiBhF,EAAQgF,qBAC1D,IAAzBhF,EAAQ7sE,eAA4BplB,KAAK8yF,eAAe1tE,aAAe6sE,EAAQ7sE,mBACzD,IAAtB6sE,EAAQpoF,YAAyB7J,KAAK8yF,eAAejpF,UAAYooF,EAAQpoF,gBACnD,IAAtBooF,EAAQnoF,YAAyB9J,KAAK8yF,eAAehpF,UAAYmoF,EAAQnoF,gBAC/C,IAA1BmoF,EAAQiF,gBAA6Bl3F,KAAK8yF,eAAeoE,cAAgBjF,EAAQiF,cACzF,CAKA,iBAAAE,GACI,MAAO,IAAKp3F,KAAK8yF,eACrB,CAKA,iBAAAuE,CAAkBluF,GACd,IAAKA,EAAU,MAAO,IAAInJ,KAAKiyF,SAE/B,MAAMqF,EAASjxF,KAAKC,MAAQ6C,EAC5B,OAAOnJ,KAAKiyF,QAAQjqF,OAAOuvF,GAAKA,EAAEnxF,WAAakxF,EACnD,CAKA,qBAAAE,GAQI,MAAMC,EAAgBz3F,KAAKq3F,kBAAkB,KAE7C,GAA6B,IAAzBI,EAAc7wF,OACd,MAAO,CACH8wF,WAAY,EACZC,OAAQ,EACRC,OAAQ,EACRC,iBAAkB,EAClBC,mBAAoB,EACpBC,iBAAkB,QAI1B,MAAM7D,EAAMuD,EAAcxoF,IAAIsoF,GAAKA,EAAErD,KAC/BD,EAAYwD,EAAcxoF,IAAIsoF,GAAKA,EAAEtD,WACrCG,EAASqD,EAAcxoF,IAAIsoF,GAAKA,EAAE9C,kBAElCiD,EAAaxD,EAAI1yD,OAAO,CAACh1B,EAAGhB,IAAMgB,EAAIhB,EAAG,GAAK0oF,EAAIttF,OAClD+wF,EAAS/qF,KAAKuD,OAAO+jF,GACrB0D,EAAShrF,KAAKoC,OAAOklF,GACrB2D,EAAmB5D,EAAUzyD,OAAO,CAACh1B,EAAGhB,IAAMgB,EAAIhB,EAAG,GAAKyoF,EAAUrtF,OACpEkxF,EAAqB1D,EAAO5yD,OAAO,CAACh1B,EAAGhB,IAAMgB,EAAIhB,EAAG,GAAK4oF,EAAOxtF,OAGtE,IAAImxF,EAWJ,OATIA,EADAL,GAAc13F,KAAK2yF,WAAWuB,IAAImC,WAAayB,EAAqB93F,KAAK2yF,WAAWyB,OAAOoC,OACxE,YACZkB,GAAc13F,KAAK2yF,WAAWuB,IAAIoC,MAAQwB,EAAqB93F,KAAK2yF,WAAWyB,OAAO0B,KAC1E,OACZ4B,GAAc13F,KAAK2yF,WAAWuB,IAAIyB,WACtB,aAEA,OAGhB,CACH+B,aACAC,SACAC,SACAC,mBACAC,qBACAC,mBAER,CAKA,cAAAC,CAAeC,GACcj4F,KAAKg1B,SAC9BC,OAAOC,OAAOl1B,KAAKg1B,SAAUijE,GAE7Bj4F,KAAK+kB,OAAOqxE,oBAAoBp2F,KAAKg1B,UAErCh1B,KAAKgJ,OAAOpD,KAAK,kCAAmC,CAChDsyF,QAASjjE,OAAO3f,KAAK2iF,GACrBA,eAER,CAKA,WAAAE,GACI,MAAO,IAAKn4F,KAAKg1B,SACrB,CAKA,eAAA3E,GACIrwB,KAAKg1B,SAAWh1B,KAAK6yF,qBACrB7yF,KAAK+kB,OAAOqxE,oBAAoBp2F,KAAKg1B,UAErCh1B,KAAKgJ,OAAOpD,KAAK,4CACrB,CAKA,OAAAomB,GACQhsB,KAAKwyF,iBACLxyF,KAAKwyF,eAAe4F,aACpBp4F,KAAKwyF,eAAiB,MAG1BxyF,KAAKiyF,QAAU,GACfjyF,KAAKqyF,WAAa,GAElBryF,KAAKgJ,OAAOpD,KAAK,kCACrB,EC9oBG,MAAMyyF,EAWT,WAAAvzF,CAAYG,EAAwC,GAAI8f,EAAyB,CAAA,GAVjF/kB,KAAQgK,cAAuClB,IAC/C9I,KAAQs4F,aAA6CxvF,IAErD9I,KAAQu4F,eAAyB,EACjCv4F,KAAQw4F,cAAwB,EAO5Bx4F,KAAKgJ,OAAS,IAAIO,EAAO,kBACzBvJ,KAAK+kB,OAASA,EAEd/kB,KAAKiF,OAAS,CACVwzF,aAAc,IACdC,aAAc,EACdC,cAAc,EACdC,aAAa,EACbC,cAAc,KACX5zF,GAGPjF,KAAKgJ,OAAOpD,KAAK,gCACrB,CAKA,MAAA4O,CAAOC,GACHzU,KAAK84F,eAAerkF,GACpBzU,KAAK2kC,gBAAgBlwB,GACrBzU,KAAK+4F,kBACT,CAKQ,cAAAD,CAAerkF,GACnB,MAAM2O,EAAc/c,KAAKC,MAEzBtG,KAAKs4F,SAASnpF,QAAQ,CAAC6pF,EAASloE,KAC5B,GAAKkoE,EAAQ98B,OAAb,CAGA,GAAI88B,EAAQ7vF,SAAW,GAAKia,EAAc41E,EAAQ/vF,UAA+B,IAAnB+vF,EAAQ7vF,SAGlE,OAFA6vF,EAAQ98B,QAAS,OACjBl8D,KAAK+kB,OAAOk0E,qBAAqBD,GAKrC,GAAIA,EAAQE,aAAe,EAAG,CAC1B,MAAMC,EAAmBH,EAAQE,aAAezkF,EAAY,IAAQzU,KAAKiF,OAAOyzF,aAC1EU,EAAgBxsF,KAAKC,MAAMssF,GAC3BE,EAAmBF,EAAkBC,EAE3C,IAAA,IAAS7sF,EAAI,EAAGA,EAAI6sF,EAAe7sF,IAC/BvM,KAAKs5F,aAAaN,GAIlBpsF,KAAK2U,SAAW83E,GAChBr5F,KAAKs5F,aAAaN,EAE1B,CAGA,GAAIA,EAAQO,WAAa,EAAG,CACxB,IAAA,IAAShtF,EAAI,EAAGA,EAAIysF,EAAQO,WAAYhtF,IACpCvM,KAAKs5F,aAAaN,GAEtBA,EAAQO,WAAa,CACzB,CA/BqB,GAiC7B,CAKQ,YAAAD,CAAaN,GACjB,GAAIh5F,KAAKgK,UAAUqB,MAAQrL,KAAKiF,OAAOwzF,aAAc,CAEjD,MAAMe,EAAWx5F,KAAKgK,UAAUsL,OAAOo2B,OAAOnpB,MAC1Ci3E,GACAx5F,KAAKgK,UAAUZ,OAAOowF,EAE9B,CAEA,MAAMC,EAAa,YAAYz5F,KAAKu4F,iBAC9BmB,EAAgB15F,KAAK25F,uBAAuBX,GAC5Cz+E,EAAWva,KAAK45F,uBAAuBZ,GAEvCl0D,EAAqB,CACvBpuB,GAAI+iF,EACJx1F,KAAM+0F,EAAQ/0F,KACdyW,SAAU,IAAKg/E,GACfn/E,WACAH,aAAc,CAAE1N,EAAG,EAAGC,EAAG,GAEzBtB,KAAMrL,KAAK65F,cAAcb,EAAQc,UAAU3pF,IAAK6oF,EAAQc,UAAU9qF,KAClE1C,MAAOtM,KAAK+5F,sBAAsBf,EAAQ/0F,KAAM+0F,EAAQgB,gBACxDj0D,MAAO,EACPltB,SAAUjM,KAAK2U,SAAW3U,KAAKuU,GAAK,EACpC2lB,cAAuC,GAAvBl6B,KAAK2U,SAAW,IAEhCgqB,IAAK,EACL0uD,OAAQj6F,KAAK65F,cAAcb,EAAQkB,UAAU/pF,IAAK6oF,EAAQkB,UAAUlrF,KAEpEkyC,QAASlhD,KAAKm6F,mBAAmBnB,EAAQ/0F,MACzCm2F,OAAQp6F,KAAKq6F,kBAAkBrB,EAAQ/0F,MACvC+Z,SAAUhe,KAAKs6F,oBAAoBtB,EAAQ/0F,OAI/CjE,KAAKu6F,sBAAsBz1D,GAE3B9kC,KAAKgK,UAAUjB,IAAI0wF,EAAY30D,GAC/B9kC,KAAK+kB,OAAOy1E,oBAAoB11D,EACpC,CAKQ,sBAAA60D,CAAuBX,GAC3B,MAAMt+E,SAAEA,EAAA+/E,MAAUA,EAAAC,UAAOA,GAAc1B,EAEvC,OAAQyB,GACJ,IAAK,QA2BL,QACI,MAAO,IAAK//E,GAzBhB,IAAK,SACD,MAAMwpB,EAAQt3B,KAAK2U,SAAW3U,KAAKuU,GAAK,EAClCnT,EAASpB,KAAK2U,UAAYm5E,EAAU1sF,QAAU,IACpD,MAAO,CACHtB,EAAGgO,EAAShO,EAAIE,KAAKiX,IAAIqgB,GAASl2B,EAClCrB,EAAG+N,EAAS/N,EAAIC,KAAKqU,IAAIijB,GAASl2B,GAG1C,IAAK,YACD,MAAO,CACHtB,EAAGgO,EAAShO,GAAKE,KAAK2U,SAAW,KAAQm5E,EAAUjwF,OAAS,IAC5DkC,EAAG+N,EAAS/N,GAAKC,KAAK2U,SAAW,KAAQm5E,EAAUhwF,QAAU,KAGrE,IAAK,OACD,MAAMiwF,EAAY/tF,KAAK2U,UAAYm5E,EAAUx2D,OAASt3B,KAAKuU,GAAK,IAAMu5E,EAAUx2D,OAASt3B,KAAKuU,GAAK,GAAK,EAClGy5E,EAAahuF,KAAK2U,UAAYm5E,EAAU1sF,QAAU,IAClDkP,EAAYw9E,EAAUx9E,WAAa,EAEzC,MAAO,CACHxQ,EAAGgO,EAAShO,EAAIE,KAAKiX,IAAI3G,EAAYy9E,GAAaC,EAClDjuF,EAAG+N,EAAS/N,EAAIC,KAAKqU,IAAI/D,EAAYy9E,GAAaC,GAMlE,CAKQ,sBAAAhB,CAAuBZ,GAC3B,MAAM6B,cAAEA,GAAkB7B,EAE1B,MAAO,CACHtsF,EAAG1M,KAAK65F,cAAcgB,EAAc1qF,IAAIzD,EAAGmuF,EAAc7rF,IAAItC,GAC7DC,EAAG3M,KAAK65F,cAAcgB,EAAc1qF,IAAIxD,EAAGkuF,EAAc7rF,IAAIrC,GAErE,CAKQ,qBAAAotF,CAAsB91F,EAAoB62F,GAC9C,MAaMlsC,EAb+C,CACjD3lC,UAA0B,CAAE3d,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC7CkN,OAAuB,CAAEpN,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC1Cwd,MAAsB,CAAE1d,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACzCie,OAAuB,CAAEne,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC1CuvF,MAAsB,CAAEzvF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACzCwvF,MAAsB,CAAE1vF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IACzCyvF,OAAuB,CAAE3vF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC1C0vF,UAA0B,CAAE5vF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC7C2vF,WAA0B,CAAE7vF,EAAG,GAAIC,EAAG,GAAIC,EAAG,IAC7C4vF,KAAqB,CAAE9vF,EAAG,GAAIC,EAAG,GAAIC,EAAG,KAGfvH,GACvBo3F,EAA8B,GAAZP,EAExB,MAAO,CACHxvF,EAAGsB,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAKy+C,EAAUtjD,GAAKsB,KAAK2U,SAAW,IAAO85E,IACnE9vF,EAAGqB,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAKy+C,EAAUrjD,GAAKqB,KAAK2U,SAAW,IAAO85E,IACnE7vF,EAAGoB,KAAKoC,IAAI,EAAGpC,KAAKuD,IAAI,IAAKy+C,EAAUpjD,GAAKoB,KAAK2U,SAAW,IAAO85E,IAE3E,CAKQ,kBAAAlB,CAAmBl2F,GAcvB,MAbyD,CACrDglB,UAA0B,EAC1BvQ,QAAuB,GACvBsQ,MAAsB,EACtBS,OAAuB,EACvBsxE,MAAsB,IACtBC,OAAsB,GACtBC,OAAuB,IACvBC,UAA0B,EAC1BC,WAA0B,EAC1BC,KAAqB,GAGJn3F,EACzB,CAEQ,iBAAAo2F,CAAkBp2F,GActB,MAbwD,CACpDglB,UAA0B,GAC1BvQ,OAAuB,EACvBsQ,MAAsB,EACtBS,OAAuB,EACvBsxE,MAAsB,GACtBC,MAAsB,EACtBC,OAAuB,GACvBC,UAA0B,EAC1BC,WAA0B,EAC1BC,KAAqB,GAGLn3F,EACxB,CAEQ,mBAAAq2F,CAAoBr2F,GAcxB,MAb0D,CACtDglB,UAA0B,IAC1BvQ,OAAuB,GACvBsQ,MAAsB,EACtBS,OAAuB,IACvBsxE,MAAsB,IACtBC,MAAsB,IACtBC,OAAuB,IACvBC,UAA0B,EAC1BC,WAA0B,IAC1BC,KAAqB,GAGHn3F,EAC1B,CAKQ,qBAAAs2F,CAAsBz1D,GAC1B,OAAQA,EAAS7gC,MACb,IAAK,YACD6gC,EAASw2D,cAAgB,CACrBC,UAA2B,GAAhBz2D,EAASz5B,KACpBmwF,QAAyB,EAAhB12D,EAASz5B,KAClBuc,MAAO,YAEXkd,EAAS22D,eAAiB,CACtBC,WAAY,EACZC,SAAU,EACV/zE,MAAO,WAEX,MAEJ,IAAK,SACDkd,EAASw2D,cAAgB,CACrBC,UAAWz2D,EAASz5B,KACpBmwF,QAAyB,GAAhB12D,EAASz5B,KAClBuc,MAAO,UAEXkd,EAAS22D,eAAiB,CACtBC,WAAY,GACZC,SAAU,EACV/zE,MAAO,UAEX,MAEJ,IAAK,QACDkd,EAASw2D,cAAgB,CACrBC,UAA2B,GAAhBz2D,EAASz5B,KACpBmwF,QAAyB,EAAhB12D,EAASz5B,KAClBuc,MAAO,YAEXkd,EAAS22D,eAAiB,CACtBC,WAAY,GACZC,SAAU,EACV/zE,MAAO,WAEX,MAEJ,IAAK,QACDkd,EAAS22D,eAAiB,CACtBC,WAAY,EACZC,SAAU,EACV/zE,MAAO,WAIvB,CAKQ,eAAA+c,CAAgBlwB,GACpBzU,KAAKgK,UAAUmF,QAAQ,CAAC21B,EAAU20D,KAC9B,MAAMmC,EAAKnnF,EAAY,IAGvBqwB,EAASyG,KAAO92B,EAGhBzU,KAAK67F,sBAAsB/2D,EAAU82D,GAGrC57F,KAAK87F,yBAAyBh3D,GAG9BA,EAASjsB,UAAYisB,EAASgC,cAAgB80D,GAEtD,CAKQ,qBAAAC,CAAsB/2D,EAAoB82D,GAE9C92D,EAAS1qB,aAAazN,GAAKm4B,EAASoc,QAAU06C,EAG9C92D,EAASvqB,SAAS7N,GAAKo4B,EAAS1qB,aAAa1N,EAAIkvF,EACjD92D,EAASvqB,SAAS5N,GAAKm4B,EAAS1qB,aAAazN,EAAIivF,EAGjD92D,EAASvqB,SAAS7N,GAAKo4B,EAAS9mB,SAChC8mB,EAASvqB,SAAS5N,GAAKm4B,EAAS9mB,SAGhC8mB,EAASpqB,SAAShO,GAAKo4B,EAASvqB,SAAS7N,EAAIkvF,EAC7C92D,EAASpqB,SAAS/N,GAAKm4B,EAASvqB,SAAS5N,EAAIivF,EAG7C92D,EAAS1qB,aAAa1N,EAAI,EAC1Bo4B,EAAS1qB,aAAazN,EAAI,CAC9B,CAKQ,wBAAAmvF,CAAyBh3D,GAC7B,MAAMtjB,EAAW5U,KAAKuD,IAAI,EAAG20B,EAASyG,IAAMzG,EAASm1D,QAGrD,GAAIn1D,EAASw2D,cAAe,CACxB,MAAMv6E,EAAI/gB,KAAK+7F,YAAYv6E,EAAUsjB,EAASw2D,cAAc1zE,OAC5Dkd,EAASz5B,KAAOrL,KAAKg8F,KACjBl3D,EAASw2D,cAAcC,UACvBz2D,EAASw2D,cAAcE,QACvBz6E,EAER,CAGA,GAAI+jB,EAAS22D,eAAgB,CACzB,MAAM16E,EAAI/gB,KAAK+7F,YAAYv6E,EAAUsjB,EAAS22D,eAAe7zE,OAC7Dkd,EAASiB,MAAQ/lC,KAAKg8F,KAClBl3D,EAAS22D,eAAeC,WACxB52D,EAAS22D,eAAeE,SACxB56E,EAER,CAGA,GAAI+jB,EAASm3D,eAAgB,CACzB,MAAMl7E,EAAI/gB,KAAK+7F,YAAYv6E,EAAUsjB,EAASm3D,eAAer0E,OAC7Dkd,EAASx4B,MAAQ,CACbhB,EAAGsB,KAAKC,MAAM7M,KAAKg8F,KAAKl3D,EAASm3D,eAAeC,WAAW5wF,EAAGw5B,EAASm3D,eAAeE,SAAS7wF,EAAGyV,IAClGxV,EAAGqB,KAAKC,MAAM7M,KAAKg8F,KAAKl3D,EAASm3D,eAAeC,WAAW3wF,EAAGu5B,EAASm3D,eAAeE,SAAS5wF,EAAGwV,IAClGvV,EAAGoB,KAAKC,MAAM7M,KAAKg8F,KAAKl3D,EAASm3D,eAAeC,WAAW1wF,EAAGs5B,EAASm3D,eAAeE,SAAS3wF,EAAGuV,IAE1G,CACJ,CAKQ,WAAAg7E,CAAYh7E,EAAW6G,GAC3B,OAAQA,GACJ,IAAK,UACD,OAAO7G,EAAIA,EACf,IAAK,WACD,OAAO,GAAK,EAAIA,IAAM,EAAIA,GAC9B,IAAK,cACD,OAAOA,EAAI,GAAM,EAAIA,EAAIA,EAAI,EAAInU,KAAK+D,KAAI,EAAKoQ,EAAI,EAAG,GAAK,EAC/D,QACI,OAAOA,EAEnB,CAKQ,IAAAi7E,CAAKxzF,EAAeC,EAAasY,GACrC,OAAOvY,GAASC,EAAMD,GAASuY,CACnC,CAKQ,gBAAAg4E,GACJ/4F,KAAKgK,UAAUmF,QAAQ,CAAC21B,EAAU20D,MAC1B30D,EAASyG,KAAOzG,EAASm1D,QAAUn1D,EAASiB,OAAS,KACrD/lC,KAAKgK,UAAUZ,OAAOqwF,GACtBz5F,KAAK+kB,OAAOq3E,iBAAiBt3D,KAGzC,CAKA,eAAAjU,CAAgBnW,EAAoCmO,EAAoB,GACpE,MAAMiI,EAAY,aAAa9wB,KAAKw4F,gBAE9BQ,EAA2B,CAC7BtiF,GAAIoa,EACJ7sB,KAAM,YACNyW,SAAU,IAAKA,GACfw+E,aAAc,EACdK,WAAY3sF,KAAKC,MAAM,GAAKgc,EAAY7oB,KAAKiF,OAAOyzF,cACpDmC,cAAe,CACX1qF,IAAK,CAAEzD,OAAUmc,EAAWlc,OAAUkc,GACtC7Z,IAAK,CAAEtC,EAAG,IAAMmc,EAAWlc,EAAG,IAAMkc,IAExCixE,UAAW,CAAE3pF,IAAK,EAAGnB,IAAK,EAAI6Z,GAC9BqxE,UAAW,CAAE/pF,IAAK,IAAKnB,IAAK,MAC5BgrF,eAAgB,GAChB99B,QAAQ,EACR/yD,SAAU,GACVF,UAAW5C,KAAKC,MAChBm0F,MAAO,SACPC,UAAW,CAAE1sF,OAAQ,EAAI6a,IAM7B,OAHA7oB,KAAKs4F,SAASvvF,IAAI+nB,EAAWkoE,GAC7Bh5F,KAAKgJ,OAAOxD,MAAM,4BAA4BkV,EAAShO,MAAMgO,EAAS/N,MAE/DmkB,CACX,CAKA,iBAAAC,CAAkBrW,EAAoCwC,EAAmB2L,EAAoB,GACzF,MAAMiI,EAAY,UAAU9wB,KAAKw4F,gBAE3BQ,EAA2B,CAC7BtiF,GAAIoa,EACJ7sB,KAAM,SACNyW,SAAU,IAAKA,GACfw+E,aAAc,GAAKrwE,EAAY7oB,KAAKiF,OAAOyzF,aAC3Ca,WAAY,EACZsB,cAAe,CACX1qF,IAAK,CAAEzD,GAAyB,GAAtBE,KAAKiX,IAAI3G,GAAmB2L,EAAWlc,MAAGC,KAAKqU,IAAI/D,GAAmB2L,GAChF7Z,IAAK,CAAEtC,GAAyB,IAAtBE,KAAKiX,IAAI3G,GAAoB2L,EAAWlc,OAAGC,KAAKqU,IAAI/D,GAAoB2L,IAEtFixE,UAAW,CAAE3pF,IAAK,EAAGnB,IAAK,EAAI6Z,GAC9BqxE,UAAW,CAAE/pF,IAAK,IAAKnB,IAAK,KAC5BgrF,eAAgB,GAChB99B,QAAQ,EACR/yD,UAAU,EACVF,UAAW5C,KAAKC,MAChBm0F,MAAO,OACPC,UAAW,CACPx9E,UAAWA,EAAYtQ,KAAKuU,GAC5B+iB,MAAOt3B,KAAKuU,GAAK,EACjBnT,OAAQ,EAAI6a,IAMpB,OAFA7oB,KAAKs4F,SAASvvF,IAAI+nB,EAAWkoE,GAEtBloE,CACX,CAKA,eAAAurE,CAAgB7zF,EAAiCC,GAC7C,MAAMqoB,EAAY,SAAS9wB,KAAKw4F,gBAE1B/nF,EAAW7D,KAAK8D,MAAMjI,EAAIiE,EAAIlE,EAAMkE,IAAM,GAAKjE,EAAIkE,EAAInE,EAAMmE,IAAM,GACnEg3B,EAAgB/2B,KAAKC,MAAM4D,EAAW,GAEtCuoF,EAA2B,CAC7BtiF,GAAIoa,EACJ7sB,KAAM,QACNyW,SAAU,IAAKlS,GACf0wF,aAAc,EACdK,WAAY51D,EAAgB3jC,KAAKiF,OAAOyzF,aACxCmC,cAAe,CACX1qF,IAAK,CAAEzD,EAAG,EAAGC,EAAG,GAChBqC,IAAK,CAAEtC,EAAG,EAAGC,EAAG,IAEpBmtF,UAAW,CAAE3pF,IAAK,EAAGnB,IAAK,GAC1BkrF,UAAW,CAAE/pF,IAAK,IAAKnB,IAAK,KAC5BgrF,eAAgB,GAChB99B,QAAQ,EACR/yD,SAAU,IACVF,UAAW5C,KAAKC,MAChBm0F,MAAO,YACPC,UAAW,CACPjwF,MAAOgG,EACP/F,OAAQ,IAMhB,OAFA1K,KAAKs4F,SAASvvF,IAAI+nB,EAAWkoE,GAEtBloE,CACX,CAKA,qBAAAwrE,CAAsBxrE,EAAmBpW,GACrC,MAAMs+E,EAAUh5F,KAAKs4F,SAASpvF,IAAI4nB,GAC9BkoE,IACAA,EAAQt+E,SAAW,IAAKA,GAEhC,CAKA,WAAA6hF,CAAYzrE,GACR,MAAMkoE,EAAUh5F,KAAKs4F,SAASpvF,IAAI4nB,GAC9BkoE,IACAA,EAAQ98B,QAAS,EAEzB,CAKA,aAAA/mC,CAAcrE,GACV9wB,KAAKs4F,SAASlvF,OAAO0nB,EACzB,CAKA,MAAAuC,CAAOC,GAEqBjd,MAAMC,KAAKtW,KAAKgK,UAAU2O,UAAU8vC,KAAK,CAACj8C,EAAGhB,IAC1DgB,EAAEvI,KAAKmwD,cAAc5oD,EAAEvH,OAGlBkL,QAAQ21B,IACpB9kC,KAAKw8F,eAAelpE,EAAUwR,IAEtC,CAKQ,cAAA03D,CAAelpE,EAAoBwR,GACvC,GAAIA,EAASiB,OAAS,EAAG,OAEzB,MAAMz5B,EAAQ,IACPw4B,EAASx4B,OAIhB,GAAItM,KAAKiF,OAAO4zF,aAAc,CAE1B,MAAMnsF,EAAIE,KAAKC,MAAMi4B,EAASpqB,SAAShO,GACjCC,EAAIC,KAAKC,MAAMi4B,EAASpqB,SAAS/N,GACjCtB,EAAOuB,KAAKoC,IAAI,EAAGpC,KAAKC,MAAMi4B,EAASz5B,OAE7CioB,EAAStnB,SAASU,EAAIrB,EAAK,EAAGsB,EAAItB,EAAK,EAAGA,EAAMA,EAAMiB,EAC1D,MAEIgnB,EAASzlB,WACLi3B,EAASpqB,SAAShO,EAClBo4B,EAASpqB,SAAS/N,EAClBm4B,EAASz5B,KACTiB,GACA,EAGZ,CAKQ,aAAAutF,CAAc1pF,EAAanB,GAC/B,OAAOmB,EAAMvD,KAAK2U,UAAYvS,EAAMmB,EACxC,CAKA,YAAA2oC,CAAaC,GACT9jB,OAAOC,OAAOl1B,KAAKiF,OAAQ8zC,GAC3B/4C,KAAKgJ,OAAOpD,KAAK,mCAAoCmzC,EACzD,CAKA,QAAAx7B,GAMI,MAAO,CACHk/E,gBAAiBz8F,KAAKgK,UAAUqB,KAChCqxF,eAAgBrmF,MAAMC,KAAKtW,KAAKs4F,SAAS3/E,UAAU3Q,OAAOyK,GAAKA,EAAEypD,QAAQt1D,OACzE6xF,aAAcz4F,KAAKiF,OAAOwzF,aAC1BC,aAAc14F,KAAKiF,OAAOyzF,aAElC,CAKA,KAAAxwF,GACIlI,KAAKgK,UAAU9B,QACflI,KAAKs4F,SAASpwF,QACdlI,KAAKgJ,OAAOpD,KAAK,4BACrB,CAKA,OAAAomB,GACIhsB,KAAKkI,QACLlI,KAAKgJ,OAAOpD,KAAK,6BACrB,EC3sBG,MAAM+2F,GAsET,WAAA73F,CAAYzC,EAA2B5B,GAzDvCT,KAAQ02B,WAAgC,KAGxC12B,KAAQ48F,cAAsC,KAG9C58F,KAAQ68F,iBAA4C,KAGpD78F,KAAQ88F,iBAA4C,KAGpD98F,KAAQ+8F,gBAA0C,KAGlD/8F,KAAQqxD,aAAoC,KAC5CrxD,KAAQg9F,iBAA4C,KACpDh9F,KAAQi9F,eAAwC,KAGhDj9F,KAAQk9F,cAAsC,KAG9Cl9F,KAAQm9F,kBAA8C,KACtDn9F,KAAQo9F,eAAwC,KAChDp9F,KAAQq9F,eAAwC,KAGhDr9F,KAAQs9F,gBAA0C,KAClDt9F,KAAQu9F,QAA0B,KAGlCv9F,KAAQw9F,gBAA0C,KAClDx9F,KAAQy9F,mBAAgD,KACxDz9F,KAAQ09F,eAAwC,KAGhD19F,KAAQ29F,WAAY,EACpB39F,KAAQ49F,UAAW,EACnB59F,KAAQ69F,SAAW,EACnB79F,KAAQyU,UAAY,EACpBzU,KAAQinD,WAAa,EACrBjnD,KAAQsyF,WAAa,EACrBtyF,KAAQ89F,cAAgB,EAGxB99F,KAAQ+9F,iBAAmB,CACvBrG,WAAY,EACZzD,UAAW,EACX+J,WAAY,EACZC,WAAY,EACZC,YAAa,GAObl+F,KAAKqC,OAASA,EACdrC,KAAKS,SAAWA,EAChBT,KAAKgJ,OAAS,IAAIO,EAAO,QACzBvJ,KAAKm+F,WAAan+F,KAAKgJ,OAAOT,0BAG9B,MAAM61F,EAAiBz5F,EAAiBxC,YACxCnC,KAAKiF,OAAS,CACV9B,UAAWi7F,EAAel7F,YAAYC,UACtCk7F,aAAa,EACbC,6BAA6B,EAC7Bp6F,eAAgBk6F,EAAep6F,QAAQE,eACvCsuB,iBAAkB4rE,EAAep6F,QAAQG,cAG7CnE,KAAKgJ,OAAOpD,KAAK,2BAA4B,CACzCnF,WACA+J,WAAY,GAAGnI,EAAOoI,SAASpI,EAAOqI,SACtCzF,OAAQjF,KAAKiF,SAIjBjF,KAAKu+F,mBACT,CAKQ,iBAAAA,GACJv+F,KAAKgJ,OAAOpD,KAAK,mCAEjB,IAEI5F,KAAKszB,SAAW,IAAI9pB,EAASxJ,KAAKqC,OAAQrC,KAAKS,UAC/CT,KAAKgJ,OAAOpD,KAAK,0BAGjB5F,KAAK2C,MAAQ,IAAI8O,EAAazR,KAAKqC,OAAQrC,KAAKS,UAChDT,KAAKgJ,OAAOpD,KAAK,8BAGjB5F,KAAKymC,QAAU,IAAIztB,EACnBhZ,KAAKgJ,OAAOpD,KAAK,gCAGjB5F,KAAKyD,MAAQ,IAAI2a,EAAYpe,KAAKS,UAClCT,KAAKgJ,OAAOpD,KAAK,8BAGjB5F,KAAKw+F,aAAe,IAAInpE,EAAiBr1B,KAAKw9F,sBAAmB,EAAWx9F,KAAK09F,qBAAkB,GACnG19F,KAAKgJ,OAAOpD,KAAK,oCAEjB5F,KAAKgJ,OAAOpD,KAAK,+CAErB,OAASE,GAEL,MADA9F,KAAKgJ,OAAO9C,SAAS,sCAAuCJ,GACtDA,CACV,CACJ,CAKA,gBAAM6E,GACF3K,KAAKgJ,OAAOpD,KAAK,sCAEjB,UAEU5F,KAAKm+F,WAAWv1F,aAAa,gBAAiBkX,gBAC1C9f,KAAKszB,SAAS3oB,qBAIlB3K,KAAKm+F,WAAWv1F,aAAa,aAAckX,gBACvC9f,KAAKyD,MAAMkH,qBAIf3K,KAAKm+F,WAAWv1F,aAAa,aAAckX,gBACvC9f,KAAKw+F,aAAa7zF,eAIxB3K,KAAKiF,OAAOf,gBACZlE,KAAKw2C,sBAIHx2C,KAAKm+F,WAAWv1F,aAAa,cAAekX,UAC9C9f,KAAK48F,cAAgB,IAAI3nD,QACnBj1C,KAAK48F,cAAcjyF,eAI7B3K,KAAK68F,iBAAmB,IAAI5jD,EAAiB,CACzCc,YAAa/5C,KAAKqC,OAAOoI,MACzBuvC,aAAch6C,KAAKqC,OAAOqI,QAC3B,CACC+xC,wBAA0Bnb,IAClBthC,KAAK02B,aACL12B,KAAK02B,WAAW2K,mBAAmBC,GACnCthC,KAAKgJ,OAAOxD,MAAM,2BAA4B87B,KAGtDgb,eAAgB,CAAC9sB,EAAQnY,KACjBrX,KAAK02B,aACL12B,KAAK02B,WAAWiL,aAAanS,EAAenY,GAC5CrX,KAAKgJ,OAAOxD,MAAM,UAAUgqB,KAAUnY,EAAQ,UAAY,gBAGlEqkC,gBAAiB,KACb17C,KAAKgJ,OAAOpD,KAAK,2BAGrB+1C,YAAa,KACT37C,KAAKgJ,OAAOpD,KAAK,uBAGrBg2C,eAAgB,KACZ57C,KAAKgJ,OAAOpD,KAAK,0BAGrBi2C,WAAY,KACR77C,KAAKgJ,OAAOpD,KAAK,iCAGrBk2C,gBAAiB,KACb97C,KAAKgJ,OAAOpD,KAAK,4BAGrBm2C,YAAc0iD,IACVz+F,KAAKgJ,OAAOxD,MAAM,eAAei5F,SAMzCz+F,KAAK88F,iBAAmB,IAAIn2C,EAAiB,CACzCjF,eAAgB,IAChBwF,oBAAqB,IACrBlF,gBAAgB,EAChBmF,oBAAoB,GACrB,CACC3B,aAAelF,IACXtgD,KAAKgJ,OAAOpD,KAAK,6BAA6B06C,MAGlDmF,OAASnF,IACLtgD,KAAKgJ,OAAOpD,KAAK,iBAAiB06C,MAGtCoF,iBAAkB,KACd1lD,KAAKgJ,OAAOpD,KAAK,yBAErBggD,cAAgBtF,IACZtgD,KAAKgJ,OAAOpD,KAAK,gBAAgB06C,MAGrCqF,cAAgBrF,IACZtgD,KAAKgJ,OAAOpD,KAAK,cAAc06C,QAMvCtgD,KAAK+8F,gBAAkB,IAAIxzC,EAAgB,CACvCpf,UAAW,IACX0f,WAAY,EACZC,iBAAkB,GAClBC,kBAAkB,EAClBC,oBAAqB,GACrBC,cAAe,KAInBjqD,KAAKqxD,aAAe,IAAIjF,EAExBpsD,KAAKg9F,iBAAmB,IAAI5rC,EAAiB,CACzCY,SAAU,GACVC,UAAW,GACXC,WAAY,EACZC,UAAW,IACXC,UAAW,IACXC,eAAe,GAChB,CACCe,YAAa,CAACp6B,EAAMmqB,KAChBnjD,KAAKgJ,OAAOpD,KAAK,YAAYu9C,MAAanqB,EAAK/yB,sBAEnDwtD,cAAe,CAACz6B,EAAMmqB,KAClBnjD,KAAKgJ,OAAOpD,KAAK,cAAcu9C,MAAanqB,EAAK/yB,wBAErD4sD,gBAAiB,KACb7yD,KAAKgJ,OAAOnD,KAAK,2BAEtB7F,KAAKqxD,cAERrxD,KAAKi9F,eAAiB,IAAIrlC,EACtB53D,KAAKqxD,aACLrxD,KAAKg9F,iBACL,CACI/iC,kBAAoBD,IAChBh6D,KAAKgJ,OAAOpD,KAAK,wBAAwBo0D,EAAQT,aAErDa,oBAAqB,CAACphC,EAAMi0D,KACpBA,EACAjtF,KAAKgJ,OAAOpD,KAAK,0BAA0BozB,EAAK/yB,QAEhDjG,KAAKgJ,OAAOnD,KAAK,qBAAqBmzB,EAAK/yB,WAO3DjG,KAAKk9F,cAAgB,KAGrBl9F,KAAKm9F,kBAAoB,IAAIhvB,EAAkB,CAC3CoC,UAAW,CAACrrE,EAAO2lE,KACf7qE,KAAKgJ,OAAOpD,KAAK,sBAAsBV,IAAS2lE,IAEpD8F,eAAgB,CAACb,EAAO5qE,KACpBlF,KAAKgJ,OAAOpD,KAAK,gBAAgBkqE,EAAM7pE,UAAUf,MAErD8sE,sBAAwB9B,IACpBlwE,KAAKgJ,OAAOpD,KAAK,mBAAmBsqE,EAAYjqE,WAIxDjG,KAAKo9F,eAAiB,IAAI5pB,EAAe,CACrC4D,qBAAuBvC,IACnB70E,KAAKgJ,OAAOpD,KAAK,2BAA2BivE,EAAK5uE,SAErDyyE,gBAAkBH,IACdv4E,KAAKgJ,OAAOpD,KAAK,iBAAiB2yE,EAAUtyE,WAIpDjG,KAAKq9F,eAAiB,IAAIxjB,EAAe,CACrCwD,aAAevD,IACX95E,KAAKgJ,OAAOpD,KAAK,mBAAmBk0E,EAAK7zE,SAAS6zE,EAAKa,UAE3DiF,YAAcL,IACVv/E,KAAKgJ,OAAOpD,KAAK,kBAAkB25E,EAAMtyB,gBAE7CmzB,cAAgB5K,IACZx1E,KAAKgJ,OAAOnD,KAAK,uBAAuB2vE,EAAOnsE,QAAQ,UAK/DrJ,KAAKs9F,gBAAkB,IAAI9b,EAAgB,CACvC6L,eAAiBlqB,IACbnjE,KAAKgJ,OAAOpD,KAAK,0BAA0Bu9D,EAAQl9D,SAEvDw9E,oBAAqB,CAACR,EAAWyb,EAAQC,KACrC,MAAM3f,EAAS2f,EAASD,EACxB1+F,KAAKgJ,OAAOpD,KAAK,iBAAiBo5E,EAAS,EAAI,IAAM,KAAKA,MAAWiE,MAEzE8B,qBAAuBb,IACnBlkF,KAAKgJ,OAAOpD,KAAK,wCAErBohF,qBAAuBnb,IACnB7rE,KAAKgJ,OAAOpD,KAAK,4BAA4BimE,EAAU5nE,WAI/DjE,KAAKu9F,QAAU,IAAIpU,EAAQ,CACvBkE,eAAgB,CAACzS,EAAS/O,KACtB7rE,KAAKgJ,OAAOpD,KAAK,0BAA0Bg1E,MAE/C8V,4BAA6B,CAAC9V,EAASgkB,KACnC5+F,KAAKgJ,OAAOpD,KAAK,kCAAkCg1E,SAAegkB,MAEtEpN,uBAAwB,CAAC5W,EAAS9E,KAC9B91E,KAAKgJ,OAAOpD,KAAK,iCAAiCg1E,MAAY9E,MAElEgb,kBAAmB,CAAClW,EAASikB,KACzB7+F,KAAKgJ,OAAOpD,KAAK,6BAA6Bg1E,MAAYikB,QAKlE7+F,KAAKw9F,gBAAkB,IAAI14E,EAAgB,CACvCqC,cAAe,CAACljB,EAAMgB,KAClBjF,KAAKgJ,OAAOxD,MAAM,oBAAoBvB,MAE1C8mB,eAAiBhB,IACb/pB,KAAKgJ,OAAOpD,KAAK,2BAA2BmkB,MAEhDrE,aAAe5f,IACX9F,KAAKgJ,OAAOlD,MAAM,iBAAkBA,MAI5C9F,KAAKy9F,mBAAqB,IAAIzL,EAAmB,CAC7CgC,oBAAsB/B,MAOtBmD,oBAAqB,CAAC0J,EAAQv8E,EAAOw8E,KACjC/+F,KAAKgJ,OAAOnD,KAAK,sCAAsCi5F,OAAYv8E,iBAAqBw8E,OAE5FxJ,0BAA4BF,IACxBr1F,KAAKgJ,OAAOpD,KAAK,mCAAmCyvF,EAAgBzuF,uBAExEwvF,kBAAoBphE,IAChBh1B,KAAKgJ,OAAOpD,KAAK,4CAKnB5F,KAAKw9F,gBAAgB7yF,aAG3B3K,KAAK09F,eAAiB,IAAIrF,EAAe,CACrCI,aAAc,IACdC,aAAc,EACdC,cAAc,EACdE,cAAc,IAIlB74F,KAAKy9F,mBAAmB9yF,aAGxB3K,KAAKw9F,gBAAgB1zE,kBAAkB,cAGvC9pB,KAAKk9F,cAAgB,IAAIj0B,EACrBjpE,KAAKqxD,aACLrxD,KAAKg9F,iBACL,CACI/wB,mBAAqBJ,IACjB7rE,KAAKgJ,OAAOpD,KAAK,wBAAwBimE,EAAU5lE,SAEvDmmE,qBAAsB,CAACP,EAAWohB,KAC9BjtF,KAAKgJ,OAAOpD,KAAK,GAAGqnF,EAAU,IAAM,iBAAiBphB,EAAU5lE,QAAQgnF,EAAU,YAAc,YAE3FA,GAAWjtF,KAAKm9F,oBAChBn9F,KAAKm9F,kBAAkBhtB,cAActE,EAAUhB,QAAQ9zC,YACvD/2B,KAAKm9F,kBAAkBlrB,iBAAiB,CAAEhD,gBAAiB,MAGnE1I,iBAAkB,CAACL,EAAS2E,KACxB7qE,KAAKgJ,OAAOpD,KAAK,wBAAwBilE,EAAQ9zC,kBAAkB8zC,EAAQxe,MAAMzlD,gBAE7E5G,KAAKm9F,oBACLn9F,KAAKm9F,kBAAkBhtB,cAActF,EAAQ9zC,YAC7C/2B,KAAKm9F,kBAAkBlrB,iBAAiB,CAAEhD,gBAAiB,IAE3DjvE,KAAKm9F,kBAAkB3sB,mBAAmB,qBAAsB,IAChExwE,KAAKm9F,kBAAkB3sB,mBAAmB,kBAAmB,KAGrE9F,gBAAiB,CAACxvC,EAAQ6D,KACtB/+B,KAAKgJ,OAAOnD,KAAK,kBAAkBq1B,KAAU6D,eAMzD/+B,KAAKy2B,mBAELz2B,KAAKgJ,OAAOpD,KAAK,+CAErB,OAASE,GAEL,MADA9F,KAAKgJ,OAAO9C,SAAS,+BAAgCJ,GAC/CA,CACV,CACJ,CAKA,WAAM0C,GACF,GAAIxI,KAAK29F,UACL39F,KAAKgJ,OAAOnD,KAAK,+BADrB,CAKA7F,KAAKgJ,OAAOpD,KAAK,uBAEjB,UAEU5F,KAAKw+F,aAAajoE,SAASnB,EAAUnJ,UAG3CjsB,KAAK29F,WAAY,EACjB39F,KAAK49F,UAAW,EAChB59F,KAAK69F,SAAW36F,YAAYoD,MAG5BtG,KAAKg/F,WAELh/F,KAAKgJ,OAAOpD,KAAK,8BAErB,OAASE,GAGL,MAFA9F,KAAKgJ,OAAO9C,SAAS,yBAA0BJ,GAC/C9F,KAAK29F,WAAY,EACX73F,CACV,CAtBA,CAuBJ,CAKQ,QAAAk5F,GACJ,IAAKh/F,KAAK29F,UACN,OAGJ,MAAMv6E,EAAclgB,YAAYoD,MAOhC,GANAtG,KAAKyU,WAAa2O,EAAcpjB,KAAK69F,UAAY,IACjD79F,KAAK69F,SAAWz6E,EAGhBpjB,KAAKyU,UAAY7H,KAAKuD,IAAInQ,KAAKyU,UAAW,EAAE,KAEvCzU,KAAK49F,SACN,IAEQ59F,KAAKiF,OAAOq5F,6BACZt+F,KAAKi/F,uBAAuB77E,GAIhCpjB,KAAKm+F,WAAWz1F,QAAQ,SAAU,KAC9B1I,KAAKwU,OAAOxU,KAAKyU,aAIrBzU,KAAKm+F,WAAWz1F,QAAQ,SAAU,KAC9B1I,KAAKqzB,WAGTrzB,KAAKinD,YAET,OAASnhD,GACL9F,KAAKgJ,OAAOlD,MAAM,kBAAmBA,GACrC9F,KAAKk/F,YAAYp5F,EACrB,CAIJq5F,sBAAsB,IAAMn/F,KAAKg/F,WACrC,CAKQ,MAAAxqF,CAAOC,GAcX,GAZAzU,KAAK2C,MAAM6R,OAAOC,GAGlBzU,KAAKw+F,aAAahqF,OAAOC,EAAWzU,KAAK2C,OAGzC3C,KAAKymC,QAAQjyB,OAAOC,GAGpBzU,KAAKyD,MAAM+Q,OAAOC,GAGdzU,KAAK02B,YAAc12B,KAAKw+F,aAAa3jE,eAAgB,CAerD,GAdA76B,KAAK02B,WAAWliB,OAAOC,GAGvBzU,KAAK02B,WAAW8R,aAGZxoC,KAAK2C,MAAMqV,aAAa,UACxBhY,KAAK02B,WAAWoI,YAAY,GAAIlyB,KAAK2U,SAAW,GAC5CwZ,EAAYqkE,YAAcrkE,EAAYskE,SAE1Cr/F,KAAKgJ,OAAOpD,KAAK,2BAIjB5F,KAAK2C,MAAMqV,aAAa,QAAS,CACjC,MAAMsnF,EAAgBt/F,KAAK02B,WAAW4S,kBACtCtpC,KAAK02B,WAAWiL,aAAa3G,EAAWukE,SAAUD,EAAc7iE,eAChEz8B,KAAKgJ,OAAOpD,KAAK,eAAe05F,EAAc7iE,cAA4B,WAAZ,WAClE,CAGA,GAAIz8B,KAAK2C,MAAMqV,aAAa,SAAWhY,KAAK88F,iBAAkB,CAC1D,MAAM/1C,EAAe/mD,KAAK88F,iBAAiBj0C,kBAC3C,GAAI9B,EAAangD,OAAS,EAAG,CACzB,MAAMi+C,EAAOkC,EAAa,GAC1B/mD,KAAK88F,iBAAiBzzC,cAAcxE,EAAKnuC,GAAI,OAAQ1W,KAAK02B,WAAWwS,eACrElpC,KAAKgJ,OAAOpD,KAAK,mBAAmBi/C,EAAK5+C,OAC7C,CACJ,CAIA,GAAIjG,KAAK2C,MAAMqV,aAAa,QAAS,CACjC,MAAMwnF,EAAYx/F,KAAK02B,WAAWgT,eAClC1pC,KAAKgJ,OAAOpD,KAAK,kBAAkB45F,IACvC,CAGA,GAAIx/F,KAAK2C,MAAMqV,aAAa,SAAWhY,KAAKg9F,iBAAkB,CAC1D,MAAMl5C,EAAY9jD,KAAKg9F,iBAAiBnmC,qBACxC72D,KAAKg9F,iBAAiBrmC,YAAY7S,GAClC9jD,KAAKgJ,OAAOpD,KAAK,iBAAiBk+C,EAAuB,SAAX,UAClD,CAGA,GAAI9jD,KAAK2C,MAAMqV,aAAa,SAAWhY,KAAKi9F,eAAgB,CACxD,MAAMn5C,EAAY9jD,KAAKi9F,eAAenhC,oBACtC97D,KAAKi9F,eAAetmC,YAAY7S,GAC3BA,GACD9jD,KAAKi9F,eAAelhC,cAAc,oBAEtC/7D,KAAKgJ,OAAOpD,KAAK,gBAAgBk+C,EAAuB,SAAX,UACjD,CAGA,GAAI9jD,KAAK2C,MAAMqV,aAAa,SAAWhY,KAAKg9F,kBAAoBh9F,KAAKqxD,aAAc,CAC/E,MAAMma,EAAaxrE,KAAKqxD,aAAalB,qBACrC,GAAIqb,EAAY,CACZ,MAAMroB,EAAWv2C,KAAKC,MAAsB,EAAhBD,KAAK2U,UAAgB,EACnCvhB,KAAKg9F,iBAAiBlvC,QAAQ0d,EAAYroB,IAEpDnjD,KAAKgJ,OAAOpD,KAAK,YAAYu9C,MAAaqoB,EAAWvlE,SAASulE,EAAWre,UAEjF,CACJ,CAGA,GAAIntD,KAAK2C,MAAMqV,aAAa,SAAWhY,KAAKi9F,eAAgB,CAExCj9F,KAAKi9F,eAAepjC,cAAc,oBAAqB,oBAEnE75D,KAAKgJ,OAAOpD,KAAK,mCAEjB5F,KAAKgJ,OAAOnD,KAAK,6CAEzB,CAGA,GAAI7F,KAAKk9F,cAAe,CAEpB,GAAIl9F,KAAK2C,MAAMqV,aAAa,SAAU,CACpBhY,KAAKk9F,cAAc3vB,iBAAiB,mBAE9CvtE,KAAKgJ,OAAOxD,MAAM,wBAE1B,CAGA,GAAIxF,KAAK2C,MAAMqV,aAAa,aAAc,CACxBhY,KAAKk9F,cAAc3vB,iBAAiB,oBAE9CvtE,KAAKgJ,OAAOxD,MAAM,uBAE1B,CAGIxF,KAAK2C,MAAMqV,aAAa,UACxBhY,KAAKk9F,cAAc1vB,uBACnBxtE,KAAKgJ,OAAOpD,KAAK,gCAIjB5F,KAAK2C,MAAMqV,aAAa,UACxBhY,KAAKk9F,cAAclvB,cACnBhuE,KAAKgJ,OAAOpD,KAAK,yBAEzB,CAGA,GAAI5F,KAAKs9F,gBAAiB,CAEtB,GAAIt9F,KAAK2C,MAAMqV,aAAa,QAAS,CACjC,MAAMynF,EAAYz/F,KAAK02B,YAAYwS,eAAiB,CAAEx8B,EAAG,EAAGC,EAAG,GACzDk/D,EAAY7rE,KAAKs9F,gBAAgBhX,wBAAwBmZ,GAC3D5zB,GACA7rE,KAAKgJ,OAAOpD,KAAK,0CAA0CimE,EAAUoX,YAE7E,CAGA,GAAIjjF,KAAK2C,MAAMqV,aAAa,QAAS,CACjC,MAAMoqD,EAAWpiE,KAAKs9F,gBAAgBtV,iBACtC,GAAI5lB,EAASx7D,OAAS,EAAG,CACrB,MAAM84F,EAAgBt9B,EAASx1D,KAAKC,MAAMD,KAAK2U,SAAW6gD,EAASx7D,SAC7Do4E,EAASpyE,KAAKC,MAAsB,GAAhBD,KAAK2U,UAAiB,GAChDvhB,KAAKs9F,gBAAgBta,iBAAiB0c,EAAchpF,GAAIsoE,EAAQ,2BACpE,CACJ,CACJ,CAEA,GAAIh/E,KAAKu9F,QAAS,CAEd,GAAIv9F,KAAK2C,MAAMqV,aAAa,QAAS,CACjC,MAAMynF,EAAYz/F,KAAK02B,YAAYwS,eAAiB,CAAEx8B,EAAG,EAAGC,EAAG,GACzDiuE,EAAU3lD,OAAOtc,OAAOuwE,GAAct8E,KAAKC,MAAMD,KAAK2U,SAAW0T,OAAOtc,OAAOuwE,GAActiF,SACjF5G,KAAKu9F,QAAQnR,kBAAkBxR,EAAS6kB,EAAW,WACrEz/F,KAAKgJ,OAAOpD,KAAK,iCAAiCg1E,IACtD,CAGA,GAAI56E,KAAK2C,MAAMqV,aAAa,QAAS,CACjC,MAAMs0D,EAAatsE,KAAKu9F,QAAQ5vB,sBAChC,GAAIrB,EAAW1lE,OAAS,EAAG,CACvB,MAAMilE,EAAYS,EAAW,GACvB4hB,EAAWluF,KAAKu9F,QAAQ/P,oBAC1B3hB,EAAUn1D,GACV,cACA,GACA,qBAEJ1W,KAAKgJ,OAAOpD,KAAK,sBAAsBsoF,EAASjqF,UAAUiqF,EAASjhC,cACvE,CACJ,CACJ,CAGA,GAAIjtD,KAAKw9F,kBAEDx9F,KAAK2C,MAAMqV,aAAa,SACxBhY,KAAKw9F,gBAAgB50E,eAAe/D,EAAU86E,MAAO,GAIrD3/F,KAAK2C,MAAMqV,aAAa,SACxBhY,KAAKw9F,gBAAgB50E,eAAe/D,EAAU+6E,UAAW,GAIzD5/F,KAAK2C,MAAMqV,aAAa,SAAS,CACjC,MAAM6nF,EAAS,CAAC,aAAc,eAAgB,gBACxC36E,EAAellB,KAAKw9F,gBAAgB5xE,gBAAgB1G,aACpDmM,EAAewuE,EAAOvuE,QAAQpM,GAAgB,cAC9C46E,EAAYD,GAAQxuE,EAAe,GAAKwuE,EAAOj5F,QACrD5G,KAAKw9F,gBAAgB1zE,kBAAkBg2E,EAC3C,CAGJ,GAAI9/F,KAAKy9F,mBAAoB,CAEzB,GAAIz9F,KAAK2C,MAAMqV,aAAa,QAAS,CACjC,MAAMgd,EAAWh1B,KAAKy9F,mBAAmBtF,cACzCn4F,KAAKy9F,mBAAmBzF,eAAe,CACnC9E,cAAel+D,EAASk+D,eAE5BlzF,KAAKgJ,OAAOpD,KAAK,0BAA0BovB,EAASk+D,aAAsB,MAAP,MACvE,CAGA,GAAIlzF,KAAK2C,MAAMqV,aAAa,QAAS,CACjC,MAAM+nF,EAAU//F,KAAKy9F,mBAAmBjG,wBACxCx3F,KAAKgJ,OAAOpD,KAAK,mBAAmBm6F,EAAQhI,qBAAqBnrF,KAAKsE,MAAM6uF,EAAQrI,oBAAoB9qF,KAAKsE,MAAM6uF,EAAQjI,+BAC/H,CACJ,CAiBA,GAdI93F,KAAKm9F,oBAEDn9F,KAAK2C,MAAMqV,aAAa,UACxBhY,KAAKm9F,kBAAkBhtB,cAAc,KACrCnwE,KAAKgJ,OAAOpD,KAAK,oBAIjB5F,KAAK2C,MAAMqV,aAAa,UACxBhY,KAAKm9F,kBAAkB3sB,mBAAmB,qBAAsB,IAChExwE,KAAKgJ,OAAOpD,KAAK,oCAIrB5F,KAAKo9F,gBAEDp9F,KAAK2C,MAAMqV,aAAa,QAAS,CACjBhY,KAAKo9F,eAAe1nB,cAAc,gBAAiB,YAAa,CAAC,aAE7E11E,KAAKgJ,OAAOpD,KAAK,qCAEjB5F,KAAKgJ,OAAOnD,KAAK,2BAEzB,CAGJ,GAAI7F,KAAKq9F,gBAEDr9F,KAAK2C,MAAMqV,aAAa,QAAS,CACjC,MAAM8hE,EAAO95E,KAAKq9F,eAAe/c,aACjC,GAAIxG,EAAKlzE,OAAS,EAAG,CACjB,MAAMo5F,EAAalmB,EAAKltE,KAAKC,MAAMD,KAAK2U,SAAWu4D,EAAKlzE,SAElDq5F,EADWjgG,KAAKq9F,eAAe3c,iBACHvuD,KAAKiqC,GAAKA,EAAEse,aAAa9zE,OAASw1D,EAAEoe,SAEtE,GAAIylB,EAAkB,CACDjgG,KAAKq9F,eAAe7f,oBAAoBwiB,EAAWtpF,GAAIupF,EAAiBnmC,YAErF95D,KAAKgJ,OAAOpD,KAAK,eAAeo6F,EAAW/5F,WAAWg6F,EAAiBnmC,YAE/E,CACJ,CACJ,CAIA95D,KAAK2C,MAAMoW,mBACP/Y,KAAKw+F,aAAa7jE,WAClB36B,KAAKw+F,aAAajoE,SAASnB,EAAU8qE,QAC9BlgG,KAAKw+F,aAAa5jE,aACzB56B,KAAKw+F,aAAajoE,SAASnB,EAAU+qE,SAGjD,CAmBA,GAhBIngG,KAAK68F,mBACL78F,KAAK68F,iBAAiBroF,OAAOC,EAAWzU,KAAK2C,OAGzC3C,KAAK02B,aACL12B,KAAK68F,iBAAiBv+C,mBAAmBt+C,KAAK02B,WAAW4S,mBACzDtpC,KAAK68F,iBAAiBt+C,oBAAoBv+C,KAAK02B,WAAW6S,iBAAiBxH,sBAK/E/hC,KAAK88F,kBAAoB98F,KAAK02B,YAC9B12B,KAAK88F,iBAAiBtoF,OAAOC,EAAWzU,KAAK2C,MAAO3C,KAAK02B,WAAWwS,eAIpElpC,KAAK+8F,gBAIL,GAHA/8F,KAAK+8F,gBAAgBvoF,OAAOC,GAGxBzU,KAAK02B,YAAc12B,KAAK02B,WAAW0P,eAAgB,CACnD,MAAMg6D,EAAiBpgG,KAAK02B,WAAW+S,eAAelD,qBACtDvmC,KAAK+8F,gBAAgBjxC,qBAAqBs0C,EAC9C,SAAWpgG,KAAK02B,YAAiD,iBAAnC12B,KAAK02B,WAAWgT,eAAmC,CAE7E,MAAMloB,EAAWxhB,KAAK02B,WAAW+S,eAAenD,kBAChDtmC,KAAK+8F,gBAAgBhyC,eAAevpC,EACxC,CASJ,GALIxhB,KAAKi9F,gBACLj9F,KAAKi9F,eAAezoF,OAAOC,GAI3BzU,KAAKk9F,eAAiBl9F,KAAK02B,WAAY,CACvC,MAAM0Q,EAAcpnC,KAAK02B,WAAW4S,kBACpCtpC,KAAKk9F,cAAc75B,aACfrjE,KAAK02B,WAAWwS,cAChBlpC,KAAK02B,WAAWyS,cAChB,GACA/B,EAAY/K,KACZ,KAEJr8B,KAAKk9F,cAAc1oF,OAAOC,EAC9B,CAgBA,GAbIzU,KAAKo9F,gBACLp9F,KAAKo9F,eAAe5oF,OAAOC,GAG3BzU,KAAKq9F,gBACLr9F,KAAKq9F,eAAe7oF,OAAOC,GAI/BzU,KAAKy9F,oBAAoBjpF,OAAOC,GAChCzU,KAAK09F,gBAAgBlpF,OAAOC,GAGxBzU,KAAKy9F,mBAAoB,CACzB,MAAM4C,EAAargG,KAAKw9F,iBAAiB5xE,gBACzC5rB,KAAKy9F,mBAAmBtG,eAAe,CACnCF,gBAAiBj3F,KAAK88F,kBAAkBxzC,mBAAmB1iD,QAAU,GAAK,EAC1Ewe,aAAci7E,GAAYj7E,cAAgB,EAC1Cvb,UAAW,EACXC,UAAW,IACXotF,cAAe,IAEvB,CACJ,CAKQ,MAAA7jE,GAEJrzB,KAAKszB,SAASxnB,aAGV9L,KAAK+8F,iBAAmB/8F,KAAK02B,YAAc12B,KAAKw+F,aAAa3jE,gBAC7D76B,KAAK+8F,gBAAgB1pE,OAAOrzB,KAAKszB,SAAUtzB,KAAK02B,WAAWwS,eAI/DlpC,KAAKw+F,aAAanrE,OAAOrzB,KAAKszB,UAG1BtzB,KAAK02B,YAAc12B,KAAKw+F,aAAa3jE,iBAErC76B,KAAK02B,WAAWqS,sBAAsB/oC,KAAKszB,UAG3CtzB,KAAK02B,WAAWiT,kBAAkB3pC,KAAKszB,WAIvCtzB,KAAK88F,kBAAoB98F,KAAK02B,YAAc12B,KAAKw+F,aAAa3jE,gBAC9D76B,KAAK88F,iBAAiBzpE,OAAOrzB,KAAKszB,SAAUtzB,KAAK02B,WAAWwS,eAI5DlpC,KAAK68F,kBACL78F,KAAK68F,iBAAiBxpE,OAAOrzB,KAAKszB,UAIlCtzB,KAAKg9F,kBAAoBh9F,KAAKg9F,iBAAiBnmC,sBAC/C72D,KAAKg9F,iBAAiB3pE,OAAOrzB,KAAKszB,UAGlCtzB,KAAKi9F,gBAAkBj9F,KAAKi9F,eAAenhC,qBAC3C97D,KAAKi9F,eAAe5pE,OAAOrzB,KAAKszB,UAIhCtzB,KAAKk9F,eACLl9F,KAAKk9F,cAAc7pE,OAAOrzB,KAAKszB,UAI/BtzB,KAAKiF,OAAOo5F,aACZr+F,KAAKsgG,kBAILtgG,KAAK09F,gBACL19F,KAAK09F,eAAerqE,OAAOrzB,KAAKszB,UAIpCtzB,KAAKszB,SAASrnB,UAClB,CAKQ,eAAAq0F,GACJ,MAAMC,EAAY,CACd,QAAQvgG,KAAK+9F,iBAAiBrG,WAAWruF,QAAQ,KACjD,eAAerJ,KAAK+9F,iBAAiB9J,UAAU5qF,QAAQ,OACvD,gBAAgBrJ,KAAK+9F,iBAAiBC,WAAW30F,QAAQ,OACzD,gBAAgBrJ,KAAK+9F,iBAAiBE,WAAW50F,QAAQ,OACzD,aAAarJ,KAAKS,WAClB,UAAUT,KAAKw+F,aAAa3pE,oBAC5B,YAAY70B,KAAKymC,QAAQ5oB,oBAG7B7d,KAAKszB,SAASzkB,gBAAgB0xF,EAAW,GAAI,GACjD,CAKQ,sBAAAtB,CAAuB77E,GAE3BpjB,KAAKsyF,aAEDlvE,EAAcpjB,KAAK89F,eAAiB,MACpC99F,KAAK+9F,iBAAiBrG,WAAa13F,KAAKsyF,WACxCtyF,KAAKsyF,WAAa,EAClBtyF,KAAK89F,cAAgB16E,EAGhBlgB,YAAoBkxF,SACrBp0F,KAAK+9F,iBAAiBG,YAAeh7F,YAAoBkxF,OAAOE,eAAiB,KAAO,OAKhGt0F,KAAK+9F,iBAAiB9J,UAA6B,IAAjBj0F,KAAKyU,UACvCzU,KAAK+9F,iBAAiBC,WAAah+F,KAAKm+F,WAAW11F,IAAI,WAAa,EACpEzI,KAAK+9F,iBAAiBE,WAAaj+F,KAAKm+F,WAAW11F,IAAI,WAAa,CACxE,CAKA,KAAA+3F,GACSxgG,KAAK29F,YAAa39F,KAAK49F,WAI5B59F,KAAK49F,UAAW,EAChB59F,KAAKyD,MAAM8gB,WACXvkB,KAAKgJ,OAAOpD,KAAK,kBACrB,CAKA,SAAA66F,GACI,OAAOzgG,KAAK49F,QAChB,CAKA,MAAA79E,GACS/f,KAAK29F,WAAc39F,KAAK49F,WAI7B59F,KAAK49F,UAAW,EAChB59F,KAAK69F,SAAW36F,YAAYoD,MAC5BtG,KAAKyD,MAAMghB,YACXzkB,KAAKgJ,OAAOpD,KAAK,mBACrB,CAKA,IAAA2d,GACSvjB,KAAK29F,YAIV39F,KAAK29F,WAAY,EACjB39F,KAAK49F,UAAW,EAChB59F,KAAKyD,MAAMihB,UACX1kB,KAAKgJ,OAAOpD,KAAK,mBACrB,CAKA,YAAAgL,GACI5Q,KAAKszB,SAAS1iB,eACd5Q,KAAKgJ,OAAOxD,MAAM,kBACtB,CAKQ,gBAAAixB,GACJz2B,KAAKgJ,OAAOpD,KAAK,iCAEjB,IAEI,IAAIk9B,EAAe,CAAEp2B,EAAG,IAAKC,EAAG,KAEhC,GAAI3M,KAAK48F,cAAe,CACpB,MAAM/lE,EAAgB72B,KAAK48F,cAAcrlD,mBACrC1gB,IAEAiM,EAAe,CACXp2B,EAAGmqB,EAAcsU,KAAKzwB,SAAShO,EAAI,IACnCC,EAAGkqB,EAAcsU,KAAKzwB,SAAS/N,EAAI,KAG/C,CAEA3M,KAAK02B,WAAa,IAAI8P,EAClBxmC,KAAKymC,QACLzmC,KAAK2C,MACL3C,KAAKyD,MACLq/B,GAIJ,MAAMnN,EAAqB,GAE3B,GAAI31B,KAAK48F,cAAe,CACpB,MAAM/lE,EAAgB72B,KAAK48F,cAAcrlD,mBACzC,GAAI1gB,EAAe,CAEf,MAAM6pE,EAAU1gG,KAAKymC,QAAQvoB,aACzB2Y,EAAcsU,KAAKz0B,GACnB,CAAEhK,EAAG,IAAKC,EAAG,KACa,IAA1BkqB,EAAcsU,KAAKtwB,KACnBjO,KAAKuD,IAAgC,GAA5B0mB,EAAcsU,KAAKn9B,OAAa,KAE7ChO,KAAKymC,QAAQjtB,UAAUknF,GACvB1gG,KAAKymC,QAAQ5sB,eAAegd,EAAcsU,KAAKz0B,GAAI,CAC/CgE,SAAUgmF,EAAQhmF,SAClBG,KAAM6lF,EAAQ7lF,KACd7M,OAAQ,MAEZ2nB,EAAYhvB,KAAK+5F,GAGjB7pE,EAAc6D,QAAQvrB,QAAQ,CAACgqB,EAAQrsB,KACnC,MAAMo3B,EAASp3B,EAAQF,KAAKuU,GAAK,EAAK0V,EAAc6D,QAAQ9zB,OACtD6J,EAAW,IAA8B,GAAvB0oB,EAAOoV,cAEzBoyD,EAAY,CACdj0F,EAAG,IAAME,KAAKiX,IAAIqgB,GAASzzB,EAC3B9D,EAAG,IAAMC,KAAKqU,IAAIijB,GAASzzB,GAGzBmwF,EAAY5gG,KAAKymC,QAAQvoB,aAC3Bib,EAAOziB,GACPiqF,EACc,IAAdxnE,EAAOte,KACPjO,KAAKoC,IAAoB,GAAhBmqB,EAAOnrB,OAAa,KAGjChO,KAAKymC,QAAQjtB,UAAUonF,GACvBjrE,EAAYhvB,KAAKi6F,KAGrB5gG,KAAKgJ,OAAOpD,KAAK,uBAAuBixB,EAAc5wB,aAAa4wB,EAAc6D,QAAQ9zB,iBAC7F,CACJ,CAGA,GAAI5G,KAAK48F,eAAiB58F,KAAK88F,iBAAkB,CAC7C,MAAMjmE,EAAgB72B,KAAK48F,cAAcrlD,mBACrC1gB,IACA72B,KAAK88F,iBAAiBt1C,WAAW,CAC7BE,WAAY7wB,EACZ2qB,eAAgB,CAAE90C,EAAG,IAAKC,EAAG,OAIjC3M,KAAK88F,iBAAiB/zC,oBAEtB/oD,KAAKgJ,OAAOpD,KAAK,+BAA+BixB,EAAc5wB,QAEtE,CAGA,GAA2B,IAAvB0vB,EAAY/uB,OAAc,CAC1B,MAAMi6F,EAAU7gG,KAAKymC,QAAQvoB,aAAa,gBAAiB,CAAExR,EAAG,IAAKC,EAAG,KAAO,IAAS,IAClFm0F,EAAU9gG,KAAKymC,QAAQvoB,aAAa,gBAAiB,CAAExR,EAAG,IAAKC,EAAG,KAAO,IAAQ,IAEvF3M,KAAKymC,QAAQjtB,UAAUqnF,GACvB7gG,KAAKymC,QAAQjtB,UAAUsnF,GAEvB9gG,KAAKymC,QAAQ5sB,eAAe,gBAAiB,CACzCa,SAAUmmF,EAAQnmF,SAClBG,KAAMgmF,EAAQhmF,KACd7M,OAAQ,MAGZhO,KAAKymC,QAAQ5sB,eAAe,gBAAiB,CACzCa,SAAUomF,EAAQpmF,SAClBG,KAAMimF,EAAQjmF,KACd7M,OAAQ,MAGZ2nB,EAAYhvB,KAAKk6F,EAASC,EAC9B,CAGA9gG,KAAKw+F,aAAajkE,YAAYv6B,KAAK02B,WAAWuS,oBAC9CjpC,KAAKw+F,aAAa/jE,eAAe9E,GAEjC31B,KAAKgJ,OAAOpD,KAAK,iCAErB,OAASE,GACL9F,KAAKgJ,OAAOlD,MAAM,iCAAkCA,EACxD,CACJ,CAKA,WAAAo5F,CAAYp5F,GACR9F,KAAKgJ,OAAOlD,MAAM,qBAAsBA,GAGxC,IAEI9F,KAAKwgG,QAGLxgG,KAAKw+F,aAAajoE,SAASnB,EAAUpvB,MAEzC,OAAS+6F,GACL/gG,KAAKgJ,OAAO9C,SAAS,+BAAgC66F,GAErD/gG,KAAKujB,MACT,CACJ,CAKQ,aAAAizB,GACJ0B,YAAY,KACJl4C,KAAK29F,YAAc39F,KAAK49F,UACxB59F,KAAKghG,YAEVhhG,KAAKiF,OAAOutB,iBACnB,CAKA,cAAMwuE,GACF,UACUhhG,KAAKw+F,aAAanwF,OACxBrO,KAAKgJ,OAAOxD,MAAM,gBACtB,OAASM,GACL9F,KAAKgJ,OAAOlD,MAAM,sBAAuBA,EAC7C,CACJ,CAKA,cAAM4pB,GACF,UACU1vB,KAAKw+F,aAAazkE,OACxB/5B,KAAKgJ,OAAOpD,KAAK,iBACrB,OAASE,GACL9F,KAAKgJ,OAAOlD,MAAM,sBAAuBA,EAC7C,CACJ,CAKA,aAAMwL,GACFtR,KAAKgJ,OAAOpD,KAAK,oCAEjB5F,KAAKujB,OAEDvjB,KAAKszB,UACLtzB,KAAKszB,SAAShiB,UAGdtR,KAAKyD,OACLzD,KAAKyD,MAAM6N,UAGXtR,KAAK2C,OACL3C,KAAK2C,MAAM2O,UAGXtR,KAAK02B,YACL12B,KAAK02B,WAAWplB,UAGhBtR,KAAK48F,qBACC58F,KAAK48F,cAActrF,UAGzBtR,KAAK88F,kBACL98F,KAAK88F,iBAAiBxrF,UAItBtR,KAAKg9F,kBACLh9F,KAAKg9F,iBAAiBzlC,iBAG1Bv3D,KAAKgJ,OAAOpD,KAAK,2BACrB,CAGA,WAAAq7F,GACI,OAAOjhG,KAAK49F,QAChB,CAEA,aAAAsD,GACI,OAAOlhG,KAAK29F,SAChB,CAEA,mBAAAwD,GACI,MAAO,IAAKnhG,KAAK+9F,iBACrB,CAEA,WAAAqD,GACI,OAAOphG,KAAKszB,QAChB,CAEA,QAAA+tE,GACI,OAAOrhG,KAAK2C,KAChB,CAEA,UAAA2+F,GACI,OAAOthG,KAAKymC,OAChB,CAEA,QAAA86D,GACI,OAAOvhG,KAAKyD,KAChB,CAEA,eAAA+9F,GACI,OAAOxhG,KAAKw+F,YAChB,ECxxCJ,IAAIiD,GAAoB,KAKxB,MAAMC,GAKF,WAAA58F,GAFA9E,KAAQ2hG,gBAAkB,EAGtB3hG,KAAK4hG,gBAAkB9/F,SAAS+/F,eAAe,mBAC/C7hG,KAAK8hG,YAAchgG,SAAS+/F,eAAe,cAC/C,CAEA,cAAAE,CAAevgF,EAAkBpT,GAC7BpO,KAAK2hG,gBAAkB/0F,KAAKoC,IAAIhP,KAAK2hG,gBAAiBngF,GACtDxhB,KAAK4hG,gBAAgB36F,MAAMwD,MAAQ,GAAGzK,KAAK2hG,mBAEvCvzF,IACApO,KAAK8hG,YAAYE,YAAc5zF,EAEvC,CAEA,IAAA6zF,GACI,MAAMC,EAAgBpgG,SAAS+/F,eAAe,iBAC9CK,EAAcC,UAAU3sF,IAAI,UAE5BkW,WAAW,KACPw2E,EAAcj7F,MAAMm7F,QAAU,QAC/B,IACP,EAMJtiF,eAAeuiF,KACX,MAAMC,EAAS,IAAIZ,GACb14F,EAAS,IAAIO,EAAO,QAE1B,IACIP,EAAOpD,KAAK,uDAGZ08F,EAAOP,eAAe,GAAI,yBAC1B,MAAMthG,EAAWkE,EAAiB5E,SAClCiJ,EAAOpD,KAAK,sBAAsBnF,KAGlC6hG,EAAOP,eAAe,GAAI,4BAC1B,MAAM1/F,EAASP,SAAS+/F,eAAe,cACvC,IAAKx/F,EACD,MAAM,IAAI2D,MAAM,yBAIhBvF,IAAaZ,EAASwK,QACtBk4F,GAAsBlgG,GAI1BigG,EAAOP,eAAe,GAAI,iCAuElCjiF,iBAGI,OAAO,IAAI2tB,QAAQC,IACfhiB,WAAWgiB,EAAS,MAE5B,CA5Ec80D,GAGNF,EAAOP,eAAe,GAAI,+BAC1BN,GAAO,IAAI9E,GAAKt6F,EAAQ5B,GAGxB6hG,EAAOP,eAAe,GAAI,wBAG1B,MAAMU,EAAmBvqD,YAAY,KACjC,MAAMypD,EAAkB/0F,KAAKuD,IAAI,GAAI,GAAKvD,KAAKC,MAAsB,GAAhBD,KAAK2U,WAC1D+gF,EAAOP,eAAeJ,EAAiB,yBACxC,KAEH,UACUF,GAAK92F,aACXstC,cAAcwqD,EAClB,OAAS38F,GAEL,MADAmyC,cAAcwqD,GACR38F,CACV,CAGAw8F,EAAOP,eAAe,GAAI,yBA2D9B7hG,OAAO2S,iBAAiB,SAAU,KAC1B4uF,IAAQ98F,EAAiB5E,WAAaF,EAASwK,SAE/Ck4F,GADezgG,SAAS+/F,eAAe,eAEvCJ,GAAK7wF,kBAKb9O,SAAS+Q,iBAAiB,mBAAoB,KACtC4uF,KACI3/F,SAASmuE,OACTwxB,GAAKjB,QAELiB,GAAK1hF,YAMjB7f,OAAO2S,iBAAiB,eAAgB,KAChC4uF,IACAA,GAAKnwF,YAKbpR,OAAO2S,iBAAiB,QAAU0sE,IACf,IAAIh2E,EAAO,eACnBzD,MAAM,mBAAoBy5E,EAAMz5E,OAEnC27F,IACAA,GAAKvC,YAAY3f,EAAMz5E,SAvF3Bw8F,EAAOP,eAAe,IAAK,qCACrB,IAAIt0D,QAAQC,GAAWhiB,WAAWgiB,EAAS,MAEjD40D,EAAOL,aACDR,GAAKj5F,QAEXQ,EAAOpD,KAAK,8CAEhB,OAASE,GACLkD,EAAOlD,MAAM,+BAAgCA,GAsFrD,SAAyBA,GACrB,MAAMo8F,EAAgBpgG,SAAS+/F,eAAe,iBACxCa,EAAc5gG,SAAS+/F,eAAe,eACtCc,EAAa7gG,SAAS+/F,eAAe,cAE3Ca,EAAYV,YAAc,0BAC1BU,EAAYz7F,MAAMqF,MAAQ,OAC1Bq2F,EAAW17F,MAAMm7F,QAAU,OAG3B,MAAMQ,EAAe9gG,SAAS+gG,cAAc,OAC5CD,EAAa37F,MAAM67F,QAAU,iTAY7BF,EAAaG,UAAY,0CACUj9F,EAAML,qHAEYK,EAAMC,0JAM3Dm8F,EAAcc,YAAYJ,EAC9B,CAtHQK,CAAgBn9F,EACpB,CACJ,CAKA,SAASy8F,GAAsBlgG,GAC3B,MACM6gG,EADYphG,SAAS+/F,eAAe,iBACVttF,wBAG1B4uF,EAAc,KAAO,IAC3B,IAAI14F,EAAQy4F,EAAcz4F,MAAQ,GAC9BC,EAASD,EAAQ04F,EAEjBz4F,EAASw4F,EAAcx4F,OAAS,KAChCA,EAASw4F,EAAcx4F,OAAS,GAChCD,EAAQC,EAASy4F,GAGrB9gG,EAAO4E,MAAMwD,MAAQ,GAAGA,MACxBpI,EAAO4E,MAAMyD,OAAS,GAAGA,MAGzBrI,EAAOoI,MAAQ,KACfpI,EAAOqI,OAAS,GACpB,CAiI4B,YAAxB5I,SAASshG,WACTthG,SAAS+Q,iBAAiB,mBAAoBwvF,IAE9CA"}