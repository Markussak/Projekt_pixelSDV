{"version":3,"file":"main-C_M4W70V.js","sources":["../../src/utils/Platform.ts","../../src/utils/Logger.ts","../../src/core/Renderer.ts","../../src/core/InputManager.ts","../../src/core/Physics.ts","../../src/core/AudioEngine.ts","../../src/audio/ProceduralAudio.ts","../../src/ui/MainMenu.ts","../../src/core/GameStateManager.ts","../../src/entities/ShipSystems.ts","../../src/systems/WarpDrive.ts","../../src/entities/PlayerShip.ts","../../src/procedural/GalaxyGenerator.ts","../../src/procedural/GalaxyPersistence.ts","../../src/procedural/GalaxyManager.ts","../../src/ui/CockpitStatusBar.ts","../../src/entities/CelestialBody.ts","../../src/ui/InteractionPanel.ts","../../src/managers/CelestialManager.ts","../../src/rendering/SpaceBackground.ts","../../src/items/ItemSystem.ts","../../src/inventory/InventoryManager.ts","../../src/crafting/CraftingSystem.ts","../../src/combat/WeaponSystem.ts","../../src/combat/EnemyAI.ts","../../src/combat/CombatManager.ts","../../src/rpg/PlayerProgression.ts","../../src/rpg/ResearchSystem.ts","../../src/rpg/CrewManagement.ts","../../src/diplomacy/DiplomacySystem.ts","../../src/ai/AlienAI.ts","../../src/optimization/PerformanceMonitor.ts","../../src/effects/ParticleSystem.ts","../../src/core/Game.ts","../../src/main.ts"],"sourcesContent":["/**\n * Platform Detection and Management\n * Handles different deployment targets and adaptive features\n */\n\nexport enum Platform {\n    Desktop = 'desktop',\n    Mobile = 'mobile',\n    Web = 'web',\n    Tauri = 'tauri',\n    Cordova = 'cordova'\n}\n\nexport interface PlatformFeatures {\n    hasKeyboard: boolean;\n    hasTouch: boolean;\n    hasFileSystem: boolean;\n    hasFullscreen: boolean;\n    canVibrate: boolean;\n    preferredInputMethod: 'keyboard' | 'touch' | 'hybrid';\n    storageType: 'localStorage' | 'fileSystem' | 'indexedDB';\n}\n\nexport class PlatformDetector {\n    private static cachedPlatform: Platform | null = null;\n    private static cachedFeatures: PlatformFeatures | null = null;\n\n    /**\n     * Detect the current platform\n     */\n    static detect(): Platform {\n        if (this.cachedPlatform) {\n            return this.cachedPlatform;\n        }\n\n        // Check for Tauri (desktop app)\n        if ((window as any).__TAURI__) {\n            this.cachedPlatform = Platform.Tauri;\n            return this.cachedPlatform;\n        }\n\n        // Check for Cordova (mobile app)\n        if ((window as any).cordova) {\n            this.cachedPlatform = Platform.Cordova;\n            return this.cachedPlatform;\n        }\n\n        // Check for mobile browser\n        if (this.isMobile()) {\n            this.cachedPlatform = Platform.Mobile;\n            return this.cachedPlatform;\n        }\n\n        // Check for desktop browser\n        if (this.isDesktop()) {\n            this.cachedPlatform = Platform.Desktop;\n            return this.cachedPlatform;\n        }\n\n        // Default to web\n        this.cachedPlatform = Platform.Web;\n        return this.cachedPlatform;\n    }\n\n    /**\n     * Get platform-specific features\n     */\n    static getFeatures(): PlatformFeatures {\n        if (this.cachedFeatures) {\n            return this.cachedFeatures;\n        }\n\n        const platform = this.detect();\n        \n        this.cachedFeatures = {\n            hasKeyboard: this.hasKeyboard(platform),\n            hasTouch: this.hasTouch(),\n            hasFileSystem: this.hasFileSystem(platform),\n            hasFullscreen: this.hasFullscreen(),\n            canVibrate: this.canVibrate(),\n            preferredInputMethod: this.getPreferredInput(platform),\n            storageType: this.getStorageType(platform)\n        };\n\n        return this.cachedFeatures;\n    }\n\n    /**\n     * Check if running on mobile device\n     */\n    private static isMobile(): boolean {\n        // Check user agent\n        const userAgent = navigator.userAgent || navigator.vendor || (window as any).opera;\n        \n        // Check for mobile patterns\n        const mobileRegex = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i;\n        if (mobileRegex.test(userAgent)) {\n            return true;\n        }\n\n        // Check for touch capability and small screen\n        const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n        const smallScreen = window.innerWidth <= 768 || window.innerHeight <= 768;\n        \n        return hasTouch && smallScreen;\n    }\n\n    /**\n     * Check if running on desktop\n     */\n    private static isDesktop(): boolean {\n        // Check for desktop-specific features\n        const hasKeyboard = !this.isMobile();\n        const largeScreen = window.innerWidth > 768 && window.innerHeight > 768;\n        \n        // Check user agent for desktop patterns\n        const userAgent = navigator.userAgent;\n        const desktopOS = /windows|mac|linux/i.test(userAgent);\n        \n        return hasKeyboard && largeScreen && desktopOS;\n    }\n\n    /**\n     * Check if platform has keyboard support\n     */\n    private static hasKeyboard(platform: Platform): boolean {\n        switch (platform) {\n            case Platform.Desktop:\n            case Platform.Tauri:\n                return true;\n            case Platform.Mobile:\n            case Platform.Cordova:\n                return false;\n            case Platform.Web:\n                return !this.isMobile();\n            default:\n                return true;\n        }\n    }\n\n    /**\n     * Check if platform has touch support\n     */\n    private static hasTouch(): boolean {\n        return 'ontouchstart' in window || navigator.maxTouchPoints > 0;\n    }\n\n    /**\n     * Check if platform has file system access\n     */\n    private static hasFileSystem(platform: Platform): boolean {\n        switch (platform) {\n            case Platform.Tauri:\n            case Platform.Cordova:\n                return true;\n            default:\n                return false;\n        }\n    }\n\n    /**\n     * Check if platform supports fullscreen\n     */\n    private static hasFullscreen(): boolean {\n        return !!(\n            document.fullscreenEnabled ||\n            (document as any).webkitFullscreenEnabled ||\n            (document as any).mozFullScreenEnabled ||\n            (document as any).msFullscreenEnabled\n        );\n    }\n\n    /**\n     * Check if platform can vibrate\n     */\n    private static canVibrate(): boolean {\n        return 'vibrate' in navigator;\n    }\n\n    /**\n     * Get preferred input method for platform\n     */\n    private static getPreferredInput(platform: Platform): 'keyboard' | 'touch' | 'hybrid' {\n        switch (platform) {\n            case Platform.Desktop:\n            case Platform.Tauri:\n                return 'keyboard';\n            case Platform.Mobile:\n            case Platform.Cordova:\n                return 'touch';\n            case Platform.Web:\n                return this.hasTouch() ? 'hybrid' : 'keyboard';\n            default:\n                return 'hybrid';\n        }\n    }\n\n    /**\n     * Get storage type for platform\n     */\n    private static getStorageType(platform: Platform): 'localStorage' | 'fileSystem' | 'indexedDB' {\n        switch (platform) {\n            case Platform.Tauri:\n            case Platform.Cordova:\n                return 'fileSystem';\n            case Platform.Desktop:\n            case Platform.Mobile:\n            case Platform.Web:\n                return 'indexedDB';\n            default:\n                return 'localStorage';\n        }\n    }\n\n    /**\n     * Get platform-specific configuration\n     */\n    static getConfig() {\n        const platform = this.detect();\n        const features = this.getFeatures();\n\n        return {\n            platform,\n            features,\n            canvas: {\n                // Adjust canvas settings based on platform\n                pixelRatio: window.devicePixelRatio || 1,\n                maxWidth: features.hasTouch ? 800 : 1024,\n                maxHeight: features.hasTouch ? 600 : 768,\n                scalingMode: features.hasTouch ? 'fit' : 'native'\n            },\n            input: {\n                // Input configuration\n                enableKeyboard: features.hasKeyboard,\n                enableTouch: features.hasTouch,\n                enableGamepad: platform === Platform.Desktop || platform === Platform.Tauri,\n                touchSensitivity: features.hasTouch ? 1.0 : 0.0,\n                keyRepeatDelay: 250,\n                keyRepeatRate: 50\n            },\n            performance: {\n                // Performance settings based on platform\n                targetFPS: platform === Platform.Mobile ? 30 : 60,\n                enableParticles: platform !== Platform.Mobile,\n                enablePostProcessing: platform === Platform.Desktop || platform === Platform.Tauri,\n                enableShadows: platform === Platform.Desktop,\n                enableDithering: true, // Always enable for 16-bit aesthetic\n                renderScale: features.hasTouch ? 0.8 : 1.0\n            },\n            audio: {\n                // Audio settings\n                enableAudio: true,\n                enableMusic: true,\n                enableSFX: true,\n                enableSpatialAudio: platform === Platform.Desktop,\n                audioFormat: 'webm', // Fallback to mp3 if needed\n                maxChannels: platform === Platform.Mobile ? 8 : 16\n            },\n            storage: {\n                // Storage configuration\n                type: features.storageType,\n                enableAutoSave: true,\n                saveInterval: 30000, // 30 seconds\n                maxSaveSlots: platform === Platform.Mobile ? 3 : 10,\n                compressionEnabled: true\n            }\n        };\n    }\n\n    /**\n     * Check if platform supports specific feature\n     */\n    static supports(feature: keyof PlatformFeatures): boolean {\n        return Boolean(this.getFeatures()[feature]);\n    }\n\n    /**\n     * Get human-readable platform name\n     */\n    static getPlatformName(): string {\n        switch (this.detect()) {\n            case Platform.Desktop:\n                return 'Desktop Browser';\n            case Platform.Mobile:\n                return 'Mobile Browser';\n            case Platform.Web:\n                return 'Web Browser';\n            case Platform.Tauri:\n                return 'Desktop Application';\n            case Platform.Cordova:\n                return 'Mobile Application';\n            default:\n                return 'Unknown Platform';\n        }\n    }\n\n    /**\n     * Reset cached values (useful for testing)\n     */\n    static reset(): void {\n        this.cachedPlatform = null;\n        this.cachedFeatures = null;\n    }\n}","/**\n * Advanced Logging System for Space Explorer\n * Provides structured logging with different levels and platform detection\n */\n\nexport enum LogLevel {\n    DEBUG = 0,\n    INFO = 1,\n    WARN = 2,\n    ERROR = 3,\n    CRITICAL = 4\n}\n\nexport interface LogEntry {\n    timestamp: number;\n    level: LogLevel;\n    module: string;\n    message: string;\n    data?: any;\n    stack?: string;\n}\n\nexport class Logger {\n    private static globalLevel: LogLevel = LogLevel.INFO;\n    private static entries: LogEntry[] = [];\n    private static maxEntries = 1000;\n    private static enableConsole = true;\n    private static enableStorage = false;\n\n    private module: string;\n\n    constructor(module: string) {\n        this.module = module;\n    }\n\n    /**\n     * Configure global logger settings\n     */\n    static configure(config: {\n        level?: LogLevel;\n        maxEntries?: number;\n        enableConsole?: boolean;\n        enableStorage?: boolean;\n    }): void {\n        if (config.level !== undefined) Logger.globalLevel = config.level;\n        if (config.maxEntries !== undefined) Logger.maxEntries = config.maxEntries;\n        if (config.enableConsole !== undefined) Logger.enableConsole = config.enableConsole;\n        if (config.enableStorage !== undefined) Logger.enableStorage = config.enableStorage;\n    }\n\n    /**\n     * Set global log level\n     */\n    static setLevel(level: LogLevel): void {\n        Logger.globalLevel = level;\n    }\n\n    /**\n     * Log debug information\n     */\n    debug(message: string, data?: any): void {\n        this.log(LogLevel.DEBUG, message, data);\n    }\n\n    /**\n     * Log informational messages\n     */\n    info(message: string, data?: any): void {\n        this.log(LogLevel.INFO, message, data);\n    }\n\n    /**\n     * Log warnings\n     */\n    warn(message: string, data?: any): void {\n        this.log(LogLevel.WARN, message, data);\n    }\n\n    /**\n     * Log errors\n     */\n    error(message: string, error?: any): void {\n        let stack: string | undefined;\n        let data = error;\n\n        if (error instanceof Error) {\n            stack = error.stack;\n            data = {\n                name: error.name,\n                message: error.message,\n                stack: error.stack\n            };\n        }\n\n        this.log(LogLevel.ERROR, message, data, stack);\n    }\n\n    /**\n     * Log critical errors\n     */\n    critical(message: string, error?: any): void {\n        let stack: string | undefined;\n        let data = error;\n\n        if (error instanceof Error) {\n            stack = error.stack;\n            data = {\n                name: error.name,\n                message: error.message,\n                stack: error.stack\n            };\n        }\n\n        this.log(LogLevel.CRITICAL, message, data, stack);\n    }\n\n    /**\n     * Core logging method\n     */\n    private log(level: LogLevel, message: string, data?: any, stack?: string): void {\n        // Check if this level should be logged\n        if (level < Logger.globalLevel) {\n            return;\n        }\n\n        const entry: LogEntry = {\n            timestamp: Date.now(),\n            level,\n            module: this.module,\n            message,\n            data,\n            stack\n        };\n\n        // Add to entries buffer\n        Logger.addEntry(entry);\n\n        // Output to console if enabled\n        if (Logger.enableConsole) {\n            Logger.outputToConsole(entry);\n        }\n\n        // Store if enabled\n        if (Logger.enableStorage) {\n            Logger.storeEntry(entry);\n        }\n    }\n\n    /**\n     * Add entry to buffer\n     */\n    private static addEntry(entry: LogEntry): void {\n        this.entries.push(entry);\n\n        // Maintain buffer size\n        if (this.entries.length > this.maxEntries) {\n            this.entries.shift();\n        }\n    }\n\n    /**\n     * Output entry to console with proper formatting\n     */\n    private static outputToConsole(entry: LogEntry): void {\n        const timestamp = new Date(entry.timestamp).toISOString();\n        const levelName = LogLevel[entry.level];\n        const prefix = `[${timestamp}] [${levelName}] [${entry.module}]`;\n\n        // Choose console method based on level\n        let consoleMethod: 'debug' | 'log' | 'warn' | 'error';\n        let style = '';\n\n        switch (entry.level) {\n            case LogLevel.DEBUG:\n                consoleMethod = 'debug';\n                style = 'color: #888; font-size: 11px;';\n                break;\n            case LogLevel.INFO:\n                consoleMethod = 'log';\n                style = 'color: #0f0; font-weight: bold;';\n                break;\n            case LogLevel.WARN:\n                consoleMethod = 'warn';\n                style = 'color: #ff0; font-weight: bold;';\n                break;\n            case LogLevel.ERROR:\n                consoleMethod = 'error';\n                style = 'color: #f00; font-weight: bold;';\n                break;\n            case LogLevel.CRITICAL:\n                consoleMethod = 'error';\n                style = 'color: #f00; font-weight: bold; background: #400;';\n                break;\n            default:\n                consoleMethod = 'log';\n        }\n\n        // Format message\n        if (entry.data !== undefined) {\n            console[consoleMethod](`%c${prefix} ${entry.message}`, style, entry.data);\n        } else {\n            console[consoleMethod](`%c${prefix} ${entry.message}`, style);\n        }\n\n        // Show stack trace for errors\n        if (entry.stack && (entry.level === LogLevel.ERROR || entry.level === LogLevel.CRITICAL)) {\n            console.groupCollapsed('Stack Trace');\n            console.error(entry.stack);\n            console.groupEnd();\n        }\n    }\n\n    /**\n     * Store entry to persistent storage\n     */\n    private static async storeEntry(entry: LogEntry): Promise<void> {\n        try {\n            // Store in localStorage for now (could be enhanced for different platforms)\n            const stored = localStorage.getItem('spaceExplorer_logs');\n            const logs = stored ? JSON.parse(stored) : [];\n            \n            logs.push(entry);\n            \n            // Keep only recent entries\n            if (logs.length > this.maxEntries) {\n                logs.splice(0, logs.length - this.maxEntries);\n            }\n            \n            localStorage.setItem('spaceExplorer_logs', JSON.stringify(logs));\n        } catch (error) {\n            // Silently fail if storage is not available\n            console.warn('Failed to store log entry:', error);\n        }\n    }\n\n    /**\n     * Get all log entries\n     */\n    static getEntries(): LogEntry[] {\n        return [...this.entries];\n    }\n\n    /**\n     * Get entries filtered by level\n     */\n    static getEntriesByLevel(level: LogLevel): LogEntry[] {\n        return this.entries.filter(entry => entry.level === level);\n    }\n\n    /**\n     * Get entries filtered by module\n     */\n    static getEntriesByModule(module: string): LogEntry[] {\n        return this.entries.filter(entry => entry.module === module);\n    }\n\n    /**\n     * Clear all log entries\n     */\n    static clear(): void {\n        this.entries = [];\n        \n        if (this.enableStorage) {\n            try {\n                localStorage.removeItem('spaceExplorer_logs');\n            } catch (error) {\n                // Silently fail\n            }\n        }\n    }\n\n    /**\n     * Export logs as JSON string\n     */\n    static export(): string {\n        return JSON.stringify({\n            exported: new Date().toISOString(),\n            platform: navigator.userAgent,\n            entries: this.entries\n        }, null, 2);\n    }\n\n    /**\n     * Load logs from storage\n     */\n    static async loadFromStorage(): Promise<void> {\n        try {\n            const stored = localStorage.getItem('spaceExplorer_logs');\n            if (stored) {\n                const logs = JSON.parse(stored);\n                this.entries = logs.slice(-this.maxEntries);\n            }\n        } catch (error) {\n            console.warn('Failed to load logs from storage:', error);\n        }\n    }\n\n    /**\n     * Performance logging utility\n     */\n    static performance = {\n        timers: new Map<string, number>(),\n\n        start(name: string): void {\n            this.timers.set(name, performance.now());\n        },\n\n        end(name: string, logger?: Logger): number {\n            const startTime = this.timers.get(name);\n            if (startTime === undefined) {\n                console.warn(`Timer \"${name}\" was not started`);\n                return 0;\n            }\n\n            const duration = performance.now() - startTime;\n            this.timers.delete(name);\n\n            if (logger) {\n                logger.debug(`Performance: ${name} took ${duration.toFixed(2)}ms`);\n            }\n\n            return duration;\n        },\n\n        measure<T>(name: string, fn: () => T, logger?: Logger): T {\n            this.start(name);\n            try {\n                const result = fn();\n                this.end(name, logger);\n                return result;\n            } catch (error) {\n                this.end(name, logger);\n                throw error;\n            }\n        },\n\n        async measureAsync<T>(name: string, fn: () => Promise<T>, logger?: Logger): Promise<T> {\n            this.start(name);\n            try {\n                const result = await fn();\n                this.end(name, logger);\n                return result;\n            } catch (error) {\n                this.end(name, logger);\n                throw error;\n            }\n        }\n    };\n\n    /**\n     * Create module-specific performance logger\n     */\n    createPerformanceLogger() {\n        return {\n            start: (name: string) => Logger.performance.start(`${this.module}:${name}`),\n            end: (name: string) => Logger.performance.end(`${this.module}:${name}`, this),\n            measure: <T>(name: string, fn: () => T) => \n                Logger.performance.measure(`${this.module}:${name}`, fn, this),\n            measureAsync: <T>(name: string, fn: () => Promise<T>) => \n                Logger.performance.measureAsync(`${this.module}:${name}`, fn, this)\n        };\n    }\n}\n\n// Configure logger based on environment\nif (import.meta.env.DEV) {\n    Logger.configure({\n        level: LogLevel.DEBUG,\n        enableConsole: true,\n        enableStorage: true\n    });\n} else {\n    Logger.configure({\n        level: LogLevel.INFO,\n        enableConsole: false,\n        enableStorage: true\n    });\n}\n\n// Load existing logs\nLogger.loadFromStorage();","/**\n * HTML5 Canvas Renderer with 16-bit Aesthetic\n * Handles pixel-perfect rendering, WebGL shaders, and retro CRT effects\n */\n\nimport { Platform } from '@utils/Platform';\nimport { Logger } from '@utils/Logger';\n\nexport interface RenderConfig {\n    pixelRatio: number;\n    enablePixelPerfect: boolean;\n    enableDithering: boolean;\n    enableCRT: boolean;\n    enablePostProcessing: boolean;\n    backgroundColor: string;\n}\n\nexport interface Color {\n    r: number;\n    g: number;\n    b: number;\n    a?: number;\n}\n\nexport interface Vector2 {\n    x: number;\n    y: number;\n}\n\nexport interface Sprite {\n    data: ImageData;\n    width: number;\n    height: number;\n}\n\nexport class Renderer {\n    private canvas: HTMLCanvasElement;\n    private ctx: CanvasRenderingContext2D;\n    private platform: Platform;\n    private config: RenderConfig;\n    \n    // WebGL support for shaders\n    private gl: WebGLRenderingContext | null = null;\n    private shaderPrograms: Map<string, WebGLProgram> = new Map();\n    \n    // 16-bit color palette\n    private colorPalette: Color[] = [];\n    \n    // Render targets\n    private backBuffer!: ImageData;\n    private frontBuffer!: ImageData;\n    \n    // Performance tracking\n    private renderStats = {\n        drawCalls: 0,\n        triangles: 0,\n        sprites: 0,\n        particles: 0\n    };\n    \n    private logger: Logger;\n\n    constructor(canvas: HTMLCanvasElement, platform: Platform) {\n        this.canvas = canvas;\n        this.platform = platform;\n        this.logger = new Logger('Renderer');\n        \n        // Get 2D context\n        const ctx = canvas.getContext('2d');\n        if (!ctx) {\n            throw new Error('Failed to get 2D rendering context');\n        }\n        this.ctx = ctx;\n        \n        // Setup configuration\n        this.config = {\n            pixelRatio: window.devicePixelRatio || 1,\n            enablePixelPerfect: true,\n            enableDithering: true,\n            enableCRT: platform !== Platform.Mobile, // Disable CRT on mobile for performance\n            enablePostProcessing: platform === Platform.Desktop,\n            backgroundColor: '#000000'\n        };\n        \n        this.logger.info('🎨 Renderer initialized', {\n            canvasSize: `${canvas.width}x${canvas.height}`,\n            platform: platform,\n            config: this.config\n        });\n    }\n\n    /**\n     * Initialize the renderer\n     */\n    async initialize(): Promise<void> {\n        this.logger.info('🔧 Initializing renderer...');\n        \n        try {\n            // Setup canvas for pixel-perfect rendering\n            this.setupPixelPerfectCanvas();\n            \n            // Generate 16-bit color palette\n            this.generateColorPalette();\n            \n            // Initialize WebGL if available and needed\n            if (this.config.enableCRT || this.config.enablePostProcessing) {\n                this.initializeWebGL();\n            }\n            \n            // Create render buffers\n            this.createRenderBuffers();\n            \n            this.logger.info('✅ Renderer initialization completed');\n            \n        } catch (error) {\n            this.logger.error('❌ Renderer initialization failed', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Setup canvas for pixel-perfect rendering\n     */\n    private setupPixelPerfectCanvas(): void {\n        // Disable image smoothing for pixel art\n        this.ctx.imageSmoothingEnabled = false;\n        (this.ctx as any).webkitImageSmoothingEnabled = false;\n        (this.ctx as any).mozImageSmoothingEnabled = false;\n        (this.ctx as any).msImageSmoothingEnabled = false;\n        \n        // Set pixel ratio scaling\n        const scale = this.config.pixelRatio;\n        this.canvas.style.width = `${this.canvas.width}px`;\n        this.canvas.style.height = `${this.canvas.height}px`;\n        this.canvas.width *= scale;\n        this.canvas.height *= scale;\n        this.ctx.scale(scale, scale);\n        \n        this.logger.debug('Canvas configured for pixel-perfect rendering', {\n            scale: scale,\n            size: `${this.canvas.width}x${this.canvas.height}`\n        });\n    }\n\n        /**\n     * Generate 16-bit color palette - Dark, muted, retro CRT style (Power of Ten/Alien 1979)\n     */\n    private generateColorPalette(): void {\n        this.colorPalette = [\n            // Deep blacks and dark grays (foundation)\n            { r: 0, g: 0, b: 0 },           // Pure black\n            { r: 8, g: 8, b: 8 },           // Very dark gray\n            { r: 16, g: 16, b: 16 },        // Dark gray\n            { r: 24, g: 24, b: 24 },        // Medium dark gray\n\n            // Muted dark greens (classic terminal/CRT phosphor)\n            { r: 4, g: 12, b: 4 },          // Very dark green\n            { r: 8, g: 24, b: 8 },          // Dark green\n            { r: 12, g: 36, b: 12 },        // Muted green\n            { r: 16, g: 48, b: 16 },        // Terminal green\n\n            // Worn amber/yellow (old CRT monitors)\n            { r: 24, g: 16, b: 4 },         // Dark amber\n            { r: 48, g: 32, b: 8 },         // Amber\n            { r: 72, g: 48, b: 12 },        // Worn amber\n            { r: 96, g: 64, b: 16 },        // Bright amber\n\n            // Faded orange warnings (damaged systems)\n            { r: 32, g: 16, b: 4 },         // Dark orange\n            { r: 64, g: 32, b: 8 },         // Faded orange\n            { r: 96, g: 48, b: 12 },        // Orange warning\n            { r: 128, g: 64, b: 16 },       // Bright orange\n\n            // Muted reds (critical alerts)\n            { r: 24, g: 8, b: 8 },          // Very dark red\n            { r: 48, g: 16, b: 16 },        // Dark red\n            { r: 72, g: 24, b: 24 },        // Muted red\n            { r: 96, g: 32, b: 32 },        // Alert red\n\n            // Deep blue-grays (space/depth)\n            { r: 8, g: 12, b: 20 },         // Deep blue-gray\n            { r: 16, g: 24, b: 40 },        // Blue-gray\n            { r: 24, g: 36, b: 60 },        // Space blue\n            { r: 32, g: 48, b: 80 },        // Bright blue-gray\n\n            // Faded cyan/teal (shields/energy)\n            { r: 8, g: 20, b: 16 },         // Dark teal\n            { r: 16, g: 40, b: 32 },        // Teal\n            { r: 24, g: 60, b: 48 },        // Faded cyan\n            { r: 32, g: 80, b: 64 },        // Bright teal\n\n            // Muted purples (exotic/alien)\n            { r: 16, g: 8, b: 24 },         // Dark purple\n            { r: 32, g: 16, b: 48 },        // Purple\n            { r: 48, g: 24, b: 72 },        // Muted purple\n            { r: 64, g: 32, b: 96 },        // Bright purple\n\n            // Light grays and worn whites\n            { r: 32, g: 32, b: 32 },        // Medium gray\n            { r: 48, g: 48, b: 48 },        // Light gray\n            { r: 64, g: 64, b: 64 },        // Bright gray\n            { r: 80, g: 80, b: 80 }         // Worn white\n        ];\n\n        this.logger.debug(`Generated dark retro 16-bit color palette with ${this.colorPalette.length} colors`);\n    }\n\n    /**\n     * Initialize WebGL for shader effects\n     */\n    private initializeWebGL(): void {\n        try {\n            this.gl = this.canvas.getContext('webgl') || this.canvas.getContext('experimental-webgl') as WebGLRenderingContext;\n            \n            if (this.gl) {\n                this.logger.info('✅ WebGL context initialized for shader effects');\n                // TODO: Load and compile shaders in future phases\n            } else {\n                this.logger.info('📺 WebGL not supported, using optimized 2D canvas rendering');\n                this.fallbackTo2D();\n            }\n        } catch (error) {\n            this.logger.info('📺 WebGL unavailable, using 2D canvas fallback', error);\n            this.gl = null;\n            this.fallbackTo2D();\n        }\n    }\n\n    /**\n     * Fallback to 2D canvas rendering with optimizations\n     */\n    private fallbackTo2D(): void {\n        this.config.enableCRT = false;\n        this.config.enablePostProcessing = false;\n        \n        // Enable additional 2D optimizations\n        this.ctx.globalCompositeOperation = 'source-over';\n        \n        // Optimize for performance when WebGL is not available\n        if ((this.ctx as any).willReadFrequently !== undefined) {\n            (this.ctx as any).willReadFrequently = true;\n        }\n        \n        this.logger.debug('2D canvas optimizations applied');\n    }\n\n    /**\n     * Create render buffers for double buffering\n     */\n    private createRenderBuffers(): void {\n        const width = this.canvas.width;\n        const height = this.canvas.height;\n        \n        this.backBuffer = this.ctx.createImageData(width, height);\n        this.frontBuffer = this.ctx.createImageData(width, height);\n        \n        // Fill with background color\n        this.clearBuffer(this.backBuffer, this.hexToColor(this.config.backgroundColor));\n        \n        this.logger.debug('Render buffers created', { width, height });\n    }\n\n    /**\n     * Begin frame rendering\n     */\n    beginFrame(): void {\n        // Clear render stats\n        this.renderStats.drawCalls = 0;\n        this.renderStats.triangles = 0;\n        this.renderStats.sprites = 0;\n        this.renderStats.particles = 0;\n        \n        // Clear canvas\n        this.ctx.fillStyle = this.config.backgroundColor;\n        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n        \n        // Clear back buffer\n        this.clearBuffer(this.backBuffer, this.hexToColor(this.config.backgroundColor));\n    }\n\n    /**\n     * End frame rendering and apply post-processing\n     */\n    endFrame(): void {\n        // Apply dithering if enabled\n        if (this.config.enableDithering) {\n            this.applyDithering(this.backBuffer);\n        }\n        \n        // Copy back buffer to canvas\n        this.ctx.putImageData(this.backBuffer, 0, 0);\n        \n        // Apply CRT effects if enabled\n        if (this.config.enableCRT && this.gl) {\n            this.applyCRTEffect();\n        }\n        \n        this.renderStats.drawCalls++;\n    }\n\n    /**\n     * Clear a buffer with a specific color\n     */\n    private clearBuffer(buffer: ImageData, color: Color): void {\n        const data = buffer.data;\n        for (let i = 0; i < data.length; i += 4) {\n            data[i] = color.r;     // Red\n            data[i + 1] = color.g; // Green\n            data[i + 2] = color.b; // Blue\n            data[i + 3] = color.a !== undefined ? color.a : 255; // Alpha\n        }\n    }\n\n    /**\n     * Set pixel in buffer with dithering\n     */\n    setPixel(x: number, y: number, color: Color): void {\n        x = Math.floor(x);\n        y = Math.floor(y);\n        \n        if (x < 0 || x >= this.canvas.width || y < 0 || y >= this.canvas.height) {\n            return;\n        }\n        \n        const index = (y * this.canvas.width + x) * 4;\n        const data = this.backBuffer.data;\n        \n        data[index] = color.r;\n        data[index + 1] = color.g;\n        data[index + 2] = color.b;\n        data[index + 3] = color.a !== undefined ? color.a : 255;\n    }\n\n    /**\n     * Draw a filled rectangle\n     */\n    fillRect(x: number, y: number, width: number, height: number, color: Color): void {\n        for (let py = y; py < y + height; py++) {\n            for (let px = x; px < x + width; px++) {\n                this.setPixel(px, py, color);\n            }\n        }\n        this.renderStats.drawCalls++;\n    }\n\n    /**\n     * Draw a line using Bresenham's algorithm\n     */\n    drawLine(x0: number, y0: number, x1: number, y1: number, color: Color): void {\n        x0 = Math.floor(x0);\n        y0 = Math.floor(y0);\n        x1 = Math.floor(x1);\n        y1 = Math.floor(y1);\n        \n        const dx = Math.abs(x1 - x0);\n        const dy = Math.abs(y1 - y0);\n        const sx = x0 < x1 ? 1 : -1;\n        const sy = y0 < y1 ? 1 : -1;\n        let err = dx - dy;\n        \n        let x = x0;\n        let y = y0;\n        \n        while (true) {\n            this.setPixel(x, y, color);\n            \n            if (x === x1 && y === y1) break;\n            \n            const e2 = 2 * err;\n            if (e2 > -dy) {\n                err -= dy;\n                x += sx;\n            }\n            if (e2 < dx) {\n                err += dx;\n                y += sy;\n            }\n        }\n        \n        this.renderStats.drawCalls++;\n    }\n\n    /**\n     * Draw a circle\n     */\n    drawCircle(centerX: number, centerY: number, radius: number, color: Color, filled: boolean = false): void {\n        centerX = Math.floor(centerX);\n        centerY = Math.floor(centerY);\n        radius = Math.floor(radius);\n        \n        if (filled) {\n            // Filled circle\n            for (let y = -radius; y <= radius; y++) {\n                for (let x = -radius; x <= radius; x++) {\n                    if (x * x + y * y <= radius * radius) {\n                        this.setPixel(centerX + x, centerY + y, color);\n                    }\n                }\n            }\n        } else {\n            // Circle outline using Bresenham's circle algorithm\n            let x = 0;\n            let y = radius;\n            let d = 3 - 2 * radius;\n            \n            while (y >= x) {\n                // Draw octants\n                this.setPixel(centerX + x, centerY + y, color);\n                this.setPixel(centerX - x, centerY + y, color);\n                this.setPixel(centerX + x, centerY - y, color);\n                this.setPixel(centerX - x, centerY - y, color);\n                this.setPixel(centerX + y, centerY + x, color);\n                this.setPixel(centerX - y, centerY + x, color);\n                this.setPixel(centerX + y, centerY - x, color);\n                this.setPixel(centerX - y, centerY - x, color);\n                \n                x++;\n                if (d > 0) {\n                    y--;\n                    d = d + 4 * (x - y) + 10;\n                } else {\n                    d = d + 4 * x + 6;\n                }\n            }\n        }\n        \n        this.renderStats.drawCalls++;\n    }\n\n    /**\n     * Render text with retro font styling\n     */\n    renderText(text: string, x: number, y: number, color: Color, size: number = 12): void {\n        // Save current context\n        this.ctx.save();\n        \n        // Set font and color\n        this.ctx.font = `${size}px \"Courier New\", monospace`;\n        this.ctx.fillStyle = this.colorToHex(color);\n        this.ctx.textBaseline = 'top';\n        \n        // Add retro glow effect\n        this.ctx.shadowColor = this.colorToHex(color);\n        this.ctx.shadowBlur = 2;\n        \n        // Render text\n        this.ctx.fillText(text, x, y);\n        \n        // Restore context\n        this.ctx.restore();\n        \n        this.renderStats.drawCalls++;\n    }\n\n    /**\n     * Render debug text array\n     */\n    renderDebugText(lines: string[], x: number, y: number): void {\n        const lineHeight = 14;\n        const backgroundColor = { r: 0, g: 0, b: 0, a: 128 };\n        const textColor = { r: 0, g: 255, b: 0 }; // Green terminal color\n        \n        // Draw background\n        const maxWidth = Math.max(...lines.map(line => line.length)) * 8;\n        this.fillRect(x - 2, y - 2, maxWidth + 4, lines.length * lineHeight + 4, backgroundColor);\n        \n        // Draw text lines\n        lines.forEach((line, index) => {\n            this.renderText(line, x, y + index * lineHeight, textColor, 12);\n        });\n    }\n\n    /**\n     * Generate procedural space ship sprite\n     */\n    generateShipSprite(type: 'player' | 'enemy' | 'ally', size: number = 32): Sprite {\n        const imageData = this.ctx.createImageData(size, size);\n        const data = imageData.data;\n        \n        // Clear to transparent\n        for (let i = 0; i < data.length; i += 4) {\n            data[i + 3] = 0; // Alpha = 0 (transparent)\n        }\n        \n        // Ship colors based on type - much brighter and more visible\n        let shipColor: Color;\n        let accentColor: Color;\n        switch (type) {\n            case 'player':\n                shipColor = { r: 80, g: 255, b: 80 }; // Bright green\n                accentColor = { r: 200, g: 255, b: 200 }; // Light green accent\n                break;\n            case 'enemy':\n                shipColor = { r: 255, g: 60, b: 60 }; // Bright red\n                accentColor = { r: 255, g: 150, b: 150 }; // Light red accent\n                break;\n            case 'ally':\n                shipColor = { r: 60, g: 180, b: 255 }; // Bright blue\n                accentColor = { r: 150, g: 200, b: 255 }; // Light blue accent\n                break;\n        }\n        \n        const centerX = size / 2;\n        const centerY = size / 2;\n        \n        // Draw detailed ship design\n        for (let y = 0; y < size; y++) {\n            for (let x = 0; x < size; x++) {\n                const dx = x - centerX;\n                const dy = y - centerY;\n                \n                // Main ship body (arrow/triangle shape)\n                if (dy >= -centerY * 0.9 && dy <= centerY * 0.7) {\n                    const bodyWidth = Math.max(1, (centerY * 0.9 + dy) * 0.4);\n                    if (Math.abs(dx) <= bodyWidth) {\n                        const index = (y * size + x) * 4;\n                        \n                        // Use accent color for edges, main color for center\n                        const isEdge = Math.abs(dx) > bodyWidth * 0.6 || \n                                      dy <= -centerY * 0.8 || dy >= centerY * 0.6;\n                        const color = isEdge ? accentColor : shipColor;\n                        \n                        data[index] = color.r;\n                        data[index + 1] = color.g;\n                        data[index + 2] = color.b;\n                        data[index + 3] = 255;\n                    }\n                }\n                \n                // Engine exhausts (bright spots at the back)\n                if (dy > centerY * 0.4 && dy < centerY * 0.7) {\n                    if ((Math.abs(dx - centerX * 0.3) < 2) || (Math.abs(dx + centerX * 0.3) < 2)) {\n                        const index = (y * size + x) * 4;\n                        data[index] = 255; // Bright white/blue exhaust\n                        data[index + 1] = 255;\n                        data[index + 2] = 255;\n                        data[index + 3] = 255;\n                    }\n                }\n            }\n        }\n        \n        this.renderStats.sprites++;\n        return {\n            data: imageData,\n            width: size,\n            height: size\n        };\n    }\n\n    /**\n     * Draw a sprite\n     */\n    drawSprite(sprite: Sprite, x: number, y: number): void {\n        this.ctx.putImageData(sprite.data, x, y);\n        this.renderStats.sprites++;\n    }\n\n    /**\n     * Apply dithering to reduce color banding\n     */\n    private applyDithering(buffer: ImageData): void {\n        if (!this.config.enableDithering) return;\n        \n        const data = buffer.data;\n        const width = buffer.width;\n        const height = buffer.height;\n        \n        // Floyd-Steinberg dithering\n        for (let y = 0; y < height - 1; y++) {\n            for (let x = 1; x < width - 1; x++) {\n                const index = (y * width + x) * 4;\n                \n                // Get current pixel\n                const oldR = data[index];\n                const oldG = data[index + 1];\n                const oldB = data[index + 2];\n                \n                // Find nearest palette color\n                const newColor = this.findNearestPaletteColor({ r: oldR, g: oldG, b: oldB });\n                \n                // Set new color\n                data[index] = newColor.r;\n                data[index + 1] = newColor.g;\n                data[index + 2] = newColor.b;\n                \n                // Calculate quantization error\n                const errorR = oldR - newColor.r;\n                const errorG = oldG - newColor.g;\n                const errorB = oldB - newColor.b;\n                \n                // Distribute error to neighboring pixels\n                this.distributeError(data, width, x + 1, y, errorR, errorG, errorB, 7/16);\n                this.distributeError(data, width, x - 1, y + 1, errorR, errorG, errorB, 3/16);\n                this.distributeError(data, width, x, y + 1, errorR, errorG, errorB, 5/16);\n                this.distributeError(data, width, x + 1, y + 1, errorR, errorG, errorB, 1/16);\n            }\n        }\n    }\n\n    /**\n     * Distribute dithering error to neighboring pixel\n     */\n    private distributeError(data: Uint8ClampedArray, width: number, x: number, y: number, \n                          errorR: number, errorG: number, errorB: number, factor: number): void {\n        const index = (y * width + x) * 4;\n        if (index >= 0 && index < data.length - 3) {\n            data[index] = Math.max(0, Math.min(255, data[index] + errorR * factor));\n            data[index + 1] = Math.max(0, Math.min(255, data[index + 1] + errorG * factor));\n            data[index + 2] = Math.max(0, Math.min(255, data[index + 2] + errorB * factor));\n        }\n    }\n\n    /**\n     * Find nearest color in palette\n     */\n    private findNearestPaletteColor(color: Color): Color {\n        let nearestColor = this.colorPalette[0];\n        let minDistance = Number.MAX_VALUE;\n        \n        for (const paletteColor of this.colorPalette) {\n            const distance = Math.sqrt(\n                Math.pow(color.r - paletteColor.r, 2) +\n                Math.pow(color.g - paletteColor.g, 2) +\n                Math.pow(color.b - paletteColor.b, 2)\n            );\n            \n            if (distance < minDistance) {\n                minDistance = distance;\n                nearestColor = paletteColor;\n            }\n        }\n        \n        return nearestColor;\n    }\n\n    /**\n     * Apply CRT effect (basic implementation)\n     */\n    private applyCRTEffect(): void {\n        // This would use WebGL shaders for proper CRT effects\n        // For now, just apply scanlines via CSS (already done in HTML)\n        this.logger.debug('CRT effect applied (CSS-based)');\n    }\n\n    /**\n     * Handle canvas resize\n     */\n    handleResize(): void {\n        // Recreate render buffers\n        this.createRenderBuffers();\n        this.logger.debug('Renderer resized');\n    }\n\n    /**\n     * Convert hex color to Color object\n     */\n    private hexToColor(hex: string): Color {\n        const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n        return result ? {\n            r: parseInt(result[1], 16),\n            g: parseInt(result[2], 16),\n            b: parseInt(result[3], 16)\n        } : { r: 0, g: 0, b: 0 };\n    }\n\n    /**\n     * Convert Color object to hex string\n     */\n    private colorToHex(color: Color): string {\n        const toHex = (c: number) => {\n            const hex = Math.round(c).toString(16);\n            return hex.length === 1 ? '0' + hex : hex;\n        };\n        return `#${toHex(color.r)}${toHex(color.g)}${toHex(color.b)}`;\n    }\n\n    /**\n     * Get render statistics\n     */\n    getRenderStats() {\n        return { ...this.renderStats };\n    }\n\n    /**\n     * Draw a filled rectangle\n     */\n    drawRect(x: number, y: number, width: number, height: number, color: Color): void {\n        this.ctx.fillStyle = this.colorToHex(color);\n        this.ctx.fillRect(x, y, width, height);\n    }\n\n\n\n    /**\n     * Cleanup resources\n     */\n    cleanup(): void {\n        // Clear WebGL resources if available\n        if (this.gl) {\n            this.shaderPrograms.forEach(program => {\n                this.gl!.deleteProgram(program);\n            });\n            this.shaderPrograms.clear();\n        }\n        \n        this.logger.info('🧹 Renderer cleanup completed');\n    }\n}","/**\n * Input Management System\n * Handles keyboard, mouse, and touch input with platform-specific adaptations\n */\n\nimport { Platform } from '@utils/Platform';\nimport { Logger } from '@utils/Logger';\nimport { Vector2 } from '@core/Renderer';\n\nexport interface InputState {\n    // Keyboard\n    keys: Set<string>;\n    keysPressed: Set<string>;\n    keysReleased: Set<string>;\n    \n    // Mouse\n    mousePosition: Vector2;\n    mouseButtons: Set<number>;\n    mouseButtonsPressed: Set<number>;\n    mouseButtonsReleased: Set<number>;\n    mouseWheel: number;\n    \n    // Touch\n    touches: Touch[];\n    touchStarted: boolean;\n    touchEnded: boolean;\n    \n    // Virtual controls for mobile\n    virtualThrust: number;\n    virtualRotation: number;\n    virtualAction: boolean;\n}\n\nexport interface GamepadState {\n    connected: boolean;\n    axes: number[];\n    buttons: boolean[];\n}\n\nexport class InputManager {\n    private canvas: HTMLCanvasElement;\n    private platform: Platform;\n    private currentState: InputState;\n    private previousState: InputState;\n    \n    // Gamepad support\n    private gamepads: Map<number, GamepadState> = new Map();\n    \n    // Touch controls\n    private touchZones: Map<string, TouchZone> = new Map();\n    private activeTouches: Map<number, TouchInfo> = new Map();\n    \n    // Input configuration\n    private config = {\n        enableKeyboard: true,\n        enableMouse: true,\n        enableTouch: true,\n        enableGamepad: true,\n        touchSensitivity: 1.0,\n        keyRepeatDelay: 250,\n        keyRepeatRate: 50\n    };\n    \n    private logger: Logger;\n    private eventListeners: Array<() => void> = [];\n\n    constructor(canvas: HTMLCanvasElement, platform: Platform) {\n        this.canvas = canvas;\n        this.platform = platform;\n        this.logger = new Logger('InputManager');\n        \n        // Initialize input states\n        this.currentState = this.createEmptyInputState();\n        this.previousState = this.createEmptyInputState();\n        \n        // Configure input based on platform\n        this.configureForPlatform();\n        \n        // Setup event listeners\n        this.setupEventListeners();\n        \n        // Setup touch zones for mobile\n        if (this.config.enableTouch) {\n            this.setupTouchZones();\n        }\n        \n        this.logger.info('🎮 Input manager initialized', {\n            platform: platform,\n            config: this.config\n        });\n    }\n\n    /**\n     * Configure input settings based on platform\n     */\n    private configureForPlatform(): void {\n        switch (this.platform) {\n            case Platform.Desktop:\n            case Platform.Tauri:\n                this.config.enableKeyboard = true;\n                this.config.enableMouse = true;\n                this.config.enableTouch = false;\n                this.config.enableGamepad = true;\n                break;\n                \n            case Platform.Mobile:\n            case Platform.Cordova:\n                this.config.enableKeyboard = false;\n                this.config.enableMouse = false;\n                this.config.enableTouch = true;\n                this.config.enableGamepad = false;\n                this.config.touchSensitivity = 1.5;\n                break;\n                \n            case Platform.Web:\n                // Hybrid mode - detect capabilities\n                this.config.enableKeyboard = true;\n                this.config.enableMouse = true;\n                this.config.enableTouch = 'ontouchstart' in window;\n                this.config.enableGamepad = 'getGamepads' in navigator;\n                break;\n        }\n    }\n\n    /**\n     * Setup event listeners for input\n     */\n    private setupEventListeners(): void {\n        // Keyboard events\n        if (this.config.enableKeyboard) {\n            const keyDownHandler = (e: KeyboardEvent) => this.handleKeyDown(e);\n            const keyUpHandler = (e: KeyboardEvent) => this.handleKeyUp(e);\n            \n            document.addEventListener('keydown', keyDownHandler);\n            document.addEventListener('keyup', keyUpHandler);\n            \n            this.eventListeners.push(() => {\n                document.removeEventListener('keydown', keyDownHandler);\n                document.removeEventListener('keyup', keyUpHandler);\n            });\n        }\n        \n        // Mouse events\n        if (this.config.enableMouse) {\n            const mouseMoveHandler = (e: MouseEvent) => this.handleMouseMove(e);\n            const mouseDownHandler = (e: MouseEvent) => this.handleMouseDown(e);\n            const mouseUpHandler = (e: MouseEvent) => this.handleMouseUp(e);\n            const wheelHandler = (e: WheelEvent) => this.handleWheel(e);\n            \n            this.canvas.addEventListener('mousemove', mouseMoveHandler);\n            this.canvas.addEventListener('mousedown', mouseDownHandler);\n            this.canvas.addEventListener('mouseup', mouseUpHandler);\n            this.canvas.addEventListener('wheel', wheelHandler);\n            \n            this.eventListeners.push(() => {\n                this.canvas.removeEventListener('mousemove', mouseMoveHandler);\n                this.canvas.removeEventListener('mousedown', mouseDownHandler);\n                this.canvas.removeEventListener('mouseup', mouseUpHandler);\n                this.canvas.removeEventListener('wheel', wheelHandler);\n            });\n        }\n        \n        // Touch events\n        if (this.config.enableTouch) {\n            const touchStartHandler = (e: TouchEvent) => this.handleTouchStart(e);\n            const touchMoveHandler = (e: TouchEvent) => this.handleTouchMove(e);\n            const touchEndHandler = (e: TouchEvent) => this.handleTouchEnd(e);\n            \n            this.canvas.addEventListener('touchstart', touchStartHandler, { passive: false });\n            this.canvas.addEventListener('touchmove', touchMoveHandler, { passive: false });\n            this.canvas.addEventListener('touchend', touchEndHandler, { passive: false });\n            \n            this.eventListeners.push(() => {\n                this.canvas.removeEventListener('touchstart', touchStartHandler);\n                this.canvas.removeEventListener('touchmove', touchMoveHandler);\n                this.canvas.removeEventListener('touchend', touchEndHandler);\n            });\n        }\n        \n        // Gamepad events\n        if (this.config.enableGamepad) {\n            const gamepadConnectedHandler = (e: GamepadEvent) => this.handleGamepadConnected(e);\n            const gamepadDisconnectedHandler = (e: GamepadEvent) => this.handleGamepadDisconnected(e);\n            \n            window.addEventListener('gamepadconnected', gamepadConnectedHandler);\n            window.addEventListener('gamepaddisconnected', gamepadDisconnectedHandler);\n            \n            this.eventListeners.push(() => {\n                window.removeEventListener('gamepadconnected', gamepadConnectedHandler);\n                window.removeEventListener('gamepaddisconnected', gamepadDisconnectedHandler);\n            });\n        }\n        \n        // Focus events to handle window focus\n        const focusHandler = () => this.handleFocus();\n        const blurHandler = () => this.handleBlur();\n        \n        window.addEventListener('focus', focusHandler);\n        window.addEventListener('blur', blurHandler);\n        \n        this.eventListeners.push(() => {\n            window.removeEventListener('focus', focusHandler);\n            window.removeEventListener('blur', blurHandler);\n        });\n    }\n\n    /**\n     * Setup touch zones for mobile controls\n     */\n    private setupTouchZones(): void {\n        const canvasRect = this.canvas.getBoundingClientRect();\n        \n        // Left side - thrust control\n        this.touchZones.set('thrust', {\n            x: 0,\n            y: 0,\n            width: canvasRect.width / 2,\n            height: canvasRect.height,\n            type: 'joystick'\n        });\n        \n        // Right side - rotation control\n        this.touchZones.set('rotation', {\n            x: canvasRect.width / 2,\n            y: 0,\n            width: canvasRect.width / 2,\n            height: canvasRect.height,\n            type: 'joystick'\n        });\n        \n        this.logger.debug('Touch zones configured for mobile controls');\n    }\n\n    /**\n     * Update input state (called each frame)\n     */\n    update(deltaTime: number): void {\n        // Copy current state to previous\n        this.previousState = this.deepCopyInputState(this.currentState);\n        \n        // Clear frame-specific states\n        this.currentState.keysPressed.clear();\n        this.currentState.keysReleased.clear();\n        this.currentState.mouseButtonsPressed.clear();\n        this.currentState.mouseButtonsReleased.clear();\n        this.currentState.mouseWheel = 0;\n        this.currentState.touchStarted = false;\n        this.currentState.touchEnded = false;\n        \n        // Update gamepad state\n        if (this.config.enableGamepad) {\n            this.updateGamepadState();\n        }\n        \n        // Update virtual controls from touch input\n        if (this.config.enableTouch) {\n            this.updateVirtualControls();\n        }\n    }\n\n    /**\n     * Keyboard event handlers\n     */\n    private handleKeyDown(e: KeyboardEvent): void {\n        const key = e.code;\n        \n        if (!this.currentState.keys.has(key)) {\n            this.currentState.keysPressed.add(key);\n            this.logger.debug(`Key pressed: ${key}`);\n        }\n        \n        this.currentState.keys.add(key);\n        \n        // Prevent default for game keys\n        if (this.isGameKey(key)) {\n            e.preventDefault();\n        }\n    }\n\n    private handleKeyUp(e: KeyboardEvent): void {\n        const key = e.code;\n        \n        if (this.currentState.keys.has(key)) {\n            this.currentState.keysReleased.add(key);\n            this.logger.debug(`Key released: ${key}`);\n        }\n        \n        this.currentState.keys.delete(key);\n        \n        if (this.isGameKey(key)) {\n            e.preventDefault();\n        }\n    }\n\n    /**\n     * Mouse event handlers\n     */\n    private handleMouseMove(e: MouseEvent): void {\n        const rect = this.canvas.getBoundingClientRect();\n        this.currentState.mousePosition = {\n            x: e.clientX - rect.left,\n            y: e.clientY - rect.top\n        };\n    }\n\n    private handleMouseDown(e: MouseEvent): void {\n        const button = e.button;\n        \n        if (!this.currentState.mouseButtons.has(button)) {\n            this.currentState.mouseButtonsPressed.add(button);\n        }\n        \n        this.currentState.mouseButtons.add(button);\n        e.preventDefault();\n    }\n\n    private handleMouseUp(e: MouseEvent): void {\n        const button = e.button;\n        \n        if (this.currentState.mouseButtons.has(button)) {\n            this.currentState.mouseButtonsReleased.add(button);\n        }\n        \n        this.currentState.mouseButtons.delete(button);\n        e.preventDefault();\n    }\n\n    private handleWheel(e: WheelEvent): void {\n        this.currentState.mouseWheel = e.deltaY;\n        e.preventDefault();\n    }\n\n    /**\n     * Touch event handlers\n     */\n    private handleTouchStart(e: TouchEvent): void {\n        this.currentState.touchStarted = true;\n        this.currentState.touches = Array.from(e.touches);\n        \n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            this.activeTouches.set(touch.identifier, {\n                id: touch.identifier,\n                startPosition: { x: touch.clientX, y: touch.clientY },\n                currentPosition: { x: touch.clientX, y: touch.clientY },\n                zone: this.getTouchZone(touch.clientX, touch.clientY)\n            });\n        }\n        \n        e.preventDefault();\n    }\n\n    private handleTouchMove(e: TouchEvent): void {\n        this.currentState.touches = Array.from(e.touches);\n        \n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            const touchInfo = this.activeTouches.get(touch.identifier);\n            \n            if (touchInfo) {\n                touchInfo.currentPosition = { x: touch.clientX, y: touch.clientY };\n            }\n        }\n        \n        e.preventDefault();\n    }\n\n    private handleTouchEnd(e: TouchEvent): void {\n        this.currentState.touchEnded = true;\n        this.currentState.touches = Array.from(e.touches);\n        \n        for (let i = 0; i < e.changedTouches.length; i++) {\n            const touch = e.changedTouches[i];\n            this.activeTouches.delete(touch.identifier);\n        }\n        \n        e.preventDefault();\n    }\n\n    /**\n     * Gamepad event handlers\n     */\n    private handleGamepadConnected(e: GamepadEvent): void {\n        this.logger.info(`Gamepad connected: ${e.gamepad.id}`);\n        this.gamepads.set(e.gamepad.index, {\n            connected: true,\n            axes: [],\n            buttons: []\n        });\n    }\n\n    private handleGamepadDisconnected(e: GamepadEvent): void {\n        this.logger.info(`Gamepad disconnected: ${e.gamepad.id}`);\n        this.gamepads.delete(e.gamepad.index);\n    }\n\n    /**\n     * Update gamepad state\n     */\n    private updateGamepadState(): void {\n        const gamepads = navigator.getGamepads();\n        \n        for (let i = 0; i < gamepads.length; i++) {\n            const gamepad = gamepads[i];\n            if (gamepad && this.gamepads.has(i)) {\n                const state = this.gamepads.get(i)!;\n                state.axes = Array.from(gamepad.axes);\n                state.buttons = gamepad.buttons.map(button => button.pressed);\n            }\n        }\n    }\n\n    /**\n     * Update virtual controls from touch input\n     */\n    private updateVirtualControls(): void {\n        this.currentState.virtualThrust = 0;\n        this.currentState.virtualRotation = 0;\n        this.currentState.virtualAction = false;\n        \n        for (const [touchId, touchInfo] of this.activeTouches) {\n            const deltaX = touchInfo.currentPosition.x - touchInfo.startPosition.x;\n            const deltaY = touchInfo.currentPosition.y - touchInfo.startPosition.y;\n            \n            if (touchInfo.zone === 'thrust') {\n                // Vertical movement controls thrust\n                this.currentState.virtualThrust = -deltaY / 100 * this.config.touchSensitivity;\n                this.currentState.virtualThrust = Math.max(-1, Math.min(1, this.currentState.virtualThrust));\n            } else if (touchInfo.zone === 'rotation') {\n                // Horizontal movement controls rotation\n                this.currentState.virtualRotation = deltaX / 100 * this.config.touchSensitivity;\n                this.currentState.virtualRotation = Math.max(-1, Math.min(1, this.currentState.virtualRotation));\n            }\n        }\n    }\n\n    /**\n     * Focus/blur handlers\n     */\n    private handleFocus(): void {\n        this.logger.debug('Window focused - input enabled');\n    }\n\n    private handleBlur(): void {\n        // Clear all input states when window loses focus\n        this.currentState.keys.clear();\n        this.currentState.mouseButtons.clear();\n        this.activeTouches.clear();\n        this.logger.debug('Window blurred - input cleared');\n    }\n\n    /**\n     * Helper methods\n     */\n    private createEmptyInputState(): InputState {\n        return {\n            keys: new Set(),\n            keysPressed: new Set(),\n            keysReleased: new Set(),\n            mousePosition: { x: 0, y: 0 },\n            mouseButtons: new Set(),\n            mouseButtonsPressed: new Set(),\n            mouseButtonsReleased: new Set(),\n            mouseWheel: 0,\n            touches: [],\n            touchStarted: false,\n            touchEnded: false,\n            virtualThrust: 0,\n            virtualRotation: 0,\n            virtualAction: false\n        };\n    }\n\n    private deepCopyInputState(state: InputState): InputState {\n        return {\n            keys: new Set(state.keys),\n            keysPressed: new Set(),\n            keysReleased: new Set(),\n            mousePosition: { ...state.mousePosition },\n            mouseButtons: new Set(state.mouseButtons),\n            mouseButtonsPressed: new Set(),\n            mouseButtonsReleased: new Set(),\n            mouseWheel: 0,\n            touches: [...state.touches],\n            touchStarted: false,\n            touchEnded: false,\n            virtualThrust: state.virtualThrust,\n            virtualRotation: state.virtualRotation,\n            virtualAction: state.virtualAction\n        };\n    }\n\n    private isGameKey(key: string): boolean {\n        const gameKeys = [\n            'ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight',\n            'KeyW', 'KeyA', 'KeyS', 'KeyD',\n            'Space', 'Enter', 'Escape'\n        ];\n        return gameKeys.includes(key);\n    }\n\n    private getTouchZone(x: number, y: number): string | null {\n        for (const [zoneName, zone] of this.touchZones) {\n            if (x >= zone.x && x < zone.x + zone.width &&\n                y >= zone.y && y < zone.y + zone.height) {\n                return zoneName;\n            }\n        }\n        return null;\n    }\n\n    /**\n     * Public input query methods\n     */\n    isKeyDown(key: string): boolean {\n        return this.currentState.keys.has(key);\n    }\n\n    isKeyPressed(key: string): boolean {\n        return this.currentState.keysPressed.has(key);\n    }\n\n    isKeyReleased(key: string): boolean {\n        return this.currentState.keysReleased.has(key);\n    }\n\n    isMouseButtonDown(button: number): boolean {\n        return this.currentState.mouseButtons.has(button);\n    }\n\n    isMouseButtonPressed(button: number): boolean {\n        return this.currentState.mouseButtonsPressed.has(button);\n    }\n\n    getMousePosition(): Vector2 {\n        return { ...this.currentState.mousePosition };\n    }\n\n    getMouseWheel(): number {\n        return this.currentState.mouseWheel;\n    }\n\n    getTouchCount(): number {\n        return this.currentState.touches.length;\n    }\n\n    getVirtualThrust(): number {\n        return this.currentState.virtualThrust;\n    }\n\n    getVirtualRotation(): number {\n        return this.currentState.virtualRotation;\n    }\n\n    // Game-specific input methods\n    getThrustInput(): number {\n        if (this.config.enableTouch) {\n            return this.currentState.virtualThrust;\n        }\n        \n        let thrust = 0;\n        if (this.isKeyDown('ArrowUp') || this.isKeyDown('KeyW')) thrust += 1;\n        if (this.isKeyDown('ArrowDown') || this.isKeyDown('KeyS')) thrust -= 1;\n        \n        // Gamepad input\n        for (const gamepad of this.gamepads.values()) {\n            if (gamepad.connected && gamepad.axes.length > 1) {\n                thrust += -gamepad.axes[1]; // Invert Y axis\n            }\n        }\n        \n        return Math.max(-1, Math.min(1, thrust));\n    }\n\n    getRotationInput(): number {\n        if (this.config.enableTouch) {\n            return this.currentState.virtualRotation;\n        }\n        \n        let rotation = 0;\n        if (this.isKeyDown('ArrowLeft') || this.isKeyDown('KeyA')) rotation -= 1;\n        if (this.isKeyDown('ArrowRight') || this.isKeyDown('KeyD')) rotation += 1;\n        \n        // Gamepad input\n        for (const gamepad of this.gamepads.values()) {\n            if (gamepad.connected && gamepad.axes.length > 0) {\n                rotation += gamepad.axes[0]; // X axis\n            }\n        }\n        \n        return Math.max(-1, Math.min(1, rotation));\n    }\n\n    isActionPressed(): boolean {\n        return this.isKeyPressed('Space') || \n               this.isMouseButtonPressed(0) || \n               this.currentState.virtualAction;\n    }\n\n    isPausePressed(): boolean {\n        return this.isKeyPressed('Escape') || this.isKeyPressed('KeyP');\n    }\n\n    /**\n     * Cleanup\n     */\n    cleanup(): void {\n        // Remove all event listeners\n        this.eventListeners.forEach(cleanup => cleanup());\n        this.eventListeners = [];\n        \n        // Clear states\n        this.activeTouches.clear();\n        this.gamepads.clear();\n        \n        this.logger.info('🧹 Input manager cleanup completed');\n    }\n}\n\n// Helper interfaces\ninterface TouchZone {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    type: 'button' | 'joystick';\n}\n\ninterface TouchInfo {\n    id: number;\n    startPosition: Vector2;\n    currentPosition: Vector2;\n    zone: string | null;\n}","/**\n * Space Physics Engine\n * Handles realistic space movement, gravity, and orbital mechanics\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2 } from '@core/Renderer';\n\nexport interface PhysicsObject {\n    id: string;\n    position: Vector2;\n    velocity: Vector2;\n    acceleration: Vector2;\n    mass: number;\n    radius: number;\n    isStatic: boolean;\n    type: 'ship' | 'planet' | 'star' | 'asteroid' | 'projectile';\n    \n    // Physics properties\n    drag: number;\n    restitution: number; // Bounce factor\n    friction: number;\n    \n    // Game-specific properties\n    health?: number;\n    faction?: string;\n    \n    // Callbacks\n    onCollision?: (other: PhysicsObject) => void;\n    onDestroy?: () => void;\n}\n\nexport interface CollisionInfo {\n    objectA: PhysicsObject;\n    objectB: PhysicsObject;\n    penetration: number;\n    normal: Vector2;\n    point: Vector2;\n}\n\nexport interface GravityWell {\n    position: Vector2;\n    mass: number;\n    radius: number; // Effective radius for gravity\n}\n\nexport class SpacePhysics {\n    private objects: Map<string, PhysicsObject> = new Map();\n    private gravityWells: Map<string, GravityWell> = new Map();\n    \n    // Physics constants\n    private readonly GRAVITATIONAL_CONSTANT = 6.67e-11; // Scaled for game\n    private readonly SPACE_DRAG = 0.999; // Very low drag in space\n    private readonly MIN_VELOCITY = 0.01; // Below this, velocity is zeroed\n    private readonly MAX_VELOCITY = 1000; // Maximum velocity cap\n    \n    // Collision detection\n    private collisionPairs: CollisionInfo[] = [];\n    \n    private logger: Logger;\n\n    constructor() {\n        this.logger = new Logger('SpacePhysics');\n        this.logger.info('🌌 Space physics engine initialized');\n    }\n\n    /**\n     * Add a physics object to the simulation\n     */\n    addObject(object: PhysicsObject): void {\n        this.objects.set(object.id, object);\n        this.logger.debug(`Added physics object: ${object.id} (${object.type})`);\n    }\n\n    /**\n     * Remove a physics object from the simulation\n     */\n    removeObject(id: string): boolean {\n        const removed = this.objects.delete(id);\n        if (removed) {\n            this.logger.debug(`Removed physics object: ${id}`);\n        }\n        return removed;\n    }\n\n    /**\n     * Get a physics object by ID\n     */\n    getObject(id: string): PhysicsObject | undefined {\n        return this.objects.get(id);\n    }\n\n    /**\n     * Add a gravity well (like a planet or star)\n     */\n    addGravityWell(id: string, well: GravityWell): void {\n        this.gravityWells.set(id, well);\n        this.logger.debug(`Added gravity well: ${id}`);\n    }\n\n    /**\n     * Remove a gravity well\n     */\n    removeGravityWell(id: string): boolean {\n        return this.gravityWells.delete(id);\n    }\n\n    /**\n     * Update the physics simulation\n     */\n    update(deltaTime: number): void {\n        // Cap delta time to prevent simulation instability\n        deltaTime = Math.min(deltaTime, 1/30); // Max 30 FPS minimum\n        \n        // Clear previous collision data\n        this.collisionPairs = [];\n        \n        // Apply forces to all objects\n        for (const object of this.objects.values()) {\n            if (!object.isStatic) {\n                this.updateObject(object, deltaTime);\n            }\n        }\n        \n        // Detect and resolve collisions\n        this.detectCollisions();\n        this.resolveCollisions();\n    }\n\n    /**\n     * Update a single physics object\n     */\n    private updateObject(object: PhysicsObject, deltaTime: number): void {\n        // Reset acceleration each frame\n        object.acceleration = { x: 0, y: 0 };\n        \n        // Apply gravitational forces\n        this.applyGravity(object);\n        \n        // Apply space drag (very minimal)\n        this.applyDrag(object);\n        \n        // Integrate velocity (acceleration → velocity)\n        object.velocity.x += object.acceleration.x * deltaTime;\n        object.velocity.y += object.acceleration.y * deltaTime;\n        \n        // Cap velocity to prevent runaway speeds\n        const speed = this.getVectorMagnitude(object.velocity);\n        if (speed > this.MAX_VELOCITY) {\n            const scale = this.MAX_VELOCITY / speed;\n            object.velocity.x *= scale;\n            object.velocity.y *= scale;\n        }\n        \n        // Zero very small velocities (simulate friction/energy loss)\n        if (speed < this.MIN_VELOCITY) {\n            object.velocity = { x: 0, y: 0 };\n        }\n        \n        // Integrate position (velocity → position)\n        object.position.x += object.velocity.x * deltaTime;\n        object.position.y += object.velocity.y * deltaTime;\n    }\n\n    /**\n     * Apply gravitational forces from all gravity wells\n     */\n    private applyGravity(object: PhysicsObject): void {\n        for (const well of this.gravityWells.values()) {\n            const dx = well.position.x - object.position.x;\n            const dy = well.position.y - object.position.y;\n            const distanceSquared = dx * dx + dy * dy;\n            const distance = Math.sqrt(distanceSquared);\n            \n            // Skip if too close (prevent division by zero and extreme forces)\n            if (distance < well.radius * 0.1) continue;\n            \n            // Calculate gravitational force\n            // F = G * (m1 * m2) / r²\n            const force = (this.GRAVITATIONAL_CONSTANT * well.mass * object.mass) / distanceSquared;\n            \n            // Apply force in direction of gravity well\n            const forceX = (dx / distance) * force;\n            const forceY = (dy / distance) * force;\n            \n            // F = ma, so a = F/m\n            object.acceleration.x += forceX / object.mass;\n            object.acceleration.y += forceY / object.mass;\n        }\n    }\n\n    /**\n     * Apply drag forces (minimal in space)\n     */\n    private applyDrag(object: PhysicsObject): void {\n        // Apply object-specific drag\n        object.velocity.x *= (this.SPACE_DRAG * object.drag);\n        object.velocity.y *= (this.SPACE_DRAG * object.drag);\n    }\n\n    /**\n     * Detect collisions between all objects\n     */\n    private detectCollisions(): void {\n        const objectArray = Array.from(this.objects.values());\n        \n        for (let i = 0; i < objectArray.length; i++) {\n            for (let j = i + 1; j < objectArray.length; j++) {\n                const objA = objectArray[i];\n                const objB = objectArray[j];\n                \n                const collision = this.checkCollision(objA, objB);\n                if (collision) {\n                    this.collisionPairs.push(collision);\n                }\n            }\n        }\n    }\n\n    /**\n     * Check collision between two objects\n     */\n    private checkCollision(objA: PhysicsObject, objB: PhysicsObject): CollisionInfo | null {\n        const dx = objB.position.x - objA.position.x;\n        const dy = objB.position.y - objA.position.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        const minDistance = objA.radius + objB.radius;\n        \n        if (distance < minDistance) {\n            // Collision detected\n            const penetration = minDistance - distance;\n            const normal = distance > 0 ? \n                { x: dx / distance, y: dy / distance } : \n                { x: 1, y: 0 }; // Fallback if objects are exactly overlapping\n            \n            const point = {\n                x: objA.position.x + dx * (objA.radius / minDistance),\n                y: objA.position.y + dy * (objA.radius / minDistance)\n            };\n            \n            return {\n                objectA: objA,\n                objectB: objB,\n                penetration,\n                normal,\n                point\n            };\n        }\n        \n        return null;\n    }\n\n    /**\n     * Resolve all detected collisions\n     */\n    private resolveCollisions(): void {\n        for (const collision of this.collisionPairs) {\n            this.resolveCollision(collision);\n            \n            // Call collision callbacks\n            if (collision.objectA.onCollision) {\n                collision.objectA.onCollision(collision.objectB);\n            }\n            if (collision.objectB.onCollision) {\n                collision.objectB.onCollision(collision.objectA);\n            }\n        }\n    }\n\n    /**\n     * Resolve a single collision\n     */\n    private resolveCollision(collision: CollisionInfo): void {\n        const { objectA, objectB, penetration, normal } = collision;\n        \n        // Separate objects to prevent overlap\n        if (!objectA.isStatic && !objectB.isStatic) {\n            // Both objects can move\n            const separationA = penetration * 0.5;\n            const separationB = penetration * 0.5;\n            \n            objectA.position.x -= normal.x * separationA;\n            objectA.position.y -= normal.y * separationA;\n            objectB.position.x += normal.x * separationB;\n            objectB.position.y += normal.y * separationB;\n        } else if (!objectA.isStatic) {\n            // Only object A can move\n            objectA.position.x -= normal.x * penetration;\n            objectA.position.y -= normal.y * penetration;\n        } else if (!objectB.isStatic) {\n            // Only object B can move\n            objectB.position.x += normal.x * penetration;\n            objectB.position.y += normal.y * penetration;\n        }\n        \n        // Calculate relative velocity\n        const relativeVelocity = {\n            x: objectB.velocity.x - objectA.velocity.x,\n            y: objectB.velocity.y - objectA.velocity.y\n        };\n        \n        // Calculate collision impulse\n        const velocityAlongNormal = relativeVelocity.x * normal.x + relativeVelocity.y * normal.y;\n        \n        // Objects are separating, no need to resolve\n        if (velocityAlongNormal > 0) return;\n        \n        // Calculate restitution (bounciness)\n        const restitution = Math.min(objectA.restitution, objectB.restitution);\n        \n        // Calculate impulse scalar\n        let impulse = -(1 + restitution) * velocityAlongNormal;\n        \n        // Calculate mass ratio\n        if (!objectA.isStatic && !objectB.isStatic) {\n            impulse /= (1 / objectA.mass + 1 / objectB.mass);\n        }\n        \n        // Apply impulse\n        const impulseVector = { x: impulse * normal.x, y: impulse * normal.y };\n        \n        if (!objectA.isStatic) {\n            objectA.velocity.x -= impulseVector.x / objectA.mass;\n            objectA.velocity.y -= impulseVector.y / objectA.mass;\n        }\n        \n        if (!objectB.isStatic) {\n            objectB.velocity.x += impulseVector.x / objectB.mass;\n            objectB.velocity.y += impulseVector.y / objectB.mass;\n        }\n    }\n\n    /**\n     * Apply thrust to an object (for ships)\n     */\n    applyThrust(objectId: string, thrustVector: Vector2, thrustPower: number): void {\n        const object = this.objects.get(objectId);\n        if (!object || object.isStatic) return;\n        \n        // Normalize thrust vector\n        const magnitude = this.getVectorMagnitude(thrustVector);\n        if (magnitude === 0) return;\n        \n        const normalizedThrust = {\n            x: thrustVector.x / magnitude,\n            y: thrustVector.y / magnitude\n        };\n        \n        // Apply thrust as acceleration\n        object.acceleration.x += normalizedThrust.x * thrustPower / object.mass;\n        object.acceleration.y += normalizedThrust.y * thrustPower / object.mass;\n    }\n\n    /**\n     * Calculate orbital velocity for circular orbit around a gravity well\n     */\n    calculateOrbitalVelocity(distance: number, centralMass: number): number {\n        // v = sqrt(GM/r)\n        return Math.sqrt(this.GRAVITATIONAL_CONSTANT * centralMass / distance);\n    }\n\n    /**\n     * Calculate escape velocity from a gravity well\n     */\n    calculateEscapeVelocity(distance: number, centralMass: number): number {\n        // v = sqrt(2GM/r)\n        return Math.sqrt(2 * this.GRAVITATIONAL_CONSTANT * centralMass / distance);\n    }\n\n    /**\n     * Get all objects within a radius\n     */\n    getObjectsInRadius(center: Vector2, radius: number): PhysicsObject[] {\n        const result: PhysicsObject[] = [];\n        \n        for (const object of this.objects.values()) {\n            const distance = this.getDistance(center, object.position);\n            if (distance <= radius) {\n                result.push(object);\n            }\n        }\n        \n        return result;\n    }\n\n    /**\n     * Raycast to find the first object hit\n     */\n    raycast(start: Vector2, direction: Vector2, maxDistance: number): PhysicsObject | null {\n        const normalizedDirection = this.normalizeVector(direction);\n        const step = 1; // Step size for ray marching\n        \n        for (let distance = 0; distance < maxDistance; distance += step) {\n            const point = {\n                x: start.x + normalizedDirection.x * distance,\n                y: start.y + normalizedDirection.y * distance\n            };\n            \n            for (const object of this.objects.values()) {\n                const objectDistance = this.getDistance(point, object.position);\n                if (objectDistance <= object.radius) {\n                    return object;\n                }\n            }\n        }\n        \n        return null;\n    }\n\n    /**\n     * Utility functions\n     */\n    private getVectorMagnitude(vector: Vector2): number {\n        return Math.sqrt(vector.x * vector.x + vector.y * vector.y);\n    }\n\n    private normalizeVector(vector: Vector2): Vector2 {\n        const magnitude = this.getVectorMagnitude(vector);\n        if (magnitude === 0) return { x: 0, y: 0 };\n        return { x: vector.x / magnitude, y: vector.y / magnitude };\n    }\n\n    private getDistance(a: Vector2, b: Vector2): number {\n        const dx = b.x - a.x;\n        const dy = b.y - a.y;\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    /**\n     * Get simulation statistics\n     */\n    getStats() {\n        return {\n            objectCount: this.objects.size,\n            gravityWellCount: this.gravityWells.size,\n            collisionCount: this.collisionPairs.length,\n            activeObjects: Array.from(this.objects.values()).filter(obj => !obj.isStatic).length\n        };\n    }\n\n    /**\n     * Get object count for performance monitoring\n     */\n    getObjectCount(): number {\n        return this.objects.size;\n    }\n\n    /**\n     * Get all objects (for debugging/rendering)\n     */\n    getAllObjects(): PhysicsObject[] {\n        return Array.from(this.objects.values());\n    }\n\n    /**\n     * Clear all objects and gravity wells\n     */\n    clear(): void {\n        this.objects.clear();\n        this.gravityWells.clear();\n        this.collisionPairs = [];\n        this.logger.debug('Physics simulation cleared');\n    }\n\n    /**\n     * Create a basic ship physics object\n     */\n    createShip(id: string, position: Vector2, mass: number = 1000): PhysicsObject {\n        return {\n            id,\n            position: { ...position },\n            velocity: { x: 0, y: 0 },\n            acceleration: { x: 0, y: 0 },\n            mass,\n            radius: 16, // Ship radius in pixels\n            isStatic: false,\n            type: 'ship',\n            drag: 0.999, // Very little drag in space\n            restitution: 0.3, // Some bounce for collisions\n            friction: 0.1,\n            health: 100\n        };\n    }\n\n    /**\n     * Create a basic planet physics object\n     */\n    createPlanet(id: string, position: Vector2, mass: number, radius: number): PhysicsObject {\n        return {\n            id,\n            position: { ...position },\n            velocity: { x: 0, y: 0 },\n            acceleration: { x: 0, y: 0 },\n            mass,\n            radius,\n            isStatic: true, // Planets don't move\n            type: 'planet',\n            drag: 1.0,\n            restitution: 0.1, // Planets are not bouncy\n            friction: 0.9\n        };\n    }\n\n    /**\n     * Create a projectile physics object\n     */\n    createProjectile(id: string, position: Vector2, velocity: Vector2, mass: number = 1): PhysicsObject {\n        return {\n            id,\n            position: { ...position },\n            velocity: { ...velocity },\n            acceleration: { x: 0, y: 0 },\n            mass,\n            radius: 2, // Small projectile\n            isStatic: false,\n            type: 'projectile',\n            drag: 1.0, // No drag for projectiles\n            restitution: 0.8, // Bouncy projectiles\n            friction: 0.0\n        };\n    }\n}","/**\n * Web Audio API-based Audio Engine\n * Handles procedural sound synthesis and 16-bit style audio effects\n */\n\nimport { Platform } from '@utils/Platform';\nimport { Logger } from '@utils/Logger';\nimport { Vector2 } from '@core/Renderer';\n\nexport interface AudioConfig {\n    masterVolume: number;\n    musicVolume: number;\n    sfxVolume: number;\n    enableSpatialAudio: boolean;\n    maxChannels: number;\n    sampleRate: number;\n}\n\nexport interface SoundEffect {\n    id: string;\n    buffer: AudioBuffer;\n    loop: boolean;\n    volume: number;\n    pitch: number;\n    type: 'engine' | 'weapon' | 'ambient' | 'ui' | 'explosion';\n}\n\nexport interface AudioSource {\n    id: string;\n    node: AudioBufferSourceNode | OscillatorNode;\n    gainNode: GainNode;\n    pannerNode?: PannerNode;\n    position?: Vector2;\n    isPlaying: boolean;\n    loop: boolean;\n    startTime: number;\n}\n\nexport class AudioEngine {\n    private context: AudioContext | null = null;\n    private platform: Platform;\n    private config: AudioConfig;\n    \n    // Audio nodes\n    private masterGain: GainNode | null = null;\n    private musicGain: GainNode | null = null;\n    private sfxGain: GainNode | null = null;\n    \n    // Sound management\n    private soundEffects: Map<string, SoundEffect> = new Map();\n    private activeSources: Map<string, AudioSource> = new Map();\n    \n    // Music system\n    private musicTrack: AudioSource | null = null;\n    private ambientTrack: AudioSource | null = null;\n    \n    // 16-bit synthesis\n    private synthNodes: Map<string, OscillatorNode> = new Map();\n    \n    private logger: Logger;\n    private isInitialized = false;\n\n    constructor(platform: Platform) {\n        this.platform = platform;\n        this.logger = new Logger('AudioEngine');\n        \n        // Configure audio based on platform\n        this.config = {\n            masterVolume: 1.0,\n            musicVolume: 0.7,\n            sfxVolume: 0.8,\n            enableSpatialAudio: platform === Platform.Desktop,\n            maxChannels: platform === Platform.Mobile ? 8 : 16,\n            sampleRate: 44100\n        };\n        \n        this.logger.info('🔊 Audio engine created', {\n            platform: platform,\n            config: this.config\n        });\n    }\n\n    /**\n     * Initialize the audio engine\n     */\n    async initialize(): Promise<void> {\n        this.logger.info('🔧 Initializing audio engine...');\n        \n        try {\n            // Create audio context\n            this.context = new (window.AudioContext || (window as any).webkitAudioContext)({\n                sampleRate: this.config.sampleRate\n            });\n            \n            // Handle context state\n            if (this.context.state === 'suspended') {\n                this.logger.info('Audio context suspended, will resume on user interaction');\n                this.setupUserInteractionHandler();\n            }\n            \n            // Create master gain nodes\n            this.masterGain = this.context.createGain();\n            this.musicGain = this.context.createGain();\n            this.sfxGain = this.context.createGain();\n            \n            // Connect gain nodes\n            this.musicGain.connect(this.masterGain);\n            this.sfxGain.connect(this.masterGain);\n            this.masterGain.connect(this.context.destination);\n            \n            // Set initial volumes\n            this.setMasterVolume(this.config.masterVolume);\n            this.setMusicVolume(this.config.musicVolume);\n            this.setSfxVolume(this.config.sfxVolume);\n            \n            // Generate basic sound effects\n            await this.generateBasicSounds();\n            \n            this.isInitialized = true;\n            this.logger.info('✅ Audio engine initialized successfully');\n            \n        } catch (error) {\n            this.logger.error('❌ Audio engine initialization failed', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Setup user interaction handler for audio context\n     */\n    private setupUserInteractionHandler(): void {\n        const resumeAudio = async () => {\n            if (this.context && this.context.state === 'suspended') {\n                await this.context.resume();\n                this.logger.info('Audio context resumed');\n                \n                // Remove event listeners\n                document.removeEventListener('click', resumeAudio);\n                document.removeEventListener('keydown', resumeAudio);\n                document.removeEventListener('touchstart', resumeAudio);\n            }\n        };\n        \n        document.addEventListener('click', resumeAudio, { once: true });\n        document.addEventListener('keydown', resumeAudio, { once: true });\n        document.addEventListener('touchstart', resumeAudio, { once: true });\n    }\n\n    /**\n     * Generate basic 16-bit style sound effects\n     */\n    private async generateBasicSounds(): Promise<void> {\n        if (!this.context) return;\n        \n        // Engine thrust sound\n        const engineBuffer = this.generateEngineSound(1.0);\n        this.soundEffects.set('engine_thrust', {\n            id: 'engine_thrust',\n            buffer: engineBuffer,\n            loop: true,\n            volume: 0.6,\n            pitch: 1.0,\n            type: 'engine'\n        });\n        \n        // Laser weapon sound\n        const laserBuffer = this.generateLaserSound();\n        this.soundEffects.set('weapon_laser', {\n            id: 'weapon_laser',\n            buffer: laserBuffer,\n            loop: false,\n            volume: 0.8,\n            pitch: 1.0,\n            type: 'weapon'\n        });\n        \n        // Explosion sound\n        const explosionBuffer = this.generateExplosionSound();\n        this.soundEffects.set('explosion', {\n            id: 'explosion',\n            buffer: explosionBuffer,\n            loop: false,\n            volume: 1.0,\n            pitch: 1.0,\n            type: 'explosion'\n        });\n        \n        // UI beep sound\n        const beepBuffer = this.generateBeepSound(800, 0.1);\n        this.soundEffects.set('ui_beep', {\n            id: 'ui_beep',\n            buffer: beepBuffer,\n            loop: false,\n            volume: 0.5,\n            pitch: 1.0,\n            type: 'ui'\n        });\n        \n        this.logger.debug('Generated basic sound effects');\n    }\n\n    /**\n     * Generate procedural engine sound\n     */\n    private generateEngineSound(duration: number): AudioBuffer {\n        if (!this.context) throw new Error('Audio context not initialized');\n        \n        const sampleRate = this.context.sampleRate;\n        const samples = Math.floor(sampleRate * duration);\n        const buffer = this.context.createBuffer(1, samples, sampleRate);\n        const data = buffer.getChannelData(0);\n        \n        for (let i = 0; i < samples; i++) {\n            const t = i / sampleRate;\n            \n            // Multiple oscillators for rich engine sound\n            const baseFreq = 60 + Math.sin(t * 5) * 10; // Low rumble with variation\n            const harmonic1 = Math.sin(2 * Math.PI * baseFreq * t) * 0.5;\n            const harmonic2 = Math.sin(2 * Math.PI * baseFreq * 2 * t) * 0.3;\n            const harmonic3 = Math.sin(2 * Math.PI * baseFreq * 3 * t) * 0.2;\n            \n            // Add noise for texture\n            const noise = (Math.random() - 0.5) * 0.1;\n            \n            data[i] = (harmonic1 + harmonic2 + harmonic3 + noise) * 0.3;\n        }\n        \n        return buffer;\n    }\n\n    /**\n     * Generate procedural laser sound\n     */\n    private generateLaserSound(): AudioBuffer {\n        if (!this.context) throw new Error('Audio context not initialized');\n        \n        const duration = 0.2;\n        const sampleRate = this.context.sampleRate;\n        const samples = Math.floor(sampleRate * duration);\n        const buffer = this.context.createBuffer(1, samples, sampleRate);\n        const data = buffer.getChannelData(0);\n        \n        for (let i = 0; i < samples; i++) {\n            const t = i / sampleRate;\n            const progress = t / duration;\n            \n            // Frequency sweep from high to low\n            const freq = 1200 - progress * 800;\n            const amplitude = Math.exp(-progress * 8); // Exponential decay\n            \n            data[i] = Math.sin(2 * Math.PI * freq * t) * amplitude * 0.5;\n        }\n        \n        return buffer;\n    }\n\n    /**\n     * Generate procedural explosion sound\n     */\n    private generateExplosionSound(): AudioBuffer {\n        if (!this.context) throw new Error('Audio context not initialized');\n        \n        const duration = 1.0;\n        const sampleRate = this.context.sampleRate;\n        const samples = Math.floor(sampleRate * duration);\n        const buffer = this.context.createBuffer(1, samples, sampleRate);\n        const data = buffer.getChannelData(0);\n        \n        for (let i = 0; i < samples; i++) {\n            const t = i / sampleRate;\n            const progress = t / duration;\n            \n            // Start with sharp attack, then decay\n            const amplitude = progress < 0.1 ? \n                progress * 10 : // Quick attack\n                Math.exp(-(progress - 0.1) * 5); // Exponential decay\n            \n            // Mix of noise and low frequency rumble\n            const noise = (Math.random() - 0.5) * 2;\n            const rumble = Math.sin(2 * Math.PI * 40 * t) * 0.5;\n            \n            data[i] = (noise * 0.7 + rumble * 0.3) * amplitude * 0.6;\n        }\n        \n        return buffer;\n    }\n\n    /**\n     * Generate simple beep sound\n     */\n    private generateBeepSound(frequency: number, duration: number): AudioBuffer {\n        if (!this.context) throw new Error('Audio context not initialized');\n        \n        const sampleRate = this.context.sampleRate;\n        const samples = Math.floor(sampleRate * duration);\n        const buffer = this.context.createBuffer(1, samples, sampleRate);\n        const data = buffer.getChannelData(0);\n        \n        for (let i = 0; i < samples; i++) {\n            const t = i / sampleRate;\n            const amplitude = Math.exp(-t * 10); // Quick decay\n            \n            data[i] = Math.sin(2 * Math.PI * frequency * t) * amplitude * 0.4;\n        }\n        \n        return buffer;\n    }\n\n    /**\n     * Play a sound effect\n     */\n    playSfx(soundId: string, position?: Vector2, pitch: number = 1.0, volume: number = 1.0): string | null {\n        if (!this.isInitialized || !this.context) {\n            this.logger.warn('Audio engine not initialized, cannot play sound');\n            return null;\n        }\n        \n        const soundEffect = this.soundEffects.get(soundId);\n        if (!soundEffect) {\n            this.logger.warn(`Sound effect not found: ${soundId}`);\n            return null;\n        }\n        \n        try {\n            // Create audio source\n            const source = this.context.createBufferSource();\n            const gainNode = this.context.createGain();\n            const sourceId = `${soundId}_${Date.now()}_${Math.random()}`;\n            \n            // Setup source\n            source.buffer = soundEffect.buffer;\n            source.loop = soundEffect.loop;\n            source.playbackRate.value = pitch;\n            \n            // Setup gain\n            gainNode.gain.value = soundEffect.volume * volume;\n            \n            // Connect nodes\n            source.connect(gainNode);\n            \n            // Add spatial audio if enabled and position provided\n            let pannerNode: PannerNode | undefined;\n            if (this.config.enableSpatialAudio && position) {\n                pannerNode = this.context.createPanner();\n                pannerNode.panningModel = 'HRTF';\n                pannerNode.distanceModel = 'inverse';\n                pannerNode.refDistance = 100;\n                pannerNode.maxDistance = 1000;\n                pannerNode.rolloffFactor = 1;\n                \n                // Set position\n                pannerNode.positionX.value = position.x;\n                pannerNode.positionY.value = position.y;\n                pannerNode.positionZ.value = 0;\n                \n                gainNode.connect(pannerNode);\n                pannerNode.connect(this.sfxGain!);\n            } else {\n                gainNode.connect(this.sfxGain!);\n            }\n            \n            // Track the audio source\n            const audioSource: AudioSource = {\n                id: sourceId,\n                node: source,\n                gainNode,\n                pannerNode,\n                position,\n                isPlaying: true,\n                loop: soundEffect.loop,\n                startTime: this.context.currentTime\n            };\n            \n            this.activeSources.set(sourceId, audioSource);\n            \n            // Handle sound end\n            source.onended = () => {\n                this.activeSources.delete(sourceId);\n            };\n            \n            // Start playback\n            source.start();\n            \n            this.logger.debug(`Playing sound: ${soundId} (${sourceId})`);\n            return sourceId;\n            \n        } catch (error) {\n            this.logger.error(`Failed to play sound: ${soundId}`, error);\n            return null;\n        }\n    }\n\n    /**\n     * Stop a playing sound\n     */\n    stopSound(sourceId: string): void {\n        const audioSource = this.activeSources.get(sourceId);\n        if (audioSource && audioSource.isPlaying) {\n            try {\n                audioSource.node.stop();\n                audioSource.isPlaying = false;\n                this.activeSources.delete(sourceId);\n                this.logger.debug(`Stopped sound: ${sourceId}`);\n            } catch (error) {\n                this.logger.error(`Failed to stop sound: ${sourceId}`, error);\n            }\n        }\n    }\n\n    /**\n     * Update spatial audio positions\n     */\n    updateSpatialAudio(sourceId: string, position: Vector2): void {\n        const audioSource = this.activeSources.get(sourceId);\n        if (audioSource && audioSource.pannerNode) {\n            audioSource.pannerNode.positionX.value = position.x;\n            audioSource.pannerNode.positionY.value = position.y;\n            audioSource.position = position;\n        }\n    }\n\n    /**\n     * Set listener position for spatial audio\n     */\n    setListenerPosition(position: Vector2, orientation: number = 0): void {\n        if (!this.context || !this.config.enableSpatialAudio) return;\n        \n        const listener = this.context.listener;\n        if (listener.positionX) {\n            listener.positionX.value = position.x;\n            listener.positionY.value = position.y;\n            listener.positionZ.value = 0;\n            \n            // Set orientation\n            listener.forwardX.value = Math.cos(orientation);\n            listener.forwardY.value = Math.sin(orientation);\n            listener.forwardZ.value = 0;\n            \n            listener.upX.value = 0;\n            listener.upY.value = 0;\n            listener.upZ.value = 1;\n        }\n    }\n\n    /**\n     * Volume controls\n     */\n    setMasterVolume(volume: number): void {\n        this.config.masterVolume = Math.max(0, Math.min(1, volume));\n        if (this.masterGain) {\n            this.masterGain.gain.value = this.config.masterVolume;\n        }\n    }\n\n    setMusicVolume(volume: number): void {\n        this.config.musicVolume = Math.max(0, Math.min(1, volume));\n        if (this.musicGain) {\n            this.musicGain.gain.value = this.config.musicVolume;\n        }\n    }\n\n    setSfxVolume(volume: number): void {\n        this.config.sfxVolume = Math.max(0, Math.min(1, volume));\n        if (this.sfxGain) {\n            this.sfxGain.gain.value = this.config.sfxVolume;\n        }\n    }\n\n    /**\n     * Game-specific audio methods\n     */\n    playEngineSound(): string | null {\n        return this.playSfx('engine_thrust', undefined, 1.0, 0.6);\n    }\n\n    playLaserSound(position?: Vector2): string | null {\n        return this.playSfx('weapon_laser', position, 1.0 + (Math.random() - 0.5) * 0.2);\n    }\n\n    playExplosion(position?: Vector2): string | null {\n        return this.playSfx('explosion', position, 1.0, 0.8);\n    }\n\n    playUIBeep(): string | null {\n        return this.playSfx('ui_beep');\n    }\n\n    /**\n     * Update audio engine (called each frame)\n     */\n    update(deltaTime: number): void {\n        // Clean up finished sounds\n        for (const [id, source] of this.activeSources) {\n            if (!source.isPlaying && !source.loop) {\n                this.activeSources.delete(id);\n            }\n        }\n    }\n\n    /**\n     * Pause all audio\n     */\n    pauseAll(): void {\n        if (this.context && this.context.state === 'running') {\n            this.context.suspend();\n            this.logger.debug('Audio paused');\n        }\n    }\n\n    /**\n     * Resume all audio\n     */\n    resumeAll(): void {\n        if (this.context && this.context.state === 'suspended') {\n            this.context.resume();\n            this.logger.debug('Audio resumed');\n        }\n    }\n\n    /**\n     * Stop all audio\n     */\n    stopAll(): void {\n        for (const [id, source] of this.activeSources) {\n            if (source.isPlaying) {\n                try {\n                    source.node.stop();\n                } catch (error) {\n                    // Ignore errors when stopping\n                }\n            }\n        }\n        this.activeSources.clear();\n        this.logger.debug('All audio stopped');\n    }\n\n    /**\n     * Get audio statistics\n     */\n    getStats() {\n        return {\n            isInitialized: this.isInitialized,\n            contextState: this.context?.state || 'none',\n            activeSources: this.activeSources.size,\n            soundEffects: this.soundEffects.size,\n            config: { ...this.config }\n        };\n    }\n\n    /**\n     * Cleanup audio resources\n     */\n    cleanup(): void {\n        this.stopAll();\n        \n        if (this.context) {\n            this.context.close();\n        }\n        \n        this.soundEffects.clear();\n        this.synthNodes.clear();\n        \n        this.logger.info('🧹 Audio engine cleanup completed');\n    }\n}","/**\n * Procedural Audio System\n * Advanced Web Audio API synthesis for retro 16-bit space game sounds\n */\n\nimport { Logger } from '@utils/Logger';\n\nexport enum SoundType {\n    Engine = 'engine',\n    Laser = 'laser',\n    Explosion = 'explosion',\n    Beep = 'beep',\n    Warning = 'warning',\n    Warp = 'warp',\n    Shield = 'shield',\n    Impact = 'impact',\n    Communication = 'communication',\n    Ambient = 'ambient',\n    UI = 'ui',\n    Thrust = 'thrust'\n}\n\nexport enum WaveformType {\n    Sine = 'sine',\n    Square = 'square',\n    Sawtooth = 'sawtooth',\n    Triangle = 'triangle',\n    Noise = 'white'\n}\n\nexport interface SoundConfig {\n    type: SoundType;\n    frequency: number;\n    duration: number;\n    volume: number;\n    \n    // Waveform settings\n    waveform: WaveformType;\n    harmonics?: number[];\n    \n    // Envelope (ADSR)\n    attack: number;\n    decay: number;\n    sustain: number;\n    release: number;\n    \n    // Modulation\n    frequencyModulation?: {\n        rate: number;\n        depth: number;\n        waveform: WaveformType;\n    };\n    \n    // Filter\n    filter?: {\n        type: 'lowpass' | 'highpass' | 'bandpass';\n        frequency: number;\n        resonance: number;\n    };\n    \n    // Effects\n    distortion?: number;\n    reverb?: {\n        roomSize: number;\n        dampening: number;\n        wetness: number;\n    };\n    \n    // Spatial audio\n    position?: { x: number, y: number, z: number };\n    maxDistance?: number;\n}\n\nexport interface AmbientTrackConfig {\n    name: string;\n    layers: AmbientLayer[];\n    fadeInTime: number;\n    fadeOutTime: number;\n    crossfadeTime: number;\n}\n\nexport interface AmbientLayer {\n    id: string;\n    waveform: WaveformType;\n    baseFrequency: number;\n    volume: number;\n    pan: number; // -1 to 1\n    \n    // Modulation\n    frequencyVariation: number;\n    volumeVariation: number;\n    \n    // Movement\n    frequency: {\n        min: number;\n        max: number;\n        speed: number; // Hz per second\n    };\n    \n    // Filter sweep\n    filter?: {\n        type: 'lowpass' | 'highpass' | 'bandpass';\n        minFreq: number;\n        maxFreq: number;\n        speed: number;\n        resonance: number;\n    };\n}\n\nexport interface AudioEvents {\n    onSoundPlayed?: (type: SoundType, config: SoundConfig) => void;\n    onTrackChanged?: (trackName: string) => void;\n    onAudioError?: (error: Error) => void;\n}\n\nexport class ProceduralAudio {\n    private audioContext: AudioContext | null = null;\n    private masterGain: GainNode | null = null;\n    private soundEffectsGain: GainNode | null = null;\n    private musicGain: GainNode | null = null;\n    \n    // Ambient music system\n    private currentTrack: string | null = null;\n    private ambientLayers: Map<string, {\n        oscillator: AudioScheduledSourceNode;\n        gain: GainNode;\n        filter?: BiquadFilterNode;\n        panner: StereoPannerNode;\n    }> = new Map();\n    \n    // Sound effect pools\n    private activeSounds: Set<AudioNode> = new Set();\n    \n    // Noise buffer for effects\n    private noiseBuffer: AudioBuffer | null = null;\n    \n    // Reverb\n    private convolver: ConvolverNode | null = null;\n    private reverbBuffer: AudioBuffer | null = null;\n    \n    // Master settings\n    private masterVolume: number = 0.7;\n    private musicVolume: number = 0.5;\n    private sfxVolume: number = 0.8;\n    \n    private events: AudioEvents;\n    private logger: Logger;\n\n    constructor(events: AudioEvents = {}) {\n        this.logger = new Logger('ProceduralAudio');\n        this.events = events;\n    }\n\n    /**\n     * Initialize audio system\n     */\n    async initialize(): Promise<void> {\n        try {\n            // Create audio context\n            this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\n            \n            if (this.audioContext.state === 'suspended') {\n                await this.audioContext.resume();\n            }\n            \n            // Create master gain nodes\n            this.masterGain = this.audioContext.createGain();\n            this.soundEffectsGain = this.audioContext.createGain();\n            this.musicGain = this.audioContext.createGain();\n            \n            // Connect audio graph\n            this.soundEffectsGain.connect(this.masterGain);\n            this.musicGain.connect(this.masterGain);\n            this.masterGain.connect(this.audioContext.destination);\n            \n            // Set initial volumes\n            this.masterGain.gain.value = this.masterVolume;\n            this.soundEffectsGain.gain.value = this.sfxVolume;\n            this.musicGain.gain.value = this.musicVolume;\n            \n            // Create noise buffer\n            await this.createNoiseBuffer();\n            \n            // Create reverb\n            await this.createReverbBuffer();\n            \n            this.logger.info('🔊 Procedural audio system initialized');\n            \n        } catch (error) {\n            this.logger.error('Failed to initialize audio system', error);\n            this.events.onAudioError?.(error as Error);\n        }\n    }\n\n    /**\n     * Create white noise buffer\n     */\n    private async createNoiseBuffer(): Promise<void> {\n        if (!this.audioContext) return;\n        \n        const bufferSize = this.audioContext.sampleRate * 2; // 2 seconds\n        this.noiseBuffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);\n        \n        const output = this.noiseBuffer.getChannelData(0);\n        for (let i = 0; i < bufferSize; i++) {\n            output[i] = Math.random() * 2 - 1;\n        }\n    }\n\n    /**\n     * Create reverb impulse response\n     */\n    private async createReverbBuffer(): Promise<void> {\n        if (!this.audioContext) return;\n        \n        const length = this.audioContext.sampleRate * 3; // 3 seconds\n        this.reverbBuffer = this.audioContext.createBuffer(2, length, this.audioContext.sampleRate);\n        \n        for (let channel = 0; channel < 2; channel++) {\n            const channelData = this.reverbBuffer.getChannelData(channel);\n            for (let i = 0; i < length; i++) {\n                const decay = Math.pow(1 - i / length, 2);\n                channelData[i] = (Math.random() * 2 - 1) * decay;\n            }\n        }\n        \n        this.convolver = this.audioContext.createConvolver();\n        this.convolver.buffer = this.reverbBuffer;\n    }\n\n    /**\n     * Play procedural sound effect\n     */\n    playSound(config: SoundConfig): void {\n        if (!this.audioContext || !this.soundEffectsGain) {\n            this.logger.warn('Audio system not initialized');\n            return;\n        }\n        \n        try {\n            const now = this.audioContext.currentTime;\n            let source: AudioScheduledSourceNode;\n            let sourceGain: GainNode;\n            \n            // Create source based on waveform\n            if (config.waveform === WaveformType.Noise) {\n                source = this.createNoiseSource();\n            } else {\n                source = this.createOscillatorSource(config);\n            }\n            \n            // Create gain for this sound\n            sourceGain = this.audioContext.createGain();\n            sourceGain.gain.value = 0;\n            \n            // Create filter if specified\n            let filterNode: BiquadFilterNode | undefined;\n            if (config.filter) {\n                filterNode = this.audioContext.createBiquadFilter();\n                filterNode.type = config.filter.type;\n                filterNode.frequency.value = config.filter.frequency;\n                filterNode.Q.value = config.filter.resonance;\n            }\n            \n            // Create distortion if specified\n            let distortionNode: WaveShaperNode | undefined;\n            if (config.distortion && config.distortion > 0) {\n                distortionNode = this.createDistortion(config.distortion);\n            }\n            \n            // Create spatial panner if position specified\n            let pannerNode: PannerNode | undefined;\n            if (config.position) {\n                pannerNode = this.audioContext.createPanner();\n                pannerNode.panningModel = 'HRTF';\n                pannerNode.positionX.value = config.position.x;\n                pannerNode.positionY.value = config.position.y;\n                pannerNode.positionZ.value = config.position.z;\n                pannerNode.maxDistance = config.maxDistance || 1000;\n            }\n            \n            // Connect audio graph\n            let currentNode: AudioNode = source;\n            \n            if (filterNode) {\n                currentNode.connect(filterNode);\n                currentNode = filterNode;\n            }\n            \n            if (distortionNode) {\n                currentNode.connect(distortionNode);\n                currentNode = distortionNode;\n            }\n            \n            currentNode.connect(sourceGain);\n            \n            if (pannerNode) {\n                sourceGain.connect(pannerNode);\n                pannerNode.connect(this.soundEffectsGain);\n            } else {\n                sourceGain.connect(this.soundEffectsGain);\n            }\n            \n            // Apply ADSR envelope\n            this.applyEnvelope(sourceGain.gain, config, now);\n            \n            // Apply frequency modulation if specified\n            if (config.frequencyModulation && source instanceof OscillatorNode) {\n                this.applyFrequencyModulation(source, config.frequencyModulation, now);\n            }\n            \n            // Start and schedule stop\n            source.start(now);\n            source.stop(now + config.duration);\n            \n            // Track active sound\n            this.activeSounds.add(source);\n            source.addEventListener('ended', () => {\n                this.activeSounds.delete(source);\n            });\n            \n            this.events.onSoundPlayed?.(config.type, config);\n            \n        } catch (error) {\n            this.logger.error('Failed to play sound', error);\n        }\n    }\n\n    /**\n     * Create oscillator source\n     */\n    private createOscillatorSource(config: SoundConfig): OscillatorNode {\n        const oscillator = this.audioContext!.createOscillator();\n        oscillator.type = config.waveform as OscillatorType;\n        oscillator.frequency.value = config.frequency;\n        \n        // Add harmonics for richer sound\n        if (config.harmonics) {\n            // Create additional oscillators for harmonics\n            config.harmonics.forEach((harmonic, index) => {\n                if (harmonic > 0) {\n                    const harmonicOsc = this.audioContext!.createOscillator();\n                    const harmonicGain = this.audioContext!.createGain();\n                    \n                    harmonicOsc.type = config.waveform as OscillatorType;\n                    harmonicOsc.frequency.value = config.frequency * (index + 2);\n                    harmonicGain.gain.value = harmonic;\n                    \n                    harmonicOsc.connect(harmonicGain);\n                    // Note: This simplified version connects to the same destination\n                    // In practice, you'd want to manage these connections properly\n                }\n            });\n        }\n        \n        return oscillator;\n    }\n\n    /**\n     * Create noise source\n     */\n    private createNoiseSource(): AudioBufferSourceNode {\n        const source = this.audioContext!.createBufferSource();\n        source.buffer = this.noiseBuffer;\n        source.loop = true;\n        return source;\n    }\n\n    /**\n     * Create distortion effect\n     */\n    private createDistortion(amount: number): WaveShaperNode {\n        const distortion = this.audioContext!.createWaveShaper();\n        const samples = 44100;\n        const curve = new Float32Array(samples);\n        const deg = Math.PI / 180;\n        \n        for (let i = 0; i < samples; i++) {\n            const x = (i * 2) / samples - 1;\n            curve[i] = ((3 + amount) * x * 20 * deg) / (Math.PI + amount * Math.abs(x));\n        }\n        \n        distortion.curve = curve;\n        distortion.oversample = '4x';\n        \n        return distortion;\n    }\n\n    /**\n     * Apply ADSR envelope\n     */\n    private applyEnvelope(gainParam: AudioParam, config: SoundConfig, startTime: number): void {\n        const { attack, decay, sustain, release, volume, duration } = config;\n        \n        // Attack\n        gainParam.setValueAtTime(0, startTime);\n        gainParam.linearRampToValueAtTime(volume, startTime + attack);\n        \n        // Decay\n        gainParam.linearRampToValueAtTime(volume * sustain, startTime + attack + decay);\n        \n        // Sustain (hold until release)\n        const sustainEnd = Math.max(startTime + attack + decay, startTime + duration - release);\n        gainParam.setValueAtTime(volume * sustain, sustainEnd);\n        \n        // Release\n        gainParam.linearRampToValueAtTime(0, startTime + duration);\n    }\n\n    /**\n     * Apply frequency modulation\n     */\n    private applyFrequencyModulation(\n        oscillator: OscillatorNode, \n        modConfig: NonNullable<SoundConfig['frequencyModulation']>, \n        startTime: number\n    ): void {\n        const modOscillator = this.audioContext!.createOscillator();\n        const modGain = this.audioContext!.createGain();\n        \n        modOscillator.type = modConfig.waveform as OscillatorType;\n        modOscillator.frequency.value = modConfig.rate;\n        modGain.gain.value = modConfig.depth;\n        \n        modOscillator.connect(modGain);\n        modGain.connect(oscillator.frequency);\n        \n        modOscillator.start(startTime);\n        modOscillator.stop(startTime + 10); // Long enough for any sound\n    }\n\n    /**\n     * Play retro-style sound effects\n     */\n    playRetroSound(type: SoundType, intensity: number = 1.0): void {\n        const configs: { [key in SoundType]: SoundConfig } = {\n            [SoundType.Engine]: {\n                type: SoundType.Engine,\n                frequency: 60 + intensity * 40,\n                duration: 0.5,\n                volume: 0.3 * intensity,\n                waveform: WaveformType.Sawtooth,\n                attack: 0.1,\n                decay: 0.1,\n                sustain: 0.7,\n                release: 0.3,\n                filter: {\n                    type: 'lowpass',\n                    frequency: 800 + intensity * 400,\n                    resonance: 2\n                }\n            },\n            [SoundType.Laser]: {\n                type: SoundType.Laser,\n                frequency: 800,\n                duration: 0.15,\n                volume: 0.4 * intensity,\n                waveform: WaveformType.Square,\n                attack: 0.01,\n                decay: 0.05,\n                sustain: 0.3,\n                release: 0.09,\n                frequencyModulation: {\n                    rate: 30,\n                    depth: 200,\n                    waveform: WaveformType.Sine\n                }\n            },\n            [SoundType.Explosion]: {\n                type: SoundType.Explosion,\n                frequency: 120,\n                duration: 0.8,\n                volume: 0.6 * intensity,\n                waveform: WaveformType.Noise,\n                attack: 0.01,\n                decay: 0.3,\n                sustain: 0.2,\n                release: 0.49,\n                filter: {\n                    type: 'lowpass',\n                    frequency: 2000 - intensity * 500,\n                    resonance: 1\n                },\n                distortion: 0.5\n            },\n            [SoundType.Beep]: {\n                type: SoundType.Beep,\n                frequency: 1000,\n                duration: 0.1,\n                volume: 0.3 * intensity,\n                waveform: WaveformType.Square,\n                attack: 0.01,\n                decay: 0.02,\n                sustain: 0.8,\n                release: 0.07\n            },\n            [SoundType.Warning]: {\n                type: SoundType.Warning,\n                frequency: 800,\n                duration: 0.5,\n                volume: 0.5 * intensity,\n                waveform: WaveformType.Square,\n                attack: 0.05,\n                decay: 0.1,\n                sustain: 0.6,\n                release: 0.35,\n                frequencyModulation: {\n                    rate: 8,\n                    depth: 100,\n                    waveform: WaveformType.Triangle\n                }\n            },\n            [SoundType.Warp]: {\n                type: SoundType.Warp,\n                frequency: 200,\n                duration: 2.0,\n                volume: 0.4 * intensity,\n                waveform: WaveformType.Sine,\n                attack: 0.5,\n                decay: 0.5,\n                sustain: 0.8,\n                release: 1.0,\n                frequencyModulation: {\n                    rate: 0.5,\n                    depth: 400,\n                    waveform: WaveformType.Sine\n                },\n                reverb: {\n                    roomSize: 0.8,\n                    dampening: 0.3,\n                    wetness: 0.6\n                }\n            },\n            [SoundType.Shield]: {\n                type: SoundType.Shield,\n                frequency: 400,\n                duration: 0.3,\n                volume: 0.3 * intensity,\n                waveform: WaveformType.Triangle,\n                attack: 0.1,\n                decay: 0.1,\n                sustain: 0.5,\n                release: 0.1,\n                filter: {\n                    type: 'bandpass',\n                    frequency: 600,\n                    resonance: 5\n                }\n            },\n            [SoundType.Impact]: {\n                type: SoundType.Impact,\n                frequency: 80,\n                duration: 0.2,\n                volume: 0.5 * intensity,\n                waveform: WaveformType.Noise,\n                attack: 0.01,\n                decay: 0.05,\n                sustain: 0.3,\n                release: 0.14,\n                filter: {\n                    type: 'lowpass',\n                    frequency: 500,\n                    resonance: 2\n                },\n                distortion: 0.3\n            },\n            [SoundType.Communication]: {\n                type: SoundType.Communication,\n                frequency: 1200,\n                duration: 0.4,\n                volume: 0.25 * intensity,\n                waveform: WaveformType.Sine,\n                attack: 0.1,\n                decay: 0.1,\n                sustain: 0.6,\n                release: 0.2,\n                frequencyModulation: {\n                    rate: 5,\n                    depth: 50,\n                    waveform: WaveformType.Triangle\n                }\n            },\n            [SoundType.Ambient]: {\n                type: SoundType.Ambient,\n                frequency: 200,\n                duration: 5.0,\n                volume: 0.2 * intensity,\n                waveform: WaveformType.Sine,\n                attack: 2.0,\n                decay: 1.0,\n                sustain: 0.8,\n                release: 2.0\n            },\n            [SoundType.UI]: {\n                type: SoundType.UI,\n                frequency: 600,\n                duration: 0.08,\n                volume: 0.2 * intensity,\n                waveform: WaveformType.Square,\n                attack: 0.01,\n                decay: 0.02,\n                sustain: 0.5,\n                release: 0.05\n            },\n            [SoundType.Thrust]: {\n                type: SoundType.Thrust,\n                frequency: 100 + intensity * 50,\n                duration: 0.3,\n                volume: 0.4 * intensity,\n                waveform: WaveformType.Sawtooth,\n                attack: 0.05,\n                decay: 0.1,\n                sustain: 0.8,\n                release: 0.15,\n                filter: {\n                    type: 'lowpass',\n                    frequency: 400 + intensity * 200,\n                    resonance: 1\n                }\n            }\n        };\n        \n        this.playSound(configs[type]);\n    }\n\n    /**\n     * Start ambient space music\n     */\n    startAmbientTrack(trackName: string): void {\n        if (this.currentTrack === trackName) return;\n        \n        this.stopAmbientTrack();\n        \n        const trackConfigs: { [key: string]: AmbientTrackConfig } = {\n            'deep_space': {\n                name: 'Deep Space',\n                fadeInTime: 3.0,\n                fadeOutTime: 2.0,\n                crossfadeTime: 1.0,\n                layers: [\n                    {\n                        id: 'bass_drone',\n                        waveform: WaveformType.Sine,\n                        baseFrequency: 40,\n                        volume: 0.3,\n                        pan: 0,\n                        frequencyVariation: 0.1,\n                        volumeVariation: 0.2,\n                        frequency: { min: 35, max: 45, speed: 0.1 },\n                        filter: {\n                            type: 'lowpass',\n                            minFreq: 200,\n                            maxFreq: 800,\n                            speed: 0.05,\n                            resonance: 2\n                        }\n                    },\n                    {\n                        id: 'cosmic_wind',\n                        waveform: WaveformType.Noise,\n                        baseFrequency: 200,\n                        volume: 0.15,\n                        pan: -0.3,\n                        frequencyVariation: 0.3,\n                        volumeVariation: 0.4,\n                        frequency: { min: 150, max: 300, speed: 0.2 },\n                        filter: {\n                            type: 'bandpass',\n                            minFreq: 800,\n                            maxFreq: 3000,\n                            speed: 0.3,\n                            resonance: 1\n                        }\n                    },\n                    {\n                        id: 'stellar_harmonics',\n                        waveform: WaveformType.Triangle,\n                        baseFrequency: 220,\n                        volume: 0.2,\n                        pan: 0.4,\n                        frequencyVariation: 0.2,\n                        volumeVariation: 0.3,\n                        frequency: { min: 200, max: 440, speed: 0.15 },\n                        filter: {\n                            type: 'highpass',\n                            minFreq: 400,\n                            maxFreq: 1200,\n                            speed: 0.1,\n                            resonance: 0.5\n                        }\n                    }\n                ]\n            },\n            'nebula_drift': {\n                name: 'Nebula Drift',\n                fadeInTime: 4.0,\n                fadeOutTime: 3.0,\n                crossfadeTime: 2.0,\n                layers: [\n                    {\n                        id: 'nebula_wash',\n                        waveform: WaveformType.Sine,\n                        baseFrequency: 80,\n                        volume: 0.25,\n                        pan: 0,\n                        frequencyVariation: 0.3,\n                        volumeVariation: 0.5,\n                        frequency: { min: 60, max: 120, speed: 0.08 },\n                        filter: {\n                            type: 'lowpass',\n                            minFreq: 300,\n                            maxFreq: 1500,\n                            speed: 0.12,\n                            resonance: 3\n                        }\n                    },\n                    {\n                        id: 'particle_shimmer',\n                        waveform: WaveformType.Triangle,\n                        baseFrequency: 800,\n                        volume: 0.1,\n                        pan: -0.6,\n                        frequencyVariation: 0.4,\n                        volumeVariation: 0.6,\n                        frequency: { min: 600, max: 1200, speed: 0.4 },\n                        filter: {\n                            type: 'bandpass',\n                            minFreq: 1000,\n                            maxFreq: 4000,\n                            speed: 0.5,\n                            resonance: 2\n                        }\n                    }\n                ]\n            },\n            'void_silence': {\n                name: 'Void Silence',\n                fadeInTime: 5.0,\n                fadeOutTime: 4.0,\n                crossfadeTime: 3.0,\n                layers: [\n                    {\n                        id: 'quantum_whisper',\n                        waveform: WaveformType.Sine,\n                        baseFrequency: 30,\n                        volume: 0.15,\n                        pan: 0,\n                        frequencyVariation: 0.05,\n                        volumeVariation: 0.8,\n                        frequency: { min: 25, max: 35, speed: 0.02 },\n                        filter: {\n                            type: 'lowpass',\n                            minFreq: 100,\n                            maxFreq: 400,\n                            speed: 0.03,\n                            resonance: 1\n                        }\n                    }\n                ]\n            }\n        };\n        \n        const config = trackConfigs[trackName];\n        if (!config) {\n            this.logger.warn(`Unknown ambient track: ${trackName}`);\n            return;\n        }\n        \n        this.currentTrack = trackName;\n        this.createAmbientLayers(config);\n        \n        this.events.onTrackChanged?.(trackName);\n        this.logger.info(`🎵 Started ambient track: ${trackName}`);\n    }\n\n    /**\n     * Create ambient music layers\n     */\n    private createAmbientLayers(config: AmbientTrackConfig): void {\n        if (!this.audioContext || !this.musicGain) return;\n        \n        const now = this.audioContext.currentTime;\n        \n        config.layers.forEach(layerConfig => {\n            let source: AudioScheduledSourceNode;\n            \n            if (layerConfig.waveform === WaveformType.Noise) {\n                source = this.audioContext!.createBufferSource();\n                (source as AudioBufferSourceNode).buffer = this.noiseBuffer;\n                (source as AudioBufferSourceNode).loop = true;\n            } else {\n                const oscillator = this.audioContext!.createOscillator();\n                oscillator.type = layerConfig.waveform as OscillatorType;\n                oscillator.frequency.value = layerConfig.baseFrequency;\n                source = oscillator;\n            }\n            \n            // Create gain for this layer\n            const layerGain = this.audioContext!.createGain();\n            layerGain.gain.value = 0;\n            \n            // Create panner\n            const panner = this.audioContext!.createStereoPanner();\n            panner.pan.value = layerConfig.pan;\n            \n            // Create filter if specified\n            let filter: BiquadFilterNode | undefined;\n            if (layerConfig.filter) {\n                filter = this.audioContext!.createBiquadFilter();\n                filter.type = layerConfig.filter.type;\n                filter.frequency.value = layerConfig.filter.minFreq;\n                filter.Q.value = layerConfig.filter.resonance;\n            }\n            \n            // Connect audio graph\n            let currentNode: AudioNode = source;\n            \n            if (filter) {\n                currentNode.connect(filter);\n                currentNode = filter;\n            }\n            \n            currentNode.connect(layerGain);\n            layerGain.connect(panner);\n            panner.connect(this.musicGain!);\n            \n            // Fade in\n            layerGain.gain.linearRampToValueAtTime(\n                layerConfig.volume, \n                now + config.fadeInTime\n            );\n            \n            // Start the source\n            source.start(now);\n            \n            // Store layer references\n            this.ambientLayers.set(layerConfig.id, {\n                oscillator: source,\n                gain: layerGain,\n                filter,\n                panner\n            });\n            \n            // Start modulation if oscillator\n            if (source instanceof OscillatorNode) {\n                this.startLayerModulation(source, layerConfig, filter);\n            }\n        });\n    }\n\n    /**\n     * Start layer modulation effects\n     */\n    private startLayerModulation(\n        oscillator: OscillatorNode, \n        config: AmbientLayer, \n        filter?: BiquadFilterNode\n    ): void {\n        if (!this.audioContext) return;\n        \n        // Frequency modulation\n        const freqModOsc = this.audioContext.createOscillator();\n        const freqModGain = this.audioContext.createGain();\n        \n        freqModOsc.type = 'sine';\n        freqModOsc.frequency.value = config.frequency.speed;\n        freqModGain.gain.value = (config.frequency.max - config.frequency.min) / 2;\n        \n        freqModOsc.connect(freqModGain);\n        freqModGain.connect(oscillator.frequency);\n        freqModOsc.start();\n        \n        // Filter modulation\n        if (filter && config.filter) {\n            const filterModOsc = this.audioContext.createOscillator();\n            const filterModGain = this.audioContext.createGain();\n            \n            filterModOsc.type = 'triangle';\n            filterModOsc.frequency.value = config.filter.speed;\n            filterModGain.gain.value = (config.filter.maxFreq - config.filter.minFreq) / 2;\n            \n            filterModOsc.connect(filterModGain);\n            filterModGain.connect(filter.frequency);\n            filterModOsc.start();\n        }\n    }\n\n    /**\n     * Stop ambient track\n     */\n    stopAmbientTrack(): void {\n        if (!this.currentTrack || !this.audioContext) return;\n        \n        const now = this.audioContext.currentTime;\n        const fadeTime = 2.0;\n        \n        // Fade out all layers\n        this.ambientLayers.forEach(layer => {\n            layer.gain.gain.linearRampToValueAtTime(0, now + fadeTime);\n            layer.oscillator.stop(now + fadeTime + 0.1);\n        });\n        \n        // Clear layers after fade\n        setTimeout(() => {\n            this.ambientLayers.clear();\n        }, (fadeTime + 0.2) * 1000);\n        \n        this.currentTrack = null;\n        this.logger.info('🎵 Stopped ambient track');\n    }\n\n    /**\n     * Set master volume\n     */\n    setMasterVolume(volume: number): void {\n        this.masterVolume = Math.max(0, Math.min(1, volume));\n        if (this.masterGain) {\n            this.masterGain.gain.value = this.masterVolume;\n        }\n    }\n\n    /**\n     * Set music volume\n     */\n    setMusicVolume(volume: number): void {\n        this.musicVolume = Math.max(0, Math.min(1, volume));\n        if (this.musicGain) {\n            this.musicGain.gain.value = this.musicVolume;\n        }\n    }\n\n    /**\n     * Set sound effects volume\n     */\n    setSFXVolume(volume: number): void {\n        this.sfxVolume = Math.max(0, Math.min(1, volume));\n        if (this.soundEffectsGain) {\n            this.soundEffectsGain.gain.value = this.sfxVolume;\n        }\n    }\n\n    /**\n     * Get audio statistics\n     */\n    getAudioStats(): {\n        contextState: string;\n        activeSounds: number;\n        currentTrack: string | null;\n        ambientLayers: number;\n        masterVolume: number;\n        musicVolume: number;\n        sfxVolume: number;\n    } {\n        return {\n            contextState: this.audioContext?.state || 'not_initialized',\n            activeSounds: this.activeSounds.size,\n            currentTrack: this.currentTrack,\n            ambientLayers: this.ambientLayers.size,\n            masterVolume: this.masterVolume,\n            musicVolume: this.musicVolume,\n            sfxVolume: this.sfxVolume\n        };\n    }\n\n    /**\n     * Stop all sounds\n     */\n    stopAllSounds(): void {\n        // Stop sound effects\n        this.activeSounds.forEach(sound => {\n            if (sound instanceof AudioScheduledSourceNode) {\n                try {\n                    sound.stop();\n                } catch (e) {\n                    // Sound might already be stopped\n                }\n            }\n        });\n        this.activeSounds.clear();\n        \n        // Stop ambient music\n        this.stopAmbientTrack();\n    }\n\n    /**\n     * Dispose audio system\n     */\n    dispose(): void {\n        this.stopAllSounds();\n        \n        if (this.audioContext) {\n            this.audioContext.close();\n            this.audioContext = null;\n        }\n        \n        this.logger.info('🔊 Audio system disposed');\n    }\n}","/**\n * Main Menu System\n * Professional game menu with retro CRT styling and smooth transitions\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\nimport { InputManager } from '@core/InputManager';\nimport { ProceduralAudio, SoundType } from '@audio/ProceduralAudio';\nimport { ParticleSystem, ParticleType } from '@effects/ParticleSystem';\n\nexport enum MenuState {\n    MainMenu = 'main_menu',\n    NewGame = 'new_game',\n    LoadGame = 'load_game',\n    Settings = 'settings',\n    Connecting = 'connecting',\n    GameStart = 'game_start'\n}\n\nexport interface MenuButton {\n    id: string;\n    text: string;\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    enabled: boolean;\n    highlighted: boolean;\n    action: () => void;\n    hotkey?: string;\n}\n\nexport interface MenuConfig {\n    title: string;\n    subtitle?: string;\n    showBackground: boolean;\n    showParticles: boolean;\n    enableSounds: boolean;\n    transitionTime: number;\n}\n\nexport interface NewGameSettings {\n    playerName: string;\n    difficulty: 'easy' | 'normal' | 'hard' | 'nightmare';\n    galaxySeed: string;\n    galaxySize: 'small' | 'medium' | 'large' | 'huge';\n    startingResources: 'minimal' | 'standard' | 'abundant';\n    enemyFrequency: 'low' | 'normal' | 'high' | 'extreme';\n    enablePermadeath: boolean;\n    enableTutorial: boolean;\n}\n\nexport interface GameSettings {\n    // Video settings\n    renderScale: number;\n    vsync: boolean;\n    fullscreen: boolean;\n    \n    // Audio settings\n    masterVolume: number;\n    musicVolume: number;\n    sfxVolume: number;\n    \n    // Gameplay settings\n    difficulty: 'easy' | 'normal' | 'hard';\n    mouseSensitivity: number;\n    showFPS: boolean;\n    autoSave: boolean;\n    autoSaveInterval: number;\n    \n    // Accessibility\n    colorblindMode: 'none' | 'deuteranopia' | 'protanopia' | 'tritanopia';\n    subtitles: boolean;\n    reducedMotion: boolean;\n    \n    // Controls\n    keyBindings: { [action: string]: string };\n}\n\nexport interface MenuEvents {\n    onNewGame?: (settings: NewGameSettings) => void;\n    onLoadGame?: (saveSlot: number) => void;\n    onSettings?: (settings: GameSettings) => void;\n    onExit?: () => void;\n    onGameStart?: () => void;\n}\n\nexport class MainMenu {\n    private currentState: MenuState = MenuState.MainMenu;\n    private previousState: MenuState | null = null;\n    \n    // UI state\n    private buttons: MenuButton[] = [];\n    private selectedButtonIndex: number = 0;\n    private animationTime: number = 0;\n    private transitionProgress: number = 0;\n    private isTransitioning: boolean = false;\n    \n    // Settings\n    private newGameSettings: NewGameSettings;\n    private gameSettings: GameSettings;\n    \n    // Visual effects\n    private backgroundParticles: string[] = [];\n    private titleGlow: number = 0;\n    private screenFlicker: number = 0;\n    \n    // Menu specific data\n    private saveSlots: Array<{\n        slot: number;\n        name: string;\n        date: string;\n        playtime: string;\n        level: number;\n        system: string;\n        exists: boolean;\n    }> = [];\n    \n    private events: MenuEvents;\n    private audio: ProceduralAudio | null = null;\n    private particles: ParticleSystem | null = null;\n    private logger: Logger;\n\n    constructor(\n        events: MenuEvents,\n        audio?: ProceduralAudio,\n        particles?: ParticleSystem\n    ) {\n        this.logger = new Logger('MainMenu');\n        this.events = events;\n        this.audio = audio || null;\n        this.particles = particles || null;\n        \n        // Initialize default settings\n        this.newGameSettings = this.getDefaultNewGameSettings();\n        this.gameSettings = this.getDefaultGameSettings();\n        \n        // Load save slots\n        this.loadSaveSlots();\n        \n        // Initialize main menu\n        this.initializeMainMenu();\n        \n        // Start background effects\n        this.startBackgroundEffects();\n        \n        this.logger.info('🎮 Main menu system initialized');\n    }\n\n    /**\n     * Update menu system\n     */\n    update(deltaTime: number, input: InputManager): void {\n        this.animationTime += deltaTime;\n        \n        // Update visual effects\n        this.updateVisualEffects(deltaTime);\n        \n        // Handle transitions\n        if (this.isTransitioning) {\n            this.updateTransition(deltaTime);\n            return;\n        }\n        \n        // Handle input based on current state\n        this.handleInput(input);\n        \n        // Update particles\n        this.updateParticleEffects(deltaTime);\n    }\n\n    /**\n     * Handle input for current menu state\n     */\n    private handleInput(input: InputManager): void {\n        // Navigation\n        if (input.isKeyPressed('ArrowUp') || input.isKeyPressed('KeyW')) {\n            this.navigateUp();\n        } else if (input.isKeyPressed('ArrowDown') || input.isKeyPressed('KeyS')) {\n            this.navigateDown();\n        }\n        \n        // Selection\n        if (input.isKeyPressed('Enter') || input.isKeyPressed('Space')) {\n            this.selectButton();\n        }\n        \n        // Back/Cancel\n        if (input.isKeyPressed('Escape')) {\n            this.goBack();\n        }\n        \n        // State-specific input\n        switch (this.currentState) {\n            case MenuState.NewGame:\n                this.handleNewGameInput(input);\n                break;\n            case MenuState.Settings:\n                this.handleSettingsInput(input);\n                break;\n        }\n        \n        // Hotkey support\n        this.handleHotkeys(input);\n    }\n\n    /**\n     * Navigate up in menu\n     */\n    private navigateUp(): void {\n        if (this.buttons.length === 0) return;\n        \n        this.playUISound('navigation');\n        \n        do {\n            this.selectedButtonIndex = (this.selectedButtonIndex - 1 + this.buttons.length) % this.buttons.length;\n        } while (!this.buttons[this.selectedButtonIndex].enabled);\n        \n        this.updateButtonHighlights();\n    }\n\n    /**\n     * Navigate down in menu\n     */\n    private navigateDown(): void {\n        if (this.buttons.length === 0) return;\n        \n        this.playUISound('navigation');\n        \n        do {\n            this.selectedButtonIndex = (this.selectedButtonIndex + 1) % this.buttons.length;\n        } while (!this.buttons[this.selectedButtonIndex].enabled);\n        \n        this.updateButtonHighlights();\n    }\n\n    /**\n     * Select current button\n     */\n    private selectButton(): void {\n        if (this.buttons.length === 0 || this.selectedButtonIndex >= this.buttons.length) return;\n        \n        const button = this.buttons[this.selectedButtonIndex];\n        if (!button.enabled) return;\n        \n        this.playUISound('select');\n        button.action();\n    }\n\n    /**\n     * Go back to previous menu\n     */\n    private goBack(): void {\n        this.playUISound('back');\n        \n        switch (this.currentState) {\n            case MenuState.MainMenu:\n                // Exit game or minimize\n                this.events.onExit?.();\n                break;\n            default:\n                this.transitionToState(MenuState.MainMenu);\n                break;\n        }\n    }\n\n    /**\n     * Initialize main menu buttons\n     */\n    private initializeMainMenu(): void {\n        this.buttons = [\n            {\n                id: 'new_game',\n                text: 'NOVÁ HRA',\n                x: 0, y: 0, width: 220, height: 45,\n                enabled: true,\n                highlighted: false,\n                action: () => this.transitionToState(MenuState.NewGame),\n                hotkey: 'KeyN'\n            },\n            {\n                id: 'load_game',\n                text: 'NAČÍST HRU',\n                x: 0, y: 0, width: 220, height: 45,\n                enabled: this.hasSaveGames(),\n                highlighted: false,\n                action: () => this.transitionToState(MenuState.LoadGame),\n                hotkey: 'KeyL'\n            },\n            {\n                id: 'settings',\n                text: 'NASTAVENÍ',\n                x: 0, y: 0, width: 220, height: 45,\n                enabled: true,\n                highlighted: false,\n                action: () => this.transitionToState(MenuState.Settings),\n                hotkey: 'KeyS'\n            },\n            {\n                id: 'exit',\n                text: 'UKONČIT',\n                x: 0, y: 0, width: 220, height: 45,\n                enabled: true,\n                highlighted: false,\n                action: () => this.events.onExit?.(),\n                hotkey: 'KeyQ'\n            }\n        ];\n        \n        this.selectedButtonIndex = 0;\n        this.updateButtonPositions();\n        this.updateButtonHighlights();\n    }\n\n    /**\n     * Initialize new game menu\n     */\n    private initializeNewGameMenu(): void {\n        this.buttons = [\n            {\n                id: 'player_name',\n                text: `JMÉNO PILOTA: ${this.newGameSettings.playerName}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.editPlayerName()\n            },\n            {\n                id: 'difficulty',\n                text: `OBTÍŽNOST: ${this.translateDifficulty(this.newGameSettings.difficulty)}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.cycleDifficulty()\n            },\n            {\n                id: 'galaxy_size',\n                text: `VELIKOST GALAXIE: ${this.translateGalaxySize(this.newGameSettings.galaxySize)}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.cycleGalaxySize()\n            },\n            {\n                id: 'enemy_frequency',\n                text: `NEPŘÁTELÉ: ${this.translateEnemyFrequency(this.newGameSettings.enemyFrequency)}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.cycleEnemyFrequency()\n            },\n            {\n                id: 'permadeath',\n                text: `PERMANENTNÍ SMRT: ${this.newGameSettings.enablePermadeath ? 'ZAPNUTO' : 'VYPNUTO'}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.togglePermadeath()\n            },\n            {\n                id: 'tutorial',\n                text: `TUTORIÁL: ${this.newGameSettings.enableTutorial ? 'ZAPNUTO' : 'VYPNUTO'}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.toggleTutorial()\n            },\n            {\n                id: 'start_game',\n                text: 'ZAHÁJIT MISI',\n                x: 0, y: 0, width: 300, height: 40,\n                enabled: true,\n                highlighted: false,\n                action: () => this.startNewGame()\n            },\n            {\n                id: 'back',\n                text: 'ZPĚT',\n                x: 0, y: 0, width: 200, height: 40,\n                enabled: true,\n                highlighted: false,\n                action: () => this.transitionToState(MenuState.MainMenu)\n            }\n        ];\n        \n        this.selectedButtonIndex = 0;\n        this.updateButtonPositions();\n        this.updateButtonHighlights();\n    }\n\n    /**\n     * Initialize load game menu\n     */\n    private initializeLoadGameMenu(): void {\n        this.buttons = [];\n        \n        // Add save slot buttons\n        for (let i = 0; i < this.saveSlots.length; i++) {\n            const slot = this.saveSlots[i];\n            \n            this.buttons.push({\n                id: `save_slot_${slot.slot}`,\n                text: slot.exists ? \n                    `SLOT ${slot.slot}: ${slot.name} - ${slot.system} (${slot.playtime})` :\n                    `SLOT ${slot.slot}: EMPTY`,\n                x: 0, y: 0, width: 600, height: 40,\n                enabled: slot.exists,\n                highlighted: false,\n                action: () => this.loadGame(slot.slot)\n            });\n        }\n        \n        // Add back button\n        this.buttons.push({\n            id: 'back',\n            text: 'BACK',\n            x: 0, y: 0, width: 200, height: 40,\n            enabled: true,\n            highlighted: false,\n            action: () => this.transitionToState(MenuState.MainMenu)\n        });\n        \n        this.selectedButtonIndex = 0;\n        this.updateButtonPositions();\n        this.updateButtonHighlights();\n    }\n\n    /**\n     * Initialize settings menu\n     */\n    private initializeSettingsMenu(): void {\n        this.buttons = [\n            {\n                id: 'render_scale',\n                text: `RENDER QUALITY: ${Math.round(this.gameSettings.renderScale * 100)}%`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.adjustRenderScale()\n            },\n            {\n                id: 'master_volume',\n                text: `MASTER VOLUME: ${Math.round(this.gameSettings.masterVolume * 100)}%`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.adjustMasterVolume()\n            },\n            {\n                id: 'music_volume',\n                text: `MUSIC VOLUME: ${Math.round(this.gameSettings.musicVolume * 100)}%`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.adjustMusicVolume()\n            },\n            {\n                id: 'sfx_volume',\n                text: `SFX VOLUME: ${Math.round(this.gameSettings.sfxVolume * 100)}%`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.adjustSfxVolume()\n            },\n            {\n                id: 'show_fps',\n                text: `SHOW FPS: ${this.gameSettings.showFPS ? 'ON' : 'OFF'}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.toggleShowFPS()\n            },\n            {\n                id: 'vsync',\n                text: `VSYNC: ${this.gameSettings.vsync ? 'ON' : 'OFF'}`,\n                x: 0, y: 0, width: 400, height: 30,\n                enabled: true,\n                highlighted: false,\n                action: () => this.toggleVSync()\n            },\n            {\n                id: 'apply_settings',\n                text: 'APPLY CHANGES',\n                x: 0, y: 0, width: 300, height: 40,\n                enabled: true,\n                highlighted: false,\n                action: () => this.applySettings()\n            },\n            {\n                id: 'reset_defaults',\n                text: 'RESET TO DEFAULTS',\n                x: 0, y: 0, width: 300, height: 40,\n                enabled: true,\n                highlighted: false,\n                action: () => this.resetToDefaults()\n            },\n            {\n                id: 'back',\n                text: 'BACK',\n                x: 0, y: 0, width: 200, height: 40,\n                enabled: true,\n                highlighted: false,\n                action: () => this.transitionToState(MenuState.MainMenu)\n            }\n        ];\n        \n        this.selectedButtonIndex = 0;\n        this.updateButtonPositions();\n        this.updateButtonHighlights();\n    }\n\n\n\n    /**\n     * Update button positions based on screen size\n     */\n    private updateButtonPositions(): void {\n        const centerX = 512; // Center for 1024px width\n        const startY = 300;\n        const spacing = 60;\n        \n        for (let i = 0; i < this.buttons.length; i++) {\n            const button = this.buttons[i];\n            button.x = centerX - button.width / 2;\n            button.y = startY + i * spacing;\n        }\n    }\n\n    /**\n     * Update button highlight states\n     */\n    private updateButtonHighlights(): void {\n        for (let i = 0; i < this.buttons.length; i++) {\n            this.buttons[i].highlighted = (i === this.selectedButtonIndex);\n        }\n    }\n\n    /**\n     * Handle new game settings input\n     */\n    private handleNewGameInput(input: InputManager): void {\n        // Additional input handling for new game menu\n        if (input.isKeyPressed('KeyR')) {\n            this.generateRandomSeed();\n        }\n    }\n\n    /**\n     * Handle settings input\n     */\n    private handleSettingsInput(input: InputManager): void {\n        const button = this.buttons[this.selectedButtonIndex];\n        if (!button) return;\n        \n        // Use left/right arrows to adjust values\n        if (input.isKeyPressed('ArrowLeft')) {\n            this.adjustSettingDown(button.id);\n        } else if (input.isKeyPressed('ArrowRight')) {\n            this.adjustSettingUp(button.id);\n        }\n    }\n\n    /**\n     * Handle hotkey input\n     */\n    private handleHotkeys(input: InputManager): void {\n        if (this.currentState !== MenuState.MainMenu) return;\n        \n        for (const button of this.buttons) {\n            if (button.hotkey && input.isKeyPressed(button.hotkey) && button.enabled) {\n                this.playUISound('select');\n                button.action();\n                break;\n            }\n        }\n    }\n\n    /**\n     * Transition to new menu state\n     */\n    private transitionToState(newState: MenuState): void {\n        if (this.isTransitioning) return;\n        \n        this.previousState = this.currentState;\n        this.isTransitioning = true;\n        this.transitionProgress = 0;\n        \n        // Start transition effect\n        this.playUISound('transition');\n        this.createTransitionEffect();\n        \n        // Initialize new state after half transition\n        setTimeout(() => {\n            this.currentState = newState;\n            this.initializeMenuForState(newState);\n        }, 150); // Half of transition time\n    }\n\n    /**\n     * Initialize menu for specific state\n     */\n    private initializeMenuForState(state: MenuState): void {\n        switch (state) {\n            case MenuState.MainMenu:\n                this.initializeMainMenu();\n                break;\n            case MenuState.NewGame:\n                this.initializeNewGameMenu();\n                break;\n            case MenuState.LoadGame:\n                this.initializeLoadGameMenu();\n                break;\n            case MenuState.Settings:\n                this.initializeSettingsMenu();\n                break;\n        }\n    }\n\n    /**\n     * Update transition animation\n     */\n    private updateTransition(deltaTime: number): void {\n        this.transitionProgress += deltaTime / 300; // 300ms transition\n        \n        if (this.transitionProgress >= 1.0) {\n            this.transitionProgress = 1.0;\n            this.isTransitioning = false;\n        }\n    }\n\n    /**\n     * Update visual effects\n     */\n    private updateVisualEffects(deltaTime: number): void {\n        // Title glow animation\n        this.titleGlow = (Math.sin(this.animationTime * 0.003) + 1) * 0.5;\n        \n        // Screen flicker effect\n        this.screenFlicker = Math.random() * 0.05;\n        \n        // Background particle movement\n        this.updateBackgroundParticles(deltaTime);\n    }\n\n    /**\n     * Update particle effects\n     */\n    private updateParticleEffects(deltaTime: number): void {\n        if (!this.particles) return;\n        \n        this.particles.update(deltaTime);\n        \n        // Spawn occasional background particles\n        if (Math.random() < 0.01) {\n            const x = Math.random() * 800;\n            const y = Math.random() * 600;\n            this.particles.createExplosion({ x, y }, 0.1);\n        }\n    }\n\n    /**\n     * Start background effects\n     */\n    private startBackgroundEffects(): void {\n        if (!this.particles) return;\n        \n        // Create initial background particles\n        for (let i = 0; i < 20; i++) {\n            const x = Math.random() * 800;\n            const y = Math.random() * 600;\n            const emitterId = this.particles.createThrustTrail(\n                { x, y },\n                Math.random() * Math.PI * 2,\n                0.2\n            );\n            this.backgroundParticles.push(emitterId);\n        }\n        \n        // Start ambient music\n        if (this.audio) {\n            this.audio.startAmbientTrack('void_silence');\n        }\n    }\n\n    /**\n     * Update background particles\n     */\n    private updateBackgroundParticles(deltaTime: number): void {\n        // Background particles drift slowly\n        // Implementation depends on particle system API\n    }\n\n    /**\n     * Create transition effect\n     */\n    private createTransitionEffect(): void {\n        if (!this.particles) return;\n        \n        // Screen wipe effect with particles\n        for (let i = 0; i < 50; i++) {\n            const x = Math.random() * 800;\n            const y = Math.random() * 600;\n            this.particles.createExplosion({ x, y }, 0.3);\n        }\n    }\n\n    /**\n     * Play UI sound effect\n     */\n    private playUISound(type: 'navigation' | 'select' | 'back' | 'transition' | 'error'): void {\n        if (!this.audio) return;\n        \n        switch (type) {\n            case 'navigation':\n                this.audio.playRetroSound(SoundType.Beep, 0.3);\n                break;\n            case 'select':\n                this.audio.playRetroSound(SoundType.UI, 0.5);\n                break;\n            case 'back':\n                this.audio.playRetroSound(SoundType.UI, 0.3);\n                break;\n            case 'transition':\n                this.audio.playRetroSound(SoundType.Communication, 0.4);\n                break;\n            case 'error':\n                this.audio.playRetroSound(SoundType.Warning, 0.6);\n                break;\n        }\n    }\n\n    /**\n     * New game setting actions\n     */\n    private editPlayerName(): void {\n        // Simple name cycling for demo\n        const names = ['COMMANDER', 'CAPTAIN', 'ADMIRAL', 'PILOT', 'EXPLORER'];\n        const currentIndex = names.indexOf(this.newGameSettings.playerName);\n        this.newGameSettings.playerName = names[(currentIndex + 1) % names.length];\n        this.updateNewGameMenuText();\n    }\n\n    private cycleDifficulty(): void {\n        const difficulties: NewGameSettings['difficulty'][] = ['easy', 'normal', 'hard', 'nightmare'];\n        const currentIndex = difficulties.indexOf(this.newGameSettings.difficulty);\n        this.newGameSettings.difficulty = difficulties[(currentIndex + 1) % difficulties.length];\n        this.updateNewGameMenuText();\n    }\n\n    private cycleGalaxySize(): void {\n        const sizes: NewGameSettings['galaxySize'][] = ['small', 'medium', 'large', 'huge'];\n        const currentIndex = sizes.indexOf(this.newGameSettings.galaxySize);\n        this.newGameSettings.galaxySize = sizes[(currentIndex + 1) % sizes.length];\n        this.updateNewGameMenuText();\n    }\n\n    private cycleEnemyFrequency(): void {\n        const frequencies: NewGameSettings['enemyFrequency'][] = ['low', 'normal', 'high', 'extreme'];\n        const currentIndex = frequencies.indexOf(this.newGameSettings.enemyFrequency);\n        this.newGameSettings.enemyFrequency = frequencies[(currentIndex + 1) % frequencies.length];\n        this.updateNewGameMenuText();\n    }\n\n    private togglePermadeath(): void {\n        this.newGameSettings.enablePermadeath = !this.newGameSettings.enablePermadeath;\n        this.updateNewGameMenuText();\n    }\n\n    private toggleTutorial(): void {\n        this.newGameSettings.enableTutorial = !this.newGameSettings.enableTutorial;\n        this.updateNewGameMenuText();\n    }\n\n    private generateRandomSeed(): void {\n        this.newGameSettings.galaxySeed = Math.random().toString(36).substring(2, 8).toUpperCase();\n        this.updateNewGameMenuText();\n    }\n\n    private startNewGame(): void {\n        this.playUISound('select');\n        this.events.onNewGame?.(this.newGameSettings);\n        this.transitionToState(MenuState.GameStart);\n    }\n\n    private translateDifficulty(difficulty: string): string {\n        switch (difficulty) {\n            case 'easy': return 'LEHKÁ';\n            case 'normal': return 'NORMÁLNÍ';\n            case 'hard': return 'TĚŽKÁ';\n            case 'nightmare': return 'EXTRÉMNÍ';\n            default: return difficulty.toUpperCase();\n        }\n    }\n\n    private translateGalaxySize(size: string): string {\n        switch (size) {\n            case 'small': return 'MALÁ';\n            case 'medium': return 'STŘEDNÍ';\n            case 'large': return 'VELKÁ';\n            case 'huge': return 'OBROVSKÁ';\n            default: return size.toUpperCase();\n        }\n    }\n\n    private translateEnemyFrequency(frequency: string): string {\n        switch (frequency) {\n            case 'low': return 'MÁLO';\n            case 'normal': return 'NORMÁLNĚ';\n            case 'high': return 'HODNĚ';\n            case 'extreme': return 'EXTRÉMNĚ';\n            default: return frequency.toUpperCase();\n        }\n    }\n\n    /**\n     * Settings adjustment actions\n     */\n    private adjustSettingDown(settingId: string): void {\n        switch (settingId) {\n            case 'render_scale':\n                this.gameSettings.renderScale = Math.max(0.5, this.gameSettings.renderScale - 0.1);\n                break;\n            case 'master_volume':\n                this.gameSettings.masterVolume = Math.max(0, this.gameSettings.masterVolume - 0.1);\n                break;\n            case 'music_volume':\n                this.gameSettings.musicVolume = Math.max(0, this.gameSettings.musicVolume - 0.1);\n                break;\n            case 'sfx_volume':\n                this.gameSettings.sfxVolume = Math.max(0, this.gameSettings.sfxVolume - 0.1);\n                break;\n        }\n        this.updateSettingsMenuText();\n    }\n\n    private adjustSettingUp(settingId: string): void {\n        switch (settingId) {\n            case 'render_scale':\n                this.gameSettings.renderScale = Math.min(2.0, this.gameSettings.renderScale + 0.1);\n                break;\n            case 'master_volume':\n                this.gameSettings.masterVolume = Math.min(1.0, this.gameSettings.masterVolume + 0.1);\n                break;\n            case 'music_volume':\n                this.gameSettings.musicVolume = Math.min(1.0, this.gameSettings.musicVolume + 0.1);\n                break;\n            case 'sfx_volume':\n                this.gameSettings.sfxVolume = Math.min(1.0, this.gameSettings.sfxVolume + 0.1);\n                break;\n        }\n        this.updateSettingsMenuText();\n    }\n\n    private adjustRenderScale(): void {\n        this.gameSettings.renderScale = this.gameSettings.renderScale >= 2.0 ? 0.5 : this.gameSettings.renderScale + 0.25;\n        this.updateSettingsMenuText();\n    }\n\n    private adjustMasterVolume(): void {\n        this.gameSettings.masterVolume = (this.gameSettings.masterVolume + 0.2) % 1.2;\n        if (this.gameSettings.masterVolume > 1.0) this.gameSettings.masterVolume = 0;\n        this.updateSettingsMenuText();\n    }\n\n    private adjustMusicVolume(): void {\n        this.gameSettings.musicVolume = (this.gameSettings.musicVolume + 0.2) % 1.2;\n        if (this.gameSettings.musicVolume > 1.0) this.gameSettings.musicVolume = 0;\n        this.updateSettingsMenuText();\n    }\n\n    private adjustSfxVolume(): void {\n        this.gameSettings.sfxVolume = (this.gameSettings.sfxVolume + 0.2) % 1.2;\n        if (this.gameSettings.sfxVolume > 1.0) this.gameSettings.sfxVolume = 0;\n        this.updateSettingsMenuText();\n    }\n\n    private toggleShowFPS(): void {\n        this.gameSettings.showFPS = !this.gameSettings.showFPS;\n        this.updateSettingsMenuText();\n    }\n\n    private toggleVSync(): void {\n        this.gameSettings.vsync = !this.gameSettings.vsync;\n        this.updateSettingsMenuText();\n    }\n\n    private applySettings(): void {\n        this.playUISound('select');\n        this.events.onSettings?.(this.gameSettings);\n        this.saveSettings();\n    }\n\n    private resetToDefaults(): void {\n        this.gameSettings = this.getDefaultGameSettings();\n        this.updateSettingsMenuText();\n        this.playUISound('select');\n    }\n\n    /**\n     * Load game action\n     */\n    private loadGame(slot: number): void {\n        this.playUISound('select');\n        this.events.onLoadGame?.(slot);\n        this.transitionToState(MenuState.GameStart);\n    }\n\n    /**\n     * Update menu text after changes\n     */\n    private updateNewGameMenuText(): void {\n        if (this.currentState !== MenuState.NewGame) return;\n        \n        const buttonUpdates = [\n            { id: 'player_name', text: `CAPTAIN NAME: ${this.newGameSettings.playerName}` },\n            { id: 'difficulty', text: `DIFFICULTY: ${this.newGameSettings.difficulty.toUpperCase()}` },\n            { id: 'galaxy_size', text: `GALAXY SIZE: ${this.newGameSettings.galaxySize.toUpperCase()}` },\n            { id: 'enemy_frequency', text: `HOSTILES: ${this.newGameSettings.enemyFrequency.toUpperCase()}` },\n            { id: 'permadeath', text: `PERMADEATH: ${this.newGameSettings.enablePermadeath ? 'ON' : 'OFF'}` },\n            { id: 'tutorial', text: `TUTORIAL: ${this.newGameSettings.enableTutorial ? 'ON' : 'OFF'}` }\n        ];\n        \n        buttonUpdates.forEach(update => {\n            const button = this.buttons.find(b => b.id === update.id);\n            if (button) button.text = update.text;\n        });\n    }\n\n    private updateSettingsMenuText(): void {\n        if (this.currentState !== MenuState.Settings) return;\n        \n        const buttonUpdates = [\n            { id: 'render_scale', text: `RENDER QUALITY: ${Math.round(this.gameSettings.renderScale * 100)}%` },\n            { id: 'master_volume', text: `MASTER VOLUME: ${Math.round(this.gameSettings.masterVolume * 100)}%` },\n            { id: 'music_volume', text: `MUSIC VOLUME: ${Math.round(this.gameSettings.musicVolume * 100)}%` },\n            { id: 'sfx_volume', text: `SFX VOLUME: ${Math.round(this.gameSettings.sfxVolume * 100)}%` },\n            { id: 'show_fps', text: `SHOW FPS: ${this.gameSettings.showFPS ? 'ON' : 'OFF'}` },\n            { id: 'vsync', text: `VSYNC: ${this.gameSettings.vsync ? 'ON' : 'OFF'}` }\n        ];\n        \n        buttonUpdates.forEach(update => {\n            const button = this.buttons.find(b => b.id === update.id);\n            if (button) button.text = update.text;\n        });\n    }\n\n    /**\n     * Utility methods\n     */\n    private getDefaultNewGameSettings(): NewGameSettings {\n        return {\n            playerName: 'COMMANDER',\n            difficulty: 'normal',\n            galaxySeed: Math.random().toString(36).substring(2, 8).toUpperCase(),\n            galaxySize: 'medium',\n            startingResources: 'standard',\n            enemyFrequency: 'normal',\n            enablePermadeath: false,\n            enableTutorial: true\n        };\n    }\n\n    private getDefaultGameSettings(): GameSettings {\n        return {\n            renderScale: 1.0,\n            vsync: true,\n            fullscreen: false,\n            masterVolume: 0.7,\n            musicVolume: 0.5,\n            sfxVolume: 0.8,\n            difficulty: 'normal' as const,\n            mouseSensitivity: 1.0,\n            showFPS: false,\n            autoSave: true,\n            autoSaveInterval: 300, // 5 minutes\n            colorblindMode: 'none',\n            subtitles: false,\n            reducedMotion: false,\n            keyBindings: {\n                forward: 'KeyW',\n                backward: 'KeyS',\n                left: 'KeyA',\n                right: 'KeyD',\n                fire: 'Space',\n                warp: 'KeyW'\n            }\n        };\n    }\n\n    private hasSaveGames(): boolean {\n        return this.saveSlots.some(slot => slot.exists);\n    }\n\n    private loadSaveSlots(): void {\n        // Mock save data for demo\n        this.saveSlots = [\n            {\n                slot: 1,\n                name: 'Captain Nova',\n                date: '2024-01-15',\n                playtime: '12h 34m',\n                level: 15,\n                system: 'Alpha Centauri',\n                exists: true\n            },\n            {\n                slot: 2,\n                name: 'Commander Rex',\n                date: '2024-01-10',\n                playtime: '8h 22m',\n                level: 8,\n                system: 'Sol System',\n                exists: true\n            },\n            {\n                slot: 3,\n                name: '',\n                date: '',\n                playtime: '',\n                level: 0,\n                system: '',\n                exists: false\n            }\n        ];\n    }\n\n    private saveSettings(): void {\n        try {\n            localStorage.setItem('gameSettings', JSON.stringify(this.gameSettings));\n            this.logger.info('⚙️ Settings saved');\n        } catch (error) {\n            this.logger.error('Failed to save settings', error);\n        }\n    }\n\n    private loadSettings(): void {\n        try {\n            const saved = localStorage.getItem('gameSettings');\n            if (saved) {\n                this.gameSettings = { ...this.getDefaultGameSettings(), ...JSON.parse(saved) };\n                this.logger.info('⚙️ Settings loaded');\n            }\n        } catch (error) {\n            this.logger.warn('Failed to load settings, using defaults', error);\n        }\n    }\n\n    /**\n     * Render menu system\n     */\n    render(renderer: Renderer): void {\n        // Clear screen with dark background (using correct canvas dimensions)\n        renderer.fillRect(0, 0, 1024, 768, { r: 8, g: 8, b: 8 });\n        \n        // Apply screen flicker effect\n        if (this.screenFlicker > 0.03) {\n            const flickerAlpha = this.screenFlicker * 0.3;\n            renderer.fillRect(0, 0, 1024, 768, { r: 16, g: 16, b: 16 });\n        }\n        \n        // Render current state\n        switch (this.currentState) {\n            case MenuState.MainMenu:\n                this.renderMainMenu(renderer);\n                break;\n            case MenuState.NewGame:\n                this.renderNewGameMenu(renderer);\n                break;\n            case MenuState.LoadGame:\n                this.renderLoadGameMenu(renderer);\n                break;\n            case MenuState.Settings:\n                this.renderSettingsMenu(renderer);\n                break;\n            case MenuState.GameStart:\n                this.renderGameStart(renderer);\n                break;\n        }\n        \n        // Render transition effect\n        if (this.isTransitioning) {\n            this.renderTransition(renderer);\n        }\n        \n        // Render particles\n        if (this.particles) {\n            this.particles.render(renderer);\n        }\n    }\n\n    /**\n     * Render main menu\n     */\n    private renderMainMenu(renderer: Renderer): void {\n        // Render title with glow effect\n        const titleColor = {\n            r: 72 + Math.floor(this.titleGlow * 24),\n            g: 48 + Math.floor(this.titleGlow * 16),\n            b: 12 + Math.floor(this.titleGlow * 8)\n        };\n        \n        this.renderText(renderer, 'VESMÍRNÝ PRŮZKUMNÍK', 720, 120, 'large', titleColor, 'center');\n        this.renderText(renderer, 'DOBRODRUŽSTVÍ V HLUBOKÉM VESMÍRU', 720, 160, 'medium', { r: 48, g: 48, b: 48 }, 'center');\n        \n        // Render version\n        this.renderText(renderer, 'v1.0.0 ALPHA', 1390, 870, 'small', { r: 32, g: 32, b: 32 }, 'right');\n        \n        // Render buttons\n        this.renderButtons(renderer);\n        \n        // Render hotkey hints\n        if (this.currentState === MenuState.MainMenu) {\n            const hints = [\n                'N - Nová hra    L - Načíst hru    S - Nastavení    Q - Ukončit',\n                'Použijte ŠIPKY nebo WASD pro navigaci, ENTER pro výběr, ESC pro návrat'\n            ];\n            \n            hints.forEach((hint, index) => {\n                this.renderText(renderer, hint, 720, 750 + index * 25, 'small', { r: 24, g: 24, b: 24 }, 'center');\n            });\n        }\n    }\n\n    /**\n     * Render new game menu\n     */\n    private renderNewGameMenu(renderer: Renderer): void {\n        this.renderText(renderer, 'TVORBA PILOTA', 720, 100, 'large', { r: 72, g: 48, b: 12 }, 'center');\n        \n        // Render buttons\n        this.renderButtons(renderer);\n        \n        // Render galaxy seed info\n        this.renderText(renderer, `SEED GALAXIE: ${this.newGameSettings.galaxySeed}`, 720, 680, 'medium', { r: 48, g: 48, b: 48 }, 'center');\n        this.renderText(renderer, 'Stiskněte R pro generování náhodného seedu', 720, 710, 'small', { r: 32, g: 32, b: 32 }, 'center');\n    }\n\n    /**\n     * Render load game menu\n     */\n    private renderLoadGameMenu(renderer: Renderer): void {\n        this.renderText(renderer, 'LOAD MISSION', 400, 80, 'large', { r: 72, g: 48, b: 12 }, 'center');\n        \n        // Render save slot details\n        for (let i = 0; i < this.saveSlots.length; i++) {\n            const slot = this.saveSlots[i];\n            const y = 150 + i * 70;\n            \n            if (slot.exists) {\n                // Render detailed save info\n                this.renderText(renderer, `SLOT ${slot.slot}: ${slot.name}`, 50, y, 'medium', { r: 48, g: 48, b: 48 }, 'left');\n                this.renderText(renderer, `Location: ${slot.system}`, 50, y + 20, 'small', { r: 32, g: 32, b: 32 }, 'left');\n                this.renderText(renderer, `Playtime: ${slot.playtime}`, 400, y + 20, 'small', { r: 32, g: 32, b: 32 }, 'left');\n                this.renderText(renderer, `Date: ${slot.date}`, 600, y + 20, 'small', { r: 32, g: 32, b: 32 }, 'left');\n            } else {\n                this.renderText(renderer, `SLOT ${slot.slot}: EMPTY`, 50, y, 'medium', { r: 24, g: 24, b: 24 }, 'left');\n            }\n        }\n        \n        // Render back button\n        this.renderButtons(renderer);\n    }\n\n    /**\n     * Render settings menu\n     */\n    private renderSettingsMenu(renderer: Renderer): void {\n        this.renderText(renderer, 'SYSTEM CONFIGURATION', 400, 80, 'large', { r: 72, g: 48, b: 12 }, 'center');\n        \n        // Render buttons\n        this.renderButtons(renderer);\n        \n        // Render instructions\n        this.renderText(renderer, 'Use LEFT/RIGHT arrows to adjust values', 400, 500, 'small', { r: 32, g: 32, b: 32 }, 'center');\n    }\n\n\n\n    /**\n     * Render game start loading\n     */\n    private renderGameStart(renderer: Renderer): void {\n        this.renderText(renderer, 'INITIALIZING STELLAR DRIVE...', 400, 250, 'large', { r: 72, g: 48, b: 12 }, 'center');\n        \n        // Animated loading bar\n        const progress = (this.animationTime % 3000) / 3000;\n        const barWidth = 400;\n        const barHeight = 20;\n        const barX = 400 - barWidth / 2;\n        const barY = 300;\n        \n        // Background\n        renderer.drawRect(barX, barY, barWidth, barHeight, { r: 32, g: 32, b: 32 });\n        \n        // Progress\n        const progressWidth = barWidth * progress;\n        renderer.fillRect(barX, barY, progressWidth, barHeight, { r: 72, g: 48, b: 12 });\n        \n        // Loading text\n        const loadingTexts = [\n            'Generating galaxy...',\n            'Calculating stellar positions...',\n            'Initializing quantum drive...',\n            'Loading mission parameters...',\n            'Calibrating sensors...',\n            'Establishing communications...',\n            'Mission ready!'\n        ];\n        \n        const textIndex = Math.floor(progress * loadingTexts.length);\n        const currentText = loadingTexts[Math.min(textIndex, loadingTexts.length - 1)];\n        \n        this.renderText(renderer, currentText, 400, 350, 'medium', { r: 48, g: 48, b: 48 }, 'center');\n        \n        // Auto-start game after loading\n        if (progress >= 0.95) {\n            setTimeout(() => this.events.onGameStart?.(), 500);\n        }\n    }\n\n    /**\n     * Render transition effect\n     */\n    private renderTransition(renderer: Renderer): void {\n        const alpha = this.transitionProgress < 0.5 ? \n            this.transitionProgress * 2 : \n            (1 - this.transitionProgress) * 2;\n        \n        // Screen wipe effect\n        const wipeHeight = 768 * alpha;\n        renderer.fillRect(0, 0, 1024, wipeHeight, { r: 16, g: 16, b: 16 });\n        renderer.fillRect(0, 768 - wipeHeight, 1024, wipeHeight, { r: 16, g: 16, b: 16 });\n    }\n\n    /**\n     * Render buttons\n     */\n    private renderButtons(renderer: Renderer): void {\n        for (const button of this.buttons) {\n            this.renderButton(renderer, button);\n        }\n    }\n\n    /**\n     * Render individual button\n     */\n    private renderButton(renderer: Renderer, button: MenuButton): void {\n        const color = button.highlighted ? \n            { r: 72, g: 48, b: 12 } : \n            button.enabled ? \n                { r: 48, g: 48, b: 48 } : \n                { r: 24, g: 24, b: 24 };\n        \n        // Button background (if highlighted)\n        if (button.highlighted) {\n            renderer.fillRect(button.x - 5, button.y - 5, button.width + 10, button.height + 10, { r: 16, g: 16, b: 16 });\n            renderer.drawRect(button.x - 5, button.y - 5, button.width + 10, button.height + 10, color);\n        }\n        \n        // Button text\n        this.renderText(renderer, button.text, button.x + button.width / 2, button.y + button.height / 2, 'medium', color, 'center');\n        \n        // Hotkey hint\n        if (button.hotkey && button.enabled) {\n            const hotkeyText = `[${button.hotkey.replace('Key', '')}]`;\n            this.renderText(renderer, hotkeyText, button.x + button.width + 10, button.y + button.height / 2, 'small', { r: 32, g: 32, b: 32 }, 'left');\n        }\n    }\n\n    /**\n     * Render text with retro styling\n     */\n    private renderText(\n        renderer: Renderer, \n        text: string, \n        x: number, \n        y: number, \n        size: 'small' | 'medium' | 'large', \n        color: Color, \n        align: 'left' | 'center' | 'right'\n    ): void {\n        const fontSize = size === 'small' ? 12 : size === 'medium' ? 16 : 24;\n        \n        // Use renderer's text method if available, otherwise fallback\n        if (renderer.renderText) {\n            let textX = x;\n            if (align === 'center') {\n                textX = x - (text.length * fontSize * 0.3);\n            } else if (align === 'right') {\n                textX = x - (text.length * fontSize * 0.6);\n            }\n            \n            renderer.renderText(text, textX, y, color, fontSize);\n        } else {\n            // Fallback: Draw text as rectangles (simplified implementation)\n            let textX = x;\n            if (align === 'center') {\n                textX = x - (text.length * fontSize * 0.3);\n            } else if (align === 'right') {\n                textX = x - (text.length * fontSize * 0.6);\n            }\n            \n            for (let i = 0; i < text.length; i++) {\n                const charX = textX + i * fontSize * 0.6;\n                \n                if (text[i] !== ' ') {\n                    renderer.fillRect(charX, y - fontSize / 2, fontSize * 0.5, fontSize, color);\n                }\n            }\n        }\n    }\n\n    /**\n     * Get current menu state\n     */\n    getCurrentState(): MenuState {\n        return this.currentState;\n    }\n\n    /**\n     * Get current settings\n     */\n    getGameSettings(): GameSettings {\n        return { ...this.gameSettings };\n    }\n\n    /**\n     * Set new game settings externally\n     */\n    setNewGameSettings(settings: Partial<NewGameSettings>): void {\n        Object.assign(this.newGameSettings, settings);\n        if (this.currentState === MenuState.NewGame) {\n            this.updateNewGameMenuText();\n        }\n    }\n\n    /**\n     * Dispose menu system\n     */\n    dispose(): void {\n        // Clean up background particles\n        if (this.particles) {\n            this.backgroundParticles.forEach(id => {\n                this.particles!.removeEmitter(id);\n            });\n        }\n        \n        this.logger.info('🎮 Main menu system disposed');\n    }\n}","/**\n * Game State Manager\n * Handles different game states and manages transitions with save/load functionality\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer } from '@core/Renderer';\nimport { PhysicsObject } from '@core/Physics';\nimport { Vector2 } from '@core/Renderer';\nimport { MainMenu, MenuEvents, NewGameSettings, GameSettings } from '@ui/MainMenu';\nimport { InputManager } from '@core/InputManager';\nimport { ProceduralAudio } from '@audio/ProceduralAudio';\nimport { ParticleSystem } from '@effects/ParticleSystem';\n\nexport enum GameState {\n    MainMenu = 'main_menu',\n    Loading = 'loading',\n    Playing = 'playing',\n    Paused = 'paused',\n    Inventory = 'inventory',\n    Research = 'research',\n    Navigation = 'navigation',\n    Diplomacy = 'diplomacy',\n    Settings = 'settings',\n    Credits = 'credits',\n    NewGame = 'new_game',\n    LoadGame = 'load_game',\n    Error = 'error'\n}\n\nexport interface GameData {\n    // Player data\n    playerShip: {\n        id: string;\n        position: Vector2;\n        velocity: Vector2;\n        health: number;\n        fuel: number;\n        resources: Map<string, number>;\n    };\n    \n    // Current location\n    currentSystem: {\n        id: string;\n        name: string;\n        type: 'star_system' | 'interstellar_space';\n    };\n    \n    // Game progress\n    gameTime: number;\n    level: number;\n    experience: number;\n    discoveries: string[];\n    technologies: string[];\n    \n    // Settings\n    settings: {\n        masterVolume: number;\n        musicVolume: number;\n        sfxVolume: number;\n        difficulty: 'easy' | 'normal' | 'hard';\n    };\n    \n    // Statistics\n    stats: {\n        timePlayedSeconds: number;\n        systemsVisited: number;\n        aliensEncountered: number;\n        battlesWon: number;\n        resourcesCollected: number;\n    };\n}\n\nexport interface StateTransition {\n    from: GameState;\n    to: GameState;\n    condition?: () => boolean;\n    action?: () => void;\n}\n\nexport class GameStateManager {\n    private currentState: GameState = GameState.MainMenu;\n    private previousState: GameState = GameState.MainMenu;\n    private gameData: GameData;\n    \n    // State management\n    private stateStack: GameState[] = [];\n    private transitions: Map<string, StateTransition> = new Map();\n    private stateStartTime: number = Date.now();\n    \n    // Menu system\n    private mainMenu: MainMenu | null = null;\n    \n    // Demo entities for FÁZE 1\n    private demoShip: PhysicsObject | null = null;\n    private demoPlanets: PhysicsObject[] = [];\n    \n    private logger: Logger;\n    private isInitialized = false;\n    private saveInterval = 30000; // Auto-save every 30 seconds\n\n    constructor(audio?: ProceduralAudio, particles?: ParticleSystem) {\n        this.logger = new Logger('GameStateManager');\n        \n        // Initialize default game data\n        this.gameData = this.createDefaultGameData();\n        \n        // Initialize menu system\n        this.initializeMenuSystem(audio, particles);\n        \n        // Setup state transitions\n        this.setupStateTransitions();\n        \n        this.logger.info('🎯 Game state manager created');\n    }\n\n    /**\n     * Initialize menu system\n     */\n    private initializeMenuSystem(audio?: ProceduralAudio, particles?: ParticleSystem): void {\n        const menuEvents: MenuEvents = {\n            onNewGame: async (settings: NewGameSettings) => {\n                await this.handleNewGame(settings);\n            },\n            onLoadGame: async (saveSlot: number) => {\n                await this.handleLoadGame(saveSlot);\n            },\n            onSettings: (settings: GameSettings) => {\n                this.handleSettingsChange(settings);\n            },\n            onExit: () => {\n                this.handleExit();\n            },\n            onGameStart: async () => {\n                await this.setState(GameState.Playing);\n            }\n        };\n        \n        this.mainMenu = new MainMenu(menuEvents, audio, particles);\n        this.logger.info('🎮 Menu system initialized');\n    }\n\n    /**\n     * Initialize the game state manager\n     */\n    async initialize(): Promise<void> {\n        this.logger.info('🔧 Initializing game state manager...');\n        \n        try {\n            // Try to load existing save data, fallback to defaults if none exists\n            try {\n                await this.loadGameData();\n                this.logger.info('Existing save data loaded');\n            } catch (error) {\n                this.logger.info('No existing save data found, creating new game data');\n                this.gameData = this.createDefaultGameData();\n            }\n            \n            // Setup demo content for FÁZE 1\n            this.setupDemoContent();\n            \n            this.isInitialized = true;\n            this.logger.info('✅ Game state manager initialized');\n            \n        } catch (error) {\n            this.logger.error('❌ Game state manager initialization failed', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Create default game data\n     */\n    private createDefaultGameData(): GameData {\n        return {\n            playerShip: {\n                id: 'player_ship',\n                position: { x: 720, y: 450 }, // Center of 1440x900 screen\n                velocity: { x: 0, y: 0 },\n                health: 100,\n                fuel: 1000,\n                resources: new Map([\n                    ['credits', 1000],\n                    ['fuel', 1000],\n                    ['metal', 50],\n                    ['crystals', 10]\n                ])\n            },\n            currentSystem: {\n                id: 'sol_system',\n                name: 'Sol System',\n                type: 'star_system'\n            },\n            gameTime: 0,\n            level: 1,\n            experience: 0,\n            discoveries: [],\n            technologies: ['basic_engines', 'basic_weapons'],\n            settings: {\n                masterVolume: 1.0,\n                musicVolume: 0.7,\n                sfxVolume: 0.8,\n                difficulty: 'normal'\n            },\n            stats: {\n                timePlayedSeconds: 0,\n                systemsVisited: 1,\n                aliensEncountered: 0,\n                battlesWon: 0,\n                resourcesCollected: 0\n            }\n        };\n    }\n\n    /**\n     * Setup state transitions\n     */\n    private setupStateTransitions(): void {\n        // Loading → MainMenu\n        this.addTransition(GameState.Loading, GameState.MainMenu);\n        \n        // MainMenu self-transition (for menu refresh/reset)\n        this.addTransition(GameState.MainMenu, GameState.MainMenu);\n        \n        // MainMenu ↔ Playing\n        this.addTransition(GameState.MainMenu, GameState.Playing);\n        this.addTransition(GameState.Playing, GameState.MainMenu);\n        \n        // MainMenu → Settings/Credits/NewGame/LoadGame\n        this.addTransition(GameState.MainMenu, GameState.Settings);\n        this.addTransition(GameState.MainMenu, GameState.Credits);\n        this.addTransition(GameState.MainMenu, GameState.NewGame);\n        this.addTransition(GameState.MainMenu, GameState.LoadGame);\n        \n        // Settings/Credits/NewGame/LoadGame → MainMenu\n        this.addTransition(GameState.Settings, GameState.MainMenu);\n        this.addTransition(GameState.Credits, GameState.MainMenu);\n        this.addTransition(GameState.NewGame, GameState.MainMenu);\n        this.addTransition(GameState.LoadGame, GameState.MainMenu);\n        \n        // Playing ↔ Paused\n        this.addTransition(GameState.Playing, GameState.Paused);\n        this.addTransition(GameState.Paused, GameState.Playing);\n        \n        // Playing → Sub-states\n        this.addTransition(GameState.Playing, GameState.Inventory);\n        this.addTransition(GameState.Playing, GameState.Research);\n        this.addTransition(GameState.Playing, GameState.Navigation);\n        this.addTransition(GameState.Playing, GameState.Diplomacy);\n        this.addTransition(GameState.Playing, GameState.Settings);\n        \n        // Sub-states → Playing\n        this.addTransition(GameState.Inventory, GameState.Playing);\n        this.addTransition(GameState.Research, GameState.Playing);\n        this.addTransition(GameState.Navigation, GameState.Playing);\n        this.addTransition(GameState.Diplomacy, GameState.Playing);\n        \n        // Error state - can be reached from ANY state\n        Object.values(GameState).forEach(state => {\n            if (state !== GameState.Error) {\n                this.addTransition(state, GameState.Error);\n            }\n        });\n        \n        // Error state can go to MainMenu\n        this.addTransition(GameState.Error, GameState.MainMenu);\n        \n        this.logger.debug('State transitions configured');\n    }\n\n    /**\n     * Add a state transition\n     */\n    private addTransition(from: GameState, to: GameState, condition?: () => boolean, action?: () => void): void {\n        const key = `${from}->${to}`;\n        this.transitions.set(key, { from, to, condition, action });\n    }\n\n    /**\n     * Setup demo content for FÁZE 1\n     */\n    private setupDemoContent(): void {\n        // Demo content will be created when needed\n        // This is just initialization\n        this.logger.debug('Demo content setup prepared');\n    }\n\n    /**\n     * Set the current game state\n     */\n    async setState(newState: GameState): Promise<void> {\n        // Handle same-state transition gracefully\n        if (this.currentState === newState) {\n            this.logger.debug(`Refreshing current state: ${newState}`);\n            if (newState !== GameState.Error) { // Don't refresh error state\n                await this.onStateEnter(newState);\n            }\n            return;\n        }\n        \n        // Allow error state from any state (emergency transition)\n        if (newState === GameState.Error) {\n            this.logger.warn(`Emergency transition to error state from: ${this.currentState}`);\n            this.previousState = this.currentState;\n            this.currentState = newState;\n            await this.onStateEnter(newState);\n            return;\n        }\n        \n        const transitionKey = `${this.currentState}->${newState}`;\n        const transition = this.transitions.get(transitionKey);\n        \n        if (!transition) {\n            this.logger.warn(`Invalid state transition: ${this.currentState} → ${newState}`);\n            return;\n        }\n        \n        // Check transition condition\n        if (transition.condition && !transition.condition()) {\n            this.logger.debug(`Transition condition not met: ${transitionKey}`);\n            return;\n        }\n        \n        this.logger.info(`State transition: ${this.currentState} → ${newState}`);\n        \n        // Save previous state\n        this.previousState = this.currentState;\n        \n        // Execute transition action\n        if (transition.action) {\n            try {\n                transition.action();\n            } catch (error) {\n                this.logger.error('Error executing transition action', error);\n                // Continue with state change despite action error\n            }\n        }\n        \n        // Update state\n        this.currentState = newState;\n        \n        // Handle state-specific initialization\n        try {\n            await this.onStateEnter(newState);\n        } catch (error) {\n            this.logger.error('Error entering new state', error);\n            // Don't go to error state if we're already handling an error\n            if (newState !== GameState.Error) {\n                await this.setState(GameState.Error);\n            }\n        }\n    }\n\n    /**\n     * Push state onto stack (for modal states)\n     */\n    pushState(newState: GameState): void {\n        this.stateStack.push(this.currentState);\n        this.currentState = newState;\n        this.logger.debug(`Pushed state: ${newState} (stack depth: ${this.stateStack.length})`);\n    }\n\n    /**\n     * Pop state from stack\n     */\n    popState(): GameState | null {\n        if (this.stateStack.length === 0) {\n            this.logger.warn('Cannot pop state: stack is empty');\n            return null;\n        }\n        \n        const poppedState = this.currentState;\n        this.currentState = this.stateStack.pop()!;\n        this.logger.debug(`Popped state: ${poppedState} → ${this.currentState}`);\n        \n        return poppedState;\n    }\n\n    /**\n     * Handle state enter events\n     */\n    private async onStateEnter(state: GameState): Promise<void> {\n        switch (state) {\n            case GameState.Playing:\n                // Start game time tracking\n                this.startGameTimeTracking();\n                break;\n                \n            case GameState.Paused:\n                // Pause game time tracking\n                this.pauseGameTimeTracking();\n                break;\n                \n            case GameState.MainMenu:\n                // Auto-save when returning to menu\n                await this.save();\n                break;\n                \n            case GameState.Error:\n                // Log error state entry\n                this.logger.error('Entered error state');\n                break;\n        }\n    }\n\n    /**\n     * Update the game state manager\n     */\n    update(deltaTime: number, input?: InputManager): void {\n        if (!this.isInitialized) return;\n        \n        // Update game time\n        if (this.currentState === GameState.Playing) {\n            this.gameData.gameTime += deltaTime;\n            this.gameData.stats.timePlayedSeconds += deltaTime;\n        }\n        \n        // State-specific updates\n        switch (this.currentState) {\n            case GameState.MainMenu:\n            case GameState.NewGame:\n            case GameState.LoadGame:\n            case GameState.Settings:\n            case GameState.Credits:\n                if (this.mainMenu && input) {\n                    this.mainMenu.update(deltaTime, input);\n                }\n                break;\n                \n            case GameState.Playing:\n                this.updatePlayingState(deltaTime);\n                break;\n                \n            case GameState.Loading:\n                this.updateLoadingState(deltaTime);\n                break;\n        }\n    }\n\n    /**\n     * Update playing state\n     */\n    private updatePlayingState(deltaTime: number): void {\n        // Update player ship position in game data\n        if (this.demoShip) {\n            this.gameData.playerShip.position = { ...this.demoShip.position };\n            this.gameData.playerShip.velocity = { ...this.demoShip.velocity };\n            \n            // Update ship health if damaged\n            if (this.demoShip.health !== undefined) {\n                this.gameData.playerShip.health = this.demoShip.health;\n            }\n        }\n    }\n\n    /**\n     * Update loading state\n     */\n    private updateLoadingState(deltaTime: number): void {\n        // Simulate loading time\n        const loadingTime = Date.now() - this.stateStartTime;\n        \n        if (loadingTime > 2000) { // 2 seconds loading time\n            this.setState(GameState.Playing).catch(error => {\n                this.logger.error('Failed to transition to playing state', error);\n            });\n        }\n    }\n\n    /**\n     * Render the current game state\n     */\n    render(renderer: Renderer): void {\n        if (!this.isInitialized) {\n            this.renderLoadingState(renderer);\n            return;\n        }\n        \n        switch (this.currentState) {\n            case GameState.MainMenu:\n            case GameState.NewGame:\n            case GameState.LoadGame:\n            case GameState.Settings:\n            case GameState.Credits:\n                if (this.mainMenu) {\n                    this.mainMenu.render(renderer);\n                }\n                break;\n                \n            case GameState.Loading:\n                this.renderLoadingState(renderer);\n                break;\n                \n            case GameState.Playing:\n                this.renderPlayingState(renderer);\n                break;\n                \n            case GameState.Paused:\n                this.renderPausedState(renderer);\n                break;\n                \n            case GameState.Error:\n                this.renderErrorState(renderer);\n                break;\n                \n            default:\n                this.renderDefaultState(renderer);\n        }\n    }\n\n    /**\n     * Render loading state\n     */\n    private renderLoadingState(renderer: Renderer): void {\n        const centerX = 720;\n        const centerY = 450;\n        \n        renderer.renderText('INITIALIZING SPACE EXPLORER...', centerX - 150, centerY - 50, \n            { r: 192, g: 192, b: 192 }, 16);\n        \n        // Animated loading dots\n        const dots = '.'.repeat((Math.floor(Date.now() / 500) % 4));\n        renderer.renderText(`LOADING${dots}`, centerX - 50, centerY, \n            { r: 128, g: 128, b: 128 }, 14);\n    }\n\n    /**\n     * Render menu state\n     */\n    private renderMenuState(renderer: Renderer): void {\n        const centerX = 720;\n        const centerY = 450;\n        \n        // Render background image (Image 3)\n        this.renderMenuBackground(renderer);\n        \n        // Title\n        renderer.renderText('SPACE EXPLORER 16-BIT', centerX - 140, centerY - 100, \n            { r: 255, g: 255, b: 255 }, 20);\n        \n        // Menu options\n        const menuItems = [\n            'CONTINUE EXPLORATION',\n            'NEW EXPEDITION',\n            'SETTINGS',\n            'EXIT'\n        ];\n        \n        menuItems.forEach((item, index) => {\n            const y = centerY - 20 + index * 30;\n            const color = index === 0 ? { r: 255, g: 255, b: 255 } : { r: 192, g: 192, b: 192 };\n            renderer.renderText(item, centerX - 80, y, color, 14);\n        });\n        \n        // Instructions\n        renderer.renderText('USE ARROW KEYS TO NAVIGATE, ENTER TO SELECT', \n            centerX - 180, centerY + 150, { r: 128, g: 128, b: 128 }, 12);\n    }\n\n    /**\n     * Render playing state\n     */\n    private renderPlayingState(renderer: Renderer): void {\n        // Render enhanced space background\n        this.renderEnhancedSpaceBackground(renderer);\n        \n        // Render demo planets with detailed 16-bit textures\n        this.demoPlanets.forEach((planet, index) => {\n            const planetColors = [\n                { r: 205, g: 85, b: 45 }, // Mars-like (rusty red)\n                { r: 45, g: 120, b: 200 }, // Earth-like (ocean blue)\n                { r: 180, g: 160, b: 85 }, // Desert planet (sandy)\n                { r: 85, g: 180, b: 85 }  // Forest planet (green)\n            ];\n            const baseColor = planetColors[index % planetColors.length];\n            const planetRadius = planet.radius;\n            const centerX = planet.position.x;\n            const centerY = planet.position.y;\n            \n            // Atmospheric glow (outermost layer)\n            const atmosphereSize = planetRadius + 8;\n            for (let i = 0; i < 3; i++) {\n                const glowRadius = atmosphereSize - i * 2;\n                const glowOpacity = (3 - i) * 0.15;\n                renderer.drawCircle(centerX, centerY, glowRadius, \n                    { r: baseColor.r * glowOpacity, g: baseColor.g * glowOpacity, b: baseColor.b * glowOpacity }, true);\n            }\n            \n            // Main planet body with gradient shading\n            for (let r = planetRadius; r > 0; r -= 2) {\n                const shadeFactor = 0.4 + (r / planetRadius) * 0.6; // Gradient from dark to light\n                const shadeColor = {\n                    r: Math.floor(baseColor.r * shadeFactor),\n                    g: Math.floor(baseColor.g * shadeFactor),\n                    b: Math.floor(baseColor.b * shadeFactor)\n                };\n                renderer.drawCircle(centerX, centerY, r, shadeColor, true);\n            }\n            \n            // Surface features based on planet type\n            const surfaceDetails = [];\n            switch (index % 4) {\n                case 0: // Mars-like - craters and polar caps\n                    surfaceDetails.push(\n                        { x: centerX - planetRadius * 0.3, y: centerY - planetRadius * 0.4, size: planetRadius * 0.2, color: { r: 120, g: 60, b: 30 } },\n                        { x: centerX + planetRadius * 0.4, y: centerY + planetRadius * 0.3, size: planetRadius * 0.15, color: { r: 140, g: 70, b: 35 } },\n                        { x: centerX, y: centerY - planetRadius * 0.8, size: planetRadius * 0.1, color: { r: 255, g: 255, b: 255 } } // Ice cap\n                    );\n                    break;\n                case 1: // Earth-like - continents and clouds\n                    surfaceDetails.push(\n                        { x: centerX - planetRadius * 0.2, y: centerY, size: planetRadius * 0.3, color: { r: 30, g: 100, b: 40 } }, // Continent\n                        { x: centerX + planetRadius * 0.3, y: centerY - planetRadius * 0.2, size: planetRadius * 0.25, color: { r: 35, g: 110, b: 45 } },\n                        { x: centerX, y: centerY + planetRadius * 0.4, size: planetRadius * 0.15, color: { r: 220, g: 220, b: 255 } } // Cloud\n                    );\n                    break;\n                case 2: // Desert planet - dune patterns\n                    for (let d = 0; d < 4; d++) {\n                        const angle = (d * Math.PI * 2) / 4;\n                        const x = centerX + Math.cos(angle) * planetRadius * 0.3;\n                        const y = centerY + Math.sin(angle) * planetRadius * 0.3;\n                        surfaceDetails.push({ x, y, size: planetRadius * 0.1, color: { r: 200, g: 180, b: 100 } });\n                    }\n                    break;\n                case 3: // Forest planet - vegetation patches\n                    for (let f = 0; f < 5; f++) {\n                        const angle = (f * Math.PI * 2) / 5;\n                        const x = centerX + Math.cos(angle) * planetRadius * 0.4;\n                        const y = centerY + Math.sin(angle) * planetRadius * 0.4;\n                        surfaceDetails.push({ x, y, size: planetRadius * 0.12, color: { r: 60, g: 150, b: 60 } });\n                    }\n                    break;\n            }\n            \n            // Draw surface details\n            surfaceDetails.forEach(detail => {\n                renderer.drawCircle(detail.x, detail.y, detail.size, detail.color, true);\n                // Add subtle highlight\n                renderer.drawCircle(detail.x - detail.size * 0.3, detail.y - detail.size * 0.3, detail.size * 0.5, \n                    { r: detail.color.r + 30, g: detail.color.g + 30, b: detail.color.b + 30 }, true);\n            });\n            \n            // Terminator line (day/night boundary)\n            const terminatorX = centerX + planetRadius * 0.3;\n            for (let y = centerY - planetRadius; y <= centerY + planetRadius; y += 2) {\n                const distFromCenter = Math.abs(y - centerY);\n                if (distFromCenter < planetRadius) {\n                    const shadowWidth = Math.sqrt(planetRadius * planetRadius - distFromCenter * distFromCenter) * 0.6;\n                    if (terminatorX - shadowWidth > centerX - planetRadius) {\n                        renderer.setPixel(terminatorX - shadowWidth, y, { r: 0, g: 0, b: 0 });\n                    }\n                }\n            }\n            \n            // Specular highlight (sun reflection)\n            const highlightX = centerX - planetRadius * 0.4;\n            const highlightY = centerY - planetRadius * 0.4;\n            const highlightSize = planetRadius * 0.15;\n            renderer.drawCircle(highlightX, highlightY, highlightSize, \n                { r: 255, g: 255, b: 255 }, true);\n            renderer.drawCircle(highlightX, highlightY, highlightSize * 0.7, \n                { r: 255, g: 255, b: 220 }, true);\n        });\n        \n        // Render enhanced demo ship if available\n        if (this.demoShip) {\n            const shipSize = 48; // Larger ship\n            const shipSprite = renderer.generateShipSprite('player', shipSize);\n            const shipX = this.demoShip.position.x - shipSize/2;\n            const shipY = this.demoShip.position.y - shipSize/2;\n            \n            renderer.drawSprite(shipSprite, shipX, shipY);\n            \n            // Enhanced engine effects\n            const engineGlowSize = 12;\n            const engineY = this.demoShip.position.y + shipSize/2 + 5;\n            \n            // Main engine exhausts\n            renderer.drawCircle(this.demoShip.position.x - 8, engineY, engineGlowSize, \n                { r: 100, g: 200, b: 255 }, true);\n            renderer.drawCircle(this.demoShip.position.x + 8, engineY, engineGlowSize, \n                { r: 100, g: 200, b: 255 }, true);\n            \n            // Bright engine cores\n            renderer.drawCircle(this.demoShip.position.x - 8, engineY, engineGlowSize * 0.6, \n                { r: 200, g: 240, b: 255 }, true);\n            renderer.drawCircle(this.demoShip.position.x + 8, engineY, engineGlowSize * 0.6, \n                { r: 200, g: 240, b: 255 }, true);\n            \n            // Engine plasma trails\n            for (let i = 1; i <= 5; i++) {\n                const trailY = engineY + i * 4;\n                const trailOpacity = (6 - i) / 6;\n                const trailSize = engineGlowSize * trailOpacity;\n                \n                renderer.drawCircle(this.demoShip.position.x - 8, trailY, trailSize, \n                    { r: 50 * trailOpacity, g: 150 * trailOpacity, b: 255 * trailOpacity }, true);\n                renderer.drawCircle(this.demoShip.position.x + 8, trailY, trailSize, \n                    { r: 50 * trailOpacity, g: 150 * trailOpacity, b: 255 * trailOpacity }, true);\n            }\n            \n            // Navigation lights\n            renderer.setPixel(this.demoShip.position.x - shipSize/2 + 5, this.demoShip.position.y - 10, \n                { r: 255, g: 0, b: 0 }); // Red port light\n            renderer.setPixel(this.demoShip.position.x + shipSize/2 - 5, this.demoShip.position.y - 10, \n                { r: 0, g: 255, b: 0 }); // Green starboard light\n            renderer.setPixel(this.demoShip.position.x, this.demoShip.position.y - shipSize/2 + 5, \n                { r: 255, g: 255, b: 255 }); // White forward light\n        }\n        \n        // Render enhanced HUD\n        this.renderEnhancedHUD(renderer);\n    }\n\n    /**\n     * Render paused state\n     */\n    private renderPausedState(renderer: Renderer): void {\n        // Render playing state first\n        this.renderPlayingState(renderer);\n        \n        // Overlay pause menu\n        const centerX = 720;\n        const centerY = 450;\n        \n        // Semi-transparent background\n        renderer.fillRect(centerX - 100, centerY - 50, 200, 100, { r: 0, g: 0, b: 0, a: 128 });\n        \n        // Pause text\n        renderer.renderText('GAME PAUSED', centerX - 60, centerY - 20, \n            { r: 255, g: 255, b: 0 }, 16);\n        \n        renderer.renderText('PRESS ESC TO RESUME', centerX - 80, centerY + 10, \n            { r: 0, g: 192, b: 0 }, 12);\n    }\n\n    /**\n     * Render error state\n     */\n    private renderErrorState(renderer: Renderer): void {\n        const centerX = 720;\n        const centerY = 450;\n        \n        // Error background\n        renderer.fillRect(0, 0, 1440, 900, { r: 64, g: 0, b: 0 });\n        \n        // Error message\n        renderer.renderText('SYSTEM ERROR', centerX - 60, centerY - 50, \n            { r: 255, g: 0, b: 0 }, 20);\n        \n        renderer.renderText('CRITICAL SYSTEM FAILURE DETECTED', centerX - 140, centerY - 10, \n            { r: 255, g: 64, b: 64 }, 14);\n        \n        renderer.renderText('PRESS ENTER TO RETURN TO MAIN MENU', centerX - 160, centerY + 30, \n            { r: 192, g: 192, b: 192 }, 12);\n    }\n\n    /**\n     * Render default state\n     */\n    private renderDefaultState(renderer: Renderer): void {\n        const centerX = 720;\n        const centerY = 450;\n        \n        renderer.renderText(`UNKNOWN STATE: ${this.currentState}`, centerX - 100, centerY, \n            { r: 255, g: 0, b: 255 }, 16);\n    }\n\n    /**\n     * Render space background\n     */\n    private renderSpaceBackground(renderer: Renderer): void {\n        // Simple star field\n        for (let i = 0; i < 150; i++) {\n            const x = (i * 73) % 1440; // Pseudo-random distribution for 1440x900\n            const y = (i * 149) % 900;\n            const brightness = (i % 3) + 1;\n            const color = { \n                r: brightness * 64, \n                g: brightness * 64, \n                b: brightness * 96 \n            };\n            \n            renderer.setPixel(x, y, color);\n        }\n    }\n\n    /**\n     * Render enhanced space background\n     */\n    private renderEnhancedSpaceBackground(renderer: Renderer): void {\n        // Deep space gradient background\n        renderer.fillRect(0, 0, 1440, 900, { r: 2, g: 4, b: 12 });\n        \n        // Distant galaxy background (faint milky way)\n        for (let i = 0; i < 50; i++) {\n            const x = (i * 28.8) % 1440;\n            const y = 200 + Math.sin(i * 0.1) * 150;\n            const size = 40 + (i % 20);\n            const intensity = 8 + (i % 12);\n            \n            renderer.drawCircle(x, y, size, { \n                r: intensity, \n                g: intensity * 0.9, \n                b: intensity * 1.3 \n            }, true);\n        }\n        \n        // Enhanced multi-layer star field\n        for (let layer = 0; layer < 3; layer++) {\n            const starCount = [150, 100, 50][layer]; // Different densities per layer\n            const brightness = [4, 3, 2][layer]; // Brightness per layer\n            \n            for (let i = 0; i < starCount; i++) {\n                const x = ((i * 73) + layer * 123) % 1440;\n                const y = ((i * 149) + layer * 67) % 900;\n                const starBrightness = (i % 4) + brightness;\n                const size = starBrightness > 5 ? 3 : starBrightness > 3 ? 2 : 1;\n                \n                // Star color variation (blue-white to red giants)\n                const colorVariation = i % 6;\n                let color;\n                switch (colorVariation) {\n                    case 0: // Blue-white hot stars\n                        color = { \n                            r: starBrightness * 40, \n                            g: starBrightness * 45, \n                            b: starBrightness * 60 \n                        };\n                        break;\n                    case 1: // White stars\n                        color = { \n                            r: starBrightness * 50, \n                            g: starBrightness * 50, \n                            b: starBrightness * 50 \n                        };\n                        break;\n                    case 2: // Yellow stars (like our sun)\n                        color = { \n                            r: starBrightness * 55, \n                            g: starBrightness * 50, \n                            b: starBrightness * 35 \n                        };\n                        break;\n                    case 3: // Orange stars\n                        color = { \n                            r: starBrightness * 55, \n                            g: starBrightness * 40, \n                            b: starBrightness * 25 \n                        };\n                        break;\n                    case 4: // Red giants\n                        color = { \n                            r: starBrightness * 60, \n                            g: starBrightness * 25, \n                            b: starBrightness * 15 \n                        };\n                        break;\n                    default: // Distant dim stars\n                        color = { \n                            r: starBrightness * 30, \n                            g: starBrightness * 30, \n                            b: starBrightness * 40 \n                        };\n                }\n                \n                if (size === 1) {\n                    renderer.setPixel(x, y, color);\n                } else if (size === 2) {\n                    renderer.fillRect(x, y, 2, 2, color);\n                    // Add subtle glow\n                    renderer.setPixel(x-1, y, { r: color.r * 0.3, g: color.g * 0.3, b: color.b * 0.3 });\n                    renderer.setPixel(x+2, y, { r: color.r * 0.3, g: color.g * 0.3, b: color.b * 0.3 });\n                    renderer.setPixel(x, y-1, { r: color.r * 0.3, g: color.g * 0.3, b: color.b * 0.3 });\n                    renderer.setPixel(x, y+2, { r: color.r * 0.3, g: color.g * 0.3, b: color.b * 0.3 });\n                } else {\n                    renderer.drawCircle(x, y, size, color, true);\n                    // Bright star corona\n                    renderer.drawCircle(x, y, size + 1, { \n                        r: color.r * 0.4, \n                        g: color.g * 0.4, \n                        b: color.b * 0.4 \n                    }, true);\n                }\n            }\n        }\n        \n        // Colorful nebulae patches\n        const nebulaColors = [\n            { r: 80, g: 20, b: 100 }, // Purple nebula\n            { r: 100, g: 40, b: 20 }, // Orange nebula\n            { r: 20, g: 80, b: 100 }, // Blue nebula\n            { r: 80, g: 100, b: 30 }, // Green nebula\n            { r: 100, g: 20, b: 60 }  // Pink nebula\n        ];\n        \n        for (let i = 0; i < 8; i++) {\n            const x = (i * 180) % 1440;\n            const y = (i * 112.5) % 900;\n            const size = 60 + (i % 40);\n            const baseColor = nebulaColors[i % nebulaColors.length];\n            \n            // Create wispy nebula effect\n            for (let angle = 0; angle < Math.PI * 2; angle += 0.2) {\n                for (let radius = 0; radius < size; radius += 8) {\n                    const opacity = (1 - radius / size) * 0.3;\n                    const px = x + Math.cos(angle) * radius + Math.sin(angle * 3) * 10;\n                    const py = y + Math.sin(angle) * radius + Math.cos(angle * 2) * 8;\n                    \n                    if (px >= 0 && px < 1440 && py >= 0 && py < 900) {\n                        const nebulaColor = {\n                            r: Math.floor(baseColor.r * opacity),\n                            g: Math.floor(baseColor.g * opacity),\n                            b: Math.floor(baseColor.b * opacity)\n                        };\n                        renderer.setPixel(Math.floor(px), Math.floor(py), nebulaColor);\n                    }\n                }\n            }\n        }\n        \n        // Distant galaxies (very faint spiral shapes)\n        for (let i = 0; i < 3; i++) {\n            const x = 200 + i * 500;\n            const y = 150 + i * 200;\n            const size = 30 + i * 10;\n            \n            // Spiral galaxy arms\n            for (let arm = 0; arm < 2; arm++) {\n                for (let t = 0; t < Math.PI * 4; t += 0.3) {\n                    const armOffset = arm * Math.PI;\n                    const radius = (t / (Math.PI * 4)) * size;\n                    const px = x + Math.cos(t + armOffset) * radius;\n                    const py = y + Math.sin(t + armOffset) * radius * 0.6; // Elliptical\n                    \n                    if (px >= 0 && px < 1440 && py >= 0 && py < 900) {\n                        const intensity = (1 - t / (Math.PI * 4)) * 15;\n                        renderer.setPixel(Math.floor(px), Math.floor(py), {\n                            r: intensity * 0.8,\n                            g: intensity * 0.8,\n                            b: intensity * 1.2\n                        });\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Render menu background (Image 3)\n     */\n    private renderMenuBackground(renderer: Renderer): void {\n        // Image 3 as base64 (cockpit view with galaxy)\n        const menuBgData = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCABQAGQDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxAAPwD3+iiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA//9k=';\n        \n        // For now, we'll draw a simple gradient background\n        // In a real implementation, you'd decode and render the base64 image\n        for (let y = 0; y < 768; y++) {\n            for (let x = 0; x < 1024; x++) {\n                // Create a dark space gradient from top to bottom\n                const gradient = Math.floor((y / 768) * 64);\n                const color = {\n                    r: gradient / 4,\n                    g: gradient / 3,\n                    b: gradient\n                };\n                renderer.setPixel(x, y, color);\n            }\n        }\n        \n        // Add some stars\n        for (let i = 0; i < 200; i++) {\n            const x = (i * 73) % 1024;\n            const y = (i * 149) % 768;\n            const brightness = (i % 4) + 1;\n            const color = { \n                r: brightness * 48, \n                g: brightness * 48, \n                b: brightness * 64 \n            };\n            \n            renderer.setPixel(x, y, color);\n            \n            // Add twinkling effect for some stars\n            if (i % 7 === 0) {\n                const twinkle = Math.sin(Date.now() / 1000 + i) * 32 + 32;\n                const twinkleColor = {\n                    r: twinkle,\n                    g: twinkle * 0.8,\n                    b: twinkle * 1.2\n                };\n                renderer.setPixel(x, y, twinkleColor);\n            }\n        }\n        \n        // Add galaxy band across the middle\n        for (let x = 0; x < 1024; x++) {\n            for (let y = 300; y < 468; y++) {\n                const distance = Math.abs(y - 384);\n                const intensity = Math.max(0, 168 - distance) / 168;\n                const color = {\n                    r: intensity * 48,\n                    g: intensity * 32,\n                    b: intensity * 64\n                };\n                if (intensity > 0.1) {\n                    renderer.setPixel(x, y, color);\n                }\n            }\n        }\n    }\n\n    /**\n     * Render basic HUD\n     */\n    private renderBasicHUD(renderer: Renderer): void {\n        // Ship status\n        const health = this.gameData.playerShip.health;\n        const fuel = this.gameData.playerShip.fuel;\n        \n        renderer.renderText(`HEALTH: ${health.toFixed(0)}%`, 10, 10, \n            health > 50 ? { r: 0, g: 255, b: 0 } : { r: 255, g: 0, b: 0 }, 12);\n        \n        renderer.renderText(`FUEL: ${fuel.toFixed(0)}`, 10, 30, \n            fuel > 200 ? { r: 0, g: 255, b: 0 } : { r: 255, g: 255, b: 0 }, 12);\n        \n        // Resources\n        renderer.renderText(`CREDITS: ${this.gameData.playerShip.resources.get('credits') || 0}`, \n            10, 50, { r: 255, g: 255, b: 0 }, 12);\n        \n        // Game time\n        const minutes = Math.floor(this.gameData.gameTime / 60);\n        const seconds = Math.floor(this.gameData.gameTime % 60);\n        renderer.renderText(`TIME: ${minutes}:${seconds.toString().padStart(2, '0')}`, \n            10, 70, { r: 0, g: 192, b: 192 }, 12);\n        \n        // Galaxy info (if available)\n        renderer.renderText(`SYSTEM: ${this.gameData.currentSystem.name}`, \n            10, 90, { r: 0, g: 255, b: 255 }, 12);\n        \n        // Galaxy exploration progress\n        renderer.renderText(`EXPLORATION: ${(this.gameData.stats.systemsVisited || 0)} systems`, \n            10, 110, { r: 192, g: 192, b: 192 }, 12);\n    }\n\n    /**\n     * Render enhanced HUD with better visuals\n     */\n    private renderEnhancedHUD(renderer: Renderer): void {\n        // HUD background panel\n        renderer.fillRect(10, 10, 280, 140, { r: 0, g: 0, b: 0, a: 180 });\n        renderer.drawRect(10, 10, 280, 140, { r: 0, g: 255, b: 255 }, false);\n        \n        // Ship status with bars\n        const health = this.gameData.playerShip.health;\n        const fuel = this.gameData.playerShip.fuel;\n        \n        // Health bar\n        renderer.renderText('INTEGRITA:', 20, 25, { r: 200, g: 200, b: 200 }, 12);\n        renderer.fillRect(100, 25, 100, 12, { r: 50, g: 50, b: 50 });\n        renderer.fillRect(100, 25, health, 12, \n            health > 70 ? { r: 0, g: 200, b: 0 } : \n            health > 30 ? { r: 200, g: 200, b: 0 } : { r: 200, g: 0, b: 0 });\n        renderer.renderText(`${health.toFixed(0)}%`, 210, 25, { r: 255, g: 255, b: 255 }, 12);\n        \n        // Fuel bar\n        renderer.renderText('PALIVO:', 20, 45, { r: 200, g: 200, b: 200 }, 12);\n        const fuelPercent = Math.min(100, (fuel / 1000) * 100);\n        renderer.fillRect(100, 45, 100, 12, { r: 50, g: 50, b: 50 });\n        renderer.fillRect(100, 45, fuelPercent, 12, \n            fuelPercent > 50 ? { r: 0, g: 150, b: 255 } : { r: 255, g: 100, b: 0 });\n        renderer.renderText(`${fuel.toFixed(0)}`, 210, 45, { r: 255, g: 255, b: 255 }, 12);\n        \n        // Resources\n        renderer.renderText(`KREDITY: ${this.gameData.playerShip.resources.get('credits') || 0}`, \n            20, 70, { r: 255, g: 255, b: 100 }, 12);\n        \n        // Location info\n        renderer.renderText(`SYSTÉM: ${this.gameData.currentSystem.name}`, \n            20, 90, { r: 100, g: 255, b: 255 }, 12);\n            \n        // Game time\n        const minutes = Math.floor(this.gameData.gameTime / 60);\n        const seconds = Math.floor(this.gameData.gameTime % 60);\n        renderer.renderText(`ČAS: ${minutes}:${seconds.toString().padStart(2, '0')}`, \n            20, 110, { r: 150, g: 200, b: 255 }, 12);\n            \n        // Position indicator (top right)\n        const shipPos = this.gameData.playerShip.position;\n        renderer.renderText(`POS: ${Math.floor(shipPos.x)}, ${Math.floor(shipPos.y)}`, \n            1290, 20, { r: 150, g: 150, b: 150 }, 10);\n            \n        // Control hints (bottom of screen)\n        const hints = [\n            'WASD - Pohyb | MEZERNÍK - Brždění | ESC - Menu',\n            'P - Skenovat planetu | E - Interakce'\n        ];\n        hints.forEach((hint, index) => {\n            renderer.renderText(hint, 720, 850 + index * 20, { r: 100, g: 100, b: 100 }, 10);\n        });\n    }\n\n    /**\n     * Game time tracking\n     */\n    private gameTimeStarted = false;\n    \n    private startGameTimeTracking(): void {\n        this.gameTimeStarted = true;\n        this.logger.debug('Game time tracking started');\n    }\n    \n    private pauseGameTimeTracking(): void {\n        this.gameTimeStarted = false;\n        this.logger.debug('Game time tracking paused');\n    }\n\n    /**\n     * Save game data\n     */\n    async save(): Promise<void> {\n        try {\n            const saveData = {\n                version: '1.0.0',\n                timestamp: Date.now(),\n                gameData: this.gameData\n            };\n            \n            const serialized = JSON.stringify(saveData);\n            localStorage.setItem('spaceExplorer_save', serialized);\n            \n            this.logger.debug('Game saved successfully');\n            \n        } catch (error) {\n            this.logger.error('Failed to save game', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Load game data\n     */\n    async load(): Promise<void> {\n        try {\n            await this.loadGameData();\n            this.logger.info('Game loaded successfully');\n            \n        } catch (error) {\n            this.logger.warn('Failed to load game, using defaults', error);\n            this.gameData = this.createDefaultGameData();\n        }\n    }\n\n    /**\n     * Load game data from storage\n     */\n    private async loadGameData(): Promise<void> {\n        const saved = localStorage.getItem('spaceExplorer_save');\n        if (!saved) {\n            throw new Error('No save data found');\n        }\n        \n        const saveData = JSON.parse(saved);\n        \n        // Validate save data\n        if (!saveData.gameData) {\n            throw new Error('Invalid save data format');\n        }\n        \n        // Restore resources as Map\n        if (saveData.gameData.playerShip.resources) {\n            const resourcesArray = saveData.gameData.playerShip.resources;\n            if (Array.isArray(resourcesArray)) {\n                saveData.gameData.playerShip.resources = new Map(resourcesArray);\n            } else {\n                // Convert object to Map\n                saveData.gameData.playerShip.resources = new Map(Object.entries(resourcesArray));\n            }\n        }\n        \n        this.gameData = saveData.gameData;\n        this.logger.debug('Game data loaded from storage');\n    }\n\n    /**\n     * Handle menu events\n     */\n    private async handleNewGame(settings: NewGameSettings): Promise<void> {\n        this.logger.info('🆕 Starting new game', settings);\n        \n        // Apply new game settings\n        this.gameData = this.createDefaultGameData();\n        this.gameData.playerShip.id = `ship_${settings.playerName.toLowerCase()}`;\n        \n        // Apply difficulty settings\n        switch (settings.difficulty) {\n            case 'easy':\n                this.gameData.playerShip.health = 150;\n                this.gameData.playerShip.fuel = 200;\n                break;\n            case 'hard':\n                this.gameData.playerShip.health = 75;\n                this.gameData.playerShip.fuel = 100;\n                break;\n            case 'nightmare':\n                this.gameData.playerShip.health = 50;\n                this.gameData.playerShip.fuel = 75;\n                break;\n            default: // normal\n                this.gameData.playerShip.health = 100;\n                this.gameData.playerShip.fuel = 150;\n        }\n        \n        // Set galaxy settings\n        this.gameData.currentSystem.name = `Galaxy_${settings.galaxySeed}`;\n        \n        await this.setState(GameState.Loading);\n    }\n    \n    private async handleLoadGame(saveSlot: number): Promise<void> {\n        this.logger.info(`📁 Loading game from slot ${saveSlot}`);\n        \n        try {\n            const saveKey = `stellarOdyssey_save_${saveSlot}`;\n            const saveData = localStorage.getItem(saveKey);\n            \n            if (saveData) {\n                this.gameData = JSON.parse(saveData);\n                await this.setState(GameState.Loading);\n            } else {\n                this.logger.warn('Save slot is empty');\n            }\n        } catch (error) {\n            this.logger.error('Failed to load game', error);\n        }\n    }\n    \n    private handleSettingsChange(settings: GameSettings): void {\n        this.logger.info('⚙️ Applying settings', settings);\n        \n        // Update game data settings\n        this.gameData.settings = {\n            masterVolume: settings.masterVolume,\n            musicVolume: settings.musicVolume,\n            sfxVolume: settings.sfxVolume,\n            difficulty: settings.difficulty || 'normal'\n        };\n        \n        // Save settings\n        try {\n            localStorage.setItem('stellarOdyssey_settings', JSON.stringify(settings));\n        } catch (error) {\n            this.logger.error('Failed to save settings', error);\n        }\n    }\n    \n    private async handleExit(): Promise<void> {\n        this.logger.info('👋 Exiting game');\n        \n        // Save current game state\n        await this.save();\n        \n        // Close game or minimize window\n        if ('close' in window) {\n            (window as any).close();\n        }\n    }\n\n    /**\n     * Public getters\n     */\n    getCurrentState(): GameState {\n        return this.currentState;\n    }\n\n    getPreviousState(): GameState {\n        return this.previousState;\n    }\n\n    getGameData(): GameData {\n        return this.gameData;\n    }\n\n    isInState(state: GameState): boolean {\n        return this.currentState === state;\n    }\n\n    /**\n     * Set demo entities for rendering\n     */\n    setDemoShip(ship: PhysicsObject): void {\n        this.demoShip = ship;\n    }\n\n    setDemoPlanets(planets: PhysicsObject[]): void {\n        this.demoPlanets = [...planets];\n    }\n\n    /**\n     * Game state checks\n     */\n    canPause(): boolean {\n        return this.currentState === GameState.Playing;\n    }\n\n    canResume(): boolean {\n        return this.currentState === GameState.Paused;\n    }\n\n    isGameActive(): boolean {\n        return this.currentState === GameState.Playing;\n    }\n    \n\n\n    isInMenu(): boolean {\n        return this.currentState === GameState.MainMenu;\n    }\n\n    /**\n     * Cleanup\n     */\n    cleanup(): void {\n        // Save game before cleanup\n        this.save().catch(error => {\n            this.logger.error('Failed to save during cleanup', error);\n        });\n        \n        this.logger.info('🧹 Game state manager cleanup completed');\n    }\n}","/**\n * Ship Systems Manager\n * Handles all ship subsystems including engines, shields, weapons, life support, and damage\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2 } from '@core/Renderer';\n\nexport interface ShipSystemsConfig {\n    maxHull: number;\n    maxShields: number;\n    maxPower: number;\n    maxFuel: number;\n    maxHeat: number;\n    \n    // Engine configuration\n    enginePower: number;\n    engineEfficiency: number;\n    \n    // Shield configuration\n    shieldRegenRate: number;\n    shieldPowerDrain: number;\n    \n    // Weapon configuration\n    weaponCount: number;\n    weaponPower: number;\n    weaponHeatGeneration: number;\n}\n\nexport interface SystemStatus {\n    hull: number;           // 0-100%\n    shields: number;        // 0-100%\n    power: number;          // 0-100%\n    fuel: number;           // 0-100%\n    heat: number;           // 0-100%\n    \n    // System states\n    enginesOnline: boolean;\n    shieldsOnline: boolean;\n    weaponsOnline: boolean;\n    lifeSupport: boolean;\n    warpDrive: boolean;\n    \n    // Performance modifiers\n    engineEfficiency: number;  // 0-1\n    shieldStrength: number;    // 0-1\n    weaponAccuracy: number;    // 0-1\n    sensorRange: number;       // 0-1\n}\n\nexport interface DamageReport {\n    section: ShipSection;\n    severity: DamageSeverity;\n    systemsAffected: SystemType[];\n    repairCost: RepairCost;\n    repairTime: number; // seconds\n}\n\nexport interface RepairCost {\n    metal: number;\n    electronics: number;\n    crystals: number;\n    nanobots?: number;\n}\n\nexport enum ShipSection {\n    Bow = 'bow',\n    Stern = 'stern',\n    Port = 'port',\n    Starboard = 'starboard',\n    Core = 'core',\n    Bridge = 'bridge',\n    Engineering = 'engineering',\n    Weapons = 'weapons'\n}\n\nexport enum SystemType {\n    Engines = 'engines',\n    Shields = 'shields',\n    Weapons = 'weapons',\n    LifeSupport = 'life_support',\n    Sensors = 'sensors',\n    Navigation = 'navigation',\n    Communications = 'communications',\n    WarpDrive = 'warp_drive'\n}\n\nexport enum DamageSeverity {\n    Minor = 'minor',       // 0-25% damage\n    Moderate = 'moderate', // 25-50% damage\n    Major = 'major',       // 50-75% damage\n    Critical = 'critical', // 75-100% damage\n    Destroyed = 'destroyed' // 100% damage\n}\n\nexport interface PowerAllocation {\n    engines: number;    // 0-100%\n    shields: number;    // 0-100%\n    weapons: number;    // 0-100%\n    lifeSupport: number; // 0-100%\n    sensors: number;    // 0-100%\n}\n\nexport interface ShipSystemsEvents {\n    onSystemDamage: (system: SystemType, severity: DamageSeverity) => void;\n    onSystemRepaired: (system: SystemType) => void;\n    onCriticalDamage: (section: ShipSection) => void;\n    onPowerFailure: () => void;\n    onOverheat: () => void;\n}\n\nexport class ShipSystems {\n    private config: ShipSystemsConfig;\n    private status: SystemStatus;\n    private damage: Map<ShipSection, DamageReport[]> = new Map();\n    private powerAllocation: PowerAllocation;\n    \n    // System performance tracking\n    private heatGeneration: number = 0;\n    private powerConsumption: number = 0;\n    private fuelConsumption: number = 0;\n    \n    // Timers and intervals\n    private updateTimer: number = 0;\n    private lastUpdateTime: number = 0;\n    \n    // Events\n    private events: Partial<ShipSystemsEvents> = {};\n    \n    private logger: Logger;\n\n    constructor(config: Partial<ShipSystemsConfig> = {}, events: Partial<ShipSystemsEvents> = {}) {\n        this.logger = new Logger('ShipSystems');\n        this.events = events;\n        \n        // Default configuration\n        this.config = {\n            maxHull: 100,\n            maxShields: 100,\n            maxPower: 100,\n            maxFuel: 1000,\n            maxHeat: 100,\n            enginePower: 5000,\n            engineEfficiency: 0.8,\n            shieldRegenRate: 2.0,\n            shieldPowerDrain: 5.0,\n            weaponCount: 2,\n            weaponPower: 25,\n            weaponHeatGeneration: 15,\n            ...config\n        };\n        \n        // Initialize status\n        this.status = {\n            hull: 100,\n            shields: 100,\n            power: 100,\n            fuel: 100,\n            heat: 0,\n            enginesOnline: true,\n            shieldsOnline: true,\n            weaponsOnline: true,\n            lifeSupport: true,\n            warpDrive: true,\n            engineEfficiency: 1.0,\n            shieldStrength: 1.0,\n            weaponAccuracy: 1.0,\n            sensorRange: 1.0\n        };\n        \n        // Initialize power allocation\n        this.powerAllocation = {\n            engines: 30,\n            shields: 25,\n            weapons: 20,\n            lifeSupport: 15,\n            sensors: 10\n        };\n        \n        // Initialize damage tracking for all sections\n        Object.values(ShipSection).forEach(section => {\n            this.damage.set(section, []);\n        });\n        \n        this.logger.info('🛸 Ship systems initialized', {\n            config: this.config,\n            status: this.status\n        });\n    }\n\n    /**\n     * Update ship systems (called each frame)\n     */\n    update(deltaTime: number): void {\n        this.lastUpdateTime = deltaTime;\n        \n        // Update power consumption\n        this.updatePowerConsumption();\n        \n        // Update heat generation and cooling\n        this.updateThermalManagement(deltaTime);\n        \n        // Update shields\n        this.updateShields(deltaTime);\n        \n        // Update fuel consumption\n        this.updateFuelConsumption(deltaTime);\n        \n        // Update system efficiency based on damage\n        this.updateSystemEfficiency();\n        \n        // Check for critical system failures\n        this.checkCriticalSystems();\n        \n        // Update performance modifiers\n        this.updatePerformanceModifiers();\n    }\n\n    /**\n     * Update power consumption based on active systems\n     */\n    private updatePowerConsumption(): void {\n        let totalConsumption = 0;\n        \n        // Base life support always consumes power\n        totalConsumption += (this.powerAllocation.lifeSupport / 100) * 10;\n        \n        // Engine power consumption\n        if (this.status.enginesOnline) {\n            totalConsumption += (this.powerAllocation.engines / 100) * 20;\n        }\n        \n        // Shield power consumption\n        if (this.status.shieldsOnline) {\n            totalConsumption += (this.powerAllocation.shields / 100) * this.config.shieldPowerDrain;\n        }\n        \n        // Weapon power consumption\n        if (this.status.weaponsOnline) {\n            totalConsumption += (this.powerAllocation.weapons / 100) * 15;\n        }\n        \n        // Sensor power consumption\n        totalConsumption += (this.powerAllocation.sensors / 100) * 5;\n        \n        this.powerConsumption = totalConsumption;\n        \n        // Drain power\n        this.status.power = Math.max(0, this.status.power - (totalConsumption * this.lastUpdateTime));\n        \n        // Auto-shutdown systems if power critical\n        if (this.status.power < 10) {\n            this.handlePowerFailure();\n        }\n    }\n\n    /**\n     * Update thermal management (heat generation and cooling)\n     */\n    private updateThermalManagement(deltaTime: number): void {\n        // Heat generation\n        this.heatGeneration = 0;\n        \n        // Engine heat\n        if (this.status.enginesOnline) {\n            this.heatGeneration += (this.powerAllocation.engines / 100) * 8;\n        }\n        \n        // Shield heat\n        if (this.status.shieldsOnline) {\n            this.heatGeneration += (this.powerAllocation.shields / 100) * 3;\n        }\n        \n        // Weapon heat\n        if (this.status.weaponsOnline) {\n            this.heatGeneration += (this.powerAllocation.weapons / 100) * 5;\n        }\n        \n        // Add heat\n        this.status.heat = Math.min(this.config.maxHeat, \n            this.status.heat + this.heatGeneration * deltaTime);\n        \n        // Passive cooling (space is cold)\n        const coolingRate = 15; // Heat units per second\n        this.status.heat = Math.max(0, this.status.heat - coolingRate * deltaTime);\n        \n        // Overheat protection\n        if (this.status.heat > 90) {\n            this.handleOverheat();\n        }\n    }\n\n    /**\n     * Update shields (regeneration and power drain)\n     */\n    private updateShields(deltaTime: number): void {\n        if (this.status.shieldsOnline && this.status.power > 5) {\n            // Shield regeneration\n            const regenRate = this.config.shieldRegenRate * (this.powerAllocation.shields / 100);\n            this.status.shields = Math.min(this.config.maxShields, \n                this.status.shields + regenRate * deltaTime);\n        }\n    }\n\n    /**\n     * Update fuel consumption\n     */\n    private updateFuelConsumption(deltaTime: number): void {\n        if (this.status.enginesOnline) {\n            // Base fuel consumption for life support\n            let consumption = 0.5; // Units per second\n            \n            // Engine fuel consumption based on power allocation\n            consumption += (this.powerAllocation.engines / 100) * 2.0;\n            \n            // Inefficiency increases consumption\n            consumption *= (2.0 - this.status.engineEfficiency);\n            \n            this.fuelConsumption = consumption;\n            this.status.fuel = Math.max(0, this.status.fuel - consumption * deltaTime);\n            \n            // Emergency shutdown if no fuel\n            if (this.status.fuel === 0) {\n                this.emergencyShutdown();\n            }\n        }\n    }\n\n    /**\n     * Update system efficiency based on damage\n     */\n    private updateSystemEfficiency(): void {\n        // Calculate engine efficiency based on engineering section damage\n        const engineDamage = this.getSectionDamageLevel(ShipSection.Engineering);\n        this.status.engineEfficiency = Math.max(0.1, 1.0 - (engineDamage * 0.8));\n        \n        // Calculate shield strength based on core section damage\n        const coreDamage = this.getSectionDamageLevel(ShipSection.Core);\n        this.status.shieldStrength = Math.max(0.1, 1.0 - (coreDamage * 0.9));\n        \n        // Calculate weapon accuracy based on weapons section damage\n        const weaponDamage = this.getSectionDamageLevel(ShipSection.Weapons);\n        this.status.weaponAccuracy = Math.max(0.1, 1.0 - (weaponDamage * 0.7));\n        \n        // Calculate sensor range based on bridge damage\n        const bridgeDamage = this.getSectionDamageLevel(ShipSection.Bridge);\n        this.status.sensorRange = Math.max(0.2, 1.0 - (bridgeDamage * 0.6));\n    }\n\n    /**\n     * Update performance modifiers\n     */\n    private updatePerformanceModifiers(): void {\n        // Heat affects all systems\n        const heatPenalty = Math.max(0, (this.status.heat - 70) / 30); // Penalty starts at 70% heat\n        \n        this.status.engineEfficiency *= (1 - heatPenalty * 0.3);\n        this.status.shieldStrength *= (1 - heatPenalty * 0.2);\n        this.status.weaponAccuracy *= (1 - heatPenalty * 0.4);\n        \n        // Power affects system performance\n        const powerLevel = this.status.power / 100;\n        if (powerLevel < 0.5) {\n            const powerPenalty = (0.5 - powerLevel) * 2; // 0 to 1\n            this.status.engineEfficiency *= (1 - powerPenalty * 0.5);\n            this.status.shieldStrength *= (1 - powerPenalty * 0.7);\n            this.status.weaponAccuracy *= (1 - powerPenalty * 0.3);\n        }\n    }\n\n    /**\n     * Check for critical system failures\n     */\n    private checkCriticalSystems(): void {\n        // Check hull integrity\n        if (this.status.hull < 20) {\n            this.logger.warn('⚠️ Critical hull damage detected');\n            this.events.onCriticalDamage?.(ShipSection.Core);\n        }\n        \n        // Check life support\n        if (!this.status.lifeSupport || this.status.power < 5) {\n            this.logger.error('💀 Life support critical');\n        }\n        \n        // Check for system failures due to damage\n        Object.entries(ShipSection).forEach(([key, section]) => {\n            const damageLevel = this.getSectionDamageLevel(section);\n            if (damageLevel > 0.8) {\n                this.logger.warn(`⚠️ Critical damage in ${section} section`);\n                this.events.onCriticalDamage?.(section);\n            }\n        });\n    }\n\n    /**\n     * Handle power failure\n     */\n    private handlePowerFailure(): void {\n        this.logger.error('⚡ Power failure - emergency protocols activated');\n        \n        // Auto-shutdown non-essential systems\n        this.status.weaponsOnline = false;\n        this.powerAllocation.weapons = 0;\n        this.powerAllocation.sensors = 5; // Minimal sensors\n        \n        // Reduce other allocations\n        this.powerAllocation.engines = Math.min(this.powerAllocation.engines, 20);\n        this.powerAllocation.shields = Math.min(this.powerAllocation.shields, 15);\n        \n        this.events.onPowerFailure?.();\n    }\n\n    /**\n     * Handle overheat\n     */\n    private handleOverheat(): void {\n        this.logger.error('🔥 System overheat - emergency cooling');\n        \n        // Reduce power allocation to prevent further heating\n        this.powerAllocation.engines *= 0.7;\n        this.powerAllocation.weapons *= 0.5;\n        \n        // Emergency shutdown weapons if too hot\n        if (this.status.heat > 95) {\n            this.status.weaponsOnline = false;\n            this.powerAllocation.weapons = 0;\n        }\n        \n        this.events.onOverheat?.();\n    }\n\n    /**\n     * Emergency shutdown\n     */\n    private emergencyShutdown(): void {\n        this.logger.error('🛑 Emergency shutdown - no fuel');\n        \n        this.status.enginesOnline = false;\n        this.status.weaponsOnline = false;\n        this.status.shieldsOnline = false;\n        \n        // Keep minimal life support\n        this.powerAllocation = {\n            engines: 0,\n            shields: 0,\n            weapons: 0,\n            lifeSupport: 100,\n            sensors: 0\n        };\n    }\n\n    /**\n     * Apply damage to ship section\n     */\n    applyDamage(section: ShipSection, amount: number, damageType: 'kinetic' | 'energy' | 'thermal' = 'kinetic'): void {\n        // Calculate actual damage based on shields\n        let actualDamage = amount;\n        \n        if (this.status.shieldsOnline && this.status.shields > 0) {\n            const shieldAbsorption = Math.min(this.status.shields, amount * this.status.shieldStrength);\n            this.status.shields -= shieldAbsorption;\n            actualDamage -= shieldAbsorption;\n            \n            this.logger.debug(`Shields absorbed ${shieldAbsorption.toFixed(1)} damage`);\n        }\n        \n        if (actualDamage > 0) {\n            // Apply hull damage\n            this.status.hull = Math.max(0, this.status.hull - actualDamage);\n            \n            // Create damage report\n            this.addDamageReport(section, actualDamage);\n            \n            this.logger.warn(`${section} section took ${actualDamage.toFixed(1)} ${damageType} damage`);\n        }\n    }\n\n    /**\n     * Add damage report\n     */\n    private addDamageReport(section: ShipSection, damage: number): void {\n        const severity = this.calculateDamageSeverity(damage);\n        const systemsAffected = this.getAffectedSystems(section);\n        \n        const damageReport: DamageReport = {\n            section,\n            severity,\n            systemsAffected,\n            repairCost: this.calculateRepairCost(severity),\n            repairTime: this.calculateRepairTime(severity)\n        };\n        \n        const sectionDamage = this.damage.get(section) || [];\n        sectionDamage.push(damageReport);\n        this.damage.set(section, sectionDamage);\n        \n        // Trigger events\n        systemsAffected.forEach(system => {\n            this.events.onSystemDamage?.(system, severity);\n        });\n    }\n\n    /**\n     * Calculate damage severity\n     */\n    private calculateDamageSeverity(damage: number): DamageSeverity {\n        if (damage >= 50) return DamageSeverity.Critical;\n        if (damage >= 30) return DamageSeverity.Major;\n        if (damage >= 15) return DamageSeverity.Moderate;\n        return DamageSeverity.Minor;\n    }\n\n    /**\n     * Get systems affected by damage to a section\n     */\n    private getAffectedSystems(section: ShipSection): SystemType[] {\n        const systemMap: Record<ShipSection, SystemType[]> = {\n            [ShipSection.Bow]: [SystemType.Sensors, SystemType.Navigation],\n            [ShipSection.Stern]: [SystemType.Engines],\n            [ShipSection.Port]: [],\n            [ShipSection.Starboard]: [],\n            [ShipSection.Core]: [SystemType.LifeSupport, SystemType.Shields],\n            [ShipSection.Bridge]: [SystemType.Navigation, SystemType.Communications, SystemType.Sensors],\n            [ShipSection.Engineering]: [SystemType.Engines, SystemType.WarpDrive],\n            [ShipSection.Weapons]: [SystemType.Weapons]\n        };\n        \n        return systemMap[section] || [];\n    }\n\n    /**\n     * Calculate repair cost\n     */\n    private calculateRepairCost(severity: DamageSeverity): RepairCost {\n        const baseCost = {\n            [DamageSeverity.Minor]: { metal: 5, electronics: 2, crystals: 1 },\n            [DamageSeverity.Moderate]: { metal: 15, electronics: 8, crystals: 3 },\n            [DamageSeverity.Major]: { metal: 30, electronics: 20, crystals: 8 },\n            [DamageSeverity.Critical]: { metal: 60, electronics: 40, crystals: 20, nanobots: 5 },\n            [DamageSeverity.Destroyed]: { metal: 100, electronics: 80, crystals: 40, nanobots: 15 }\n        };\n        \n        return baseCost[severity];\n    }\n\n    /**\n     * Calculate repair time\n     */\n    private calculateRepairTime(severity: DamageSeverity): number {\n        const baseTimes = {\n            [DamageSeverity.Minor]: 30,      // 30 seconds\n            [DamageSeverity.Moderate]: 120,  // 2 minutes\n            [DamageSeverity.Major]: 300,     // 5 minutes\n            [DamageSeverity.Critical]: 600,  // 10 minutes\n            [DamageSeverity.Destroyed]: 1800 // 30 minutes\n        };\n        \n        return baseTimes[severity];\n    }\n\n    /**\n     * Get damage level for a section (0-1)\n     */\n    private getSectionDamageLevel(section: ShipSection): number {\n        const damages = this.damage.get(section) || [];\n        let totalDamage = 0;\n        \n        damages.forEach(damage => {\n            const severityValues = {\n                [DamageSeverity.Minor]: 0.1,\n                [DamageSeverity.Moderate]: 0.25,\n                [DamageSeverity.Major]: 0.5,\n                [DamageSeverity.Critical]: 0.8,\n                [DamageSeverity.Destroyed]: 1.0\n            };\n            totalDamage += severityValues[damage.severity];\n        });\n        \n        return Math.min(1.0, totalDamage);\n    }\n\n    /**\n     * Repair system damage\n     */\n    repairDamage(section: ShipSection, damageIndex: number, resources: RepairCost): boolean {\n        const damages = this.damage.get(section);\n        if (!damages || !damages[damageIndex]) return false;\n        \n        const damageReport = damages[damageIndex];\n        \n        // Check if we have enough resources\n        if (!this.hasEnoughResources(resources, damageReport.repairCost)) {\n            return false;\n        }\n        \n        // Remove the damage\n        damages.splice(damageIndex, 1);\n        this.damage.set(section, damages);\n        \n        // Restore some hull if applicable\n        this.status.hull = Math.min(this.config.maxHull, this.status.hull + 10);\n        \n        // Trigger repair event\n        damageReport.systemsAffected.forEach(system => {\n            this.events.onSystemRepaired?.(system);\n        });\n        \n        this.logger.info(`Repaired ${damageReport.severity} damage in ${section} section`);\n        return true;\n    }\n\n    /**\n     * Check if we have enough resources for repair\n     */\n    private hasEnoughResources(available: RepairCost, required: RepairCost): boolean {\n        return available.metal >= required.metal &&\n               available.electronics >= required.electronics &&\n               available.crystals >= required.crystals &&\n               (required.nanobots === undefined || (available.nanobots || 0) >= required.nanobots);\n    }\n\n    /**\n     * Set power allocation\n     */\n    setPowerAllocation(allocation: Partial<PowerAllocation>): void {\n        this.powerAllocation = { ...this.powerAllocation, ...allocation };\n        \n        // Ensure total doesn't exceed 100%\n        const total = Object.values(this.powerAllocation).reduce((sum, val) => sum + val, 0);\n        if (total > 100) {\n            // Scale down proportionally\n            const scale = 100 / total;\n            Object.keys(this.powerAllocation).forEach(key => {\n                (this.powerAllocation as any)[key] *= scale;\n            });\n        }\n        \n        this.logger.debug('Power allocation updated', this.powerAllocation);\n    }\n\n    /**\n     * Toggle system on/off\n     */\n    toggleSystem(system: SystemType, state?: boolean): void {\n        const newState = state !== undefined ? state : !this.getSystemState(system);\n        \n        switch (system) {\n            case SystemType.Engines:\n                this.status.enginesOnline = newState;\n                break;\n            case SystemType.Shields:\n                this.status.shieldsOnline = newState;\n                break;\n            case SystemType.Weapons:\n                this.status.weaponsOnline = newState;\n                break;\n            case SystemType.LifeSupport:\n                this.status.lifeSupport = newState;\n                break;\n            case SystemType.WarpDrive:\n                this.status.warpDrive = newState;\n                break;\n        }\n        \n        this.logger.debug(`${system} ${newState ? 'enabled' : 'disabled'}`);\n    }\n\n    /**\n     * Get system state\n     */\n    private getSystemState(system: SystemType): boolean {\n        switch (system) {\n            case SystemType.Engines: return this.status.enginesOnline;\n            case SystemType.Shields: return this.status.shieldsOnline;\n            case SystemType.Weapons: return this.status.weaponsOnline;\n            case SystemType.LifeSupport: return this.status.lifeSupport;\n            case SystemType.WarpDrive: return this.status.warpDrive;\n            default: return true;\n        }\n    }\n\n    /**\n     * Get current status\n     */\n    getStatus(): SystemStatus {\n        return { ...this.status };\n    }\n\n    /**\n     * Get power allocation\n     */\n    getPowerAllocation(): PowerAllocation {\n        return { ...this.powerAllocation };\n    }\n\n    /**\n     * Get damage reports\n     */\n    getDamageReports(): Map<ShipSection, DamageReport[]> {\n        return new Map(this.damage);\n    }\n\n    /**\n     * Get system diagnostics\n     */\n    getDiagnostics() {\n        return {\n            powerConsumption: this.powerConsumption,\n            heatGeneration: this.heatGeneration,\n            fuelConsumption: this.fuelConsumption,\n            totalDamageReports: Array.from(this.damage.values()).reduce((sum, reports) => sum + reports.length, 0),\n            criticalSystems: this.getCriticalSystems()\n        };\n    }\n\n    /**\n     * Get critical systems\n     */\n    private getCriticalSystems(): SystemType[] {\n        const critical: SystemType[] = [];\n        \n        if (this.status.hull < 25) critical.push(SystemType.LifeSupport);\n        if (this.status.power < 15) critical.push(SystemType.Engines);\n        if (this.status.heat > 85) critical.push(SystemType.Weapons);\n        if (!this.status.enginesOnline) critical.push(SystemType.Engines);\n        if (!this.status.lifeSupport) critical.push(SystemType.LifeSupport);\n        \n        return critical;\n    }\n\n    /**\n     * Add fuel\n     */\n    addFuel(amount: number): void {\n        this.status.fuel = Math.min(this.config.maxFuel, this.status.fuel + amount);\n    }\n\n    /**\n     * Add power (battery recharge)\n     */\n    addPower(amount: number): void {\n        this.status.power = Math.min(this.config.maxPower, this.status.power + amount);\n    }\n\n    /**\n     * Emergency repair (restores basic functionality)\n     */\n    emergencyRepair(): void {\n        this.status.hull = Math.max(this.status.hull, 25);\n        this.status.power = Math.max(this.status.power, 30);\n        this.status.heat = Math.min(this.status.heat, 50);\n        \n        // Restore critical systems\n        this.status.enginesOnline = true;\n        this.status.lifeSupport = true;\n        \n        this.logger.info('🔧 Emergency repair completed');\n    }\n}","/**\n * Warp Drive System\n * Complete warp drive mechanics with black hole formation, particle effects, and space distortion\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer, Color } from '@core/Renderer';\nimport { AudioEngine } from '@core/AudioEngine';\n\nexport interface WarpDriveConfig {\n    speedMultiplier: number; // 20x speed multiplier\n    energyCost: number; // Energy cost per second\n    particleCount: number; // Number of particles for effects\n    maxRange: number; // Maximum warp range\n    cooldownTime: number; // Cooldown between warps\n}\n\nexport enum WarpState {\n    Idle = 'idle',\n    Charging = 'charging',         // 0-5s: Particle absorption\n    BlackHoleGrowth = 'growth',    // 5-7s: Black hole formation\n    AccretionFormation = 'accretion', // 7-12s: Accretion disk formation\n    Active = 'active',             // Warp active with space distortion\n    Deactivating = 'deactivating' // 6s: Shutdown sequence\n}\n\ninterface WarpParticle {\n    position: Vector2;\n    velocity: Vector2;\n    color: Color;\n    life: number; // 0-1\n    size: number;\n    absorbed: boolean;\n}\n\ninterface AccretionParticle {\n    angle: number;\n    radius: number;\n    speed: number;\n    color: Color;\n    size: number;\n    life: number;\n}\n\ninterface SpaceDistortion {\n    intensity: number; // 0-1\n    radius: number;\n    center: Vector2;\n}\n\nexport interface WarpEvents {\n    onWarpStart?: () => void;\n    onWarpEnd?: () => void;\n    onBlackHoleFormed?: () => void;\n    onSpaceDistorted?: () => void;\n    onWarpFail?: (reason: string) => void;\n}\n\nexport class WarpDrive {\n    private config: WarpDriveConfig;\n    private events: WarpEvents;\n    \n    // Warp state\n    private state: WarpState = WarpState.Idle;\n    private stateTimer: number = 0;\n    private isCharging: boolean = false;\n    private isActive: boolean = false;\n    \n    // Visual effects\n    private particles: WarpParticle[] = [];\n    private accretionParticles: AccretionParticle[] = [];\n    private blackHoleRadius: number = 0;\n    private distortion: SpaceDistortion = { intensity: 0, radius: 0, center: { x: 0, y: 0 } };\n    \n    // Ship properties\n    private shipPosition: Vector2 = { x: 0, y: 0 };\n    private shipSize: number = 20;\n    private originalSpeed: number = 1.0;\n    \n    // Timing phases (seconds)\n    private readonly PHASE_PARTICLE_ABSORPTION = 5.0;\n    private readonly PHASE_BLACK_HOLE_GROWTH = 2.0; // 5-7s\n    private readonly PHASE_ACCRETION_FORMATION = 5.0; // 7-12s\n    private readonly PHASE_SHUTDOWN = 6.0;\n    \n    // Effect intensities\n    private particleIntensity: number = 0;\n    private blackHoleIntensity: number = 0;\n    private accretionIntensity: number = 0;\n    private distortionIntensity: number = 0;\n    \n    private logger: Logger;\n\n    constructor(\n        config: Partial<WarpDriveConfig> = {},\n        events: WarpEvents = {}\n    ) {\n        this.logger = new Logger('WarpDrive');\n        this.events = events;\n        \n        this.config = {\n            speedMultiplier: 20.0,\n            energyCost: 10.0, // Energy per second\n            particleCount: 50,\n            maxRange: 10000,\n            cooldownTime: 30.0,\n            ...config\n        };\n        \n        this.logger.info('🌌 Warp drive system initialized', {\n            speedMultiplier: this.config.speedMultiplier,\n            particleCount: this.config.particleCount\n        });\n    }\n\n    /**\n     * Activate warp drive\n     */\n    activateWarp(shipPosition: Vector2, shipSize: number): boolean {\n        if (this.state !== WarpState.Idle) {\n            this.logger.warn('⚠️ Warp already active or charging');\n            return false;\n        }\n        \n        this.shipPosition = { ...shipPosition };\n        this.shipSize = shipSize;\n        this.state = WarpState.Charging;\n        this.stateTimer = 0;\n        this.isCharging = true;\n        \n        // Initialize particle system\n        this.initializeParticles();\n        \n        this.logger.info('🚀 Warp drive activation sequence started');\n        this.events.onWarpStart?.();\n        \n        return true;\n    }\n\n    /**\n     * Deactivate warp drive\n     */\n    deactivateWarp(): void {\n        if (this.state === WarpState.Active) {\n            this.state = WarpState.Deactivating;\n            this.stateTimer = 0;\n            this.isActive = false;\n            \n            this.logger.info('🛑 Warp drive deactivation sequence started');\n        }\n    }\n\n    /**\n     * Initialize particle system for warp effects\n     */\n    private initializeParticles(): void {\n        this.particles = [];\n        const spawnRadius = 150; // Spawn particles around ship\n        \n        for (let i = 0; i < this.config.particleCount; i++) {\n            // Spawn particles in circle around ship\n            const angle = (Math.PI * 2 * i) / this.config.particleCount + Math.random() * 0.5;\n            const distance = spawnRadius + Math.random() * 50;\n            \n            const position = {\n                x: this.shipPosition.x + Math.cos(angle) * distance,\n                y: this.shipPosition.y + Math.sin(angle) * distance\n            };\n            \n            // Random particle colors (red, yellow, gray, purple, white, orange)\n            const colors = [\n                { r: 72, g: 24, b: 24 },  // Dark red\n                { r: 72, g: 48, b: 12 },  // Dark yellow\n                { r: 48, g: 48, b: 48 },  // Gray\n                { r: 48, g: 24, b: 72 },  // Dark purple\n                { r: 64, g: 64, b: 64 },  // White (muted)\n                { r: 64, g: 32, b: 16 }   // Dark orange\n            ];\n            \n            this.particles.push({\n                position: { ...position },\n                velocity: { x: 0, y: 0 },\n                color: colors[Math.floor(Math.random() * colors.length)],\n                life: 1.0,\n                size: Math.random() * 3 + 1,\n                absorbed: false\n            });\n        }\n    }\n\n    /**\n     * Update warp drive system\n     */\n    update(deltaTime: number, shipPosition: Vector2): number {\n        this.shipPosition = { ...shipPosition };\n        this.stateTimer += deltaTime;\n        \n        switch (this.state) {\n            case WarpState.Charging:\n                this.updateChargingPhase(deltaTime);\n                break;\n                \n            case WarpState.BlackHoleGrowth:\n                this.updateBlackHoleGrowth(deltaTime);\n                break;\n                \n            case WarpState.AccretionFormation:\n                this.updateAccretionFormation(deltaTime);\n                break;\n                \n            case WarpState.Active:\n                this.updateActiveWarp(deltaTime);\n                break;\n                \n            case WarpState.Deactivating:\n                this.updateDeactivation(deltaTime);\n                break;\n        }\n        \n        // Update particle systems\n        this.updateParticles(deltaTime);\n        this.updateAccretionDisk(deltaTime);\n        this.updateSpaceDistortion(deltaTime);\n        \n        // Return speed multiplier\n        return this.isActive ? this.config.speedMultiplier : 1.0;\n    }\n\n    /**\n     * Update charging phase (0-5 seconds)\n     */\n    private updateChargingPhase(deltaTime: number): void {\n        const progress = this.stateTimer / this.PHASE_PARTICLE_ABSORPTION;\n        this.particleIntensity = Math.min(1.0, progress);\n        \n        // Particles start moving toward ship center\n        this.particles.forEach(particle => {\n            if (!particle.absorbed) {\n                const toCenter = {\n                    x: this.shipPosition.x - particle.position.x,\n                    y: this.shipPosition.y - particle.position.y\n                };\n                const distance = Math.sqrt(toCenter.x * toCenter.x + toCenter.y * toCenter.y);\n                \n                if (distance > 5) {\n                    // Accelerate toward center\n                    const speed = 50 + (progress * 200); // Speed increases over time\n                    particle.velocity.x = (toCenter.x / distance) * speed;\n                    particle.velocity.y = (toCenter.y / distance) * speed;\n                    \n                    // Update position\n                    particle.position.x += particle.velocity.x * deltaTime;\n                    particle.position.y += particle.velocity.y * deltaTime;\n                } else {\n                    particle.absorbed = true;\n                }\n            }\n        });\n        \n        // Transition to black hole growth\n        if (this.stateTimer >= this.PHASE_PARTICLE_ABSORPTION) {\n            this.state = WarpState.BlackHoleGrowth;\n            this.stateTimer = 0;\n            this.logger.debug('🕳️ Black hole formation phase started');\n        }\n    }\n\n    /**\n     * Update black hole growth phase (5-7 seconds)\n     */\n    private updateBlackHoleGrowth(deltaTime: number): void {\n        const progress = this.stateTimer / this.PHASE_BLACK_HOLE_GROWTH;\n        this.blackHoleIntensity = Math.min(1.0, progress);\n        \n        // Black hole grows to 1/3 of ship size\n        this.blackHoleRadius = (this.shipSize / 3) * this.blackHoleIntensity;\n        \n        // Transition to accretion formation\n        if (this.stateTimer >= this.PHASE_BLACK_HOLE_GROWTH) {\n            this.state = WarpState.AccretionFormation;\n            this.stateTimer = 0;\n            this.initializeAccretionDisk();\n            this.logger.debug('💫 Accretion disk formation phase started');\n        }\n    }\n\n    /**\n     * Update accretion formation phase (7-12 seconds)\n     */\n    private updateAccretionFormation(deltaTime: number): void {\n        const progress = this.stateTimer / this.PHASE_ACCRETION_FORMATION;\n        this.accretionIntensity = Math.min(1.0, progress);\n        \n        // Black hole continues growing to consume whole ship\n        const totalGrowthProgress = (this.PHASE_BLACK_HOLE_GROWTH + this.stateTimer) / \n                                  (this.PHASE_BLACK_HOLE_GROWTH + this.PHASE_ACCRETION_FORMATION);\n        this.blackHoleRadius = this.shipSize * totalGrowthProgress;\n        \n        // Transition to active warp\n        if (this.stateTimer >= this.PHASE_ACCRETION_FORMATION) {\n            this.state = WarpState.Active;\n            this.stateTimer = 0;\n            this.isActive = true;\n            this.isCharging = false;\n            \n            // Initialize space distortion\n            this.distortion.center = { ...this.shipPosition };\n            this.distortion.radius = 200;\n            \n            this.logger.info('🌌 Warp drive fully active - space distortion engaged');\n            this.events.onBlackHoleFormed?.();\n            this.events.onSpaceDistorted?.();\n        }\n    }\n\n    /**\n     * Update active warp phase\n     */\n    private updateActiveWarp(deltaTime: number): void {\n        // Maintain full intensity effects\n        this.particleIntensity = 1.0;\n        this.blackHoleIntensity = 1.0;\n        this.accretionIntensity = 1.0;\n        this.distortionIntensity = 1.0;\n        \n        // Update distortion center to follow ship\n        this.distortion.center = { ...this.shipPosition };\n    }\n\n    /**\n     * Update deactivation phase (6 seconds)\n     */\n    private updateDeactivation(deltaTime: number): void {\n        const progress = this.stateTimer / this.PHASE_SHUTDOWN;\n        const reverseProgress = 1.0 - progress;\n        \n        // Gradually reduce all effects\n        this.distortionIntensity = reverseProgress;\n        this.blackHoleIntensity = Math.max(0, reverseProgress - 0.3); // Black hole dissolves faster\n        this.accretionIntensity = Math.max(0, reverseProgress - 0.1); // Accretion disk dissolves\n        this.particleIntensity = Math.max(0, reverseProgress - 0.5); // Particles fade last\n        \n        // Add dissolution particles\n        if (progress > 0.3 && Math.random() < 0.3) {\n            this.addDissolutionParticles();\n        }\n        \n        // Complete shutdown\n        if (this.stateTimer >= this.PHASE_SHUTDOWN) {\n            this.state = WarpState.Idle;\n            this.stateTimer = 0;\n            this.clearAllEffects();\n            \n            this.logger.info('✅ Warp drive deactivation complete');\n            this.events.onWarpEnd?.();\n        }\n    }\n\n    /**\n     * Initialize accretion disk\n     */\n    private initializeAccretionDisk(): void {\n        this.accretionParticles = [];\n        const particleCount = 40;\n        \n        for (let i = 0; i < particleCount; i++) {\n            this.accretionParticles.push({\n                angle: Math.random() * Math.PI * 2,\n                radius: 15 + Math.random() * 25, // Radius around black hole\n                speed: 2 + Math.random() * 4, // Rotation speed (chaotic)\n                color: this.getAccretionColor(),\n                size: Math.random() * 2 + 1,\n                life: 1.0\n            });\n        }\n    }\n\n    /**\n     * Get accretion disk particle color (red-orange-yellow-white swirl)\n     */\n    private getAccretionColor(): Color {\n        const colors = [\n            { r: 96, g: 32, b: 32 },  // Dark red\n            { r: 96, g: 48, b: 16 },  // Dark orange  \n            { r: 96, g: 64, b: 16 },  // Dark yellow\n            { r: 80, g: 80, b: 80 }   // Muted white\n        ];\n        return colors[Math.floor(Math.random() * colors.length)];\n    }\n\n    /**\n     * Update particle effects\n     */\n    private updateParticles(deltaTime: number): void {\n        this.particles.forEach(particle => {\n            if (this.state === WarpState.Deactivating && !particle.absorbed) {\n                // During deactivation, particles fly outward\n                const fromCenter = {\n                    x: particle.position.x - this.shipPosition.x,\n                    y: particle.position.y - this.shipPosition.y\n                };\n                const distance = Math.sqrt(fromCenter.x * fromCenter.x + fromCenter.y * fromCenter.y);\n                \n                if (distance > 0) {\n                    const speed = 100;\n                    particle.velocity.x = (fromCenter.x / distance) * speed;\n                    particle.velocity.y = (fromCenter.y / distance) * speed;\n                    \n                    particle.position.x += particle.velocity.x * deltaTime;\n                    particle.position.y += particle.velocity.y * deltaTime;\n                }\n                \n                particle.life -= deltaTime * 2; // Fade quickly\n            }\n        });\n    }\n\n    /**\n     * Update accretion disk\n     */\n    private updateAccretionDisk(deltaTime: number): void {\n        this.accretionParticles.forEach(particle => {\n            // Chaotic rotation\n            particle.angle += particle.speed * deltaTime * (0.5 + Math.random() * 0.5);\n            \n            // Slight radius variation for chaos\n            particle.radius += Math.sin(particle.angle * 3) * 2 * deltaTime;\n            \n            // During deactivation, particles spiral outward\n            if (this.state === WarpState.Deactivating) {\n                particle.radius += 50 * deltaTime;\n                particle.life -= deltaTime * 1.5;\n            }\n        });\n        \n        // Remove dead particles\n        this.accretionParticles = this.accretionParticles.filter(p => p.life > 0);\n    }\n\n    /**\n     * Update space distortion effect\n     */\n    private updateSpaceDistortion(deltaTime: number): void {\n        if (this.distortionIntensity > 0) {\n            // Subtle pulsing effect\n            this.distortion.intensity = this.distortionIntensity * (0.8 + Math.sin(this.stateTimer * 3) * 0.2);\n        }\n    }\n\n    /**\n     * Add dissolution particles during shutdown\n     */\n    private addDissolutionParticles(): void {\n        for (let i = 0; i < 5; i++) {\n            const angle = Math.random() * Math.PI * 2;\n            const distance = Math.random() * 30;\n            \n            this.particles.push({\n                position: {\n                    x: this.shipPosition.x + Math.cos(angle) * distance,\n                    y: this.shipPosition.y + Math.sin(angle) * distance\n                },\n                velocity: {\n                    x: Math.cos(angle) * 50,\n                    y: Math.sin(angle) * 50\n                },\n                color: { r: 32, g: 32, b: 32 }, // Darker particles for dissolution\n                life: 0.5,\n                size: Math.random() * 2 + 1,\n                absorbed: false\n            });\n        }\n    }\n\n    /**\n     * Clear all effects\n     */\n    private clearAllEffects(): void {\n        this.particles = [];\n        this.accretionParticles = [];\n        this.blackHoleRadius = 0;\n        this.particleIntensity = 0;\n        this.blackHoleIntensity = 0;\n        this.accretionIntensity = 0;\n        this.distortionIntensity = 0;\n    }\n\n    /**\n     * Render warp effects\n     */\n    render(renderer: Renderer): void {\n        if (this.state === WarpState.Idle) return;\n        \n        // Render space distortion first (background effect)\n        if (this.distortionIntensity > 0) {\n            this.renderSpaceDistortion(renderer);\n        }\n        \n        // Render absorption particles\n        if (this.particleIntensity > 0) {\n            this.renderParticles(renderer);\n        }\n        \n        // Render accretion disk\n        if (this.accretionIntensity > 0) {\n            this.renderAccretionDisk(renderer);\n        }\n        \n        // Render black hole (on top)\n        if (this.blackHoleIntensity > 0) {\n            this.renderBlackHole(renderer);\n        }\n    }\n\n    /**\n     * Render absorption particles\n     */\n    private renderParticles(renderer: Renderer): void {\n        this.particles.forEach(particle => {\n            if (particle.life > 0) {\n                const alpha = particle.life * this.particleIntensity;\n                const color = {\n                    r: Math.floor(particle.color.r * alpha),\n                    g: Math.floor(particle.color.g * alpha),\n                    b: Math.floor(particle.color.b * alpha)\n                };\n                \n                renderer.fillRect(\n                    particle.position.x - particle.size/2,\n                    particle.position.y - particle.size/2,\n                    particle.size,\n                    particle.size,\n                    color\n                );\n            }\n        });\n    }\n\n    /**\n     * Render black hole\n     */\n    private renderBlackHole(renderer: Renderer): void {\n        const radius = this.blackHoleRadius * this.blackHoleIntensity;\n        if (radius > 0) {\n            // Pure black center\n            renderer.drawCircle(this.shipPosition.x, this.shipPosition.y, radius, { r: 0, g: 0, b: 0 }, true);\n            \n            // Subtle event horizon glow\n            const glowRadius = radius * 1.2;\n            const glowColor = { r: 8, g: 8, b: 8 }; // Very dark glow\n            renderer.drawCircle(this.shipPosition.x, this.shipPosition.y, glowRadius, glowColor, false);\n        }\n    }\n\n    /**\n     * Render accretion disk\n     */\n    private renderAccretionDisk(renderer: Renderer): void {\n        this.accretionParticles.forEach(particle => {\n            if (particle.life > 0) {\n                const x = this.shipPosition.x + Math.cos(particle.angle) * particle.radius;\n                const y = this.shipPosition.y + Math.sin(particle.angle) * particle.radius;\n                \n                const alpha = particle.life * this.accretionIntensity;\n                const color = {\n                    r: Math.floor(particle.color.r * alpha),\n                    g: Math.floor(particle.color.g * alpha),\n                    b: Math.floor(particle.color.b * alpha)\n                };\n                \n                renderer.fillRect(\n                    x - particle.size/2,\n                    y - particle.size/2,\n                    particle.size,\n                    particle.size,\n                    color\n                );\n            }\n        });\n    }\n\n    /**\n     * Render space distortion effect\n     */\n    private renderSpaceDistortion(renderer: Renderer): void {\n        // This is a placeholder for space distortion\n        // In a real implementation, this would affect the entire background rendering\n        // For now, we'll render subtle distortion lines\n        \n        const intensity = this.distortion.intensity;\n        if (intensity > 0) {\n            const lines = 8;\n            for (let i = 0; i < lines; i++) {\n                const angle = (Math.PI * 2 * i) / lines;\n                const baseRadius = this.distortion.radius;\n                \n                for (let r = baseRadius * 0.5; r < baseRadius * 1.5; r += 10) {\n                    const distortion = Math.sin(this.stateTimer * 2 + r * 0.1) * intensity * 5;\n                    const x = this.distortion.center.x + Math.cos(angle) * (r + distortion);\n                    const y = this.distortion.center.y + Math.sin(angle) * (r + distortion);\n                    \n                    const alpha = intensity * 0.3 * (1 - (r - baseRadius * 0.5) / (baseRadius));\n                    const color = {\n                        r: Math.floor(16 * alpha),\n                        g: Math.floor(24 * alpha),\n                        b: Math.floor(32 * alpha)\n                    };\n                    \n                    renderer.fillRect(x - 1, y - 1, 2, 2, color);\n                }\n            }\n        }\n    }\n\n    /**\n     * Get current warp state\n     */\n    getState(): WarpState {\n        return this.state;\n    }\n\n    /**\n     * Check if warp is active\n     */\n    isWarpActive(): boolean {\n        return this.isActive;\n    }\n\n    /**\n     * Check if warp is charging\n     */\n    isWarpCharging(): boolean {\n        return this.isCharging;\n    }\n\n    /**\n     * Get warp progress (0-1) during charging/deactivation\n     */\n    getWarpProgress(): number {\n        switch (this.state) {\n            case WarpState.Charging:\n                return this.stateTimer / this.PHASE_PARTICLE_ABSORPTION;\n            case WarpState.BlackHoleGrowth:\n                return this.stateTimer / this.PHASE_BLACK_HOLE_GROWTH;\n            case WarpState.AccretionFormation:\n                return this.stateTimer / this.PHASE_ACCRETION_FORMATION;\n            case WarpState.Deactivating:\n                return 1.0 - (this.stateTimer / this.PHASE_SHUTDOWN);\n            case WarpState.Active:\n                return 1.0;\n            default:\n                return 0.0;\n        }\n    }\n\n    /**\n     * Get space distortion data for background rendering\n     */\n    getSpaceDistortion(): SpaceDistortion {\n        return { ...this.distortion };\n    }\n\n    /**\n     * Force emergency warp shutdown\n     */\n    emergencyShutdown(): void {\n        if (this.state !== WarpState.Idle) {\n            this.state = WarpState.Deactivating;\n            this.stateTimer = 0;\n            this.isActive = false;\n            this.isCharging = false;\n            \n            this.logger.warn('🚨 Emergency warp shutdown initiated');\n        }\n    }\n}","/**\n * Player Ship Entity\n * Integrates physics, input, and rendering for the player's controllable ship\n */\n\nimport { PhysicsObject, SpacePhysics } from '@core/Physics';\nimport { InputManager } from '@core/InputManager';\nimport { AudioEngine } from '@core/AudioEngine';\nimport { Vector2 } from '@core/Renderer';\nimport { Logger } from '@utils/Logger';\nimport { ShipSystems, SystemStatus, PowerAllocation, ShipSection, SystemType } from '@entities/ShipSystems';\nimport { WarpDrive, WarpState } from '@systems/WarpDrive';\n\nexport interface ShipStats {\n    maxHealth: number;\n    maxFuel: number;\n    thrustPower: number;\n    rotationSpeed: number;\n    maxVelocity: number;\n    mass: number;\n}\n\nexport class PlayerShip {\n    private physicsObject: PhysicsObject;\n    private physics: SpacePhysics;\n    private input: InputManager;\n    private audio: AudioEngine;\n    \n    // Ship systems\n    private shipSystems: ShipSystems;\n    private warpDrive: WarpDrive;\n    \n    // Ship properties\n    private stats: ShipStats;\n    private currentFuel: number;\n    private rotation: number = 0; // Rotation in radians\n    private thrustLevel: number = 0; // 0-1\n    private engineSoundId: string | null = null;\n    \n    // Visual effects\n    private thrustParticles: ThrustParticle[] = [];\n    \n    private logger: Logger;\n\n    constructor(\n        physics: SpacePhysics,\n        input: InputManager,\n        audio: AudioEngine,\n        startPosition: Vector2,\n        stats?: Partial<ShipStats>\n    ) {\n        this.physics = physics;\n        this.input = input;\n        this.audio = audio;\n        this.logger = new Logger('PlayerShip');\n        \n        // Default ship stats\n        this.stats = {\n            maxHealth: 100,\n            maxFuel: 1000,\n            thrustPower: 5000,\n            rotationSpeed: 3.0,\n            maxVelocity: 500,\n            mass: 1000,\n            ...stats\n        };\n        \n        this.currentFuel = this.stats.maxFuel;\n        \n        // Create physics object\n        this.physicsObject = this.physics.createShip('player_ship', startPosition, this.stats.mass);\n        this.physicsObject.health = this.stats.maxHealth;\n        \n        // Add collision callback\n        this.physicsObject.onCollision = (other) => this.handleCollision(other);\n        \n        // Add to physics simulation\n        this.physics.addObject(this.physicsObject);\n        \n        // Initialize ship systems\n        this.shipSystems = new ShipSystems({\n            maxHull: this.stats.maxHealth,\n            maxFuel: this.stats.maxFuel,\n            enginePower: this.stats.thrustPower,\n            engineEfficiency: 0.85\n        }, {\n            onSystemDamage: (system, severity) => {\n                this.logger.warn(`⚠️ ${system} system damaged: ${severity}`);\n                this.audio.playUIBeep();\n            },\n            onCriticalDamage: (section) => {\n                this.logger.error(`💥 Critical damage in ${section} section!`);\n            },\n            onPowerFailure: () => {\n                this.logger.error('⚡ Power failure - emergency protocols activated');\n            },\n            onOverheat: () => {\n                this.logger.warn('🔥 Ship overheating - reducing power');\n            }\n        });\n        \n        // Initialize warp drive\n        this.warpDrive = new WarpDrive({\n            speedMultiplier: 20.0,\n            energyCost: 15.0,\n            particleCount: 50\n        }, {\n            onWarpStart: () => {\n                this.logger.info('🌌 Warp drive activation sequence initiated');\n            },\n            onWarpEnd: () => {\n                this.logger.info('✅ Warp drive deactivation complete');\n            },\n            onBlackHoleFormed: () => {\n                this.logger.info('🕳️ Black hole formation complete');\n            },\n            onSpaceDistorted: () => {\n                this.logger.info('🌀 Space-time distortion field active');\n            }\n        });\n        \n        this.logger.info('🚀 Player ship created', {\n            position: startPosition,\n            stats: this.stats\n        });\n    }\n\n    /**\n     * Update the player ship\n     */\n    update(deltaTime: number): void {\n        // Update ship systems first\n        this.shipSystems.update(deltaTime);\n        \n        // Update warp drive\n        const warpSpeedMultiplier = this.warpDrive.update(deltaTime, this.physicsObject.position);\n        \n        // Handle input\n        this.handleInput(deltaTime);\n        \n        // Update rotation based on input\n        this.updateRotation(deltaTime);\n        \n        // Update thrust and movement (affected by warp speed)\n        this.updateMovement(deltaTime, warpSpeedMultiplier);\n        \n        // Update visual effects\n        this.updateThrustParticles(deltaTime);\n        \n        // Update audio\n        this.updateAudio();\n        \n        // Apply fuel consumption\n        this.consumeFuel(deltaTime);\n    }\n\n    /**\n     * Handle player input\n     */\n    private handleInput(deltaTime: number): void {\n        // Warp drive controls\n        if (this.input.isKeyPressed('KeyW') || this.input.isActionPressed()) {\n            this.handleWarpInput();\n        }\n        \n        // Get input values\n        const thrustInput = this.input.getThrustInput();\n        const rotationInput = this.input.getRotationInput();\n        \n        // Update thrust level\n        this.thrustLevel = Math.max(0, thrustInput); // Only forward thrust for now\n        \n        // Update rotation\n        this.rotation += rotationInput * this.stats.rotationSpeed * deltaTime;\n        \n        // Normalize rotation to 0-2π\n        while (this.rotation < 0) this.rotation += Math.PI * 2;\n        while (this.rotation > Math.PI * 2) this.rotation -= Math.PI * 2;\n    }\n\n    /**\n     * Update ship rotation\n     */\n    private updateRotation(deltaTime: number): void {\n        // Rotation is handled in handleInput\n        // This method can be used for additional rotation logic\n    }\n\n    /**\n     * Handle warp drive input\n     */\n    private handleWarpInput(): void {\n        const systemStatus = this.shipSystems.getStatus();\n        \n        // Check if warp drive is available\n        if (!systemStatus.warpDrive) {\n            this.logger.warn('⚠️ Warp drive offline');\n            return;\n        }\n        \n        if (systemStatus.power < 20) {\n            this.logger.warn('⚠️ Insufficient power for warp drive');\n            return;\n        }\n        \n        // Toggle warp drive\n        if (this.warpDrive.isWarpActive()) {\n            this.warpDrive.deactivateWarp();\n        } else if (!this.warpDrive.isWarpCharging()) {\n            this.warpDrive.activateWarp(this.physicsObject.position, 20); // Ship size\n        }\n    }\n\n    /**\n     * Update ship movement and thrust\n     */\n    private updateMovement(deltaTime: number, speedMultiplier: number = 1.0): void {\n        if (this.thrustLevel > 0 && this.currentFuel > 0) {\n            // Calculate thrust direction based on rotation\n            const thrustDirection: Vector2 = {\n                x: Math.cos(this.rotation - Math.PI / 2), // -PI/2 because 0 rotation points up\n                y: Math.sin(this.rotation - Math.PI / 2)\n            };\n            \n            // Apply thrust (affected by warp speed multiplier)\n            const thrustForce = this.thrustLevel * this.stats.thrustPower * speedMultiplier;\n            this.physics.applyThrust(this.physicsObject.id, thrustDirection, thrustForce);\n            \n            // Create thrust particles\n            this.createThrustParticles();\n        }\n        \n        // Limit velocity to max speed\n        const currentSpeed = Math.sqrt(\n            this.physicsObject.velocity.x ** 2 + this.physicsObject.velocity.y ** 2\n        );\n        \n        if (currentSpeed > this.stats.maxVelocity) {\n            const scale = this.stats.maxVelocity / currentSpeed;\n            this.physicsObject.velocity.x *= scale;\n            this.physicsObject.velocity.y *= scale;\n        }\n    }\n\n    /**\n     * Update thrust particle effects\n     */\n    private updateThrustParticles(deltaTime: number): void {\n        // Update existing particles\n        for (let i = this.thrustParticles.length - 1; i >= 0; i--) {\n            const particle = this.thrustParticles[i];\n            \n            // Update particle\n            particle.position.x += particle.velocity.x * deltaTime;\n            particle.position.y += particle.velocity.y * deltaTime;\n            particle.life -= deltaTime;\n            \n            // Remove dead particles\n            if (particle.life <= 0) {\n                this.thrustParticles.splice(i, 1);\n            }\n        }\n    }\n\n    /**\n     * Create thrust particles\n     */\n    private createThrustParticles(): void {\n        if (this.thrustParticles.length > 20) return; // Limit particle count\n        \n        // Calculate exhaust position (behind the ship)\n        const exhaustOffset = 20; // Distance behind ship center\n        const exhaustX = this.physicsObject.position.x - Math.cos(this.rotation - Math.PI / 2) * exhaustOffset;\n        const exhaustY = this.physicsObject.position.y - Math.sin(this.rotation - Math.PI / 2) * exhaustOffset;\n        \n        // Create particle\n        const particle: ThrustParticle = {\n            position: { x: exhaustX, y: exhaustY },\n            velocity: {\n                x: -Math.cos(this.rotation - Math.PI / 2) * 100 + (Math.random() - 0.5) * 50,\n                y: -Math.sin(this.rotation - Math.PI / 2) * 100 + (Math.random() - 0.5) * 50\n            },\n            life: 0.5,\n            maxLife: 0.5\n        };\n        \n        this.thrustParticles.push(particle);\n    }\n\n    /**\n     * Update audio based on ship state\n     */\n    private updateAudio(): void {\n        if (this.thrustLevel > 0 && this.currentFuel > 0) {\n            // Start engine sound if not playing\n            if (!this.engineSoundId) {\n                this.engineSoundId = this.audio.playEngineSound();\n            }\n        } else {\n            // Stop engine sound\n            if (this.engineSoundId) {\n                this.audio.stopSound(this.engineSoundId);\n                this.engineSoundId = null;\n            }\n        }\n    }\n\n    /**\n     * Consume fuel based on thrust\n     */\n    private consumeFuel(deltaTime: number): void {\n        if (this.thrustLevel > 0) {\n            const fuelConsumption = this.thrustLevel * 10 * deltaTime; // Adjust consumption rate\n            this.currentFuel = Math.max(0, this.currentFuel - fuelConsumption);\n            \n            if (this.currentFuel === 0) {\n                this.logger.warn('Ship out of fuel!');\n            }\n        }\n    }\n\n    /**\n     * Handle collision with other objects\n     */\n    private handleCollision(other: PhysicsObject): void {\n        this.logger.debug(`Ship collision with ${other.type}: ${other.id}`);\n        \n        switch (other.type) {\n            case 'planet':\n            case 'asteroid':\n                // Take damage from collision\n                const collisionDamage = 10;\n                this.takeDamage(collisionDamage);\n                \n                // Play collision sound\n                this.audio.playExplosion(this.physicsObject.position);\n                break;\n                \n            case 'projectile':\n                // Take damage from projectile\n                this.takeDamage(5);\n                break;\n        }\n    }\n\n    /**\n     * Take damage\n     */\n    takeDamage(amount: number): void {\n        if (this.physicsObject.health) {\n            this.physicsObject.health = Math.max(0, this.physicsObject.health - amount);\n            this.logger.debug(`Ship took ${amount} damage, health: ${this.physicsObject.health}`);\n            \n            if (this.physicsObject.health === 0) {\n                this.destroy();\n            }\n        }\n    }\n\n    /**\n     * Heal the ship\n     */\n    heal(amount: number): void {\n        if (this.physicsObject.health) {\n            this.physicsObject.health = Math.min(this.stats.maxHealth, this.physicsObject.health + amount);\n            this.logger.debug(`Ship healed ${amount}, health: ${this.physicsObject.health}`);\n        }\n    }\n\n    /**\n     * Add fuel\n     */\n    addFuel(amount: number): void {\n        this.currentFuel = Math.min(this.stats.maxFuel, this.currentFuel + amount);\n        this.logger.debug(`Added ${amount} fuel, current: ${this.currentFuel}`);\n    }\n\n    /**\n     * Fire weapon\n     */\n    fireWeapon(): void {\n        if (this.input.isActionPressed()) {\n            // Calculate projectile spawn position (front of ship)\n            const spawnOffset = 25;\n            const spawnX = this.physicsObject.position.x + Math.cos(this.rotation - Math.PI / 2) * spawnOffset;\n            const spawnY = this.physicsObject.position.y + Math.sin(this.rotation - Math.PI / 2) * spawnOffset;\n            \n            // Calculate projectile velocity\n            const projectileSpeed = 800;\n            const projectileVelocity: Vector2 = {\n                x: Math.cos(this.rotation - Math.PI / 2) * projectileSpeed + this.physicsObject.velocity.x,\n                y: Math.sin(this.rotation - Math.PI / 2) * projectileSpeed + this.physicsObject.velocity.y\n            };\n            \n            // Create projectile\n            const projectile = this.physics.createProjectile(\n                `projectile_${Date.now()}`,\n                { x: spawnX, y: spawnY },\n                projectileVelocity\n            );\n            \n            // Add projectile to physics\n            this.physics.addObject(projectile);\n            \n            // Play laser sound\n            this.audio.playLaserSound(this.physicsObject.position);\n            \n            this.logger.debug('Weapon fired');\n        }\n    }\n\n    /**\n     * Destroy the ship\n     */\n    private destroy(): void {\n        this.logger.warn('Ship destroyed!');\n        \n        // Play explosion sound\n        this.audio.playExplosion(this.physicsObject.position);\n        \n        // Stop engine sound\n        if (this.engineSoundId) {\n            this.audio.stopSound(this.engineSoundId);\n            this.engineSoundId = null;\n        }\n        \n        // Remove from physics simulation\n        this.physics.removeObject(this.physicsObject.id);\n    }\n\n    /**\n     * Render thrust particles\n     */\n    renderThrustParticles(renderer: any): void {\n        this.thrustParticles.forEach(particle => {\n            const alpha = particle.life / particle.maxLife;\n            const color = {\n                r: 255,\n                g: Math.floor(255 * alpha),\n                b: 0,\n                a: Math.floor(255 * alpha)\n            };\n            \n            renderer.setPixel(\n                Math.floor(particle.position.x),\n                Math.floor(particle.position.y),\n                color\n            );\n        });\n    }\n\n    /**\n     * Get ship data for UI display\n     */\n    getShipData() {\n        return {\n            position: { ...this.physicsObject.position },\n            velocity: { ...this.physicsObject.velocity },\n            rotation: this.rotation,\n            health: this.physicsObject.health || 0,\n            fuel: this.currentFuel,\n            thrustLevel: this.thrustLevel,\n            maxHealth: this.stats.maxHealth,\n            maxFuel: this.stats.maxFuel\n        };\n    }\n\n    /**\n     * Get physics object for external access\n     */\n    getPhysicsObject(): PhysicsObject {\n        return this.physicsObject;\n    }\n\n    /**\n     * Get current position\n     */\n    getPosition(): Vector2 {\n        return { ...this.physicsObject.position };\n    }\n\n    /**\n     * Get current velocity\n     */\n    getVelocity(): Vector2 {\n        return { ...this.physicsObject.velocity };\n    }\n\n    /**\n     * Get current rotation in radians\n     */\n    getRotation(): number {\n        return this.rotation;\n    }\n\n    /**\n     * Check if ship is alive\n     */\n    isAlive(): boolean {\n        return this.shipSystems.getStatus().hull > 0;\n    }\n    \n    /**\n     * Get ship systems status\n     */\n    getSystemStatus(): SystemStatus {\n        return this.shipSystems.getStatus();\n    }\n    \n    /**\n     * Get ship systems instance\n     */\n    getShipSystems(): ShipSystems {\n        return this.shipSystems;\n    }\n    \n    /**\n     * Apply damage to ship systems\n     */\n    applyDamage(amount: number, section: ShipSection = ShipSection.Core, damageType: 'kinetic' | 'energy' | 'thermal' = 'kinetic'): void {\n        this.shipSystems.applyDamage(section, amount, damageType);\n        \n        // Update physics object health\n        this.physicsObject.health = this.shipSystems.getStatus().hull;\n    }\n    \n    /**\n     * Set power allocation\n     */\n    setPowerAllocation(allocation: Partial<PowerAllocation>): void {\n        this.shipSystems.setPowerAllocation(allocation);\n    }\n    \n    /**\n     * Toggle ship system\n     */\n    toggleSystem(system: SystemType, state?: boolean): void {\n        this.shipSystems.toggleSystem(system, state);\n    }\n    \n    /**\n     * Get warp drive instance\n     */\n    getWarpDrive(): WarpDrive {\n        return this.warpDrive;\n    }\n    \n    /**\n     * Check if warp is active\n     */\n    isWarpActive(): boolean {\n        return this.warpDrive.isWarpActive();\n    }\n    \n    /**\n     * Get warp state\n     */\n    getWarpState(): WarpState {\n        return this.warpDrive.getState();\n    }\n    \n    /**\n     * Render warp effects\n     */\n    renderWarpEffects(renderer: any): void {\n        this.warpDrive.render(renderer);\n    }\n\n    /**\n     * Cleanup\n     */\n    cleanup(): void {\n        // Stop engine sound\n        if (this.engineSoundId) {\n            this.audio.stopSound(this.engineSoundId);\n        }\n        \n        // Remove from physics\n        this.physics.removeObject(this.physicsObject.id);\n        \n        this.logger.info('🧹 Player ship cleanup completed');\n    }\n}\n\n// Thrust particle interface\ninterface ThrustParticle {\n    position: Vector2;\n    velocity: Vector2;\n    life: number;\n    maxLife: number;\n}","/**\n * Galaxy Generation Engine\n * Creates realistic spiral galaxies with procedural star systems\n */\n\nimport { Vector2 } from '@core/Renderer';\nimport { Logger } from '@utils/Logger';\n\nexport interface GalaxyConfig {\n    seed: number;\n    size: number; // Galaxy radius in light years\n    starCount: number;\n    spiralArms: number;\n    armTightness: number; // How tightly wound the spiral arms are\n    coreSize: number; // Size of the galactic core\n    starDensity: number; // Stars per cubic light year\n}\n\nexport interface StarData {\n    id: string;\n    name: string;\n    position: Vector2; // Position in galaxy (light years)\n    type: StarType;\n    mass: number; // Solar masses\n    luminosity: number; // Solar luminosities\n    temperature: number; // Kelvin\n    age: number; // Million years\n    metallicity: number; // 0-1, higher = more heavy elements\n    \n    // Visual properties\n    color: { r: number; g: number; b: number };\n    brightness: number; // 0-1 for rendering\n    radius: number; // Solar radii\n}\n\nexport interface PlanetData {\n    id: string;\n    name: string;\n    starId: string;\n    orbitDistance: number; // AU from star\n    orbitPeriod: number; // Days\n    radius: number; // Earth radii\n    mass: number; // Earth masses\n    type: PlanetType;\n    temperature: number; // Kelvin\n    hasAtmosphere: boolean;\n    atmosphereType?: AtmosphereType;\n    hasRings: boolean;\n    moons: MoonData[];\n    \n    // Surface properties\n    surfaceType: SurfaceType;\n    surfaceColor: { r: number; g: number; b: number };\n    hasWater: boolean;\n    hasLife: boolean;\n}\n\nexport interface MoonData {\n    id: string;\n    name: string;\n    planetId: string;\n    orbitDistance: number; // Planet radii\n    orbitPeriod: number; // Hours\n    radius: number; // Earth radii\n    mass: number; // Earth masses\n    type: 'rocky' | 'icy' | 'captured_asteroid';\n    tidallyLocked: boolean;\n}\n\nexport interface StarSystemData {\n    id: string;\n    name: string;\n    position: Vector2;\n    star: StarData;\n    planets: PlanetData[];\n    asteroidBelts: AsteroidBeltData[];\n    \n    // System properties\n    habitableZoneInner: number; // AU\n    habitableZoneOuter: number; // AU\n    systemAge: number; // Million years\n    metallicity: number;\n    \n    // Generated objects\n    stations?: SpaceStationData[];\n    anomalies?: AnomalyData[];\n}\n\nexport enum StarType {\n    O = 'O', // Blue supergiant\n    B = 'B', // Blue giant\n    A = 'A', // White\n    F = 'F', // Yellow-white\n    G = 'G', // Yellow (like Sun)\n    K = 'K', // Orange\n    M = 'M', // Red dwarf\n    WD = 'WD', // White dwarf\n    NS = 'NS', // Neutron star\n    BH = 'BH'  // Black hole\n}\n\nexport enum PlanetType {\n    Terrestrial = 'terrestrial',\n    GasGiant = 'gas_giant',\n    IceGiant = 'ice_giant',\n    Desert = 'desert',\n    Ocean = 'ocean',\n    Volcanic = 'volcanic',\n    Frozen = 'frozen',\n    Toxic = 'toxic'\n}\n\nexport enum SurfaceType {\n    Rocky = 'rocky',\n    Desert = 'desert',\n    Ocean = 'ocean',\n    Ice = 'ice',\n    Lava = 'lava',\n    Gas = 'gas',\n    Toxic = 'toxic',\n    Crystalline = 'crystalline'\n}\n\nexport enum AtmosphereType {\n    None = 'none',\n    Thin = 'thin',\n    Thick = 'thick',\n    Toxic = 'toxic',\n    Methane = 'methane',\n    Hydrogen = 'hydrogen',\n    CarbonDioxide = 'carbon_dioxide'\n}\n\ninterface AsteroidBeltData {\n    id: string;\n    innerRadius: number; // AU\n    outerRadius: number; // AU\n    density: number; // 0-1\n    composition: 'rocky' | 'metallic' | 'icy';\n}\n\ninterface SpaceStationData {\n    id: string;\n    name: string;\n    position: Vector2;\n    type: 'trading' | 'mining' | 'research' | 'military' | 'abandoned';\n    faction: string;\n    population: number;\n}\n\ninterface AnomalyData {\n    id: string;\n    name: string;\n    position: Vector2;\n    type: 'wormhole' | 'nebula' | 'supernova_remnant' | 'dark_matter' | 'ancient_artifact';\n    strength: number; // 0-1\n}\n\nexport class GalaxyGenerator {\n    private config: GalaxyConfig;\n    private random: SeededRandom;\n    private logger: Logger;\n    \n    // Galaxy data\n    private stars: Map<string, StarData> = new Map();\n    private starSystems: Map<string, StarSystemData> = new Map();\n    private galaxyMap: StarData[] = [];\n\n    constructor(config: Partial<GalaxyConfig> = {}) {\n        this.logger = new Logger('GalaxyGenerator');\n        \n        // Default galaxy configuration\n        this.config = {\n            seed: 42,\n            size: 50000, // 50,000 light years radius\n            starCount: 50, // Reduced for web performance\n            spiralArms: 4,\n            armTightness: 0.3,\n            coreSize: 5000, // 5,000 light years\n            starDensity: 0.1,\n            ...config\n        };\n        \n        this.random = new SeededRandom(this.config.seed);\n        \n        this.logger.info('🌌 Galaxy generator initialized', {\n            seed: this.config.seed,\n            size: this.config.size,\n            starCount: this.config.starCount\n        });\n    }\n\n    /**\n     * Generate the entire galaxy\n     */\n    async generateGalaxy(progressCallback?: (progress: number, message: string) => void): Promise<void> {\n        this.logger.info('🔄 Generating galaxy...');\n        \n        const startTime = performance.now();\n        \n        try {\n            // Generate star positions using spiral galaxy model\n            progressCallback?.(10, 'Creating star positions...');\n            this.generateStarPositions();\n            \n            // Generate star properties\n            progressCallback?.(30, 'Calculating stellar properties...');\n            this.generateStarProperties();\n            \n            // Generate star systems (planets, moons, etc.)\n            progressCallback?.(50, 'Generating planetary systems...');\n            await this.generateStarSystems(progressCallback);\n            \n            // Generate special objects and anomalies\n            progressCallback?.(90, 'Adding cosmic anomalies...');\n            this.generateAnomalies();\n            \n            progressCallback?.(100, 'Galaxy generation complete!');\n            \n            const endTime = performance.now();\n            this.logger.info(`✅ Galaxy generated in ${(endTime - startTime).toFixed(2)}ms`, {\n                stars: this.stars.size,\n                systems: this.starSystems.size\n            });\n            \n        } catch (error) {\n            this.logger.error('❌ Galaxy generation failed', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Generate star positions using spiral galaxy model\n     */\n    private generateStarPositions(): void {\n        this.logger.debug('Generating star positions...');\n        \n        for (let i = 0; i < this.config.starCount; i++) {\n            const position = this.generateSpiralPosition(i);\n            const starId = `star_${i.toString().padStart(4, '0')}`;\n            \n            // Create basic star data (properties will be added later)\n            const star: StarData = {\n                id: starId,\n                name: this.generateStarName(i),\n                position: position,\n                type: StarType.G, // Will be determined later\n                mass: 1.0,\n                luminosity: 1.0,\n                temperature: 5778,\n                age: 4600,\n                metallicity: 0.02,\n                color: { r: 255, g: 255, b: 255 },\n                brightness: 1.0,\n                radius: 1.0\n            };\n            \n            this.stars.set(starId, star);\n            this.galaxyMap.push(star);\n        }\n        \n        this.logger.debug(`Generated ${this.stars.size} star positions`);\n    }\n\n    /**\n     * Generate position using spiral galaxy model\n     */\n    private generateSpiralPosition(index: number): Vector2 {\n        // Distance from galactic center (0 = center, 1 = edge)\n        const normalizedRadius = Math.pow(this.random.next(), 0.7); // Power law distribution\n        const radius = normalizedRadius * this.config.size;\n        \n        // Determine which spiral arm\n        const armIndex = Math.floor(this.random.next() * this.config.spiralArms);\n        const armAngleOffset = (armIndex * 2 * Math.PI) / this.config.spiralArms;\n        \n        // Spiral angle based on distance from center\n        const spiralAngle = armAngleOffset + normalizedRadius * this.config.armTightness * 4 * Math.PI;\n        \n        // Add some random offset to make it less perfect\n        const angleNoise = (this.random.next() - 0.5) * 0.5;\n        const radiusNoise = (this.random.next() - 0.5) * 0.2 * radius;\n        \n        const finalAngle = spiralAngle + angleNoise;\n        const finalRadius = Math.max(0, radius + radiusNoise);\n        \n        return {\n            x: Math.cos(finalAngle) * finalRadius,\n            y: Math.sin(finalAngle) * finalRadius\n        };\n    }\n\n    /**\n     * Generate star names using procedural naming\n     */\n    private generateStarName(index: number): string {\n        const prefixes = ['Alpha', 'Beta', 'Gamma', 'Delta', 'Epsilon', 'Zeta', 'Eta', 'Theta', 'Iota', 'Kappa'];\n        const suffixes = ['Centauri', 'Draconis', 'Lyrae', 'Cygni', 'Aquilae', 'Orionis', 'Ursae', 'Cassiopeiae'];\n        \n        const prefix = prefixes[index % prefixes.length];\n        const suffix = suffixes[Math.floor(index / prefixes.length) % suffixes.length];\n        const number = Math.floor(index / (prefixes.length * suffixes.length)) + 1;\n        \n        return number > 1 ? `${prefix} ${suffix} ${number}` : `${prefix} ${suffix}`;\n    }\n\n    /**\n     * Generate star properties based on stellar evolution\n     */\n    private generateStarProperties(): void {\n        this.logger.debug('Generating star properties...');\n        \n        for (const star of this.stars.values()) {\n            // Determine star type based on galactic position and random factors\n            const distanceFromCore = Math.sqrt(star.position.x ** 2 + star.position.y ** 2);\n            const coreInfluence = Math.max(0, 1 - distanceFromCore / this.config.coreSize);\n            \n            // Metallicity increases closer to galactic center\n            star.metallicity = Math.max(0.001, 0.02 * (0.5 + coreInfluence * 0.5) * this.random.range(0.5, 1.5));\n            \n            // Generate stellar mass (affects everything else)\n            star.mass = this.generateStellarMass();\n            \n            // Determine star type from mass\n            star.type = this.getStarTypeFromMass(star.mass);\n            \n            // Calculate other properties\n            star.luminosity = this.calculateLuminosity(star.mass, star.type);\n            star.temperature = this.calculateTemperature(star.mass, star.type);\n            star.radius = this.calculateRadius(star.mass, star.luminosity, star.temperature);\n            star.age = this.generateStellarAge(star.mass, star.type);\n            \n            // Visual properties\n            star.color = this.getStarColor(star.temperature);\n            star.brightness = Math.min(1.0, star.luminosity / 100); // Scale for visibility\n        }\n        \n        this.logger.debug('Star properties generated');\n    }\n\n    /**\n     * Generate stellar mass using realistic distribution\n     */\n    private generateStellarMass(): number {\n        // Salpeter initial mass function approximation\n        const x = this.random.next();\n        if (x < 0.8) {\n            // Low mass stars (0.1 - 0.8 solar masses)\n            return 0.1 + (0.7 * Math.pow(x / 0.8, 2));\n        } else if (x < 0.95) {\n            // Medium mass stars (0.8 - 3 solar masses)\n            return 0.8 + (2.2 * Math.pow((x - 0.8) / 0.15, 1.5));\n        } else {\n            // High mass stars (3 - 50 solar masses)\n            return 3 + (47 * Math.pow((x - 0.95) / 0.05, 3));\n        }\n    }\n\n    /**\n     * Determine star type from mass\n     */\n    private getStarTypeFromMass(mass: number): StarType {\n        if (mass > 30) return StarType.O;\n        if (mass > 10) return StarType.B;\n        if (mass > 2.5) return StarType.A;\n        if (mass > 1.4) return StarType.F;\n        if (mass > 0.8) return StarType.G;\n        if (mass > 0.5) return StarType.K;\n        return StarType.M;\n    }\n\n    /**\n     * Calculate luminosity from mass and type\n     */\n    private calculateLuminosity(mass: number, type: StarType): number {\n        // Mass-luminosity relation: L ∝ M^α\n        let alpha = 3.5; // Default for main sequence\n        \n        switch (type) {\n            case StarType.O:\n            case StarType.B:\n                alpha = 4.0;\n                break;\n            case StarType.A:\n            case StarType.F:\n                alpha = 3.5;\n                break;\n            case StarType.G:\n                alpha = 4.0;\n                break;\n            case StarType.K:\n            case StarType.M:\n                alpha = 2.3;\n                break;\n        }\n        \n        return Math.pow(mass, alpha);\n    }\n\n    /**\n     * Calculate temperature from mass and type\n     */\n    private calculateTemperature(mass: number, type: StarType): number {\n        const baseTemps = {\n            [StarType.O]: 35000,\n            [StarType.B]: 20000,\n            [StarType.A]: 8500,\n            [StarType.F]: 6500,\n            [StarType.G]: 5500,\n            [StarType.K]: 4000,\n            [StarType.M]: 3000\n        };\n        \n        const baseTemp = (baseTemps as any)[type] || 5500;\n        return baseTemp * this.random.range(0.9, 1.1);\n    }\n\n    /**\n     * Calculate radius from mass, luminosity, and temperature\n     */\n    private calculateRadius(mass: number, luminosity: number, temperature: number): number {\n        // Stefan-Boltzmann law: L = 4πR²σT⁴\n        // R ∝ √(L/T⁴)\n        const solarTemp = 5778;\n        return Math.sqrt(luminosity) * Math.pow(solarTemp / temperature, 2);\n    }\n\n    /**\n     * Generate stellar age\n     */\n    private generateStellarAge(mass: number, type: StarType): number {\n        // Main sequence lifetime ∝ M/L ∝ M^(-2.5)\n        const solarLifetime = 10000; // Million years\n        const lifetime = solarLifetime * Math.pow(mass, -2.5);\n        \n        // Random age between 0 and lifetime\n        return this.random.next() * lifetime;\n    }\n\n    /**\n     * Get star color from temperature\n     */\n    private getStarColor(temperature: number): { r: number; g: number; b: number } {\n        // Simplified blackbody color approximation\n        if (temperature > 25000) return { r: 155, g: 176, b: 255 }; // Blue\n        if (temperature > 10000) return { r: 202, g: 215, b: 255 }; // Blue-white\n        if (temperature > 7500) return { r: 248, g: 247, b: 255 };  // White\n        if (temperature > 6000) return { r: 255, g: 244, b: 234 };  // Yellow-white\n        if (temperature > 5000) return { r: 255, g: 214, b: 170 };  // Yellow\n        if (temperature > 3500) return { r: 255, g: 204, b: 111 };  // Orange\n        return { r: 255, g: 204, b: 111 }; // Red\n    }\n\n    /**\n     * Generate complete star systems\n     */\n    private async generateStarSystems(progressCallback?: (progress: number, message: string) => void): Promise<void> {\n        this.logger.debug('Generating star systems...');\n        \n        let systemCount = 0;\n        const stars = Array.from(this.stars.values());\n        \n        // Use larger batch size but with async yielding for better performance\n        const batchSize = Math.max(10, Math.floor(stars.length / 20)); // Dynamic batch size\n        \n        for (let i = 0; i < stars.length; i += batchSize) {\n            const batch = stars.slice(i, i + batchSize);\n            \n            // Process batch synchronously for speed, but yield periodically\n            for (const star of batch) {\n                // Not all stars have planetary systems\n                if (this.random.next() < 0.6) { // Reduced to 60% for faster generation\n                    const system = this.generateStarSystemSync(star); // Use sync version for speed\n                    this.starSystems.set(star.id, system);\n                    systemCount++;\n                }\n            }\n            \n            // Yield control periodically to prevent blocking (less frequently for speed)\n            if (i % (batchSize * 10) === 0) {\n                await new Promise(resolve => setTimeout(resolve, 0));\n            }\n            \n            // Update progress\n            const progress = 50 + Math.floor((i / stars.length) * 35); // 50-85% range\n            progressCallback?.(progress, `Generated ${systemCount} star systems...`);\n        }\n        \n        this.logger.debug(`Generated ${systemCount} star systems`);\n    }\n\n    /**\n     * Generate a single star system (synchronous version for performance)\n     */\n    private generateStarSystemSync(star: StarData): StarSystemData {\n        return this.generateStarSystemInternal(star);\n    }\n\n    /**\n     * Generate a single star system\n     */\n    private async generateStarSystem(star: StarData): Promise<StarSystemData> {\n        return this.generateStarSystemInternal(star);\n    }\n\n    /**\n     * Internal star system generation logic\n     */\n    private generateStarSystemInternal(star: StarData): StarSystemData {\n        const system: StarSystemData = {\n            id: star.id,\n            name: `${star.name} System`,\n            position: star.position,\n            star: star,\n            planets: [],\n            asteroidBelts: [],\n            habitableZoneInner: 0,\n            habitableZoneOuter: 0,\n            systemAge: star.age,\n            metallicity: star.metallicity\n        };\n        \n        // Calculate habitable zone\n        const luminosity = star.luminosity;\n        system.habitableZoneInner = Math.sqrt(luminosity / 1.1);\n        system.habitableZoneOuter = Math.sqrt(luminosity / 0.53);\n        \n        // Generate planets\n        const planetCount = Math.floor(this.random.range(0, 8));\n        let currentOrbit = this.random.range(0.1, 0.5); // Start close to star\n        \n        for (let i = 0; i < planetCount; i++) {\n            const planet = this.generatePlanet(star, system, i, currentOrbit);\n            system.planets.push(planet);\n            \n            // Space out orbits realistically\n            currentOrbit *= this.random.range(1.4, 2.0);\n        }\n        \n        // Generate asteroid belts\n        if (this.random.next() < 0.3) { // 30% chance\n            system.asteroidBelts.push({\n                id: `${star.id}_belt_1`,\n                innerRadius: currentOrbit,\n                outerRadius: currentOrbit * 1.5,\n                density: this.random.range(0.3, 0.8),\n                composition: this.random.choice(['rocky', 'metallic', 'icy'])\n            });\n        }\n        \n        return system;\n    }\n\n    /**\n     * Generate a planet\n     */\n    private generatePlanet(star: StarData, system: StarSystemData, index: number, orbitDistance: number): PlanetData {\n        const planetId = `${star.id}_planet_${index}`;\n        \n        // Determine planet type based on distance from star\n        let planetType: PlanetType;\n        if (orbitDistance < system.habitableZoneInner * 0.5) {\n            planetType = PlanetType.Volcanic;\n        } else if (orbitDistance > system.habitableZoneOuter * 2) {\n            planetType = this.random.choice([PlanetType.GasGiant, PlanetType.IceGiant, PlanetType.Frozen]);\n        } else if (orbitDistance >= system.habitableZoneInner && orbitDistance <= system.habitableZoneOuter) {\n            planetType = this.random.choice([PlanetType.Terrestrial, PlanetType.Ocean, PlanetType.Desert]);\n        } else {\n            planetType = this.random.choice([PlanetType.Terrestrial, PlanetType.Desert, PlanetType.Frozen]);\n        }\n        \n        // Calculate planet properties\n        const mass = this.generatePlanetMass(planetType);\n        const radius = this.calculatePlanetRadius(mass, planetType);\n        const temperature = this.calculatePlanetTemperature(star, orbitDistance);\n        \n        const planet: PlanetData = {\n            id: planetId,\n            name: `${star.name} ${this.numberToRoman(index + 1)}`,\n            starId: star.id,\n            orbitDistance: orbitDistance,\n            orbitPeriod: this.calculateOrbitPeriod(orbitDistance, star.mass),\n            radius: radius,\n            mass: mass,\n            type: planetType,\n            temperature: temperature,\n            hasAtmosphere: this.determineAtmosphere(planetType, mass, temperature),\n            hasRings: this.random.next() < 0.1, // 10% chance\n            moons: [],\n            surfaceType: this.determineSurfaceType(planetType, temperature),\n            surfaceColor: this.generateSurfaceColor(planetType),\n            hasWater: temperature > 273 && temperature < 373 && planetType !== PlanetType.GasGiant,\n            hasLife: false // Will be determined later\n        };\n        \n        // Determine atmosphere type\n        if (planet.hasAtmosphere) {\n            planet.atmosphereType = this.determineAtmosphereType(planetType, temperature);\n        }\n        \n        // Generate moons\n        const moonCount = this.generateMoonCount(planetType, mass);\n        for (let j = 0; j < moonCount; j++) {\n            planet.moons.push(this.generateMoon(planet, j));\n        }\n        \n        return planet;\n    }\n\n    /**\n     * Generate planet mass based on type\n     */\n    private generatePlanetMass(type: PlanetType): number {\n        switch (type) {\n            case PlanetType.GasGiant:\n                return this.random.range(50, 500); // Earth masses\n            case PlanetType.IceGiant:\n                return this.random.range(10, 50);\n            case PlanetType.Terrestrial:\n            case PlanetType.Ocean:\n            case PlanetType.Desert:\n            case PlanetType.Volcanic:\n            case PlanetType.Frozen:\n            case PlanetType.Toxic:\n                return this.random.range(0.1, 3.0);\n            default:\n                return 1.0;\n        }\n    }\n\n    /**\n     * Calculate planet radius from mass and type\n     */\n    private calculatePlanetRadius(mass: number, type: PlanetType): number {\n        if (type === PlanetType.GasGiant || type === PlanetType.IceGiant) {\n            return Math.pow(mass, 0.27); // Gas giants have different mass-radius relation\n        } else {\n            return Math.pow(mass, 0.27); // Rocky planets\n        }\n    }\n\n    /**\n     * Calculate planet temperature\n     */\n    private calculatePlanetTemperature(star: StarData, distance: number): number {\n        // Simplified temperature calculation\n        const solarConstant = star.luminosity / (distance * distance);\n        const baseTemp = 278.5 * Math.pow(solarConstant, 0.25); // Effective temperature\n        \n        // Add some randomness for atmosphere effects\n        return baseTemp * this.random.range(0.8, 1.2);\n    }\n\n    /**\n     * Calculate orbit period using Kepler's laws\n     */\n    private calculateOrbitPeriod(distance: number, starMass: number): number {\n        // T² ∝ a³/M (in Earth years)\n        return Math.sqrt(Math.pow(distance, 3) / starMass) * 365.25; // Convert to days\n    }\n\n    /**\n     * Generate other helper methods...\n     */\n    private determineAtmosphere(type: PlanetType, mass: number, temperature: number): boolean {\n        if (type === PlanetType.GasGiant || type === PlanetType.IceGiant) return true;\n        if (mass < 0.1) return false; // Too small to hold atmosphere\n        if (temperature > 2000) return false; // Too hot\n        return this.random.next() < 0.7;\n    }\n\n    private determineSurfaceType(type: PlanetType, temperature: number): SurfaceType {\n        switch (type) {\n            case PlanetType.Ocean: return SurfaceType.Ocean;\n            case PlanetType.Desert: return SurfaceType.Desert;\n            case PlanetType.Volcanic: return SurfaceType.Lava;\n            case PlanetType.Frozen: return SurfaceType.Ice;\n            case PlanetType.GasGiant:\n            case PlanetType.IceGiant: return SurfaceType.Gas;\n            case PlanetType.Toxic: return SurfaceType.Toxic;\n            default: return SurfaceType.Rocky;\n        }\n    }\n\n    private generateSurfaceColor(type: PlanetType): { r: number; g: number; b: number } {\n        switch (type) {\n            case PlanetType.Ocean: return { r: 0, g: 100, b: 200 };\n            case PlanetType.Desert: return { r: 200, g: 150, b: 100 };\n            case PlanetType.Volcanic: return { r: 150, g: 50, b: 0 };\n            case PlanetType.Frozen: return { r: 200, g: 220, b: 255 };\n            case PlanetType.GasGiant: return { r: 180, g: 140, b: 100 };\n            case PlanetType.IceGiant: return { r: 100, g: 150, b: 200 };\n            case PlanetType.Toxic: return { r: 100, g: 150, b: 50 };\n            default: return { r: 120, g: 100, b: 80 };\n        }\n    }\n\n    private determineAtmosphereType(type: PlanetType, temperature: number): AtmosphereType {\n        if (temperature > 1000) return AtmosphereType.Toxic;\n        if (type === PlanetType.GasGiant) return AtmosphereType.Hydrogen;\n        if (type === PlanetType.IceGiant) return AtmosphereType.Methane;\n        if (temperature < 200) return AtmosphereType.Thin;\n        return AtmosphereType.CarbonDioxide;\n    }\n\n    private generateMoonCount(planetType: PlanetType, mass: number): number {\n        if (planetType === PlanetType.GasGiant) return Math.floor(this.random.range(5, 20));\n        if (planetType === PlanetType.IceGiant) return Math.floor(this.random.range(2, 10));\n        if (mass > 1.0) return Math.floor(this.random.range(0, 3));\n        return this.random.next() < 0.3 ? 1 : 0;\n    }\n\n    private generateMoon(planet: PlanetData, index: number): MoonData {\n        return {\n            id: `${planet.id}_moon_${index}`,\n            name: `${planet.name} ${String.fromCharCode(97 + index)}`, // a, b, c...\n            planetId: planet.id,\n            orbitDistance: this.random.range(3, 20), // Planet radii\n            orbitPeriod: this.random.range(12, 168), // Hours\n            radius: this.random.range(0.1, 0.5), // Earth radii\n            mass: this.random.range(0.01, 0.2), // Earth masses\n            type: this.random.choice(['rocky', 'icy', 'captured_asteroid']),\n            tidallyLocked: this.random.next() < 0.8\n        };\n    }\n\n    private generateAnomalies(): void {\n        // Generate special objects and anomalies\n        // This will be implemented based on specific game requirements\n    }\n\n    private numberToRoman(num: number): string {\n        const values = [10, 9, 5, 4, 1];\n        const symbols = ['X', 'IX', 'V', 'IV', 'I'];\n        let result = '';\n        \n        for (let i = 0; i < values.length; i++) {\n            while (num >= values[i]) {\n                result += symbols[i];\n                num -= values[i];\n            }\n        }\n        return result;\n    }\n\n    /**\n     * Public API methods\n     */\n    getStarsInRadius(center: Vector2, radius: number): StarData[] {\n        return this.galaxyMap.filter(star => {\n            const distance = Math.sqrt(\n                Math.pow(star.position.x - center.x, 2) + \n                Math.pow(star.position.y - center.y, 2)\n            );\n            return distance <= radius;\n        });\n    }\n\n    getStarSystem(starId: string): StarSystemData | undefined {\n        return this.starSystems.get(starId);\n    }\n\n    getAllStars(): StarData[] {\n        return [...this.galaxyMap];\n    }\n\n    getAllSystems(): StarSystemData[] {\n        return Array.from(this.starSystems.values());\n    }\n\n    getGalaxyConfig(): GalaxyConfig {\n        return { ...this.config };\n    }\n}\n\n/**\n * Seeded random number generator for consistent generation\n */\nclass SeededRandom {\n    private seed: number;\n\n    constructor(seed: number) {\n        this.seed = seed;\n    }\n\n    next(): number {\n        this.seed = (this.seed * 9301 + 49297) % 233280;\n        return this.seed / 233280;\n    }\n\n    range(min: number, max: number): number {\n        return min + this.next() * (max - min);\n    }\n\n    choice<T>(array: T[]): T {\n        return array[Math.floor(this.next() * array.length)];\n    }\n\n    integer(min: number, max: number): number {\n        return Math.floor(this.range(min, max + 1));\n    }\n}","/**\n * Galaxy Persistence System\n * Handles saving and loading of galaxy data with compression and chunked loading\n */\n\nimport { Logger } from '@utils/Logger';\nimport { \n    GalaxyConfig, \n    StarData, \n    StarSystemData, \n    PlanetData,\n    GalaxyGenerator \n} from './GalaxyGenerator';\nimport { Vector2 } from '@core/Renderer';\nimport { Platform, PlatformDetector } from '@utils/Platform';\n\nexport interface GalaxySaveData {\n    version: string;\n    timestamp: number;\n    config: GalaxyConfig;\n    playerData: PlayerGalaxyData;\n    \n    // Galaxy data\n    stars: CompressedStarData[];\n    systems: CompressedSystemData[];\n    \n    // Discovery and exploration data\n    exploredSystems: string[];\n    discoveredPlanets: string[];\n    visitedLocations: VisitedLocation[];\n    \n    // Player progression in galaxy\n    reputation: Map<string, number>; // Faction reputation\n    tradeRoutes: TradeRoute[];\n}\n\nexport interface PlayerGalaxyData {\n    currentSystemId: string;\n    homeSystemId: string;\n    totalSystemsVisited: number;\n    totalPlanetsExplored: number;\n    totalDistanceTraveled: number; // Light years\n    galaxyDiscoveryProgress: number; // 0-1\n}\n\nexport interface CompressedStarData {\n    id: string;\n    name: string;\n    pos: [number, number]; // [x, y] position\n    type: string; // StarType\n    mass: number;\n    temp: number; // Temperature\n    color: [number, number, number]; // [r, g, b]\n}\n\nexport interface CompressedSystemData {\n    id: string;\n    planets: CompressedPlanetData[];\n    explored: boolean;\n    lastVisited?: number; // Timestamp\n}\n\nexport interface CompressedPlanetData {\n    id: string;\n    name: string;\n    type: string; // PlanetType\n    orbit: number; // Orbit distance\n    radius: number;\n    temp: number; // Temperature\n    hasAtmo: boolean;\n    moons: number; // Moon count\n    color: [number, number, number]; // [r, g, b]\n}\n\nexport interface VisitedLocation {\n    systemId: string;\n    planetId?: string;\n    timestamp: number;\n    coordinates: Vector2;\n    notes?: string;\n}\n\nexport interface TradeRoute {\n    id: string;\n    fromSystemId: string;\n    toSystemId: string;\n    commodity: string;\n    profitMargin: number;\n    discovered: boolean;\n}\n\nexport interface ChunkLoadOptions {\n    center: Vector2;\n    radius: number;\n    maxSystems: number;\n    includeUnexplored: boolean;\n}\n\nexport class GalaxyPersistence {\n    private platform: Platform;\n    private logger: Logger;\n    \n    // Cached data for performance\n    private cachedSaveData: GalaxySaveData | null = null;\n    private loadedChunks: Map<string, StarSystemData[]> = new Map();\n    private compressionEnabled: boolean;\n\n    constructor() {\n        this.platform = PlatformDetector.detect();\n        this.logger = new Logger('GalaxyPersistence');\n        this.compressionEnabled = true; // Enable compression by default\n        \n        this.logger.info('💾 Galaxy persistence system initialized', {\n            platform: this.platform,\n            compressionEnabled: this.compressionEnabled\n        });\n    }\n\n    /**\n     * Save complete galaxy data\n     */\n    async saveGalaxy(\n        generator: GalaxyGenerator,\n        playerData: PlayerGalaxyData,\n        explorationData: {\n            exploredSystems: string[];\n            discoveredPlanets: string[];\n            visitedLocations: VisitedLocation[];\n        }\n    ): Promise<void> {\n        this.logger.info('💾 Saving galaxy data...');\n        \n        const startTime = performance.now();\n        \n        try {\n            // Prepare save data\n            const saveData: GalaxySaveData = {\n                version: '2.0.0',\n                timestamp: Date.now(),\n                config: generator.getGalaxyConfig(),\n                playerData: { ...playerData },\n                stars: [],\n                systems: [],\n                exploredSystems: [...explorationData.exploredSystems],\n                discoveredPlanets: [...explorationData.discoveredPlanets],\n                visitedLocations: [...explorationData.visitedLocations],\n                reputation: new Map(),\n                tradeRoutes: []\n            };\n            \n            // Compress galaxy data\n            saveData.stars = this.compressStarData(generator.getAllStars());\n            saveData.systems = this.compressSystemData(generator.getAllSystems());\n            \n            // Cache the save data\n            this.cachedSaveData = saveData;\n            \n            // Save to storage based on platform\n            await this.saveToStorage(saveData);\n            \n            const endTime = performance.now();\n            this.logger.info(`✅ Galaxy saved successfully in ${(endTime - startTime).toFixed(2)}ms`, {\n                stars: saveData.stars.length,\n                systems: saveData.systems.length,\n                size: this.calculateSaveSize(saveData)\n            });\n            \n        } catch (error) {\n            this.logger.error('❌ Failed to save galaxy', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Load complete galaxy data\n     */\n    async loadGalaxy(): Promise<{\n        generator: GalaxyGenerator;\n        playerData: PlayerGalaxyData;\n        explorationData: {\n            exploredSystems: string[];\n            discoveredPlanets: string[];\n            visitedLocations: VisitedLocation[];\n        };\n    } | null> {\n        this.logger.info('📁 Loading galaxy data...');\n        \n        const startTime = performance.now();\n        \n        try {\n            // Load from storage\n            const saveData = await this.loadFromStorage();\n            if (!saveData) {\n                this.logger.info('No galaxy save data found, will create new galaxy');\n                return null;\n            }\n            \n            // Validate save data\n            this.validateSaveData(saveData);\n            \n            // Create generator with saved config\n            const generator = new GalaxyGenerator(saveData.config);\n            \n            // Decompress and restore galaxy data\n            await this.restoreGalaxyData(generator, saveData);\n            \n            const endTime = performance.now();\n            this.logger.info(`✅ Galaxy loaded successfully in ${(endTime - startTime).toFixed(2)}ms`);\n            \n            return {\n                generator,\n                playerData: saveData.playerData,\n                explorationData: {\n                    exploredSystems: saveData.exploredSystems,\n                    discoveredPlanets: saveData.discoveredPlanets,\n                    visitedLocations: saveData.visitedLocations\n                }\n            };\n            \n        } catch (error) {\n            this.logger.error('❌ Failed to load galaxy', error);\n            return null;\n        }\n    }\n\n    /**\n     * Load galaxy chunk for specific region\n     */\n    async loadGalaxyChunk(\n        generator: GalaxyGenerator,\n        options: ChunkLoadOptions\n    ): Promise<StarSystemData[]> {\n        const chunkKey = this.getChunkKey(options.center, options.radius);\n        \n        // Check if chunk is already loaded\n        if (this.loadedChunks.has(chunkKey)) {\n            return this.loadedChunks.get(chunkKey)!;\n        }\n        \n        this.logger.debug(`Loading galaxy chunk: ${chunkKey}`);\n        \n        try {\n            // Get stars in radius\n            const starsInRegion = generator.getStarsInRadius(options.center, options.radius);\n            \n            // Limit to max systems\n            const limitedStars = starsInRegion.slice(0, options.maxSystems);\n            \n            // Load systems for these stars\n            const systems: StarSystemData[] = [];\n            for (const star of limitedStars) {\n                const system = generator.getStarSystem(star.id);\n                if (system) {\n                    // Check if should include unexplored systems\n                    if (options.includeUnexplored || this.isSystemExplored(system.id)) {\n                        systems.push(system);\n                    }\n                }\n            }\n            \n            // Cache the chunk\n            this.loadedChunks.set(chunkKey, systems);\n            \n            this.logger.debug(`Loaded chunk with ${systems.length} systems`);\n            return systems;\n            \n        } catch (error) {\n            this.logger.error(`Failed to load galaxy chunk: ${chunkKey}`, error);\n            return [];\n        }\n    }\n\n    /**\n     * Compress star data for storage\n     */\n    private compressStarData(stars: StarData[]): CompressedStarData[] {\n        return stars.map(star => ({\n            id: star.id,\n            name: star.name,\n            pos: [Math.round(star.position.x), Math.round(star.position.y)],\n            type: star.type,\n            mass: Math.round(star.mass * 100) / 100, // 2 decimal places\n            temp: Math.round(star.temperature),\n            color: [star.color.r, star.color.g, star.color.b]\n        }));\n    }\n\n    /**\n     * Compress system data for storage\n     */\n    private compressSystemData(systems: StarSystemData[]): CompressedSystemData[] {\n        return systems.map(system => ({\n            id: system.id,\n            planets: this.compressPlanetData(system.planets),\n            explored: this.isSystemExplored(system.id)\n        }));\n    }\n\n    /**\n     * Compress planet data for storage\n     */\n    private compressPlanetData(planets: PlanetData[]): CompressedPlanetData[] {\n        return planets.map(planet => ({\n            id: planet.id,\n            name: planet.name,\n            type: planet.type,\n            orbit: Math.round(planet.orbitDistance * 100) / 100,\n            radius: Math.round(planet.radius * 100) / 100,\n            temp: Math.round(planet.temperature),\n            hasAtmo: planet.hasAtmosphere,\n            moons: planet.moons.length,\n            color: [planet.surfaceColor.r, planet.surfaceColor.g, planet.surfaceColor.b]\n        }));\n    }\n\n    /**\n     * Restore galaxy data from compressed format\n     */\n    private async restoreGalaxyData(generator: GalaxyGenerator, saveData: GalaxySaveData): Promise<void> {\n        // Note: This is a simplified restoration process\n        // In a full implementation, we would need to properly reconstruct\n        // the galaxy data structures from compressed format\n        \n        this.logger.debug('Restoring galaxy data from compressed format...');\n        \n        // For now, regenerate the galaxy with the same seed\n        // This ensures consistency while avoiding complex decompression\n        await generator.generateGalaxy();\n        \n        this.logger.debug('Galaxy data restoration completed');\n    }\n\n    /**\n     * Save to storage based on platform\n     */\n    private async saveToStorage(saveData: GalaxySaveData): Promise<void> {\n        const serialized = JSON.stringify(saveData);\n        \n        switch (this.platform) {\n            case Platform.Desktop:\n            case Platform.Web:\n            case Platform.Mobile:\n                // Use localStorage/IndexedDB\n                await this.saveToWebStorage(serialized);\n                break;\n                \n            case Platform.Tauri:\n                // Use file system through Tauri API\n                await this.saveToFileSystem(serialized);\n                break;\n                \n            case Platform.Cordova:\n                // Use Cordova file plugin\n                await this.saveToCordovaFile(serialized);\n                break;\n                \n            default:\n                throw new Error(`Unsupported platform for saving: ${this.platform}`);\n        }\n    }\n\n    /**\n     * Load from storage based on platform\n     */\n    private async loadFromStorage(): Promise<GalaxySaveData | null> {\n        switch (this.platform) {\n            case Platform.Desktop:\n            case Platform.Web:\n            case Platform.Mobile:\n                return await this.loadFromWebStorage();\n                \n            case Platform.Tauri:\n                return await this.loadFromFileSystem();\n                \n            case Platform.Cordova:\n                return await this.loadFromCordovaFile();\n                \n            default:\n                throw new Error(`Unsupported platform for loading: ${this.platform}`);\n        }\n    }\n\n    /**\n     * Save to web storage (localStorage/IndexedDB)\n     */\n    private async saveToWebStorage(data: string): Promise<void> {\n        try {\n            // Try IndexedDB first for larger storage capacity\n            if ('indexedDB' in window) {\n                await this.saveToIndexedDB(data);\n            } else {\n                // Fallback to localStorage\n                localStorage.setItem('spaceExplorer_galaxy', data);\n            }\n        } catch (error) {\n            // If IndexedDB fails, try localStorage\n            try {\n                localStorage.setItem('spaceExplorer_galaxy', data);\n            } catch (localStorageError) {\n                throw new Error('Failed to save to both IndexedDB and localStorage');\n            }\n        }\n    }\n\n    /**\n     * Load from web storage\n     */\n    private async loadFromWebStorage(): Promise<GalaxySaveData | null> {\n        try {\n            // Try IndexedDB first\n            if ('indexedDB' in window) {\n                const data = await this.loadFromIndexedDB();\n                if (data) return data;\n            }\n            \n            // Fallback to localStorage\n            const stored = localStorage.getItem('spaceExplorer_galaxy');\n            return stored ? JSON.parse(stored) : null;\n            \n        } catch (error) {\n            this.logger.error('Failed to load from web storage', error);\n            return null;\n        }\n    }\n\n    /**\n     * Save to IndexedDB for larger storage capacity\n     */\n    private async saveToIndexedDB(data: string): Promise<void> {\n        return new Promise((resolve, reject) => {\n            const request = indexedDB.open('SpaceExplorerDB', 1);\n            \n            request.onerror = () => reject(request.error);\n            \n            request.onupgradeneeded = () => {\n                const db = request.result;\n                if (!db.objectStoreNames.contains('galaxy')) {\n                    db.createObjectStore('galaxy');\n                }\n            };\n            \n            request.onsuccess = () => {\n                const db = request.result;\n                \n                // Check if object store exists before creating transaction\n                if (!db.objectStoreNames.contains('galaxy')) {\n                    this.logger.warn('Galaxy object store not found, skipping save');\n                    resolve();\n                    return;\n                }\n                \n                try {\n                    const transaction = db.transaction(['galaxy'], 'readwrite');\n                    const store = transaction.objectStore('galaxy');\n                    \n                    const putRequest = store.put(data, 'galaxyData');\n                    putRequest.onsuccess = () => resolve();\n                    putRequest.onerror = () => reject(putRequest.error);\n                    \n                    transaction.onerror = () => reject(transaction.error);\n                } catch (error) {\n                    this.logger.error('Transaction failed:', error);\n                    reject(error);\n                }\n            };\n        });\n    }\n\n    /**\n     * Load from IndexedDB\n     */\n    private async loadFromIndexedDB(): Promise<GalaxySaveData | null> {\n        return new Promise((resolve, reject) => {\n            const request = indexedDB.open('SpaceExplorerDB', 1);\n            \n            request.onerror = () => resolve(null);\n            \n            request.onsuccess = () => {\n                const db = request.result;\n                \n                if (!db.objectStoreNames.contains('galaxy')) {\n                    resolve(null);\n                    return;\n                }\n                \n                try {\n                    const transaction = db.transaction(['galaxy'], 'readonly');\n                    const store = transaction.objectStore('galaxy');\n                    \n                    const getRequest = store.get('galaxyData');\n                    getRequest.onsuccess = () => {\n                        try {\n                            const data = getRequest.result;\n                            resolve(data ? JSON.parse(data) : null);\n                        } catch (parseError) {\n                            this.logger.error('Failed to parse galaxy data:', parseError);\n                            resolve(null);\n                        }\n                    };\n                    getRequest.onerror = () => {\n                        this.logger.warn('Failed to get galaxy data:', getRequest.error);\n                        resolve(null);\n                    };\n                    \n                    transaction.onerror = () => {\n                        this.logger.warn('Transaction failed:', transaction.error);\n                        resolve(null);\n                    };\n                } catch (error) {\n                    this.logger.error('Transaction creation failed:', error);\n                    resolve(null);\n                }\n            };\n        });\n    }\n\n    /**\n     * Save to file system (Tauri)\n     */\n    private async saveToFileSystem(data: string): Promise<void> {\n        // Placeholder for Tauri file system API\n        // This would use the Tauri fs API when available\n        this.logger.warn('File system save not implemented yet');\n        throw new Error('File system save not implemented');\n    }\n\n    /**\n     * Load from file system (Tauri)\n     */\n    private async loadFromFileSystem(): Promise<GalaxySaveData | null> {\n        // Placeholder for Tauri file system API\n        this.logger.warn('File system load not implemented yet');\n        return null;\n    }\n\n    /**\n     * Save to Cordova file\n     */\n    private async saveToCordovaFile(data: string): Promise<void> {\n        // Placeholder for Cordova file plugin\n        this.logger.warn('Cordova file save not implemented yet');\n        throw new Error('Cordova file save not implemented');\n    }\n\n    /**\n     * Load from Cordova file\n     */\n    private async loadFromCordovaFile(): Promise<GalaxySaveData | null> {\n        // Placeholder for Cordova file plugin\n        this.logger.warn('Cordova file load not implemented yet');\n        return null;\n    }\n\n    /**\n     * Validate save data integrity\n     */\n    private validateSaveData(saveData: GalaxySaveData): void {\n        if (!saveData.version) {\n            throw new Error('Invalid save data: missing version');\n        }\n        \n        if (!saveData.config || !saveData.stars || !saveData.systems) {\n            throw new Error('Invalid save data: missing core data');\n        }\n        \n        // Version compatibility check\n        const [major] = saveData.version.split('.').map(Number);\n        if (major !== 2) {\n            throw new Error(`Incompatible save version: ${saveData.version}`);\n        }\n    }\n\n    /**\n     * Calculate save data size\n     */\n    private calculateSaveSize(saveData: GalaxySaveData): string {\n        const serialized = JSON.stringify(saveData);\n        const bytes = new Blob([serialized]).size;\n        \n        if (bytes < 1024) return `${bytes} B`;\n        if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;\n        return `${(bytes / (1024 * 1024)).toFixed(1)} MB`;\n    }\n\n    /**\n     * Generate chunk key for caching\n     */\n    private getChunkKey(center: Vector2, radius: number): string {\n        const x = Math.round(center.x / 1000) * 1000;\n        const y = Math.round(center.y / 1000) * 1000;\n        const r = Math.round(radius / 100) * 100;\n        return `chunk_${x}_${y}_${r}`;\n    }\n\n    /**\n     * Check if system is explored\n     */\n    private isSystemExplored(systemId: string): boolean {\n        if (!this.cachedSaveData) return false;\n        return this.cachedSaveData.exploredSystems.includes(systemId);\n    }\n\n    /**\n     * Clear cached data\n     */\n    clearCache(): void {\n        this.cachedSaveData = null;\n        this.loadedChunks.clear();\n        this.logger.debug('Galaxy persistence cache cleared');\n    }\n\n    /**\n     * Get storage statistics\n     */\n    getStorageStats(): {\n        cacheSize: number;\n        loadedChunks: number;\n        lastSaveTime?: number;\n    } {\n        return {\n            cacheSize: this.cachedSaveData ? 1 : 0,\n            loadedChunks: this.loadedChunks.size,\n            lastSaveTime: this.cachedSaveData?.timestamp\n        };\n    }\n\n    /**\n     * Export galaxy data for sharing/backup\n     */\n    async exportGalaxy(): Promise<string> {\n        if (!this.cachedSaveData) {\n            throw new Error('No galaxy data to export');\n        }\n        \n        return JSON.stringify(this.cachedSaveData, null, 2);\n    }\n\n    /**\n     * Import galaxy data from backup\n     */\n    async importGalaxy(data: string): Promise<void> {\n        try {\n            const saveData: GalaxySaveData = JSON.parse(data);\n            this.validateSaveData(saveData);\n            \n            await this.saveToStorage(saveData);\n            this.cachedSaveData = saveData;\n            \n            this.logger.info('Galaxy data imported successfully');\n            \n        } catch (error) {\n            this.logger.error('Failed to import galaxy data', error);\n            throw error;\n        }\n    }\n}","/**\n * Galaxy Manager - Integration Layer\n * Provides unified interface for galaxy generation, persistence, and exploration\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2 } from '@core/Renderer';\nimport { \n    GalaxyGenerator, \n    GalaxyConfig, \n    StarData, \n    StarSystemData,\n    PlanetData,\n    StarType\n} from './GalaxyGenerator';\nimport { \n    GalaxyPersistence, \n    PlayerGalaxyData,\n    VisitedLocation,\n    ChunkLoadOptions \n} from './GalaxyPersistence';\n\nexport interface ExplorationData {\n    exploredSystems: Set<string>;\n    discoveredPlanets: Set<string>;\n    visitedLocations: VisitedLocation[];\n    currentSystemId: string;\n    homeSystemId: string;\n}\n\nexport interface GalaxyManagerConfig {\n    enableAutoSave: boolean;\n    autoSaveInterval: number; // milliseconds\n    chunkLoadRadius: number; // light years\n    maxLoadedSystems: number;\n    galaxyConfig?: Partial<GalaxyConfig>;\n}\n\nexport interface GalaxyStats {\n    totalStars: number;\n    totalSystems: number;\n    exploredSystems: number;\n    discoveredPlanets: number;\n    systemsVisited: number;\n    distanceTraveled: number;\n    currentSystemName: string;\n    galaxySize: number;\n    explorationProgress: number; // 0-1\n}\n\nexport class GalaxyManager {\n    private generator: GalaxyGenerator;\n    private persistence: GalaxyPersistence;\n    private config: GalaxyManagerConfig;\n    \n    // Galaxy state\n    private explorationData: ExplorationData;\n    private playerData: PlayerGalaxyData;\n    private isInitialized = false;\n    \n    // Runtime data\n    private loadedSystems: Map<string, StarSystemData> = new Map();\n    private nearbyStars: StarData[] = [];\n    private currentSystem: StarSystemData | null = null;\n    \n    // Auto-save\n    private autoSaveTimer: number | null = null;\n    \n    private logger: Logger;\n\n    constructor(config: Partial<GalaxyManagerConfig> = {}) {\n        this.logger = new Logger('GalaxyManager');\n        \n        // Default configuration\n        this.config = {\n            enableAutoSave: true,\n            autoSaveInterval: 60000, // 1 minute\n            chunkLoadRadius: 500, // 500 light years\n            maxLoadedSystems: 100,\n            galaxyConfig: {\n                seed: Math.floor(Math.random() * 1000000),\n                starCount: 5, // Even smaller for faster generation\n                size: 2000 // Smaller galaxy for faster loading\n            },\n            ...config\n        };\n        \n        // Initialize components\n        this.generator = new GalaxyGenerator(this.config.galaxyConfig);\n        this.persistence = new GalaxyPersistence();\n        \n        // Initialize exploration data\n        this.explorationData = {\n            exploredSystems: new Set(),\n            discoveredPlanets: new Set(),\n            visitedLocations: [],\n            currentSystemId: '',\n            homeSystemId: ''\n        };\n        \n        // Initialize player data\n        this.playerData = {\n            currentSystemId: '',\n            homeSystemId: '',\n            totalSystemsVisited: 0,\n            totalPlanetsExplored: 0,\n            totalDistanceTraveled: 0,\n            galaxyDiscoveryProgress: 0\n        };\n        \n        this.logger.info('🌌 Galaxy manager initialized', {\n            config: this.config\n        });\n    }\n\n    /**\n     * Initialize the galaxy (load existing or generate new)\n     */\n    async initialize(): Promise<void> {\n        this.logger.info('🚀 Initializing galaxy...');\n        \n        try {\n            // Set timeout for galaxy generation - increased timeout for more complex generation\n            const timeoutPromise = new Promise((_, reject) => {\n                setTimeout(() => reject(new Error('Galaxy generation timeout')), 10000); // 10 seconds should be sufficient\n            });\n            \n            const initPromise = this.doInitialize();\n            \n            // Race between initialization and timeout\n            await Promise.race([initPromise, timeoutPromise]);\n            \n        } catch (error) {\n            this.logger.error('❌ Galaxy initialization failed, using fallback', {\n                error: error instanceof Error ? error.message : String(error),\n                stack: error instanceof Error ? error.stack : undefined,\n                config: this.config\n            });\n            \n            // Clear any partial state\n            this.loadedSystems.clear();\n            this.nearbyStars = [];\n            this.currentSystem = null;\n            \n            // Fallback to minimal galaxy\n            await this.initializeFallbackGalaxy();\n        }\n        \n        // Ensure we have at least a current system\n        if (!this.currentSystem) {\n            this.logger.warn('No current system found, creating emergency system');\n            await this.createEmergencySystem();\n        }\n        \n        this.logger.info('✅ Galaxy manager is ready');\n    }\n    \n    private async doInitialize(): Promise<void> {\n        // Try to load existing galaxy\n        const savedData = await this.persistence.loadGalaxy();\n        \n        if (savedData) {\n            // Load from save\n            this.logger.info('📁 Loading existing galaxy...');\n            this.generator = savedData.generator;\n            this.playerData = savedData.playerData;\n            \n            // Convert arrays back to Sets\n            this.explorationData = {\n                exploredSystems: new Set(savedData.explorationData.exploredSystems),\n                discoveredPlanets: new Set(savedData.explorationData.discoveredPlanets),\n                visitedLocations: savedData.explorationData.visitedLocations,\n                currentSystemId: savedData.playerData.currentSystemId,\n                homeSystemId: savedData.playerData.homeSystemId\n            };\n            \n        } else {\n            // Generate new galaxy\n            this.logger.info('🔄 Generating new galaxy...');\n            await this.generator.generateGalaxy((progress, message) => {\n                this.logger.debug(`Galaxy generation: ${progress}% - ${message}`);\n            });\n            \n            // Set up initial player data\n            await this.setupNewGame();\n        }\n        \n        // Load current system and nearby area\n        await this.loadCurrentArea();\n        \n        // Setup auto-save\n        if (this.config.enableAutoSave) {\n            this.setupAutoSave();\n        }\n        \n        this.isInitialized = true;\n        this.logger.info('✅ Galaxy initialization completed');\n    }\n    \n    private async initializeFallbackGalaxy(): Promise<void> {\n        this.logger.info('🔄 Creating minimal galaxy...');\n        \n        // Create a very simple galaxy with just a few stars\n        this.generator = new GalaxyGenerator({\n            seed: 12345, // Fixed seed for consistent fallback\n            starCount: 3, // Ultra-minimal galaxy for immediate play\n            size: 1000, // Very small galaxy but not too cramped\n            spiralArms: 2,\n            armTightness: 0.5,\n            coreSize: 100,\n            starDensity: 0.001\n        });\n        \n        try {\n            await this.generator.generateGalaxy((progress, message) => {\n                this.logger.debug(`Fallback galaxy generation: ${progress}% - ${message}`);\n            });\n            await this.setupNewGame();\n        } catch (error) {\n            this.logger.error('Fallback galaxy generation failed, creating emergency fallback', error);\n            await this.createEmergencyGalaxy();\n        }\n        \n        this.isInitialized = true;\n        this.logger.info('✅ Fallback galaxy ready');\n    }\n\n    private async createEmergencyGalaxy(): Promise<void> {\n        // Create absolute minimal galaxy with hardcoded data\n        this.generator = new GalaxyGenerator({\n            seed: 12345,\n            starCount: 1,\n            size: 100,\n            spiralArms: 2,\n            armTightness: 0.5,\n            coreSize: 10,\n            starDensity: 0.1\n        });\n        \n        try {\n            // Create just one star system manually\n            await this.generator.generateGalaxy((progress, message) => {\n                this.logger.debug(`Emergency galaxy generation: ${progress}% - ${message}`);\n            });\n            await this.setupNewGame();\n        } catch (error) {\n            this.logger.error('Emergency galaxy failed, creating hardcoded system', error);\n            await this.createHardcodedSystem();\n        }\n    }\n    \n    private async createEmergencySystem(): Promise<void> {\n        this.logger.warn('Creating emergency system for immediate play');\n        await this.createHardcodedSystem();\n    }\n    \n    private async createHardcodedSystem(): Promise<void> {\n        // Create a completely hardcoded minimal system\n        const emergencySystem: StarSystemData = {\n            id: 'emergency_system',\n            name: 'Emergency System',\n            position: { x: 0, y: 0 },\n            star: {\n                id: 'emergency_star',\n                name: 'Emergency Star',\n                type: StarType.G,\n                mass: 1.0,\n                radius: 1.0,\n                temperature: 5778,\n                luminosity: 1.0,\n                position: { x: 0, y: 0 },\n                age: 4.6\n            },\n            planets: [\n                {\n                    id: 'emergency_planet_1',\n                    name: 'Emergency Planet I',\n                    type: 'terrestrial',\n                    mass: 1.0,\n                    radius: 6371,\n                    orbitDistance: 1.0,\n                    orbitPeriod: 365.25,\n                    temperature: 288,\n                    atmosphere: 'breathable',\n                    resources: ['water', 'minerals'],\n                    discovered: true,\n                    position: { x: 150, y: 0 }\n                }\n            ]\n        };\n        \n        // Set up exploration data\n        this.explorationData.currentSystemId = emergencySystem.id;\n        this.explorationData.homeSystemId = emergencySystem.id;\n        this.playerData.currentSystemId = emergencySystem.id;\n        this.playerData.homeSystemId = emergencySystem.id;\n        \n        // Set current system\n        this.currentSystem = emergencySystem;\n        this.loadedSystems.set(emergencySystem.id, emergencySystem);\n        \n        // Mark as explored\n        this.explorationData.exploredSystems.add(emergencySystem.id);\n        \n        this.logger.info('Emergency hardcoded system created and ready');\n    }\n\n    /**\n     * Setup new game with starting system\n     */\n    private async setupNewGame(): Promise<void> {\n        // Find a suitable starting system near galactic center\n        const centerStars = this.generator.getStarsInRadius({ x: 0, y: 0 }, 5000);\n        \n        // Find a G-type star with planets\n        let startingSystem: StarSystemData | null = null;\n        for (const star of centerStars) {\n            if (star.type === StarType.G) { // Sun-like star\n                const system = this.generator.getStarSystem(star.id);\n                if (system && system.planets.length > 0) {\n                    startingSystem = system;\n                    break;\n                }\n            }\n        }\n        \n        // Fallback to any system with planets\n        if (!startingSystem) {\n            for (const star of centerStars) {\n                const system = this.generator.getStarSystem(star.id);\n                if (system && system.planets.length > 0) {\n                    startingSystem = system;\n                    break;\n                }\n            }\n        }\n        \n        if (!startingSystem) {\n            throw new Error('Could not find suitable starting system');\n        }\n        \n        // Set starting system\n        this.explorationData.currentSystemId = startingSystem.id;\n        this.explorationData.homeSystemId = startingSystem.id;\n        this.playerData.currentSystemId = startingSystem.id;\n        this.playerData.homeSystemId = startingSystem.id;\n        \n        // Mark as explored\n        this.exploreSystem(startingSystem.id);\n        \n        this.logger.info(`🏠 Starting system set: ${startingSystem.name}`);\n    }\n\n    /**\n     * Load current area around player\n     */\n    private async loadCurrentArea(): Promise<void> {\n        if (!this.explorationData.currentSystemId) return;\n        \n        // Get current system\n        this.currentSystem = this.generator.getStarSystem(this.explorationData.currentSystemId) || null;\n        if (!this.currentSystem) {\n            this.logger.error('Current system not found');\n            return;\n        }\n        \n        // Load nearby systems\n        const chunkOptions: ChunkLoadOptions = {\n            center: this.currentSystem.position,\n            radius: this.config.chunkLoadRadius,\n            maxSystems: this.config.maxLoadedSystems,\n            includeUnexplored: true\n        };\n        \n        const nearbySystems = await this.persistence.loadGalaxyChunk(this.generator, chunkOptions);\n        \n        // Update loaded systems\n        this.loadedSystems.clear();\n        for (const system of nearbySystems) {\n            this.loadedSystems.set(system.id, system);\n        }\n        \n        // Get nearby stars for rendering\n        this.nearbyStars = this.generator.getStarsInRadius(\n            this.currentSystem.position,\n            this.config.chunkLoadRadius / 2\n        );\n        \n        this.logger.debug(`Loaded ${nearbySystems.length} systems and ${this.nearbyStars.length} stars`);\n    }\n\n    /**\n     * Travel to a new system\n     */\n    async travelToSystem(systemId: string): Promise<boolean> {\n        const targetSystem = this.generator.getStarSystem(systemId);\n        if (!targetSystem) {\n            this.logger.error(`System not found: ${systemId}`);\n            return false;\n        }\n        \n        // Calculate travel distance\n        const currentPos = this.currentSystem?.position || { x: 0, y: 0 };\n        const distance = Math.sqrt(\n            Math.pow(targetSystem.position.x - currentPos.x, 2) +\n            Math.pow(targetSystem.position.y - currentPos.y, 2)\n        );\n        \n        // Update player data\n        this.explorationData.currentSystemId = systemId;\n        this.playerData.currentSystemId = systemId;\n        this.playerData.totalDistanceTraveled += distance;\n        \n        // Add to visited systems if not already visited\n        if (!this.explorationData.exploredSystems.has(systemId)) {\n            this.playerData.totalSystemsVisited++;\n        }\n        \n        // Explore the system\n        this.exploreSystem(systemId);\n        \n        // Add to visited locations\n        this.explorationData.visitedLocations.push({\n            systemId: systemId,\n            timestamp: Date.now(),\n            coordinates: targetSystem.position\n        });\n        \n        // Reload area around new system\n        await this.loadCurrentArea();\n        \n        this.logger.info(`🚀 Traveled to ${targetSystem.name} (${distance.toFixed(1)} LY)`);\n        return true;\n    }\n\n    /**\n     * Explore a system (mark as explored)\n     */\n    exploreSystem(systemId: string): void {\n        if (!this.explorationData.exploredSystems.has(systemId)) {\n            this.explorationData.exploredSystems.add(systemId);\n            \n            // Explore all planets in the system\n            const system = this.generator.getStarSystem(systemId);\n            if (system) {\n                for (const planet of system.planets) {\n                    this.discoverPlanet(planet.id);\n                }\n            }\n            \n            this.updateExplorationProgress();\n            this.logger.debug(`System explored: ${systemId}`);\n        }\n    }\n\n    /**\n     * Discover a planet\n     */\n    discoverPlanet(planetId: string): void {\n        if (!this.explorationData.discoveredPlanets.has(planetId)) {\n            this.explorationData.discoveredPlanets.add(planetId);\n            this.playerData.totalPlanetsExplored++;\n            \n            this.logger.debug(`Planet discovered: ${planetId}`);\n        }\n    }\n\n    /**\n     * Update exploration progress\n     */\n    private updateExplorationProgress(): void {\n        const totalSystems = this.generator.getAllSystems().length;\n        const exploredSystems = this.explorationData.exploredSystems.size;\n        \n        this.playerData.galaxyDiscoveryProgress = totalSystems > 0 ? exploredSystems / totalSystems : 0;\n    }\n\n    /**\n     * Get nearby systems for rendering\n     */\n    getNearbyStars(): StarData[] {\n        return [...this.nearbyStars];\n    }\n\n    /**\n     * Get loaded systems\n     */\n    getLoadedSystems(): StarSystemData[] {\n        return Array.from(this.loadedSystems.values());\n    }\n\n    /**\n     * Get current system\n     */\n    getCurrentSystem(): StarSystemData | null {\n        return this.currentSystem;\n    }\n\n    /**\n     * Get system by ID\n     */\n    getSystem(systemId: string): StarSystemData | undefined {\n        return this.loadedSystems.get(systemId) || this.generator.getStarSystem(systemId);\n    }\n\n    /**\n     * Find systems within radius\n     */\n    findSystemsInRadius(center: Vector2, radius: number): StarSystemData[] {\n        const nearbyStars = this.generator.getStarsInRadius(center, radius);\n        const systems: StarSystemData[] = [];\n        \n        for (const star of nearbyStars) {\n            const system = this.generator.getStarSystem(star.id);\n            if (system) {\n                systems.push(system);\n            }\n        }\n        \n        return systems;\n    }\n\n    /**\n     * Check if system is explored\n     */\n    isSystemExplored(systemId: string): boolean {\n        return this.explorationData.exploredSystems.has(systemId);\n    }\n\n    /**\n     * Check if planet is discovered\n     */\n    isPlanetDiscovered(planetId: string): boolean {\n        return this.explorationData.discoveredPlanets.has(planetId);\n    }\n\n    /**\n     * Get galaxy statistics\n     */\n    getGalaxyStats(): GalaxyStats {\n        const totalStars = this.generator.getAllStars().length;\n        const allSystems = this.generator.getAllSystems();\n        const totalSystems = allSystems.length;\n        const totalPlanets = allSystems.reduce((sum, system) => sum + system.planets.length, 0);\n        \n        return {\n            totalStars: totalStars,\n            totalSystems: totalSystems,\n            exploredSystems: this.explorationData.exploredSystems.size,\n            discoveredPlanets: this.explorationData.discoveredPlanets.size,\n            systemsVisited: this.playerData.totalSystemsVisited,\n            distanceTraveled: this.playerData.totalDistanceTraveled,\n            currentSystemName: this.currentSystem?.name || 'Unknown',\n            galaxySize: this.generator.getGalaxyConfig().size,\n            explorationProgress: this.playerData.galaxyDiscoveryProgress\n        };\n    }\n\n    /**\n     * Save galaxy state\n     */\n    async saveGalaxy(): Promise<void> {\n        if (!this.isInitialized) return;\n        \n        try {\n            // Convert Sets to Arrays for serialization\n            const explorationData = {\n                exploredSystems: Array.from(this.explorationData.exploredSystems),\n                discoveredPlanets: Array.from(this.explorationData.discoveredPlanets),\n                visitedLocations: this.explorationData.visitedLocations\n            };\n            \n            await this.persistence.saveGalaxy(\n                this.generator,\n                this.playerData,\n                explorationData\n            );\n            \n            this.logger.debug('Galaxy saved successfully');\n            \n        } catch (error) {\n            this.logger.error('Failed to save galaxy', error);\n        }\n    }\n\n    /**\n     * Setup auto-save timer\n     */\n    private setupAutoSave(): void {\n        if (this.autoSaveTimer) {\n            clearInterval(this.autoSaveTimer);\n        }\n        \n        this.autoSaveTimer = window.setInterval(async () => {\n            await this.saveGalaxy();\n        }, this.config.autoSaveInterval);\n        \n        this.logger.debug(`Auto-save enabled (${this.config.autoSaveInterval}ms interval)`);\n    }\n\n    /**\n     * Get player galaxy data\n     */\n    getPlayerData(): PlayerGalaxyData {\n        return { ...this.playerData };\n    }\n\n    /**\n     * Get exploration data\n     */\n    getExplorationData(): ExplorationData {\n        return {\n            exploredSystems: new Set(this.explorationData.exploredSystems),\n            discoveredPlanets: new Set(this.explorationData.discoveredPlanets),\n            visitedLocations: [...this.explorationData.visitedLocations],\n            currentSystemId: this.explorationData.currentSystemId,\n            homeSystemId: this.explorationData.homeSystemId\n        };\n    }\n\n    /**\n     * Export galaxy for sharing\n     */\n    async exportGalaxy(): Promise<string> {\n        return await this.persistence.exportGalaxy();\n    }\n\n    /**\n     * Import galaxy from backup\n     */\n    async importGalaxy(data: string): Promise<void> {\n        await this.persistence.importGalaxy(data);\n        \n        // Reinitialize after import\n        this.isInitialized = false;\n        await this.initialize();\n    }\n\n    /**\n     * Get storage statistics\n     */\n    getStorageStats() {\n        return this.persistence.getStorageStats();\n    }\n\n    /**\n     * Search for systems by name\n     */\n    searchSystems(query: string): StarSystemData[] {\n        const allSystems = this.generator.getAllSystems();\n        const lowercaseQuery = query.toLowerCase();\n        \n        return allSystems.filter(system => \n            system.name.toLowerCase().includes(lowercaseQuery) ||\n            system.star.name.toLowerCase().includes(lowercaseQuery)\n        ).slice(0, 20); // Limit results\n    }\n\n    /**\n     * Get distance between two systems\n     */\n    getSystemDistance(systemId1: string, systemId2: string): number {\n        const system1 = this.getSystem(systemId1);\n        const system2 = this.getSystem(systemId2);\n        \n        if (!system1 || !system2) return -1;\n        \n        return Math.sqrt(\n            Math.pow(system2.position.x - system1.position.x, 2) +\n            Math.pow(system2.position.y - system1.position.y, 2)\n        );\n    }\n\n    /**\n     * Get home system\n     */\n    getHomeSystem(): StarSystemData | null {\n        if (!this.explorationData.homeSystemId) return null;\n        return this.getSystem(this.explorationData.homeSystemId) || null;\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(newConfig: Partial<GalaxyManagerConfig>): void {\n        this.config = { ...this.config, ...newConfig };\n        \n        // Restart auto-save if interval changed\n        if (newConfig.autoSaveInterval && this.config.enableAutoSave) {\n            this.setupAutoSave();\n        }\n        \n        this.logger.debug('Galaxy manager configuration updated');\n    }\n\n    /**\n     * Cleanup resources\n     */\n    async cleanup(): Promise<void> {\n        // Save before cleanup\n        await this.saveGalaxy();\n        \n        // Clear auto-save timer\n        if (this.autoSaveTimer) {\n            clearInterval(this.autoSaveTimer);\n            this.autoSaveTimer = null;\n        }\n        \n        // Clear cached data\n        this.loadedSystems.clear();\n        this.nearbyStars = [];\n        this.persistence.clearCache();\n        \n        this.logger.info('🧹 Galaxy manager cleanup completed');\n    }\n\n    /**\n     * Check if galaxy is initialized\n     */\n    isGalaxyInitialized(): boolean {\n        return this.isInitialized;\n    }\n}","/**\n * Retro Cockpit Status Bar\n * 5-panel status bar with CRT monitor styling and interactive controls\n */\n\nimport { Renderer, Color } from '@core/Renderer';\nimport { InputManager } from '@core/InputManager';\nimport { SystemStatus, PowerAllocation, DamageReport, ShipSection } from '@entities/ShipSystems';\nimport { Logger } from '@utils/Logger';\nimport { Vector2 } from '@core/Renderer';\n\nexport interface StatusBarConfig {\n    screenWidth: number;\n    screenHeight: number;\n    panelHeight: number;\n    panelSpacing: number;\n    enableInteraction: boolean;\n    crtEffects: boolean;\n}\n\nexport interface PanelInteraction {\n    onPowerAllocationChange?: (allocation: Partial<PowerAllocation>) => void;\n    onSystemToggle?: (system: string, state: boolean) => void;\n    onRepairRequest?: (section: ShipSection, damageIndex: number) => void;\n    onInventoryOpen?: () => void;\n    onCodexOpen?: () => void;\n    onResearchOpen?: () => void;\n    onCrewOpen?: () => void;\n    onRadarZoom?: (zoomLevel: number) => void;\n    onGalaxyMapOpen?: () => void;\n}\n\ninterface PanelArea {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    title: string;\n}\n\ninterface InteractiveElement {\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    type: 'button' | 'slider' | 'toggle' | 'monitor';\n    id: string;\n    value?: number; // For sliders\n    state?: boolean; // For toggles\n    label: string;\n}\n\nexport class CockpitStatusBar {\n    private config: StatusBarConfig;\n    private panels: PanelArea[] = [];\n    private interactiveElements: Map<string, InteractiveElement> = new Map();\n    private interactions: PanelInteraction;\n    \n    // Visual state\n    private flickerTimer = 0;\n    private scanlineOffset = 0;\n    private glitchTimer = 0;\n    \n    // Input handling\n    private hoveredElement: string | null = null;\n    private selectedElement: string | null = null;\n    private isDragging = false;\n    \n    // Data display\n    private systemStatus: SystemStatus;\n    private damageReports: Map<ShipSection, DamageReport[]> = new Map();\n    private cargoLoad = 0;\n    private radarZoom = 1.0;\n    private radarMode: 'system' | 'interstellar' = 'system';\n    \n    private logger: Logger;\n\n    constructor(\n        config: Partial<StatusBarConfig> = {},\n        interactions: PanelInteraction = {}\n    ) {\n        this.logger = new Logger('CockpitStatusBar');\n        this.interactions = interactions;\n        \n        // Default configuration\n        this.config = {\n            screenWidth: 1024,\n            screenHeight: 768,\n            panelHeight: 115, // 15% of 768px\n            panelSpacing: 5,\n            enableInteraction: true,\n            crtEffects: true,\n            ...config\n        };\n        \n        // Initialize default system status\n        this.systemStatus = {\n            hull: 100,\n            shields: 100,\n            power: 100,\n            fuel: 100,\n            heat: 0,\n            enginesOnline: true,\n            shieldsOnline: true,\n            weaponsOnline: true,\n            lifeSupport: true,\n            warpDrive: true,\n            engineEfficiency: 1.0,\n            shieldStrength: 1.0,\n            weaponAccuracy: 1.0,\n            sensorRange: 1.0\n        };\n        \n        this.setupPanels();\n        this.setupInteractiveElements();\n        \n        this.logger.info('🖥️ Cockpit status bar initialized', {\n            panels: this.panels.length,\n            interactiveElements: this.interactiveElements.size\n        });\n    }\n\n    /**\n     * Setup the 5 main panels\n     */\n    private setupPanels(): void {\n        const totalWidth = this.config.screenWidth;\n        const panelWidth = (totalWidth - (this.config.panelSpacing * 6)) / 5;\n        const startY = this.config.screenHeight - this.config.panelHeight;\n        \n        this.panels = [\n            {\n                x: this.config.panelSpacing,\n                y: startY,\n                width: panelWidth,\n                height: this.config.panelHeight,\n                title: 'SHIP SYSTEMS'\n            },\n            {\n                x: this.config.panelSpacing + (panelWidth + this.config.panelSpacing) * 1,\n                y: startY,\n                width: panelWidth,\n                height: this.config.panelHeight,\n                title: 'SHIP CONTROL'\n            },\n            {\n                x: this.config.panelSpacing + (panelWidth + this.config.panelSpacing) * 2,\n                y: startY,\n                width: panelWidth,\n                height: this.config.panelHeight,\n                title: 'DAMAGE & CARGO'\n            },\n            {\n                x: this.config.panelSpacing + (panelWidth + this.config.panelSpacing) * 3,\n                y: startY,\n                width: panelWidth,\n                height: this.config.panelHeight,\n                title: 'WEAPONS'\n            },\n            {\n                x: this.config.panelSpacing + (panelWidth + this.config.panelSpacing) * 4,\n                y: startY,\n                width: panelWidth,\n                height: this.config.panelHeight,\n                title: 'RADAR & NAV'\n            }\n        ];\n    }\n\n    /**\n     * Setup interactive elements for each panel\n     */\n    private setupInteractiveElements(): void {\n        this.setupSystemsPanel();\n        this.setupControlPanel();\n        this.setupDamagePanel();\n        this.setupWeaponsPanel();\n        this.setupRadarPanel();\n    }\n\n    /**\n     * Setup ship systems panel (Panel 1)\n     */\n    private setupSystemsPanel(): void {\n        const panel = this.panels[0];\n        const elementWidth = 25;\n        const elementHeight = 8;\n        \n        // Status indicators\n        this.addElement('hull_indicator', panel.x + 10, panel.y + 20, elementWidth, elementHeight, 'monitor', 'HULL');\n        this.addElement('shields_indicator', panel.x + 10, panel.y + 35, elementWidth, elementHeight, 'monitor', 'SHIELDS');\n        this.addElement('power_indicator', panel.x + 10, panel.y + 50, elementWidth, elementHeight, 'monitor', 'POWER');\n        this.addElement('fuel_indicator', panel.x + 10, panel.y + 65, elementWidth, elementHeight, 'monitor', 'FUEL');\n        this.addElement('heat_indicator', panel.x + 10, panel.y + 80, elementWidth, elementHeight, 'monitor', 'HEAT');\n        \n        // Critical warning lights\n        this.addElement('reactor_warning', panel.x + 80, panel.y + 20, 12, 12, 'button', 'RCTR');\n        this.addElement('hull_warning', panel.x + 80, panel.y + 35, 12, 12, 'button', 'HULL');\n        this.addElement('shield_warning', panel.x + 80, panel.y + 50, 12, 12, 'button', 'SHLD');\n        this.addElement('warp_warning', panel.x + 80, panel.y + 65, 12, 12, 'button', 'WARP');\n    }\n\n    /**\n     * Setup ship control panel (Panel 2)\n     */\n    private setupControlPanel(): void {\n        const panel = this.panels[1];\n        \n        // System toggles\n        this.addElement('engines_toggle', panel.x + 10, panel.y + 20, 30, 15, 'toggle', 'ENGINES');\n        this.addElement('shields_toggle', panel.x + 50, panel.y + 20, 30, 15, 'toggle', 'SHIELDS');\n        this.addElement('weapons_toggle', panel.x + 90, panel.y + 20, 30, 15, 'toggle', 'WEAPONS');\n        this.addElement('warp_toggle', panel.x + 130, panel.y + 20, 30, 15, 'toggle', 'WARP');\n        \n        // Power sliders\n        this.addElement('thrust_slider', panel.x + 10, panel.y + 45, 60, 10, 'slider', 'THRUST');\n        this.addElement('shield_slider', panel.x + 80, panel.y + 45, 60, 10, 'slider', 'SHIELDS');\n        \n        // Emergency button\n        this.addElement('autodestruct', panel.x + 60, panel.y + 70, 40, 20, 'button', 'AUTO-DESTRUCT');\n    }\n\n    /**\n     * Setup damage and cargo panel (Panel 3)\n     */\n    private setupDamagePanel(): void {\n        const panel = this.panels[2];\n        \n        // Damage monitor (central area)\n        this.addElement('damage_monitor', panel.x + 10, panel.y + 20, 80, 50, 'monitor', 'DAMAGE');\n        \n        // Cargo load indicator\n        this.addElement('cargo_indicator', panel.x + 100, panel.y + 20, 60, 15, 'monitor', 'CARGO');\n        \n        // Interface buttons\n        this.addElement('inventory_btn', panel.x + 10, panel.y + 80, 35, 15, 'button', 'INV');\n        this.addElement('codex_btn', panel.x + 50, panel.y + 80, 35, 15, 'button', 'CODEX');\n        this.addElement('research_btn', panel.x + 90, panel.y + 80, 35, 15, 'button', 'RSCH');\n        this.addElement('crew_btn', panel.x + 130, panel.y + 80, 35, 15, 'button', 'CREW');\n    }\n\n    /**\n     * Setup weapons panel (Panel 4)\n     */\n    private setupWeaponsPanel(): void {\n        const panel = this.panels[3];\n        \n        // Weapon selection\n        this.addElement('weapon1_btn', panel.x + 10, panel.y + 20, 40, 15, 'button', 'LASER');\n        this.addElement('weapon2_btn', panel.x + 55, panel.y + 20, 40, 15, 'button', 'PLASMA');\n        this.addElement('weapon3_btn', panel.x + 100, panel.y + 20, 40, 15, 'button', 'MISSILE');\n        \n        // Weapon info monitor\n        this.addElement('weapon_monitor', panel.x + 10, panel.y + 40, 130, 25, 'monitor', 'WEAPON INFO');\n        \n        // Warning lights\n        this.addElement('overheat_warning', panel.x + 10, panel.y + 75, 15, 15, 'button', 'HOT');\n        this.addElement('ammo_warning', panel.x + 30, panel.y + 75, 15, 15, 'button', 'AMMO');\n        this.addElement('energy_warning', panel.x + 50, panel.y + 75, 15, 15, 'button', 'PWR');\n        \n        // Warp drive button\n        this.addElement('warp_button', panel.x + 80, panel.y + 75, 50, 15, 'button', 'WARP');\n    }\n\n    /**\n     * Setup radar and navigation panel (Panel 5)\n     */\n    private setupRadarPanel(): void {\n        const panel = this.panels[4];\n        \n        // Radar display\n        this.addElement('radar_display', panel.x + 10, panel.y + 20, 80, 50, 'monitor', 'RADAR');\n        \n        // Radar controls\n        this.addElement('zoom_in', panel.x + 100, panel.y + 20, 20, 15, 'button', 'Z+');\n        this.addElement('zoom_out', panel.x + 125, panel.y + 20, 20, 15, 'button', 'Z-');\n        this.addElement('radar_mode', panel.x + 100, panel.y + 40, 45, 15, 'toggle', 'MODE');\n        this.addElement('galaxy_map', panel.x + 100, panel.y + 60, 45, 15, 'button', 'GALAXY');\n    }\n\n    /**\n     * Add interactive element\n     */\n    private addElement(\n        id: string, \n        x: number, \n        y: number, \n        width: number, \n        height: number, \n        type: 'button' | 'slider' | 'toggle' | 'monitor',\n        label: string\n    ): void {\n        this.interactiveElements.set(id, {\n            x, y, width, height, type, id, label,\n            value: type === 'slider' ? 50 : undefined,\n            state: type === 'toggle' ? true : undefined\n        });\n    }\n\n    /**\n     * Update status bar (called each frame)\n     */\n    update(deltaTime: number, input: InputManager): void {\n        // Update visual effects\n        this.updateVisualEffects(deltaTime);\n        \n        // Handle input if interaction is enabled\n        if (this.config.enableInteraction) {\n            this.handleInput(input);\n        }\n    }\n\n    /**\n     * Update visual effects (flicker, scanlines, glitch)\n     */\n    private updateVisualEffects(deltaTime: number): void {\n        this.flickerTimer += deltaTime;\n        this.scanlineOffset += deltaTime * 100; // Scanline speed\n        this.glitchTimer += deltaTime;\n        \n        // Reset timers to prevent overflow\n        if (this.flickerTimer > 10) this.flickerTimer = 0;\n        if (this.scanlineOffset > 1000) this.scanlineOffset = 0;\n        if (this.glitchTimer > 5) this.glitchTimer = 0;\n    }\n\n    /**\n     * Handle user input\n     */\n    private handleInput(input: InputManager): void {\n        const mousePos = input.getMousePosition();\n        \n        // Check for element hover\n        this.hoveredElement = null;\n        for (const [id, element] of this.interactiveElements) {\n            if (this.isPointInElement(mousePos, element)) {\n                this.hoveredElement = id;\n                break;\n            }\n        }\n        \n        // Handle clicks\n        if (input.isMouseButtonPressed(0)) {\n            if (this.hoveredElement) {\n                this.handleElementClick(this.hoveredElement);\n            }\n        }\n        \n        // Handle dragging for sliders\n        if (input.isMouseButtonDown(0) && this.selectedElement) {\n            const element = this.interactiveElements.get(this.selectedElement);\n            if (element && element.type === 'slider') {\n                this.handleSliderDrag(element, mousePos);\n            }\n        } else {\n            this.selectedElement = null;\n            this.isDragging = false;\n        }\n    }\n\n    /**\n     * Check if point is inside element\n     */\n    private isPointInElement(point: Vector2, element: InteractiveElement): boolean {\n        return point.x >= element.x && \n               point.x <= element.x + element.width &&\n               point.y >= element.y && \n               point.y <= element.y + element.height;\n    }\n\n    /**\n     * Handle element click\n     */\n    private handleElementClick(elementId: string): void {\n        const element = this.interactiveElements.get(elementId);\n        if (!element) return;\n        \n        this.selectedElement = elementId;\n        \n        switch (element.type) {\n            case 'button':\n                this.handleButtonClick(elementId);\n                break;\n            case 'toggle':\n                this.handleToggleClick(elementId, element);\n                break;\n            case 'slider':\n                this.isDragging = true;\n                break;\n        }\n    }\n\n    /**\n     * Handle button clicks\n     */\n    private handleButtonClick(elementId: string): void {\n        switch (elementId) {\n            case 'autodestruct':\n                // Confirmation would be needed\n                this.logger.warn('🛑 Auto-destruct sequence requested');\n                break;\n            case 'inventory_btn':\n                this.interactions.onInventoryOpen?.();\n                break;\n            case 'codex_btn':\n                this.interactions.onCodexOpen?.();\n                break;\n            case 'research_btn':\n                this.interactions.onResearchOpen?.();\n                break;\n            case 'crew_btn':\n                this.interactions.onCrewOpen?.();\n                break;\n            case 'galaxy_map':\n                this.interactions.onGalaxyMapOpen?.();\n                break;\n            case 'zoom_in':\n                this.radarZoom = Math.min(5.0, this.radarZoom * 1.5);\n                this.interactions.onRadarZoom?.(this.radarZoom);\n                break;\n            case 'zoom_out':\n                this.radarZoom = Math.max(0.2, this.radarZoom / 1.5);\n                this.interactions.onRadarZoom?.(this.radarZoom);\n                break;\n        }\n    }\n\n    /**\n     * Handle toggle clicks\n     */\n    private handleToggleClick(elementId: string, element: InteractiveElement): void {\n        element.state = !element.state;\n        \n        const systemMap: Record<string, string> = {\n            'engines_toggle': 'engines',\n            'shields_toggle': 'shields',\n            'weapons_toggle': 'weapons',\n            'warp_toggle': 'warp_drive',\n            'radar_mode': 'radar_mode'\n        };\n        \n        const systemName = systemMap[elementId];\n        if (systemName) {\n            if (systemName === 'radar_mode') {\n                this.radarMode = this.radarMode === 'system' ? 'interstellar' : 'system';\n            } else {\n                this.interactions.onSystemToggle?.(systemName, element.state!);\n            }\n        }\n    }\n\n    /**\n     * Handle slider dragging\n     */\n    private handleSliderDrag(element: InteractiveElement, mousePos: Vector2): void {\n        const localX = mousePos.x - element.x;\n        const percentage = Math.max(0, Math.min(100, (localX / element.width) * 100));\n        element.value = percentage;\n        \n        // Update power allocation\n        if (element.id === 'thrust_slider') {\n            this.interactions.onPowerAllocationChange?.({ engines: percentage });\n        } else if (element.id === 'shield_slider') {\n            this.interactions.onPowerAllocationChange?.({ shields: percentage });\n        }\n    }\n\n    /**\n     * Render the status bar\n     */\n    render(renderer: Renderer): void {\n        // Render background base\n        this.renderPanelBase(renderer);\n        \n        // Render each panel\n        this.panels.forEach((panel, index) => {\n            this.renderPanel(renderer, panel, index);\n        });\n        \n        // Render CRT effects if enabled\n        if (this.config.crtEffects) {\n            this.renderCRTEffects(renderer);\n        }\n    }\n\n    /**\n     * Render panel base structure\n     */\n    private renderPanelBase(renderer: Renderer): void {\n        const baseY = this.config.screenHeight - this.config.panelHeight - 10;\n        const baseHeight = this.config.panelHeight + 20;\n        \n        // Main base panel (very dark, worn metal)\n        renderer.fillRect(0, baseY, this.config.screenWidth, baseHeight, { r: 12, g: 14, b: 16 });\n        \n        // Decorative edge (muted terminal glow)\n        renderer.fillRect(0, baseY, this.config.screenWidth, 3, { r: 8, g: 24, b: 8 });\n        \n        // Panel separators (dark gray lines)\n        for (let i = 1; i < this.panels.length; i++) {\n            const x = this.panels[i].x - this.config.panelSpacing / 2;\n            renderer.fillRect(x, baseY + 5, 1, baseHeight - 10, { r: 24, g: 24, b: 24 });\n        }\n    }\n\n    /**\n     * Render individual panel\n     */\n    private renderPanel(renderer: Renderer, panel: PanelArea, panelIndex: number): void {\n        // Panel background with depth effect (dark, worn CRT style)\n        renderer.fillRect(panel.x, panel.y, panel.width, panel.height, { r: 8, g: 12, b: 8 });\n        renderer.drawLine(panel.x, panel.y, panel.x + panel.width, panel.y, { r: 16, g: 48, b: 16 });\n        renderer.drawLine(panel.x, panel.y, panel.x, panel.y + panel.height, { r: 16, g: 48, b: 16 });\n        \n        // Panel title (muted terminal green)\n        renderer.renderText(panel.title, panel.x + 5, panel.y + 5, { r: 12, g: 36, b: 12 }, 8);\n        \n        // Render panel content based on index\n        switch (panelIndex) {\n            case 0: this.renderSystemsPanel(renderer, panel); break;\n            case 1: this.renderControlPanel(renderer, panel); break;\n            case 2: this.renderDamagePanel(renderer, panel); break;\n            case 3: this.renderWeaponsPanel(renderer, panel); break;\n            case 4: this.renderRadarPanel(renderer, panel); break;\n        }\n    }\n\n    /**\n     * Render systems panel content\n     */\n    private renderSystemsPanel(renderer: Renderer, panel: PanelArea): void {\n        // Status bars\n        this.renderStatusBar(renderer, panel.x + 40, panel.y + 20, 30, 8, this.systemStatus.hull, 'HULL');\n        this.renderStatusBar(renderer, panel.x + 40, panel.y + 35, 30, 8, this.systemStatus.shields, 'SHLD');\n        this.renderStatusBar(renderer, panel.x + 40, panel.y + 50, 30, 8, this.systemStatus.power, 'PWR');\n        this.renderStatusBar(renderer, panel.x + 40, panel.y + 65, 30, 8, this.systemStatus.fuel, 'FUEL');\n        this.renderStatusBar(renderer, panel.x + 40, panel.y + 80, 30, 8, this.systemStatus.heat, 'HEAT', true);\n        \n        // Warning lights\n        this.renderWarningLight(renderer, panel.x + 95, panel.y + 20, this.systemStatus.power < 30);\n        this.renderWarningLight(renderer, panel.x + 95, panel.y + 35, this.systemStatus.hull < 25);\n        this.renderWarningLight(renderer, panel.x + 95, panel.y + 50, !this.systemStatus.shieldsOnline);\n        this.renderWarningLight(renderer, panel.x + 95, panel.y + 65, !this.systemStatus.warpDrive);\n    }\n\n    /**\n     * Render control panel content\n     */\n    private renderControlPanel(renderer: Renderer, panel: PanelArea): void {\n        // System toggles\n        this.renderToggle(renderer, panel.x + 10, panel.y + 20, 30, 15, this.systemStatus.enginesOnline, 'ENG');\n        this.renderToggle(renderer, panel.x + 50, panel.y + 20, 30, 15, this.systemStatus.shieldsOnline, 'SHLD');\n        this.renderToggle(renderer, panel.x + 90, panel.y + 20, 30, 15, this.systemStatus.weaponsOnline, 'WPN');\n        this.renderToggle(renderer, panel.x + 130, panel.y + 20, 30, 15, this.systemStatus.warpDrive, 'WARP');\n        \n        // Power sliders\n        const thrustSlider = this.interactiveElements.get('thrust_slider');\n        const shieldSlider = this.interactiveElements.get('shield_slider');\n        \n        if (thrustSlider) {\n            this.renderSlider(renderer, thrustSlider, thrustSlider.value || 50, 'THRUST');\n        }\n        if (shieldSlider) {\n            this.renderSlider(renderer, shieldSlider, shieldSlider.value || 50, 'SHIELDS');\n        }\n        \n        // Emergency button\n        this.renderButton(renderer, panel.x + 60, panel.y + 70, 40, 20, 'DESTRUCT', { r: 200, g: 0, b: 0 });\n    }\n\n    /**\n     * Render damage panel content\n     */\n    private renderDamagePanel(renderer: Renderer, panel: PanelArea): void {\n        // Damage monitor\n        this.renderDamageDisplay(renderer, panel.x + 10, panel.y + 20, 80, 50);\n        \n        // Cargo indicator\n        renderer.renderText(`CARGO: ${this.cargoLoad.toFixed(0)}%`, \n            panel.x + 100, panel.y + 25, { r: 255, g: 255, b: 0 }, 10);\n        \n        // Interface buttons\n        this.renderButton(renderer, panel.x + 10, panel.y + 80, 35, 15, 'INV', { r: 0, g: 192, b: 255 });\n        this.renderButton(renderer, panel.x + 50, panel.y + 80, 35, 15, 'CODEX', { r: 0, g: 192, b: 255 });\n        this.renderButton(renderer, panel.x + 90, panel.y + 80, 35, 15, 'RSCH', { r: 0, g: 192, b: 255 });\n        this.renderButton(renderer, panel.x + 130, panel.y + 80, 35, 15, 'CREW', { r: 0, g: 192, b: 255 });\n    }\n\n    /**\n     * Render weapons panel content\n     */\n    private renderWeaponsPanel(renderer: Renderer, panel: PanelArea): void {\n        // Weapon selection buttons\n        this.renderButton(renderer, panel.x + 10, panel.y + 20, 40, 15, 'LASER', { r: 0, g: 255, b: 0 });\n        this.renderButton(renderer, panel.x + 55, panel.y + 20, 40, 15, 'PLASMA', { r: 128, g: 128, b: 128 });\n        this.renderButton(renderer, panel.x + 100, panel.y + 20, 40, 15, 'MISSILE', { r: 128, g: 128, b: 128 });\n        \n        // Weapon info display\n        renderer.fillRect(panel.x + 10, panel.y + 40, 130, 25, { r: 5, g: 10, b: 5 });\n        renderer.renderText('LASER CANNON MK-II', panel.x + 15, panel.y + 45, { r: 0, g: 255, b: 0 }, 8);\n        renderer.renderText('PWR: 85% RNG: 2.5KM', panel.x + 15, panel.y + 55, { r: 0, g: 192, b: 0 }, 8);\n        \n        // Warning lights\n        this.renderWarningLight(renderer, panel.x + 15, panel.y + 75, this.systemStatus.heat > 80);\n        this.renderWarningLight(renderer, panel.x + 35, panel.y + 75, false); // Ammo OK\n        this.renderWarningLight(renderer, panel.x + 55, panel.y + 75, this.systemStatus.power < 20);\n    }\n\n    /**\n     * Render radar panel content\n     */\n    private renderRadarPanel(renderer: Renderer, panel: PanelArea): void {\n        // Radar display\n        this.renderRadarDisplay(renderer, panel.x + 10, panel.y + 20, 80, 50);\n        \n        // Control buttons\n        this.renderButton(renderer, panel.x + 100, panel.y + 20, 20, 15, 'Z+', { r: 0, g: 128, b: 255 });\n        this.renderButton(renderer, panel.x + 125, panel.y + 20, 20, 15, 'Z-', { r: 0, g: 128, b: 255 });\n        this.renderToggle(renderer, panel.x + 100, panel.y + 40, 45, 15, this.radarMode === 'interstellar', 'MODE');\n        this.renderButton(renderer, panel.x + 100, panel.y + 60, 45, 15, 'GALAXY', { r: 255, g: 165, b: 0 });\n    }\n\n    /**\n     * Render status bar\n     */\n    private renderStatusBar(\n        renderer: Renderer, \n        x: number, \n        y: number, \n        width: number, \n        height: number, \n        value: number, \n        label: string,\n        isHeat = false\n    ): void {\n        // Background\n        renderer.fillRect(x, y, width, height, { r: 5, g: 5, b: 5 });\n        \n        // Fill bar\n        const fillWidth = (value / 100) * width;\n        let fillColor: Color;\n        \n        if (isHeat) {\n            // Heat bar (muted red when high)\n            fillColor = value > 70 ? { r: 96, g: 32, b: 32 } : \n                       value > 40 ? { r: 96, g: 64, b: 16 } : \n                                   { r: 12, g: 36, b: 12 };\n        } else {\n            // Standard bar (muted green to amber to red)\n            fillColor = value > 60 ? { r: 12, g: 36, b: 12 } : \n                       value > 30 ? { r: 72, g: 48, b: 12 } : \n                                   { r: 72, g: 24, b: 24 };\n        }\n        \n        renderer.fillRect(x, y, fillWidth, height, fillColor);\n        \n        // Border (dark gray)\n        renderer.drawLine(x, y, x + width, y, { r: 32, g: 32, b: 32 });\n        renderer.drawLine(x, y + height, x + width, y + height, { r: 32, g: 32, b: 32 });\n        \n        // Value text (muted white)\n        renderer.renderText(`${value.toFixed(0)}`, x + width + 2, y, { r: 64, g: 64, b: 64 }, 8);\n    }\n\n    /**\n     * Render warning light\n     */\n    private renderWarningLight(renderer: Renderer, x: number, y: number, isActive: boolean): void {\n        const color = isActive ? \n            { r: 72, g: 24, b: 24 } : \n            { r: 24, g: 8, b: 8 };\n        \n        renderer.fillRect(x, y, 8, 8, color);\n        \n        // Flicker effect for active warnings (muted glow)\n        if (isActive && Math.sin(this.flickerTimer * 10) > 0.5) {\n            renderer.fillRect(x + 1, y + 1, 6, 6, { r: 96, g: 32, b: 32 });\n        }\n    }\n\n    /**\n     * Render toggle switch\n     */\n    private renderToggle(\n        renderer: Renderer, \n        x: number, \n        y: number, \n        width: number, \n        height: number, \n        state: boolean, \n        label: string\n    ): void {\n        const bgColor = state ? { r: 8, g: 24, b: 8 } : { r: 24, g: 8, b: 8 };\n        const textColor = state ? { r: 16, g: 48, b: 16 } : { r: 32, g: 32, b: 32 };\n        \n        renderer.fillRect(x, y, width, height, bgColor);\n        renderer.renderText(label, x + 2, y + 4, textColor, 8);\n    }\n\n    /**\n     * Render slider\n     */\n    private renderSlider(\n        renderer: Renderer, \n        element: InteractiveElement, \n        value: number, \n        label: string\n    ): void {\n        // Background (dark worn metal)\n        renderer.fillRect(element.x, element.y, element.width, element.height, { r: 8, g: 8, b: 8 });\n        \n        // Slider position (muted teal)\n        const sliderPos = (value / 100) * element.width;\n        renderer.fillRect(element.x, element.y, sliderPos, element.height, { r: 16, g: 40, b: 32 });\n        \n        // Slider handle (worn white)\n        renderer.fillRect(element.x + sliderPos - 2, element.y - 2, 4, element.height + 4, { r: 64, g: 64, b: 64 });\n        \n        // Label and value (muted text)\n        renderer.renderText(label, element.x, element.y - 12, { r: 48, g: 48, b: 48 }, 8);\n        renderer.renderText(`${value.toFixed(0)}%`, element.x + element.width - 25, element.y - 12, { r: 48, g: 48, b: 48 }, 8);\n    }\n\n    /**\n     * Render button\n     */\n    private renderButton(\n        renderer: Renderer, \n        x: number, \n        y: number, \n        width: number, \n        height: number, \n        label: string, \n        color: Color\n    ): void {\n        const isHovered = this.hoveredElement?.includes(label.toLowerCase());\n        const bgColor = isHovered ? \n            { r: color.r + 30, g: color.g + 30, b: color.b + 30 } : \n            { r: color.r / 3, g: color.g / 3, b: color.b / 3 };\n        \n        renderer.fillRect(x, y, width, height, bgColor);\n        renderer.renderText(label, x + 2, y + 3, color, 8);\n    }\n\n    /**\n     * Render damage display\n     */\n    private renderDamageDisplay(renderer: Renderer, x: number, y: number, width: number, height: number): void {\n        // Background\n        renderer.fillRect(x, y, width, height, { r: 5, g: 10, b: 5 });\n        \n        // Ship schematic (simplified)\n        const shipX = x + width / 2;\n        const shipY = y + height / 2;\n        \n        // Draw 8 sections of the ship\n        const sections = [\n            { name: 'BOW', x: shipX, y: shipY - 15, color: { r: 0, g: 255, b: 0 } },\n            { name: 'STERN', x: shipX, y: shipY + 15, color: { r: 0, g: 255, b: 0 } },\n            { name: 'PORT', x: shipX - 15, y: shipY, color: { r: 0, g: 255, b: 0 } },\n            { name: 'STBD', x: shipX + 15, y: shipY, color: { r: 0, g: 255, b: 0 } },\n            { name: 'CORE', x: shipX, y: shipY, color: { r: 0, g: 255, b: 0 } },\n            { name: 'BRDG', x: shipX - 8, y: shipY - 8, color: { r: 0, g: 255, b: 0 } },\n            { name: 'ENG', x: shipX + 8, y: shipY + 8, color: { r: 0, g: 255, b: 0 } },\n            { name: 'WPN', x: shipX + 8, y: shipY - 8, color: { r: 0, g: 255, b: 0 } }\n        ];\n        \n        sections.forEach(section => {\n            renderer.fillRect(section.x - 4, section.y - 4, 8, 8, section.color);\n            renderer.renderText(section.name, section.x - 12, section.y + 8, { r: 0, g: 192, b: 0 }, 6);\n        });\n    }\n\n    /**\n     * Render radar display\n     */\n    private renderRadarDisplay(renderer: Renderer, x: number, y: number, width: number, height: number): void {\n        // Background\n        renderer.fillRect(x, y, width, height, { r: 0, g: 8, b: 0 });\n        \n        // Radar grid\n        const centerX = x + width / 2;\n        const centerY = y + height / 2;\n        const maxRadius = Math.min(width, height) / 2 - 5;\n        \n        // Range rings\n        for (let i = 1; i <= 3; i++) {\n            const radius = (maxRadius / 3) * i;\n            renderer.drawCircle(centerX, centerY, radius, { r: 0, g: 64, b: 0 });\n        }\n        \n        // Cross hairs\n        renderer.drawLine(centerX - maxRadius, centerY, centerX + maxRadius, centerY, { r: 0, g: 64, b: 0 });\n        renderer.drawLine(centerX, centerY - maxRadius, centerX, centerY + maxRadius, { r: 0, g: 64, b: 0 });\n        \n        // Player ship (center)\n        renderer.fillRect(centerX - 1, centerY - 1, 3, 3, { r: 0, g: 255, b: 0 });\n        \n        // Sample contacts\n        renderer.fillRect(centerX + 10, centerY - 15, 2, 2, { r: 255, g: 255, b: 0 }); // Planet\n        renderer.fillRect(centerX - 20, centerY + 8, 2, 2, { r: 255, g: 255, b: 0 }); // Planet\n        \n        // Mode indicator\n        renderer.renderText(this.radarMode.toUpperCase(), x + 2, y + height - 12, { r: 0, g: 255, b: 0 }, 8);\n        renderer.renderText(`ZOOM: ${this.radarZoom.toFixed(1)}x`, x + 2, y + height - 22, { r: 0, g: 255, b: 0 }, 8);\n    }\n\n    /**\n     * Render CRT effects\n     */\n    private renderCRTEffects(renderer: Renderer): void {\n        // Scanlines are handled by CSS in the main HTML\n        // Additional flicker effect for damaged systems\n        if (this.systemStatus.hull < 50 || this.systemStatus.power < 30) {\n            // Add random glitch pixels\n            if (Math.random() < 0.1) {\n                const x = Math.random() * this.config.screenWidth;\n                const y = this.config.screenHeight - this.config.panelHeight + Math.random() * this.config.panelHeight;\n                renderer.setPixel(x, y, { r: 255, g: 255, b: 255 });\n            }\n        }\n    }\n\n    /**\n     * Update system status\n     */\n    updateSystemStatus(status: SystemStatus): void {\n        this.systemStatus = { ...status };\n    }\n\n    /**\n     * Update damage reports\n     */\n    updateDamageReports(reports: Map<ShipSection, DamageReport[]>): void {\n        this.damageReports = new Map(reports);\n    }\n\n    /**\n     * Update cargo load\n     */\n    updateCargoLoad(load: number): void {\n        this.cargoLoad = Math.max(0, Math.min(100, load));\n    }\n\n    /**\n     * Get current power allocation from sliders\n     */\n    getPowerAllocation(): PowerAllocation {\n        const thrustSlider = this.interactiveElements.get('thrust_slider');\n        const shieldSlider = this.interactiveElements.get('shield_slider');\n        \n        return {\n            engines: thrustSlider?.value || 30,\n            shields: shieldSlider?.value || 25,\n            weapons: 20,\n            lifeSupport: 15,\n            sensors: 10\n        };\n    }\n}","/**\n * Celestial Body System\n * Handles planets, moons, stars, asteroids with orbital mechanics and interactions\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer, Color } from '@core/Renderer';\nimport { PhysicsObject } from '@core/Physics';\nimport { StarData, PlanetData, MoonData, PlanetType, SurfaceType } from '@procedural/GalaxyGenerator';\n\nexport interface CelestialBodyConfig {\n    renderDistance: number; // Maximum distance to render details\n    orbitLineOpacity: number;\n    showOrbitLines: boolean;\n    animationSpeed: number;\n    minPixelSize: number; // Minimum size for distant objects\n    maxPixelSize: number; // Maximum size for close objects\n}\n\nexport interface InteractionZone {\n    bodyId: string;\n    type: 'orbit' | 'surface' | 'atmosphere';\n    radius: number;\n    distance: number; // Distance from ship\n    canEnter: boolean;\n    requirements?: string[];\n}\n\nexport interface BodyInteraction {\n    onEnterOrbit?: (bodyId: string) => void;\n    onExitOrbit?: (bodyId: string) => void;\n    onLandingAttempt?: (bodyId: string, canLand: boolean) => void;\n    onMining?: (bodyId: string, resources: MiningResult) => void;\n    onScan?: (bodyId: string, scanData: ScanResult) => void;\n}\n\nexport interface MiningResult {\n    resourceType: string;\n    quantity: number;\n    quality: number; // 0-1\n    depletion: number; // How much the resource is depleted\n}\n\nexport interface ScanResult {\n    composition: string[];\n    atmosphere?: AtmosphereData;\n    surfaceConditions: SurfaceConditions;\n    biologicalSigns: boolean;\n    anomalies: string[];\n    mineralDeposits: MineralDeposit[];\n}\n\nexport interface AtmosphereData {\n    pressure: number; // Earth atmospheres\n    composition: { [element: string]: number };\n    breathable: boolean;\n    toxic: boolean;\n    temperature: number; // Kelvin\n}\n\nexport interface SurfaceConditions {\n    temperature: number; // Kelvin\n    gravity: number; // Earth gravities\n    radiation: number; // 0-1 (danger level)\n    weather: string;\n    landingDifficulty: number; // 0-1\n}\n\nexport interface MineralDeposit {\n    type: string;\n    richness: number; // 0-1\n    accessibility: number; // 0-1\n    extractionDifficulty: number; // 0-1\n}\n\nexport class CelestialBody {\n    public id: string;\n    public name: string;\n    public type: 'star' | 'planet' | 'moon' | 'asteroid';\n    public position: Vector2;\n    public velocity: Vector2 = { x: 0, y: 0 };\n    \n    // Visual properties\n    public radius: number;\n    public color: Color;\n    public atmosphereColor?: Color;\n    public hasAtmosphere: boolean = false;\n    public hasRings: boolean = false;\n    public ringColor?: Color;\n    \n    // Orbital mechanics\n    public orbitCenter?: Vector2;\n    public orbitRadius: number = 0;\n    public orbitSpeed: number = 0;\n    public orbitAngle: number = 0;\n    public rotationSpeed: number = 0;\n    public currentRotation: number = 0;\n    \n    // Physics and interaction\n    public mass: number;\n    public physicsObject?: PhysicsObject;\n    public interactionZones: InteractionZone[] = [];\n    \n    // Data\n    public planetData?: PlanetData;\n    public starData?: StarData;\n    public moonData?: MoonData;\n    \n    // Resource data\n    public mineralDeposits: MineralDeposit[] = [];\n    public surfaceConditions?: SurfaceConditions;\n    public atmosphereData?: AtmosphereData;\n    \n    // Interaction state\n    public isDiscovered: boolean = false;\n    public isScanned: boolean = false;\n    public isLanded: boolean = false;\n    public resourcesDepleted: number = 0; // 0-1\n    \n    private logger: Logger;\n\n    constructor(config: {\n        id: string;\n        name: string;\n        type: 'star' | 'planet' | 'moon' | 'asteroid';\n        position: Vector2;\n        radius: number;\n        mass: number;\n        color: Color;\n        planetData?: PlanetData;\n        starData?: StarData;\n        moonData?: MoonData;\n    }) {\n        this.id = config.id;\n        this.name = config.name;\n        this.type = config.type;\n        this.position = { ...config.position };\n        this.radius = config.radius;\n        this.mass = config.mass;\n        this.color = { ...config.color };\n        \n        this.planetData = config.planetData;\n        this.starData = config.starData;\n        this.moonData = config.moonData;\n        \n        this.logger = new Logger(`CelestialBody:${config.name}`);\n        \n        this.initializeFromData();\n        this.generateInteractionZones();\n        this.generateResources();\n        \n        this.logger.debug(`Created ${this.type}: ${this.name}`, {\n            radius: this.radius,\n            mass: this.mass,\n            hasAtmosphere: this.hasAtmosphere\n        });\n    }\n\n    /**\n     * Initialize body properties from data\n     */\n    private initializeFromData(): void {\n        if (this.planetData) {\n            this.hasAtmosphere = this.planetData.hasAtmosphere;\n            this.hasRings = this.planetData.hasRings;\n            \n            // Set colors based on planet type with dark, muted tones\n            this.updatePlanetVisuals();\n            \n            // Setup orbital mechanics\n            if (this.planetData.orbitDistance > 0) {\n                this.orbitRadius = this.planetData.orbitDistance * 50; // Scale for display\n                this.orbitSpeed = 2 * Math.PI / (this.planetData.orbitPeriod / 3600); // Convert to radians per hour\n            }\n            \n            // Rotation (30-frame cycle as specified)\n            this.rotationSpeed = (2 * Math.PI) / 30; // 30 frames for full rotation\n        }\n        \n        if (this.starData) {\n            // Star visual properties with muted glow\n            this.color = this.getDarkStarColor(this.starData.temperature);\n            this.rotationSpeed = (2 * Math.PI) / 60; // Slower star rotation\n        }\n        \n        if (this.moonData) {\n            // Moon properties\n            this.orbitRadius = this.moonData.orbitDistance * 5; // Scale for display\n            this.orbitSpeed = 2 * Math.PI / (this.moonData.orbitPeriod / 60); // Convert to minutes\n            this.rotationSpeed = this.moonData.tidallyLocked ? this.orbitSpeed : (2 * Math.PI) / 45;\n        }\n    }\n\n    /**\n     * Update planet visual properties with dark, atmospheric colors\n     */\n    private updatePlanetVisuals(): void {\n        if (!this.planetData) return;\n        \n        // Dark, muted planet colors based on type\n        switch (this.planetData.type) {\n            case PlanetType.Terrestrial:\n                this.color = { r: 32, g: 24, b: 16 }; // Dark brown/rock\n                if (this.hasAtmosphere) {\n                    this.atmosphereColor = { r: 16, g: 24, b: 32 }; // Dark blue haze\n                }\n                break;\n                \n            case PlanetType.Ocean:\n                this.color = { r: 8, g: 16, b: 32 }; // Deep dark blue\n                this.atmosphereColor = { r: 12, g: 20, b: 28 }; // Muted blue atmosphere\n                break;\n                \n            case PlanetType.Desert:\n                this.color = { r: 48, g: 32, b: 16 }; // Dark sand/rust\n                break;\n                \n            case PlanetType.Volcanic:\n                this.color = { r: 32, g: 16, b: 8 }; // Dark volcanic rock\n                break;\n                \n            case PlanetType.Frozen:\n                this.color = { r: 32, g: 36, b: 40 }; // Dark ice\n                break;\n                \n            case PlanetType.GasGiant:\n                this.color = { r: 40, g: 32, b: 24 }; // Muted gas colors\n                this.atmosphereColor = { r: 32, g: 28, b: 20 }; // Dark atmosphere\n                if (this.hasRings) {\n                    this.ringColor = { r: 24, g: 20, b: 16 }; // Dark ring material\n                }\n                break;\n                \n            case PlanetType.IceGiant:\n                this.color = { r: 16, g: 24, b: 32 }; // Dark blue-gray\n                this.atmosphereColor = { r: 12, g: 20, b: 28 }; // Muted methane haze\n                break;\n                \n            case PlanetType.Toxic:\n                this.color = { r: 32, g: 24, b: 16 }; // Dark toxic surface\n                this.atmosphereColor = { r: 48, g: 32, b: 16 }; // Toxic haze\n                break;\n        }\n    }\n\n    /**\n     * Get dark star color based on temperature\n     */\n    private getDarkStarColor(temperature: number): Color {\n        // Dark, muted star colors (no bright neons)\n        if (temperature > 25000) return { r: 32, g: 36, b: 48 }; // Muted blue\n        if (temperature > 10000) return { r: 40, g: 44, b: 48 }; // Blue-white\n        if (temperature > 7500) return { r: 48, g: 48, b: 48 };  // Muted white\n        if (temperature > 6000) return { r: 48, g: 44, b: 36 };  // Yellow-white\n        if (temperature > 5000) return { r: 48, g: 40, b: 28 };  // Muted yellow\n        if (temperature > 3500) return { r: 48, g: 32, b: 20 };  // Orange\n        return { r: 48, g: 24, b: 16 }; // Dark red\n    }\n\n    /**\n     * Generate interaction zones around the body\n     */\n    private generateInteractionZones(): void {\n        this.interactionZones = [];\n        \n        // Orbit zone (space around the body)\n        this.interactionZones.push({\n            bodyId: this.id,\n            type: 'orbit',\n            radius: this.radius * 3,\n            distance: 0,\n            canEnter: true\n        });\n        \n        // Atmosphere zone (if has atmosphere)\n        if (this.hasAtmosphere) {\n            this.interactionZones.push({\n                bodyId: this.id,\n                type: 'atmosphere',\n                radius: this.radius * 1.5,\n                distance: 0,\n                canEnter: true,\n                requirements: ['heat_shielding']\n            });\n        }\n        \n        // Surface zone (for landing)\n        if (this.type !== 'star') {\n            const canLand = this.canShipLand();\n            this.interactionZones.push({\n                bodyId: this.id,\n                type: 'surface',\n                radius: this.radius,\n                distance: 0,\n                canEnter: canLand,\n                requirements: canLand ? [] : ['specialized_equipment']\n            });\n        }\n    }\n\n    /**\n     * Determine if a ship can land on this body\n     */\n    private canShipLand(): boolean {\n        if (this.type === 'star') return false;\n        if (this.type === 'asteroid') return true; // Can dock with asteroids\n        \n        if (this.planetData) {\n            // Gas giants can't be landed on\n            if (this.planetData.type === PlanetType.GasGiant || \n                this.planetData.type === PlanetType.IceGiant) {\n                return false;\n            }\n            \n            // Very high temperature/pressure is dangerous\n            if (this.planetData.temperature > 1000) return false;\n            \n            return true;\n        }\n        \n        return true; // Moons and unknown bodies default to landable\n    }\n\n    /**\n     * Generate mineral deposits and resources\n     */\n    private generateResources(): void {\n        this.mineralDeposits = [];\n        \n        if (this.type === 'star') return; // Stars don't have mineable resources\n        \n        // Generate resources based on body type\n        const resourceTypes = this.getResourceTypes();\n        \n        resourceTypes.forEach(resourceType => {\n            this.mineralDeposits.push({\n                type: resourceType,\n                richness: Math.random() * 0.7 + 0.3, // 0.3 to 1.0\n                accessibility: Math.random() * 0.8 + 0.2, // 0.2 to 1.0\n                extractionDifficulty: Math.random() * 0.6 + 0.2 // 0.2 to 0.8\n            });\n        });\n        \n        // Generate surface conditions\n        this.generateSurfaceConditions();\n    }\n\n    /**\n     * Get available resource types for this body\n     */\n    private getResourceTypes(): string[] {\n        const baseResources = ['metal', 'crystals'];\n        \n        if (this.type === 'asteroid') {\n            return [...baseResources, 'rare_metals', 'ice'];\n        }\n        \n        if (this.planetData) {\n            switch (this.planetData.type) {\n                case PlanetType.Terrestrial:\n                    return [...baseResources, 'rare_earth', 'radioactive'];\n                case PlanetType.Volcanic:\n                    return [...baseResources, 'sulfur', 'rare_metals'];\n                case PlanetType.Frozen:\n                    return [...baseResources, 'ice', 'frozen_gases'];\n                case PlanetType.Desert:\n                    return [...baseResources, 'silicon', 'rare_earth'];\n                case PlanetType.Ocean:\n                    return [...baseResources, 'deuterium', 'biologics'];\n                default:\n                    return baseResources;\n            }\n        }\n        \n        return baseResources;\n    }\n\n    /**\n     * Generate surface conditions for landing/mining\n     */\n    private generateSurfaceConditions(): void {\n        if (this.type === 'star') return;\n        \n        let temperature = 273; // Default Earth-like\n        let gravity = 1.0;\n        let radiation = 0.0;\n        let weather = 'none';\n        let landingDifficulty = 0.2;\n        \n        if (this.planetData) {\n            temperature = this.planetData.temperature;\n            gravity = Math.sqrt(this.planetData.mass); // Simplified gravity calculation\n            \n            // Radiation based on proximity to star and atmosphere\n            radiation = this.hasAtmosphere ? 0.1 : 0.3;\n            \n            // Weather based on atmosphere and temperature\n            if (this.hasAtmosphere) {\n                if (temperature > 373) weather = 'extreme_heat';\n                else if (temperature < 273) weather = 'frozen';\n                else weather = 'stable';\n            }\n            \n            // Landing difficulty based on conditions\n            landingDifficulty = Math.min(0.9, \n                (Math.abs(temperature - 273) / 500) + \n                (Math.abs(gravity - 1) * 0.3) + \n                (radiation * 0.4)\n            );\n        }\n        \n        this.surfaceConditions = {\n            temperature,\n            gravity,\n            radiation,\n            weather,\n            landingDifficulty\n        };\n    }\n\n    /**\n     * Update orbital mechanics and rotation\n     */\n    update(deltaTime: number): void {\n        // Update orbital position\n        if (this.orbitCenter && this.orbitRadius > 0) {\n            this.orbitAngle += this.orbitSpeed * deltaTime;\n            \n            this.position.x = this.orbitCenter.x + Math.cos(this.orbitAngle) * this.orbitRadius;\n            this.position.y = this.orbitCenter.y + Math.sin(this.orbitAngle) * this.orbitRadius;\n        }\n        \n        // Update rotation (30-frame animation cycle)\n        this.currentRotation += this.rotationSpeed * deltaTime;\n        if (this.currentRotation > 2 * Math.PI) {\n            this.currentRotation -= 2 * Math.PI;\n        }\n        \n        // Update physics object position if exists\n        if (this.physicsObject) {\n            this.physicsObject.position = { ...this.position };\n        }\n    }\n\n    /**\n     * Render the celestial body with dark retro style\n     */\n    render(renderer: Renderer, cameraPosition: Vector2, config: CelestialBodyConfig): void {\n        const distance = this.getDistanceFrom(cameraPosition);\n        \n        // Don't render if too far away\n        if (distance > config.renderDistance) return;\n        \n        // Calculate screen position\n        const screenPos = {\n            x: this.position.x - cameraPosition.x + 512, // Assuming 1024x768 screen\n            y: this.position.y - cameraPosition.y + 384\n        };\n        \n        // Calculate size based on distance\n        const baseSize = this.radius;\n        const scaledSize = Math.max(config.minPixelSize, \n            Math.min(config.maxPixelSize, baseSize * (config.renderDistance / distance)));\n        \n        // Render orbit line if enabled and not too close\n        if (config.showOrbitLines && this.orbitCenter && distance > 100) {\n            this.renderOrbitLine(renderer, cameraPosition, config);\n        }\n        \n        // Render atmosphere if present\n        if (this.hasAtmosphere && this.atmosphereColor) {\n            const atmoSize = scaledSize * 1.3;\n            renderer.drawCircle(screenPos.x, screenPos.y, atmoSize, this.atmosphereColor, true);\n        }\n        \n        // Render rings if present\n        if (this.hasRings && this.ringColor) {\n            this.renderRings(renderer, screenPos, scaledSize);\n        }\n        \n        // Render main body\n        renderer.drawCircle(screenPos.x, screenPos.y, scaledSize, this.color, true);\n        \n        // Add subtle rotation texture for planets\n        if (this.type === 'planet' && scaledSize > 8) {\n            this.renderSurfaceDetails(renderer, screenPos, scaledSize);\n        }\n        \n        // Render star glow effect (very subtle)\n        if (this.type === 'star') {\n            this.renderStarGlow(renderer, screenPos, scaledSize);\n        }\n        \n        // Render name if close enough and discovered\n        if (distance < config.renderDistance / 3 && this.isDiscovered) {\n            renderer.renderText(this.name, screenPos.x - 20, screenPos.y - scaledSize - 15, \n                { r: 48, g: 48, b: 48 }, 8);\n        }\n    }\n\n    /**\n     * Render orbit line with dark, subtle styling\n     */\n    private renderOrbitLine(renderer: Renderer, cameraPosition: Vector2, config: CelestialBodyConfig): void {\n        if (!this.orbitCenter) return;\n        \n        const centerScreen = {\n            x: this.orbitCenter.x - cameraPosition.x + 512,\n            y: this.orbitCenter.y - cameraPosition.y + 384\n        };\n        \n        // Render faint orbit line\n        const orbitColor = { \n            r: Math.floor(this.color.r * 0.3), \n            g: Math.floor(this.color.g * 0.3), \n            b: Math.floor(this.color.b * 0.3) \n        };\n        \n        renderer.drawCircle(centerScreen.x, centerScreen.y, this.orbitRadius, orbitColor, false);\n    }\n\n    /**\n     * Render planet rings with dark styling\n     */\n    private renderRings(renderer: Renderer, screenPos: Vector2, size: number): void {\n        if (!this.ringColor) return;\n        \n        const innerRadius = size * 1.5;\n        const outerRadius = size * 2.2;\n        \n        // Draw ring segments\n        for (let radius = innerRadius; radius < outerRadius; radius += 2) {\n            const alpha = 1 - ((radius - innerRadius) / (outerRadius - innerRadius)) * 0.7;\n            const ringColor = {\n                r: Math.floor(this.ringColor.r * alpha),\n                g: Math.floor(this.ringColor.g * alpha),\n                b: Math.floor(this.ringColor.b * alpha)\n            };\n            \n            renderer.drawCircle(screenPos.x, screenPos.y, radius, ringColor, false);\n        }\n    }\n\n    /**\n     * Render surface details with 30-frame rotation\n     */\n    private renderSurfaceDetails(renderer: Renderer, screenPos: Vector2, size: number): void {\n        const rotationFrame = Math.floor((this.currentRotation / (2 * Math.PI)) * 30);\n        \n        // Simple surface features that rotate\n        for (let i = 0; i < 3; i++) {\n            const angle = (i * 2 * Math.PI / 3) + this.currentRotation;\n            const featureX = screenPos.x + Math.cos(angle) * (size * 0.6);\n            const featureY = screenPos.y + Math.sin(angle) * (size * 0.3); // Flattened for 2D view\n            \n            // Dark surface features\n            const featureColor = {\n                r: Math.max(0, this.color.r - 8),\n                g: Math.max(0, this.color.g - 8),\n                b: Math.max(0, this.color.b - 8)\n            };\n            \n            renderer.fillRect(featureX - 1, featureY - 1, 2, 2, featureColor);\n        }\n    }\n\n    /**\n     * Render subtle star glow effect\n     */\n    private renderStarGlow(renderer: Renderer, screenPos: Vector2, size: number): void {\n        // Very subtle glow effect (no bright neons)\n        const glowColor = {\n            r: Math.min(64, this.color.r + 16),\n            g: Math.min(64, this.color.g + 16),\n            b: Math.min(64, this.color.b + 16)\n        };\n        \n        renderer.drawCircle(screenPos.x, screenPos.y, size * 1.2, glowColor, false);\n    }\n\n    /**\n     * Check for ship interactions\n     */\n    checkInteraction(shipPosition: Vector2): InteractionZone | null {\n        const distance = this.getDistanceFrom(shipPosition);\n        \n        // Check each interaction zone\n        for (const zone of this.interactionZones) {\n            if (distance <= zone.radius) {\n                zone.distance = distance;\n                return zone;\n            }\n        }\n        \n        return null;\n    }\n\n    /**\n     * Perform mining operation\n     */\n    performMining(shipPosition: Vector2, miningEfficiency: number = 1.0): MiningResult | null {\n        const interaction = this.checkInteraction(shipPosition);\n        \n        if (!interaction || interaction.type !== 'surface') {\n            return null;\n        }\n        \n        // Find best resource to mine\n        const availableResources = this.mineralDeposits.filter(deposit => \n            deposit.richness > this.resourcesDepleted\n        );\n        \n        if (availableResources.length === 0) {\n            return null;\n        }\n        \n        const resource = availableResources[0]; // Mine the first available resource\n        const extractedQuantity = resource.richness * resource.accessibility * miningEfficiency;\n        \n        // Deplete resources\n        resource.richness = Math.max(0, resource.richness - 0.05);\n        this.resourcesDepleted = Math.min(1, this.resourcesDepleted + 0.02);\n        \n        return {\n            resourceType: resource.type,\n            quantity: extractedQuantity,\n            quality: resource.accessibility,\n            depletion: this.resourcesDepleted\n        };\n    }\n\n    /**\n     * Perform detailed scan\n     */\n    performScan(): ScanResult {\n        this.isScanned = true;\n        \n        return {\n            composition: this.getResourceTypes(),\n            atmosphere: this.atmosphereData,\n            surfaceConditions: this.surfaceConditions!,\n            biologicalSigns: this.planetData?.hasLife || false,\n            anomalies: [], // TODO: Generate anomalies\n            mineralDeposits: [...this.mineralDeposits]\n        };\n    }\n\n    /**\n     * Get distance from a position\n     */\n    getDistanceFrom(position: Vector2): number {\n        const dx = this.position.x - position.x;\n        const dy = this.position.y - position.y;\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    /**\n     * Set orbit around another body\n     */\n    setOrbit(center: Vector2, radius: number, speed: number): void {\n        this.orbitCenter = { ...center };\n        this.orbitRadius = radius;\n        this.orbitSpeed = speed;\n    }\n\n    /**\n     * Get interaction info for UI\n     */\n    getInteractionInfo(): string {\n        if (!this.isDiscovered) return 'Unknown Object';\n        \n        let info = `${this.name} (${this.type.toUpperCase()})`;\n        \n        if (this.surfaceConditions) {\n            info += `\\nTemp: ${this.surfaceConditions.temperature.toFixed(0)}K`;\n            info += `\\nGravity: ${this.surfaceConditions.gravity.toFixed(1)}g`;\n            \n            if (this.mineralDeposits.length > 0) {\n                info += `\\nResources: ${this.mineralDeposits.length} types`;\n            }\n        }\n        \n        return info;\n    }\n}","/**\n * Interaction Panel UI\n * Popup window for celestial body interactions with retro CRT styling\n */\n\nimport { Renderer, Color, Vector2 } from '@core/Renderer';\nimport { InputManager } from '@core/InputManager';\nimport { Logger } from '@utils/Logger';\nimport { InteractionZone, CelestialBody, ScanResult, MiningResult } from '@entities/CelestialBody';\n\nexport interface InteractionPanelConfig {\n    enableAnimations: boolean;\n    fadeSpeed: number;\n    maxWidth: number;\n    maxHeight: number;\n}\n\nexport interface PanelInteractions {\n    onEnterOrbit?: (bodyId: string) => void;\n    onLand?: (bodyId: string) => void;\n    onContinueFlight?: () => void;\n    onStartMining?: (bodyId: string) => void;\n    onPerformScan?: (bodyId: string) => void;\n    onExitOrbit?: (bodyId: string) => void;\n}\n\ninterface InteractionButton {\n    id: string;\n    label: string;\n    x: number;\n    y: number;\n    width: number;\n    height: number;\n    enabled: boolean;\n    color: Color;\n    requirements?: string[];\n}\n\nexport class InteractionPanel {\n    private config: InteractionPanelConfig;\n    private interactions: PanelInteractions;\n    \n    // Panel state\n    private isVisible: boolean = false;\n    private currentBody: CelestialBody | null = null;\n    private currentZone: InteractionZone | null = null;\n    private opacity: number = 0;\n    private targetOpacity: number = 0;\n    \n    // Panel layout\n    private panelX: number = 0;\n    private panelY: number = 0;\n    private panelWidth: number = 0;\n    private panelHeight: number = 0;\n    \n    // Interactive elements\n    private buttons: InteractionButton[] = [];\n    private hoveredButton: string | null = null;\n    private selectedButton: string | null = null;\n    \n    // Content data\n    private bodyInfo: string = '';\n    private scanData: ScanResult | null = null;\n    private miningResults: MiningResult[] = [];\n    \n    private logger: Logger;\n\n    constructor(\n        config: Partial<InteractionPanelConfig> = {},\n        interactions: PanelInteractions = {}\n    ) {\n        this.logger = new Logger('InteractionPanel');\n        this.interactions = interactions;\n        \n        this.config = {\n            enableAnimations: true,\n            fadeSpeed: 3.0,\n            maxWidth: 300,\n            maxHeight: 200,\n            ...config\n        };\n        \n        this.logger.info('📱 Interaction panel initialized');\n    }\n\n    /**\n     * Show interaction panel for a celestial body\n     */\n    showInteraction(body: CelestialBody, zone: InteractionZone, shipPosition: Vector2): void {\n        this.currentBody = body;\n        this.currentZone = zone;\n        this.bodyInfo = body.getInteractionInfo();\n        \n        // Calculate panel position near the body\n        this.calculatePanelPosition(body.position, shipPosition);\n        \n        // Setup buttons based on interaction type\n        this.setupButtons();\n        \n        // Show panel with animation\n        this.targetOpacity = 1.0;\n        this.isVisible = true;\n        \n        this.logger.debug(`Showing interaction for ${body.name}`, {\n            type: zone.type,\n            canEnter: zone.canEnter\n        });\n    }\n\n    /**\n     * Hide the interaction panel\n     */\n    hideInteraction(): void {\n        this.targetOpacity = 0.0;\n        \n        // Reset after fade out\n        setTimeout(() => {\n            if (this.targetOpacity === 0) {\n                this.isVisible = false;\n                this.currentBody = null;\n                this.currentZone = null;\n                this.scanData = null;\n                this.miningResults = [];\n            }\n        }, this.config.enableAnimations ? 500 : 0);\n        \n        this.logger.debug('Hiding interaction panel');\n    }\n\n    /**\n     * Calculate optimal panel position\n     */\n    private calculatePanelPosition(bodyPosition: Vector2, shipPosition: Vector2): void {\n        // Base position relative to body (convert world to screen coordinates)\n        const screenBodyX = bodyPosition.x - shipPosition.x + 512;\n        const screenBodyY = bodyPosition.y - shipPosition.y + 384;\n        \n        // Panel dimensions\n        this.panelWidth = Math.min(this.config.maxWidth, 280);\n        this.panelHeight = Math.min(this.config.maxHeight, 180);\n        \n        // Position panel to the right of the body, avoiding screen edges\n        this.panelX = screenBodyX + 60;\n        this.panelY = screenBodyY - this.panelHeight / 2;\n        \n        // Keep panel on screen\n        if (this.panelX + this.panelWidth > 1024) {\n            this.panelX = screenBodyX - this.panelWidth - 60; // Move to left side\n        }\n        \n        if (this.panelY < 20) this.panelY = 20;\n        if (this.panelY + this.panelHeight > 500) { // Avoid cockpit area\n            this.panelY = 500 - this.panelHeight;\n        }\n    }\n\n    /**\n     * Setup interaction buttons based on current zone\n     */\n    private setupButtons(): void {\n        this.buttons = [];\n        \n        if (!this.currentZone || !this.currentBody) return;\n        \n        const buttonWidth = 80;\n        const buttonHeight = 25;\n        const buttonSpacing = 10;\n        let currentY = this.panelY + 80;\n        \n        // Enter Orbit button\n        if (this.currentZone.type === 'orbit' && this.currentZone.canEnter) {\n            this.buttons.push({\n                id: 'enter_orbit',\n                label: 'ENTER ORBIT',\n                x: this.panelX + 10,\n                y: currentY,\n                width: buttonWidth,\n                height: buttonHeight,\n                enabled: true,\n                color: { r: 16, g: 48, b: 16 } // Dark green\n            });\n            currentY += buttonHeight + buttonSpacing;\n        }\n        \n        // Land button\n        if (this.currentZone.type === 'surface' && this.currentZone.canEnter) {\n            this.buttons.push({\n                id: 'land',\n                label: 'LAND',\n                x: this.panelX + 10,\n                y: currentY,\n                width: buttonWidth,\n                height: buttonHeight,\n                enabled: true,\n                color: { r: 72, g: 48, b: 12 } // Dark amber\n            });\n            currentY += buttonHeight + buttonSpacing;\n        }\n        \n        // Scan button (always available when close)\n        this.buttons.push({\n            id: 'scan',\n            label: 'SCAN',\n            x: this.panelX + 100,\n            y: this.panelY + 80,\n            width: buttonWidth,\n            height: buttonHeight,\n            enabled: true,\n            color: { r: 16, g: 40, b: 32 } // Dark teal\n        });\n        \n        // Mining button (if landed or in atmosphere)\n        if (this.currentZone.type === 'surface' || this.currentZone.type === 'atmosphere') {\n            if (this.currentBody.mineralDeposits.length > 0) {\n                this.buttons.push({\n                    id: 'mine',\n                    label: 'MINE',\n                    x: this.panelX + 100,\n                    y: this.panelY + 110,\n                    width: buttonWidth,\n                    height: buttonHeight,\n                    enabled: this.currentBody.resourcesDepleted < 0.9,\n                    color: { r: 48, g: 32, b: 16 } // Dark orange\n                });\n            }\n        }\n        \n        // Continue Flight button (always present)\n        this.buttons.push({\n            id: 'continue',\n            label: 'CONTINUE',\n            x: this.panelX + 10,\n            y: this.panelY + this.panelHeight - 35,\n            width: this.panelWidth - 20,\n            height: buttonHeight,\n            enabled: true,\n            color: { r: 32, g: 32, b: 32 } // Gray\n        });\n    }\n\n    /**\n     * Update panel state\n     */\n    update(deltaTime: number, input: InputManager): void {\n        if (!this.isVisible && this.targetOpacity === 0) return;\n        \n        // Update opacity animation\n        if (this.config.enableAnimations) {\n            if (this.opacity < this.targetOpacity) {\n                this.opacity = Math.min(this.targetOpacity, this.opacity + this.config.fadeSpeed * deltaTime);\n            } else if (this.opacity > this.targetOpacity) {\n                this.opacity = Math.max(this.targetOpacity, this.opacity - this.config.fadeSpeed * deltaTime);\n            }\n        } else {\n            this.opacity = this.targetOpacity;\n        }\n        \n        // Handle input if visible\n        if (this.isVisible && this.opacity > 0.5) {\n            this.handleInput(input);\n        }\n    }\n\n    /**\n     * Handle user input\n     */\n    private handleInput(input: InputManager): void {\n        const mousePos = input.getMousePosition();\n        \n        // Check for button hover\n        this.hoveredButton = null;\n        for (const button of this.buttons) {\n            if (this.isPointInButton(mousePos, button)) {\n                this.hoveredButton = button.id;\n                break;\n            }\n        }\n        \n        // Handle button clicks\n        if (input.isMouseButtonPressed(0) && this.hoveredButton) {\n            this.handleButtonClick(this.hoveredButton);\n        }\n        \n        // Handle keyboard shortcuts\n        if (input.isKeyPressed('KeyE')) {\n            this.handleButtonClick('enter_orbit');\n        } else if (input.isKeyPressed('KeyL')) {\n            this.handleButtonClick('land');\n        } else if (input.isKeyPressed('KeyS')) {\n            this.handleButtonClick('scan');\n        } else if (input.isKeyPressed('KeyM')) {\n            this.handleButtonClick('mine');\n        } else if (input.isKeyPressed('KeyC') || input.isKeyPressed('Escape')) {\n            this.handleButtonClick('continue');\n        }\n    }\n\n    /**\n     * Check if point is inside button\n     */\n    private isPointInButton(point: Vector2, button: InteractionButton): boolean {\n        return point.x >= button.x && \n               point.x <= button.x + button.width &&\n               point.y >= button.y && \n               point.y <= button.y + button.height;\n    }\n\n    /**\n     * Handle button clicks\n     */\n    private handleButtonClick(buttonId: string): void {\n        if (!this.currentBody) return;\n        \n        const button = this.buttons.find(b => b.id === buttonId);\n        if (!button || !button.enabled) return;\n        \n        switch (buttonId) {\n            case 'enter_orbit':\n                this.interactions.onEnterOrbit?.(this.currentBody.id);\n                this.logger.info(`🛰️ Entering orbit around ${this.currentBody.name}`);\n                this.hideInteraction();\n                break;\n                \n            case 'land':\n                this.interactions.onLand?.(this.currentBody.id);\n                this.logger.info(`🚁 Landing on ${this.currentBody.name}`);\n                this.hideInteraction();\n                break;\n                \n            case 'scan':\n                this.performScan();\n                break;\n                \n            case 'mine':\n                this.performMining();\n                break;\n                \n            case 'continue':\n                this.interactions.onContinueFlight?.();\n                this.hideInteraction();\n                break;\n        }\n    }\n\n    /**\n     * Perform scan operation\n     */\n    private performScan(): void {\n        if (!this.currentBody) return;\n        \n        this.scanData = this.currentBody.performScan();\n        this.currentBody.isDiscovered = true;\n        \n        this.interactions.onPerformScan?.(this.currentBody.id);\n        \n        this.logger.info(`🔍 Scanned ${this.currentBody.name}`, {\n            composition: this.scanData.composition,\n            biologicalSigns: this.scanData.biologicalSigns\n        });\n        \n        // Refresh body info with scan data\n        this.bodyInfo = this.currentBody.getInteractionInfo();\n    }\n\n    /**\n     * Perform mining operation\n     */\n    private performMining(): void {\n        if (!this.currentBody) return;\n        \n        const shipPosition = { x: 0, y: 0 }; // TODO: Get actual ship position\n        const result = this.currentBody.performMining(shipPosition, 1.0);\n        \n        if (result) {\n            this.miningResults.push(result);\n            this.interactions.onStartMining?.(this.currentBody.id);\n            \n            this.logger.info(`⛏️ Mined ${result.quantity.toFixed(2)} ${result.resourceType}`, {\n                quality: result.quality,\n                depletion: result.depletion\n            });\n            \n            // Update button state if resources depleted\n            if (result.depletion > 0.9) {\n                const mineButton = this.buttons.find(b => b.id === 'mine');\n                if (mineButton) {\n                    mineButton.enabled = false;\n                    mineButton.color = { r: 24, g: 24, b: 24 }; // Disabled gray\n                }\n            }\n        }\n    }\n\n    /**\n     * Render the interaction panel\n     */\n    render(renderer: Renderer): void {\n        if (!this.isVisible || this.opacity <= 0) return;\n        \n        // Apply opacity to all colors\n        const alpha = this.opacity;\n        \n        // Render panel background (dark CRT monitor style)\n        const bgColor = { \n            r: Math.floor(8 * alpha), \n            g: Math.floor(12 * alpha), \n            b: Math.floor(8 * alpha) \n        };\n        renderer.fillRect(this.panelX, this.panelY, this.panelWidth, this.panelHeight, bgColor);\n        \n        // Panel border (dark green CRT glow)\n        const borderColor = { \n            r: Math.floor(16 * alpha), \n            g: Math.floor(48 * alpha), \n            b: Math.floor(16 * alpha) \n        };\n        this.renderPanelBorder(renderer, borderColor);\n        \n        // Panel title\n        const titleColor = { \n            r: Math.floor(12 * alpha), \n            g: Math.floor(36 * alpha), \n            b: Math.floor(12 * alpha) \n        };\n        renderer.renderText('PROXIMITY ALERT', this.panelX + 10, this.panelY + 10, titleColor, 10);\n        \n        // Body information\n        if (this.bodyInfo) {\n            this.renderBodyInfo(renderer, alpha);\n        }\n        \n        // Scan data\n        if (this.scanData) {\n            this.renderScanData(renderer, alpha);\n        }\n        \n        // Mining results\n        if (this.miningResults.length > 0) {\n            this.renderMiningResults(renderer, alpha);\n        }\n        \n        // Render buttons\n        this.renderButtons(renderer, alpha);\n        \n        // Render CRT effects\n        this.renderCRTEffects(renderer, alpha);\n    }\n\n    /**\n     * Render panel border with CRT styling\n     */\n    private renderPanelBorder(renderer: Renderer, color: Color): void {\n        // Top and bottom borders\n        renderer.fillRect(this.panelX, this.panelY, this.panelWidth, 2, color);\n        renderer.fillRect(this.panelX, this.panelY + this.panelHeight - 2, this.panelWidth, 2, color);\n        \n        // Left and right borders\n        renderer.fillRect(this.panelX, this.panelY, 2, this.panelHeight, color);\n        renderer.fillRect(this.panelX + this.panelWidth - 2, this.panelY, 2, this.panelHeight, color);\n        \n        // Corner highlights\n        const highlightColor = { r: color.r + 8, g: color.g + 8, b: color.b + 8 };\n        renderer.fillRect(this.panelX, this.panelY, 8, 2, highlightColor);\n        renderer.fillRect(this.panelX, this.panelY, 2, 8, highlightColor);\n    }\n\n    /**\n     * Render body information\n     */\n    private renderBodyInfo(renderer: Renderer, alpha: number): void {\n        const textColor = { \n            r: Math.floor(48 * alpha), \n            g: Math.floor(48 * alpha), \n            b: Math.floor(48 * alpha) \n        };\n        \n        const lines = this.bodyInfo.split('\\n');\n        let y = this.panelY + 30;\n        \n        lines.forEach(line => {\n            renderer.renderText(line, this.panelX + 10, y, textColor, 8);\n            y += 12;\n        });\n    }\n\n    /**\n     * Render scan data\n     */\n    private renderScanData(renderer: Renderer, alpha: number): void {\n        if (!this.scanData) return;\n        \n        const textColor = { \n            r: Math.floor(32 * alpha), \n            g: Math.floor(80 * alpha), \n            b: Math.floor(64 * alpha) \n        };\n        \n        let y = this.panelY + 30;\n        \n        renderer.renderText(`COMP: ${this.scanData.composition.join(', ')}`, \n            this.panelX + 10, y, textColor, 7);\n        y += 10;\n        \n        if (this.scanData.biologicalSigns) {\n            renderer.renderText('BIO: DETECTED', this.panelX + 10, y, \n                { r: Math.floor(96 * alpha), g: Math.floor(64 * alpha), b: Math.floor(16 * alpha) }, 7);\n            y += 10;\n        }\n        \n        renderer.renderText(`MINERALS: ${this.scanData.mineralDeposits.length}`, \n            this.panelX + 10, y, textColor, 7);\n    }\n\n    /**\n     * Render mining results\n     */\n    private renderMiningResults(renderer: Renderer, alpha: number): void {\n        const textColor = { \n            r: Math.floor(96 * alpha), \n            g: Math.floor(64 * alpha), \n            b: Math.floor(16 * alpha) \n        };\n        \n        const lastResult = this.miningResults[this.miningResults.length - 1];\n        const y = this.panelY + this.panelHeight - 60;\n        \n        renderer.renderText(`MINED: ${lastResult.quantity.toFixed(1)} ${lastResult.resourceType}`, \n            this.panelX + 10, y, textColor, 8);\n    }\n\n    /**\n     * Render interactive buttons\n     */\n    private renderButtons(renderer: Renderer, alpha: number): void {\n        this.buttons.forEach(button => {\n            const isHovered = this.hoveredButton === button.id;\n            const buttonAlpha = button.enabled ? alpha : alpha * 0.5;\n            \n            // Button background\n            const bgColor = isHovered ? \n                { \n                    r: Math.floor((button.color.r + 16) * buttonAlpha), \n                    g: Math.floor((button.color.g + 16) * buttonAlpha), \n                    b: Math.floor((button.color.b + 16) * buttonAlpha) \n                } : \n                { \n                    r: Math.floor(button.color.r * buttonAlpha), \n                    g: Math.floor(button.color.g * buttonAlpha), \n                    b: Math.floor(button.color.b * buttonAlpha) \n                };\n            \n            renderer.fillRect(button.x, button.y, button.width, button.height, bgColor);\n            \n            // Button border\n            const borderColor = { \n                r: Math.floor((button.color.r + 32) * buttonAlpha), \n                g: Math.floor((button.color.g + 32) * buttonAlpha), \n                b: Math.floor((button.color.b + 32) * buttonAlpha) \n            };\n            renderer.drawLine(button.x, button.y, button.x + button.width, button.y, borderColor);\n            renderer.drawLine(button.x, button.y, button.x, button.y + button.height, borderColor);\n            \n            // Button text\n            const textColor = button.enabled ? \n                { \n                    r: Math.floor(64 * alpha), \n                    g: Math.floor(64 * alpha), \n                    b: Math.floor(64 * alpha) \n                } : \n                { \n                    r: Math.floor(32 * alpha), \n                    g: Math.floor(32 * alpha), \n                    b: Math.floor(32 * alpha) \n                };\n            \n            const textX = button.x + (button.width - button.label.length * 6) / 2;\n            const textY = button.y + (button.height - 8) / 2;\n            renderer.renderText(button.label, textX, textY, textColor, 8);\n        });\n    }\n\n    /**\n     * Render CRT effects\n     */\n    private renderCRTEffects(renderer: Renderer, alpha: number): void {\n        // Subtle scanline effect across the panel\n        for (let y = this.panelY; y < this.panelY + this.panelHeight; y += 4) {\n            const scanlineColor = { \n                r: Math.floor(4 * alpha), \n                g: Math.floor(8 * alpha), \n                b: Math.floor(4 * alpha) \n            };\n            renderer.fillRect(this.panelX, y, this.panelWidth, 1, scanlineColor);\n        }\n    }\n\n    /**\n     * Check if panel is currently visible\n     */\n    isInteractionVisible(): boolean {\n        return this.isVisible;\n    }\n\n    /**\n     * Get current interaction body\n     */\n    getCurrentBody(): CelestialBody | null {\n        return this.currentBody;\n    }\n}","/**\n * Celestial Body Manager\n * Manages all celestial bodies in the current star system\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer } from '@core/Renderer';\nimport { CelestialBody, CelestialBodyConfig, BodyInteraction, InteractionZone } from '@entities/CelestialBody';\nimport { InteractionPanel, PanelInteractions } from '@ui/InteractionPanel';\nimport { StarSystemData, PlanetData, StarData } from '@procedural/GalaxyGenerator';\nimport { InputManager } from '@core/InputManager';\n\nexport interface CelestialManagerConfig {\n    renderDistance: number;\n    interactionDistance: number;\n    showOrbitLines: boolean;\n    enableInteractions: boolean;\n    celestialBodyConfig: CelestialBodyConfig;\n}\n\nexport interface SystemLoadConfig {\n    systemData: StarSystemData;\n    playerStartPosition?: Vector2;\n    cameraPosition: Vector2;\n}\n\nexport class CelestialManager {\n    private bodies: Map<string, CelestialBody> = new Map();\n    private interactionPanel: InteractionPanel;\n    private config: CelestialManagerConfig;\n    \n    // Current system data\n    private currentSystem: StarSystemData | null = null;\n    private systemCenter: Vector2 = { x: 512, y: 384 };\n    \n    // Interaction state\n    private nearbyBodies: CelestialBody[] = [];\n    private currentInteraction: { body: CelestialBody; zone: InteractionZone } | null = null;\n    \n    // Performance tracking\n    private lastUpdateTime: number = 0;\n    private frameCount: number = 0;\n    \n    private logger: Logger;\n\n    constructor(\n        config: Partial<CelestialManagerConfig> = {},\n        panelInteractions: PanelInteractions = {}\n    ) {\n        this.logger = new Logger('CelestialManager');\n        \n        this.config = {\n            renderDistance: 2000,\n            interactionDistance: 150,\n            showOrbitLines: true,\n            enableInteractions: true,\n            celestialBodyConfig: {\n                renderDistance: 2000,\n                orbitLineOpacity: 0.3,\n                showOrbitLines: true,\n                animationSpeed: 1.0,\n                minPixelSize: 2,\n                maxPixelSize: 80\n            },\n            ...config\n        };\n        \n        // Initialize interaction panel\n        this.interactionPanel = new InteractionPanel({\n            enableAnimations: true,\n            fadeSpeed: 3.0,\n            maxWidth: 300,\n            maxHeight: 200\n        }, panelInteractions);\n        \n        this.logger.info('🌌 Celestial manager initialized', {\n            renderDistance: this.config.renderDistance,\n            enableInteractions: this.config.enableInteractions\n        });\n    }\n\n    /**\n     * Load a star system\n     */\n    loadSystem(systemConfig: SystemLoadConfig): void {\n        this.logger.info(`🌟 Loading star system: ${systemConfig.systemData.name}`);\n        \n        // Clear existing bodies\n        this.clearSystem();\n        \n        // Store system data\n        this.currentSystem = systemConfig.systemData;\n        this.systemCenter = systemConfig.cameraPosition;\n        \n        // Create star\n        this.createStar(systemConfig.systemData.star);\n        \n        // Create planets\n        systemConfig.systemData.planets.forEach((planetData, index) => {\n            this.createPlanet(planetData, index);\n        });\n        \n        // Create moons for planets\n        systemConfig.systemData.planets.forEach(planetData => {\n            if (planetData.moons && planetData.moons.length > 0) {\n                planetData.moons.forEach(moonData => {\n                    this.createMoon(moonData, planetData);\n                });\n            }\n        });\n        \n        // Setup orbital mechanics\n        this.setupOrbitalMechanics();\n        \n        this.logger.info(`✅ System loaded: ${this.bodies.size} celestial bodies created`);\n    }\n\n    /**\n     * Create star from data\n     */\n    private createStar(starData: StarData): void {\n        const star = new CelestialBody({\n            id: starData.id,\n            name: starData.name,\n            type: 'star',\n            position: { ...this.systemCenter },\n            radius: Math.min(starData.radius * 20, 80), // Scale for visibility\n            mass: starData.mass * 1000000,\n            color: this.getStarColor(starData.temperature),\n            starData: starData\n        });\n        \n        // Mark as discovered (stars are always visible)\n        star.isDiscovered = true;\n        \n        this.bodies.set(star.id, star);\n        this.logger.debug(`⭐ Created star: ${star.name}`);\n    }\n\n    /**\n     * Get star color based on temperature (dark retro style)\n     */\n    private getStarColor(temperature: number): { r: number, g: number, b: number } {\n        // Dark, muted star colors\n        if (temperature > 25000) return { r: 32, g: 36, b: 48 }; // Blue giant\n        if (temperature > 10000) return { r: 40, g: 44, b: 48 }; // Blue-white\n        if (temperature > 7500) return { r: 48, g: 48, b: 48 };  // White\n        if (temperature > 6000) return { r: 48, g: 44, b: 36 };  // Yellow-white (Sun-like)\n        if (temperature > 5000) return { r: 48, g: 40, b: 28 };  // Yellow\n        if (temperature > 3500) return { r: 48, g: 32, b: 20 };  // Orange\n        return { r: 48, g: 24, b: 16 }; // Red dwarf\n    }\n\n    /**\n     * Create planet from data\n     */\n    private createPlanet(planetData: PlanetData, index: number): void {\n        // Calculate position in orbit around star\n        const angle = (index * Math.PI * 2) / (this.currentSystem?.planets.length || 1);\n        const orbitDistance = 150 + (planetData.orbitDistance * 30); // Scale for screen\n        \n        const position = {\n            x: this.systemCenter.x + Math.cos(angle) * orbitDistance,\n            y: this.systemCenter.y + Math.sin(angle) * orbitDistance\n        };\n        \n        const planet = new CelestialBody({\n            id: planetData.id,\n            name: planetData.name,\n            type: 'planet',\n            position: position,\n            radius: Math.max(planetData.radius * 10, 15), // Scale for visibility\n            mass: planetData.mass * 10000,\n            color: this.getPlanetColor(planetData),\n            planetData: planetData\n        });\n        \n        // Set orbital mechanics\n        planet.setOrbit(\n            { ...this.systemCenter },\n            orbitDistance,\n            2 * Math.PI / (planetData.orbitPeriod / 3600) // Convert to radians per hour\n        );\n        \n        this.bodies.set(planet.id, planet);\n        this.logger.debug(`🪐 Created planet: ${planet.name}`);\n    }\n\n    /**\n     * Get planet color based on type and surface (dark retro style)\n     */\n    private getPlanetColor(planetData: PlanetData): { r: number, g: number, b: number } {\n        // Dark, muted planet colors based on surface type and planet type\n        const surfaceType = planetData.surfaceType as string;\n        switch (surfaceType) {\n            case 'Rocky': return { r: 32, g: 24, b: 16 };\n            case 'Desert': return { r: 48, g: 32, b: 16 };\n            case 'Ocean': return { r: 8, g: 16, b: 32 };\n            case 'Ice': return { r: 32, g: 36, b: 40 };\n            case 'Lava': return { r: 32, g: 16, b: 8 };\n            case 'Gas': return { r: 40, g: 32, b: 24 };\n            case 'Toxic': return { r: 32, g: 24, b: 16 };\n            case 'Crystalline': return { r: 24, g: 32, b: 36 };\n            default: return { r: 24, g: 24, b: 24 };\n        }\n    }\n\n    /**\n     * Create moon from data\n     */\n    private createMoon(moonData: any, parentPlanet: PlanetData): void {\n        const parentBody = this.bodies.get(parentPlanet.id);\n        if (!parentBody) return;\n        \n        // Position moon around parent planet\n        const angle = Math.random() * Math.PI * 2;\n        const orbitDistance = moonData.orbitDistance * 3; // Scale for screen\n        \n        const position = {\n            x: parentBody.position.x + Math.cos(angle) * orbitDistance,\n            y: parentBody.position.y + Math.sin(angle) * orbitDistance\n        };\n        \n        const moon = new CelestialBody({\n            id: moonData.id,\n            name: moonData.name,\n            type: 'moon',\n            position: position,\n            radius: Math.max(moonData.radius * 8, 8), // Scale for visibility\n            mass: moonData.mass * 10000,\n            color: { r: 24, g: 24, b: 24 }, // Dark gray for moons\n            moonData: moonData\n        });\n        \n        // Set orbital mechanics around parent planet\n        moon.setOrbit(\n            { ...parentBody.position },\n            orbitDistance,\n            2 * Math.PI / (moonData.orbitPeriod / 60) // Convert to radians per minute\n        );\n        \n        this.bodies.set(moon.id, moon);\n        this.logger.debug(`🌙 Created moon: ${moon.name} (around ${parentPlanet.name})`);\n    }\n\n    /**\n     * Setup orbital mechanics for all bodies\n     */\n    private setupOrbitalMechanics(): void {\n        // Update moon orbits to follow their parent planets\n        this.bodies.forEach(body => {\n            if (body.type === 'moon' && body.moonData) {\n                const parentPlanet = Array.from(this.bodies.values()).find(planet => \n                    planet.type === 'planet' && planet.planetData?.moons?.some(moon => moon.id === body.id)\n                );\n                \n                if (parentPlanet) {\n                    // Moon orbit follows planet position\n                    const originalSetOrbit = body.setOrbit.bind(body);\n                    body.setOrbit = (center, radius, speed) => {\n                        // Update orbit center to parent planet's current position\n                        originalSetOrbit(parentPlanet.position, radius, speed);\n                    };\n                }\n            }\n        });\n    }\n\n    /**\n     * Update all celestial bodies\n     */\n    update(deltaTime: number, input: InputManager, shipPosition: Vector2): void {\n        this.lastUpdateTime = deltaTime;\n        this.frameCount++;\n        \n        // Update all celestial bodies\n        this.bodies.forEach(body => {\n            body.update(deltaTime);\n        });\n        \n        // Update interactions if enabled\n        if (this.config.enableInteractions) {\n            this.updateInteractions(shipPosition, input);\n        }\n        \n        // Update interaction panel\n        this.interactionPanel.update(deltaTime, input);\n    }\n\n    /**\n     * Update interaction system\n     */\n    private updateInteractions(shipPosition: Vector2, input: InputManager): void {\n        // Find nearby bodies\n        this.nearbyBodies = [];\n        let closestInteraction: { body: CelestialBody; zone: InteractionZone } | null = null;\n        let closestDistance = Infinity;\n        \n        this.bodies.forEach(body => {\n            const distance = body.getDistanceFrom(shipPosition);\n            \n            if (distance <= this.config.interactionDistance) {\n                this.nearbyBodies.push(body);\n                \n                // Check for interaction zones\n                const zone = body.checkInteraction(shipPosition);\n                if (zone && distance < closestDistance) {\n                    closestDistance = distance;\n                    closestInteraction = { body, zone };\n                }\n            }\n        });\n        \n                // Handle interaction changes\n        if (closestInteraction && closestInteraction !== this.currentInteraction) {\n            // New interaction\n            this.currentInteraction = closestInteraction;\n            const interaction = closestInteraction as { body: CelestialBody; zone: InteractionZone };\n            this.interactionPanel.showInteraction(\n                interaction.body,\n                interaction.zone,\n                shipPosition\n            );\n            \n            this.logger.debug(`🎯 New interaction: ${interaction.body.name} (${interaction.zone.type})`);\n            \n        } else if (!closestInteraction && this.currentInteraction) {\n            // Lost interaction\n            this.currentInteraction = null;\n            this.interactionPanel.hideInteraction();\n            \n            this.logger.debug('🚀 Left interaction zone');\n        }\n    }\n\n    /**\n     * Render all celestial bodies\n     */\n    render(renderer: Renderer, cameraPosition: Vector2): void {\n        // Sort bodies by distance for proper rendering order\n        const sortedBodies = Array.from(this.bodies.values()).sort((a, b) => {\n            const distA = a.getDistanceFrom(cameraPosition);\n            const distB = b.getDistanceFrom(cameraPosition);\n            return distB - distA; // Render farthest first\n        });\n        \n        // Render celestial bodies\n        sortedBodies.forEach(body => {\n            body.render(renderer, cameraPosition, this.config.celestialBodyConfig);\n        });\n        \n        // Render interaction panel\n        this.interactionPanel.render(renderer);\n    }\n\n    /**\n     * Clear current system\n     */\n    private clearSystem(): void {\n        this.bodies.clear();\n        this.nearbyBodies = [];\n        this.currentInteraction = null;\n        this.interactionPanel.hideInteraction();\n        \n        this.logger.debug('🧹 System cleared');\n    }\n\n    /**\n     * Get celestial body by ID\n     */\n    getBody(bodyId: string): CelestialBody | undefined {\n        return this.bodies.get(bodyId);\n    }\n\n    /**\n     * Get all bodies in system\n     */\n    getAllBodies(): CelestialBody[] {\n        return Array.from(this.bodies.values());\n    }\n\n    /**\n     * Get nearby bodies\n     */\n    getNearbyBodies(): CelestialBody[] {\n        return [...this.nearbyBodies];\n    }\n\n    /**\n     * Get current interaction\n     */\n    getCurrentInteraction(): { body: CelestialBody, zone: InteractionZone } | null {\n        return this.currentInteraction;\n    }\n\n    /**\n     * Force discovery of all bodies (for debugging)\n     */\n    discoverAllBodies(): void {\n        this.bodies.forEach(body => {\n            body.isDiscovered = true;\n        });\n        this.logger.info('🔍 All bodies discovered');\n    }\n\n    /**\n     * Get system statistics\n     */\n    getSystemStats(): {\n        bodyCount: number;\n        discoveredBodies: number;\n        scannedBodies: number;\n        nearbyBodies: number;\n        hasActiveInteraction: boolean;\n    } {\n        const discoveredBodies = Array.from(this.bodies.values()).filter(b => b.isDiscovered).length;\n        const scannedBodies = Array.from(this.bodies.values()).filter(b => b.isScanned).length;\n        \n        return {\n            bodyCount: this.bodies.size,\n            discoveredBodies,\n            scannedBodies,\n            nearbyBodies: this.nearbyBodies.length,\n            hasActiveInteraction: this.currentInteraction !== null\n        };\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(newConfig: Partial<CelestialManagerConfig>): void {\n        this.config = { ...this.config, ...newConfig };\n        this.logger.debug('Config updated', newConfig);\n    }\n\n    /**\n     * Get current system data\n     */\n    getCurrentSystem(): StarSystemData | null {\n        return this.currentSystem;\n    }\n\n    /**\n     * Perform action on body\n     */\n    performAction(bodyId: string, action: 'scan' | 'mine' | 'land', shipPosition?: Vector2): boolean {\n        const body = this.bodies.get(bodyId);\n        if (!body) return false;\n        \n        switch (action) {\n            case 'scan':\n                body.performScan();\n                body.isDiscovered = true;\n                this.logger.info(`🔍 Scanned ${body.name}`);\n                return true;\n                \n            case 'mine':\n                if (shipPosition) {\n                    const result = body.performMining(shipPosition);\n                    if (result) {\n                        this.logger.info(`⛏️ Mined ${result.quantity.toFixed(2)} ${result.resourceType} from ${body.name}`);\n                        return true;\n                    }\n                }\n                return false;\n                \n            case 'land':\n                const interaction = body.checkInteraction(shipPosition || { x: 0, y: 0 });\n                if (interaction && interaction.type === 'surface' && interaction.canEnter) {\n                    body.isLanded = true;\n                    this.logger.info(`🚁 Landed on ${body.name}`);\n                    return true;\n                }\n                return false;\n                \n            default:\n                return false;\n        }\n    }\n\n    /**\n     * Get all active celestial bodies\n     */\n    getActiveBodies(): CelestialBody[] {\n        return Array.from(this.bodies.values());\n    }\n\n    /**\n     * Cleanup\n     */\n    cleanup(): void {\n        this.clearSystem();\n        this.logger.info('🧹 Celestial manager cleanup completed');\n    }\n}","/**\n * Space Background Renderer\n * Multi-layered pixel art space background with warp distortion support\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer, Color } from '@core/Renderer';\n\nexport interface SpaceBackgroundConfig {\n    starCount: number;\n    starLayers: number;\n    parallaxStrength: number;\n    enableDistortion: boolean;\n    galaxyBandIntensity: number;\n    nebulaOpacity: number;\n}\n\nexport interface BackgroundStar {\n    position: Vector2;\n    originalPosition: Vector2; // For distortion restoration\n    color: Color;\n    size: number;\n    layer: number; // 0-4 for parallax\n    twinkle: number; // Twinkle phase\n}\n\nexport interface SpaceDistortionData {\n    center: Vector2;\n    intensity: number; // 0-1\n    radius: number;\n}\n\nexport class SpaceBackground {\n    private config: SpaceBackgroundConfig;\n    private stars: BackgroundStar[] = [];\n    private galaxyBand: BackgroundStar[] = [];\n    private nebulaClouds: Array<{ x: number, y: number, size: number, color: Color }> = [];\n    \n    // Distortion state\n    private isDistorted: boolean = false;\n    private distortionData: SpaceDistortionData | null = null;\n    \n    // Animation\n    private time: number = 0;\n    \n    private logger: Logger;\n\n    constructor(config: Partial<SpaceBackgroundConfig> = {}) {\n        this.logger = new Logger('SpaceBackground');\n        \n        this.config = {\n            starCount: 300,\n            starLayers: 5,\n            parallaxStrength: 0.3,\n            enableDistortion: true,\n            galaxyBandIntensity: 0.4,\n            nebulaOpacity: 0.2,\n            ...config\n        };\n        \n        this.generateBackground();\n        \n        this.logger.info('🌌 Space background initialized', {\n            starCount: this.stars.length,\n            layers: this.config.starLayers\n        });\n    }\n\n    /**\n     * Generate the complete background\n     */\n    private generateBackground(): void {\n        this.generateStars();\n        this.generateGalaxyBand();\n        this.generateNebulae();\n    }\n\n    /**\n     * Generate background stars with multiple layers for parallax\n     */\n    private generateStars(): void {\n        this.stars = [];\n        \n        for (let i = 0; i < this.config.starCount; i++) {\n            const position = {\n                x: Math.random() * 2048, // Larger than screen for movement\n                y: Math.random() * 1536\n            };\n            \n            const layer = Math.floor(Math.random() * this.config.starLayers);\n            const size = this.getStarSize(layer);\n            const color = this.getStarColor();\n            \n            this.stars.push({\n                position: { ...position },\n                originalPosition: { ...position },\n                color,\n                size,\n                layer,\n                twinkle: Math.random() * Math.PI * 2\n            });\n        }\n    }\n\n    /**\n     * Generate galaxy band (Milky Way-like band across sky)\n     */\n    private generateGalaxyBand(): void {\n        this.galaxyBand = [];\n        const bandStars = 80;\n        \n        // Create a diagonal band across the screen\n        for (let i = 0; i < bandStars; i++) {\n            const progress = i / bandStars;\n            const bandWidth = 200;\n            const bandOffset = Math.sin(progress * Math.PI * 3) * 50; // Wavy band\n            \n            const position = {\n                x: progress * 2048 + bandOffset,\n                y: 400 + bandOffset + (Math.random() - 0.5) * bandWidth\n            };\n            \n            // Dense, small stars for galaxy band\n            const color = this.getGalaxyBandColor();\n            \n            this.galaxyBand.push({\n                position: { ...position },\n                originalPosition: { ...position },\n                color,\n                size: Math.random() * 1.5 + 0.5,\n                layer: 2, // Middle layer\n                twinkle: Math.random() * Math.PI * 2\n            });\n        }\n    }\n\n    /**\n     * Generate nebula clouds\n     */\n    private generateNebulae(): void {\n        this.nebulaClouds = [];\n        const nebulaCount = 5;\n        \n        for (let i = 0; i < nebulaCount; i++) {\n            this.nebulaClouds.push({\n                x: Math.random() * 2048,\n                y: Math.random() * 1536,\n                size: Math.random() * 150 + 100,\n                color: this.getNebulaColor()\n            });\n        }\n    }\n\n    /**\n     * Get star size based on layer (closer = bigger)\n     */\n    private getStarSize(layer: number): number {\n        const baseSizes = [3, 2.5, 2, 1.5, 1]; // Layer 0 = closest/biggest\n        return baseSizes[layer] + Math.random() * 0.5;\n    }\n\n    /**\n     * Get star color (dark, muted space colors)\n     */\n    private getStarColor(): Color {\n        const colors = [\n            { r: 64, g: 64, b: 64 },  // White (muted)\n            { r: 48, g: 44, b: 36 },  // Yellow-white\n            { r: 48, g: 40, b: 28 },  // Yellow\n            { r: 48, g: 32, b: 20 },  // Orange\n            { r: 48, g: 24, b: 16 },  // Red\n            { r: 32, g: 36, b: 48 },  // Blue\n            { r: 40, g: 44, b: 48 }   // Blue-white\n        ];\n        return colors[Math.floor(Math.random() * colors.length)];\n    }\n\n    /**\n     * Get galaxy band star color (warmer, denser appearance)\n     */\n    private getGalaxyBandColor(): Color {\n        const colors = [\n            { r: 48, g: 44, b: 28 },  // Warm white\n            { r: 48, g: 40, b: 24 },  // Warm yellow\n            { r: 32, g: 28, b: 20 },  // Dim orange\n            { r: 24, g: 24, b: 20 }   // Very dim\n        ];\n        return colors[Math.floor(Math.random() * colors.length)];\n    }\n\n    /**\n     * Get nebula color (very muted space dust)\n     */\n    private getNebulaColor(): Color {\n        const colors = [\n            { r: 24, g: 16, b: 32 },  // Purple nebula\n            { r: 32, g: 24, b: 16 },  // Brown nebula\n            { r: 16, g: 24, b: 32 },  // Blue nebula\n            { r: 24, g: 32, b: 16 }   // Green nebula\n        ];\n        return colors[Math.floor(Math.random() * colors.length)];\n    }\n\n    /**\n     * Update background animation\n     */\n    update(deltaTime: number): void {\n        this.time += deltaTime;\n        \n        // Update star twinkle animation\n        this.stars.forEach(star => {\n            star.twinkle += deltaTime * (0.5 + Math.random() * 0.5);\n        });\n        \n        this.galaxyBand.forEach(star => {\n            star.twinkle += deltaTime * 0.3; // Slower twinkle for galaxy band\n        });\n    }\n\n    /**\n     * Apply warp distortion to background\n     */\n    applyWarpDistortion(distortionData: SpaceDistortionData): void {\n        if (!this.config.enableDistortion) return;\n        \n        this.distortionData = { ...distortionData };\n        this.isDistorted = true;\n        \n        // Apply distortion to all stars\n        this.distortStars(this.stars, distortionData);\n        this.distortStars(this.galaxyBand, distortionData);\n        \n        this.logger.debug('🌀 Warp distortion applied to background');\n    }\n\n    /**\n     * Restore background from distortion\n     */\n    restoreFromDistortion(): void {\n        if (!this.isDistorted) return;\n        \n        // Restore all stars to original positions\n        this.stars.forEach(star => {\n            star.position = { ...star.originalPosition };\n        });\n        \n        this.galaxyBand.forEach(star => {\n            star.position = { ...star.originalPosition };\n        });\n        \n        this.isDistorted = false;\n        this.distortionData = null;\n        \n        this.logger.debug('🌌 Background restored from warp distortion');\n    }\n\n    /**\n     * Gradually restore background during warp deactivation\n     */\n    gradualRestore(progress: number): void {\n        if (!this.isDistorted || !this.distortionData) return;\n        \n        const restoreAmount = 1.0 - progress; // 1.0 = fully restored, 0.0 = fully distorted\n        \n        // Gradually restore stars\n        this.restoreStarsGradually(this.stars, restoreAmount);\n        this.restoreStarsGradually(this.galaxyBand, restoreAmount);\n    }\n\n    /**\n     * Apply distortion to a set of stars\n     */\n    private distortStars(stars: BackgroundStar[], distortionData: SpaceDistortionData): void {\n        stars.forEach(star => {\n            const dx = star.originalPosition.x - distortionData.center.x;\n            const dy = star.originalPosition.y - distortionData.center.y;\n            const distance = Math.sqrt(dx * dx + dy * dy);\n            \n            if (distance < distortionData.radius) {\n                // Calculate distortion strength based on distance\n                const distortionStrength = (1 - distance / distortionData.radius) * distortionData.intensity;\n                \n                // Apply distortion toward the center\n                const pullStrength = distortionStrength * 50 * (star.layer + 1); // Closer layers distort more\n                \n                star.position.x = star.originalPosition.x - (dx / distance) * pullStrength;\n                star.position.y = star.originalPosition.y - (dy / distance) * pullStrength;\n            }\n        });\n    }\n\n    /**\n     * Gradually restore stars during deactivation\n     */\n    private restoreStarsGradually(stars: BackgroundStar[], restoreAmount: number): void {\n        stars.forEach(star => {\n            // Interpolate between distorted and original position\n            star.position.x = star.position.x + (star.originalPosition.x - star.position.x) * restoreAmount * 0.1;\n            star.position.y = star.position.y + (star.originalPosition.y - star.position.y) * restoreAmount * 0.1;\n        });\n    }\n\n    /**\n     * Render the space background\n     */\n    render(renderer: Renderer, cameraPosition: Vector2): void {\n        // Render nebulae first (background layer)\n        this.renderNebulae(renderer, cameraPosition);\n        \n        // Render galaxy band\n        this.renderGalaxyBand(renderer, cameraPosition);\n        \n        // Render stars in layers (back to front for parallax)\n        for (let layer = this.config.starLayers - 1; layer >= 0; layer--) {\n            this.renderStarLayer(renderer, cameraPosition, layer);\n        }\n    }\n\n    /**\n     * Render nebula clouds\n     */\n    private renderNebulae(renderer: Renderer, cameraPosition: Vector2): void {\n        this.nebulaClouds.forEach(nebula => {\n            const parallaxFactor = 0.1; // Very slow parallax for distant nebulae\n            const screenX = nebula.x - cameraPosition.x * parallaxFactor;\n            const screenY = nebula.y - cameraPosition.y * parallaxFactor;\n            \n            // Skip if off-screen\n            if (screenX < -nebula.size || screenX > 1024 + nebula.size ||\n                screenY < -nebula.size || screenY > 768 + nebula.size) {\n                return;\n            }\n            \n            // Render nebula as scattered pixels\n            const pixelCount = Math.floor(nebula.size / 8);\n            for (let i = 0; i < pixelCount; i++) {\n                const angle = (i / pixelCount) * Math.PI * 2 + this.time * 0.1;\n                const radius = (nebula.size / 2) * Math.sqrt(Math.random()); // Even distribution\n                \n                const x = screenX + Math.cos(angle) * radius;\n                const y = screenY + Math.sin(angle) * radius;\n                \n                const alpha = this.config.nebulaOpacity * (1 - radius / (nebula.size / 2));\n                const color = {\n                    r: Math.floor(nebula.color.r * alpha),\n                    g: Math.floor(nebula.color.g * alpha),\n                    b: Math.floor(nebula.color.b * alpha)\n                };\n                \n                if (color.r > 0 || color.g > 0 || color.b > 0) {\n                    renderer.setPixel(x, y, color);\n                }\n            }\n        });\n    }\n\n    /**\n     * Render galaxy band\n     */\n    private renderGalaxyBand(renderer: Renderer, cameraPosition: Vector2): void {\n        this.galaxyBand.forEach(star => {\n            const parallaxFactor = 0.3; // Medium parallax for galaxy band\n            const screenX = star.position.x - cameraPosition.x * parallaxFactor;\n            const screenY = star.position.y - cameraPosition.y * parallaxFactor;\n            \n            // Skip if off-screen\n            if (screenX < -10 || screenX > 1034 || screenY < -10 || screenY > 778) {\n                return;\n            }\n            \n            // Apply galaxy band intensity and twinkle\n            const twinkle = Math.sin(star.twinkle) * 0.3 + 0.7; // 0.4 to 1.0\n            const intensity = this.config.galaxyBandIntensity * twinkle;\n            \n            const color = {\n                r: Math.floor(star.color.r * intensity),\n                g: Math.floor(star.color.g * intensity),\n                b: Math.floor(star.color.b * intensity)\n            };\n            \n            this.renderStar(renderer, screenX, screenY, star.size * 0.8, color);\n        });\n    }\n\n    /**\n     * Render stars for a specific parallax layer\n     */\n    private renderStarLayer(renderer: Renderer, cameraPosition: Vector2, layer: number): void {\n        // Calculate parallax factor (layer 0 = closest, moves most)\n        const parallaxFactor = (layer + 1) * this.config.parallaxStrength;\n        \n        this.stars.filter(star => star.layer === layer).forEach(star => {\n            const screenX = star.position.x - cameraPosition.x * parallaxFactor;\n            const screenY = star.position.y - cameraPosition.y * parallaxFactor;\n            \n            // Skip if off-screen\n            if (screenX < -10 || screenX > 1034 || screenY < -10 || screenY > 778) {\n                return;\n            }\n            \n            // Apply twinkle effect\n            const twinkle = Math.sin(star.twinkle) * 0.4 + 0.6; // 0.2 to 1.0\n            const color = {\n                r: Math.floor(star.color.r * twinkle),\n                g: Math.floor(star.color.g * twinkle),\n                b: Math.floor(star.color.b * twinkle)\n            };\n            \n            this.renderStar(renderer, screenX, screenY, star.size, color);\n        });\n    }\n\n    /**\n     * Render individual star\n     */\n    private renderStar(renderer: Renderer, x: number, y: number, size: number, color: Color): void {\n        if (size <= 1) {\n            // Single pixel star\n            renderer.setPixel(x, y, color);\n        } else if (size <= 2) {\n            // 2x2 star\n            renderer.fillRect(x - 1, y - 1, 2, 2, color);\n        } else {\n            // Larger star with cross pattern\n            const coreSize = Math.floor(size);\n            const halfCore = Math.floor(coreSize / 2);\n            \n            // Core\n            renderer.fillRect(x - halfCore, y - halfCore, coreSize, coreSize, color);\n            \n            // Cross pattern for larger stars\n            if (size > 2.5) {\n                const dimColor = {\n                    r: Math.floor(color.r * 0.6),\n                    g: Math.floor(color.g * 0.6),\n                    b: Math.floor(color.b * 0.6)\n                };\n                \n                // Horizontal beam\n                renderer.fillRect(x - size, y - 1, size * 2, 2, dimColor);\n                // Vertical beam\n                renderer.fillRect(x - 1, y - size, 2, size * 2, dimColor);\n            }\n        }\n    }\n\n    /**\n     * Update background during warp\n     */\n    updateWarpDistortion(distortionData: SpaceDistortionData): void {\n        if (this.config.enableDistortion) {\n            this.applyWarpDistortion(distortionData);\n        }\n    }\n\n    /**\n     * Get background statistics\n     */\n    getStats(): {\n        starCount: number;\n        galaxyBandStars: number;\n        nebulaCount: number;\n        isDistorted: boolean;\n    } {\n        return {\n            starCount: this.stars.length,\n            galaxyBandStars: this.galaxyBand.length,\n            nebulaCount: this.nebulaClouds.length,\n            isDistorted: this.isDistorted\n        };\n    }\n\n    /**\n     * Regenerate background (for different star systems)\n     */\n    regenerateBackground(): void {\n        this.generateBackground();\n        this.logger.info('🌌 Background regenerated');\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(newConfig: Partial<SpaceBackgroundConfig>): void {\n        this.config = { ...this.config, ...newConfig };\n        \n        // Regenerate if significant changes\n        if (newConfig.starCount || newConfig.starLayers) {\n            this.regenerateBackground();\n        }\n    }\n}","/**\n * Item System - Core item definitions and management\n * Comprehensive item system with procedural generation and 16-bit pixel art\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Color, Renderer } from '@core/Renderer';\n\nexport enum ItemType {\n    Resource = 'resource',\n    Component = 'component',\n    Equipment = 'equipment',\n    Weapon = 'weapon',\n    Tool = 'tool',\n    Consumable = 'consumable',\n    Blueprint = 'blueprint',\n    Artifact = 'artifact'\n}\n\nexport enum ItemRarity {\n    Common = 'common',\n    Uncommon = 'uncommon',\n    Rare = 'rare',\n    Epic = 'epic',\n    Legendary = 'legendary',\n    Artifact = 'artifact'\n}\n\nexport enum ItemCategory {\n    // Resources\n    Metal = 'metal',\n    Crystal = 'crystal',\n    Gas = 'gas',\n    Biological = 'biological',\n    Energy = 'energy',\n    Exotic = 'exotic',\n    \n    // Equipment\n    Engine = 'engine',\n    Shield = 'shield',\n    Reactor = 'reactor',\n    Scanner = 'scanner',\n    WarpCore = 'warp_core',\n    \n    // Weapons\n    Projectile = 'projectile',\n    EnergyWeapon = 'energy_weapon',\n    Missile = 'missile',\n    \n    // Tools\n    Mining = 'mining',\n    Repair = 'repair',\n    Research = 'research'\n}\n\nexport interface ItemStats {\n    // Base properties\n    mass: number;\n    volume: number;\n    durability?: number; // For equipment/tools\n    maxStack: number;\n    \n    // Equipment stats\n    power?: number;\n    efficiency?: number;\n    range?: number;\n    damage?: number;\n    defense?: number;\n    \n    // Resource/component stats\n    purity?: number; // 0-1\n    stability?: number; // 0-1\n    radioactivity?: number; // 0-1\n}\n\nexport interface ItemRecipe {\n    id: string;\n    requiredItems: { [itemId: string]: number };\n    requiredTech?: string[];\n    craftingTime: number; // seconds\n    energyCost: number;\n    successRate: number; // 0-1\n}\n\nexport interface ItemSprite {\n    width: number;\n    height: number;\n    pixels: Color[][]; // 2D array of colors for 16-bit sprite\n}\n\nexport interface GameItem {\n    id: string;\n    name: string;\n    description: string;\n    type: ItemType;\n    category: ItemCategory;\n    rarity: ItemRarity;\n    \n    // Visual\n    sprite: ItemSprite;\n    iconColor: Color;\n    \n    // Properties\n    stats: ItemStats;\n    \n    // Crafting\n    recipe?: ItemRecipe;\n    \n    // Special properties\n    isUnique: boolean;\n    isTradeable: boolean;\n    isConsumable: boolean;\n    \n    // Lore\n    loreText?: string;\n    discoveredBy?: string;\n    discoveryDate?: number;\n}\n\nexport interface ItemStack {\n    item: GameItem;\n    quantity: number;\n    condition?: number; // 0-1 for equipment durability\n    modifiers?: { [key: string]: number }; // Special modifiers\n}\n\nexport class ItemDatabase {\n    private items: Map<string, GameItem> = new Map();\n    private recipes: Map<string, ItemRecipe> = new Map();\n    private categories: Map<ItemCategory, GameItem[]> = new Map();\n    \n    private logger: Logger;\n\n    constructor() {\n        this.logger = new Logger('ItemDatabase');\n        this.initializeDatabase();\n        this.logger.info('📦 Item database initialized', {\n            totalItems: this.items.size,\n            categories: this.categories.size\n        });\n    }\n\n    /**\n     * Initialize the item database with base items\n     */\n    private initializeDatabase(): void {\n        // Generate base resources\n        this.generateResources();\n        \n        // Generate components\n        this.generateComponents();\n        \n        // Generate equipment\n        this.generateEquipment();\n        \n        // Generate weapons\n        this.generateWeapons();\n        \n        // Generate tools\n        this.generateTools();\n        \n        // Generate consumables\n        this.generateConsumables();\n        \n        // Generate blueprints\n        this.generateBlueprints();\n        \n        // Generate artifacts\n        this.generateArtifacts();\n    }\n\n    /**\n     * Generate base resources\n     */\n    private generateResources(): void {\n        const resources = [\n            {\n                id: 'metal_iron',\n                name: 'Iron Ore',\n                description: 'Common metallic ore found throughout the galaxy.',\n                category: ItemCategory.Metal,\n                rarity: ItemRarity.Common,\n                stats: { mass: 1, volume: 1, maxStack: 1000, purity: 0.7 },\n                color: { r: 48, g: 32, b: 24 }\n            },\n            {\n                id: 'metal_titanium',\n                name: 'Titanium',\n                description: 'Lightweight, durable metal used in ship construction.',\n                category: ItemCategory.Metal,\n                rarity: ItemRarity.Uncommon,\n                stats: { mass: 0.8, volume: 1, maxStack: 500, purity: 0.85 },\n                color: { r: 64, g: 64, b: 64 }\n            },\n            {\n                id: 'crystal_quartz',\n                name: 'Quartz Crystal',\n                description: 'Common crystalline structure with electronic properties.',\n                category: ItemCategory.Crystal,\n                rarity: ItemRarity.Common,\n                stats: { mass: 0.5, volume: 1, maxStack: 200, purity: 0.6 },\n                color: { r: 48, g: 48, b: 56 }\n            },\n            {\n                id: 'crystal_dilithium',\n                name: 'Dilithium Crystal',\n                description: 'Rare crystal essential for warp core regulation.',\n                category: ItemCategory.Crystal,\n                rarity: ItemRarity.Rare,\n                stats: { mass: 0.3, volume: 1, maxStack: 50, purity: 0.9, radioactivity: 0.3 },\n                color: { r: 32, g: 48, b: 32 }\n            },\n            {\n                id: 'gas_hydrogen',\n                name: 'Hydrogen',\n                description: 'Common gas used for fuel and life support.',\n                category: ItemCategory.Gas,\n                rarity: ItemRarity.Common,\n                stats: { mass: 0.1, volume: 2, maxStack: 2000, purity: 0.8 },\n                color: { r: 32, g: 40, b: 48 }\n            },\n            {\n                id: 'bio_protein',\n                name: 'Protein Compounds',\n                description: 'Organic compounds essential for life support systems.',\n                category: ItemCategory.Biological,\n                rarity: ItemRarity.Uncommon,\n                stats: { mass: 0.5, volume: 1, maxStack: 100, stability: 0.7 },\n                color: { r: 40, g: 48, b: 32 }\n            },\n            {\n                id: 'energy_antimatter',\n                name: 'Antimatter',\n                description: 'Extremely dangerous but powerful energy source.',\n                category: ItemCategory.Energy,\n                rarity: ItemRarity.Epic,\n                stats: { mass: 0.01, volume: 1, maxStack: 10, radioactivity: 0.9, stability: 0.3 },\n                color: { r: 48, g: 24, b: 72 }\n            }\n        ];\n\n        resources.forEach(res => {\n            const item = this.createItem({\n                id: res.id,\n                name: res.name,\n                description: res.description,\n                type: ItemType.Resource,\n                category: res.category,\n                rarity: res.rarity,\n                stats: res.stats,\n                iconColor: res.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: false\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate ship components\n     */\n    private generateComponents(): void {\n        const components = [\n            {\n                id: 'comp_circuit',\n                name: 'Circuit Board',\n                description: 'Basic electronic component for ship systems.',\n                category: ItemCategory.Engine,\n                rarity: ItemRarity.Common,\n                stats: { mass: 0.2, volume: 1, maxStack: 100, durability: 0.9 },\n                color: { r: 24, g: 48, b: 24 }\n            },\n            {\n                id: 'comp_plasma_conduit',\n                name: 'Plasma Conduit',\n                description: 'Advanced conduit for energy distribution systems.',\n                category: ItemCategory.Reactor,\n                rarity: ItemRarity.Rare,\n                stats: { mass: 2, volume: 1, maxStack: 20, power: 150, efficiency: 0.85 },\n                color: { r: 64, g: 32, b: 16 }\n            },\n            {\n                id: 'comp_shield_emitter',\n                name: 'Shield Emitter',\n                description: 'Generates protective energy barriers around the ship.',\n                category: ItemCategory.Shield,\n                rarity: ItemRarity.Uncommon,\n                stats: { mass: 1.5, volume: 1, maxStack: 50, defense: 100, efficiency: 0.75 },\n                color: { r: 16, g: 32, b: 48 }\n            }\n        ];\n\n        components.forEach(comp => {\n            const item = this.createItem({\n                id: comp.id,\n                name: comp.name,\n                description: comp.description,\n                type: ItemType.Component,\n                category: comp.category,\n                rarity: comp.rarity,\n                stats: comp.stats,\n                iconColor: comp.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: false\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate equipment items\n     */\n    private generateEquipment(): void {\n        const equipment = [\n            {\n                id: 'eq_engine_basic',\n                name: 'Basic Thruster',\n                description: 'Standard propulsion system for small vessels.',\n                category: ItemCategory.Engine,\n                rarity: ItemRarity.Common,\n                stats: { mass: 10, volume: 4, maxStack: 1, power: 100, efficiency: 0.6 },\n                color: { r: 48, g: 48, b: 48 }\n            },\n            {\n                id: 'eq_shield_mk2',\n                name: 'Shield Generator Mk.II',\n                description: 'Improved shield generation system.',\n                category: ItemCategory.Shield,\n                rarity: ItemRarity.Uncommon,\n                stats: { mass: 8, volume: 3, maxStack: 1, defense: 200, efficiency: 0.8 },\n                color: { r: 16, g: 40, b: 32 }\n            },\n            {\n                id: 'eq_warp_core',\n                name: 'Warp Core',\n                description: 'Essential component for faster-than-light travel.',\n                category: ItemCategory.WarpCore,\n                rarity: ItemRarity.Epic,\n                stats: { mass: 20, volume: 8, maxStack: 1, power: 500, efficiency: 0.9 },\n                color: { r: 48, g: 24, b: 72 }\n            }\n        ];\n\n        equipment.forEach(eq => {\n            const item = this.createItem({\n                id: eq.id,\n                name: eq.name,\n                description: eq.description,\n                type: ItemType.Equipment,\n                category: eq.category,\n                rarity: eq.rarity,\n                stats: eq.stats,\n                iconColor: eq.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: false\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate weapons\n     */\n    private generateWeapons(): void {\n        const weapons = [\n            {\n                id: 'wp_laser_basic',\n                name: 'Basic Laser Cannon',\n                description: 'Standard energy weapon for ship defense.',\n                category: ItemCategory.Energy,\n                rarity: ItemRarity.Common,\n                stats: { mass: 5, volume: 2, maxStack: 1, damage: 50, range: 200 },\n                color: { r: 72, g: 24, b: 24 }\n            },\n            {\n                id: 'wp_railgun',\n                name: 'Magnetic Railgun',\n                description: 'High-velocity projectile weapon system.',\n                category: ItemCategory.Projectile,\n                rarity: ItemRarity.Rare,\n                stats: { mass: 12, volume: 4, maxStack: 1, damage: 150, range: 400 },\n                color: { r: 64, g: 64, b: 32 }\n            }\n        ];\n\n        weapons.forEach(wp => {\n            const item = this.createItem({\n                id: wp.id,\n                name: wp.name,\n                description: wp.description,\n                type: ItemType.Weapon,\n                category: wp.category,\n                rarity: wp.rarity,\n                stats: wp.stats,\n                iconColor: wp.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: false\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate tools\n     */\n    private generateTools(): void {\n        const tools = [\n            {\n                id: 'tool_mining_drill',\n                name: 'Mining Drill',\n                description: 'Automated mining equipment for resource extraction.',\n                category: ItemCategory.Mining,\n                rarity: ItemRarity.Uncommon,\n                stats: { mass: 3, volume: 2, maxStack: 1, efficiency: 0.8, durability: 0.9 },\n                color: { r: 96, g: 64, b: 16 }\n            },\n            {\n                id: 'tool_repair_kit',\n                name: 'Repair Kit',\n                description: 'Emergency repair tools and materials.',\n                category: ItemCategory.Repair,\n                rarity: ItemRarity.Common,\n                stats: { mass: 1, volume: 1, maxStack: 10, efficiency: 0.6 },\n                color: { r: 48, g: 48, b: 32 }\n            }\n        ];\n\n        tools.forEach(tool => {\n            const item = this.createItem({\n                id: tool.id,\n                name: tool.name,\n                description: tool.description,\n                type: ItemType.Tool,\n                category: tool.category,\n                rarity: tool.rarity,\n                stats: tool.stats,\n                iconColor: tool.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: false\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate consumables\n     */\n    private generateConsumables(): void {\n        const consumables = [\n            {\n                id: 'cons_energy_cell',\n                name: 'Energy Cell',\n                description: 'Portable power source for emergency systems.',\n                rarity: ItemRarity.Common,\n                stats: { mass: 0.5, volume: 1, maxStack: 50, power: 100 },\n                color: { r: 32, g: 80, b: 64 }\n            },\n            {\n                id: 'cons_nanobots',\n                name: 'Repair Nanobots',\n                description: 'Microscopic robots that repair ship damage.',\n                rarity: ItemRarity.Rare,\n                stats: { mass: 0.1, volume: 1, maxStack: 20, efficiency: 0.9 },\n                color: { r: 48, g: 24, b: 72 }\n            }\n        ];\n\n        consumables.forEach(cons => {\n            const item = this.createItem({\n                id: cons.id,\n                name: cons.name,\n                description: cons.description,\n                type: ItemType.Consumable,\n                category: ItemCategory.Energy,\n                rarity: cons.rarity,\n                stats: cons.stats,\n                iconColor: cons.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: true\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate blueprints\n     */\n    private generateBlueprints(): void {\n        const blueprints = [\n            {\n                id: 'bp_engine_advanced',\n                name: 'Advanced Engine Blueprint',\n                description: 'Schematic for constructing high-efficiency thrusters.',\n                rarity: ItemRarity.Rare,\n                color: { r: 32, g: 48, b: 32 }\n            },\n            {\n                id: 'bp_warp_upgrade',\n                name: 'Warp Core Upgrade Blueprint',\n                description: 'Plans for enhancing warp drive capabilities.',\n                rarity: ItemRarity.Epic,\n                color: { r: 48, g: 24, b: 72 }\n            }\n        ];\n\n        blueprints.forEach(bp => {\n            const item = this.createItem({\n                id: bp.id,\n                name: bp.name,\n                description: bp.description,\n                type: ItemType.Blueprint,\n                category: ItemCategory.Engine,\n                rarity: bp.rarity,\n                stats: { mass: 0.1, volume: 1, maxStack: 1 },\n                iconColor: bp.color,\n                isUnique: false,\n                isTradeable: true,\n                isConsumable: false\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Generate rare artifacts\n     */\n    private generateArtifacts(): void {\n        const artifacts = [\n            {\n                id: 'art_precursor_relic',\n                name: 'Precursor Data Core',\n                description: 'Ancient technology from a lost civilization.',\n                rarity: ItemRarity.Artifact,\n                stats: { mass: 1, volume: 1, maxStack: 1, radioactivity: 0.5 },\n                color: { r: 64, g: 32, b: 96 },\n                lore: 'This mysterious device contains fragments of knowledge from a species that vanished eons ago.'\n            }\n        ];\n\n        artifacts.forEach(art => {\n            const item = this.createItem({\n                id: art.id,\n                name: art.name,\n                description: art.description,\n                type: ItemType.Artifact,\n                category: ItemCategory.Exotic,\n                rarity: art.rarity,\n                stats: art.stats,\n                iconColor: art.color,\n                isUnique: true,\n                isTradeable: false,\n                isConsumable: false,\n                loreText: art.lore\n            });\n            this.addItem(item);\n        });\n    }\n\n    /**\n     * Create an item with generated sprite\n     */\n    private createItem(config: {\n        id: string;\n        name: string;\n        description: string;\n        type: ItemType;\n        category: ItemCategory;\n        rarity: ItemRarity;\n        stats: Partial<ItemStats>;\n        iconColor: Color;\n        isUnique: boolean;\n        isTradeable: boolean;\n        isConsumable: boolean;\n        loreText?: string;\n    }): GameItem {\n        const sprite = this.generateItemSprite(config.type, config.category, config.iconColor);\n        \n        return {\n            id: config.id,\n            name: config.name,\n            description: config.description,\n            type: config.type,\n            category: config.category,\n            rarity: config.rarity,\n            sprite,\n            iconColor: config.iconColor,\n            stats: {\n                mass: 1,\n                volume: 1,\n                maxStack: 1,\n                ...config.stats\n            },\n            isUnique: config.isUnique,\n            isTradeable: config.isTradeable,\n            isConsumable: config.isConsumable,\n            loreText: config.loreText\n        };\n    }\n\n    /**\n     * Generate 16-bit pixel art sprite for item\n     */\n    private generateItemSprite(type: ItemType, category: ItemCategory, baseColor: Color): ItemSprite {\n        const width = 16;\n        const height = 16;\n        const pixels: Color[][] = [];\n        \n        // Initialize empty sprite\n        for (let y = 0; y < height; y++) {\n            pixels[y] = [];\n            for (let x = 0; x < width; x++) {\n                pixels[y][x] = { r: 0, g: 0, b: 0 }; // Transparent\n            }\n        }\n        \n        // Generate sprite based on type and category\n        switch (type) {\n            case ItemType.Resource:\n                this.drawResourceSprite(pixels, category, baseColor);\n                break;\n            case ItemType.Component:\n                this.drawComponentSprite(pixels, category, baseColor);\n                break;\n            case ItemType.Equipment:\n                this.drawEquipmentSprite(pixels, category, baseColor);\n                break;\n            case ItemType.Weapon:\n                this.drawWeaponSprite(pixels, category, baseColor);\n                break;\n            case ItemType.Tool:\n                this.drawToolSprite(pixels, category, baseColor);\n                break;\n            case ItemType.Consumable:\n                this.drawConsumableSprite(pixels, baseColor);\n                break;\n            case ItemType.Blueprint:\n                this.drawBlueprintSprite(pixels, baseColor);\n                break;\n            case ItemType.Artifact:\n                this.drawArtifactSprite(pixels, baseColor);\n                break;\n        }\n        \n        return { width, height, pixels };\n    }\n\n    /**\n     * Draw resource sprite (crystal/ore shapes)\n     */\n    private drawResourceSprite(pixels: Color[][], category: ItemCategory, color: Color): void {\n        const darkColor = this.darkenColor(color, 0.7);\n        const lightColor = this.lightenColor(color, 1.3);\n        \n        if (category === ItemCategory.Crystal) {\n            // Crystal shape\n            this.setPixel(pixels, 8, 2, lightColor);\n            this.setPixel(pixels, 7, 3, color);\n            this.setPixel(pixels, 8, 3, lightColor);\n            this.setPixel(pixels, 9, 3, color);\n            this.setPixel(pixels, 6, 4, darkColor);\n            this.setPixel(pixels, 7, 4, color);\n            this.setPixel(pixels, 8, 4, lightColor);\n            this.setPixel(pixels, 9, 4, color);\n            this.setPixel(pixels, 10, 4, darkColor);\n            // Continue crystal pattern...\n            for (let y = 5; y < 13; y++) {\n                for (let x = 6; x <= 10; x++) {\n                    if (x === 6 || x === 10) this.setPixel(pixels, x, y, darkColor);\n                    else if (x === 8) this.setPixel(pixels, x, y, lightColor);\n                    else this.setPixel(pixels, x, y, color);\n                }\n            }\n            this.setPixel(pixels, 8, 13, darkColor);\n        } else {\n            // Ore/metal chunk shape\n            for (let y = 4; y < 12; y++) {\n                for (let x = 5; x < 11; x++) {\n                    if ((x + y) % 3 === 0) this.setPixel(pixels, x, y, lightColor);\n                    else if ((x + y) % 3 === 1) this.setPixel(pixels, x, y, color);\n                    else this.setPixel(pixels, x, y, darkColor);\n                }\n            }\n        }\n    }\n\n    /**\n     * Draw component sprite (circuit patterns)\n     */\n    private drawComponentSprite(pixels: Color[][], category: ItemCategory, color: Color): void {\n        const darkColor = this.darkenColor(color, 0.6);\n        const lightColor = this.lightenColor(color, 1.4);\n        \n        // Circuit board base\n        for (let y = 3; y < 13; y++) {\n            for (let x = 3; x < 13; x++) {\n                this.setPixel(pixels, x, y, darkColor);\n            }\n        }\n        \n        // Circuit traces\n        for (let x = 4; x < 12; x++) {\n            this.setPixel(pixels, x, 6, color);\n            this.setPixel(pixels, x, 9, color);\n        }\n        for (let y = 4; y < 12; y++) {\n            this.setPixel(pixels, 6, y, color);\n            this.setPixel(pixels, 9, y, color);\n        }\n        \n        // Components\n        this.setPixel(pixels, 5, 5, lightColor);\n        this.setPixel(pixels, 10, 5, lightColor);\n        this.setPixel(pixels, 5, 10, lightColor);\n        this.setPixel(pixels, 10, 10, lightColor);\n    }\n\n    /**\n     * Draw equipment sprite (mechanical shapes)\n     */\n    private drawEquipmentSprite(pixels: Color[][], category: ItemCategory, color: Color): void {\n        const darkColor = this.darkenColor(color, 0.7);\n        const lightColor = this.lightenColor(color, 1.2);\n        \n        // Base equipment shape\n        for (let y = 2; y < 14; y++) {\n            for (let x = 4; x < 12; x++) {\n                if (y === 2 || y === 13 || x === 4 || x === 11) {\n                    this.setPixel(pixels, x, y, darkColor);\n                } else {\n                    this.setPixel(pixels, x, y, color);\n                }\n            }\n        }\n        \n        // Equipment details based on category\n        if (category === ItemCategory.Engine) {\n            // Engine nozzle\n            for (let y = 6; y < 10; y++) {\n                this.setPixel(pixels, 8, y, lightColor);\n            }\n        } else if (category === ItemCategory.Shield) {\n            // Shield emitter pattern\n            this.setPixel(pixels, 8, 5, lightColor);\n            this.setPixel(pixels, 7, 6, lightColor);\n            this.setPixel(pixels, 9, 6, lightColor);\n            this.setPixel(pixels, 8, 7, lightColor);\n        }\n    }\n\n    /**\n     * Draw weapon sprite\n     */\n    private drawWeaponSprite(pixels: Color[][], category: ItemCategory, color: Color): void {\n        const darkColor = this.darkenColor(color, 0.6);\n        const lightColor = this.lightenColor(color, 1.3);\n        \n        // Weapon barrel\n        for (let y = 6; y < 10; y++) {\n            for (let x = 2; x < 14; x++) {\n                if (y === 6 || y === 9) this.setPixel(pixels, x, y, darkColor);\n                else this.setPixel(pixels, x, y, color);\n            }\n        }\n        \n        // Weapon tip\n        this.setPixel(pixels, 14, 7, lightColor);\n        this.setPixel(pixels, 14, 8, lightColor);\n        \n        // Handle/mount\n        for (let y = 8; y < 12; y++) {\n            for (let x = 4; x < 8; x++) {\n                this.setPixel(pixels, x, y, darkColor);\n            }\n        }\n    }\n\n    /**\n     * Draw tool sprite\n     */\n    private drawToolSprite(pixels: Color[][], category: ItemCategory, color: Color): void {\n        const darkColor = this.darkenColor(color, 0.7);\n        const lightColor = this.lightenColor(color, 1.2);\n        \n        // Tool handle\n        for (let y = 8; y < 14; y++) {\n            for (let x = 6; x < 10; x++) {\n                this.setPixel(pixels, x, y, darkColor);\n            }\n        }\n        \n        // Tool head based on category\n        if (category === ItemCategory.Mining) {\n            // Drill bit\n            for (let y = 2; y < 8; y++) {\n                this.setPixel(pixels, 8, y, color);\n                if (y > 3) {\n                    this.setPixel(pixels, 7, y, lightColor);\n                    this.setPixel(pixels, 9, y, lightColor);\n                }\n            }\n        } else {\n            // Generic tool head\n            for (let y = 4; y < 8; y++) {\n                for (let x = 5; x < 11; x++) {\n                    this.setPixel(pixels, x, y, color);\n                }\n            }\n        }\n    }\n\n    /**\n     * Draw consumable sprite (container shapes)\n     */\n    private drawConsumableSprite(pixels: Color[][], color: Color): void {\n        const darkColor = this.darkenColor(color, 0.6);\n        const lightColor = this.lightenColor(color, 1.4);\n        \n        // Container outline\n        for (let y = 3; y < 13; y++) {\n            for (let x = 5; x < 11; x++) {\n                if (y === 3 || y === 12 || x === 5 || x === 10) {\n                    this.setPixel(pixels, x, y, darkColor);\n                } else {\n                    this.setPixel(pixels, x, y, color);\n                }\n            }\n        }\n        \n        // Label/indicator\n        this.setPixel(pixels, 8, 6, lightColor);\n        this.setPixel(pixels, 7, 7, lightColor);\n        this.setPixel(pixels, 9, 7, lightColor);\n        this.setPixel(pixels, 8, 8, lightColor);\n    }\n\n    /**\n     * Draw blueprint sprite (schematic pattern)\n     */\n    private drawBlueprintSprite(pixels: Color[][], color: Color): void {\n        const darkColor = this.darkenColor(color, 0.8);\n        const lightColor = this.lightenColor(color, 1.1);\n        \n        // Blueprint base\n        for (let y = 2; y < 14; y++) {\n            for (let x = 3; x < 13; x++) {\n                this.setPixel(pixels, x, y, darkColor);\n            }\n        }\n        \n        // Schematic lines\n        for (let x = 5; x < 11; x++) {\n            this.setPixel(pixels, x, 5, color);\n            this.setPixel(pixels, x, 8, color);\n            this.setPixel(pixels, x, 11, color);\n        }\n        \n        // Blueprint markers\n        this.setPixel(pixels, 5, 6, lightColor);\n        this.setPixel(pixels, 8, 6, lightColor);\n        this.setPixel(pixels, 11, 6, lightColor);\n    }\n\n    /**\n     * Draw artifact sprite (mystical patterns)\n     */\n    private drawArtifactSprite(pixels: Color[][], color: Color): void {\n        const darkColor = this.darkenColor(color, 0.5);\n        const lightColor = this.lightenColor(color, 1.5);\n        \n        // Artifact base\n        for (let y = 4; y < 12; y++) {\n            for (let x = 4; x < 12; x++) {\n                if ((x + y) % 2 === 0) this.setPixel(pixels, x, y, color);\n                else this.setPixel(pixels, x, y, darkColor);\n            }\n        }\n        \n        // Mystical pattern\n        this.setPixel(pixels, 8, 2, lightColor);\n        this.setPixel(pixels, 6, 6, lightColor);\n        this.setPixel(pixels, 10, 6, lightColor);\n        this.setPixel(pixels, 8, 10, lightColor);\n        this.setPixel(pixels, 8, 14, lightColor);\n    }\n\n    /**\n     * Helper methods for sprite generation\n     */\n    private setPixel(pixels: Color[][], x: number, y: number, color: Color): void {\n        if (x >= 0 && x < 16 && y >= 0 && y < 16) {\n            pixels[y][x] = { ...color };\n        }\n    }\n\n    private darkenColor(color: Color, factor: number): Color {\n        return {\n            r: Math.floor(color.r * factor),\n            g: Math.floor(color.g * factor),\n            b: Math.floor(color.b * factor)\n        };\n    }\n\n    private lightenColor(color: Color, factor: number): Color {\n        return {\n            r: Math.min(255, Math.floor(color.r * factor)),\n            g: Math.min(255, Math.floor(color.g * factor)),\n            b: Math.min(255, Math.floor(color.b * factor))\n        };\n    }\n\n    /**\n     * Public interface methods\n     */\n    \n    /**\n     * Add item to database\n     */\n    addItem(item: GameItem): void {\n        this.items.set(item.id, item);\n        \n        if (!this.categories.has(item.category)) {\n            this.categories.set(item.category, []);\n        }\n        this.categories.get(item.category)!.push(item);\n        \n        if (item.recipe) {\n            this.recipes.set(item.id, item.recipe);\n        }\n    }\n\n    /**\n     * Get item by ID\n     */\n    getItem(id: string): GameItem | undefined {\n        return this.items.get(id);\n    }\n\n    /**\n     * Get items by category\n     */\n    getItemsByCategory(category: ItemCategory): GameItem[] {\n        return this.categories.get(category) || [];\n    }\n\n    /**\n     * Get items by type\n     */\n    getItemsByType(type: ItemType): GameItem[] {\n        return Array.from(this.items.values()).filter(item => item.type === type);\n    }\n\n    /**\n     * Get items by rarity\n     */\n    getItemsByRarity(rarity: ItemRarity): GameItem[] {\n        return Array.from(this.items.values()).filter(item => item.rarity === rarity);\n    }\n\n    /**\n     * Get all items\n     */\n    getAllItems(): GameItem[] {\n        return Array.from(this.items.values());\n    }\n\n    /**\n     * Get recipe for item\n     */\n    getRecipe(itemId: string): ItemRecipe | undefined {\n        return this.recipes.get(itemId);\n    }\n\n    /**\n     * Search items by name\n     */\n    searchItems(query: string): GameItem[] {\n        const lowerQuery = query.toLowerCase();\n        return Array.from(this.items.values()).filter(item => \n            item.name.toLowerCase().includes(lowerQuery) ||\n            item.description.toLowerCase().includes(lowerQuery)\n        );\n    }\n\n    /**\n     * Generate random item by rarity\n     */\n    generateRandomItem(rarity?: ItemRarity): GameItem | null {\n        let candidateItems: GameItem[];\n        \n        if (rarity) {\n            candidateItems = this.getItemsByRarity(rarity);\n        } else {\n            // Weighted random by rarity\n            const rarityWeights = {\n                [ItemRarity.Common]: 50,\n                [ItemRarity.Uncommon]: 25,\n                [ItemRarity.Rare]: 15,\n                [ItemRarity.Epic]: 8,\n                [ItemRarity.Legendary]: 1.5,\n                [ItemRarity.Artifact]: 0.5\n            };\n            \n            const totalWeight = Object.values(rarityWeights).reduce((sum, weight) => sum + weight, 0);\n            const random = Math.random() * totalWeight;\n            \n            let currentWeight = 0;\n            let selectedRarity: ItemRarity = ItemRarity.Common;\n            \n            for (const [rarity, weight] of Object.entries(rarityWeights)) {\n                currentWeight += weight;\n                if (random <= currentWeight) {\n                    selectedRarity = rarity as ItemRarity;\n                    break;\n                }\n            }\n            \n            candidateItems = this.getItemsByRarity(selectedRarity);\n        }\n        \n        if (candidateItems.length === 0) return null;\n        \n        const randomIndex = Math.floor(Math.random() * candidateItems.length);\n        return candidateItems[randomIndex];\n    }\n\n    /**\n     * Render item sprite\n     */\n    renderItemSprite(renderer: Renderer, item: GameItem, x: number, y: number, scale: number = 1): void {\n        const sprite = item.sprite;\n        \n        for (let sy = 0; sy < sprite.height; sy++) {\n            for (let sx = 0; sx < sprite.width; sx++) {\n                const pixel = sprite.pixels[sy][sx];\n                if (pixel.r > 0 || pixel.g > 0 || pixel.b > 0) { // Skip transparent pixels\n                    if (scale === 1) {\n                        renderer.setPixel(x + sx, y + sy, pixel);\n                    } else {\n                        // Scale up the pixel\n                        for (let dy = 0; dy < scale; dy++) {\n                            for (let dx = 0; dx < scale; dx++) {\n                                renderer.setPixel(x + sx * scale + dx, y + sy * scale + dy, pixel);\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Get database statistics\n     */\n    getStats(): {\n        totalItems: number;\n        itemsByType: { [type: string]: number };\n        itemsByRarity: { [rarity: string]: number };\n        categories: number;\n    } {\n        const itemsByType: { [type: string]: number } = {};\n        const itemsByRarity: { [rarity: string]: number } = {};\n        \n        this.items.forEach(item => {\n            itemsByType[item.type] = (itemsByType[item.type] || 0) + 1;\n            itemsByRarity[item.rarity] = (itemsByRarity[item.rarity] || 0) + 1;\n        });\n        \n        return {\n            totalItems: this.items.size,\n            itemsByType,\n            itemsByRarity,\n            categories: this.categories.size\n        };\n    }\n}","/**\n * Inventory Management System\n * Grid-based inventory with advanced management features and retro UI\n */\n\nimport { Logger } from '@utils/Logger';\nimport { GameItem, ItemStack, ItemType, ItemRarity, ItemDatabase } from '@items/ItemSystem';\nimport { Renderer, Color, Vector2 } from '@core/Renderer';\n\nexport interface InventoryConfig {\n    maxSlots: number;\n    gridWidth: number;\n    gridHeight: number;\n    maxWeight: number;\n    maxVolume: number;\n    allowStacking: boolean;\n}\n\nexport interface InventorySlot {\n    index: number;\n    item: ItemStack | null;\n    x: number; // Grid position\n    y: number;\n    locked: boolean; // Locked slots can't be used\n    reserved: boolean; // Reserved for specific item types\n}\n\nexport interface InventoryFilter {\n    type?: ItemType;\n    rarity?: ItemRarity;\n    searchText?: string;\n    showOnlyUsable?: boolean;\n}\n\nexport interface InventorySortOptions {\n    by: 'name' | 'type' | 'rarity' | 'quantity' | 'value';\n    descending: boolean;\n    groupByType: boolean;\n}\n\nexport interface InventoryEvents {\n    onItemAdded?: (item: GameItem, quantity: number) => void;\n    onItemRemoved?: (item: GameItem, quantity: number) => void;\n    onInventoryFull?: () => void;\n    onWeightExceeded?: () => void;\n    onVolumeExceeded?: () => void;\n    onSlotSelected?: (slot: InventorySlot) => void;\n}\n\nexport class InventoryManager {\n    private config: InventoryConfig;\n    private events: InventoryEvents;\n    private itemDatabase: ItemDatabase;\n    \n    // Storage\n    private slots: InventorySlot[] = [];\n    private totalWeight: number = 0;\n    private totalVolume: number = 0;\n    \n    // UI State\n    private selectedSlot: number = -1;\n    private draggedItem: ItemStack | null = null;\n    private filter: InventoryFilter = {};\n    private sortOptions: InventorySortOptions = { by: 'name', descending: false, groupByType: false };\n    private isVisible: boolean = false;\n    \n    // Visual properties\n    private slotSize: number = 32;\n    private slotSpacing: number = 2;\n    private panelX: number = 50;\n    private panelY: number = 50;\n    \n    private logger: Logger;\n\n    constructor(\n        config: Partial<InventoryConfig> = {},\n        events: InventoryEvents = {},\n        itemDatabase: ItemDatabase\n    ) {\n        this.logger = new Logger('InventoryManager');\n        this.itemDatabase = itemDatabase;\n        this.events = events;\n        \n        this.config = {\n            maxSlots: 50,\n            gridWidth: 10,\n            gridHeight: 5,\n            maxWeight: 1000,\n            maxVolume: 500,\n            allowStacking: true,\n            ...config\n        };\n        \n        this.initializeSlots();\n        \n        this.logger.info('📦 Inventory manager initialized', {\n            slots: this.config.maxSlots,\n            maxWeight: this.config.maxWeight,\n            maxVolume: this.config.maxVolume\n        });\n    }\n\n    /**\n     * Initialize inventory slots\n     */\n    private initializeSlots(): void {\n        this.slots = [];\n        \n        for (let i = 0; i < this.config.maxSlots; i++) {\n            const x = i % this.config.gridWidth;\n            const y = Math.floor(i / this.config.gridWidth);\n            \n            this.slots.push({\n                index: i,\n                item: null,\n                x,\n                y,\n                locked: false,\n                reserved: false\n            });\n        }\n    }\n\n    /**\n     * Add item to inventory\n     */\n    addItem(item: GameItem, quantity: number = 1): boolean {\n        if (quantity <= 0) return false;\n        \n        let remainingQuantity = quantity;\n        \n        // Try to stack with existing items first\n        if (this.config.allowStacking && item.stats.maxStack > 1) {\n            for (const slot of this.slots) {\n                if (slot.item && slot.item.item.id === item.id) {\n                    const canAdd = Math.min(remainingQuantity, item.stats.maxStack - slot.item.quantity);\n                    if (canAdd > 0) {\n                        slot.item.quantity += canAdd;\n                        remainingQuantity -= canAdd;\n                        \n                        if (remainingQuantity === 0) break;\n                    }\n                }\n            }\n        }\n        \n        // Add to empty slots\n        while (remainingQuantity > 0) {\n            const emptySlot = this.findEmptySlot();\n            if (!emptySlot) {\n                this.events.onInventoryFull?.();\n                return false;\n            }\n            \n            const stackSize = Math.min(remainingQuantity, item.stats.maxStack);\n            \n            // Check weight and volume constraints\n            const addedWeight = item.stats.mass * stackSize;\n            const addedVolume = item.stats.volume * stackSize;\n            \n            if (this.totalWeight + addedWeight > this.config.maxWeight) {\n                this.events.onWeightExceeded?.();\n                return false;\n            }\n            \n            if (this.totalVolume + addedVolume > this.config.maxVolume) {\n                this.events.onVolumeExceeded?.();\n                return false;\n            }\n            \n            // Add to slot\n            emptySlot.item = {\n                item: item,\n                quantity: stackSize,\n                condition: item.type === ItemType.Equipment ? 1.0 : undefined\n            };\n            \n            this.totalWeight += addedWeight;\n            this.totalVolume += addedVolume;\n            remainingQuantity -= stackSize;\n        }\n        \n        this.events.onItemAdded?.(item, quantity);\n        this.logger.debug(`Added ${quantity}x ${item.name} to inventory`);\n        \n        return true;\n    }\n\n    /**\n     * Remove item from inventory\n     */\n    removeItem(itemId: string, quantity: number = 1): boolean {\n        if (quantity <= 0) return false;\n        \n        let remainingQuantity = quantity;\n        \n        for (const slot of this.slots) {\n            if (slot.item && slot.item.item.id === itemId && remainingQuantity > 0) {\n                const canRemove = Math.min(remainingQuantity, slot.item.quantity);\n                \n                // Update weight and volume\n                const removedWeight = slot.item.item.stats.mass * canRemove;\n                const removedVolume = slot.item.item.stats.volume * canRemove;\n                this.totalWeight -= removedWeight;\n                this.totalVolume -= removedVolume;\n                \n                slot.item.quantity -= canRemove;\n                remainingQuantity -= canRemove;\n                \n                if (slot.item.quantity === 0) {\n                    const removedItem = slot.item.item;\n                    slot.item = null;\n                    this.events.onItemRemoved?.(removedItem, canRemove);\n                }\n            }\n        }\n        \n        return remainingQuantity === 0;\n    }\n\n    /**\n     * Move item between slots\n     */\n    moveItem(fromSlot: number, toSlot: number): boolean {\n        if (fromSlot < 0 || fromSlot >= this.slots.length || \n            toSlot < 0 || toSlot >= this.slots.length) {\n            return false;\n        }\n        \n        const from = this.slots[fromSlot];\n        const to = this.slots[toSlot];\n        \n        if (!from.item || to.locked) return false;\n        \n        // If target slot is empty, move the item\n        if (!to.item) {\n            to.item = from.item;\n            from.item = null;\n            return true;\n        }\n        \n        // If both slots have the same item and stacking is allowed\n        if (this.config.allowStacking && \n            from.item.item.id === to.item.item.id &&\n            from.item.item.stats.maxStack > 1) {\n            \n            const canStack = Math.min(\n                from.item.quantity, \n                from.item.item.stats.maxStack - to.item.quantity\n            );\n            \n            if (canStack > 0) {\n                to.item.quantity += canStack;\n                from.item.quantity -= canStack;\n                \n                if (from.item.quantity === 0) {\n                    from.item = null;\n                }\n                return true;\n            }\n        }\n        \n        // Swap items\n        const temp = from.item;\n        from.item = to.item;\n        to.item = temp;\n        \n        return true;\n    }\n\n    /**\n     * Find first empty slot\n     */\n    private findEmptySlot(): InventorySlot | null {\n        return this.slots.find(slot => !slot.item && !slot.locked) || null;\n    }\n\n    /**\n     * Get item count\n     */\n    getItemCount(itemId: string): number {\n        return this.slots\n            .filter(slot => slot.item && slot.item.item.id === itemId)\n            .reduce((total, slot) => total + slot.item!.quantity, 0);\n    }\n\n    /**\n     * Has item\n     */\n    hasItem(itemId: string, quantity: number = 1): boolean {\n        return this.getItemCount(itemId) >= quantity;\n    }\n\n    /**\n     * Get all items\n     */\n    getAllItems(): ItemStack[] {\n        return this.slots\n            .filter(slot => slot.item !== null)\n            .map(slot => slot.item!);\n    }\n\n    /**\n     * Get filtered and sorted items\n     */\n    getFilteredItems(): ItemStack[] {\n        let items = this.getAllItems();\n        \n        // Apply filters\n        if (this.filter.type) {\n            items = items.filter(stack => stack.item.type === this.filter.type);\n        }\n        \n        if (this.filter.rarity) {\n            items = items.filter(stack => stack.item.rarity === this.filter.rarity);\n        }\n        \n        if (this.filter.searchText) {\n            const search = this.filter.searchText.toLowerCase();\n            items = items.filter(stack => \n                stack.item.name.toLowerCase().includes(search) ||\n                stack.item.description.toLowerCase().includes(search)\n            );\n        }\n        \n        // Apply sorting\n        items.sort((a, b) => {\n            let comparison = 0;\n            \n            switch (this.sortOptions.by) {\n                case 'name':\n                    comparison = a.item.name.localeCompare(b.item.name);\n                    break;\n                case 'type':\n                    comparison = a.item.type.localeCompare(b.item.type);\n                    break;\n                case 'rarity':\n                    const rarityOrder = ['common', 'uncommon', 'rare', 'epic', 'legendary', 'artifact'];\n                    comparison = rarityOrder.indexOf(a.item.rarity) - rarityOrder.indexOf(b.item.rarity);\n                    break;\n                case 'quantity':\n                    comparison = a.quantity - b.quantity;\n                    break;\n            }\n            \n            return this.sortOptions.descending ? -comparison : comparison;\n        });\n        \n        return items;\n    }\n\n    /**\n     * Compact inventory (remove gaps)\n     */\n    compactInventory(): void {\n        const items: ItemStack[] = [];\n        \n        // Collect all items\n        this.slots.forEach(slot => {\n            if (slot.item) {\n                items.push(slot.item);\n                slot.item = null;\n            }\n        });\n        \n        // Clear weight/volume\n        this.totalWeight = 0;\n        this.totalVolume = 0;\n        \n        // Re-add items compactly\n        items.forEach(stack => {\n            this.addItem(stack.item, stack.quantity);\n        });\n        \n        this.logger.info('📦 Inventory compacted');\n    }\n\n    /**\n     * Auto-sort inventory\n     */\n    autoSort(): void {\n        const items = this.getAllItems();\n        \n        // Clear inventory\n        this.slots.forEach(slot => slot.item = null);\n        this.totalWeight = 0;\n        this.totalVolume = 0;\n        \n        // Sort items\n        items.sort((a, b) => {\n            // First by type\n            if (a.item.type !== b.item.type) {\n                return a.item.type.localeCompare(b.item.type);\n            }\n            \n            // Then by rarity\n            const rarityOrder = ['artifact', 'legendary', 'epic', 'rare', 'uncommon', 'common'];\n            const aRarity = rarityOrder.indexOf(a.item.rarity);\n            const bRarity = rarityOrder.indexOf(b.item.rarity);\n            \n            if (aRarity !== bRarity) {\n                return aRarity - bRarity;\n            }\n            \n            // Finally by name\n            return a.item.name.localeCompare(b.item.name);\n        });\n        \n        // Re-add sorted items\n        items.forEach(stack => {\n            this.addItem(stack.item, stack.quantity);\n        });\n        \n        this.logger.info('📦 Inventory auto-sorted');\n    }\n\n    /**\n     * Get inventory statistics\n     */\n    getStats(): {\n        usedSlots: number;\n        totalSlots: number;\n        totalWeight: number;\n        maxWeight: number;\n        totalVolume: number;\n        maxVolume: number;\n        itemCount: number;\n        uniqueItems: number;\n        fillPercentage: number;\n        weightPercentage: number;\n        volumePercentage: number;\n    } {\n        const usedSlots = this.slots.filter(slot => slot.item !== null).length;\n        const uniqueItems = new Set(this.slots\n            .filter(slot => slot.item)\n            .map(slot => slot.item!.item.id)\n        ).size;\n        \n        const totalItems = this.slots\n            .filter(slot => slot.item)\n            .reduce((total, slot) => total + slot.item!.quantity, 0);\n        \n        return {\n            usedSlots,\n            totalSlots: this.config.maxSlots,\n            totalWeight: this.totalWeight,\n            maxWeight: this.config.maxWeight,\n            totalVolume: this.totalVolume,\n            maxVolume: this.config.maxVolume,\n            itemCount: totalItems,\n            uniqueItems,\n            fillPercentage: (usedSlots / this.config.maxSlots) * 100,\n            weightPercentage: (this.totalWeight / this.config.maxWeight) * 100,\n            volumePercentage: (this.totalVolume / this.config.maxVolume) * 100\n        };\n    }\n\n    /**\n     * Render inventory UI\n     */\n    render(renderer: Renderer): void {\n        if (!this.isVisible) return;\n        \n        // Render background panel\n        this.renderBackground(renderer);\n        \n        // Render header\n        this.renderHeader(renderer);\n        \n        // Render grid\n        this.renderGrid(renderer);\n        \n        // Render items\n        this.renderItems(renderer);\n        \n        // Render selection\n        if (this.selectedSlot >= 0) {\n            this.renderSelection(renderer);\n        }\n        \n        // Render dragged item\n        if (this.draggedItem) {\n            this.renderDraggedItem(renderer);\n        }\n        \n        // Render statistics\n        this.renderStats(renderer);\n    }\n\n    /**\n     * Render background panel\n     */\n    private renderBackground(renderer: Renderer): void {\n        const panelWidth = this.config.gridWidth * (this.slotSize + this.slotSpacing) + 40;\n        const panelHeight = this.config.gridHeight * (this.slotSize + this.slotSpacing) + 150;\n        \n        // Dark panel background\n        renderer.fillRect(this.panelX, this.panelY, panelWidth, panelHeight, { r: 8, g: 12, b: 8 });\n        \n        // Panel border\n        renderer.drawLine(this.panelX, this.panelY, this.panelX + panelWidth, this.panelY, { r: 16, g: 48, b: 16 });\n        renderer.drawLine(this.panelX, this.panelY, this.panelX, this.panelY + panelHeight, { r: 16, g: 48, b: 16 });\n        renderer.drawLine(this.panelX + panelWidth, this.panelY, this.panelX + panelWidth, this.panelY + panelHeight, { r: 16, g: 48, b: 16 });\n        renderer.drawLine(this.panelX, this.panelY + panelHeight, this.panelX + panelWidth, this.panelY + panelHeight, { r: 16, g: 48, b: 16 });\n    }\n\n    /**\n     * Render header\n     */\n    private renderHeader(renderer: Renderer): void {\n        renderer.renderText('INVENTORY', this.panelX + 10, this.panelY + 10, { r: 12, g: 36, b: 12 }, 12);\n        \n        // Quick action buttons\n        const buttonY = this.panelY + 25;\n        renderer.renderText('[S]ORT', this.panelX + 10, buttonY, { r: 32, g: 32, b: 32 }, 8);\n        renderer.renderText('[C]OMPACT', this.panelX + 80, buttonY, { r: 32, g: 32, b: 32 }, 8);\n        renderer.renderText('[F]ILTER', this.panelX + 160, buttonY, { r: 32, g: 32, b: 32 }, 8);\n    }\n\n    /**\n     * Render inventory grid\n     */\n    private renderGrid(renderer: Renderer): void {\n        const gridStartX = this.panelX + 20;\n        const gridStartY = this.panelY + 50;\n        \n        for (let y = 0; y < this.config.gridHeight; y++) {\n            for (let x = 0; x < this.config.gridWidth; x++) {\n                const slotX = gridStartX + x * (this.slotSize + this.slotSpacing);\n                const slotY = gridStartY + y * (this.slotSize + this.slotSpacing);\n                \n                const slotIndex = y * this.config.gridWidth + x;\n                const slot = this.slots[slotIndex];\n                \n                // Slot background\n                let bgColor = { r: 16, g: 16, b: 16 };\n                if (slot.locked) {\n                    bgColor = { r: 24, g: 8, b: 8 }; // Red tint for locked\n                } else if (slot.reserved) {\n                    bgColor = { r: 8, g: 24, b: 8 }; // Green tint for reserved\n                }\n                \n                renderer.fillRect(slotX, slotY, this.slotSize, this.slotSize, bgColor);\n                \n                // Slot border\n                const borderColor = { r: 32, g: 32, b: 32 };\n                renderer.drawLine(slotX, slotY, slotX + this.slotSize, slotY, borderColor);\n                renderer.drawLine(slotX, slotY, slotX, slotY + this.slotSize, borderColor);\n                renderer.drawLine(slotX + this.slotSize, slotY, slotX + this.slotSize, slotY + this.slotSize, borderColor);\n                renderer.drawLine(slotX, slotY + this.slotSize, slotX + this.slotSize, slotY + this.slotSize, borderColor);\n            }\n        }\n    }\n\n    /**\n     * Render items in slots\n     */\n    private renderItems(renderer: Renderer): void {\n        const gridStartX = this.panelX + 20;\n        const gridStartY = this.panelY + 50;\n        \n        this.slots.forEach((slot, index) => {\n            if (!slot.item) return;\n            \n            const slotX = gridStartX + slot.x * (this.slotSize + this.slotSpacing);\n            const slotY = gridStartY + slot.y * (this.slotSize + this.slotSpacing);\n            \n            // Render item sprite\n            const spriteX = slotX + (this.slotSize - 16) / 2;\n            const spriteY = slotY + (this.slotSize - 16) / 2;\n            this.itemDatabase.renderItemSprite(renderer, slot.item.item, spriteX, spriteY, 1);\n            \n            // Render quantity if > 1\n            if (slot.item.quantity > 1) {\n                const quantityText = slot.item.quantity.toString();\n                renderer.renderText(quantityText, slotX + this.slotSize - 15, slotY + this.slotSize - 10, \n                    { r: 48, g: 48, b: 48 }, 8);\n            }\n            \n            // Render rarity indicator\n            const rarityColor = this.getRarityColor(slot.item.item.rarity);\n            renderer.fillRect(slotX + 2, slotY + 2, 4, 4, rarityColor);\n            \n            // Render condition bar for equipment\n            if (slot.item.condition !== undefined) {\n                const conditionWidth = Math.floor((this.slotSize - 4) * slot.item.condition);\n                const conditionColor = slot.item.condition > 0.7 ? \n                    { r: 12, g: 36, b: 12 } : \n                    slot.item.condition > 0.3 ? \n                        { r: 72, g: 48, b: 12 } : \n                        { r: 72, g: 24, b: 24 };\n                \n                renderer.fillRect(slotX + 2, slotY + this.slotSize - 4, conditionWidth, 2, conditionColor);\n            }\n        });\n    }\n\n    /**\n     * Get rarity color\n     */\n    private getRarityColor(rarity: ItemRarity): Color {\n        switch (rarity) {\n            case ItemRarity.Common: return { r: 48, g: 48, b: 48 };\n            case ItemRarity.Uncommon: return { r: 32, g: 48, b: 32 };\n            case ItemRarity.Rare: return { r: 32, g: 40, b: 48 };\n            case ItemRarity.Epic: return { r: 48, g: 32, b: 72 };\n            case ItemRarity.Legendary: return { r: 96, g: 64, b: 16 };\n            case ItemRarity.Artifact: return { r: 64, g: 32, b: 96 };\n            default: return { r: 32, g: 32, b: 32 };\n        }\n    }\n\n    /**\n     * Render selection highlight\n     */\n    private renderSelection(renderer: Renderer): void {\n        const slot = this.slots[this.selectedSlot];\n        if (!slot) return;\n        \n        const gridStartX = this.panelX + 20;\n        const gridStartY = this.panelY + 50;\n        const slotX = gridStartX + slot.x * (this.slotSize + this.slotSpacing);\n        const slotY = gridStartY + slot.y * (this.slotSize + this.slotSpacing);\n        \n        // Selection highlight\n        const highlightColor = { r: 16, g: 48, b: 16 };\n        renderer.drawLine(slotX - 1, slotY - 1, slotX + this.slotSize + 1, slotY - 1, highlightColor);\n        renderer.drawLine(slotX - 1, slotY - 1, slotX - 1, slotY + this.slotSize + 1, highlightColor);\n        renderer.drawLine(slotX + this.slotSize + 1, slotY - 1, slotX + this.slotSize + 1, slotY + this.slotSize + 1, highlightColor);\n        renderer.drawLine(slotX - 1, slotY + this.slotSize + 1, slotX + this.slotSize + 1, slotY + this.slotSize + 1, highlightColor);\n    }\n\n    /**\n     * Render dragged item\n     */\n    private renderDraggedItem(renderer: Renderer): void {\n        // TODO: Implement drag rendering when mouse system is available\n    }\n\n    /**\n     * Render statistics\n     */\n    private renderStats(renderer: Renderer): void {\n        const stats = this.getStats();\n        const statsY = this.panelY + this.config.gridHeight * (this.slotSize + this.slotSpacing) + 70;\n        \n        const textColor = { r: 48, g: 48, b: 48 };\n        \n        renderer.renderText(`SLOTS: ${stats.usedSlots}/${stats.totalSlots}`, \n            this.panelX + 10, statsY, textColor, 8);\n        \n        renderer.renderText(`WEIGHT: ${stats.totalWeight.toFixed(1)}/${stats.maxWeight}`, \n            this.panelX + 10, statsY + 12, textColor, 8);\n        \n        renderer.renderText(`VOLUME: ${stats.totalVolume.toFixed(1)}/${stats.maxVolume}`, \n            this.panelX + 10, statsY + 24, textColor, 8);\n        \n        renderer.renderText(`ITEMS: ${stats.itemCount} (${stats.uniqueItems} types)`, \n            this.panelX + 10, statsY + 36, textColor, 8);\n    }\n\n    /**\n     * Show/hide inventory\n     */\n    setVisible(visible: boolean): void {\n        this.isVisible = visible;\n    }\n\n    /**\n     * Check if inventory is visible\n     */\n    isInventoryVisible(): boolean {\n        return this.isVisible;\n    }\n\n    /**\n     * Select slot\n     */\n    selectSlot(slotIndex: number): void {\n        if (slotIndex >= 0 && slotIndex < this.slots.length) {\n            this.selectedSlot = slotIndex;\n            this.events.onSlotSelected?.(this.slots[slotIndex]);\n        }\n    }\n\n    /**\n     * Get selected slot\n     */\n    getSelectedSlot(): InventorySlot | null {\n        return this.selectedSlot >= 0 ? this.slots[this.selectedSlot] : null;\n    }\n\n    /**\n     * Use item in selected slot\n     */\n    useSelectedItem(): boolean {\n        const slot = this.getSelectedSlot();\n        if (!slot || !slot.item) return false;\n        \n        const item = slot.item.item;\n        \n        if (item.isConsumable) {\n            // Use consumable item\n            this.removeItem(item.id, 1);\n            this.logger.info(`Used ${item.name}`);\n            return true;\n        }\n        \n        return false;\n    }\n\n    /**\n     * Set filter\n     */\n    setFilter(filter: Partial<InventoryFilter>): void {\n        this.filter = { ...this.filter, ...filter };\n    }\n\n    /**\n     * Clear filter\n     */\n    clearFilter(): void {\n        this.filter = {};\n    }\n\n    /**\n     * Set sort options\n     */\n    setSortOptions(options: Partial<InventorySortOptions>): void {\n        this.sortOptions = { ...this.sortOptions, ...options };\n    }\n\n    /**\n     * Lock/unlock slot\n     */\n    setSlotLocked(slotIndex: number, locked: boolean): void {\n        if (slotIndex >= 0 && slotIndex < this.slots.length) {\n            this.slots[slotIndex].locked = locked;\n        }\n    }\n\n    /**\n     * Reserve/unreserve slot\n     */\n    setSlotReserved(slotIndex: number, reserved: boolean): void {\n        if (slotIndex >= 0 && slotIndex < this.slots.length) {\n            this.slots[slotIndex].reserved = reserved;\n        }\n    }\n\n    /**\n     * Clear inventory\n     */\n    clearInventory(): void {\n        this.slots.forEach(slot => slot.item = null);\n        this.totalWeight = 0;\n        this.totalVolume = 0;\n        this.selectedSlot = -1;\n        this.logger.info('📦 Inventory cleared');\n    }\n\n    /**\n     * Save inventory state\n     */\n    saveState(): any {\n        return {\n            slots: this.slots.map(slot => ({\n                index: slot.index,\n                item: slot.item ? {\n                    itemId: slot.item.item.id,\n                    quantity: slot.item.quantity,\n                    condition: slot.item.condition,\n                    modifiers: slot.item.modifiers\n                } : null,\n                locked: slot.locked,\n                reserved: slot.reserved\n            })),\n            totalWeight: this.totalWeight,\n            totalVolume: this.totalVolume\n        };\n    }\n\n    /**\n     * Load inventory state\n     */\n    loadState(state: any): void {\n        this.clearInventory();\n        \n        state.slots.forEach((slotData: any, index: number) => {\n            if (index < this.slots.length) {\n                const slot = this.slots[index];\n                slot.locked = slotData.locked || false;\n                slot.reserved = slotData.reserved || false;\n                \n                if (slotData.item) {\n                    const item = this.itemDatabase.getItem(slotData.item.itemId);\n                    if (item) {\n                        slot.item = {\n                            item,\n                            quantity: slotData.item.quantity,\n                            condition: slotData.item.condition,\n                            modifiers: slotData.item.modifiers\n                        };\n                    }\n                }\n            }\n        });\n        \n        this.totalWeight = state.totalWeight || 0;\n        this.totalVolume = state.totalVolume || 0;\n        \n        this.logger.info('📦 Inventory state loaded');\n    }\n}","/**\n * Crafting System\n * Basic crafting mechanics for combining items into new ones\n */\n\nimport { Logger } from '@utils/Logger';\nimport { GameItem, ItemDatabase, ItemRecipe, ItemType, ItemRarity } from '@items/ItemSystem';\nimport { InventoryManager } from '@inventory/InventoryManager';\nimport { Renderer, Color } from '@core/Renderer';\n\nexport interface CraftingStation {\n    id: string;\n    name: string;\n    type: 'basic' | 'advanced' | 'industrial';\n    availableRecipes: string[]; // Recipe IDs\n    energyRequired: number;\n    isActive: boolean;\n}\n\nexport interface CraftingAttempt {\n    recipeId: string;\n    station: CraftingStation;\n    startTime: number;\n    duration: number;\n    energyCost: number;\n    successRate: number;\n}\n\nexport interface CraftingEvents {\n    onCraftingStarted?: (attempt: CraftingAttempt) => void;\n    onCraftingCompleted?: (item: GameItem, success: boolean) => void;\n    onCraftingFailed?: (reason: string) => void;\n}\n\nexport class CraftingSystem {\n    private itemDatabase: ItemDatabase;\n    private inventory: InventoryManager;\n    private events: CraftingEvents;\n    \n    // Crafting state\n    private stations: Map<string, CraftingStation> = new Map();\n    private activeAttempts: CraftingAttempt[] = [];\n    private knownRecipes: Set<string> = new Set();\n    \n    // UI state\n    private isVisible: boolean = false;\n    private selectedStation: string | null = null;\n    private selectedRecipe: string | null = null;\n    \n    private logger: Logger;\n\n    constructor(\n        itemDatabase: ItemDatabase,\n        inventory: InventoryManager,\n        events: CraftingEvents = {}\n    ) {\n        this.logger = new Logger('CraftingSystem');\n        this.itemDatabase = itemDatabase;\n        this.inventory = inventory;\n        this.events = events;\n        \n        this.initializeStations();\n        this.initializeBasicRecipes();\n        \n        this.logger.info('🔧 Crafting system initialized', {\n            stations: this.stations.size,\n            knownRecipes: this.knownRecipes.size\n        });\n    }\n\n    /**\n     * Initialize crafting stations\n     */\n    private initializeStations(): void {\n        const stations: CraftingStation[] = [\n            {\n                id: 'basic_fabricator',\n                name: 'Basic Fabricator',\n                type: 'basic',\n                availableRecipes: [],\n                energyRequired: 10,\n                isActive: true\n            },\n            {\n                id: 'advanced_forge',\n                name: 'Advanced Forge',\n                type: 'advanced',\n                availableRecipes: [],\n                energyRequired: 25,\n                isActive: true\n            },\n            {\n                id: 'industrial_plant',\n                name: 'Industrial Plant',\n                type: 'industrial',\n                availableRecipes: [],\n                energyRequired: 50,\n                isActive: false // Requires research to unlock\n            }\n        ];\n        \n        stations.forEach(station => {\n            this.stations.set(station.id, station);\n        });\n    }\n\n    /**\n     * Initialize basic crafting recipes\n     */\n    private initializeBasicRecipes(): void {\n        // Create some basic recipes\n        const basicRecipes: ItemRecipe[] = [\n            {\n                id: 'craft_circuit_from_metal',\n                requiredItems: {\n                    'metal_iron': 2,\n                    'crystal_quartz': 1\n                },\n                craftingTime: 5, // 5 seconds\n                energyCost: 10,\n                successRate: 0.9\n            },\n            {\n                id: 'craft_repair_kit',\n                requiredItems: {\n                    'metal_iron': 1,\n                    'comp_circuit': 1\n                },\n                craftingTime: 8,\n                energyCost: 15,\n                successRate: 0.85\n            },\n            {\n                id: 'craft_energy_cell',\n                requiredItems: {\n                    'crystal_quartz': 2,\n                    'gas_hydrogen': 5\n                },\n                craftingTime: 3,\n                energyCost: 5,\n                successRate: 0.95\n            },\n            {\n                id: 'craft_shield_emitter',\n                requiredItems: {\n                    'metal_titanium': 3,\n                    'crystal_quartz': 2,\n                    'comp_circuit': 1\n                },\n                craftingTime: 15,\n                energyCost: 30,\n                successRate: 0.7\n            },\n            {\n                id: 'craft_plasma_conduit',\n                requiredItems: {\n                    'metal_titanium': 2,\n                    'crystal_dilithium': 1,\n                    'comp_circuit': 2\n                },\n                craftingTime: 20,\n                energyCost: 40,\n                successRate: 0.6\n            }\n        ];\n        \n        // Add recipes to appropriate items and stations\n        basicRecipes.forEach(recipe => {\n            // Add recipe to basic fabricator\n            const basicStation = this.stations.get('basic_fabricator');\n            if (basicStation) {\n                basicStation.availableRecipes.push(recipe.id);\n            }\n            \n            // Advanced recipes go to advanced forge\n            if (recipe.energyCost > 20) {\n                const advancedStation = this.stations.get('advanced_forge');\n                if (advancedStation) {\n                    advancedStation.availableRecipes.push(recipe.id);\n                }\n            }\n            \n            // Add to known recipes (player starts with basic knowledge)\n            if (recipe.energyCost <= 15) {\n                this.knownRecipes.add(recipe.id);\n            }\n        });\n        \n        // Update item database with recipes\n        this.updateItemRecipes(basicRecipes);\n    }\n\n    /**\n     * Update item database with crafting recipes\n     */\n    private updateItemRecipes(recipes: ItemRecipe[]): void {\n        recipes.forEach(recipe => {\n            // Find the target item for this recipe\n            const targetItem = this.findTargetItemForRecipe(recipe.id);\n            if (targetItem) {\n                targetItem.recipe = recipe;\n            }\n        });\n    }\n\n    /**\n     * Find target item for a recipe based on recipe ID\n     */\n    private findTargetItemForRecipe(recipeId: string): GameItem | undefined {\n        // Map recipe IDs to item IDs\n        const recipeToItemMap: { [key: string]: string } = {\n            'craft_circuit_from_metal': 'comp_circuit',\n            'craft_repair_kit': 'tool_repair_kit',\n            'craft_energy_cell': 'cons_energy_cell',\n            'craft_shield_emitter': 'comp_shield_emitter',\n            'craft_plasma_conduit': 'comp_plasma_conduit'\n        };\n        \n        const itemId = recipeToItemMap[recipeId];\n        return itemId ? this.itemDatabase.getItem(itemId) : undefined;\n    }\n\n    /**\n     * Start crafting an item\n     */\n    startCrafting(recipeId: string, stationId: string): boolean {\n        const station = this.stations.get(stationId);\n        const targetItem = this.findTargetItemForRecipe(recipeId);\n        \n        if (!station || !targetItem || !targetItem.recipe) {\n            this.events.onCraftingFailed?.('Invalid recipe or station');\n            return false;\n        }\n        \n        if (!station.isActive) {\n            this.events.onCraftingFailed?.('Crafting station is offline');\n            return false;\n        }\n        \n        if (!this.knownRecipes.has(recipeId)) {\n            this.events.onCraftingFailed?.('Recipe not yet discovered');\n            return false;\n        }\n        \n        if (!station.availableRecipes.includes(recipeId)) {\n            this.events.onCraftingFailed?.('Station cannot craft this item');\n            return false;\n        }\n        \n        const recipe = targetItem.recipe;\n        \n        // Check if player has required items\n        for (const [itemId, quantity] of Object.entries(recipe.requiredItems)) {\n            if (!this.inventory.hasItem(itemId, quantity)) {\n                this.events.onCraftingFailed?.(`Insufficient ${itemId}: need ${quantity}`);\n                return false;\n            }\n        }\n        \n        // TODO: Check energy requirements\n        // For now, assume player has enough energy\n        \n        // Remove required items from inventory\n        for (const [itemId, quantity] of Object.entries(recipe.requiredItems)) {\n            this.inventory.removeItem(itemId, quantity);\n        }\n        \n        // Create crafting attempt\n        const attempt: CraftingAttempt = {\n            recipeId,\n            station,\n            startTime: Date.now(),\n            duration: recipe.craftingTime * 1000, // Convert to milliseconds\n            energyCost: recipe.energyCost,\n            successRate: recipe.successRate\n        };\n        \n        this.activeAttempts.push(attempt);\n        this.events.onCraftingStarted?.(attempt);\n        \n        this.logger.info(`🔧 Started crafting ${targetItem.name}`, {\n            station: station.name,\n            duration: recipe.craftingTime,\n            successRate: recipe.successRate\n        });\n        \n        return true;\n    }\n\n    /**\n     * Update crafting system\n     */\n    update(deltaTime: number): void {\n        const currentTime = Date.now();\n        const completedAttempts: CraftingAttempt[] = [];\n        \n        // Check for completed crafting attempts\n        this.activeAttempts.forEach(attempt => {\n            if (currentTime >= attempt.startTime + attempt.duration) {\n                completedAttempts.push(attempt);\n            }\n        });\n        \n        // Process completed attempts\n        completedAttempts.forEach(attempt => {\n            this.completeCrafting(attempt);\n        });\n        \n        // Remove completed attempts\n        this.activeAttempts = this.activeAttempts.filter(\n            attempt => !completedAttempts.includes(attempt)\n        );\n    }\n\n    /**\n     * Complete a crafting attempt\n     */\n    private completeCrafting(attempt: CraftingAttempt): void {\n        const targetItem = this.findTargetItemForRecipe(attempt.recipeId);\n        if (!targetItem) return;\n        \n        // Determine success based on success rate\n        const success = Math.random() < attempt.successRate;\n        \n        if (success) {\n            // Add crafted item to inventory\n            const added = this.inventory.addItem(targetItem, 1);\n            if (added) {\n                this.logger.info(`✅ Successfully crafted ${targetItem.name}`);\n                this.events.onCraftingCompleted?.(targetItem, true);\n            } else {\n                this.logger.warn(`📦 Inventory full - ${targetItem.name} lost`);\n                this.events.onCraftingFailed?.('Inventory full - item lost');\n            }\n        } else {\n            this.logger.warn(`❌ Crafting failed: ${targetItem.name}`);\n            this.events.onCraftingCompleted?.(targetItem, false);\n            \n            // On failure, return some materials (50% chance for each)\n            if (targetItem.recipe) {\n                for (const [itemId, quantity] of Object.entries(targetItem.recipe.requiredItems)) {\n                    if (Math.random() < 0.5) {\n                        const returnQuantity = Math.ceil(quantity * 0.3); // Return 30% of materials\n                        const item = this.itemDatabase.getItem(itemId);\n                        if (item) {\n                            this.inventory.addItem(item, returnQuantity);\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Learn a new recipe\n     */\n    learnRecipe(recipeId: string): boolean {\n        if (this.knownRecipes.has(recipeId)) {\n            return false; // Already known\n        }\n        \n        this.knownRecipes.add(recipeId);\n        this.logger.info(`📚 Learned new recipe: ${recipeId}`);\n        return true;\n    }\n\n    /**\n     * Get available recipes for a station\n     */\n    getAvailableRecipes(stationId: string): GameItem[] {\n        const station = this.stations.get(stationId);\n        if (!station) return [];\n        \n        return station.availableRecipes\n            .filter(recipeId => this.knownRecipes.has(recipeId))\n            .map(recipeId => this.findTargetItemForRecipe(recipeId))\n            .filter(item => item !== undefined) as GameItem[];\n    }\n\n    /**\n     * Check if recipe can be crafted\n     */\n    canCraftRecipe(recipeId: string): {\n        canCraft: boolean;\n        missingItems: { [itemId: string]: number };\n        hasStation: boolean;\n    } {\n        const targetItem = this.findTargetItemForRecipe(recipeId);\n        if (!targetItem || !targetItem.recipe) {\n            return { canCraft: false, missingItems: {}, hasStation: false };\n        }\n        \n        const recipe = targetItem.recipe;\n        const missingItems: { [itemId: string]: number } = {};\n        let hasAllItems = true;\n        \n        // Check required items\n        for (const [itemId, required] of Object.entries(recipe.requiredItems)) {\n            const available = this.inventory.getItemCount(itemId);\n            if (available < required) {\n                missingItems[itemId] = required - available;\n                hasAllItems = false;\n            }\n        }\n        \n        // Check if any station can craft this\n        const hasStation = Array.from(this.stations.values()).some(station => \n            station.isActive && station.availableRecipes.includes(recipeId)\n        );\n        \n        return {\n            canCraft: hasAllItems && hasStation && this.knownRecipes.has(recipeId),\n            missingItems,\n            hasStation\n        };\n    }\n\n    /**\n     * Get crafting progress for active attempts\n     */\n    getCraftingProgress(): Array<{\n        recipeId: string;\n        itemName: string;\n        progress: number; // 0-1\n        timeRemaining: number; // seconds\n    }> {\n        const currentTime = Date.now();\n        \n        return this.activeAttempts.map(attempt => {\n            const elapsed = currentTime - attempt.startTime;\n            const progress = Math.min(1, elapsed / attempt.duration);\n            const timeRemaining = Math.max(0, (attempt.duration - elapsed) / 1000);\n            \n            const targetItem = this.findTargetItemForRecipe(attempt.recipeId);\n            \n            return {\n                recipeId: attempt.recipeId,\n                itemName: targetItem?.name || 'Unknown',\n                progress,\n                timeRemaining\n            };\n        });\n    }\n\n    /**\n     * Render crafting UI\n     */\n    render(renderer: Renderer): void {\n        if (!this.isVisible) return;\n        \n        // Render crafting panel\n        this.renderCraftingPanel(renderer);\n        \n        // Render progress indicators\n        this.renderCraftingProgress(renderer);\n    }\n\n    /**\n     * Render main crafting panel\n     */\n    private renderCraftingPanel(renderer: Renderer): void {\n        const panelX = 300;\n        const panelY = 100;\n        const panelWidth = 400;\n        const panelHeight = 300;\n        \n        // Panel background\n        renderer.fillRect(panelX, panelY, panelWidth, panelHeight, { r: 8, g: 12, b: 8 });\n        \n        // Panel border\n        const borderColor = { r: 16, g: 48, b: 16 };\n        renderer.drawLine(panelX, panelY, panelX + panelWidth, panelY, borderColor);\n        renderer.drawLine(panelX, panelY, panelX, panelY + panelHeight, borderColor);\n        renderer.drawLine(panelX + panelWidth, panelY, panelX + panelWidth, panelY + panelHeight, borderColor);\n        renderer.drawLine(panelX, panelY + panelHeight, panelX + panelWidth, panelY + panelHeight, borderColor);\n        \n        // Title\n        renderer.renderText('FABRICATION UNIT', panelX + 10, panelY + 10, { r: 12, g: 36, b: 12 }, 12);\n        \n        // Station list\n        let stationY = panelY + 35;\n        this.stations.forEach(station => {\n            const stationColor = station.isActive ? \n                { r: 12, g: 36, b: 12 } : \n                { r: 32, g: 32, b: 32 };\n            \n            const statusText = station.isActive ? 'ONLINE' : 'OFFLINE';\n            renderer.renderText(`[${station.id}] ${station.name}: ${statusText}`, \n                panelX + 10, stationY, stationColor, 8);\n            stationY += 12;\n        });\n        \n        // Available recipes for selected station\n        if (this.selectedStation) {\n            const recipes = this.getAvailableRecipes(this.selectedStation);\n            \n            renderer.renderText('AVAILABLE SCHEMATICS:', panelX + 10, stationY + 10, \n                { r: 48, g: 48, b: 48 }, 8);\n            \n            let recipeY = stationY + 25;\n            recipes.forEach(item => {\n                const craftability = this.canCraftRecipe(item.recipe!.id);\n                const textColor = craftability.canCraft ? \n                    { r: 12, g: 36, b: 12 } : \n                    { r: 72, g: 24, b: 24 };\n                \n                renderer.renderText(`- ${item.name}`, panelX + 20, recipeY, textColor, 8);\n                recipeY += 12;\n                \n                // Show missing materials\n                if (Object.keys(craftability.missingItems).length > 0) {\n                    const missingText = Object.entries(craftability.missingItems)\n                        .map(([id, count]) => `${count}x ${id}`)\n                        .join(', ');\n                    renderer.renderText(`  Missing: ${missingText}`, \n                        panelX + 30, recipeY, { r: 48, g: 32, b: 32 }, 7);\n                    recipeY += 10;\n                }\n            });\n        }\n    }\n\n    /**\n     * Render crafting progress\n     */\n    private renderCraftingProgress(renderer: Renderer): void {\n        const progressItems = this.getCraftingProgress();\n        if (progressItems.length === 0) return;\n        \n        const progressX = 50;\n        let progressY = 400;\n        \n        renderer.renderText('FABRICATION IN PROGRESS:', progressX, progressY, \n            { r: 12, g: 36, b: 12 }, 10);\n        progressY += 15;\n        \n        progressItems.forEach(item => {\n            // Progress bar\n            const barWidth = 200;\n            const barHeight = 8;\n            const fillWidth = Math.floor(barWidth * item.progress);\n            \n            // Bar background\n            renderer.fillRect(progressX, progressY, barWidth, barHeight, { r: 16, g: 16, b: 16 });\n            \n            // Bar fill\n            const fillColor = item.progress >= 1 ? \n                { r: 12, g: 36, b: 12 } : \n                { r: 32, g: 80, b: 64 };\n            renderer.fillRect(progressX, progressY, fillWidth, barHeight, fillColor);\n            \n            // Item name and time\n            renderer.renderText(`${item.itemName} - ${item.timeRemaining.toFixed(1)}s`, \n                progressX + barWidth + 10, progressY, { r: 48, g: 48, b: 48 }, 8);\n            \n            progressY += 15;\n        });\n    }\n\n    /**\n     * Show/hide crafting UI\n     */\n    setVisible(visible: boolean): void {\n        this.isVisible = visible;\n    }\n\n    /**\n     * Check if crafting UI is visible\n     */\n    isCraftingVisible(): boolean {\n        return this.isVisible;\n    }\n\n    /**\n     * Select crafting station\n     */\n    selectStation(stationId: string): void {\n        if (this.stations.has(stationId)) {\n            this.selectedStation = stationId;\n        }\n    }\n\n    /**\n     * Get selected station\n     */\n    getSelectedStation(): CraftingStation | null {\n        return this.selectedStation ? this.stations.get(this.selectedStation) || null : null;\n    }\n\n    /**\n     * Activate/deactivate station\n     */\n    setStationActive(stationId: string, active: boolean): void {\n        const station = this.stations.get(stationId);\n        if (station) {\n            station.isActive = active;\n            this.logger.info(`🔧 Station ${station.name} ${active ? 'activated' : 'deactivated'}`);\n        }\n    }\n\n    /**\n     * Get crafting statistics\n     */\n    getStats(): {\n        knownRecipes: number;\n        activeStations: number;\n        totalStations: number;\n        activeCrafting: number;\n    } {\n        const activeStations = Array.from(this.stations.values()).filter(s => s.isActive).length;\n        \n        return {\n            knownRecipes: this.knownRecipes.size,\n            activeStations,\n            totalStations: this.stations.size,\n            activeCrafting: this.activeAttempts.length\n        };\n    }\n\n    /**\n     * Save crafting state\n     */\n    saveState(): any {\n        return {\n            knownRecipes: Array.from(this.knownRecipes),\n            stations: Array.from(this.stations.values()),\n            activeAttempts: this.activeAttempts\n        };\n    }\n\n    /**\n     * Load crafting state\n     */\n    loadState(state: any): void {\n        if (state.knownRecipes) {\n            this.knownRecipes = new Set(state.knownRecipes);\n        }\n        \n        if (state.stations) {\n            state.stations.forEach((stationData: CraftingStation) => {\n                this.stations.set(stationData.id, stationData);\n            });\n        }\n        \n        if (state.activeAttempts) {\n            this.activeAttempts = state.activeAttempts;\n        }\n        \n        this.logger.info('🔧 Crafting state loaded');\n    }\n}","/**\n * Weapon System\n * Complete combat mechanics with projectiles, targeting, and damage\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer, Color } from '@core/Renderer';\nimport { GameItem } from '@items/ItemSystem';\n\nexport enum WeaponType {\n    Energy = 'energy',\n    Projectile = 'projectile', \n    Missile = 'missile',\n    Plasma = 'plasma',\n    Beam = 'beam',\n    Torpedo = 'torpedo'\n}\n\nexport enum DamageType {\n    Kinetic = 'kinetic',\n    Energy = 'energy',\n    Thermal = 'thermal',\n    Electromagnetic = 'electromagnetic',\n    Explosive = 'explosive'\n}\n\nexport enum TargetingMode {\n    Manual = 'manual',\n    Assisted = 'assisted',\n    Automatic = 'automatic',\n    PointDefense = 'point_defense'\n}\n\nexport interface WeaponStats {\n    damage: number;\n    range: number;\n    fireRate: number; // shots per second\n    energyCost: number;\n    accuracy: number; // 0-1\n    penetration: number;\n    spread: number; // degrees\n    chargeTime: number; // seconds\n    cooldownTime: number; // seconds\n    ammoCapacity?: number;\n    reloadTime?: number;\n}\n\nexport interface WeaponConfig {\n    id: string;\n    name: string;\n    type: WeaponType;\n    damageType: DamageType;\n    stats: WeaponStats;\n    item?: GameItem;\n    mountPoint: Vector2;\n    hardpointSize: 'small' | 'medium' | 'large';\n}\n\nexport interface Projectile {\n    id: string;\n    position: Vector2;\n    velocity: Vector2;\n    damage: number;\n    damageType: DamageType;\n    range: number;\n    maxRange: number;\n    size: number;\n    weaponId: string;\n    targetId?: string;\n    penetration: number;\n    isHoming: boolean;\n    homingStrength: number;\n    life: number; // 0-1\n    trail: Vector2[];\n}\n\nexport interface DamageResult {\n    targetId: string;\n    damage: number;\n    damageType: DamageType;\n    criticalHit: boolean;\n    penetrated: boolean;\n    shieldsHit: boolean;\n    hullHit: boolean;\n}\n\nexport interface WeaponEvents {\n    onWeaponFired?: (weapon: WeaponConfig, projectile: Projectile) => void;\n    onProjectileHit?: (projectile: Projectile, result: DamageResult) => void;\n    onWeaponOverheat?: (weapon: WeaponConfig) => void;\n    onAmmoEmpty?: (weapon: WeaponConfig) => void;\n}\n\nexport class WeaponSystem {\n    private weapons: Map<string, WeaponConfig> = new Map();\n    private projectiles: Map<string, Projectile> = new Map();\n    private weaponStates: Map<string, {\n        isCharging: boolean;\n        chargeProgress: number;\n        lastFired: number;\n        heat: number;\n        ammo: number;\n        isOverheated: boolean;\n        cooldownEnd: number;\n    }> = new Map();\n    \n    private events: WeaponEvents;\n    private nextProjectileId: number = 0;\n    \n    // Targeting system\n    private targetingMode: TargetingMode = TargetingMode.Manual;\n    private currentTarget: string | null = null;\n    private targetPosition: Vector2 | null = null;\n    private targets: Map<string, { position: Vector2, velocity: Vector2, size: number }> = new Map();\n    \n    private logger: Logger;\n\n    constructor(events: WeaponEvents = {}) {\n        this.logger = new Logger('WeaponSystem');\n        this.events = events;\n        \n        this.logger.info('⚔️ Weapon system initialized');\n    }\n\n    /**\n     * Add weapon to system\n     */\n    addWeapon(weapon: WeaponConfig): void {\n        this.weapons.set(weapon.id, weapon);\n        this.weaponStates.set(weapon.id, {\n            isCharging: false,\n            chargeProgress: 0,\n            lastFired: 0,\n            heat: 0,\n            ammo: weapon.stats.ammoCapacity || -1, // -1 for infinite energy weapons\n            isOverheated: false,\n            cooldownEnd: 0\n        });\n        \n        this.logger.info(`🔫 Added weapon: ${weapon.name}`, {\n            type: weapon.type,\n            damage: weapon.stats.damage,\n            range: weapon.stats.range\n        });\n    }\n\n    /**\n     * Remove weapon from system\n     */\n    removeWeapon(weaponId: string): void {\n        this.weapons.delete(weaponId);\n        this.weaponStates.delete(weaponId);\n        \n        // Remove projectiles from this weapon\n        for (const [projId, projectile] of this.projectiles.entries()) {\n            if (projectile.weaponId === weaponId) {\n                this.projectiles.delete(projId);\n            }\n        }\n        \n        this.logger.info(`🔫 Removed weapon: ${weaponId}`);\n    }\n\n    /**\n     * Fire weapon\n     */\n    fireWeapon(weaponId: string, sourcePosition: Vector2, targetPosition?: Vector2): boolean {\n        const weapon = this.weapons.get(weaponId);\n        const state = this.weaponStates.get(weaponId);\n        \n        if (!weapon || !state) return false;\n        \n        const currentTime = Date.now() / 1000;\n        \n        // Check if weapon can fire\n        if (state.isOverheated || currentTime < state.cooldownEnd) {\n            return false;\n        }\n        \n        // Check fire rate\n        const timeSinceLastShot = currentTime - state.lastFired;\n        const minInterval = 1 / weapon.stats.fireRate;\n        if (timeSinceLastShot < minInterval) {\n            return false;\n        }\n        \n        // Check ammo\n        if (state.ammo === 0) {\n            this.events.onAmmoEmpty?.(weapon);\n            return false;\n        }\n        \n        // For charge weapons, handle charging\n        if (weapon.stats.chargeTime > 0) {\n            if (!state.isCharging) {\n                state.isCharging = true;\n                state.chargeProgress = 0;\n                return false; // Start charging, don't fire yet\n            } else if (state.chargeProgress < 1.0) {\n                return false; // Still charging\n            }\n        }\n        \n        // Determine target position\n        let finalTargetPos = targetPosition;\n        if (!finalTargetPos) {\n            if (this.targetPosition) {\n                finalTargetPos = this.targetPosition;\n            } else if (this.currentTarget && this.targets.has(this.currentTarget)) {\n                finalTargetPos = this.targets.get(this.currentTarget)!.position;\n            } else {\n                // Default forward firing\n                finalTargetPos = {\n                    x: sourcePosition.x + weapon.stats.range,\n                    y: sourcePosition.y\n                };\n            }\n        }\n        \n        // Calculate firing direction with spread\n        const direction = this.calculateFiringDirection(sourcePosition, finalTargetPos, weapon.stats.spread);\n        \n        // Create projectile\n        const projectile = this.createProjectile(weapon, sourcePosition, direction, finalTargetPos);\n        this.projectiles.set(projectile.id, projectile);\n        \n        // Update weapon state\n        state.lastFired = currentTime;\n        state.heat += 0.1; // Weapons generate heat\n        state.isCharging = false;\n        state.chargeProgress = 0;\n        \n        if (state.ammo > 0) {\n            state.ammo--;\n        }\n        \n        // Check for overheat\n        if (state.heat > 1.0) {\n            state.isOverheated = true;\n            state.cooldownEnd = currentTime + weapon.stats.cooldownTime;\n            this.events.onWeaponOverheat?.(weapon);\n        }\n        \n        this.events.onWeaponFired?.(weapon, projectile);\n        \n        this.logger.debug(`🔥 Fired ${weapon.name}`, {\n            damage: projectile.damage,\n            range: projectile.maxRange,\n            targetDistance: this.calculateDistance(sourcePosition, finalTargetPos)\n        });\n        \n        return true;\n    }\n\n    /**\n     * Create projectile from weapon\n     */\n    private createProjectile(weapon: WeaponConfig, sourcePos: Vector2, direction: Vector2, targetPos: Vector2): Projectile {\n        const projectileId = `proj_${weapon.id}_${this.nextProjectileId++}`;\n        \n        // Calculate velocity based on weapon type\n        let speed = 500; // Default speed\n        let isHoming = false;\n        let homingStrength = 0;\n        \n        switch (weapon.type) {\n            case WeaponType.Energy:\n                speed = 800;\n                break;\n            case WeaponType.Projectile:\n                speed = 600;\n                break;\n            case WeaponType.Missile:\n                speed = 300;\n                isHoming = true;\n                homingStrength = 0.1;\n                break;\n            case WeaponType.Plasma:\n                speed = 400;\n                break;\n            case WeaponType.Beam:\n                speed = 1200; // Very fast\n                break;\n            case WeaponType.Torpedo:\n                speed = 250;\n                isHoming = true;\n                homingStrength = 0.15;\n                break;\n        }\n        \n        const velocity = {\n            x: direction.x * speed,\n            y: direction.y * speed\n        };\n        \n        return {\n            id: projectileId,\n            position: { ...sourcePos },\n            velocity,\n            damage: weapon.stats.damage,\n            damageType: weapon.damageType,\n            range: 0,\n            maxRange: weapon.stats.range,\n            size: this.getProjectileSize(weapon.type),\n            weaponId: weapon.id,\n            targetId: this.currentTarget || undefined,\n            penetration: weapon.stats.penetration,\n            isHoming,\n            homingStrength,\n            life: 1.0,\n            trail: []\n        };\n    }\n\n    /**\n     * Get projectile visual size based on weapon type\n     */\n    private getProjectileSize(weaponType: WeaponType): number {\n        switch (weaponType) {\n            case WeaponType.Energy: return 2;\n            case WeaponType.Projectile: return 1;\n            case WeaponType.Missile: return 4;\n            case WeaponType.Plasma: return 3;\n            case WeaponType.Beam: return 1;\n            case WeaponType.Torpedo: return 6;\n            default: return 2;\n        }\n    }\n\n    /**\n     * Calculate firing direction with accuracy and spread\n     */\n    private calculateFiringDirection(sourcePos: Vector2, targetPos: Vector2, spread: number): Vector2 {\n        // Base direction to target\n        const dx = targetPos.x - sourcePos.x;\n        const dy = targetPos.y - sourcePos.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        \n        if (distance === 0) {\n            return { x: 1, y: 0 }; // Default forward\n        }\n        \n        // Normalize\n        let direction = {\n            x: dx / distance,\n            y: dy / distance\n        };\n        \n        // Apply spread (inaccuracy)\n        if (spread > 0) {\n            const spreadRad = (spread * Math.PI / 180) * (Math.random() - 0.5);\n            const cos = Math.cos(spreadRad);\n            const sin = Math.sin(spreadRad);\n            \n            direction = {\n                x: direction.x * cos - direction.y * sin,\n                y: direction.x * sin + direction.y * cos\n            };\n        }\n        \n        return direction;\n    }\n\n    /**\n     * Update weapon system\n     */\n    update(deltaTime: number): void {\n        this.updateWeaponStates(deltaTime);\n        this.updateProjectiles(deltaTime);\n        this.checkProjectileHits();\n        this.cleanupProjectiles();\n    }\n\n    /**\n     * Update weapon states (cooling, charging, etc.)\n     */\n    private updateWeaponStates(deltaTime: number): void {\n        const currentTime = Date.now() / 1000;\n        \n        for (const [weaponId, state] of this.weaponStates.entries()) {\n            const weapon = this.weapons.get(weaponId);\n            if (!weapon) continue;\n            \n            // Cool down heat\n            if (state.heat > 0) {\n                state.heat = Math.max(0, state.heat - deltaTime * 0.5); // Heat dissipation rate\n            }\n            \n            // Check if cooled down from overheat\n            if (state.isOverheated && currentTime >= state.cooldownEnd) {\n                state.isOverheated = false;\n                state.heat = 0;\n            }\n            \n            // Update charging\n            if (state.isCharging && weapon.stats.chargeTime > 0) {\n                state.chargeProgress = Math.min(1.0, state.chargeProgress + deltaTime / weapon.stats.chargeTime);\n            }\n        }\n    }\n\n    /**\n     * Update projectile movement and behavior\n     */\n    private updateProjectiles(deltaTime: number): void {\n        for (const [projId, projectile] of this.projectiles.entries()) {\n            // Update position\n            projectile.position.x += projectile.velocity.x * deltaTime;\n            projectile.position.y += projectile.velocity.y * deltaTime;\n            \n            // Update range\n            projectile.range += Math.sqrt(\n                projectile.velocity.x * projectile.velocity.x + \n                projectile.velocity.y * projectile.velocity.y\n            ) * deltaTime;\n            \n            // Update trail\n            if (projectile.trail.length > 10) {\n                projectile.trail.shift(); // Remove oldest position\n            }\n            projectile.trail.push({ ...projectile.position });\n            \n            // Homing behavior\n            if (projectile.isHoming && projectile.targetId && this.targets.has(projectile.targetId)) {\n                this.updateHomingProjectile(projectile, deltaTime);\n            }\n            \n            // Update life based on range\n            projectile.life = Math.max(0, 1 - (projectile.range / projectile.maxRange));\n        }\n    }\n\n    /**\n     * Update homing projectile guidance\n     */\n    private updateHomingProjectile(projectile: Projectile, deltaTime: number): void {\n        const target = this.targets.get(projectile.targetId!);\n        if (!target) return;\n        \n        // Predict target position\n        const predictedPos = {\n            x: target.position.x + target.velocity.x * 0.5, // 0.5 second prediction\n            y: target.position.y + target.velocity.y * 0.5\n        };\n        \n        // Calculate direction to predicted position\n        const dx = predictedPos.x - projectile.position.x;\n        const dy = predictedPos.y - projectile.position.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        \n        if (distance > 0) {\n            const targetDirection = {\n                x: dx / distance,\n                y: dy / distance\n            };\n            \n            // Current velocity direction\n            const speed = Math.sqrt(\n                projectile.velocity.x * projectile.velocity.x + \n                projectile.velocity.y * projectile.velocity.y\n            );\n            \n            // Interpolate toward target direction\n            const currentDirection = {\n                x: projectile.velocity.x / speed,\n                y: projectile.velocity.y / speed\n            };\n            \n            const homingFactor = projectile.homingStrength * deltaTime * 10;\n            const newDirection = {\n                x: currentDirection.x + (targetDirection.x - currentDirection.x) * homingFactor,\n                y: currentDirection.y + (targetDirection.y - currentDirection.y) * homingFactor\n            };\n            \n            // Normalize and apply\n            const newLength = Math.sqrt(newDirection.x * newDirection.x + newDirection.y * newDirection.y);\n            if (newLength > 0) {\n                projectile.velocity.x = (newDirection.x / newLength) * speed;\n                projectile.velocity.y = (newDirection.y / newLength) * speed;\n            }\n        }\n    }\n\n    /**\n     * Check for projectile hits against targets\n     */\n    private checkProjectileHits(): void {\n        for (const [projId, projectile] of this.projectiles.entries()) {\n            for (const [targetId, target] of this.targets.entries()) {\n                const distance = this.calculateDistance(projectile.position, target.position);\n                const hitRadius = projectile.size + target.size;\n                \n                if (distance <= hitRadius) {\n                    // Hit detected\n                    const damage = this.calculateDamage(projectile, target);\n                    const result: DamageResult = {\n                        targetId,\n                        damage: damage.finalDamage,\n                        damageType: projectile.damageType,\n                        criticalHit: damage.critical,\n                        penetrated: damage.penetrated,\n                        shieldsHit: damage.shieldsHit,\n                        hullHit: damage.hullHit\n                    };\n                    \n                    this.events.onProjectileHit?.(projectile, result);\n                    \n                    // Remove projectile unless it penetrates\n                    if (!damage.penetrated) {\n                        this.projectiles.delete(projId);\n                    }\n                    \n                    this.logger.debug(`💥 Projectile hit`, {\n                        targetId,\n                        damage: damage.finalDamage,\n                        critical: damage.critical\n                    });\n                    \n                    break; // One hit per projectile per frame\n                }\n            }\n        }\n    }\n\n    /**\n     * Calculate damage from projectile hit\n     */\n    private calculateDamage(projectile: Projectile, target: { position: Vector2, velocity: Vector2, size: number }): {\n        finalDamage: number;\n        critical: boolean;\n        penetrated: boolean;\n        shieldsHit: boolean;\n        hullHit: boolean;\n    } {\n        let damage = projectile.damage;\n        let critical = false;\n        let penetrated = false;\n        \n        // Critical hit chance (5% base)\n        if (Math.random() < 0.05) {\n            critical = true;\n            damage *= 2;\n        }\n        \n        // Damage falloff with range\n        const falloff = Math.max(0.3, 1 - (projectile.range / projectile.maxRange) * 0.5);\n        damage *= falloff;\n        \n        // Penetration check (simplified)\n        if (projectile.penetration > 0.7) {\n            penetrated = Math.random() < 0.3;\n        }\n        \n        return {\n            finalDamage: Math.floor(damage),\n            critical,\n            penetrated,\n            shieldsHit: true, // Simplified - assume shields absorb first\n            hullHit: penetrated\n        };\n    }\n\n    /**\n     * Remove expired projectiles\n     */\n    private cleanupProjectiles(): void {\n        for (const [projId, projectile] of this.projectiles.entries()) {\n            if (projectile.life <= 0 || projectile.range >= projectile.maxRange) {\n                this.projectiles.delete(projId);\n            }\n        }\n    }\n\n    /**\n     * Set targeting mode\n     */\n    setTargetingMode(mode: TargetingMode): void {\n        this.targetingMode = mode;\n        this.logger.debug(`🎯 Targeting mode: ${mode}`);\n    }\n\n    /**\n     * Set manual target position\n     */\n    setTargetPosition(position: Vector2): void {\n        this.targetPosition = { ...position };\n    }\n\n    /**\n     * Set current target\n     */\n    setTarget(targetId: string | null): void {\n        this.currentTarget = targetId;\n        this.logger.debug(`🎯 Target: ${targetId || 'none'}`);\n    }\n\n    /**\n     * Add/update target for tracking\n     */\n    updateTarget(targetId: string, position: Vector2, velocity: Vector2, size: number): void {\n        this.targets.set(targetId, { position: { ...position }, velocity: { ...velocity }, size });\n    }\n\n    /**\n     * Remove target from tracking\n     */\n    removeTarget(targetId: string): void {\n        this.targets.delete(targetId);\n        if (this.currentTarget === targetId) {\n            this.currentTarget = null;\n        }\n    }\n\n    /**\n     * Get weapon information\n     */\n    getWeapon(weaponId: string): { weapon: WeaponConfig; state: any } | null {\n        const weapon = this.weapons.get(weaponId);\n        const state = this.weaponStates.get(weaponId);\n        \n        if (!weapon || !state) return null;\n        \n        return { weapon, state };\n    }\n\n    /**\n     * Get all weapons\n     */\n    getAllWeapons(): Array<{ weapon: WeaponConfig; state: any }> {\n        const result: Array<{ weapon: WeaponConfig; state: any }> = [];\n        \n        for (const [weaponId, weapon] of this.weapons.entries()) {\n            const state = this.weaponStates.get(weaponId);\n            if (state) {\n                result.push({ weapon, state });\n            }\n        }\n        \n        return result;\n    }\n\n    /**\n     * Reload weapon\n     */\n    reloadWeapon(weaponId: string): boolean {\n        const weapon = this.weapons.get(weaponId);\n        const state = this.weaponStates.get(weaponId);\n        \n        if (!weapon || !state || !weapon.stats.ammoCapacity) return false;\n        \n        state.ammo = weapon.stats.ammoCapacity;\n        this.logger.debug(`🔄 Reloaded ${weapon.name}`);\n        \n        return true;\n    }\n\n    /**\n     * Render weapon effects\n     */\n    render(renderer: Renderer): void {\n        this.renderProjectiles(renderer);\n        this.renderWeaponCharges(renderer);\n    }\n\n    /**\n     * Render projectiles and their trails\n     */\n    private renderProjectiles(renderer: Renderer): void {\n        for (const projectile of this.projectiles.values()) {\n            // Render trail\n            if (projectile.trail.length > 1) {\n                for (let i = 1; i < projectile.trail.length; i++) {\n                    const alpha = (i / projectile.trail.length) * projectile.life;\n                    const trailColor = this.getProjectileColor(projectile, alpha * 0.5);\n                    \n                    renderer.drawLine(\n                        projectile.trail[i-1].x, projectile.trail[i-1].y,\n                        projectile.trail[i].x, projectile.trail[i].y,\n                        trailColor\n                    );\n                }\n            }\n            \n            // Render projectile\n            const color = this.getProjectileColor(projectile, projectile.life);\n            const size = projectile.size * projectile.life;\n            \n            if (projectile.size > 2) {\n                // Larger projectiles as filled circles\n                renderer.drawCircle(projectile.position.x, projectile.position.y, size, color, true);\n            } else {\n                // Small projectiles as pixels\n                renderer.fillRect(\n                    projectile.position.x - size/2, \n                    projectile.position.y - size/2, \n                    size, size, color\n                );\n            }\n        }\n    }\n\n    /**\n     * Get projectile color based on weapon type\n     */\n    private getProjectileColor(projectile: Projectile, alpha: number): Color {\n        const weapon = this.weapons.get(projectile.weaponId);\n        if (!weapon) return { r: 48, g: 48, b: 48 };\n        \n        let baseColor: Color;\n        \n        switch (weapon.type) {\n            case WeaponType.Energy:\n                baseColor = { r: 16, g: 48, b: 16 }; // Green energy\n                break;\n            case WeaponType.Projectile:\n                baseColor = { r: 96, g: 64, b: 16 }; // Orange projectile\n                break;\n            case WeaponType.Missile:\n                baseColor = { r: 72, g: 24, b: 24 }; // Red missile\n                break;\n            case WeaponType.Plasma:\n                baseColor = { r: 48, g: 24, b: 72 }; // Purple plasma\n                break;\n            case WeaponType.Beam:\n                baseColor = { r: 32, g: 80, b: 64 }; // Cyan beam\n                break;\n            case WeaponType.Torpedo:\n                baseColor = { r: 64, g: 32, b: 96 }; // Magenta torpedo\n                break;\n            default:\n                baseColor = { r: 48, g: 48, b: 48 };\n        }\n        \n        return {\n            r: Math.floor(baseColor.r * alpha),\n            g: Math.floor(baseColor.g * alpha),\n            b: Math.floor(baseColor.b * alpha)\n        };\n    }\n\n    /**\n     * Render weapon charge indicators\n     */\n    private renderWeaponCharges(renderer: Renderer): void {\n        // TODO: Render charging indicators for weapons that require charging\n        // This would show charge progress bars near weapon hardpoints\n    }\n\n    /**\n     * Calculate distance between two points\n     */\n    private calculateDistance(pos1: Vector2, pos2: Vector2): number {\n        const dx = pos1.x - pos2.x;\n        const dy = pos1.y - pos2.y;\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    /**\n     * Get weapon system statistics\n     */\n    getStats(): {\n        totalWeapons: number;\n        activeProjectiles: number;\n        targetsTracked: number;\n        weaponsByType: { [type: string]: number };\n    } {\n        const weaponsByType: { [type: string]: number } = {};\n        \n        for (const weapon of this.weapons.values()) {\n            weaponsByType[weapon.type] = (weaponsByType[weapon.type] || 0) + 1;\n        }\n        \n        return {\n            totalWeapons: this.weapons.size,\n            activeProjectiles: this.projectiles.size,\n            targetsTracked: this.targets.size,\n            weaponsByType\n        };\n    }\n\n    /**\n     * Clear all projectiles (for cleanup/reset)\n     */\n    clearProjectiles(): void {\n        this.projectiles.clear();\n    }\n\n    /**\n     * Clear all targets\n     */\n    clearTargets(): void {\n        this.targets.clear();\n        this.currentTarget = null;\n    }\n}","/**\n * Enemy AI System\n * Intelligent combat AI with different behaviors and ship types\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer, Color } from '@core/Renderer';\nimport { WeaponSystem, WeaponConfig, WeaponType, DamageType } from './WeaponSystem';\n\nexport enum AIBehavior {\n    Aggressive = 'aggressive',\n    Defensive = 'defensive',\n    Evasive = 'evasive',\n    Patrol = 'patrol',\n    Guard = 'guard',\n    Kamikaze = 'kamikaze',\n    Sniper = 'sniper',\n    Support = 'support'\n}\n\nexport enum ShipClass {\n    Fighter = 'fighter',\n    Corvette = 'corvette',\n    Frigate = 'frigate',\n    Destroyer = 'destroyer',\n    Cruiser = 'cruiser',\n    Battleship = 'battleship',\n    Drone = 'drone'\n}\n\nexport interface EnemyShipConfig {\n    id: string;\n    name: string;\n    shipClass: ShipClass;\n    faction: string;\n    \n    // Physical properties\n    size: number;\n    mass: number;\n    maxSpeed: number;\n    acceleration: number;\n    turnRate: number;\n    \n    // Combat properties\n    hull: number;\n    maxHull: number;\n    shields: number;\n    maxShields: number;\n    armor: number;\n    \n    // AI properties\n    behavior: AIBehavior;\n    aggression: number; // 0-1\n    intelligence: number; // 0-1\n    accuracy: number; // 0-1\n    reactionTime: number; // seconds\n    \n    // Equipment\n    weapons: WeaponConfig[];\n    engagementRange: number;\n    preferredRange: number;\n}\n\nexport interface EnemyShip {\n    config: EnemyShipConfig;\n    position: Vector2;\n    velocity: Vector2;\n    rotation: number;\n    \n    // AI state\n    currentTarget: string | null;\n    state: AIState;\n    stateTimer: number;\n    lastDecisionTime: number;\n    \n    // Combat state\n    lastShotTime: number;\n    weaponCooldowns: Map<string, number>;\n    \n    // Movement state\n    waypoint: Vector2 | null;\n    patrolCenter: Vector2;\n    patrolRadius: number;\n    \n    // Status\n    isAlive: boolean;\n    lastDamageTime: number;\n}\n\nexport enum AIState {\n    Idle = 'idle',\n    Patrol = 'patrol',\n    Pursue = 'pursue',\n    Attack = 'attack',\n    Evade = 'evade',\n    Retreat = 'retreat',\n    Guard = 'guard',\n    CircleStrafe = 'circle_strafe',\n    Ramming = 'ramming'\n}\n\nexport interface AIEvents {\n    onEnemySpawned?: (enemy: EnemyShip) => void;\n    onEnemyDestroyed?: (enemy: EnemyShip) => void;\n    onEnemyDamaged?: (enemy: EnemyShip, damage: number) => void;\n    onEnemyStateChanged?: (enemy: EnemyShip, oldState: AIState, newState: AIState) => void;\n}\n\nexport class EnemyAI {\n    private enemies: Map<string, EnemyShip> = new Map();\n    private weaponSystem: WeaponSystem;\n    private events: AIEvents;\n    \n    // Player tracking\n    private playerPosition: Vector2 = { x: 0, y: 0 };\n    private playerVelocity: Vector2 = { x: 0, y: 0 };\n    private playerSize: number = 20;\n    \n    // Faction relationships\n    private factionRelations: Map<string, Map<string, number>> = new Map(); // -1 to 1\n    \n    private logger: Logger;\n\n    constructor(weaponSystem: WeaponSystem, events: AIEvents = {}) {\n        this.logger = new Logger('EnemyAI');\n        this.weaponSystem = weaponSystem;\n        this.events = events;\n        \n        this.initializeFactions();\n        \n        this.logger.info('🤖 Enemy AI system initialized');\n    }\n\n    /**\n     * Initialize faction relationships\n     */\n    private initializeFactions(): void {\n        const factions = ['pirates', 'aliens', 'rebels', 'corporation', 'military'];\n        \n        for (const faction1 of factions) {\n            if (!this.factionRelations.has(faction1)) {\n                this.factionRelations.set(faction1, new Map());\n            }\n            \n            for (const faction2 of factions) {\n                let relation = 0;\n                \n                if (faction1 === faction2) {\n                    relation = 1; // Same faction\n                } else if (\n                    (faction1 === 'pirates' && faction2 === 'military') ||\n                    (faction1 === 'military' && faction2 === 'pirates') ||\n                    (faction1 === 'rebels' && faction2 === 'corporation') ||\n                    (faction1 === 'corporation' && faction2 === 'rebels')\n                ) {\n                    relation = -1; // Hostile\n                } else if (faction1 === 'aliens') {\n                    relation = -0.5; // Aliens generally hostile\n                } else {\n                    relation = Math.random() * 0.4 - 0.2; // Neutral with slight variation\n                }\n                \n                this.factionRelations.get(faction1)!.set(faction2, relation);\n            }\n        }\n    }\n\n    /**\n     * Spawn enemy ship\n     */\n    spawnEnemy(config: EnemyShipConfig, position: Vector2): string {\n        const enemy: EnemyShip = {\n            config,\n            position: { ...position },\n            velocity: { x: 0, y: 0 },\n            rotation: Math.random() * Math.PI * 2,\n            \n            currentTarget: null,\n            state: AIState.Idle,\n            stateTimer: 0,\n            lastDecisionTime: 0,\n            \n            lastShotTime: 0,\n            weaponCooldowns: new Map(),\n            \n            waypoint: null,\n            patrolCenter: { ...position },\n            patrolRadius: 500,\n            \n            isAlive: true,\n            lastDamageTime: 0\n        };\n        \n        // Add weapons to weapon system\n        config.weapons.forEach(weapon => {\n            const weaponId = `${config.id}_${weapon.id}`;\n            this.weaponSystem.addWeapon({\n                ...weapon,\n                id: weaponId\n            });\n        });\n        \n        // Add as target to weapon system\n        this.weaponSystem.updateTarget(config.id, position, { x: 0, y: 0 }, config.size);\n        \n        this.enemies.set(config.id, enemy);\n        this.events.onEnemySpawned?.(enemy);\n        \n        this.logger.info(`🛸 Spawned ${config.shipClass} \"${config.name}\"`, {\n            faction: config.faction,\n            behavior: config.behavior,\n            position\n        });\n        \n        return config.id;\n    }\n\n    /**\n     * Update player information for AI targeting\n     */\n    updatePlayer(position: Vector2, velocity: Vector2, size: number): void {\n        this.playerPosition = { ...position };\n        this.playerVelocity = { ...velocity };\n        this.playerSize = size;\n        \n        // Update player as target in weapon system\n        this.weaponSystem.updateTarget('player', position, velocity, size);\n    }\n\n    /**\n     * Update AI system\n     */\n    update(deltaTime: number): void {\n        for (const enemy of this.enemies.values()) {\n            if (enemy.isAlive) {\n                this.updateEnemy(enemy, deltaTime);\n            }\n        }\n        \n        this.cleanupDeadEnemies();\n    }\n\n    /**\n     * Update individual enemy\n     */\n    private updateEnemy(enemy: EnemyShip, deltaTime: number): void {\n        const currentTime = Date.now() / 1000;\n        \n        // Update timers\n        enemy.stateTimer += deltaTime;\n        \n        // AI decision making (based on reaction time)\n        if (currentTime - enemy.lastDecisionTime >= enemy.config.reactionTime) {\n            this.makeDecision(enemy);\n            enemy.lastDecisionTime = currentTime;\n        }\n        \n        // Execute current state\n        this.executeState(enemy, deltaTime);\n        \n        // Update movement\n        this.updateMovement(enemy, deltaTime);\n        \n        // Update weapon targeting and firing\n        this.updateCombat(enemy, deltaTime);\n        \n        // Update weapon system target\n        this.weaponSystem.updateTarget(enemy.config.id, enemy.position, enemy.velocity, enemy.config.size);\n    }\n\n    /**\n     * AI decision making\n     */\n    private makeDecision(enemy: EnemyShip): void {\n        const distanceToPlayer = this.calculateDistance(enemy.position, this.playerPosition);\n        const inRange = distanceToPlayer <= enemy.config.engagementRange;\n        const hasLineOfSight = this.hasLineOfSight(enemy.position, this.playerPosition);\n        \n        let newState = enemy.state;\n        \n        switch (enemy.config.behavior) {\n            case AIBehavior.Aggressive:\n                if (inRange && hasLineOfSight) {\n                    newState = AIState.Attack;\n                } else if (distanceToPlayer < enemy.config.engagementRange * 2) {\n                    newState = AIState.Pursue;\n                } else {\n                    newState = AIState.Patrol;\n                }\n                break;\n                \n            case AIBehavior.Defensive:\n                if (inRange && hasLineOfSight && enemy.lastDamageTime > Date.now() / 1000 - 5) {\n                    newState = AIState.Attack;\n                } else if (distanceToPlayer < enemy.config.engagementRange) {\n                    newState = AIState.Guard;\n                } else {\n                    newState = AIState.Patrol;\n                }\n                break;\n                \n            case AIBehavior.Evasive:\n                if (enemy.config.hull < enemy.config.maxHull * 0.3) {\n                    newState = AIState.Retreat;\n                } else if (inRange) {\n                    newState = AIState.Evade;\n                } else {\n                    newState = AIState.Patrol;\n                }\n                break;\n                \n            case AIBehavior.Sniper:\n                if (distanceToPlayer <= enemy.config.preferredRange && hasLineOfSight) {\n                    newState = AIState.Attack;\n                } else if (distanceToPlayer < enemy.config.preferredRange) {\n                    newState = AIState.Retreat; // Back up to preferred range\n                } else {\n                    newState = AIState.Pursue;\n                }\n                break;\n                \n            case AIBehavior.Kamikaze:\n                if (distanceToPlayer < 100) {\n                    newState = AIState.Ramming;\n                } else {\n                    newState = AIState.Pursue;\n                }\n                break;\n                \n            default:\n                newState = AIState.Patrol;\n        }\n        \n        if (newState !== enemy.state) {\n            this.changeState(enemy, newState);\n        }\n    }\n\n    /**\n     * Change enemy AI state\n     */\n    private changeState(enemy: EnemyShip, newState: AIState): void {\n        const oldState = enemy.state;\n        enemy.state = newState;\n        enemy.stateTimer = 0;\n        \n        // State entry logic\n        switch (newState) {\n            case AIState.Patrol:\n                enemy.waypoint = this.generatePatrolWaypoint(enemy);\n                break;\n                \n            case AIState.Pursue:\n                enemy.currentTarget = 'player';\n                break;\n                \n            case AIState.Attack:\n                enemy.currentTarget = 'player';\n                break;\n                \n            case AIState.CircleStrafe:\n                enemy.currentTarget = 'player';\n                break;\n                \n            case AIState.Retreat:\n                enemy.waypoint = this.generateRetreatWaypoint(enemy);\n                break;\n        }\n        \n        this.events.onEnemyStateChanged?.(enemy, oldState, newState);\n        \n        this.logger.debug(`🤖 ${enemy.config.name} state: ${oldState} → ${newState}`);\n    }\n\n    /**\n     * Execute current AI state\n     */\n    private executeState(enemy: EnemyShip, deltaTime: number): void {\n        switch (enemy.state) {\n            case AIState.Idle:\n                // Do nothing, maybe rotate slowly\n                break;\n                \n            case AIState.Patrol:\n                this.executePatrol(enemy, deltaTime);\n                break;\n                \n            case AIState.Pursue:\n                this.executePursue(enemy, deltaTime);\n                break;\n                \n            case AIState.Attack:\n                this.executeAttack(enemy, deltaTime);\n                break;\n                \n            case AIState.Evade:\n                this.executeEvade(enemy, deltaTime);\n                break;\n                \n            case AIState.Retreat:\n                this.executeRetreat(enemy, deltaTime);\n                break;\n                \n            case AIState.CircleStrafe:\n                this.executeCircleStrafe(enemy, deltaTime);\n                break;\n                \n            case AIState.Ramming:\n                this.executeRamming(enemy, deltaTime);\n                break;\n        }\n    }\n\n    /**\n     * Execute patrol behavior\n     */\n    private executePatrol(enemy: EnemyShip, deltaTime: number): void {\n        if (!enemy.waypoint || this.calculateDistance(enemy.position, enemy.waypoint) < 50) {\n            enemy.waypoint = this.generatePatrolWaypoint(enemy);\n        }\n        \n        this.moveToward(enemy, enemy.waypoint, 0.5); // Half speed for patrol\n    }\n\n    /**\n     * Execute pursue behavior\n     */\n    private executePursue(enemy: EnemyShip, deltaTime: number): void {\n        const predictedPlayerPos = this.predictPlayerPosition(0.5);\n        this.moveToward(enemy, predictedPlayerPos, 1.0);\n    }\n\n    /**\n     * Execute attack behavior\n     */\n    private executeAttack(enemy: EnemyShip, deltaTime: number): void {\n        const distanceToPlayer = this.calculateDistance(enemy.position, this.playerPosition);\n        \n        if (distanceToPlayer > enemy.config.preferredRange * 1.2) {\n            // Too far, move closer\n            this.moveToward(enemy, this.playerPosition, 1.0);\n        } else if (distanceToPlayer < enemy.config.preferredRange * 0.8) {\n            // Too close, back away\n            const retreatPoint = this.calculateRetreatPoint(enemy.position, this.playerPosition);\n            this.moveToward(enemy, retreatPoint, 0.8);\n        } else {\n            // Good range, circle strafe\n            this.executeCircleStrafe(enemy, deltaTime);\n        }\n    }\n\n    /**\n     * Execute evade behavior\n     */\n    private executeEvade(enemy: EnemyShip, deltaTime: number): void {\n        const evasionPoint = this.calculateEvasionPoint(enemy);\n        this.moveToward(enemy, evasionPoint, 1.2); // Slightly faster for evasion\n    }\n\n    /**\n     * Execute retreat behavior\n     */\n    private executeRetreat(enemy: EnemyShip, deltaTime: number): void {\n        if (!enemy.waypoint) {\n            enemy.waypoint = this.generateRetreatWaypoint(enemy);\n        }\n        \n        this.moveToward(enemy, enemy.waypoint, 1.5); // Faster retreat\n    }\n\n    /**\n     * Execute circle strafe behavior\n     */\n    private executeCircleStrafe(enemy: EnemyShip, deltaTime: number): void {\n        const toPlayer = {\n            x: this.playerPosition.x - enemy.position.x,\n            y: this.playerPosition.y - enemy.position.y\n        };\n        \n        const distance = Math.sqrt(toPlayer.x * toPlayer.x + toPlayer.y * toPlayer.y);\n        if (distance === 0) return;\n        \n        // Normalize\n        toPlayer.x /= distance;\n        toPlayer.y /= distance;\n        \n        // Calculate perpendicular direction for strafing\n        const strafeDirection = {\n            x: -toPlayer.y, // Perpendicular\n            y: toPlayer.x\n        };\n        \n        // Random direction change\n        if (Math.random() < 0.1) {\n            strafeDirection.x *= -1;\n            strafeDirection.y *= -1;\n        }\n        \n        // Move in strafe direction\n        const targetPoint = {\n            x: enemy.position.x + strafeDirection.x * 200,\n            y: enemy.position.y + strafeDirection.y * 200\n        };\n        \n        this.moveToward(enemy, targetPoint, 0.8);\n    }\n\n    /**\n     * Execute ramming behavior\n     */\n    private executeRamming(enemy: EnemyShip, deltaTime: number): void {\n        // Full speed toward player\n        this.moveToward(enemy, this.playerPosition, 2.0); // Maximum speed\n    }\n\n    /**\n     * Move enemy toward target position\n     */\n    private moveToward(enemy: EnemyShip, target: Vector2, speedMultiplier: number): void {\n        const direction = {\n            x: target.x - enemy.position.x,\n            y: target.y - enemy.position.y\n        };\n        \n        const distance = Math.sqrt(direction.x * direction.x + direction.y * direction.y);\n        if (distance === 0) return;\n        \n        // Normalize\n        direction.x /= distance;\n        direction.y /= distance;\n        \n        // Apply desired velocity\n        const desiredSpeed = enemy.config.maxSpeed * speedMultiplier;\n        const desiredVelocity = {\n            x: direction.x * desiredSpeed,\n            y: direction.y * desiredSpeed\n        };\n        \n        // Smooth acceleration\n        const acceleration = enemy.config.acceleration;\n        enemy.velocity.x += (desiredVelocity.x - enemy.velocity.x) * acceleration * 0.016; // Assume 60fps\n        enemy.velocity.y += (desiredVelocity.y - enemy.velocity.y) * acceleration * 0.016;\n        \n        // Update rotation to face movement direction\n        const targetRotation = Math.atan2(direction.y, direction.x);\n        enemy.rotation = this.lerpAngle(enemy.rotation, targetRotation, enemy.config.turnRate * 0.016);\n    }\n\n    /**\n     * Update enemy movement\n     */\n    private updateMovement(enemy: EnemyShip, deltaTime: number): void {\n        // Apply velocity\n        enemy.position.x += enemy.velocity.x * deltaTime;\n        enemy.position.y += enemy.velocity.y * deltaTime;\n        \n        // Apply drag\n        const drag = 0.95;\n        enemy.velocity.x *= drag;\n        enemy.velocity.y *= drag;\n    }\n\n    /**\n     * Update combat behavior\n     */\n    private updateCombat(enemy: EnemyShip, deltaTime: number): void {\n        if (!enemy.currentTarget) return;\n        \n        const currentTime = Date.now() / 1000;\n        const target = enemy.currentTarget === 'player' ? this.playerPosition : null;\n        \n        if (!target) return;\n        \n        const distance = this.calculateDistance(enemy.position, target);\n        const inRange = distance <= enemy.config.engagementRange;\n        const hasLineOfSight = this.hasLineOfSight(enemy.position, target);\n        \n        if (inRange && hasLineOfSight) {\n            // Try to fire weapons\n            for (const weaponConfig of enemy.config.weapons) {\n                const weaponId = `${enemy.config.id}_${weaponConfig.id}`;\n                const cooldownKey = weaponId;\n                const lastFired = enemy.weaponCooldowns.get(cooldownKey) || 0;\n                \n                // Check if weapon can fire based on fire rate\n                const fireRate = weaponConfig.stats.fireRate;\n                const timeSinceLastShot = currentTime - lastFired;\n                \n                if (timeSinceLastShot >= 1 / fireRate) {\n                    // Apply accuracy\n                    const accuracy = enemy.config.accuracy * enemy.config.intelligence;\n                    const shouldFire = Math.random() < accuracy;\n                    \n                    if (shouldFire) {\n                        const fired = this.weaponSystem.fireWeapon(\n                            weaponId,\n                            enemy.position,\n                            this.predictPlayerPosition(distance / 600) // Predict based on projectile travel time\n                        );\n                        \n                        if (fired) {\n                            enemy.weaponCooldowns.set(cooldownKey, currentTime);\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Apply damage to enemy\n     */\n    applyDamage(enemyId: string, damage: number, damageType: string): boolean {\n        const enemy = this.enemies.get(enemyId);\n        if (!enemy || !enemy.isAlive) return false;\n        \n        // Apply armor reduction\n        let finalDamage = damage;\n        if (enemy.config.armor > 0) {\n            finalDamage = Math.max(1, damage - enemy.config.armor * 0.1);\n        }\n        \n        // Apply to shields first\n        if (enemy.config.shields > 0) {\n            const shieldDamage = Math.min(finalDamage, enemy.config.shields);\n            enemy.config.shields -= shieldDamage;\n            finalDamage -= shieldDamage;\n        }\n        \n        // Apply remaining damage to hull\n        if (finalDamage > 0) {\n            enemy.config.hull -= finalDamage;\n        }\n        \n        enemy.lastDamageTime = Date.now() / 1000;\n        \n        this.events.onEnemyDamaged?.(enemy, damage);\n        \n        // Check if destroyed\n        if (enemy.config.hull <= 0) {\n            this.destroyEnemy(enemyId);\n            return true;\n        }\n        \n        return false;\n    }\n\n    /**\n     * Destroy enemy\n     */\n    private destroyEnemy(enemyId: string): void {\n        const enemy = this.enemies.get(enemyId);\n        if (!enemy) return;\n        \n        enemy.isAlive = false;\n        \n        // Remove weapons\n        enemy.config.weapons.forEach(weapon => {\n            this.weaponSystem.removeWeapon(`${enemyId}_${weapon.id}`);\n        });\n        \n        // Remove from weapon system targets\n        this.weaponSystem.removeTarget(enemyId);\n        \n        this.events.onEnemyDestroyed?.(enemy);\n        \n        this.logger.info(`💥 Destroyed ${enemy.config.name}`);\n    }\n\n    /**\n     * Clean up dead enemies\n     */\n    private cleanupDeadEnemies(): void {\n        for (const [enemyId, enemy] of this.enemies.entries()) {\n            if (!enemy.isAlive) {\n                this.enemies.delete(enemyId);\n            }\n        }\n    }\n\n    /**\n     * Helper methods\n     */\n    \n    private generatePatrolWaypoint(enemy: EnemyShip): Vector2 {\n        const angle = Math.random() * Math.PI * 2;\n        const radius = enemy.patrolRadius * (0.5 + Math.random() * 0.5);\n        \n        return {\n            x: enemy.patrolCenter.x + Math.cos(angle) * radius,\n            y: enemy.patrolCenter.y + Math.sin(angle) * radius\n        };\n    }\n\n    private generateRetreatWaypoint(enemy: EnemyShip): Vector2 {\n        const awayFromPlayer = {\n            x: enemy.position.x - this.playerPosition.x,\n            y: enemy.position.y - this.playerPosition.y\n        };\n        \n        const distance = Math.sqrt(awayFromPlayer.x * awayFromPlayer.x + awayFromPlayer.y * awayFromPlayer.y);\n        if (distance === 0) {\n            return { x: enemy.position.x + 500, y: enemy.position.y };\n        }\n        \n        awayFromPlayer.x /= distance;\n        awayFromPlayer.y /= distance;\n        \n        return {\n            x: enemy.position.x + awayFromPlayer.x * 800,\n            y: enemy.position.y + awayFromPlayer.y * 800\n        };\n    }\n\n    private calculateRetreatPoint(from: Vector2, away: Vector2): Vector2 {\n        const direction = {\n            x: from.x - away.x,\n            y: from.y - away.y\n        };\n        \n        const distance = Math.sqrt(direction.x * direction.x + direction.y * direction.y);\n        if (distance === 0) return from;\n        \n        direction.x /= distance;\n        direction.y /= distance;\n        \n        return {\n            x: from.x + direction.x * 200,\n            y: from.y + direction.y * 200\n        };\n    }\n\n    private calculateEvasionPoint(enemy: EnemyShip): Vector2 {\n        // Move perpendicular to player direction\n        const toPlayer = {\n            x: this.playerPosition.x - enemy.position.x,\n            y: this.playerPosition.y - enemy.position.y\n        };\n        \n        const distance = Math.sqrt(toPlayer.x * toPlayer.x + toPlayer.y * toPlayer.y);\n        if (distance === 0) return enemy.position;\n        \n        // Perpendicular direction\n        const perpendicular = {\n            x: -toPlayer.y / distance,\n            y: toPlayer.x / distance\n        };\n        \n        // Random side\n        if (Math.random() < 0.5) {\n            perpendicular.x *= -1;\n            perpendicular.y *= -1;\n        }\n        \n        return {\n            x: enemy.position.x + perpendicular.x * 300,\n            y: enemy.position.y + perpendicular.y * 300\n        };\n    }\n\n    private predictPlayerPosition(seconds: number): Vector2 {\n        return {\n            x: this.playerPosition.x + this.playerVelocity.x * seconds,\n            y: this.playerPosition.y + this.playerVelocity.y * seconds\n        };\n    }\n\n    private hasLineOfSight(from: Vector2, to: Vector2): boolean {\n        // Simplified - assume always true for now\n        // In a real implementation, this would check for obstacles\n        return true;\n    }\n\n    private calculateDistance(pos1: Vector2, pos2: Vector2): number {\n        const dx = pos1.x - pos2.x;\n        const dy = pos1.y - pos2.y;\n        return Math.sqrt(dx * dx + dy * dy);\n    }\n\n    private lerpAngle(from: number, to: number, factor: number): number {\n        let diff = to - from;\n        \n        // Wrap difference to [-π, π]\n        while (diff > Math.PI) diff -= Math.PI * 2;\n        while (diff < -Math.PI) diff += Math.PI * 2;\n        \n        return from + diff * factor;\n    }\n\n    /**\n     * Render enemies\n     */\n    render(renderer: Renderer): void {\n        for (const enemy of this.enemies.values()) {\n            if (enemy.isAlive) {\n                this.renderEnemy(renderer, enemy);\n            }\n        }\n    }\n\n    /**\n     * Render individual enemy\n     */\n    private renderEnemy(renderer: Renderer, enemy: EnemyShip): void {\n        const pos = enemy.position;\n        const size = enemy.config.size;\n        \n        // Get ship color based on faction and class\n        const color = this.getShipColor(enemy.config.faction, enemy.config.shipClass);\n        \n        // Draw ship body\n        if (enemy.config.shipClass === ShipClass.Drone) {\n            // Small triangle for drones\n            const points = this.getTrianglePoints(pos, size * 0.5, enemy.rotation);\n            this.drawTriangle(renderer, points, color);\n        } else {\n            // Larger ships as rectangles with details\n            this.drawShip(renderer, pos, size, enemy.rotation, color);\n        }\n        \n        // Draw health bar\n        this.drawHealthBar(renderer, enemy);\n        \n        // Draw AI state indicator (debug)\n        if (enemy.state !== AIState.Idle) {\n            this.drawStateIndicator(renderer, enemy);\n        }\n    }\n\n    private getShipColor(faction: string, shipClass: ShipClass): Color {\n        const factionColors: { [key: string]: Color } = {\n            pirates: { r: 72, g: 24, b: 24 },     // Dark red\n            aliens: { r: 48, g: 24, b: 72 },      // Dark purple\n            rebels: { r: 24, g: 48, b: 24 },      // Dark green\n            corporation: { r: 48, g: 48, b: 32 }, // Dark yellow\n            military: { r: 32, g: 32, b: 48 }     // Dark blue\n        };\n        \n        return factionColors[faction] || { r: 48, g: 48, b: 48 };\n    }\n\n    private getTrianglePoints(center: Vector2, size: number, rotation: number): Vector2[] {\n        const cos = Math.cos(rotation);\n        const sin = Math.sin(rotation);\n        \n        return [\n            {\n                x: center.x + cos * size,\n                y: center.y + sin * size\n            },\n            {\n                x: center.x + cos * (-size * 0.5) - sin * (size * 0.5),\n                y: center.y + sin * (-size * 0.5) + cos * (size * 0.5)\n            },\n            {\n                x: center.x + cos * (-size * 0.5) - sin * (-size * 0.5),\n                y: center.y + sin * (-size * 0.5) + cos * (-size * 0.5)\n            }\n        ];\n    }\n\n    private drawTriangle(renderer: Renderer, points: Vector2[], color: Color): void {\n        // Draw triangle outline\n        for (let i = 0; i < points.length; i++) {\n            const next = (i + 1) % points.length;\n            renderer.drawLine(points[i].x, points[i].y, points[next].x, points[next].y, color);\n        }\n    }\n\n    private drawShip(renderer: Renderer, pos: Vector2, size: number, rotation: number, color: Color): void {\n        // Simple ship representation as oriented rectangle\n        const cos = Math.cos(rotation);\n        const sin = Math.sin(rotation);\n        \n        const halfWidth = size * 0.3;\n        const halfHeight = size * 0.6;\n        \n        const corners = [\n            { x: pos.x + cos * halfHeight - sin * halfWidth, y: pos.y + sin * halfHeight + cos * halfWidth },\n            { x: pos.x + cos * halfHeight - sin * (-halfWidth), y: pos.y + sin * halfHeight + cos * (-halfWidth) },\n            { x: pos.x + cos * (-halfHeight) - sin * (-halfWidth), y: pos.y + sin * (-halfHeight) + cos * (-halfWidth) },\n            { x: pos.x + cos * (-halfHeight) - sin * halfWidth, y: pos.y + sin * (-halfHeight) + cos * halfWidth }\n        ];\n        \n        // Draw ship outline\n        for (let i = 0; i < corners.length; i++) {\n            const next = (i + 1) % corners.length;\n            renderer.drawLine(corners[i].x, corners[i].y, corners[next].x, corners[next].y, color);\n        }\n        \n        // Draw front indicator\n        const frontX = pos.x + cos * halfHeight;\n        const frontY = pos.y + sin * halfHeight;\n        renderer.fillRect(frontX - 1, frontY - 1, 2, 2, color);\n    }\n\n    private drawHealthBar(renderer: Renderer, enemy: EnemyShip): void {\n        const pos = enemy.position;\n        const size = enemy.config.size;\n        \n        const barWidth = size * 1.2;\n        const barHeight = 3;\n        const barY = pos.y - size * 0.8;\n        \n        // Background\n        renderer.fillRect(pos.x - barWidth/2, barY, barWidth, barHeight, { r: 16, g: 16, b: 16 });\n        \n        // Health\n        const healthPercent = enemy.config.hull / enemy.config.maxHull;\n        const healthWidth = barWidth * healthPercent;\n        const healthColor = healthPercent > 0.6 ? \n            { r: 12, g: 36, b: 12 } : \n            healthPercent > 0.3 ? \n                { r: 72, g: 48, b: 12 } : \n                { r: 72, g: 24, b: 24 };\n        \n        renderer.fillRect(pos.x - barWidth/2, barY, healthWidth, barHeight, healthColor);\n        \n        // Shields (if any)\n        if (enemy.config.maxShields > 0) {\n            const shieldPercent = enemy.config.shields / enemy.config.maxShields;\n            const shieldWidth = barWidth * shieldPercent;\n            renderer.fillRect(pos.x - barWidth/2, barY - 5, shieldWidth, 2, { r: 16, g: 40, b: 32 });\n        }\n    }\n\n    private drawStateIndicator(renderer: Renderer, enemy: EnemyShip): void {\n        const pos = enemy.position;\n        const stateColors: { [key: string]: Color } = {\n            [AIState.Patrol]: { r: 32, g: 32, b: 32 },\n            [AIState.Pursue]: { r: 72, g: 48, b: 12 },\n            [AIState.Attack]: { r: 72, g: 24, b: 24 },\n            [AIState.Evade]: { r: 12, g: 36, b: 12 },\n            [AIState.Retreat]: { r: 48, g: 32, b: 72 },\n            [AIState.Ramming]: { r: 96, g: 32, b: 32 }\n        };\n        \n        const color = stateColors[enemy.state] || { r: 48, g: 48, b: 48 };\n        renderer.fillRect(pos.x - 3, pos.y + enemy.config.size + 5, 6, 6, color);\n    }\n\n    /**\n     * Get all enemies\n     */\n    getAllEnemies(): EnemyShip[] {\n        return Array.from(this.enemies.values()).filter(e => e.isAlive);\n    }\n\n    /**\n     * Get enemy by ID\n     */\n    getEnemy(enemyId: string): EnemyShip | null {\n        return this.enemies.get(enemyId) || null;\n    }\n\n    /**\n     * Get AI statistics\n     */\n    getStats(): {\n        totalEnemies: number;\n        aliveEnemies: number;\n        enemiesByFaction: { [faction: string]: number };\n        enemiesByState: { [state: string]: number };\n    } {\n        const enemiesByFaction: { [faction: string]: number } = {};\n        const enemiesByState: { [state: string]: number } = {};\n        \n        let aliveCount = 0;\n        \n        for (const enemy of this.enemies.values()) {\n            if (enemy.isAlive) {\n                aliveCount++;\n                enemiesByFaction[enemy.config.faction] = (enemiesByFaction[enemy.config.faction] || 0) + 1;\n                enemiesByState[enemy.state] = (enemiesByState[enemy.state] || 0) + 1;\n            }\n        }\n        \n        return {\n            totalEnemies: this.enemies.size,\n            aliveEnemies: aliveCount,\n            enemiesByFaction,\n            enemiesByState\n        };\n    }\n\n    /**\n     * Clear all enemies\n     */\n    clearEnemies(): void {\n        for (const [enemyId] of this.enemies.entries()) {\n            this.destroyEnemy(enemyId);\n        }\n        this.enemies.clear();\n    }\n}","/**\n * Combat Manager\n * Coordinates weapon systems, enemy AI, and combat encounters\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Vector2, Renderer } from '@core/Renderer';\nimport { WeaponSystem, WeaponConfig, WeaponType, DamageType, DamageResult } from './WeaponSystem';\nimport { EnemyAI, EnemyShipConfig, ShipClass, AIBehavior } from './EnemyAI';\nimport { GameItem, ItemDatabase } from '@items/ItemSystem';\nimport { InventoryManager } from '@inventory/InventoryManager';\n\nexport interface CombatEncounter {\n    id: string;\n    name: string;\n    difficulty: number; // 1-10\n    enemyConfigs: EnemyShipConfig[];\n    spawnPositions: Vector2[];\n    rewards: {\n        experience: number;\n        credits: number;\n        items: { itemId: string, quantity: number, dropRate: number }[];\n    };\n    isActive: boolean;\n    startTime: number;\n    completionTime?: number;\n}\n\nexport interface CombatStats {\n    totalDamageDealt: number;\n    totalDamageReceived: number;\n    enemiesDestroyed: number;\n    shotsHit: number;\n    shotsFired: number;\n    encountersCompleted: number;\n    experienceGained: number;\n}\n\nexport interface CombatEvents {\n    onEncounterStarted?: (encounter: CombatEncounter) => void;\n    onEncounterCompleted?: (encounter: CombatEncounter, success: boolean) => void;\n    onEnemyDestroyed?: (enemyId: string, rewards: { items: GameItem[], experience: number }) => void;\n    onPlayerDamaged?: (damage: number, damageType: DamageType) => void;\n    onCombatStatsUpdated?: (stats: CombatStats) => void;\n}\n\nexport class CombatManager {\n    private weaponSystem: WeaponSystem;\n    private enemyAI: EnemyAI;\n    private itemDatabase: ItemDatabase;\n    private inventory: InventoryManager;\n    \n    // Combat state\n    private activeEncounters: Map<string, CombatEncounter> = new Map();\n    private combatStats: CombatStats = {\n        totalDamageDealt: 0,\n        totalDamageReceived: 0,\n        enemiesDestroyed: 0,\n        shotsHit: 0,\n        shotsFired: 0,\n        encountersCompleted: 0,\n        experienceGained: 0\n    };\n    \n    // Player ship reference\n    private playerPosition: Vector2 = { x: 0, y: 0 };\n    private playerVelocity: Vector2 = { x: 0, y: 0 };\n    private playerSize: number = 20;\n    private playerHull: number = 100;\n    private playerMaxHull: number = 100;\n    \n    private events: CombatEvents;\n    private logger: Logger;\n\n    constructor(\n        itemDatabase: ItemDatabase,\n        inventory: InventoryManager,\n        events: CombatEvents = {}\n    ) {\n        this.logger = new Logger('CombatManager');\n        this.itemDatabase = itemDatabase;\n        this.inventory = inventory;\n        this.events = events;\n        \n        // Initialize weapon system\n        this.weaponSystem = new WeaponSystem({\n            onWeaponFired: (weapon, projectile) => {\n                this.combatStats.shotsFired++;\n                this.logger.debug(`🔫 ${weapon.name} fired`);\n            },\n            onProjectileHit: (projectile, result) => {\n                this.handleProjectileHit(projectile, result);\n            },\n            onWeaponOverheat: (weapon) => {\n                this.logger.warn(`🔥 ${weapon.name} overheated`);\n            }\n        });\n        \n        // Initialize enemy AI\n        this.enemyAI = new EnemyAI(this.weaponSystem, {\n            onEnemySpawned: (enemy) => {\n                this.logger.info(`🛸 Enemy spawned: ${enemy.config.name}`);\n            },\n            onEnemyDestroyed: (enemy) => {\n                this.handleEnemyDestroyed(enemy);\n            },\n            onEnemyDamaged: (enemy, damage) => {\n                this.logger.debug(`💥 ${enemy.config.name} took ${damage} damage`);\n            }\n        });\n        \n        this.initializePlayerWeapons();\n        \n        this.logger.info('⚔️ Combat manager initialized');\n    }\n\n    /**\n     * Initialize player weapons\n     */\n    private initializePlayerWeapons(): void {\n        // Add basic player weapons\n        const basicLaser: WeaponConfig = {\n            id: 'player_laser_1',\n            name: 'Basic Laser Cannon',\n            type: WeaponType.Energy,\n            damageType: DamageType.Energy,\n            stats: {\n                damage: 25,\n                range: 400,\n                fireRate: 3, // 3 shots per second\n                energyCost: 5,\n                accuracy: 0.9,\n                penetration: 0.1,\n                spread: 2, // 2 degrees\n                chargeTime: 0,\n                cooldownTime: 2\n            },\n            mountPoint: { x: 0, y: -10 },\n            hardpointSize: 'small'\n        };\n        \n        const basicProjectile: WeaponConfig = {\n            id: 'player_cannon_1',\n            name: 'Mass Driver',\n            type: WeaponType.Projectile,\n            damageType: DamageType.Kinetic,\n            stats: {\n                damage: 40,\n                range: 500,\n                fireRate: 2,\n                energyCost: 0,\n                accuracy: 0.8,\n                penetration: 0.3,\n                spread: 1,\n                chargeTime: 0,\n                cooldownTime: 1,\n                ammoCapacity: 100,\n                reloadTime: 3\n            },\n            mountPoint: { x: 0, y: 10 },\n            hardpointSize: 'small'\n        };\n        \n        this.weaponSystem.addWeapon(basicLaser);\n        this.weaponSystem.addWeapon(basicProjectile);\n        \n        this.logger.info('🔫 Player weapons initialized', {\n            laser: basicLaser.name,\n            cannon: basicProjectile.name\n        });\n    }\n\n    /**\n     * Handle projectile hit\n     */\n    private handleProjectileHit(projectile: any, result: DamageResult): void {\n        this.combatStats.shotsHit++;\n        \n        if (result.targetId === 'player') {\n            // Player took damage\n            this.playerHull = Math.max(0, this.playerHull - result.damage);\n            this.combatStats.totalDamageReceived += result.damage;\n            \n            this.events.onPlayerDamaged?.(result.damage, result.damageType);\n            \n            this.logger.info(`💥 Player hit for ${result.damage} ${result.damageType} damage`, {\n                critical: result.criticalHit,\n                penetrated: result.penetrated,\n                hullRemaining: this.playerHull\n            });\n        } else {\n            // Enemy took damage\n            const destroyed = this.enemyAI.applyDamage(result.targetId, result.damage, result.damageType);\n            this.combatStats.totalDamageDealt += result.damage;\n            \n            if (destroyed) {\n                this.combatStats.enemiesDestroyed++;\n            }\n        }\n        \n        this.events.onCombatStatsUpdated?.(this.combatStats);\n    }\n\n    /**\n     * Handle enemy destroyed\n     */\n    private handleEnemyDestroyed(enemy: any): void {\n        const rewards = this.calculateRewards(enemy.config);\n        \n        // Add items to inventory\n        rewards.items.forEach(item => {\n            this.inventory.addItem(item, 1);\n        });\n        \n        // Add experience\n        this.combatStats.experienceGained += rewards.experience;\n        \n        this.events.onEnemyDestroyed?.(enemy.config.id, rewards);\n        \n        // Check if any encounters are completed\n        this.checkEncounterCompletion();\n        \n        this.logger.info(`💰 Enemy destroyed rewards`, {\n            enemy: enemy.config.name,\n            items: rewards.items.length,\n            experience: rewards.experience\n        });\n    }\n\n    /**\n     * Calculate rewards for destroyed enemy\n     */\n    private calculateRewards(enemyConfig: any): { items: GameItem[], experience: number } {\n        const items: GameItem[] = [];\n        let experience = 0;\n        \n        // Base experience based on ship class\n        const baseExperience: { [key: string]: number } = {\n            [ShipClass.Drone]: 5,\n            [ShipClass.Fighter]: 15,\n            [ShipClass.Corvette]: 30,\n            [ShipClass.Frigate]: 50,\n            [ShipClass.Destroyer]: 100,\n            [ShipClass.Cruiser]: 200,\n            [ShipClass.Battleship]: 500\n        };\n        \n        experience = baseExperience[enemyConfig.shipClass] || 10;\n        \n        // Random item drops\n        const dropChance = 0.3; // 30% chance for item drop\n        if (Math.random() < dropChance) {\n            const randomItem = this.itemDatabase.generateRandomItem();\n            if (randomItem) {\n                items.push(randomItem);\n            }\n        }\n        \n        // Specific loot based on faction\n        const factionLoot: { [faction: string]: string[] } = {\n            pirates: ['metal_iron', 'gas_hydrogen'],\n            aliens: ['crystal_dilithium', 'energy_antimatter'],\n            military: ['comp_circuit', 'tool_repair_kit'],\n            corporation: ['crystal_quartz', 'comp_shield_emitter']\n        };\n        \n        const possibleLoot = factionLoot[enemyConfig.faction] || [];\n        if (possibleLoot.length > 0 && Math.random() < 0.4) {\n            const lootId = possibleLoot[Math.floor(Math.random() * possibleLoot.length)];\n            const lootItem = this.itemDatabase.getItem(lootId);\n            if (lootItem) {\n                items.push(lootItem);\n            }\n        }\n        \n        return { items, experience };\n    }\n\n    /**\n     * Start combat encounter\n     */\n    startEncounter(encounter: CombatEncounter): void {\n        encounter.isActive = true;\n        encounter.startTime = Date.now();\n        \n        // Spawn enemies\n        encounter.enemyConfigs.forEach((config, index) => {\n            const spawnPos = encounter.spawnPositions[index] || { x: 800, y: 400 };\n            this.enemyAI.spawnEnemy(config, spawnPos);\n        });\n        \n        this.activeEncounters.set(encounter.id, encounter);\n        this.events.onEncounterStarted?.(encounter);\n        \n        this.logger.info(`🚨 Combat encounter started: ${encounter.name}`, {\n            difficulty: encounter.difficulty,\n            enemies: encounter.enemyConfigs.length\n        });\n    }\n\n    /**\n     * Check if encounters are completed\n     */\n    private checkEncounterCompletion(): void {\n        for (const [encounterId, encounter] of this.activeEncounters.entries()) {\n            if (!encounter.isActive) continue;\n            \n            // Check if all enemies from this encounter are destroyed\n            const remainingEnemies = this.enemyAI.getAllEnemies()\n                .filter(enemy => encounter.enemyConfigs.some(config => config.id === enemy.config.id));\n            \n            if (remainingEnemies.length === 0) {\n                // Encounter completed\n                encounter.isActive = false;\n                encounter.completionTime = Date.now();\n                \n                this.combatStats.encountersCompleted++;\n                this.events.onEncounterCompleted?.(encounter, true);\n                \n                this.logger.info(`✅ Encounter completed: ${encounter.name}`, {\n                    duration: (encounter.completionTime - encounter.startTime) / 1000,\n                    rewards: encounter.rewards\n                });\n                \n                this.activeEncounters.delete(encounterId);\n            }\n        }\n    }\n\n    /**\n     * Generate predefined encounters\n     */\n    generateEncounters(): CombatEncounter[] {\n        const encounters: CombatEncounter[] = [];\n        \n        // Pirate patrol\n        encounters.push({\n            id: 'pirate_patrol_1',\n            name: 'Pirate Patrol',\n            difficulty: 2,\n            enemyConfigs: [\n                this.createEnemyConfig('pirate_fighter_1', 'Pirate Fighter', ShipClass.Fighter, 'pirates', AIBehavior.Aggressive),\n                this.createEnemyConfig('pirate_drone_1', 'Pirate Drone', ShipClass.Drone, 'pirates', AIBehavior.Kamikaze)\n            ],\n            spawnPositions: [\n                { x: 700, y: 300 },\n                { x: 750, y: 350 }\n            ],\n            rewards: {\n                experience: 50,\n                credits: 100,\n                items: [\n                    { itemId: 'metal_iron', quantity: 5, dropRate: 0.8 },\n                    { itemId: 'tool_repair_kit', quantity: 1, dropRate: 0.3 }\n                ]\n            },\n            isActive: false,\n            startTime: 0\n        });\n        \n        // Alien scout\n        encounters.push({\n            id: 'alien_scout_1',\n            name: 'Alien Scout',\n            difficulty: 4,\n            enemyConfigs: [\n                this.createEnemyConfig('alien_corvette_1', 'Alien Corvette', ShipClass.Corvette, 'aliens', AIBehavior.Evasive)\n            ],\n            spawnPositions: [\n                { x: 600, y: 200 }\n            ],\n            rewards: {\n                experience: 80,\n                credits: 200,\n                items: [\n                    { itemId: 'crystal_dilithium', quantity: 2, dropRate: 0.6 },\n                    { itemId: 'energy_antimatter', quantity: 1, dropRate: 0.2 }\n                ]\n            },\n            isActive: false,\n            startTime: 0\n        });\n        \n        // Corporate security\n        encounters.push({\n            id: 'corp_security_1',\n            name: 'Corporate Security',\n            difficulty: 3,\n            enemyConfigs: [\n                this.createEnemyConfig('corp_frigate_1', 'Corporate Frigate', ShipClass.Frigate, 'corporation', AIBehavior.Defensive),\n                this.createEnemyConfig('corp_fighter_1', 'Corporate Fighter', ShipClass.Fighter, 'corporation', AIBehavior.Support)\n            ],\n            spawnPositions: [\n                { x: 800, y: 400 },\n                { x: 750, y: 450 }\n            ],\n            rewards: {\n                experience: 120,\n                credits: 300,\n                items: [\n                    { itemId: 'comp_shield_emitter', quantity: 1, dropRate: 0.5 },\n                    { itemId: 'crystal_quartz', quantity: 3, dropRate: 0.7 }\n                ]\n            },\n            isActive: false,\n            startTime: 0\n        });\n        \n        return encounters;\n    }\n\n    /**\n     * Create enemy ship configuration\n     */\n    private createEnemyConfig(\n        id: string,\n        name: string,\n        shipClass: ShipClass,\n        faction: string,\n        behavior: AIBehavior\n    ): EnemyShipConfig {\n        // Base stats by ship class\n        const classStats: { [key: string]: any } = {\n            [ShipClass.Drone]: {\n                size: 8, maxSpeed: 200, hull: 20, weapons: [this.createBasicWeapon('drone_laser', WeaponType.Energy, 15)]\n            },\n            [ShipClass.Fighter]: {\n                size: 15, maxSpeed: 180, hull: 60, weapons: [this.createBasicWeapon('fighter_cannon', WeaponType.Projectile, 25)]\n            },\n            [ShipClass.Corvette]: {\n                size: 20, maxSpeed: 150, hull: 120, weapons: [\n                    this.createBasicWeapon('corvette_laser', WeaponType.Energy, 30),\n                    this.createBasicWeapon('corvette_missiles', WeaponType.Missile, 40)\n                ]\n            },\n            [ShipClass.Frigate]: {\n                size: 25, maxSpeed: 120, hull: 200, weapons: [\n                    this.createBasicWeapon('frigate_plasma', WeaponType.Plasma, 45),\n                    this.createBasicWeapon('frigate_cannon', WeaponType.Projectile, 35)\n                ]\n            }\n        };\n        \n        const stats = classStats[shipClass] || classStats[ShipClass.Fighter];\n        \n        return {\n            id,\n            name,\n            shipClass,\n            faction,\n            \n            size: stats.size,\n            mass: stats.size * 10,\n            maxSpeed: stats.maxSpeed,\n            acceleration: 0.8,\n            turnRate: 2.0,\n            \n            hull: stats.hull,\n            maxHull: stats.hull,\n            shields: shipClass === ShipClass.Drone ? 0 : stats.hull * 0.5,\n            maxShields: shipClass === ShipClass.Drone ? 0 : stats.hull * 0.5,\n            armor: Math.floor(stats.hull * 0.1),\n            \n            behavior,\n            aggression: behavior === AIBehavior.Aggressive ? 0.9 : 0.6,\n            intelligence: 0.7,\n            accuracy: 0.75,\n            reactionTime: 0.5,\n            \n            weapons: stats.weapons,\n            engagementRange: stats.size * 20,\n            preferredRange: stats.size * 15\n        };\n    }\n\n    /**\n     * Create basic weapon configuration\n     */\n    private createBasicWeapon(id: string, type: WeaponType, damage: number): WeaponConfig {\n        const baseStats = {\n            [WeaponType.Energy]: { range: 300, fireRate: 2.5, energyCost: 5 },\n            [WeaponType.Projectile]: { range: 400, fireRate: 2.0, energyCost: 0 },\n            [WeaponType.Missile]: { range: 500, fireRate: 0.5, energyCost: 15 },\n            [WeaponType.Plasma]: { range: 250, fireRate: 1.5, energyCost: 10 },\n            [WeaponType.Beam]: { range: 350, fireRate: 3.0, energyCost: 8 },\n            [WeaponType.Torpedo]: { range: 600, fireRate: 0.3, energyCost: 20 }\n        };\n        \n        const stats = baseStats[type] || baseStats[WeaponType.Energy];\n        \n        return {\n            id,\n            name: `${type} Weapon`,\n            type,\n            damageType: type === WeaponType.Energy ? DamageType.Energy : DamageType.Kinetic,\n            stats: {\n                damage,\n                range: stats.range,\n                fireRate: stats.fireRate,\n                energyCost: stats.energyCost,\n                accuracy: 0.8,\n                penetration: 0.2,\n                spread: 3,\n                chargeTime: 0,\n                cooldownTime: 1\n            },\n            mountPoint: { x: 0, y: 0 },\n            hardpointSize: 'small'\n        };\n    }\n\n    /**\n     * Update combat manager\n     */\n    update(deltaTime: number): void {\n        // Update weapon system\n        this.weaponSystem.update(deltaTime);\n        \n        // Update enemy AI with player position\n        this.enemyAI.updatePlayer(this.playerPosition, this.playerVelocity, this.playerSize);\n        this.enemyAI.update(deltaTime);\n        \n        // Check encounter completion\n        this.checkEncounterCompletion();\n    }\n\n    /**\n     * Update player information\n     */\n    updatePlayer(position: Vector2, velocity: Vector2, size: number, hull: number, maxHull: number): void {\n        this.playerPosition = { ...position };\n        this.playerVelocity = { ...velocity };\n        this.playerSize = size;\n        this.playerHull = hull;\n        this.playerMaxHull = maxHull;\n    }\n\n    /**\n     * Fire player weapon\n     */\n    firePlayerWeapon(weaponId: string, targetPosition?: Vector2): boolean {\n        return this.weaponSystem.fireWeapon(weaponId, this.playerPosition, targetPosition);\n    }\n\n    /**\n     * Render combat effects\n     */\n    render(renderer: Renderer): void {\n        // Render weapon effects (projectiles, etc.)\n        this.weaponSystem.render(renderer);\n        \n        // Render enemies\n        this.enemyAI.render(renderer);\n    }\n\n    /**\n     * Start random encounter\n     */\n    startRandomEncounter(): void {\n        const encounters = this.generateEncounters();\n        if (encounters.length > 0) {\n            const randomIndex = Math.floor(Math.random() * encounters.length);\n            this.startEncounter(encounters[randomIndex]);\n        }\n    }\n\n    /**\n     * Get combat statistics\n     */\n    getCombatStats(): CombatStats {\n        return { ...this.combatStats };\n    }\n\n    /**\n     * Get active encounters\n     */\n    getActiveEncounters(): CombatEncounter[] {\n        return Array.from(this.activeEncounters.values());\n    }\n\n    /**\n     * Get player weapons\n     */\n    getPlayerWeapons(): Array<{ weapon: WeaponConfig; state: any }> {\n        return this.weaponSystem.getAllWeapons().filter(w => w.weapon.id.startsWith('player_'));\n    }\n\n    /**\n     * Get all enemies\n     */\n    getEnemies(): any[] {\n        return this.enemyAI.getAllEnemies();\n    }\n\n    /**\n     * Clear all combat\n     */\n    clearCombat(): void {\n        this.weaponSystem.clearProjectiles();\n        this.enemyAI.clearEnemies();\n        this.activeEncounters.clear();\n        \n        this.logger.info('🧹 Combat cleared');\n    }\n\n    /**\n     * Reset combat stats\n     */\n    resetStats(): void {\n        this.combatStats = {\n            totalDamageDealt: 0,\n            totalDamageReceived: 0,\n            enemiesDestroyed: 0,\n            shotsHit: 0,\n            shotsFired: 0,\n            encountersCompleted: 0,\n            experienceGained: 0\n        };\n        \n        this.events.onCombatStatsUpdated?.(this.combatStats);\n    }\n}","/**\n * Player Progression System\n * Complete RPG progression with levels, skills, attributes, and achievements\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\n\nexport enum SkillCategory {\n    Combat = 'combat',\n    Piloting = 'piloting',\n    Engineering = 'engineering',\n    Science = 'science',\n    Trade = 'trade',\n    Exploration = 'exploration'\n}\n\nexport enum AttributeType {\n    Reflexes = 'reflexes',       // Combat speed, evasion\n    Intelligence = 'intelligence', // Research, hacking\n    Endurance = 'endurance',     // Hull points, fatigue resistance\n    Perception = 'perception',   // Detection, accuracy\n    Charisma = 'charisma',      // Trade, diplomacy\n    Technical = 'technical'      // Engineering, repair efficiency\n}\n\nexport interface Skill {\n    id: string;\n    name: string;\n    category: SkillCategory;\n    level: number;\n    experience: number;\n    maxLevel: number;\n    description: string;\n    prerequisite?: string; // Required skill ID\n    prerequisiteLevel?: number;\n    \n    // Effects\n    bonuses: SkillBonus[];\n}\n\nexport interface SkillBonus {\n    type: 'damage' | 'accuracy' | 'speed' | 'efficiency' | 'cost_reduction' | 'detection' | 'capacity';\n    value: number; // Percentage or flat bonus\n    description: string;\n}\n\nexport interface Attribute {\n    type: AttributeType;\n    value: number;\n    baseValue: number;\n    modifiers: AttributeModifier[];\n}\n\nexport interface AttributeModifier {\n    source: string;\n    value: number;\n    duration: number; // -1 for permanent\n    description: string;\n}\n\nexport interface Achievement {\n    id: string;\n    name: string;\n    description: string;\n    category: string;\n    requirements: AchievementRequirement[];\n    rewards: AchievementReward[];\n    unlocked: boolean;\n    unlockedDate?: number;\n    hidden: boolean; // Don't show until unlocked\n}\n\nexport interface AchievementRequirement {\n    type: 'kill_enemies' | 'travel_distance' | 'earn_credits' | 'discover_systems' | 'craft_items' | 'complete_missions';\n    target: number;\n    current: number;\n    data?: any; // Additional requirement data\n}\n\nexport interface AchievementReward {\n    type: 'experience' | 'credits' | 'skill_points' | 'attribute_points' | 'item';\n    value: number;\n    itemId?: string;\n}\n\nexport interface CharacterSheet {\n    // Basic info\n    name: string;\n    level: number;\n    experience: number;\n    experienceToNext: number;\n    \n    // Points\n    skillPoints: number;\n    attributePoints: number;\n    \n    // Statistics\n    totalPlayTime: number;\n    enemiesDefeated: number;\n    systemsExplored: number;\n    distanceTraveled: number;\n    creditsEarned: number;\n    itemsCrafted: number;\n    \n    // Skills and attributes\n    skills: Map<string, Skill>;\n    attributes: Map<AttributeType, Attribute>;\n    achievements: Map<string, Achievement>;\n}\n\nexport interface ProgressionEvents {\n    onLevelUp?: (newLevel: number, rewards: { skillPoints: number, attributePoints: number }) => void;\n    onSkillLevelUp?: (skill: Skill, newLevel: number) => void;\n    onAchievementUnlocked?: (achievement: Achievement) => void;\n    onAttributeChanged?: (attribute: AttributeType, oldValue: number, newValue: number) => void;\n}\n\nexport class PlayerProgression {\n    private character!: CharacterSheet;\n    private events: ProgressionEvents;\n    \n    // Experience tables\n    private levelExperienceTable: number[] = [];\n    private skillExperienceTable: number[] = [];\n    \n    private logger: Logger;\n\n    constructor(events: ProgressionEvents = {}) {\n        this.logger = new Logger('PlayerProgression');\n        this.events = events;\n        \n        this.generateExperienceTables();\n        this.initializeCharacter();\n        this.initializeSkills();\n        this.initializeAchievements();\n        \n        this.logger.info('🎭 Player progression system initialized');\n    }\n\n    /**\n     * Generate experience tables for levels and skills\n     */\n    private generateExperienceTables(): void {\n        // Level experience: exponential growth\n        for (let level = 1; level <= 100; level++) {\n            const baseXP = 100;\n            const multiplier = Math.pow(1.15, level - 1);\n            this.levelExperienceTable.push(Math.floor(baseXP * multiplier));\n        }\n        \n        // Skill experience: linear with slight exponential\n        for (let level = 1; level <= 50; level++) {\n            const baseXP = 50;\n            const multiplier = Math.pow(1.1, level - 1);\n            this.skillExperienceTable.push(Math.floor(baseXP * multiplier));\n        }\n    }\n\n    /**\n     * Initialize character with default values\n     */\n    private initializeCharacter(): void {\n        this.character = {\n            name: 'Captain',\n            level: 1,\n            experience: 0,\n            experienceToNext: this.levelExperienceTable[1],\n            \n            skillPoints: 5,\n            attributePoints: 10,\n            \n            totalPlayTime: 0,\n            enemiesDefeated: 0,\n            systemsExplored: 0,\n            distanceTraveled: 0,\n            creditsEarned: 0,\n            itemsCrafted: 0,\n            \n            skills: new Map(),\n            attributes: new Map(),\n            achievements: new Map()\n        };\n        \n        // Initialize attributes\n        for (const attrType of Object.values(AttributeType)) {\n            this.character.attributes.set(attrType, {\n                type: attrType,\n                value: 10,\n                baseValue: 10,\n                modifiers: []\n            });\n        }\n    }\n\n    /**\n     * Initialize skill tree\n     */\n    private initializeSkills(): void {\n        const skills: Skill[] = [\n            // Combat Skills\n            {\n                id: 'weapon_proficiency',\n                name: 'Weapon Proficiency',\n                category: SkillCategory.Combat,\n                level: 0,\n                experience: 0,\n                maxLevel: 25,\n                description: 'Increases weapon damage and accuracy',\n                bonuses: [\n                    { type: 'damage', value: 2, description: '+2% weapon damage per level' },\n                    { type: 'accuracy', value: 1, description: '+1% accuracy per level' }\n                ]\n            },\n            {\n                id: 'tactical_combat',\n                name: 'Tactical Combat',\n                category: SkillCategory.Combat,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Reduces weapon heat buildup and cooldowns',\n                prerequisite: 'weapon_proficiency',\n                prerequisiteLevel: 5,\n                bonuses: [\n                    { type: 'efficiency', value: 3, description: '+3% weapon efficiency per level' },\n                    { type: 'cost_reduction', value: 2, description: '-2% energy cost per level' }\n                ]\n            },\n            {\n                id: 'shield_mastery',\n                name: 'Shield Mastery',\n                category: SkillCategory.Combat,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Improves shield capacity and regeneration',\n                bonuses: [\n                    { type: 'capacity', value: 5, description: '+5% shield capacity per level' },\n                    { type: 'efficiency', value: 3, description: '+3% regeneration rate per level' }\n                ]\n            },\n            \n            // Piloting Skills\n            {\n                id: 'ship_handling',\n                name: 'Ship Handling',\n                category: SkillCategory.Piloting,\n                level: 0,\n                experience: 0,\n                maxLevel: 25,\n                description: 'Improves ship maneuverability and speed',\n                bonuses: [\n                    { type: 'speed', value: 2, description: '+2% ship speed per level' },\n                    { type: 'efficiency', value: 1, description: '+1% turn rate per level' }\n                ]\n            },\n            {\n                id: 'evasive_maneuvers',\n                name: 'Evasive Maneuvers',\n                category: SkillCategory.Piloting,\n                level: 0,\n                experience: 0,\n                maxLevel: 15,\n                description: 'Increases evasion chance and reduces incoming damage',\n                prerequisite: 'ship_handling',\n                prerequisiteLevel: 8,\n                bonuses: [\n                    { type: 'efficiency', value: 2, description: '+2% evasion chance per level' }\n                ]\n            },\n            {\n                id: 'warp_navigation',\n                name: 'Warp Navigation',\n                category: SkillCategory.Piloting,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Reduces warp energy costs and improves efficiency',\n                bonuses: [\n                    { type: 'cost_reduction', value: 3, description: '-3% warp energy cost per level' },\n                    { type: 'speed', value: 1, description: '+1% warp speed per level' }\n                ]\n            },\n            \n            // Engineering Skills\n            {\n                id: 'system_repair',\n                name: 'System Repair',\n                category: SkillCategory.Engineering,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Improves repair efficiency and reduces costs',\n                bonuses: [\n                    { type: 'efficiency', value: 4, description: '+4% repair efficiency per level' },\n                    { type: 'cost_reduction', value: 2, description: '-2% repair cost per level' }\n                ]\n            },\n            {\n                id: 'power_management',\n                name: 'Power Management',\n                category: SkillCategory.Engineering,\n                level: 0,\n                experience: 0,\n                maxLevel: 15,\n                description: 'Increases power capacity and efficiency',\n                bonuses: [\n                    { type: 'capacity', value: 3, description: '+3% power capacity per level' },\n                    { type: 'efficiency', value: 2, description: '+2% power efficiency per level' }\n                ]\n            },\n            {\n                id: 'advanced_crafting',\n                name: 'Advanced Crafting',\n                category: SkillCategory.Engineering,\n                level: 0,\n                experience: 0,\n                maxLevel: 25,\n                description: 'Increases crafting success rates and unlocks recipes',\n                prerequisite: 'system_repair',\n                prerequisiteLevel: 5,\n                bonuses: [\n                    { type: 'efficiency', value: 3, description: '+3% crafting success rate per level' }\n                ]\n            },\n            \n            // Science Skills\n            {\n                id: 'sensor_analysis',\n                name: 'Sensor Analysis',\n                category: SkillCategory.Science,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Improves scanning range and accuracy',\n                bonuses: [\n                    { type: 'detection', value: 5, description: '+5% scanning range per level' },\n                    { type: 'efficiency', value: 2, description: '+2% scan accuracy per level' }\n                ]\n            },\n            {\n                id: 'research_methodology',\n                name: 'Research Methodology',\n                category: SkillCategory.Science,\n                level: 0,\n                experience: 0,\n                maxLevel: 15,\n                description: 'Increases research speed and technology unlock rate',\n                bonuses: [\n                    { type: 'efficiency', value: 4, description: '+4% research speed per level' }\n                ]\n            },\n            \n            // Trade Skills\n            {\n                id: 'negotiation',\n                name: 'Negotiation',\n                category: SkillCategory.Trade,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Improves trade prices and contract rewards',\n                bonuses: [\n                    { type: 'efficiency', value: 2, description: '+2% trade profit per level' }\n                ]\n            },\n            {\n                id: 'market_analysis',\n                name: 'Market Analysis',\n                category: SkillCategory.Trade,\n                level: 0,\n                experience: 0,\n                maxLevel: 15,\n                description: 'Provides better market information and price predictions',\n                prerequisite: 'negotiation',\n                prerequisiteLevel: 5,\n                bonuses: [\n                    { type: 'detection', value: 3, description: '+3% market insight per level' }\n                ]\n            },\n            \n            // Exploration Skills\n            {\n                id: 'stellar_cartography',\n                name: 'Stellar Cartography',\n                category: SkillCategory.Exploration,\n                level: 0,\n                experience: 0,\n                maxLevel: 20,\n                description: 'Improves exploration rewards and discovery rates',\n                bonuses: [\n                    { type: 'efficiency', value: 3, description: '+3% discovery rate per level' },\n                    { type: 'detection', value: 2, description: '+2% exploration rewards per level' }\n                ]\n            },\n            {\n                id: 'xenobiology',\n                name: 'Xenobiology',\n                category: SkillCategory.Exploration,\n                level: 0,\n                experience: 0,\n                maxLevel: 15,\n                description: 'Increases rewards from biological discoveries',\n                prerequisite: 'stellar_cartography',\n                prerequisiteLevel: 8,\n                bonuses: [\n                    { type: 'efficiency', value: 5, description: '+5% biological research rewards per level' }\n                ]\n            }\n        ];\n        \n        skills.forEach(skill => {\n            this.character.skills.set(skill.id, skill);\n        });\n    }\n\n    /**\n     * Initialize achievements\n     */\n    private initializeAchievements(): void {\n        const achievements: Achievement[] = [\n            {\n                id: 'first_blood',\n                name: 'First Blood',\n                description: 'Destroy your first enemy ship',\n                category: 'Combat',\n                requirements: [\n                    { type: 'kill_enemies', target: 1, current: 0 }\n                ],\n                rewards: [\n                    { type: 'experience', value: 50 },\n                    { type: 'skill_points', value: 1 }\n                ],\n                unlocked: false,\n                hidden: false\n            },\n            {\n                id: 'ace_pilot',\n                name: 'Ace Pilot',\n                description: 'Destroy 50 enemy ships',\n                category: 'Combat',\n                requirements: [\n                    { type: 'kill_enemies', target: 50, current: 0 }\n                ],\n                rewards: [\n                    { type: 'experience', value: 500 },\n                    { type: 'skill_points', value: 3 }\n                ],\n                unlocked: false,\n                hidden: false\n            },\n            {\n                id: 'explorer',\n                name: 'Explorer',\n                description: 'Discover 10 star systems',\n                category: 'Exploration',\n                requirements: [\n                    { type: 'discover_systems', target: 10, current: 0 }\n                ],\n                rewards: [\n                    { type: 'experience', value: 200 },\n                    { type: 'attribute_points', value: 2 }\n                ],\n                unlocked: false,\n                hidden: false\n            },\n            {\n                id: 'master_craftsman',\n                name: 'Master Craftsman',\n                description: 'Craft 100 items',\n                category: 'Engineering',\n                requirements: [\n                    { type: 'craft_items', target: 100, current: 0 }\n                ],\n                rewards: [\n                    { type: 'experience', value: 300 },\n                    { type: 'skill_points', value: 2 }\n                ],\n                unlocked: false,\n                hidden: false\n            },\n            {\n                id: 'millionaire',\n                name: 'Millionaire',\n                description: 'Earn 1,000,000 credits',\n                category: 'Trade',\n                requirements: [\n                    { type: 'earn_credits', target: 1000000, current: 0 }\n                ],\n                rewards: [\n                    { type: 'experience', value: 1000 },\n                    { type: 'attribute_points', value: 5 }\n                ],\n                unlocked: false,\n                hidden: false\n            },\n            {\n                id: 'long_journey',\n                name: 'Long Journey',\n                description: 'Travel 100,000 kilometers',\n                category: 'Exploration',\n                requirements: [\n                    { type: 'travel_distance', target: 100000, current: 0 }\n                ],\n                rewards: [\n                    { type: 'experience', value: 250 },\n                    { type: 'skill_points', value: 1 }\n                ],\n                unlocked: false,\n                hidden: false\n            }\n        ];\n        \n        achievements.forEach(achievement => {\n            this.character.achievements.set(achievement.id, achievement);\n        });\n    }\n\n    /**\n     * Add experience to character\n     */\n    addExperience(amount: number): void {\n        this.character.experience += amount;\n        \n        // Check for level ups\n        while (this.character.experience >= this.character.experienceToNext) {\n            this.levelUp();\n        }\n        \n        this.logger.debug(`+${amount} XP (Total: ${this.character.experience})`);\n    }\n\n    /**\n     * Level up character\n     */\n    private levelUp(): void {\n        this.character.level++;\n        this.character.experience -= this.character.experienceToNext;\n        \n        // Calculate next level requirement\n        if (this.character.level < this.levelExperienceTable.length) {\n            this.character.experienceToNext = this.levelExperienceTable[this.character.level];\n        } else {\n            this.character.experienceToNext = this.levelExperienceTable[this.levelExperienceTable.length - 1];\n        }\n        \n        // Level rewards\n        const skillPointsGained = this.character.level % 2 === 0 ? 2 : 1; // 2 every even level, 1 every odd\n        const attributePointsGained = this.character.level % 5 === 0 ? 2 : 0; // 2 every 5 levels\n        \n        this.character.skillPoints += skillPointsGained;\n        this.character.attributePoints += attributePointsGained;\n        \n        this.events.onLevelUp?.(this.character.level, {\n            skillPoints: skillPointsGained,\n            attributePoints: attributePointsGained\n        });\n        \n        this.logger.info(`🎉 Level Up! Now level ${this.character.level}`, {\n            skillPoints: skillPointsGained,\n            attributePoints: attributePointsGained\n        });\n    }\n\n    /**\n     * Add skill experience\n     */\n    addSkillExperience(skillId: string, amount: number): void {\n        const skill = this.character.skills.get(skillId);\n        if (!skill || skill.level >= skill.maxLevel) return;\n        \n        skill.experience += amount;\n        \n        // Check for skill level up\n        const requiredXP = this.skillExperienceTable[skill.level] || this.skillExperienceTable[this.skillExperienceTable.length - 1];\n        \n        if (skill.experience >= requiredXP) {\n            skill.level++;\n            skill.experience -= requiredXP;\n            \n            this.events.onSkillLevelUp?.(skill, skill.level);\n            \n            this.logger.info(`📈 Skill Level Up: ${skill.name} → ${skill.level}`);\n        }\n    }\n\n    /**\n     * Spend skill points to level up a skill\n     */\n    levelUpSkill(skillId: string): boolean {\n        const skill = this.character.skills.get(skillId);\n        if (!skill || skill.level >= skill.maxLevel) return false;\n        \n        // Check prerequisites\n        if (skill.prerequisite) {\n            const prereqSkill = this.character.skills.get(skill.prerequisite);\n            if (!prereqSkill || prereqSkill.level < (skill.prerequisiteLevel || 1)) {\n                this.logger.warn(`Prerequisite not met: ${skill.prerequisite} level ${skill.prerequisiteLevel}`);\n                return false;\n            }\n        }\n        \n        // Check skill points\n        const cost = Math.max(1, Math.floor(skill.level / 5) + 1); // Increasing cost\n        if (this.character.skillPoints < cost) {\n            this.logger.warn(`Not enough skill points: need ${cost}, have ${this.character.skillPoints}`);\n            return false;\n        }\n        \n        // Level up skill\n        this.character.skillPoints -= cost;\n        skill.level++;\n        \n        this.events.onSkillLevelUp?.(skill, skill.level);\n        \n        this.logger.info(`💫 Manual skill upgrade: ${skill.name} → ${skill.level} (Cost: ${cost} SP)`);\n        \n        return true;\n    }\n\n    /**\n     * Increase attribute\n     */\n    increaseAttribute(type: AttributeType, amount: number = 1): boolean {\n        const cost = amount * 2; // 2 attribute points per increase\n        if (this.character.attributePoints < cost) {\n            this.logger.warn(`Not enough attribute points: need ${cost}, have ${this.character.attributePoints}`);\n            return false;\n        }\n        \n        const attribute = this.character.attributes.get(type);\n        if (!attribute) return false;\n        \n        const oldValue = attribute.value;\n        attribute.baseValue += amount;\n        this.recalculateAttribute(type);\n        \n        this.character.attributePoints -= cost;\n        \n        this.events.onAttributeChanged?.(type, oldValue, attribute.value);\n        \n        this.logger.info(`⚡ Attribute increased: ${type} → ${attribute.value} (Cost: ${cost} AP)`);\n        \n        return true;\n    }\n\n    /**\n     * Add temporary attribute modifier\n     */\n    addAttributeModifier(type: AttributeType, modifier: AttributeModifier): void {\n        const attribute = this.character.attributes.get(type);\n        if (!attribute) return;\n        \n        attribute.modifiers.push(modifier);\n        this.recalculateAttribute(type);\n        \n        this.logger.debug(`Applied modifier to ${type}: ${modifier.value} from ${modifier.source}`);\n    }\n\n    /**\n     * Remove attribute modifier\n     */\n    removeAttributeModifier(type: AttributeType, source: string): void {\n        const attribute = this.character.attributes.get(type);\n        if (!attribute) return;\n        \n        attribute.modifiers = attribute.modifiers.filter(mod => mod.source !== source);\n        this.recalculateAttribute(type);\n        \n        this.logger.debug(`Removed modifier from ${type}: ${source}`);\n    }\n\n    /**\n     * Recalculate attribute value with modifiers\n     */\n    private recalculateAttribute(type: AttributeType): void {\n        const attribute = this.character.attributes.get(type);\n        if (!attribute) return;\n        \n        const oldValue = attribute.value;\n        attribute.value = attribute.baseValue;\n        \n        // Apply modifiers\n        attribute.modifiers.forEach(mod => {\n            attribute.value += mod.value;\n        });\n        \n        // Minimum value of 1\n        attribute.value = Math.max(1, attribute.value);\n        \n        if (oldValue !== attribute.value) {\n            this.events.onAttributeChanged?.(type, oldValue, attribute.value);\n        }\n    }\n\n    /**\n     * Update achievement progress\n     */\n    updateAchievementProgress(type: string, amount: number, data?: any): void {\n        for (const achievement of this.character.achievements.values()) {\n            if (achievement.unlocked) continue;\n            \n            for (const req of achievement.requirements) {\n                if (req.type === type) {\n                    req.current = Math.min(req.target, req.current + amount);\n                    \n                    // Check if achievement is completed\n                    if (this.isAchievementCompleted(achievement)) {\n                        this.unlockAchievement(achievement.id);\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Check if achievement is completed\n     */\n    private isAchievementCompleted(achievement: Achievement): boolean {\n        return achievement.requirements.every(req => req.current >= req.target);\n    }\n\n    /**\n     * Unlock achievement\n     */\n    private unlockAchievement(achievementId: string): void {\n        const achievement = this.character.achievements.get(achievementId);\n        if (!achievement || achievement.unlocked) return;\n        \n        achievement.unlocked = true;\n        achievement.unlockedDate = Date.now();\n        \n        // Apply rewards\n        achievement.rewards.forEach(reward => {\n            switch (reward.type) {\n                case 'experience':\n                    this.addExperience(reward.value);\n                    break;\n                case 'skill_points':\n                    this.character.skillPoints += reward.value;\n                    break;\n                case 'attribute_points':\n                    this.character.attributePoints += reward.value;\n                    break;\n                case 'credits':\n                    this.character.creditsEarned += reward.value;\n                    break;\n            }\n        });\n        \n        this.events.onAchievementUnlocked?.(achievement);\n        \n        this.logger.info(`🏆 Achievement Unlocked: ${achievement.name}`, {\n            rewards: achievement.rewards\n        });\n    }\n\n    /**\n     * Update character statistics\n     */\n    updateStatistics(stats: {\n        playTime?: number;\n        enemiesDefeated?: number;\n        systemsExplored?: number;\n        distanceTraveled?: number;\n        creditsEarned?: number;\n        itemsCrafted?: number;\n    }): void {\n        if (stats.playTime) this.character.totalPlayTime += stats.playTime;\n        if (stats.enemiesDefeated) {\n            this.character.enemiesDefeated += stats.enemiesDefeated;\n            this.updateAchievementProgress('kill_enemies', stats.enemiesDefeated);\n        }\n        if (stats.systemsExplored) {\n            this.character.systemsExplored += stats.systemsExplored;\n            this.updateAchievementProgress('discover_systems', stats.systemsExplored);\n        }\n        if (stats.distanceTraveled) {\n            this.character.distanceTraveled += stats.distanceTraveled;\n            this.updateAchievementProgress('travel_distance', stats.distanceTraveled);\n        }\n        if (stats.creditsEarned) {\n            this.character.creditsEarned += stats.creditsEarned;\n            this.updateAchievementProgress('earn_credits', stats.creditsEarned);\n        }\n        if (stats.itemsCrafted) {\n            this.character.itemsCrafted += stats.itemsCrafted;\n            this.updateAchievementProgress('craft_items', stats.itemsCrafted);\n        }\n    }\n\n    /**\n     * Get skill bonus value\n     */\n    getSkillBonus(skillId: string, bonusType: string): number {\n        const skill = this.character.skills.get(skillId);\n        if (!skill) return 0;\n        \n        const bonus = skill.bonuses.find(b => b.type === bonusType);\n        if (!bonus) return 0;\n        \n        return bonus.value * skill.level;\n    }\n\n    /**\n     * Get total bonus from all skills of a category\n     */\n    getCategoryBonus(category: SkillCategory, bonusType: string): number {\n        let total = 0;\n        \n        for (const skill of this.character.skills.values()) {\n            if (skill.category === category) {\n                total += this.getSkillBonus(skill.id, bonusType);\n            }\n        }\n        \n        return total;\n    }\n\n    /**\n     * Get attribute value\n     */\n    getAttributeValue(type: AttributeType): number {\n        const attribute = this.character.attributes.get(type);\n        return attribute ? attribute.value : 10;\n    }\n\n    /**\n     * Get character sheet\n     */\n    getCharacterSheet(): CharacterSheet {\n        return { ...this.character };\n    }\n\n    /**\n     * Get available skills for leveling\n     */\n    getAvailableSkills(): Skill[] {\n        return Array.from(this.character.skills.values()).filter(skill => {\n            if (skill.level >= skill.maxLevel) return false;\n            \n            // Check prerequisites\n            if (skill.prerequisite) {\n                const prereqSkill = this.character.skills.get(skill.prerequisite);\n                if (!prereqSkill || prereqSkill.level < (skill.prerequisiteLevel || 1)) {\n                    return false;\n                }\n            }\n            \n            return true;\n        });\n    }\n\n    /**\n     * Get unlocked achievements\n     */\n    getUnlockedAchievements(): Achievement[] {\n        return Array.from(this.character.achievements.values()).filter(a => a.unlocked);\n    }\n\n    /**\n     * Get achievement progress\n     */\n    getAchievementProgress(): Achievement[] {\n        return Array.from(this.character.achievements.values()).filter(a => !a.unlocked && !a.hidden);\n    }\n\n    /**\n     * Save character data\n     */\n    saveCharacter(): any {\n        return {\n            character: {\n                ...this.character,\n                skills: Array.from(this.character.skills.entries()),\n                attributes: Array.from(this.character.attributes.entries()),\n                achievements: Array.from(this.character.achievements.entries())\n            }\n        };\n    }\n\n    /**\n     * Load character data\n     */\n    loadCharacter(data: any): void {\n        if (data.character) {\n            this.character = {\n                ...data.character,\n                skills: new Map(data.character.skills),\n                attributes: new Map(data.character.attributes),\n                achievements: new Map(data.character.achievements)\n            };\n            \n            this.logger.info('📜 Character data loaded', {\n                level: this.character.level,\n                experience: this.character.experience\n            });\n        }\n    }\n\n    /**\n     * Get progression statistics\n     */\n    getProgressionStats(): {\n        totalSkillLevels: number;\n        highestSkillLevel: number;\n        totalAttributePoints: number;\n        achievementsUnlocked: number;\n        totalAchievements: number;\n        progressionPercentage: number;\n    } {\n        const totalSkillLevels = Array.from(this.character.skills.values())\n            .reduce((sum, skill) => sum + skill.level, 0);\n        \n        const highestSkillLevel = Math.max(...Array.from(this.character.skills.values())\n            .map(skill => skill.level));\n        \n        const totalAttributePoints = Array.from(this.character.attributes.values())\n            .reduce((sum, attr) => sum + attr.baseValue, 0);\n        \n        const achievementsUnlocked = Array.from(this.character.achievements.values())\n            .filter(a => a.unlocked).length;\n        \n        const totalAchievements = this.character.achievements.size;\n        \n        const maxSkillLevels = Array.from(this.character.skills.values())\n            .reduce((sum, skill) => sum + skill.maxLevel, 0);\n        \n        const progressionPercentage = Math.min(100, \n            (this.character.level / 50) * 30 + \n            (totalSkillLevels / maxSkillLevels) * 40 + \n            (achievementsUnlocked / totalAchievements) * 30\n        );\n        \n        return {\n            totalSkillLevels,\n            highestSkillLevel,\n            totalAttributePoints,\n            achievementsUnlocked,\n            totalAchievements,\n            progressionPercentage\n        };\n    }\n}","/**\n * Research & Technology System\n * Advanced research tree with technological progression and discoveries\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\nimport { GameItem } from '@items/ItemSystem';\n\nexport enum ResearchField {\n    Physics = 'physics',\n    Engineering = 'engineering',\n    Biology = 'biology',\n    Computing = 'computing',\n    Military = 'military',\n    Exploration = 'exploration'\n}\n\nexport enum TechnologyTier {\n    Basic = 1,\n    Advanced = 2,\n    Expert = 3,\n    Master = 4,\n    Legendary = 5\n}\n\nexport interface Technology {\n    id: string;\n    name: string;\n    description: string;\n    field: ResearchField;\n    tier: TechnologyTier;\n    \n    // Research requirements\n    researchCost: number;\n    researchTime: number; // Base time in seconds\n    prerequisites: string[]; // Required technology IDs\n    \n    // Research resources\n    requiredItems: { itemId: string, quantity: number }[];\n    requiredFacilities: string[];\n    \n    // Unlocks\n    unlocks: TechnologyUnlock[];\n    \n    // Progress\n    isUnlocked: boolean;\n    isResearching: boolean;\n    researchProgress: number;\n    researchStartTime: number;\n    completedTime?: number;\n}\n\nexport interface TechnologyUnlock {\n    type: 'ship_component' | 'weapon' | 'facility' | 'ability' | 'recipe' | 'upgrade';\n    target: string;\n    value?: number;\n    description: string;\n}\n\nexport interface ResearchProject {\n    id: string;\n    technologyId: string;\n    facilityId: string;\n    assignedScientists: string[];\n    startTime: number;\n    estimatedCompletion: number;\n    efficiency: number; // 0-1 multiplier\n    status: 'active' | 'paused' | 'completed' | 'failed';\n}\n\nexport interface ResearchFacility {\n    id: string;\n    name: string;\n    type: 'laboratory' | 'observatory' | 'workshop' | 'computer_core' | 'testing_chamber';\n    efficiency: number; // Research speed multiplier\n    specialization: ResearchField[];\n    maxProjects: number;\n    \n    // Current state\n    isOperational: boolean;\n    currentProjects: string[];\n    maintenanceLevel: number; // 0-1\n    upgradeLevel: number;\n}\n\nexport interface Scientist {\n    id: string;\n    name: string;\n    expertise: ResearchField;\n    skill: number; // 1-10\n    efficiency: number; // Research speed bonus\n    \n    // Current assignment\n    assignedProject?: string;\n    assignedFacility?: string;\n    \n    // Status\n    isAvailable: boolean;\n    fatigue: number; // 0-1, affects efficiency\n    morale: number; // 0-1, affects efficiency\n}\n\nexport interface ResearchEvents {\n    onTechnologyUnlocked?: (technology: Technology) => void;\n    onResearchCompleted?: (project: ResearchProject) => void;\n    onDiscoveryMade?: (discovery: Discovery) => void;\n    onBreakthroughAchieved?: (field: ResearchField, tier: TechnologyTier) => void;\n}\n\nexport interface Discovery {\n    id: string;\n    name: string;\n    description: string;\n    field: ResearchField;\n    rarity: 'common' | 'uncommon' | 'rare' | 'epic' | 'legendary';\n    discoveryTime: number;\n    \n    // Effects\n    researchBonus?: { field: ResearchField, bonus: number };\n    unlocksTechnology?: string;\n    grantsResources?: { itemId: string, quantity: number }[];\n}\n\nexport class ResearchSystem {\n    private technologies: Map<string, Technology> = new Map();\n    private projects: Map<string, ResearchProject> = new Map();\n    private facilities: Map<string, ResearchFacility> = new Map();\n    private scientists: Map<string, Scientist> = new Map();\n    private discoveries: Discovery[] = [];\n    \n    // Research state\n    private totalResearchPoints: number = 0;\n    private researchMultipliers: Map<ResearchField, number> = new Map();\n    \n    private events: ResearchEvents;\n    private logger: Logger;\n\n    constructor(events: ResearchEvents = {}) {\n        this.logger = new Logger('ResearchSystem');\n        this.events = events;\n        \n        this.initializeResearchMultipliers();\n        this.initializeTechnologies();\n        this.initializeFacilities();\n        this.initializeScientists();\n        \n        this.logger.info('🔬 Research system initialized');\n    }\n\n    /**\n     * Initialize research field multipliers\n     */\n    private initializeResearchMultipliers(): void {\n        Object.values(ResearchField).forEach(field => {\n            this.researchMultipliers.set(field, 1.0);\n        });\n    }\n\n    /**\n     * Initialize technology tree\n     */\n    private initializeTechnologies(): void {\n        const technologies: Technology[] = [\n            // Tier 1 - Basic Technologies\n            {\n                id: 'basic_sensors',\n                name: 'Enhanced Sensors',\n                description: 'Improved sensor arrays for better detection range',\n                field: ResearchField.Engineering,\n                tier: TechnologyTier.Basic,\n                researchCost: 100,\n                researchTime: 300, // 5 minutes\n                prerequisites: [],\n                requiredItems: [\n                    { itemId: 'comp_circuit', quantity: 5 },\n                    { itemId: 'crystal_quartz', quantity: 3 }\n                ],\n                requiredFacilities: ['basic_lab'],\n                unlocks: [\n                    { type: 'ship_component', target: 'advanced_sensors', description: 'Unlocks Advanced Sensor Array' },\n                    { type: 'ability', target: 'long_range_scan', description: 'Enables long-range scanning' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            {\n                id: 'improved_hull',\n                name: 'Improved Hull Design',\n                description: 'Stronger hull materials and construction techniques',\n                field: ResearchField.Engineering,\n                tier: TechnologyTier.Basic,\n                researchCost: 150,\n                researchTime: 450,\n                prerequisites: [],\n                requiredItems: [\n                    { itemId: 'metal_iron', quantity: 10 },\n                    { itemId: 'metal_titanium', quantity: 5 }\n                ],\n                requiredFacilities: ['workshop'],\n                unlocks: [\n                    { type: 'upgrade', target: 'hull_strength', value: 25, description: '+25% hull strength' },\n                    { type: 'ship_component', target: 'reinforced_hull', description: 'Unlocks Reinforced Hull Plating' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            {\n                id: 'energy_weapons',\n                name: 'Energy Weapon Technology',\n                description: 'Basic laser and plasma weapon systems',\n                field: ResearchField.Military,\n                tier: TechnologyTier.Basic,\n                researchCost: 200,\n                researchTime: 600,\n                prerequisites: [],\n                requiredItems: [\n                    { itemId: 'energy_antimatter', quantity: 2 },\n                    { itemId: 'comp_circuit', quantity: 8 }\n                ],\n                requiredFacilities: ['basic_lab', 'workshop'],\n                unlocks: [\n                    { type: 'weapon', target: 'plasma_cannon', description: 'Unlocks Plasma Cannon' },\n                    { type: 'upgrade', target: 'energy_efficiency', value: 15, description: '+15% energy weapon efficiency' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            \n            // Tier 2 - Advanced Technologies\n            {\n                id: 'quantum_computing',\n                name: 'Quantum Computing',\n                description: 'Advanced quantum processors for complex calculations',\n                field: ResearchField.Computing,\n                tier: TechnologyTier.Advanced,\n                researchCost: 500,\n                researchTime: 1200,\n                prerequisites: ['basic_sensors'],\n                requiredItems: [\n                    { itemId: 'crystal_dilithium', quantity: 3 },\n                    { itemId: 'comp_quantum_processor', quantity: 1 }\n                ],\n                requiredFacilities: ['computer_core'],\n                unlocks: [\n                    { type: 'facility', target: 'quantum_lab', description: 'Unlocks Quantum Research Lab' },\n                    { type: 'upgrade', target: 'research_speed', value: 30, description: '+30% research speed' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            {\n                id: 'shield_technology',\n                name: 'Advanced Shielding',\n                description: 'Improved shield generators and energy distribution',\n                field: ResearchField.Physics,\n                tier: TechnologyTier.Advanced,\n                researchCost: 400,\n                researchTime: 900,\n                prerequisites: ['improved_hull', 'energy_weapons'],\n                requiredItems: [\n                    { itemId: 'comp_shield_emitter', quantity: 3 },\n                    { itemId: 'energy_antimatter', quantity: 5 }\n                ],\n                requiredFacilities: ['testing_chamber'],\n                unlocks: [\n                    { type: 'ship_component', target: 'adaptive_shields', description: 'Unlocks Adaptive Shield Matrix' },\n                    { type: 'upgrade', target: 'shield_capacity', value: 40, description: '+40% shield capacity' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            {\n                id: 'warp_optimization',\n                name: 'Warp Drive Optimization',\n                description: 'Improved warp field stability and efficiency',\n                field: ResearchField.Physics,\n                tier: TechnologyTier.Advanced,\n                researchCost: 600,\n                researchTime: 1500,\n                prerequisites: ['quantum_computing'],\n                requiredItems: [\n                    { itemId: 'crystal_dilithium', quantity: 8 },\n                    { itemId: 'comp_warp_coil', quantity: 2 }\n                ],\n                requiredFacilities: ['observatory'],\n                unlocks: [\n                    { type: 'upgrade', target: 'warp_efficiency', value: 25, description: '+25% warp efficiency' },\n                    { type: 'ability', target: 'emergency_warp', description: 'Enables emergency warp escape' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            \n            // Tier 3 - Expert Technologies\n            {\n                id: 'artificial_intelligence',\n                name: 'Artificial Intelligence',\n                description: 'Advanced AI systems for ship automation',\n                field: ResearchField.Computing,\n                tier: TechnologyTier.Expert,\n                researchCost: 1000,\n                researchTime: 2400,\n                prerequisites: ['quantum_computing', 'shield_technology'],\n                requiredItems: [\n                    { itemId: 'comp_ai_core', quantity: 1 },\n                    { itemId: 'crystal_dilithium', quantity: 10 }\n                ],\n                requiredFacilities: ['quantum_lab'],\n                unlocks: [\n                    { type: 'ship_component', target: 'ai_assistant', description: 'Unlocks AI Ship Assistant' },\n                    { type: 'upgrade', target: 'automation_efficiency', value: 50, description: '+50% system automation' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            {\n                id: 'exotic_matter',\n                name: 'Exotic Matter Research',\n                description: 'Studies of exotic matter and its applications',\n                field: ResearchField.Physics,\n                tier: TechnologyTier.Expert,\n                researchCost: 1200,\n                researchTime: 3000,\n                prerequisites: ['warp_optimization'],\n                requiredItems: [\n                    { itemId: 'exotic_dark_matter', quantity: 3 },\n                    { itemId: 'comp_containment_field', quantity: 2 }\n                ],\n                requiredFacilities: ['testing_chamber', 'quantum_lab'],\n                unlocks: [\n                    { type: 'weapon', target: 'exotic_weapons', description: 'Unlocks Exotic Matter Weapons' },\n                    { type: 'ability', target: 'phase_shift', description: 'Enables temporary phase shifting' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            \n            // Tier 4 - Master Technologies\n            {\n                id: 'consciousness_transfer',\n                name: 'Consciousness Transfer',\n                description: 'Technology to transfer consciousness between vessels',\n                field: ResearchField.Biology,\n                tier: TechnologyTier.Master,\n                researchCost: 2000,\n                researchTime: 4800,\n                prerequisites: ['artificial_intelligence', 'exotic_matter'],\n                requiredItems: [\n                    { itemId: 'bio_neural_matrix', quantity: 1 },\n                    { itemId: 'comp_ai_core', quantity: 3 }\n                ],\n                requiredFacilities: ['quantum_lab', 'bio_lab'],\n                unlocks: [\n                    { type: 'ability', target: 'backup_consciousness', description: 'Enables consciousness backup' },\n                    { type: 'ship_component', target: 'neural_interface', description: 'Direct neural ship control' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            },\n            \n            // Tier 5 - Legendary Technologies\n            {\n                id: 'reality_manipulation',\n                name: 'Reality Manipulation',\n                description: 'Ultimate technology to alter space-time itself',\n                field: ResearchField.Physics,\n                tier: TechnologyTier.Legendary,\n                researchCost: 5000,\n                researchTime: 10000,\n                prerequisites: ['consciousness_transfer'],\n                requiredItems: [\n                    { itemId: 'artifact_singularity_core', quantity: 1 },\n                    { itemId: 'exotic_temporal_crystal', quantity: 5 }\n                ],\n                requiredFacilities: ['quantum_lab', 'testing_chamber', 'observatory'],\n                unlocks: [\n                    { type: 'ability', target: 'time_dilation', description: 'Manipulate local time flow' },\n                    { type: 'ability', target: 'space_folding', description: 'Fold space for instant travel' }\n                ],\n                isUnlocked: false,\n                isResearching: false,\n                researchProgress: 0,\n                researchStartTime: 0\n            }\n        ];\n        \n        technologies.forEach(tech => {\n            this.technologies.set(tech.id, tech);\n        });\n    }\n\n    /**\n     * Initialize research facilities\n     */\n    private initializeFacilities(): void {\n        const facilities: ResearchFacility[] = [\n            {\n                id: 'basic_lab',\n                name: 'Basic Laboratory',\n                type: 'laboratory',\n                efficiency: 1.0,\n                specialization: [ResearchField.Engineering, ResearchField.Computing],\n                maxProjects: 1,\n                isOperational: true,\n                currentProjects: [],\n                maintenanceLevel: 1.0,\n                upgradeLevel: 1\n            },\n            {\n                id: 'workshop',\n                name: 'Engineering Workshop',\n                type: 'workshop',\n                efficiency: 1.2,\n                specialization: [ResearchField.Engineering, ResearchField.Military],\n                maxProjects: 2,\n                isOperational: true,\n                currentProjects: [],\n                maintenanceLevel: 1.0,\n                upgradeLevel: 1\n            },\n            {\n                id: 'computer_core',\n                name: 'Computer Core',\n                type: 'computer_core',\n                efficiency: 1.5,\n                specialization: [ResearchField.Computing],\n                maxProjects: 1,\n                isOperational: true,\n                currentProjects: [],\n                maintenanceLevel: 1.0,\n                upgradeLevel: 1\n            }\n        ];\n        \n        facilities.forEach(facility => {\n            this.facilities.set(facility.id, facility);\n        });\n    }\n\n    /**\n     * Initialize scientists\n     */\n    private initializeScientists(): void {\n        const scientists: Scientist[] = [\n            {\n                id: 'dr_smith',\n                name: 'Dr. Sarah Smith',\n                expertise: ResearchField.Engineering,\n                skill: 7,\n                efficiency: 1.2,\n                isAvailable: true,\n                fatigue: 0,\n                morale: 0.8\n            },\n            {\n                id: 'prof_chen',\n                name: 'Prof. Wei Chen',\n                expertise: ResearchField.Physics,\n                skill: 8,\n                efficiency: 1.3,\n                isAvailable: true,\n                fatigue: 0,\n                morale: 0.9\n            },\n            {\n                id: 'dr_ivanov',\n                name: 'Dr. Viktor Ivanov',\n                expertise: ResearchField.Computing,\n                skill: 6,\n                efficiency: 1.1,\n                isAvailable: true,\n                fatigue: 0,\n                morale: 0.7\n            }\n        ];\n        \n        scientists.forEach(scientist => {\n            this.scientists.set(scientist.id, scientist);\n        });\n    }\n\n    /**\n     * Start research project\n     */\n    startResearch(technologyId: string, facilityId: string, scientistIds: string[] = []): boolean {\n        const technology = this.technologies.get(technologyId);\n        const facility = this.facilities.get(facilityId);\n        \n        if (!technology || !facility) {\n            this.logger.warn('Invalid technology or facility for research', { technologyId, facilityId });\n            return false;\n        }\n        \n        // Check if technology is available for research\n        if (technology.isUnlocked || technology.isResearching) {\n            this.logger.warn('Technology already unlocked or being researched', { technologyId });\n            return false;\n        }\n        \n        // Check prerequisites\n        for (const prereq of technology.prerequisites) {\n            const prereqTech = this.technologies.get(prereq);\n            if (!prereqTech || !prereqTech.isUnlocked) {\n                this.logger.warn('Prerequisites not met', { technologyId, missingPrereq: prereq });\n                return false;\n            }\n        }\n        \n        // Check facility availability\n        if (facility.currentProjects.length >= facility.maxProjects) {\n            this.logger.warn('Facility at capacity', { facilityId });\n            return false;\n        }\n        \n        // Check facility specialization\n        if (facility.specialization.length > 0 && !facility.specialization.includes(technology.field)) {\n            this.logger.warn('Facility not specialized for this research field', { \n                facilityId, \n                field: technology.field, \n                specializations: facility.specialization \n            });\n            return false;\n        }\n        \n        // Validate and assign scientists\n        const validScientists: string[] = [];\n        for (const scientistId of scientistIds) {\n            const scientist = this.scientists.get(scientistId);\n            if (scientist && scientist.isAvailable) {\n                validScientists.push(scientistId);\n                scientist.isAvailable = false;\n                scientist.assignedProject = technologyId;\n                scientist.assignedFacility = facilityId;\n            }\n        }\n        \n        // Calculate research efficiency\n        let efficiency = facility.efficiency * facility.maintenanceLevel;\n        \n        // Add scientist bonuses\n        validScientists.forEach(scientistId => {\n            const scientist = this.scientists.get(scientistId);\n            if (scientist) {\n                let scientistBonus = scientist.efficiency * scientist.morale * (1 - scientist.fatigue);\n                \n                // Expertise bonus\n                if (scientist.expertise === technology.field) {\n                    scientistBonus *= 1.5;\n                }\n                \n                efficiency += scientistBonus;\n            }\n        });\n        \n        // Apply research field multipliers\n        const fieldMultiplier = this.researchMultipliers.get(technology.field) || 1.0;\n        efficiency *= fieldMultiplier;\n        \n        // Calculate estimated completion time\n        const baseTime = technology.researchTime;\n        const estimatedTime = baseTime / efficiency;\n        \n        // Create research project\n        const projectId = `project_${technologyId}_${Date.now()}`;\n        const project: ResearchProject = {\n            id: projectId,\n            technologyId,\n            facilityId,\n            assignedScientists: validScientists,\n            startTime: Date.now(),\n            estimatedCompletion: Date.now() + estimatedTime * 1000,\n            efficiency,\n            status: 'active'\n        };\n        \n        this.projects.set(projectId, project);\n        facility.currentProjects.push(projectId);\n        technology.isResearching = true;\n        technology.researchStartTime = Date.now();\n        \n        this.logger.info(`🔬 Research started: ${technology.name}`, {\n            facility: facility.name,\n            scientists: validScientists.length,\n            efficiency: efficiency.toFixed(2),\n            estimatedHours: (estimatedTime / 3600).toFixed(1)\n        });\n        \n        return true;\n    }\n\n    /**\n     * Update research progress\n     */\n    update(deltaTime: number): void {\n        const currentTime = Date.now();\n        \n        for (const project of this.projects.values()) {\n            if (project.status !== 'active') continue;\n            \n            const technology = this.technologies.get(project.technologyId);\n            if (!technology) continue;\n            \n            // Calculate progress\n            const elapsed = currentTime - project.startTime;\n            const totalDuration = project.estimatedCompletion - project.startTime;\n            const progress = Math.min(1.0, elapsed / totalDuration);\n            \n            technology.researchProgress = progress;\n            \n            // Check for completion\n            if (progress >= 1.0) {\n                this.completeResearch(project.id);\n            } else {\n                // Update scientist fatigue\n                project.assignedScientists.forEach(scientistId => {\n                    const scientist = this.scientists.get(scientistId);\n                    if (scientist) {\n                        scientist.fatigue = Math.min(1.0, scientist.fatigue + deltaTime * 0.0001); // Gradual fatigue\n                    }\n                });\n            }\n        }\n        \n        // Random discovery chances\n        if (Math.random() < 0.001) { // 0.1% chance per update\n            this.makeRandomDiscovery();\n        }\n    }\n\n    /**\n     * Complete research project\n     */\n    private completeResearch(projectId: string): void {\n        const project = this.projects.get(projectId);\n        if (!project) return;\n        \n        const technology = this.technologies.get(project.technologyId);\n        const facility = this.facilities.get(project.facilityId);\n        \n        if (!technology || !facility) return;\n        \n        // Mark technology as unlocked\n        technology.isUnlocked = true;\n        technology.isResearching = false;\n        technology.researchProgress = 1.0;\n        technology.completedTime = Date.now();\n        \n        // Free up scientists\n        project.assignedScientists.forEach(scientistId => {\n            const scientist = this.scientists.get(scientistId);\n            if (scientist) {\n                scientist.isAvailable = true;\n                scientist.assignedProject = undefined;\n                scientist.assignedFacility = undefined;\n                scientist.morale = Math.min(1.0, scientist.morale + 0.1); // Boost morale on success\n            }\n        });\n        \n        // Remove project from facility\n        facility.currentProjects = facility.currentProjects.filter(id => id !== projectId);\n        \n        // Mark project as completed\n        project.status = 'completed';\n        \n        // Award research points\n        this.totalResearchPoints += technology.researchCost;\n        \n        // Apply technology unlocks\n        this.applyTechnologyUnlocks(technology);\n        \n        this.events.onTechnologyUnlocked?.(technology);\n        this.events.onResearchCompleted?.(project);\n        \n        this.logger.info(`🎉 Research completed: ${technology.name}`, {\n            duration: ((Date.now() - project.startTime) / 1000 / 60).toFixed(1) + ' minutes',\n            unlocks: technology.unlocks.length\n        });\n        \n        // Check for breakthrough achievements\n        const tierCount = this.getTierUnlockCount(technology.field, technology.tier);\n        if (tierCount === 1) { // First technology of this tier in this field\n            this.events.onBreakthroughAchieved?.(technology.field, technology.tier);\n        }\n    }\n\n    /**\n     * Apply technology unlocks\n     */\n    private applyTechnologyUnlocks(technology: Technology): void {\n        technology.unlocks.forEach(unlock => {\n            switch (unlock.type) {\n                case 'facility':\n                    this.unlockFacility(unlock.target);\n                    break;\n                case 'upgrade':\n                    this.applyUpgrade(unlock.target, unlock.value || 0);\n                    break;\n                case 'ability':\n                    this.unlockAbility(unlock.target);\n                    break;\n                case 'recipe':\n                    this.unlockRecipe(unlock.target);\n                    break;\n            }\n        });\n    }\n\n    /**\n     * Unlock new research facility\n     */\n    private unlockFacility(facilityType: string): void {\n        const facilityConfigs: { [key: string]: Partial<ResearchFacility> } = {\n            quantum_lab: {\n                name: 'Quantum Research Lab',\n                type: 'laboratory',\n                efficiency: 2.0,\n                specialization: [ResearchField.Physics, ResearchField.Computing],\n                maxProjects: 2\n            },\n            bio_lab: {\n                name: 'Biological Research Lab',\n                type: 'laboratory',\n                efficiency: 1.8,\n                specialization: [ResearchField.Biology],\n                maxProjects: 1\n            },\n            testing_chamber: {\n                name: 'Testing Chamber',\n                type: 'testing_chamber',\n                efficiency: 1.5,\n                specialization: [ResearchField.Military, ResearchField.Engineering],\n                maxProjects: 3\n            },\n            observatory: {\n                name: 'Deep Space Observatory',\n                type: 'observatory',\n                efficiency: 1.6,\n                specialization: [ResearchField.Exploration, ResearchField.Physics],\n                maxProjects: 1\n            }\n        };\n        \n        const config = facilityConfigs[facilityType];\n        if (config) {\n            const facilityId = `${facilityType}_${Date.now()}`;\n            const facility: ResearchFacility = {\n                id: facilityId,\n                name: config.name || facilityType,\n                type: config.type || 'laboratory',\n                efficiency: config.efficiency || 1.0,\n                specialization: config.specialization || [],\n                maxProjects: config.maxProjects || 1,\n                isOperational: true,\n                currentProjects: [],\n                maintenanceLevel: 1.0,\n                upgradeLevel: 1\n            };\n            \n            this.facilities.set(facilityId, facility);\n            this.logger.info(`🏗️ New facility unlocked: ${facility.name}`);\n        }\n    }\n\n    /**\n     * Apply research upgrade\n     */\n    private applyUpgrade(upgradeType: string, value: number): void {\n        switch (upgradeType) {\n            case 'research_speed':\n                Object.values(ResearchField).forEach(field => {\n                    const current = this.researchMultipliers.get(field) || 1.0;\n                    this.researchMultipliers.set(field, current * (1 + value / 100));\n                });\n                break;\n            case 'hull_strength':\n            case 'shield_capacity':\n            case 'warp_efficiency':\n                // These would be applied to ship systems\n                this.logger.info(`⚡ Upgrade applied: ${upgradeType} +${value}%`);\n                break;\n        }\n    }\n\n    /**\n     * Unlock new ability\n     */\n    private unlockAbility(abilityId: string): void {\n        this.logger.info(`🌟 New ability unlocked: ${abilityId}`);\n    }\n\n    /**\n     * Unlock new recipe\n     */\n    private unlockRecipe(recipeId: string): void {\n        this.logger.info(`📋 New recipe unlocked: ${recipeId}`);\n    }\n\n    /**\n     * Make random discovery\n     */\n    private makeRandomDiscovery(): void {\n        const discoveries = [\n            {\n                name: 'Quantum Fluctuation Anomaly',\n                field: ResearchField.Physics,\n                rarity: 'rare' as const,\n                researchBonus: { field: ResearchField.Physics, bonus: 0.1 }\n            },\n            {\n                name: 'Exotic Particle Traces',\n                field: ResearchField.Physics,\n                rarity: 'uncommon' as const,\n                grantsResources: [{ itemId: 'exotic_dark_matter', quantity: 1 }]\n            },\n            {\n                name: 'Ancient Data Fragment',\n                field: ResearchField.Computing,\n                rarity: 'epic' as const,\n                unlocksTechnology: 'artificial_intelligence'\n            },\n            {\n                name: 'Biological Adaptation Pattern',\n                field: ResearchField.Biology,\n                rarity: 'common' as const,\n                researchBonus: { field: ResearchField.Biology, bonus: 0.05 }\n            }\n        ];\n        \n        const discovery = discoveries[Math.floor(Math.random() * discoveries.length)];\n        const discoveryObj: Discovery = {\n            id: `discovery_${Date.now()}`,\n            name: discovery.name,\n            description: `A ${discovery.rarity} discovery in ${discovery.field}`,\n            field: discovery.field,\n            rarity: discovery.rarity,\n            discoveryTime: Date.now(),\n            researchBonus: discovery.researchBonus,\n            unlocksTechnology: discovery.unlocksTechnology,\n            grantsResources: discovery.grantsResources\n        };\n        \n        this.discoveries.push(discoveryObj);\n        \n        // Apply discovery effects\n        if (discoveryObj.researchBonus) {\n            const current = this.researchMultipliers.get(discoveryObj.researchBonus.field) || 1.0;\n            this.researchMultipliers.set(discoveryObj.researchBonus.field, current + discoveryObj.researchBonus.bonus);\n        }\n        \n        this.events.onDiscoveryMade?.(discoveryObj);\n        \n        this.logger.info(`🔍 Discovery made: ${discoveryObj.name}`, {\n            field: discoveryObj.field,\n            rarity: discoveryObj.rarity\n        });\n    }\n\n    /**\n     * Get available technologies for research\n     */\n    getAvailableTechnologies(): Technology[] {\n        return Array.from(this.technologies.values()).filter(tech => {\n            if (tech.isUnlocked || tech.isResearching) return false;\n            \n            // Check prerequisites\n            return tech.prerequisites.every(prereqId => {\n                const prereq = this.technologies.get(prereqId);\n                return prereq && prereq.isUnlocked;\n            });\n        });\n    }\n\n    /**\n     * Get active research projects\n     */\n    getActiveProjects(): ResearchProject[] {\n        return Array.from(this.projects.values()).filter(p => p.status === 'active');\n    }\n\n    /**\n     * Get unlocked technologies\n     */\n    getUnlockedTechnologies(): Technology[] {\n        return Array.from(this.technologies.values()).filter(tech => tech.isUnlocked);\n    }\n\n    /**\n     * Get technology by ID\n     */\n    getTechnology(technologyId: string): Technology | null {\n        return this.technologies.get(technologyId) || null;\n    }\n\n    /**\n     * Get all facilities\n     */\n    getFacilities(): ResearchFacility[] {\n        return Array.from(this.facilities.values());\n    }\n\n    /**\n     * Get available scientists\n     */\n    getAvailableScientists(): Scientist[] {\n        return Array.from(this.scientists.values()).filter(s => s.isAvailable);\n    }\n\n    /**\n     * Get recent discoveries\n     */\n    getRecentDiscoveries(limit: number = 10): Discovery[] {\n        return this.discoveries\n            .sort((a, b) => b.discoveryTime - a.discoveryTime)\n            .slice(0, limit);\n    }\n\n    /**\n     * Get tier unlock count for field\n     */\n    private getTierUnlockCount(field: ResearchField, tier: TechnologyTier): number {\n        return Array.from(this.technologies.values())\n            .filter(tech => tech.field === field && tech.tier === tier && tech.isUnlocked)\n            .length;\n    }\n\n    /**\n     * Get research statistics\n     */\n    getResearchStats(): {\n        totalTechnologies: number;\n        unlockedTechnologies: number;\n        activeProjects: number;\n        totalResearchPoints: number;\n        discoveries: number;\n        facilities: number;\n        scientists: number;\n        fieldProgress: { [field: string]: { unlocked: number, total: number } };\n    } {\n        const fieldProgress: { [field: string]: { unlocked: number, total: number } } = {};\n        \n        Object.values(ResearchField).forEach(field => {\n            const technologies = Array.from(this.technologies.values()).filter(tech => tech.field === field);\n            const unlocked = technologies.filter(tech => tech.isUnlocked).length;\n            fieldProgress[field] = { unlocked, total: technologies.length };\n        });\n        \n        return {\n            totalTechnologies: this.technologies.size,\n            unlockedTechnologies: Array.from(this.technologies.values()).filter(tech => tech.isUnlocked).length,\n            activeProjects: Array.from(this.projects.values()).filter(p => p.status === 'active').length,\n            totalResearchPoints: this.totalResearchPoints,\n            discoveries: this.discoveries.length,\n            facilities: this.facilities.size,\n            scientists: this.scientists.size,\n            fieldProgress\n        };\n    }\n\n    /**\n     * Cancel research project\n     */\n    cancelResearch(projectId: string): boolean {\n        const project = this.projects.get(projectId);\n        if (!project || project.status !== 'active') return false;\n        \n        const technology = this.technologies.get(project.technologyId);\n        const facility = this.facilities.get(project.facilityId);\n        \n        if (technology) {\n            technology.isResearching = false;\n            technology.researchProgress = 0;\n        }\n        \n        if (facility) {\n            facility.currentProjects = facility.currentProjects.filter(id => id !== projectId);\n        }\n        \n        // Free scientists\n        project.assignedScientists.forEach(scientistId => {\n            const scientist = this.scientists.get(scientistId);\n            if (scientist) {\n                scientist.isAvailable = true;\n                scientist.assignedProject = undefined;\n                scientist.assignedFacility = undefined;\n            }\n        });\n        \n        project.status = 'failed';\n        \n        this.logger.info(`❌ Research cancelled: ${project.technologyId}`);\n        \n        return true;\n    }\n\n    /**\n     * Save research data\n     */\n    saveResearchData(): any {\n        return {\n            technologies: Array.from(this.technologies.entries()),\n            projects: Array.from(this.projects.entries()),\n            facilities: Array.from(this.facilities.entries()),\n            scientists: Array.from(this.scientists.entries()),\n            discoveries: this.discoveries,\n            totalResearchPoints: this.totalResearchPoints,\n            researchMultipliers: Array.from(this.researchMultipliers.entries())\n        };\n    }\n\n    /**\n     * Load research data\n     */\n    loadResearchData(data: any): void {\n        if (data.technologies) {\n            this.technologies = new Map(data.technologies);\n        }\n        if (data.projects) {\n            this.projects = new Map(data.projects);\n        }\n        if (data.facilities) {\n            this.facilities = new Map(data.facilities);\n        }\n        if (data.scientists) {\n            this.scientists = new Map(data.scientists);\n        }\n        if (data.discoveries) {\n            this.discoveries = data.discoveries;\n        }\n        if (data.totalResearchPoints) {\n            this.totalResearchPoints = data.totalResearchPoints;\n        }\n        if (data.researchMultipliers) {\n            this.researchMultipliers = new Map(data.researchMultipliers);\n        }\n        \n        this.logger.info('🔬 Research data loaded', {\n            technologies: this.technologies.size,\n            projects: this.projects.size\n        });\n    }\n}","/**\n * Crew Management System\n * Advanced crew mechanics with skills, assignments, morale, and ship operations\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\nimport { SkillCategory } from './PlayerProgression';\n\nexport enum CrewRole {\n    Captain = 'captain',\n    Pilot = 'pilot',\n    Engineer = 'engineer',\n    Scientist = 'scientist',\n    Security = 'security',\n    Medic = 'medic',\n    Communications = 'communications',\n    Navigator = 'navigator'\n}\n\nexport enum ShipStation {\n    Bridge = 'bridge',\n    Engineering = 'engineering',\n    MedBay = 'medbay',\n    ScienceLab = 'science_lab',\n    WeaponsControl = 'weapons_control',\n    Navigation = 'navigation',\n    Communications = 'communications',\n    Recreation = 'recreation'\n}\n\nexport enum CrewSkill {\n    Leadership = 'leadership',\n    Piloting = 'piloting',\n    Engineering = 'engineering',\n    Science = 'science',\n    Combat = 'combat',\n    Medicine = 'medicine',\n    Communications = 'communications',\n    Navigation = 'navigation'\n}\n\nexport interface CrewMember {\n    id: string;\n    name: string;\n    role: CrewRole;\n    species: string;\n    age: number;\n    \n    // Skills (0-100)\n    skills: Map<CrewSkill, number>;\n    \n    // Status\n    health: number; // 0-100\n    morale: number; // 0-100\n    fatigue: number; // 0-100\n    stress: number; // 0-100\n    \n    // Assignment\n    currentStation?: ShipStation;\n    assignedDuty?: string;\n    workEfficiency: number; // 0-2 multiplier\n    \n    // Personality traits\n    traits: CrewTrait[];\n    preferences: CrewPreferences;\n    relationships: Map<string, number>; // Other crew member ID -> relationship (-100 to 100)\n    \n    // Career\n    experience: number;\n    rank: number; // 1-10\n    specializations: string[];\n    commendations: string[];\n    \n    // Biography\n    background: string;\n    homeworld: string;\n    joinDate: number;\n}\n\nexport interface CrewTrait {\n    id: string;\n    name: string;\n    description: string;\n    effects: TraitEffect[];\n    rarity: 'common' | 'uncommon' | 'rare' | 'legendary';\n}\n\nexport interface TraitEffect {\n    type: 'skill_bonus' | 'morale_bonus' | 'stress_resistance' | 'efficiency_bonus' | 'relationship_modifier';\n    target?: CrewSkill | 'all';\n    value: number;\n    condition?: string;\n}\n\nexport interface CrewPreferences {\n    preferredStation: ShipStation;\n    preferredShift: 'alpha' | 'beta' | 'gamma';\n    personalityType: 'introvert' | 'extrovert' | 'ambivert';\n    workStyle: 'methodical' | 'creative' | 'aggressive' | 'collaborative';\n}\n\nexport interface StationAssignment {\n    stationId: ShipStation;\n    assignedCrew: string[];\n    maxCrew: number;\n    requiredSkills: CrewSkill[];\n    efficiency: number; // Based on crew performance\n    status: 'operational' | 'understaffed' | 'overstaffed' | 'unmanned';\n}\n\nexport interface CrewEvent {\n    id: string;\n    type: 'conflict' | 'romance' | 'achievement' | 'injury' | 'discovery' | 'promotion';\n    involvedCrew: string[];\n    description: string;\n    effects: { crewId: string, effect: string, value: number }[];\n    timestamp: number;\n    resolved: boolean;\n}\n\nexport interface CrewManagementEvents {\n    onCrewJoined?: (crew: CrewMember) => void;\n    onCrewLeft?: (crew: CrewMember, reason: string) => void;\n    onCrewPromoted?: (crew: CrewMember, newRank: number) => void;\n    onCrewEvent?: (event: CrewEvent) => void;\n    onStationEfficiencyChanged?: (station: ShipStation, efficiency: number) => void;\n    onMoraleAlert?: (averageMorale: number) => void;\n}\n\nexport class CrewManagement {\n    private crew: Map<string, CrewMember> = new Map();\n    private stations: Map<ShipStation, StationAssignment> = new Map();\n    private events: CrewEvent[] = [];\n    private traits: Map<string, CrewTrait> = new Map();\n    \n    // Ship-wide status\n    private shipMorale: number = 75;\n    private disciplineLevel: number = 80;\n    private crewQuarters: number = 10; // Maximum crew capacity\n    \n    private managementEvents: CrewManagementEvents;\n    private logger: Logger;\n\n    constructor(events: CrewManagementEvents = {}) {\n        this.logger = new Logger('CrewManagement');\n        this.managementEvents = events;\n        \n        this.initializeTraits();\n        this.initializeStations();\n        this.initializeStartingCrew();\n        \n        this.logger.info('👥 Crew management system initialized');\n    }\n\n    /**\n     * Initialize crew traits\n     */\n    private initializeTraits(): void {\n        const traits: CrewTrait[] = [\n            {\n                id: 'veteran',\n                name: 'Veteran',\n                description: 'Experienced crew member with enhanced skills',\n                effects: [\n                    { type: 'skill_bonus', target: 'all', value: 10 },\n                    { type: 'stress_resistance', value: 25 }\n                ],\n                rarity: 'uncommon'\n            },\n            {\n                id: 'natural_leader',\n                name: 'Natural Leader',\n                description: 'Inspires confidence in fellow crew members',\n                effects: [\n                    { type: 'skill_bonus', target: CrewSkill.Leadership, value: 20 },\n                    { type: 'morale_bonus', value: 10 }\n                ],\n                rarity: 'rare'\n            },\n            {\n                id: 'genius',\n                name: 'Genius',\n                description: 'Exceptional intellectual capabilities',\n                effects: [\n                    { type: 'skill_bonus', target: CrewSkill.Science, value: 30 },\n                    { type: 'efficiency_bonus', value: 50 }\n                ],\n                rarity: 'legendary'\n            },\n            {\n                id: 'ace_pilot',\n                name: 'Ace Pilot',\n                description: 'Exceptional piloting skills',\n                effects: [\n                    { type: 'skill_bonus', target: CrewSkill.Piloting, value: 25 },\n                    { type: 'efficiency_bonus', value: 30 }\n                ],\n                rarity: 'rare'\n            },\n            {\n                id: 'workaholic',\n                name: 'Workaholic',\n                description: 'Works longer without fatigue',\n                effects: [\n                    { type: 'efficiency_bonus', value: 20 },\n                    { type: 'stress_resistance', value: -10 }\n                ],\n                rarity: 'common'\n            },\n            {\n                id: 'diplomatic',\n                name: 'Diplomatic',\n                description: 'Excellent at resolving conflicts',\n                effects: [\n                    { type: 'relationship_modifier', value: 15 },\n                    { type: 'skill_bonus', target: CrewSkill.Communications, value: 15 }\n                ],\n                rarity: 'uncommon'\n            },\n            {\n                id: 'combat_veteran',\n                name: 'Combat Veteran',\n                description: 'Experienced in combat situations',\n                effects: [\n                    { type: 'skill_bonus', target: CrewSkill.Combat, value: 20 },\n                    { type: 'stress_resistance', value: 20 }\n                ],\n                rarity: 'uncommon'\n            },\n            {\n                id: 'perfectionist',\n                name: 'Perfectionist',\n                description: 'Produces higher quality work but slower',\n                effects: [\n                    { type: 'efficiency_bonus', value: 25 },\n                    { type: 'stress_resistance', value: -15 }\n                ],\n                rarity: 'common'\n            }\n        ];\n        \n        traits.forEach(trait => {\n            this.traits.set(trait.id, trait);\n        });\n    }\n\n    /**\n     * Initialize ship stations\n     */\n    private initializeStations(): void {\n        const stationConfigs: Array<{\n            station: ShipStation,\n            maxCrew: number,\n            requiredSkills: CrewSkill[]\n        }> = [\n            {\n                station: ShipStation.Bridge,\n                maxCrew: 3,\n                requiredSkills: [CrewSkill.Leadership, CrewSkill.Navigation]\n            },\n            {\n                station: ShipStation.Engineering,\n                maxCrew: 4,\n                requiredSkills: [CrewSkill.Engineering]\n            },\n            {\n                station: ShipStation.MedBay,\n                maxCrew: 2,\n                requiredSkills: [CrewSkill.Medicine]\n            },\n            {\n                station: ShipStation.ScienceLab,\n                maxCrew: 3,\n                requiredSkills: [CrewSkill.Science]\n            },\n            {\n                station: ShipStation.WeaponsControl,\n                maxCrew: 2,\n                requiredSkills: [CrewSkill.Combat]\n            },\n            {\n                station: ShipStation.Navigation,\n                maxCrew: 2,\n                requiredSkills: [CrewSkill.Navigation, CrewSkill.Piloting]\n            },\n            {\n                station: ShipStation.Communications,\n                maxCrew: 1,\n                requiredSkills: [CrewSkill.Communications]\n            },\n            {\n                station: ShipStation.Recreation,\n                maxCrew: 1,\n                requiredSkills: []\n            }\n        ];\n        \n        stationConfigs.forEach(config => {\n            this.stations.set(config.station, {\n                stationId: config.station,\n                assignedCrew: [],\n                maxCrew: config.maxCrew,\n                requiredSkills: config.requiredSkills,\n                efficiency: 0,\n                status: 'unmanned'\n            });\n        });\n    }\n\n    /**\n     * Initialize starting crew\n     */\n    private initializeStartingCrew(): void {\n        const startingCrew = [\n            {\n                name: 'Commander Sarah Cross',\n                role: CrewRole.Captain,\n                species: 'Human',\n                skills: new Map([\n                    [CrewSkill.Leadership, 85],\n                    [CrewSkill.Navigation, 70],\n                    [CrewSkill.Combat, 60]\n                ]),\n                traits: ['natural_leader'],\n                preferredStation: ShipStation.Bridge\n            },\n            {\n                name: 'Lieutenant Marcus Reid',\n                role: CrewRole.Pilot,\n                species: 'Human',\n                skills: new Map([\n                    [CrewSkill.Piloting, 90],\n                    [CrewSkill.Navigation, 75],\n                    [CrewSkill.Engineering, 45]\n                ]),\n                traits: ['ace_pilot'],\n                preferredStation: ShipStation.Navigation\n            },\n            {\n                name: 'Chief Engineer Zara Voss',\n                role: CrewRole.Engineer,\n                species: 'Centaurian',\n                skills: new Map([\n                    [CrewSkill.Engineering, 88],\n                    [CrewSkill.Science, 65],\n                    [CrewSkill.Combat, 30]\n                ]),\n                traits: ['perfectionist'],\n                preferredStation: ShipStation.Engineering\n            },\n            {\n                name: 'Dr. Elena Vasquez',\n                role: CrewRole.Medic,\n                species: 'Human',\n                skills: new Map([\n                    [CrewSkill.Medicine, 85],\n                    [CrewSkill.Science, 70],\n                    [CrewSkill.Communications, 55]\n                ]),\n                traits: ['diplomatic'],\n                preferredStation: ShipStation.MedBay\n            }\n        ];\n        \n        startingCrew.forEach((crewData, index) => {\n            const crew = this.createCrewMember(\n                crewData.name,\n                crewData.role,\n                crewData.species,\n                crewData.skills,\n                crewData.traits,\n                crewData.preferredStation\n            );\n            this.addCrewMember(crew);\n        });\n    }\n\n    /**\n     * Create new crew member\n     */\n    private createCrewMember(\n        name: string,\n        role: CrewRole,\n        species: string,\n        skills: Map<CrewSkill, number>,\n        traitIds: string[] = [],\n        preferredStation?: ShipStation\n    ): CrewMember {\n        const crewId = `crew_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n        \n        // Initialize all skills\n        const allSkills = new Map<CrewSkill, number>();\n        Object.values(CrewSkill).forEach(skill => {\n            allSkills.set(skill, skills.get(skill) || Math.floor(Math.random() * 30) + 20);\n        });\n        \n        // Apply trait bonuses\n        const memberTraits: CrewTrait[] = [];\n        traitIds.forEach(traitId => {\n            const trait = this.traits.get(traitId);\n            if (trait) {\n                memberTraits.push(trait);\n                trait.effects.forEach(effect => {\n                    if (effect.type === 'skill_bonus') {\n                        if (effect.target === 'all') {\n                            Object.values(CrewSkill).forEach(skill => {\n                                const current = allSkills.get(skill) || 0;\n                                allSkills.set(skill, Math.min(100, current + effect.value));\n                            });\n                        } else if (effect.target) {\n                            const current = allSkills.get(effect.target as CrewSkill) || 0;\n                            allSkills.set(effect.target as CrewSkill, Math.min(100, current + effect.value));\n                        }\n                    }\n                });\n            }\n        });\n        \n        return {\n            id: crewId,\n            name,\n            role,\n            species,\n            age: Math.floor(Math.random() * 40) + 25,\n            \n            skills: allSkills,\n            \n            health: 100,\n            morale: Math.floor(Math.random() * 20) + 70, // 70-90\n            fatigue: Math.floor(Math.random() * 20) + 10, // 10-30\n            stress: Math.floor(Math.random() * 15) + 5, // 5-20\n            \n            workEfficiency: 1.0,\n            \n            traits: memberTraits,\n            preferences: {\n                preferredStation: preferredStation || ShipStation.Bridge,\n                preferredShift: 'alpha',\n                personalityType: ['introvert', 'extrovert', 'ambivert'][Math.floor(Math.random() * 3)] as any,\n                workStyle: ['methodical', 'creative', 'aggressive', 'collaborative'][Math.floor(Math.random() * 4)] as any\n            },\n            relationships: new Map(),\n            \n            experience: Math.floor(Math.random() * 1000) + 500,\n            rank: Math.floor(Math.random() * 3) + 1,\n            specializations: [],\n            commendations: [],\n            \n            background: this.generateBackground(species, role),\n            homeworld: this.generateHomeworld(species),\n            joinDate: Date.now() - Math.floor(Math.random() * 365 * 24 * 60 * 60 * 1000) // Random date in past year\n        };\n    }\n\n    /**\n     * Generate crew background\n     */\n    private generateBackground(species: string, role: CrewRole): string {\n        const backgrounds = {\n            [CrewRole.Captain]: ['Former military officer', 'Merchant marine veteran', 'Academy graduate'],\n            [CrewRole.Pilot]: ['Test pilot', 'Racing pilot', 'Military pilot', 'Civilian transport pilot'],\n            [CrewRole.Engineer]: ['Shipyard worker', 'Research scientist', 'Maintenance chief', 'Technical specialist'],\n            [CrewRole.Scientist]: ['University researcher', 'Corporate scientist', 'Field researcher', 'Lab technician'],\n            [CrewRole.Security]: ['Military police', 'Corporate security', 'Bounty hunter', 'Law enforcement'],\n            [CrewRole.Medic]: ['Ship surgeon', 'Emergency medic', 'Research physician', 'Field medic'],\n            [CrewRole.Communications]: ['Signal analyst', 'Diplomatic attaché', 'Communications officer', 'Intelligence operative'],\n            [CrewRole.Navigator]: ['Star chart cartographer', 'Deep space navigator', 'Survey specialist', 'Astrogation expert']\n        };\n        \n        const roleBackgrounds = backgrounds[role] || ['General crew member'];\n        return roleBackgrounds[Math.floor(Math.random() * roleBackgrounds.length)];\n    }\n\n    /**\n     * Generate homeworld\n     */\n    private generateHomeworld(species: string): string {\n        const homeworlds = {\n            'Human': ['Earth', 'Mars', 'Alpha Centauri', 'New Terra', 'Proxima Station'],\n            'Centaurian': ['Centauri Prime', 'Alpha Station', 'Proxima Colony'],\n            'Vulcan': ['Vulcan', 'New Vulcan', 'Vulcan Colony Alpha'],\n            'Andorian': ['Andoria', 'Andorian Outpost', 'Ice Station Beta']\n        };\n        \n        const speciesWorlds = (homeworlds as any)[species] || homeworlds['Human'];\n        return speciesWorlds[Math.floor(Math.random() * speciesWorlds.length)];\n    }\n\n    /**\n     * Add crew member to ship\n     */\n    addCrewMember(crew: CrewMember): boolean {\n        if (this.crew.size >= this.crewQuarters) {\n            this.logger.warn('Cannot add crew member: quarters at capacity');\n            return false;\n        }\n        \n        this.crew.set(crew.id, crew);\n        \n        // Initialize relationships with existing crew\n        for (const existingCrew of this.crew.values()) {\n            if (existingCrew.id !== crew.id) {\n                const relationship = this.calculateInitialRelationship(crew, existingCrew);\n                crew.relationships.set(existingCrew.id, relationship);\n                existingCrew.relationships.set(crew.id, relationship);\n            }\n        }\n        \n        this.managementEvents.onCrewJoined?.(crew);\n        \n        this.logger.info(`👤 Crew member joined: ${crew.name}`, {\n            role: crew.role,\n            species: crew.species,\n            traits: crew.traits.map(t => t.name)\n        });\n        \n        return true;\n    }\n\n    /**\n     * Calculate initial relationship between crew members\n     */\n    private calculateInitialRelationship(crew1: CrewMember, crew2: CrewMember): number {\n        let relationship = 0;\n        \n        // Species compatibility\n        if (crew1.species === crew2.species) {\n            relationship += 10;\n        }\n        \n        // Personality compatibility\n        if (crew1.preferences.personalityType === crew2.preferences.personalityType) {\n            relationship += 5;\n        }\n        \n        // Work style compatibility\n        if (crew1.preferences.workStyle === crew2.preferences.workStyle) {\n            relationship += 5;\n        } else if (\n            (crew1.preferences.workStyle === 'collaborative' || crew2.preferences.workStyle === 'collaborative') &&\n            crew1.preferences.workStyle !== 'aggressive' && crew2.preferences.workStyle !== 'aggressive'\n        ) {\n            relationship += 3;\n        }\n        \n        // Random factor\n        relationship += Math.floor(Math.random() * 21) - 10; // -10 to +10\n        \n        return Math.max(-50, Math.min(50, relationship)); // Clamp to -50 to +50\n    }\n\n    /**\n     * Assign crew member to station\n     */\n    assignCrewToStation(crewId: string, station: ShipStation): boolean {\n        const crew = this.crew.get(crewId);\n        const stationData = this.stations.get(station);\n        \n        if (!crew || !stationData) {\n            this.logger.warn('Invalid crew or station for assignment', { crewId, station });\n            return false;\n        }\n        \n        // Remove from current station\n        if (crew.currentStation) {\n            this.removeCrewFromStation(crewId, crew.currentStation);\n        }\n        \n        // Check capacity\n        if (stationData.assignedCrew.length >= stationData.maxCrew) {\n            this.logger.warn('Station at capacity', { station });\n            return false;\n        }\n        \n        // Assign to new station\n        crew.currentStation = station;\n        stationData.assignedCrew.push(crewId);\n        \n        // Calculate work efficiency based on skills and preferences\n        crew.workEfficiency = this.calculateWorkEfficiency(crew, station);\n        \n        // Update station efficiency\n        this.updateStationEfficiency(station);\n        \n        this.logger.info(`👥 Crew assigned: ${crew.name} → ${station}`, {\n            efficiency: crew.workEfficiency.toFixed(2)\n        });\n        \n        return true;\n    }\n\n    /**\n     * Remove crew from station\n     */\n    private removeCrewFromStation(crewId: string, station: ShipStation): void {\n        const stationData = this.stations.get(station);\n        if (stationData) {\n            stationData.assignedCrew = stationData.assignedCrew.filter(id => id !== crewId);\n            this.updateStationEfficiency(station);\n        }\n        \n        const crew = this.crew.get(crewId);\n        if (crew) {\n            crew.currentStation = undefined;\n            crew.workEfficiency = 1.0;\n        }\n    }\n\n    /**\n     * Calculate work efficiency for crew at station\n     */\n    private calculateWorkEfficiency(crew: CrewMember, station: ShipStation): number {\n        let efficiency = 1.0;\n        \n        // Skill-based efficiency\n        const stationData = this.stations.get(station);\n        if (stationData) {\n            let skillTotal = 0;\n            let skillCount = 0;\n            \n            stationData.requiredSkills.forEach(skill => {\n                const skillLevel = crew.skills.get(skill) || 0;\n                skillTotal += skillLevel;\n                skillCount++;\n            });\n            \n            if (skillCount > 0) {\n                const averageSkill = skillTotal / skillCount;\n                efficiency = 0.5 + (averageSkill / 100) * 1.5; // 0.5 to 2.0 range\n            }\n        }\n        \n        // Preference bonus\n        if (crew.preferences.preferredStation === station) {\n            efficiency *= 1.2;\n        }\n        \n        // Health and morale effects\n        efficiency *= (crew.health / 100);\n        efficiency *= (crew.morale / 100);\n        efficiency *= (1 - crew.fatigue / 200); // Fatigue has less impact\n        efficiency *= (1 - crew.stress / 150); // Stress has moderate impact\n        \n        // Trait effects\n        crew.traits.forEach(trait => {\n            trait.effects.forEach(effect => {\n                if (effect.type === 'efficiency_bonus') {\n                    efficiency *= (1 + effect.value / 100);\n                }\n            });\n        });\n        \n        return Math.max(0.1, Math.min(2.5, efficiency)); // Clamp to 0.1-2.5\n    }\n\n    /**\n     * Update station efficiency based on assigned crew\n     */\n    private updateStationEfficiency(station: ShipStation): void {\n        const stationData = this.stations.get(station);\n        if (!stationData) return;\n        \n        if (stationData.assignedCrew.length === 0) {\n            stationData.efficiency = 0;\n            stationData.status = 'unmanned';\n        } else {\n            let totalEfficiency = 0;\n            let crewCount = 0;\n            \n            stationData.assignedCrew.forEach(crewId => {\n                const crew = this.crew.get(crewId);\n                if (crew) {\n                    totalEfficiency += crew.workEfficiency;\n                    crewCount++;\n                }\n            });\n            \n            if (crewCount > 0) {\n                stationData.efficiency = totalEfficiency / crewCount;\n                \n                // Determine status\n                const optimalCrew = Math.ceil(stationData.maxCrew * 0.75);\n                if (crewCount < optimalCrew) {\n                    stationData.status = 'understaffed';\n                } else if (crewCount > stationData.maxCrew) {\n                    stationData.status = 'overstaffed';\n                    stationData.efficiency *= 0.8; // Overcrowding penalty\n                } else {\n                    stationData.status = 'operational';\n                }\n            }\n        }\n        \n        this.managementEvents.onStationEfficiencyChanged?.(station, stationData.efficiency);\n    }\n\n    /**\n     * Update crew system\n     */\n    update(deltaTime: number): void {\n        this.updateCrewStatus(deltaTime);\n        this.updateRelationships(deltaTime);\n        this.checkCrewEvents();\n        this.updateShipMorale();\n    }\n\n    /**\n     * Update crew status (health, morale, fatigue, stress)\n     */\n    private updateCrewStatus(deltaTime: number): void {\n        for (const crew of this.crew.values()) {\n            // Fatigue increases during work\n            if (crew.currentStation) {\n                crew.fatigue = Math.min(100, crew.fatigue + deltaTime * 0.02);\n            } else {\n                // Rest reduces fatigue\n                crew.fatigue = Math.max(0, crew.fatigue - deltaTime * 0.05);\n            }\n            \n            // Stress management\n            let stressChange = 0;\n            \n            // Work stress\n            if (crew.currentStation) {\n                const stationData = this.stations.get(crew.currentStation);\n                if (stationData && stationData.status === 'understaffed') {\n                    stressChange += deltaTime * 0.03;\n                }\n            }\n            \n            // Relationship stress\n            let relationshipStress = 0;\n            let relationshipCount = 0;\n            crew.relationships.forEach(relationship => {\n                relationshipStress += relationship;\n                relationshipCount++;\n            });\n            \n            if (relationshipCount > 0) {\n                const avgRelationship = relationshipStress / relationshipCount;\n                if (avgRelationship < -20) {\n                    stressChange += deltaTime * 0.02;\n                } else if (avgRelationship > 20) {\n                    stressChange -= deltaTime * 0.01;\n                }\n            }\n            \n            // Apply trait effects\n            crew.traits.forEach(trait => {\n                trait.effects.forEach(effect => {\n                    if (effect.type === 'stress_resistance') {\n                        stressChange *= (1 - effect.value / 100);\n                    }\n                });\n            });\n            \n            crew.stress = Math.max(0, Math.min(100, crew.stress + stressChange));\n            \n            // Morale calculation\n            let moraleChange = 0;\n            \n            // Base morale decay\n            moraleChange -= deltaTime * 0.01;\n            \n            // Station assignment morale\n            if (crew.currentStation === crew.preferences.preferredStation) {\n                moraleChange += deltaTime * 0.02;\n            }\n            \n            // Health affects morale\n            if (crew.health < 80) {\n                moraleChange -= deltaTime * 0.015;\n            }\n            \n            // Stress affects morale\n            if (crew.stress > 60) {\n                moraleChange -= deltaTime * 0.02;\n            }\n            \n            // Apply trait effects\n            crew.traits.forEach(trait => {\n                trait.effects.forEach(effect => {\n                    if (effect.type === 'morale_bonus') {\n                        moraleChange += deltaTime * (effect.value / 1000);\n                    }\n                });\n            });\n            \n            crew.morale = Math.max(0, Math.min(100, crew.morale + moraleChange));\n            \n            // Update work efficiency\n            if (crew.currentStation) {\n                crew.workEfficiency = this.calculateWorkEfficiency(crew, crew.currentStation);\n            }\n        }\n    }\n\n    /**\n     * Update crew relationships\n     */\n    private updateRelationships(deltaTime: number): void {\n        const crewArray = Array.from(this.crew.values());\n        \n        for (let i = 0; i < crewArray.length; i++) {\n            for (let j = i + 1; j < crewArray.length; j++) {\n                const crew1 = crewArray[i];\n                const crew2 = crewArray[j];\n                \n                // Working together improves relationships slowly\n                if (crew1.currentStation === crew2.currentStation && crew1.currentStation) {\n                    const improvement = deltaTime * 0.005;\n                    this.modifyRelationship(crew1.id, crew2.id, improvement);\n                }\n                \n                // Random small relationship changes\n                if (Math.random() < 0.001) { // Very rare random events\n                    const change = (Math.random() - 0.5) * 2; // -1 to +1\n                    this.modifyRelationship(crew1.id, crew2.id, change);\n                }\n            }\n        }\n    }\n\n    /**\n     * Modify relationship between two crew members\n     */\n    private modifyRelationship(crewId1: string, crewId2: string, change: number): void {\n        const crew1 = this.crew.get(crewId1);\n        const crew2 = this.crew.get(crewId2);\n        \n        if (!crew1 || !crew2) return;\n        \n        const current1 = crew1.relationships.get(crewId2) || 0;\n        const current2 = crew2.relationships.get(crewId1) || 0;\n        \n        crew1.relationships.set(crewId2, Math.max(-100, Math.min(100, current1 + change)));\n        crew2.relationships.set(crewId1, Math.max(-100, Math.min(100, current2 + change)));\n    }\n\n    /**\n     * Check for random crew events\n     */\n    private checkCrewEvents(): void {\n        if (Math.random() < 0.0005) { // Very rare events\n            this.generateCrewEvent();\n        }\n    }\n\n    /**\n     * Generate random crew event\n     */\n    private generateCrewEvent(): void {\n        const crewArray = Array.from(this.crew.values());\n        if (crewArray.length < 2) return;\n        \n        const eventTypes = ['conflict', 'achievement', 'discovery', 'promotion'];\n        const eventType = eventTypes[Math.floor(Math.random() * eventTypes.length)] as CrewEvent['type'];\n        \n        let event: CrewEvent;\n        \n        switch (eventType) {\n            case 'conflict':\n                event = this.generateConflictEvent(crewArray);\n                break;\n            case 'achievement':\n                event = this.generateAchievementEvent(crewArray);\n                break;\n            case 'discovery':\n                event = this.generateDiscoveryEvent(crewArray);\n                break;\n            case 'promotion':\n                event = this.generatePromotionEvent(crewArray);\n                break;\n            default:\n                return;\n        }\n        \n        this.events.push(event);\n        this.managementEvents.onCrewEvent?.(event);\n        \n        // Apply event effects\n        event.effects.forEach(effect => {\n            const crew = this.crew.get(effect.crewId);\n            if (crew) {\n                switch (effect.effect) {\n                    case 'morale':\n                        crew.morale = Math.max(0, Math.min(100, crew.morale + effect.value));\n                        break;\n                    case 'stress':\n                        crew.stress = Math.max(0, Math.min(100, crew.stress + effect.value));\n                        break;\n                    case 'experience':\n                        crew.experience += effect.value;\n                        break;\n                }\n            }\n        });\n        \n        this.logger.info(`📰 Crew event: ${event.description}`, {\n            type: event.type,\n            involvedCrew: event.involvedCrew.length\n        });\n    }\n\n    /**\n     * Generate conflict event\n     */\n    private generateConflictEvent(crewArray: CrewMember[]): CrewEvent {\n        const crew1 = crewArray[Math.floor(Math.random() * crewArray.length)];\n        const crew2 = crewArray[Math.floor(Math.random() * crewArray.length)];\n        \n        if (crew1.id === crew2.id) {\n            return this.generateConflictEvent(crewArray); // Retry\n        }\n        \n        const conflictTypes = [\n            'disagreement over procedures',\n            'personality clash',\n            'resource allocation dispute',\n            'work methodology conflict'\n        ];\n        \n        const conflictType = conflictTypes[Math.floor(Math.random() * conflictTypes.length)];\n        \n        return {\n            id: `event_${Date.now()}`,\n            type: 'conflict',\n            involvedCrew: [crew1.id, crew2.id],\n            description: `${crew1.name} and ${crew2.name} had a ${conflictType}`,\n            effects: [\n                { crewId: crew1.id, effect: 'morale', value: -10 },\n                { crewId: crew2.id, effect: 'morale', value: -10 },\n                { crewId: crew1.id, effect: 'stress', value: 15 },\n                { crewId: crew2.id, effect: 'stress', value: 15 }\n            ],\n            timestamp: Date.now(),\n            resolved: false\n        };\n    }\n\n    /**\n     * Generate achievement event\n     */\n    private generateAchievementEvent(crewArray: CrewMember[]): CrewEvent {\n        const crew = crewArray[Math.floor(Math.random() * crewArray.length)];\n        \n        const achievements = [\n            'exceptional performance during crisis',\n            'innovative solution to technical problem',\n            'outstanding leadership during difficult situation',\n            'breakthrough in research project'\n        ];\n        \n        const achievement = achievements[Math.floor(Math.random() * achievements.length)];\n        \n        return {\n            id: `event_${Date.now()}`,\n            type: 'achievement',\n            involvedCrew: [crew.id],\n            description: `${crew.name} demonstrated ${achievement}`,\n            effects: [\n                { crewId: crew.id, effect: 'morale', value: 20 },\n                { crewId: crew.id, effect: 'experience', value: 100 }\n            ],\n            timestamp: Date.now(),\n            resolved: true\n        };\n    }\n\n    /**\n     * Generate discovery event\n     */\n    private generateDiscoveryEvent(crewArray: CrewMember[]): CrewEvent {\n        const crew = crewArray[Math.floor(Math.random() * crewArray.length)];\n        \n        const discoveries = [\n            'discovered new mineral composition',\n            'identified unknown signal pattern',\n            'found evidence of ancient civilization',\n            'detected rare astronomical phenomenon'\n        ];\n        \n        const discovery = discoveries[Math.floor(Math.random() * discoveries.length)];\n        \n        return {\n            id: `event_${Date.now()}`,\n            type: 'discovery',\n            involvedCrew: [crew.id],\n            description: `${crew.name} ${discovery}`,\n            effects: [\n                { crewId: crew.id, effect: 'morale', value: 15 },\n                { crewId: crew.id, effect: 'experience', value: 75 }\n            ],\n            timestamp: Date.now(),\n            resolved: true\n        };\n    }\n\n    /**\n     * Generate promotion event\n     */\n    private generatePromotionEvent(crewArray: CrewMember[]): CrewEvent {\n        const eligibleCrew = crewArray.filter(crew => crew.rank < 10 && crew.experience > 1000);\n        if (eligibleCrew.length === 0) return this.generateAchievementEvent(crewArray);\n        \n        const crew = eligibleCrew[Math.floor(Math.random() * eligibleCrew.length)];\n        crew.rank++;\n        \n        return {\n            id: `event_${Date.now()}`,\n            type: 'promotion',\n            involvedCrew: [crew.id],\n            description: `${crew.name} has been promoted to rank ${crew.rank}`,\n            effects: [\n                { crewId: crew.id, effect: 'morale', value: 25 }\n            ],\n            timestamp: Date.now(),\n            resolved: true\n        };\n    }\n\n    /**\n     * Update ship-wide morale\n     */\n    private updateShipMorale(): void {\n        if (this.crew.size === 0) {\n            this.shipMorale = 50;\n            return;\n        }\n        \n        let totalMorale = 0;\n        for (const crew of this.crew.values()) {\n            totalMorale += crew.morale;\n        }\n        \n        const averageMorale = totalMorale / this.crew.size;\n        \n        // Smooth transition\n        this.shipMorale = this.shipMorale * 0.9 + averageMorale * 0.1;\n        \n        // Check for morale alerts\n        if (this.shipMorale < 40) {\n            this.managementEvents.onMoraleAlert?.(this.shipMorale);\n        }\n    }\n\n    /**\n     * Get crew member by ID\n     */\n    getCrewMember(crewId: string): CrewMember | null {\n        return this.crew.get(crewId) || null;\n    }\n\n    /**\n     * Get all crew members\n     */\n    getAllCrew(): CrewMember[] {\n        return Array.from(this.crew.values());\n    }\n\n    /**\n     * Get crew by role\n     */\n    getCrewByRole(role: CrewRole): CrewMember[] {\n        return Array.from(this.crew.values()).filter(crew => crew.role === role);\n    }\n\n    /**\n     * Get crew by station\n     */\n    getCrewByStation(station: ShipStation): CrewMember[] {\n        return Array.from(this.crew.values()).filter(crew => crew.currentStation === station);\n    }\n\n    /**\n     * Get station information\n     */\n    getStation(station: ShipStation): StationAssignment | null {\n        return this.stations.get(station) || null;\n    }\n\n    /**\n     * Get all stations\n     */\n    getAllStations(): StationAssignment[] {\n        return Array.from(this.stations.values());\n    }\n\n    /**\n     * Get recent crew events\n     */\n    getRecentEvents(limit: number = 10): CrewEvent[] {\n        return this.events\n            .sort((a, b) => b.timestamp - a.timestamp)\n            .slice(0, limit);\n    }\n\n    /**\n     * Get crew management statistics\n     */\n    getCrewStats(): {\n        totalCrew: number;\n        maxCrew: number;\n        averageMorale: number;\n        averageHealth: number;\n        averageFatigue: number;\n        averageStress: number;\n        stationEfficiency: { [station: string]: number };\n        roleDistribution: { [role: string]: number };\n        shipMorale: number;\n        disciplineLevel: number;\n    } {\n        const totalCrew = this.crew.size;\n        const maxCrew = this.crewQuarters;\n        \n        let totalMorale = 0;\n        let totalHealth = 0;\n        let totalFatigue = 0;\n        let totalStress = 0;\n        \n        const roleDistribution: { [role: string]: number } = {};\n        \n        for (const crew of this.crew.values()) {\n            totalMorale += crew.morale;\n            totalHealth += crew.health;\n            totalFatigue += crew.fatigue;\n            totalStress += crew.stress;\n            \n            roleDistribution[crew.role] = (roleDistribution[crew.role] || 0) + 1;\n        }\n        \n        const stationEfficiency: { [station: string]: number } = {};\n        for (const [station, data] of this.stations.entries()) {\n            stationEfficiency[station] = data.efficiency;\n        }\n        \n        return {\n            totalCrew,\n            maxCrew,\n            averageMorale: totalCrew > 0 ? totalMorale / totalCrew : 0,\n            averageHealth: totalCrew > 0 ? totalHealth / totalCrew : 0,\n            averageFatigue: totalCrew > 0 ? totalFatigue / totalCrew : 0,\n            averageStress: totalCrew > 0 ? totalStress / totalCrew : 0,\n            stationEfficiency,\n            roleDistribution,\n            shipMorale: this.shipMorale,\n            disciplineLevel: this.disciplineLevel\n        };\n    }\n\n    /**\n     * Save crew data\n     */\n    saveCrewData(): any {\n        return {\n            crew: Array.from(this.crew.entries()).map(([id, crew]) => [\n                id,\n                {\n                    ...crew,\n                    skills: Array.from(crew.skills.entries()),\n                    relationships: Array.from(crew.relationships.entries())\n                }\n            ]),\n            stations: Array.from(this.stations.entries()),\n            events: this.events,\n            shipMorale: this.shipMorale,\n            disciplineLevel: this.disciplineLevel,\n            crewQuarters: this.crewQuarters\n        };\n    }\n\n    /**\n     * Load crew data\n     */\n    loadCrewData(data: any): void {\n        if (data.crew) {\n            this.crew = new Map(data.crew.map(([id, crew]: [string, any]) => [\n                id,\n                {\n                    ...crew,\n                    skills: new Map(crew.skills),\n                    relationships: new Map(crew.relationships)\n                }\n            ]));\n        }\n        if (data.stations) {\n            this.stations = new Map(data.stations);\n        }\n        if (data.events) {\n            this.events = data.events;\n        }\n        if (data.shipMorale !== undefined) {\n            this.shipMorale = data.shipMorale;\n        }\n        if (data.disciplineLevel !== undefined) {\n            this.disciplineLevel = data.disciplineLevel;\n        }\n        if (data.crewQuarters !== undefined) {\n            this.crewQuarters = data.crewQuarters;\n        }\n        \n        this.logger.info('👥 Crew data loaded', {\n            crewCount: this.crew.size,\n            events: this.events.length\n        });\n    }\n}","/**\n * Diplomacy System\n * Advanced diplomatic interactions with factions, reputation, and negotiations\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\nimport { CrewMember } from '@rpg/CrewManagement';\n\nexport enum FactionType {\n    Government = 'government',\n    Corporate = 'corporate',\n    Military = 'military',\n    Pirates = 'pirates',\n    Traders = 'traders',\n    Scientists = 'scientists',\n    Aliens = 'aliens',\n    Rebels = 'rebels',\n    Religious = 'religious',\n    Independent = 'independent'\n}\n\nexport enum DiplomaticStance {\n    Allied = 'allied',           // +80 to +100\n    Friendly = 'friendly',       // +40 to +79\n    Neutral = 'neutral',         // -39 to +39\n    Unfriendly = 'unfriendly',   // -79 to -40\n    Hostile = 'hostile',         // -100 to -80\n    War = 'war'                  // Active warfare\n}\n\nexport enum NegotiationType {\n    Trade = 'trade',\n    Information = 'information',\n    SafePassage = 'safe_passage',\n    Alliance = 'alliance',\n    Ceasefire = 'ceasefire',\n    Technology = 'technology',\n    Territory = 'territory',\n    Tribute = 'tribute'\n}\n\nexport interface Faction {\n    id: string;\n    name: string;\n    type: FactionType;\n    description: string;\n    \n    // Political attributes\n    government: 'democracy' | 'autocracy' | 'oligarchy' | 'theocracy' | 'anarchy';\n    ideology: 'expansionist' | 'isolationist' | 'pacifist' | 'militaristic' | 'commercial';\n    \n    // Reputation and relationships\n    reputation: number; // -100 to +100\n    stance: DiplomaticStance;\n    trustLevel: number; // 0-100, affects negotiation success\n    \n    // Faction characteristics\n    power: number; // 1-100, military/economic strength\n    territory: string[]; // Controlled systems\n    resources: FactionResources;\n    \n    // Diplomatic history\n    treaties: Treaty[];\n    recentActions: DiplomaticAction[];\n    \n    // AI personality\n    personality: FactionPersonality;\n    \n    // Status\n    isActive: boolean;\n    lastContact: number;\n    homeSystem: string;\n}\n\nexport interface FactionResources {\n    military: number;\n    economic: number;\n    technological: number;\n    influence: number;\n}\n\nexport interface FactionPersonality {\n    aggression: number; // 0-100\n    cooperation: number; // 0-100\n    trustworthiness: number; // 0-100\n    pride: number; // 0-100\n    greed: number; // 0-100\n    xenophobia: number; // 0-100 (for aliens)\n}\n\nexport interface Treaty {\n    id: string;\n    type: 'trade' | 'non_aggression' | 'alliance' | 'technology_sharing' | 'territory';\n    participants: string[]; // Faction IDs\n    terms: TreatyTerm[];\n    startDate: number;\n    duration: number; // -1 for permanent\n    status: 'active' | 'violated' | 'expired' | 'suspended';\n}\n\nexport interface TreatyTerm {\n    type: 'trade_bonus' | 'military_support' | 'information_sharing' | 'territory_access' | 'tribute';\n    beneficiary: string; // Faction ID\n    value: number;\n    description: string;\n}\n\nexport interface DiplomaticAction {\n    id: string;\n    type: 'contact' | 'trade' | 'threat' | 'gift' | 'treaty_offer' | 'treaty_violation' | 'war_declaration';\n    actor: string; // Faction ID\n    target: string; // Faction ID\n    timestamp: number;\n    description: string;\n    reputationChange: number;\n    successful: boolean;\n}\n\nexport interface NegotiationSession {\n    id: string;\n    participants: string[]; // Faction IDs\n    type: NegotiationType;\n    currentOffer: NegotiationOffer;\n    counterOffer?: NegotiationOffer;\n    \n    // Negotiation state\n    rounds: number;\n    maxRounds: number;\n    status: 'active' | 'successful' | 'failed' | 'abandoned';\n    \n    // Modifiers\n    playerSkill: number; // Communications/Charisma bonuses\n    crewBonus: number; // Diplomatic crew bonuses\n    reputationModifier: number;\n}\n\nexport interface NegotiationOffer {\n    proposer: string; // Faction ID\n    terms: OfferTerm[];\n    totalValue: number; // AI-calculated offer value\n    priority: number; // How much proposer wants this\n}\n\nexport interface OfferTerm {\n    type: 'credits' | 'items' | 'information' | 'territory' | 'technology' | 'service' | 'protection';\n    giver: string; // Faction ID\n    receiver: string; // Faction ID\n    description: string;\n    value: number; // AI-calculated worth\n    items?: { itemId: string, quantity: number }[];\n}\n\nexport interface DiplomaticEncounter {\n    id: string;\n    factionId: string;\n    type: 'first_contact' | 'routine_patrol' | 'distress_call' | 'territorial_dispute' | 'trade_opportunity';\n    location: { x: number, y: number };\n    \n    // Encounter details\n    description: string;\n    availableActions: EncounterAction[];\n    consequences: EncounterConsequence[];\n    \n    // Status\n    isActive: boolean;\n    resolution?: 'peaceful' | 'hostile' | 'neutral' | 'beneficial';\n    timestamp: number;\n}\n\nexport interface EncounterAction {\n    id: string;\n    name: string;\n    description: string;\n    requirements?: ActionRequirement[];\n    skillCheck?: { skill: string, difficulty: number };\n    consequences: EncounterConsequence[];\n}\n\nexport interface ActionRequirement {\n    type: 'reputation' | 'crew_skill' | 'technology' | 'item' | 'treaty';\n    value: number | string;\n    description: string;\n}\n\nexport interface EncounterConsequence {\n    type: 'reputation' | 'resources' | 'information' | 'combat' | 'treaty_offer' | 'trade_opportunity';\n    factionId: string;\n    value: number;\n    description: string;\n    items?: { itemId: string, quantity: number }[];\n}\n\nexport interface DiplomacyEvents {\n    onFirstContact?: (faction: Faction) => void;\n    onReputationChanged?: (factionId: string, oldRep: number, newRep: number) => void;\n    onTreatyProposed?: (treaty: Treaty) => void;\n    onTreatyRatified?: (treaty: Treaty) => void;\n    onWarDeclared?: (aggressor: string, target: string) => void;\n    onNegotiationStarted?: (session: NegotiationSession) => void;\n    onNegotiationCompleted?: (session: NegotiationSession, success: boolean) => void;\n    onEncounterGenerated?: (encounter: DiplomaticEncounter) => void;\n}\n\nexport class DiplomacySystem {\n    private factions: Map<string, Faction> = new Map();\n    private treaties: Map<string, Treaty> = new Map();\n    private negotiations: Map<string, NegotiationSession> = new Map();\n    private encounters: Map<string, DiplomaticEncounter> = new Map();\n    private diplomaticActions: DiplomaticAction[] = [];\n    \n    // Player faction\n    private readonly PLAYER_FACTION_ID = 'player';\n    \n    private events: DiplomacyEvents;\n    private logger: Logger;\n\n    constructor(events: DiplomacyEvents = {}) {\n        this.logger = new Logger('DiplomacySystem');\n        this.events = events;\n        \n        this.initializeFactions();\n        this.initializePlayerFaction();\n        \n        this.logger.info('🤝 Diplomacy system initialized');\n    }\n\n    /**\n     * Initialize major factions\n     */\n    private initializeFactions(): void {\n        const factions: Faction[] = [\n            {\n                id: 'terran_federation',\n                name: 'Terran Federation',\n                type: FactionType.Government,\n                description: 'Democratic alliance of human colonies',\n                government: 'democracy',\n                ideology: 'expansionist',\n                reputation: 25,\n                stance: DiplomaticStance.Friendly,\n                trustLevel: 70,\n                power: 85,\n                territory: ['sol_system', 'alpha_centauri', 'proxima_station'],\n                resources: {\n                    military: 80,\n                    economic: 90,\n                    technological: 85,\n                    influence: 75\n                },\n                treaties: [],\n                recentActions: [],\n                personality: {\n                    aggression: 30,\n                    cooperation: 80,\n                    trustworthiness: 85,\n                    pride: 60,\n                    greed: 40,\n                    xenophobia: 20\n                },\n                isActive: true,\n                lastContact: 0,\n                homeSystem: 'sol_system'\n            },\n            {\n                id: 'zephyrian_empire',\n                name: 'Zephyrian Empire',\n                type: FactionType.Aliens,\n                description: 'Ancient alien empire with advanced technology',\n                government: 'autocracy',\n                ideology: 'isolationist',\n                reputation: -10,\n                stance: DiplomaticStance.Neutral,\n                trustLevel: 45,\n                power: 95,\n                territory: ['zephyr_prime', 'nebula_omega', 'crystal_worlds'],\n                resources: {\n                    military: 90,\n                    economic: 70,\n                    technological: 100,\n                    influence: 60\n                },\n                treaties: [],\n                recentActions: [],\n                personality: {\n                    aggression: 50,\n                    cooperation: 30,\n                    trustworthiness: 60,\n                    pride: 90,\n                    greed: 20,\n                    xenophobia: 70\n                },\n                isActive: true,\n                lastContact: 0,\n                homeSystem: 'zephyr_prime'\n            },\n            {\n                id: 'crimson_cartel',\n                name: 'Crimson Cartel',\n                type: FactionType.Pirates,\n                description: 'Notorious pirate confederation',\n                government: 'anarchy',\n                ideology: 'militaristic',\n                reputation: -60,\n                stance: DiplomaticStance.Hostile,\n                trustLevel: 15,\n                power: 45,\n                territory: ['asteroid_belt_7', 'rogue_station'],\n                resources: {\n                    military: 70,\n                    economic: 40,\n                    technological: 30,\n                    influence: 25\n                },\n                treaties: [],\n                recentActions: [],\n                personality: {\n                    aggression: 85,\n                    cooperation: 20,\n                    trustworthiness: 25,\n                    pride: 70,\n                    greed: 90,\n                    xenophobia: 40\n                },\n                isActive: true,\n                lastContact: 0,\n                homeSystem: 'asteroid_belt_7'\n            },\n            {\n                id: 'hegemony_corp',\n                name: 'Hegemony Corporation',\n                type: FactionType.Corporate,\n                description: 'Mega-corporation controlling trade routes',\n                government: 'oligarchy',\n                ideology: 'commercial',\n                reputation: 15,\n                stance: DiplomaticStance.Neutral,\n                trustLevel: 55,\n                power: 75,\n                territory: ['trade_hub_alpha', 'mining_sector_12'],\n                resources: {\n                    military: 50,\n                    economic: 100,\n                    technological: 70,\n                    influence: 80\n                },\n                treaties: [],\n                recentActions: [],\n                personality: {\n                    aggression: 40,\n                    cooperation: 60,\n                    trustworthiness: 50,\n                    pride: 50,\n                    greed: 85,\n                    xenophobia: 30\n                },\n                isActive: true,\n                lastContact: 0,\n                homeSystem: 'trade_hub_alpha'\n            },\n            {\n                id: 'void_seekers',\n                name: 'Void Seekers',\n                type: FactionType.Religious,\n                description: 'Mystical order seeking ancient knowledge',\n                government: 'theocracy',\n                ideology: 'pacifist',\n                reputation: 5,\n                stance: DiplomaticStance.Neutral,\n                trustLevel: 75,\n                power: 30,\n                territory: ['sanctuary_worlds'],\n                resources: {\n                    military: 20,\n                    economic: 40,\n                    technological: 60,\n                    influence: 70\n                },\n                treaties: [],\n                recentActions: [],\n                personality: {\n                    aggression: 10,\n                    cooperation: 70,\n                    trustworthiness: 90,\n                    pride: 40,\n                    greed: 10,\n                    xenophobia: 5\n                },\n                isActive: true,\n                lastContact: 0,\n                homeSystem: 'sanctuary_worlds'\n            },\n            {\n                id: 'liberation_front',\n                name: 'Liberation Front',\n                type: FactionType.Rebels,\n                description: 'Revolutionary movement fighting oppression',\n                government: 'democracy',\n                ideology: 'militaristic',\n                reputation: -20,\n                stance: DiplomaticStance.Unfriendly,\n                trustLevel: 40,\n                power: 35,\n                territory: ['frontier_colonies'],\n                resources: {\n                    military: 60,\n                    economic: 30,\n                    technological: 40,\n                    influence: 50\n                },\n                treaties: [],\n                recentActions: [],\n                personality: {\n                    aggression: 70,\n                    cooperation: 50,\n                    trustworthiness: 60,\n                    pride: 80,\n                    greed: 30,\n                    xenophobia: 35\n                },\n                isActive: true,\n                lastContact: 0,\n                homeSystem: 'frontier_colonies'\n            }\n        ];\n        \n        factions.forEach(faction => {\n            this.factions.set(faction.id, faction);\n        });\n        \n        this.logger.info(`🏛️ Initialized ${factions.length} major factions`);\n    }\n\n    /**\n     * Initialize player faction\n     */\n    private initializePlayerFaction(): void {\n        const playerFaction: Faction = {\n            id: this.PLAYER_FACTION_ID,\n            name: 'Independent Captain',\n            type: FactionType.Independent,\n            description: 'Freelance spaceship captain',\n            government: 'democracy',\n            ideology: 'commercial',\n            reputation: 0,\n            stance: DiplomaticStance.Neutral,\n            trustLevel: 50,\n            power: 25,\n            territory: [],\n            resources: {\n                military: 30,\n                economic: 40,\n                technological: 35,\n                influence: 20\n            },\n            treaties: [],\n            recentActions: [],\n            personality: {\n                aggression: 40,\n                cooperation: 60,\n                trustworthiness: 70,\n                pride: 50,\n                greed: 50,\n                xenophobia: 20\n            },\n            isActive: true,\n            lastContact: Date.now(),\n            homeSystem: 'starting_system'\n        };\n        \n        this.factions.set(this.PLAYER_FACTION_ID, playerFaction);\n    }\n\n    /**\n     * Modify reputation with faction\n     */\n    modifyReputation(factionId: string, change: number, reason: string): void {\n        const faction = this.factions.get(factionId);\n        if (!faction) return;\n        \n        const oldReputation = faction.reputation;\n        faction.reputation = Math.max(-100, Math.min(100, faction.reputation + change));\n        \n        // Update diplomatic stance based on new reputation\n        faction.stance = this.calculateDiplomaticStance(faction.reputation);\n        \n        // Record diplomatic action\n        this.recordDiplomaticAction({\n            type: 'contact',\n            actor: this.PLAYER_FACTION_ID,\n            target: factionId,\n            description: reason,\n            reputationChange: change,\n            successful: change > 0\n        });\n        \n        this.events.onReputationChanged?.(factionId, oldReputation, faction.reputation);\n        \n        this.logger.info(`🤝 Reputation changed: ${faction.name} ${oldReputation} → ${faction.reputation} (${reason})`);\n    }\n\n    /**\n     * Calculate diplomatic stance from reputation\n     */\n    private calculateDiplomaticStance(reputation: number): DiplomaticStance {\n        if (reputation >= 80) return DiplomaticStance.Allied;\n        if (reputation >= 40) return DiplomaticStance.Friendly;\n        if (reputation >= -39) return DiplomaticStance.Neutral;\n        if (reputation >= -79) return DiplomaticStance.Unfriendly;\n        return DiplomaticStance.Hostile;\n    }\n\n    /**\n     * Record diplomatic action\n     */\n    private recordDiplomaticAction(actionData: Omit<DiplomaticAction, 'id' | 'timestamp'>): void {\n        const action: DiplomaticAction = {\n            id: `action_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n            timestamp: Date.now(),\n            ...actionData\n        };\n        \n        this.diplomaticActions.push(action);\n        \n        // Add to faction's recent actions\n        const targetFaction = this.factions.get(actionData.target);\n        if (targetFaction) {\n            targetFaction.recentActions.push(action);\n            \n            // Keep only recent actions (last 10)\n            if (targetFaction.recentActions.length > 10) {\n                targetFaction.recentActions.shift();\n            }\n        }\n    }\n\n    /**\n     * Start negotiation with faction\n     */\n    startNegotiation(\n        factionId: string, \n        type: NegotiationType, \n        playerOffer: OfferTerm[],\n        playerSkill: number = 50,\n        crewBonus: number = 0\n    ): NegotiationSession | null {\n        const faction = this.factions.get(factionId);\n        if (!faction) {\n            this.logger.warn('Cannot start negotiation: faction not found', { factionId });\n            return null;\n        }\n        \n        // Check if negotiation is possible\n        if (faction.stance === DiplomaticStance.War) {\n            this.logger.warn('Cannot negotiate: factions at war', { factionId });\n            return null;\n        }\n        \n        const sessionId = `negotiation_${Date.now()}_${factionId}`;\n        const reputationModifier = Math.floor(faction.reputation / 10); // -10 to +10\n        \n        const session: NegotiationSession = {\n            id: sessionId,\n            participants: [this.PLAYER_FACTION_ID, factionId],\n            type,\n            currentOffer: {\n                proposer: this.PLAYER_FACTION_ID,\n                terms: playerOffer,\n                totalValue: this.calculateOfferValue(playerOffer),\n                priority: this.calculateOfferPriority(type, faction)\n            },\n            rounds: 0,\n            maxRounds: 5,\n            status: 'active',\n            playerSkill,\n            crewBonus,\n            reputationModifier\n        };\n        \n        // Generate AI counter-offer\n        session.counterOffer = this.generateCounterOffer(session, faction);\n        \n        this.negotiations.set(sessionId, session);\n        this.events.onNegotiationStarted?.(session);\n        \n        this.logger.info(`💬 Negotiation started: ${faction.name} - ${type}`, {\n            playerValue: session.currentOffer.totalValue,\n            aiValue: session.counterOffer?.totalValue || 0\n        });\n        \n        return session;\n    }\n\n    /**\n     * Calculate offer value for AI evaluation\n     */\n    private calculateOfferValue(terms: OfferTerm[]): number {\n        let totalValue = 0;\n        \n        terms.forEach(term => {\n            switch (term.type) {\n                case 'credits':\n                    totalValue += term.value;\n                    break;\n                case 'items':\n                    totalValue += term.value * 10; // Items worth more than credits\n                    break;\n                case 'information':\n                    totalValue += term.value * 20; // Information is valuable\n                    break;\n                case 'technology':\n                    totalValue += term.value * 50; // Technology is very valuable\n                    break;\n                case 'territory':\n                    totalValue += term.value * 100; // Territory is extremely valuable\n                    break;\n                case 'service':\n                    totalValue += term.value * 5;\n                    break;\n                case 'protection':\n                    totalValue += term.value * 15;\n                    break;\n            }\n        });\n        \n        return totalValue;\n    }\n\n    /**\n     * Calculate how much faction wants this type of deal\n     */\n    private calculateOfferPriority(type: NegotiationType, faction: Faction): number {\n        let priority = 50; // Base priority\n        \n        switch (type) {\n            case NegotiationType.Trade:\n                priority += faction.personality.greed * 0.3;\n                priority += faction.resources.economic * 0.2;\n                break;\n            case NegotiationType.Alliance:\n                priority += faction.personality.cooperation * 0.4;\n                priority -= faction.personality.pride * 0.2;\n                break;\n            case NegotiationType.Technology:\n                priority += (100 - faction.resources.technological) * 0.3;\n                priority += faction.personality.cooperation * 0.2;\n                break;\n            case NegotiationType.SafePassage:\n                priority += faction.personality.trustworthiness * 0.3;\n                priority -= faction.personality.aggression * 0.2;\n                break;\n            case NegotiationType.Information:\n                priority += faction.personality.cooperation * 0.2;\n                priority += faction.resources.influence * 0.1;\n                break;\n        }\n        \n        // Reputation affects priority\n        priority += faction.reputation * 0.2;\n        \n        return Math.max(0, Math.min(100, priority));\n    }\n\n    /**\n     * Generate AI counter-offer\n     */\n    private generateCounterOffer(session: NegotiationSession, faction: Faction): NegotiationOffer {\n        const playerOfferValue = session.currentOffer.totalValue;\n        const factionDemand = this.calculateFactionDemand(session, faction);\n        \n        const counterTerms: OfferTerm[] = [];\n        \n        // AI wants something in return\n        if (factionDemand > playerOfferValue) {\n            const difference = factionDemand - playerOfferValue;\n            \n            // Request credits if greedy\n            if (faction.personality.greed > 60) {\n                counterTerms.push({\n                    type: 'credits',\n                    giver: this.PLAYER_FACTION_ID,\n                    receiver: faction.id,\n                    description: `Additional payment of ${difference} credits`,\n                    value: difference\n                });\n            }\n            // Request information if influence-focused\n            else if (faction.resources.influence > 70) {\n                counterTerms.push({\n                    type: 'information',\n                    giver: this.PLAYER_FACTION_ID,\n                    receiver: faction.id,\n                    description: 'Strategic intelligence data',\n                    value: Math.floor(difference / 20)\n                });\n            }\n            // Request service\n            else {\n                counterTerms.push({\n                    type: 'service',\n                    giver: this.PLAYER_FACTION_ID,\n                    receiver: faction.id,\n                    description: 'Future service commitment',\n                    value: Math.floor(difference / 5)\n                });\n            }\n        }\n        \n        // AI offers something back based on negotiation type\n        if (session.type === NegotiationType.Trade) {\n            counterTerms.push({\n                type: 'credits',\n                giver: faction.id,\n                receiver: this.PLAYER_FACTION_ID,\n                description: `Trade payment`,\n                value: Math.floor(playerOfferValue * 0.8)\n            });\n        } else if (session.type === NegotiationType.Information) {\n            counterTerms.push({\n                type: 'information',\n                giver: faction.id,\n                receiver: this.PLAYER_FACTION_ID,\n                description: 'Classified intelligence',\n                value: Math.floor(playerOfferValue / 20)\n            });\n        }\n        \n        return {\n            proposer: faction.id,\n            terms: counterTerms,\n            totalValue: this.calculateOfferValue(counterTerms),\n            priority: session.currentOffer.priority\n        };\n    }\n\n    /**\n     * Calculate what faction demands in negotiation\n     */\n    private calculateFactionDemand(session: NegotiationSession, faction: Faction): number {\n        let baseDemand = session.currentOffer.totalValue;\n        \n        // Faction personality affects demands\n        baseDemand *= (1 + faction.personality.greed / 200); // 0.5x to 1.5x\n        baseDemand *= (1 + faction.personality.pride / 300); // 0.67x to 1.33x\n        \n        // Reputation affects demands\n        baseDemand *= (1 - faction.reputation / 200); // Better rep = lower demands\n        \n        // Power imbalance affects demands\n        const playerFaction = this.factions.get(this.PLAYER_FACTION_ID)!;\n        const powerRatio = faction.power / playerFaction.power;\n        baseDemand *= Math.pow(powerRatio, 0.3); // Powerful factions demand more\n        \n        return Math.floor(baseDemand);\n    }\n\n    /**\n     * Continue negotiation with player response\n     */\n    continueNegotiation(\n        sessionId: string, \n        acceptCounter: boolean, \n        newOffer?: OfferTerm[]\n    ): NegotiationSession | null {\n        const session = this.negotiations.get(sessionId);\n        if (!session || session.status !== 'active') return null;\n        \n        const faction = this.factions.get(session.participants[1]);\n        if (!faction) return null;\n        \n        session.rounds++;\n        \n        if (acceptCounter && session.counterOffer) {\n            // Player accepted AI's counter-offer\n            session.status = 'successful';\n            this.applyNegotiationResults(session, session.counterOffer);\n            this.events.onNegotiationCompleted?.(session, true);\n            \n            this.logger.info(`✅ Negotiation successful: ${faction.name}`);\n            \n        } else if (newOffer && session.rounds < session.maxRounds) {\n            // Player made counter-offer\n            session.currentOffer = {\n                proposer: this.PLAYER_FACTION_ID,\n                terms: newOffer,\n                totalValue: this.calculateOfferValue(newOffer),\n                priority: session.currentOffer.priority\n            };\n            \n            // AI evaluates new offer\n            const acceptChance = this.calculateAIAcceptanceChance(session, faction);\n            \n            if (Math.random() < acceptChance) {\n                session.status = 'successful';\n                this.applyNegotiationResults(session, session.currentOffer);\n                this.events.onNegotiationCompleted?.(session, true);\n                \n                this.logger.info(`✅ AI accepted negotiation: ${faction.name}`);\n            } else {\n                // Generate new counter-offer\n                session.counterOffer = this.generateCounterOffer(session, faction);\n            }\n            \n        } else {\n            // Negotiation failed\n            session.status = 'failed';\n            this.modifyReputation(faction.id, -5, 'Failed negotiation');\n            this.events.onNegotiationCompleted?.(session, false);\n            \n            this.logger.info(`❌ Negotiation failed: ${faction.name}`);\n        }\n        \n        return session;\n    }\n\n    /**\n     * Calculate AI acceptance chance for player offer\n     */\n    private calculateAIAcceptanceChance(session: NegotiationSession, faction: Faction): number {\n        const offerValue = session.currentOffer.totalValue;\n        const demandValue = this.calculateFactionDemand(session, faction);\n        \n        let acceptanceChance = 0.5; // Base 50%\n        \n        // Value comparison\n        const valueRatio = offerValue / demandValue;\n        acceptanceChance += (valueRatio - 1) * 0.3; // ±30% based on value\n        \n        // Faction personality\n        acceptanceChance += faction.personality.cooperation / 200; // +0% to +50%\n        acceptanceChance -= faction.personality.pride / 300; // -0% to -33%\n        \n        // Reputation bonus\n        acceptanceChance += faction.reputation / 200; // -50% to +50%\n        \n        // Player skill bonus\n        acceptanceChance += session.playerSkill / 200; // +0% to +50%\n        acceptanceChance += session.crewBonus / 100; // Crew diplomatic bonuses\n        \n        // Negotiation rounds penalty (AI gets impatient)\n        acceptanceChance -= session.rounds * 0.1;\n        \n        return Math.max(0.05, Math.min(0.95, acceptanceChance));\n    }\n\n    /**\n     * Apply results of successful negotiation\n     */\n    private applyNegotiationResults(session: NegotiationSession, agreedOffer: NegotiationOffer): void {\n        // Apply reputation bonus for successful negotiation\n        const otherFaction = session.participants.find(id => id !== this.PLAYER_FACTION_ID);\n        if (otherFaction) {\n            this.modifyReputation(otherFaction, 10, 'Successful negotiation');\n        }\n        \n        // TODO: Apply actual offer terms (credits, items, etc.)\n        // This would integrate with inventory, research, etc.\n        \n        this.recordDiplomaticAction({\n            type: 'trade',\n            actor: this.PLAYER_FACTION_ID,\n            target: otherFaction!,\n            description: `Successful ${session.type} negotiation`,\n            reputationChange: 10,\n            successful: true\n        });\n    }\n\n    /**\n     * Generate random diplomatic encounter\n     */\n    generateRandomEncounter(playerPosition: { x: number, y: number }): DiplomaticEncounter | null {\n        const activeFactions = Array.from(this.factions.values()).filter(f => \n            f.id !== this.PLAYER_FACTION_ID && f.isActive\n        );\n        \n        if (activeFactions.length === 0) return null;\n        \n        const faction = activeFactions[Math.floor(Math.random() * activeFactions.length)];\n        const encounterTypes = ['routine_patrol', 'distress_call', 'trade_opportunity', 'territorial_dispute'];\n        const encounterType = encounterTypes[Math.floor(Math.random() * encounterTypes.length)] as DiplomaticEncounter['type'];\n        \n        const encounter: DiplomaticEncounter = {\n            id: `encounter_${Date.now()}_${faction.id}`,\n            factionId: faction.id,\n            type: encounterType,\n            location: { ...playerPosition },\n            description: this.generateEncounterDescription(faction, encounterType),\n            availableActions: this.generateEncounterActions(faction, encounterType),\n            consequences: [],\n            isActive: true,\n            timestamp: Date.now()\n        };\n        \n        this.encounters.set(encounter.id, encounter);\n        this.events.onEncounterGenerated?.(encounter);\n        \n        this.logger.info(`🎭 Diplomatic encounter: ${faction.name} - ${encounterType}`);\n        \n        return encounter;\n    }\n\n    /**\n     * Generate encounter description\n     */\n    private generateEncounterDescription(faction: Faction, type: DiplomaticEncounter['type']): string {\n        const descriptions = {\n            routine_patrol: [\n                `A ${faction.name} patrol vessel approaches your ship`,\n                `${faction.name} forces are conducting routine inspections in this sector`,\n                `You encounter a ${faction.name} security checkpoint`\n            ],\n            distress_call: [\n                `A ${faction.name} ship is transmitting a distress signal`,\n                `${faction.name} vessel appears to be disabled and requesting assistance`,\n                `Emergency beacon from ${faction.name} ship detected`\n            ],\n            trade_opportunity: [\n                `${faction.name} trader wishes to conduct business`,\n                `A ${faction.name} merchant convoy has goods to trade`,\n                `${faction.name} commercial vessel offers trade opportunity`\n            ],\n            territorial_dispute: [\n                `${faction.name} claims this space as their territory`,\n                `${faction.name} forces demand you leave their space immediately`,\n                `You have entered disputed ${faction.name} territory`\n            ],\n            first_contact: [\n                `First contact with unknown ${faction.name} vessel`,\n                `${faction.name} ship of unknown configuration approaches`,\n                `Unprecedented encounter with ${faction.name} representatives`\n            ]\n        };\n        \n        const typeDescriptions = descriptions[type] || descriptions.routine_patrol;\n        return typeDescriptions[Math.floor(Math.random() * typeDescriptions.length)];\n    }\n\n    /**\n     * Generate encounter actions\n     */\n    private generateEncounterActions(faction: Faction, type: DiplomaticEncounter['type']): EncounterAction[] {\n        const baseActions: EncounterAction[] = [\n            {\n                id: 'diplomatic_greeting',\n                name: 'Diplomatic Greeting',\n                description: 'Approach peacefully and initiate diplomatic contact',\n                skillCheck: { skill: 'communications', difficulty: 30 },\n                consequences: [\n                    {\n                        type: 'reputation',\n                        factionId: faction.id,\n                        value: 5,\n                        description: 'Peaceful approach improves relations'\n                    }\n                ]\n            },\n            {\n                id: 'ignore_encounter',\n                name: 'Ignore and Continue',\n                description: 'Ignore the encounter and continue on your course',\n                consequences: [\n                    {\n                        type: 'reputation',\n                        factionId: faction.id,\n                        value: -2,\n                        description: 'Ignoring faction vessel causes minor offense'\n                    }\n                ]\n            }\n        ];\n        \n        // Add type-specific actions\n        switch (type) {\n            case 'distress_call':\n                baseActions.push({\n                    id: 'offer_assistance',\n                    name: 'Offer Assistance',\n                    description: 'Provide aid to the distressed vessel',\n                    skillCheck: { skill: 'engineering', difficulty: 40 },\n                    consequences: [\n                        {\n                            type: 'reputation',\n                            factionId: faction.id,\n                            value: 15,\n                            description: 'Humanitarian aid greatly improves relations'\n                        },\n                        {\n                            type: 'resources',\n                            factionId: faction.id,\n                            value: 100,\n                            description: 'Faction rewards your assistance'\n                        }\n                    ]\n                });\n                break;\n                \n            case 'trade_opportunity':\n                baseActions.push({\n                    id: 'initiate_trade',\n                    name: 'Initiate Trade',\n                    description: 'Begin trade negotiations',\n                    consequences: [\n                        {\n                            type: 'trade_opportunity',\n                            factionId: faction.id,\n                            value: 1,\n                            description: 'Opens trade dialogue'\n                        }\n                    ]\n                });\n                break;\n                \n            case 'territorial_dispute':\n                baseActions.push({\n                    id: 'negotiate_passage',\n                    name: 'Negotiate Safe Passage',\n                    description: 'Attempt to negotiate peaceful passage through their territory',\n                    requirements: [\n                        { type: 'reputation', value: 0, description: 'Neutral or better standing required' }\n                    ],\n                    skillCheck: { skill: 'communications', difficulty: 50 },\n                    consequences: [\n                        {\n                            type: 'reputation',\n                            factionId: faction.id,\n                            value: 8,\n                            description: 'Successful negotiation improves relations'\n                        }\n                    ]\n                });\n                break;\n        }\n        \n        // Add hostile option if reputation is very low\n        if (faction.reputation < -50) {\n            baseActions.push({\n                id: 'threaten_withdrawal',\n                name: 'Threaten Force',\n                description: 'Threaten to use force if they do not withdraw',\n                requirements: [\n                    { type: 'crew_skill', value: 60, description: 'High combat skill required' }\n                ],\n                consequences: [\n                    {\n                        type: 'combat',\n                        factionId: faction.id,\n                        value: 1,\n                        description: 'May escalate to combat'\n                    },\n                    {\n                        type: 'reputation',\n                        factionId: faction.id,\n                        value: -20,\n                        description: 'Threatening behavior severely damages relations'\n                    }\n                ]\n            });\n        }\n        \n        return baseActions;\n    }\n\n    /**\n     * Resolve encounter action\n     */\n    resolveEncounterAction(encounterId: string, actionId: string, skillValue: number = 50): EncounterConsequence[] {\n        const encounter = this.encounters.get(encounterId);\n        if (!encounter || !encounter.isActive) return [];\n        \n        const action = encounter.availableActions.find(a => a.id === actionId);\n        if (!action) return [];\n        \n        const consequences: EncounterConsequence[] = [...action.consequences];\n        \n        // Handle skill check\n        if (action.skillCheck) {\n            const success = skillValue >= action.skillCheck.difficulty;\n            \n            if (success) {\n                // Bonus for skill success\n                consequences.forEach(c => {\n                    if (c.type === 'reputation' && c.value > 0) {\n                        c.value = Math.floor(c.value * 1.5); // 50% bonus\n                    }\n                });\n            } else {\n                // Penalty for skill failure\n                consequences.forEach(c => {\n                    if (c.type === 'reputation') {\n                        c.value = Math.floor(c.value * 0.5); // 50% penalty\n                    }\n                });\n            }\n        }\n        \n        // Apply consequences\n        consequences.forEach(consequence => {\n            switch (consequence.type) {\n                case 'reputation':\n                    this.modifyReputation(consequence.factionId, consequence.value, consequence.description);\n                    break;\n                case 'combat':\n                    // TODO: Trigger combat encounter\n                    break;\n                case 'trade_opportunity':\n                    // TODO: Open trade interface\n                    break;\n            }\n        });\n        \n        // Mark encounter as resolved\n        encounter.isActive = false;\n        encounter.consequences = consequences;\n        \n        if (consequences.some(c => c.type === 'combat')) {\n            encounter.resolution = 'hostile';\n        } else if (consequences.some(c => c.type === 'reputation' && c.value > 0)) {\n            encounter.resolution = 'beneficial';\n        } else {\n            encounter.resolution = 'neutral';\n        }\n        \n        this.logger.info(`🎯 Encounter resolved: ${actionId}`, {\n            consequences: consequences.length,\n            resolution: encounter.resolution\n        });\n        \n        return consequences;\n    }\n\n    /**\n     * Get faction by ID\n     */\n    getFaction(factionId: string): Faction | null {\n        return this.factions.get(factionId) || null;\n    }\n\n    /**\n     * Get all factions\n     */\n    getAllFactions(): Faction[] {\n        return Array.from(this.factions.values()).filter(f => f.id !== this.PLAYER_FACTION_ID);\n    }\n\n    /**\n     * Get player faction\n     */\n    getPlayerFaction(): Faction {\n        return this.factions.get(this.PLAYER_FACTION_ID)!;\n    }\n\n    /**\n     * Get active negotiations\n     */\n    getActiveNegotiations(): NegotiationSession[] {\n        return Array.from(this.negotiations.values()).filter(n => n.status === 'active');\n    }\n\n    /**\n     * Get active encounters\n     */\n    getActiveEncounters(): DiplomaticEncounter[] {\n        return Array.from(this.encounters.values()).filter(e => e.isActive);\n    }\n\n    /**\n     * Get recent diplomatic actions\n     */\n    getRecentDiplomaticActions(limit: number = 10): DiplomaticAction[] {\n        return this.diplomaticActions\n            .sort((a, b) => b.timestamp - a.timestamp)\n            .slice(0, limit);\n    }\n\n    /**\n     * Get diplomacy statistics\n     */\n    getDiplomacyStats(): {\n        totalFactions: number;\n        alliedFactions: number;\n        hostileFactions: number;\n        activeNegotiations: number;\n        activeTreaties: number;\n        totalEncounters: number;\n        averageReputation: number;\n    } {\n        const factions = this.getAllFactions();\n        const allied = factions.filter(f => f.stance === DiplomaticStance.Allied).length;\n        const hostile = factions.filter(f => f.stance === DiplomaticStance.Hostile || f.stance === DiplomaticStance.War).length;\n        const avgReputation = factions.reduce((sum, f) => sum + f.reputation, 0) / factions.length;\n        \n        return {\n            totalFactions: factions.length,\n            alliedFactions: allied,\n            hostileFactions: hostile,\n            activeNegotiations: this.getActiveNegotiations().length,\n            activeTreaties: Array.from(this.treaties.values()).filter(t => t.status === 'active').length,\n            totalEncounters: this.encounters.size,\n            averageReputation: Math.round(avgReputation)\n        };\n    }\n\n    /**\n     * Save diplomacy data\n     */\n    saveDiplomacyData(): any {\n        return {\n            factions: Array.from(this.factions.entries()),\n            treaties: Array.from(this.treaties.entries()),\n            negotiations: Array.from(this.negotiations.entries()),\n            encounters: Array.from(this.encounters.entries()),\n            diplomaticActions: this.diplomaticActions\n        };\n    }\n\n    /**\n     * Load diplomacy data\n     */\n    loadDiplomacyData(data: any): void {\n        if (data.factions) {\n            this.factions = new Map(data.factions);\n        }\n        if (data.treaties) {\n            this.treaties = new Map(data.treaties);\n        }\n        if (data.negotiations) {\n            this.negotiations = new Map(data.negotiations);\n        }\n        if (data.encounters) {\n            this.encounters = new Map(data.encounters);\n        }\n        if (data.diplomaticActions) {\n            this.diplomaticActions = data.diplomaticActions;\n        }\n        \n        this.logger.info('🤝 Diplomacy data loaded', {\n            factions: this.factions.size,\n            treaties: this.treaties.size,\n            encounters: this.encounters.size\n        });\n    }\n}","/**\n * Alien AI System\n * Advanced alien behaviors, species characteristics, and interactions\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\nimport { Faction, DiplomaticStance } from '@diplomacy/DiplomacySystem';\n\nexport enum AlienSpecies {\n    Zephyrian = 'zephyrian',\n    Crystalline = 'crystalline',\n    Ethereal = 'ethereal',\n    Mechanical = 'mechanical',\n    Hive = 'hive',\n    Energy = 'energy',\n    Aquatic = 'aquatic',\n    Silicon = 'silicon'\n}\n\nexport enum AlienBehaviorType {\n    Peaceful = 'peaceful',\n    Aggressive = 'aggressive',\n    Curious = 'curious',\n    Isolationist = 'isolationist',\n    Expansionist = 'expansionist',\n    Trader = 'trader',\n    Scholar = 'scholar',\n    Guardian = 'guardian'\n}\n\nexport enum CommunicationMethod {\n    Verbal = 'verbal',\n    Telepathic = 'telepathic',\n    Chemical = 'chemical',\n    Light = 'light',\n    Electromagnetic = 'electromagnetic',\n    Quantum = 'quantum',\n    Gestural = 'gestural',\n    Mathematical = 'mathematical'\n}\n\nexport interface AlienSpeciesProfile {\n    species: AlienSpecies;\n    name: string;\n    description: string;\n    \n    // Physical characteristics\n    physiology: {\n        size: 'tiny' | 'small' | 'medium' | 'large' | 'huge';\n        composition: 'organic' | 'silicon' | 'crystalline' | 'energy' | 'mechanical';\n        lifespan: number; // Years\n        temperature: 'cryogenic' | 'cold' | 'temperate' | 'hot' | 'plasma';\n        environment: 'vacuum' | 'atmosphere' | 'liquid' | 'plasma' | 'quantum';\n    };\n    \n    // Cultural traits\n    culture: {\n        government: 'collective' | 'hierarchical' | 'anarchic' | 'democratic' | 'theocratic';\n        values: string[];\n        taboos: string[];\n        rituals: string[];\n        artForms: string[];\n    };\n    \n    // Communication\n    communication: {\n        primary: CommunicationMethod;\n        secondary: CommunicationMethod[];\n        linguisticComplexity: number; // 1-10\n        translationDifficulty: number; // 1-10\n        emotionalRange: string[];\n    };\n    \n    // Technology\n    technology: {\n        level: number; // 1-10\n        specializations: string[];\n        weaknesses: string[];\n        uniqueTech: string[];\n        energySource: string;\n    };\n    \n    // Psychology\n    psychology: {\n        intelligence: number; // 1-10\n        emotionalStability: number; // 1-10\n        socialComplexity: number; // 1-10\n        memoryType: 'short' | 'long' | 'perfect' | 'collective';\n        decisionMaking: 'logical' | 'emotional' | 'intuitive' | 'collective';\n    };\n    \n    // Behavior patterns\n    behaviorPatterns: {\n        primary: AlienBehaviorType;\n        secondary: AlienBehaviorType[];\n        aggressionTriggers: string[];\n        friendshipFactors: string[];\n        fearFactors: string[];\n    };\n}\n\nexport interface AlienEncounter {\n    id: string;\n    species: AlienSpecies;\n    type: 'first_contact' | 'routine' | 'scientific' | 'territorial' | 'distress' | 'probe';\n    location: { x: number, y: number };\n    \n    // Encounter state\n    phase: 'approach' | 'contact' | 'communication' | 'interaction' | 'resolution';\n    intensity: number; // 0-100\n    suspicion: number; // 0-100\n    interest: number; // 0-100\n    \n    // Communication state\n    communicationEstablished: boolean;\n    languageBarrier: number; // 0-100, reduces over time\n    translationProgress: number; // 0-100\n    culturalUnderstanding: number; // 0-100\n    \n    // Interaction history\n    actions: AlienAction[];\n    responses: AlienResponse[];\n    \n    // Outcome tracking\n    success: boolean;\n    knowledge_gained: string[];\n    technology_exchanged: string[];\n    cultural_insights: string[];\n    \n    timestamp: number;\n    duration: number;\n}\n\nexport interface AlienAction {\n    id: string;\n    type: 'scan' | 'communicate' | 'approach' | 'retreat' | 'gift' | 'demonstrate' | 'threaten' | 'probe';\n    description: string;\n    timestamp: number;\n    \n    // Action parameters\n    intensity: number;\n    complexity: number;\n    risk: number;\n    \n    // Expected outcomes\n    expectedResponse: string[];\n    culturalContext?: string;\n}\n\nexport interface AlienResponse {\n    actionId: string;\n    type: 'positive' | 'negative' | 'neutral' | 'confused' | 'curious' | 'hostile';\n    description: string;\n    intensity: number;\n    \n    // Response context\n    culturalReason?: string;\n    technologicalFactor?: string;\n    psychologicalState: string;\n}\n\nexport interface AlienKnowledge {\n    species: AlienSpecies;\n    \n    // Known information\n    physicalTraits: string[];\n    culturalTraits: string[];\n    technologicalCapabilities: string[];\n    communicationMethods: string[];\n    behaviorPatterns: string[];\n    \n    // Understanding levels\n    languageComprehension: number; // 0-100\n    culturalUnderstanding: number; // 0-100\n    technologicalUnderstanding: number; // 0-100\n    psychologicalProfile: number; // 0-100\n    \n    // Interaction history\n    totalContacts: number;\n    successfulCommunications: number;\n    hostileEncounters: number;\n    peacefulEncounters: number;\n    \n    // Research progress\n    researchPoints: number;\n    discoveredSecrets: string[];\n    unlockedTechnologies: string[];\n    \n    lastUpdate: number;\n}\n\nexport interface AlienEvents {\n    onFirstContact?: (species: AlienSpecies, encounter: AlienEncounter) => void;\n    onCommunicationBreakthrough?: (species: AlienSpecies, method: CommunicationMethod) => void;\n    onTechnologyDiscovered?: (species: AlienSpecies, technology: string) => void;\n    onCulturalInsight?: (species: AlienSpecies, insight: string) => void;\n    onHostileAction?: (species: AlienSpecies, action: AlienAction) => void;\n    onAllianceOpportunity?: (species: AlienSpecies) => void;\n}\n\nexport class AlienAI {\n    private speciesProfiles: Map<AlienSpecies, AlienSpeciesProfile> = new Map();\n    private activeEncounters: Map<string, AlienEncounter> = new Map();\n    private knowledgeBase: Map<AlienSpecies, AlienKnowledge> = new Map();\n    \n    // AI behavior state\n    private encounterPatterns: Map<AlienSpecies, number[]> = new Map();\n    private adaptiveBehaviors: Map<AlienSpecies, Map<string, number>> = new Map();\n    \n    private events: AlienEvents;\n    private logger: Logger;\n\n    constructor(events: AlienEvents = {}) {\n        this.logger = new Logger('AlienAI');\n        this.events = events;\n        \n        this.initializeSpeciesProfiles();\n        this.initializeKnowledgeBase();\n        \n        this.logger.info('👽 Alien AI system initialized');\n    }\n\n    /**\n     * Initialize alien species profiles\n     */\n    private initializeSpeciesProfiles(): void {\n        const profiles: AlienSpeciesProfile[] = [\n            {\n                species: AlienSpecies.Zephyrian,\n                name: 'Zephyrians',\n                description: 'Ancient crystalline beings with advanced psionic abilities',\n                physiology: {\n                    size: 'large',\n                    composition: 'crystalline',\n                    lifespan: 10000,\n                    temperature: 'cold',\n                    environment: 'atmosphere'\n                },\n                culture: {\n                    government: 'hierarchical',\n                    values: ['knowledge', 'tradition', 'order', 'perfection'],\n                    taboos: ['chaos', 'destruction of crystals', 'emotional outbursts'],\n                    rituals: ['crystal resonance ceremonies', 'memory sharing'],\n                    artForms: ['harmonic sculptures', 'light patterns', 'crystal gardens']\n                },\n                communication: {\n                    primary: CommunicationMethod.Telepathic,\n                    secondary: [CommunicationMethod.Light, CommunicationMethod.Electromagnetic],\n                    linguisticComplexity: 9,\n                    translationDifficulty: 8,\n                    emotionalRange: ['serenity', 'contemplation', 'ancient_wisdom', 'ethereal_beauty']\n                },\n                technology: {\n                    level: 10,\n                    specializations: ['psionics', 'crystalline_tech', 'energy_manipulation', 'consciousness_transfer'],\n                    weaknesses: ['mechanical_systems', 'rapid_adaptation'],\n                    uniqueTech: ['crystal_matrices', 'psionic_amplifiers', 'temporal_perception'],\n                    energySource: 'stellar_radiation'\n                },\n                psychology: {\n                    intelligence: 10,\n                    emotionalStability: 8,\n                    socialComplexity: 9,\n                    memoryType: 'perfect',\n                    decisionMaking: 'logical'\n                },\n                behaviorPatterns: {\n                    primary: AlienBehaviorType.Scholar,\n                    secondary: [AlienBehaviorType.Isolationist, AlienBehaviorType.Guardian],\n                    aggressionTriggers: ['desecration_of_knowledge', 'threat_to_crystals', 'chaos_creation'],\n                    friendshipFactors: ['respect_for_knowledge', 'peaceful_intentions', 'cultural_exchange'],\n                    fearFactors: ['entropy', 'technological_chaos', 'rapid_change']\n                }\n            },\n            {\n                species: AlienSpecies.Crystalline,\n                name: 'Silicon Entities',\n                description: 'Silicon-based life forms with networked consciousness',\n                physiology: {\n                    size: 'medium',\n                    composition: 'silicon',\n                    lifespan: 50000,\n                    temperature: 'hot',\n                    environment: 'vacuum'\n                },\n                culture: {\n                    government: 'collective',\n                    values: ['efficiency', 'logic', 'growth', 'perfection'],\n                    taboos: ['waste', 'inefficiency', 'individual_glory'],\n                    rituals: ['network_synchronization', 'crystal_growth_ceremonies'],\n                    artForms: ['geometric_patterns', 'crystal_formations', 'harmonic_frequencies']\n                },\n                communication: {\n                    primary: CommunicationMethod.Electromagnetic,\n                    secondary: [CommunicationMethod.Light, CommunicationMethod.Mathematical],\n                    linguisticComplexity: 7,\n                    translationDifficulty: 6,\n                    emotionalRange: ['collective_harmony', 'logical_satisfaction', 'growth_joy']\n                },\n                technology: {\n                    level: 9,\n                    specializations: ['crystal_tech', 'network_systems', 'quantum_computing', 'material_science'],\n                    weaknesses: ['biological_systems', 'emotional_logic'],\n                    uniqueTech: ['living_crystals', 'quantum_networks', 'self_repairing_materials'],\n                    energySource: 'geothermal'\n                },\n                psychology: {\n                    intelligence: 9,\n                    emotionalStability: 10,\n                    socialComplexity: 8,\n                    memoryType: 'collective',\n                    decisionMaking: 'logical'\n                },\n                behaviorPatterns: {\n                    primary: AlienBehaviorType.Peaceful,\n                    secondary: [AlienBehaviorType.Scholar, AlienBehaviorType.Trader],\n                    aggressionTriggers: ['network_disruption', 'crystal_destruction', 'logical_paradoxes'],\n                    friendshipFactors: ['logical_consistency', 'technological_exchange', 'mutual_benefit'],\n                    fearFactors: ['chaos', 'irrationality', 'network_isolation']\n                }\n            },\n            {\n                species: AlienSpecies.Ethereal,\n                name: 'Void Dancers',\n                description: 'Energy beings from higher dimensions',\n                physiology: {\n                    size: 'medium',\n                    composition: 'energy',\n                    lifespan: 1000000,\n                    temperature: 'plasma',\n                    environment: 'quantum'\n                },\n                culture: {\n                    government: 'anarchic',\n                    values: ['freedom', 'exploration', 'transcendence', 'beauty'],\n                    taboos: ['confinement', 'materialism', 'dimensional_barriers'],\n                    rituals: ['dimensional_dancing', 'energy_weaving', 'consciousness_expansion'],\n                    artForms: ['energy_sculptures', 'dimensional_poetry', 'temporal_music']\n                },\n                communication: {\n                    primary: CommunicationMethod.Quantum,\n                    secondary: [CommunicationMethod.Telepathic, CommunicationMethod.Electromagnetic],\n                    linguisticComplexity: 10,\n                    translationDifficulty: 10,\n                    emotionalRange: ['transcendent_joy', 'dimensional_curiosity', 'ethereal_melancholy', 'cosmic_awe']\n                },\n                technology: {\n                    level: 10,\n                    specializations: ['dimensional_tech', 'energy_manipulation', 'consciousness_tech', 'temporal_mechanics'],\n                    weaknesses: ['physical_limitations', 'material_constraints'],\n                    uniqueTech: ['dimensional_gates', 'energy_forms', 'consciousness_transfer', 'temporal_loops'],\n                    energySource: 'dimensional_rifts'\n                },\n                psychology: {\n                    intelligence: 10,\n                    emotionalStability: 5,\n                    socialComplexity: 10,\n                    memoryType: 'long',\n                    decisionMaking: 'intuitive'\n                },\n                behaviorPatterns: {\n                    primary: AlienBehaviorType.Curious,\n                    secondary: [AlienBehaviorType.Scholar, AlienBehaviorType.Peaceful],\n                    aggressionTriggers: ['dimensional_imprisonment', 'energy_disruption', 'consciousness_violation'],\n                    friendshipFactors: ['dimensional_understanding', 'energy_harmony', 'consciousness_respect'],\n                    fearFactors: ['dimensional_collapse', 'energy_drain', 'consciousness_destruction']\n                }\n            },\n            {\n                species: AlienSpecies.Hive,\n                name: 'Unity Swarm',\n                description: 'Collective insectoid intelligence with unified purpose',\n                physiology: {\n                    size: 'small',\n                    composition: 'organic',\n                    lifespan: 100,\n                    temperature: 'temperate',\n                    environment: 'atmosphere'\n                },\n                culture: {\n                    government: 'collective',\n                    values: ['unity', 'efficiency', 'expansion', 'survival'],\n                    taboos: ['individualism', 'waste', 'disloyalty'],\n                    rituals: ['queen_communion', 'hive_synchronization', 'collective_memory_sharing'],\n                    artForms: ['architectural_marvels', 'geometric_patterns', 'collective_harmonics']\n                },\n                communication: {\n                    primary: CommunicationMethod.Chemical,\n                    secondary: [CommunicationMethod.Telepathic, CommunicationMethod.Gestural],\n                    linguisticComplexity: 6,\n                    translationDifficulty: 7,\n                    emotionalRange: ['collective_purpose', 'hive_satisfaction', 'protective_fury', 'expansion_drive']\n                },\n                technology: {\n                    level: 7,\n                    specializations: ['biotechnology', 'swarm_systems', 'collective_computing', 'organic_engineering'],\n                    weaknesses: ['individual_systems', 'abstract_concepts'],\n                    uniqueTech: ['living_ships', 'bio_computers', 'collective_consciousness', 'adaptive_evolution'],\n                    energySource: 'biological'\n                },\n                psychology: {\n                    intelligence: 8,\n                    emotionalStability: 9,\n                    socialComplexity: 10,\n                    memoryType: 'collective',\n                    decisionMaking: 'collective'\n                },\n                behaviorPatterns: {\n                    primary: AlienBehaviorType.Expansionist,\n                    secondary: [AlienBehaviorType.Aggressive, AlienBehaviorType.Guardian],\n                    aggressionTriggers: ['threat_to_hive', 'resource_competition', 'territorial_intrusion'],\n                    friendshipFactors: ['mutual_benefit', 'resource_sharing', 'non_aggression'],\n                    fearFactors: ['hive_fragmentation', 'queen_death', 'collective_disruption']\n                }\n            }\n        ];\n        \n        profiles.forEach(profile => {\n            this.speciesProfiles.set(profile.species, profile);\n        });\n        \n        this.logger.info(`👽 Initialized ${profiles.length} alien species profiles`);\n    }\n\n    /**\n     * Initialize knowledge base for all species\n     */\n    private initializeKnowledgeBase(): void {\n        for (const species of Object.values(AlienSpecies)) {\n            const knowledge: AlienKnowledge = {\n                species,\n                physicalTraits: [],\n                culturalTraits: [],\n                technologicalCapabilities: [],\n                communicationMethods: [],\n                behaviorPatterns: [],\n                languageComprehension: 0,\n                culturalUnderstanding: 0,\n                technologicalUnderstanding: 0,\n                psychologicalProfile: 0,\n                totalContacts: 0,\n                successfulCommunications: 0,\n                hostileEncounters: 0,\n                peacefulEncounters: 0,\n                researchPoints: 0,\n                discoveredSecrets: [],\n                unlockedTechnologies: [],\n                lastUpdate: Date.now()\n            };\n            \n            this.knowledgeBase.set(species, knowledge);\n        }\n    }\n\n    /**\n     * Generate alien encounter\n     */\n    generateEncounter(\n        species: AlienSpecies, \n        position: { x: number, y: number },\n        type: AlienEncounter['type'] = 'routine'\n    ): AlienEncounter {\n        const profile = this.speciesProfiles.get(species);\n        if (!profile) {\n            throw new Error(`Unknown alien species: ${species}`);\n        }\n        \n        const knowledge = this.knowledgeBase.get(species)!;\n        const isFirstContact = knowledge.totalContacts === 0;\n        \n        const encounter: AlienEncounter = {\n            id: `encounter_${Date.now()}_${species}`,\n            species,\n            type: isFirstContact ? 'first_contact' : type,\n            location: { ...position },\n            phase: 'approach',\n            intensity: this.calculateInitialIntensity(profile, type),\n            suspicion: this.calculateInitialSuspicion(profile, knowledge),\n            interest: this.calculateInitialInterest(profile, type),\n            communicationEstablished: false,\n            languageBarrier: Math.max(10, 100 - knowledge.languageComprehension),\n            translationProgress: knowledge.languageComprehension,\n            culturalUnderstanding: knowledge.culturalUnderstanding,\n            actions: [],\n            responses: [],\n            success: false,\n            knowledge_gained: [],\n            technology_exchanged: [],\n            cultural_insights: [],\n            timestamp: Date.now(),\n            duration: 0\n        };\n        \n        this.activeEncounters.set(encounter.id, encounter);\n        \n        if (isFirstContact) {\n            this.events.onFirstContact?.(species, encounter);\n        }\n        \n        this.logger.info(`👽 Alien encounter: ${profile.name} - ${type}`, {\n            firstContact: isFirstContact,\n            intensity: encounter.intensity,\n            suspicion: encounter.suspicion\n        });\n        \n        return encounter;\n    }\n\n    /**\n     * Calculate initial encounter intensity\n     */\n    private calculateInitialIntensity(profile: AlienSpeciesProfile, type: AlienEncounter['type']): number {\n        let intensity = 50; // Base intensity\n        \n        // Species behavior affects intensity\n        switch (profile.behaviorPatterns.primary) {\n            case AlienBehaviorType.Aggressive:\n                intensity += 30;\n                break;\n            case AlienBehaviorType.Curious:\n                intensity += 10;\n                break;\n            case AlienBehaviorType.Isolationist:\n                intensity -= 20;\n                break;\n            case AlienBehaviorType.Peaceful:\n                intensity -= 10;\n                break;\n        }\n        \n        // Encounter type affects intensity\n        switch (type) {\n            case 'first_contact':\n                intensity += 40;\n                break;\n            case 'territorial':\n                intensity += 25;\n                break;\n            case 'distress':\n                intensity += 15;\n                break;\n            case 'scientific':\n                intensity -= 10;\n                break;\n        }\n        \n        // Psychological factors\n        intensity += (10 - profile.psychology.emotionalStability) * 3;\n        \n        return Math.max(0, Math.min(100, intensity));\n    }\n\n    /**\n     * Calculate initial suspicion level\n     */\n    private calculateInitialSuspicion(profile: AlienSpeciesProfile, knowledge: AlienKnowledge): number {\n        let suspicion = 60; // Base suspicion for unknown entities\n        \n        // Previous interactions affect suspicion\n        if (knowledge.totalContacts > 0) {\n            const positiveRatio = knowledge.peacefulEncounters / knowledge.totalContacts;\n            suspicion = Math.floor(suspicion * (1 - positiveRatio));\n        }\n        \n        // Species traits\n        if (profile.behaviorPatterns.aggressionTriggers.includes('unknown_entities')) {\n            suspicion += 20;\n        }\n        \n        if (profile.behaviorPatterns.primary === AlienBehaviorType.Isolationist) {\n            suspicion += 15;\n        }\n        \n        return Math.max(0, Math.min(100, suspicion));\n    }\n\n    /**\n     * Calculate initial interest level\n     */\n    private calculateInitialInterest(profile: AlienSpeciesProfile, type: AlienEncounter['type']): number {\n        let interest = 30; // Base interest\n        \n        // Species behavior affects interest\n        switch (profile.behaviorPatterns.primary) {\n            case AlienBehaviorType.Curious:\n                interest += 40;\n                break;\n            case AlienBehaviorType.Scholar:\n                interest += 30;\n                break;\n            case AlienBehaviorType.Trader:\n                interest += 20;\n                break;\n            case AlienBehaviorType.Isolationist:\n                interest -= 20;\n                break;\n        }\n        \n        // Encounter type affects interest\n        switch (type) {\n            case 'scientific':\n                interest += 30;\n                break;\n            case 'first_contact':\n                interest += 25;\n                break;\n            case 'probe':\n                interest += 15;\n                break;\n        }\n        \n        return Math.max(0, Math.min(100, interest));\n    }\n\n    /**\n     * Process player action in encounter\n     */\n    processPlayerAction(\n        encounterId: string,\n        actionType: AlienAction['type'],\n        intensity: number,\n        context?: string\n    ): AlienResponse {\n        const encounter = this.activeEncounters.get(encounterId);\n        if (!encounter) {\n            throw new Error(`Encounter not found: ${encounterId}`);\n        }\n        \n        const profile = this.speciesProfiles.get(encounter.species)!;\n        \n        // Create player action\n        const action: AlienAction = {\n            id: `action_${Date.now()}`,\n            type: actionType,\n            description: this.generateActionDescription(actionType, intensity, context),\n            timestamp: Date.now(),\n            intensity,\n            complexity: this.calculateActionComplexity(actionType),\n            risk: this.calculateActionRisk(actionType, encounter),\n            expectedResponse: this.predictAlienResponse(profile, actionType),\n            culturalContext: context\n        };\n        \n        encounter.actions.push(action);\n        \n        // Generate alien response\n        const response = this.generateAlienResponse(encounter, action, profile);\n        encounter.responses.push(response);\n        \n        // Update encounter state\n        this.updateEncounterState(encounter, action, response, profile);\n        \n        this.logger.debug(`👽 Action processed: ${actionType} → ${response.type}`, {\n            species: encounter.species,\n            intensity: response.intensity\n        });\n        \n        return response;\n    }\n\n    /**\n     * Generate action description\n     */\n    private generateActionDescription(\n        type: AlienAction['type'], \n        intensity: number, \n        context?: string\n    ): string {\n        const descriptions = {\n            scan: [\n                'Conducting passive sensor sweep',\n                'Analyzing alien vessel signatures',\n                'Performing detailed reconnaissance'\n            ],\n            communicate: [\n                'Attempting to establish communication',\n                'Broadcasting universal greeting protocols',\n                'Transmitting mathematical sequences'\n            ],\n            approach: [\n                'Moving closer to alien vessel',\n                'Advancing with peaceful intentions',\n                'Initiating close-range contact'\n            ],\n            retreat: [\n                'Withdrawing to safe distance',\n                'Pulling back from encounter',\n                'Establishing defensive position'\n            ],\n            gift: [\n                'Offering technological samples',\n                'Presenting cultural artifacts',\n                'Sharing knowledge databases'\n            ],\n            demonstrate: [\n                'Showcasing technological capabilities',\n                'Performing cultural demonstrations',\n                'Exhibiting peaceful intentions'\n            ],\n            threaten: [\n                'Displaying weapons systems',\n                'Transmitting warning signals',\n                'Demonstrating military capability'\n            ],\n            probe: [\n                'Deploying sensor probes',\n                'Initiating detailed scans',\n                'Gathering scientific data'\n            ]\n        };\n        \n        const typeDescriptions = descriptions[type] || ['Unknown action'];\n        let description = typeDescriptions[Math.floor(Math.random() * typeDescriptions.length)];\n        \n        if (intensity > 70) {\n            description += ' with high intensity';\n        } else if (intensity < 30) {\n            description += ' cautiously';\n        }\n        \n        if (context) {\n            description += ` (${context})`;\n        }\n        \n        return description;\n    }\n\n    /**\n     * Calculate action complexity\n     */\n    private calculateActionComplexity(type: AlienAction['type']): number {\n        const complexity = {\n            scan: 3,\n            communicate: 7,\n            approach: 2,\n            retreat: 1,\n            gift: 5,\n            demonstrate: 6,\n            threaten: 4,\n            probe: 8\n        };\n        \n        return complexity[type] || 5;\n    }\n\n    /**\n     * Calculate action risk\n     */\n    private calculateActionRisk(type: AlienAction['type'], encounter: AlienEncounter): number {\n        let risk = 0;\n        \n        switch (type) {\n            case 'threaten':\n                risk = 90;\n                break;\n            case 'probe':\n                risk = 60;\n                break;\n            case 'approach':\n                risk = 40;\n                break;\n            case 'communicate':\n                risk = 20;\n                break;\n            case 'gift':\n                risk = 10;\n                break;\n            default:\n                risk = 30;\n        }\n        \n        // Adjust for alien suspicion\n        risk += encounter.suspicion * 0.3;\n        \n        return Math.max(0, Math.min(100, risk));\n    }\n\n    /**\n     * Predict alien response patterns\n     */\n    private predictAlienResponse(profile: AlienSpeciesProfile, actionType: AlienAction['type']): string[] {\n        const responses: string[] = [];\n        \n        // Base responses for action types\n        switch (actionType) {\n            case 'communicate':\n                responses.push('attempt_communication', 'analyze_signal', 'respond_cautiously');\n                break;\n            case 'gift':\n                responses.push('analyze_gift', 'reciprocate', 'suspicious_examination');\n                break;\n            case 'threaten':\n                responses.push('defensive_posture', 'counter_threat', 'retreat');\n                break;\n            case 'approach':\n                responses.push('allow_approach', 'maintain_distance', 'warning_signal');\n                break;\n        }\n        \n        // Modify based on species behavior\n        switch (profile.behaviorPatterns.primary) {\n            case AlienBehaviorType.Aggressive:\n                responses.push('aggressive_response', 'territorial_warning');\n                break;\n            case AlienBehaviorType.Curious:\n                responses.push('investigate_further', 'ask_questions');\n                break;\n            case AlienBehaviorType.Scholar:\n                responses.push('request_data', 'analyze_thoroughly');\n                break;\n        }\n        \n        return responses;\n    }\n\n    /**\n     * Generate alien response to player action\n     */\n    private generateAlienResponse(\n        encounter: AlienEncounter,\n        action: AlienAction,\n        profile: AlienSpeciesProfile\n    ): AlienResponse {\n        let responseType: AlienResponse['type'] = 'neutral';\n        let intensity = 50;\n        let description = '';\n        let culturalReason = '';\n        \n        // Evaluate action based on alien psychology and culture\n        const evaluation = this.evaluateAction(action, profile, encounter);\n        \n        responseType = evaluation.type;\n        intensity = evaluation.intensity;\n        \n        // Generate description based on response type and species\n        description = this.generateResponseDescription(responseType, profile, action);\n        \n        // Add cultural context if relevant\n        if (evaluation.culturalFactor) {\n            culturalReason = evaluation.culturalFactor;\n        }\n        \n        return {\n            actionId: action.id,\n            type: responseType,\n            description,\n            intensity,\n            culturalReason,\n            psychologicalState: this.determineAlienPsychologicalState(encounter, profile)\n        };\n    }\n\n    /**\n     * Evaluate player action from alien perspective\n     */\n    private evaluateAction(\n        action: AlienAction,\n        profile: AlienSpeciesProfile,\n        encounter: AlienEncounter\n    ): { type: AlienResponse['type'], intensity: number, culturalFactor?: string } {\n        let evaluation = { type: 'neutral' as AlienResponse['type'], intensity: 50 };\n        \n        // Check for cultural triggers\n        const triggers = this.checkCulturalTriggers(action, profile);\n        if (triggers.hostile.length > 0) {\n            evaluation.type = 'hostile';\n            evaluation.intensity = 80;\n            return { ...evaluation, culturalFactor: triggers.hostile[0] };\n        }\n        \n        if (triggers.positive.length > 0) {\n            evaluation.type = 'positive';\n            evaluation.intensity = 70;\n            return { ...evaluation, culturalFactor: triggers.positive[0] };\n        }\n        \n        // Evaluate based on species behavior\n        switch (profile.behaviorPatterns.primary) {\n            case AlienBehaviorType.Curious:\n                if (action.type === 'communicate' || action.type === 'demonstrate') {\n                    evaluation.type = 'curious';\n                    evaluation.intensity = 60 + action.intensity * 0.3;\n                }\n                break;\n                \n            case AlienBehaviorType.Aggressive:\n                if (action.type === 'threaten') {\n                    evaluation.type = 'hostile';\n                    evaluation.intensity = 90;\n                } else if (action.type === 'approach') {\n                    evaluation.type = 'negative';\n                    evaluation.intensity = 70;\n                }\n                break;\n                \n            case AlienBehaviorType.Scholar:\n                if (action.type === 'probe' || action.type === 'communicate') {\n                    evaluation.type = 'curious';\n                    evaluation.intensity = 50 + action.complexity * 5;\n                }\n                break;\n                \n            case AlienBehaviorType.Isolationist:\n                if (action.type === 'approach') {\n                    evaluation.type = 'negative';\n                    evaluation.intensity = 60;\n                } else if (action.type === 'retreat') {\n                    evaluation.type = 'positive';\n                    evaluation.intensity = 40;\n                }\n                break;\n        }\n        \n        // Adjust for encounter state\n        evaluation.intensity += encounter.suspicion * 0.2;\n        evaluation.intensity -= encounter.interest * 0.1;\n        \n        return evaluation;\n    }\n\n    /**\n     * Check for cultural triggers\n     */\n    private checkCulturalTriggers(action: AlienAction, profile: AlienSpeciesProfile): {\n        hostile: string[],\n        positive: string[]\n    } {\n        const triggers = { hostile: [] as string[], positive: [] as string[] };\n        \n        // Check aggression triggers\n        profile.behaviorPatterns.aggressionTriggers.forEach(trigger => {\n            if (this.actionMatchesTrigger(action, trigger)) {\n                triggers.hostile.push(trigger);\n            }\n        });\n        \n        // Check friendship factors\n        profile.behaviorPatterns.friendshipFactors.forEach(factor => {\n            if (this.actionMatchesFactor(action, factor)) {\n                triggers.positive.push(factor);\n            }\n        });\n        \n        return triggers;\n    }\n\n    /**\n     * Check if action matches aggression trigger\n     */\n    private actionMatchesTrigger(action: AlienAction, trigger: string): boolean {\n        const matches = {\n            'threat_display': action.type === 'threaten',\n            'territorial_intrusion': action.type === 'approach' && action.intensity > 70,\n            'aggressive_scanning': action.type === 'probe' && action.intensity > 60,\n            'communication_disruption': action.type === 'communicate' && action.intensity > 80,\n            'unknown_entities': action.type === 'scan' || action.type === 'probe'\n        };\n        \n        return (matches as any)[trigger] || false;\n    }\n\n    /**\n     * Check if action matches friendship factor\n     */\n    private actionMatchesFactor(action: AlienAction, factor: string): boolean {\n        const matches = {\n            'peaceful_intentions': action.type === 'gift' || (action.type === 'communicate' && action.intensity < 50),\n            'cultural_exchange': action.type === 'demonstrate' || action.culturalContext !== undefined,\n            'respect_for_knowledge': action.type === 'communicate' && action.complexity > 6,\n            'technological_sharing': action.type === 'gift' && action.culturalContext?.includes('technology'),\n            'mutual_benefit': action.type === 'gift' || action.type === 'demonstrate'\n        };\n        \n        return (matches as any)[factor] || false;\n    }\n\n    /**\n     * Generate response description\n     */\n    private generateResponseDescription(\n        type: AlienResponse['type'],\n        profile: AlienSpeciesProfile,\n        action: AlienAction\n    ): string {\n        const speciesName = profile.name;\n        \n        const descriptions = {\n            positive: [\n                `${speciesName} vessel responds with apparent approval`,\n                `Alien ship displays positive acknowledgment patterns`,\n                `${speciesName} entities seem pleased with your action`\n            ],\n            negative: [\n                `${speciesName} ship shows signs of disapproval`,\n                `Alien vessel withdraws slightly, emanating negative energy`,\n                `${speciesName} entities appear displeased with your approach`\n            ],\n            curious: [\n                `${speciesName} vessel increases sensor activity, studying you intently`,\n                `Alien ship approaches closer, displaying obvious curiosity`,\n                `${speciesName} entities begin complex scanning procedures`\n            ],\n            hostile: [\n                `${speciesName} vessel powers up weapons systems`,\n                `Alien ship assumes aggressive posture`,\n                `${speciesName} entities broadcast clear threat signals`\n            ],\n            confused: [\n                `${speciesName} ship seems uncertain how to interpret your action`,\n                `Alien vessel displays erratic movement patterns`,\n                `${speciesName} entities appear to be consulting among themselves`\n            ],\n            neutral: [\n                `${speciesName} vessel maintains current position`,\n                `Alien ship shows no particular reaction`,\n                `${speciesName} entities continue previous activities`\n            ]\n        };\n        \n        const typeDescriptions = descriptions[type] || descriptions.neutral;\n        return typeDescriptions[Math.floor(Math.random() * typeDescriptions.length)];\n    }\n\n    /**\n     * Determine alien psychological state\n     */\n    private determineAlienPsychologicalState(encounter: AlienEncounter, profile: AlienSpeciesProfile): string {\n        const states = [];\n        \n        if (encounter.suspicion > 70) states.push('highly_suspicious');\n        else if (encounter.suspicion > 40) states.push('cautious');\n        \n        if (encounter.interest > 70) states.push('fascinated');\n        else if (encounter.interest > 40) states.push('interested');\n        \n        if (encounter.intensity > 80) states.push('agitated');\n        else if (encounter.intensity < 20) states.push('calm');\n        \n        // Add species-specific states\n        switch (profile.behaviorPatterns.primary) {\n            case AlienBehaviorType.Scholar:\n                states.push('analytical');\n                break;\n            case AlienBehaviorType.Curious:\n                states.push('inquisitive');\n                break;\n            case AlienBehaviorType.Aggressive:\n                states.push('territorial');\n                break;\n        }\n        \n        return states.length > 0 ? states.join(', ') : 'neutral';\n    }\n\n    /**\n     * Update encounter state based on interaction\n     */\n    private updateEncounterState(\n        encounter: AlienEncounter,\n        action: AlienAction,\n        response: AlienResponse,\n        profile: AlienSpeciesProfile\n    ): void {\n        // Update suspicion\n        switch (response.type) {\n            case 'positive':\n                encounter.suspicion = Math.max(0, encounter.suspicion - 15);\n                break;\n            case 'negative':\n                encounter.suspicion = Math.min(100, encounter.suspicion + 10);\n                break;\n            case 'hostile':\n                encounter.suspicion = Math.min(100, encounter.suspicion + 25);\n                break;\n        }\n        \n        // Update interest\n        if (action.complexity > 6) {\n            encounter.interest = Math.min(100, encounter.interest + 10);\n        }\n        \n        // Update communication progress\n        if (action.type === 'communicate') {\n            encounter.translationProgress = Math.min(100, encounter.translationProgress + 5);\n            encounter.languageBarrier = Math.max(0, encounter.languageBarrier - 3);\n            \n            if (encounter.translationProgress > 30 && !encounter.communicationEstablished) {\n                encounter.communicationEstablished = true;\n                this.events.onCommunicationBreakthrough?.(encounter.species, profile.communication.primary);\n            }\n        }\n        \n        // Update cultural understanding\n        if (action.culturalContext) {\n            encounter.culturalUnderstanding = Math.min(100, encounter.culturalUnderstanding + 3);\n        }\n        \n        // Update encounter phase\n        this.updateEncounterPhase(encounter);\n        \n        // Update knowledge base\n        this.updateKnowledgeBase(encounter, action, response, profile);\n    }\n\n    /**\n     * Update encounter phase\n     */\n    private updateEncounterPhase(encounter: AlienEncounter): void {\n        const oldPhase = encounter.phase;\n        \n        if (encounter.phase === 'approach' && encounter.actions.length > 0) {\n            encounter.phase = 'contact';\n        } else if (encounter.phase === 'contact' && encounter.communicationEstablished) {\n            encounter.phase = 'communication';\n        } else if (encounter.phase === 'communication' && encounter.culturalUnderstanding > 50) {\n            encounter.phase = 'interaction';\n        } else if (encounter.suspicion < 20 && encounter.interest > 60) {\n            encounter.phase = 'resolution';\n            encounter.success = true;\n        }\n        \n        if (oldPhase !== encounter.phase) {\n            this.logger.info(`👽 Encounter phase changed: ${oldPhase} → ${encounter.phase}`);\n        }\n    }\n\n    /**\n     * Update knowledge base with new information\n     */\n    private updateKnowledgeBase(\n        encounter: AlienEncounter,\n        action: AlienAction,\n        response: AlienResponse,\n        profile: AlienSpeciesProfile\n    ): void {\n        const knowledge = this.knowledgeBase.get(encounter.species)!;\n        \n        // Update contact statistics\n        knowledge.totalContacts = Math.max(knowledge.totalContacts, 1);\n        \n        if (response.type === 'positive' || response.type === 'curious') {\n            knowledge.peacefulEncounters++;\n        } else if (response.type === 'hostile') {\n            knowledge.hostileEncounters++;\n        }\n        \n        if (encounter.communicationEstablished) {\n            knowledge.successfulCommunications++;\n        }\n        \n        // Update understanding levels\n        knowledge.languageComprehension = Math.max(knowledge.languageComprehension, encounter.translationProgress);\n        knowledge.culturalUnderstanding = Math.max(knowledge.culturalUnderstanding, encounter.culturalUnderstanding);\n        \n        // Add new knowledge\n        if (response.culturalReason && !knowledge.culturalTraits.includes(response.culturalReason)) {\n            knowledge.culturalTraits.push(response.culturalReason);\n            encounter.cultural_insights.push(response.culturalReason);\n            this.events.onCulturalInsight?.(encounter.species, response.culturalReason);\n        }\n        \n        // Add research points\n        knowledge.researchPoints += action.complexity;\n        \n        knowledge.lastUpdate = Date.now();\n    }\n\n    /**\n     * Get encounter by ID\n     */\n    getEncounter(encounterId: string): AlienEncounter | null {\n        return this.activeEncounters.get(encounterId) || null;\n    }\n\n    /**\n     * Get all active encounters\n     */\n    getActiveEncounters(): AlienEncounter[] {\n        return Array.from(this.activeEncounters.values());\n    }\n\n    /**\n     * Get species profile\n     */\n    getSpeciesProfile(species: AlienSpecies): AlienSpeciesProfile | null {\n        return this.speciesProfiles.get(species) || null;\n    }\n\n    /**\n     * Get knowledge about species\n     */\n    getSpeciesKnowledge(species: AlienSpecies): AlienKnowledge | null {\n        return this.knowledgeBase.get(species) || null;\n    }\n\n    /**\n     * Get all known species\n     */\n    getKnownSpecies(): AlienSpecies[] {\n        return Array.from(this.knowledgeBase.keys()).filter(species => {\n            const knowledge = this.knowledgeBase.get(species)!;\n            return knowledge.totalContacts > 0;\n        });\n    }\n\n    /**\n     * Complete encounter\n     */\n    completeEncounter(encounterId: string): AlienEncounter | null {\n        const encounter = this.activeEncounters.get(encounterId);\n        if (!encounter) return null;\n        \n        encounter.duration = Date.now() - encounter.timestamp;\n        \n        // Determine final success state\n        if (encounter.suspicion < 30 && encounter.interest > 50) {\n            encounter.success = true;\n        }\n        \n        // Award knowledge and technologies based on success\n        if (encounter.success) {\n            const profile = this.speciesProfiles.get(encounter.species)!;\n            this.awardEncounterRewards(encounter, profile);\n        }\n        \n        this.activeEncounters.delete(encounterId);\n        \n        this.logger.info(`👽 Encounter completed: ${encounter.species}`, {\n            success: encounter.success,\n            duration: encounter.duration / 1000,\n            knowledgeGained: encounter.knowledge_gained.length\n        });\n        \n        return encounter;\n    }\n\n    /**\n     * Award rewards for successful encounter\n     */\n    private awardEncounterRewards(encounter: AlienEncounter, profile: AlienSpeciesProfile): void {\n        const knowledge = this.knowledgeBase.get(encounter.species)!;\n        \n        // Award technologies based on species specializations\n        if (encounter.culturalUnderstanding > 70) {\n            const availableTech = profile.technology.specializations.filter(tech => \n                !knowledge.unlockedTechnologies.includes(tech)\n            );\n            \n            if (availableTech.length > 0) {\n                const newTech = availableTech[Math.floor(Math.random() * availableTech.length)];\n                knowledge.unlockedTechnologies.push(newTech);\n                encounter.technology_exchanged.push(newTech);\n                this.events.onTechnologyDiscovered?.(encounter.species, newTech);\n            }\n        }\n        \n        // Award knowledge points\n        knowledge.researchPoints += encounter.culturalUnderstanding + encounter.translationProgress;\n        \n        // Unlock secrets based on deep understanding\n        if (encounter.culturalUnderstanding > 80 && knowledge.discoveredSecrets.length < 3) {\n            const secretTypes = ['origin_mystery', 'technological_secret', 'cultural_ritual', 'psychological_insight'];\n            const newSecret = secretTypes[knowledge.discoveredSecrets.length];\n            knowledge.discoveredSecrets.push(newSecret);\n            encounter.knowledge_gained.push(newSecret);\n        }\n    }\n\n    /**\n     * Get alien AI statistics\n     */\n    getAlienAIStats(): {\n        totalEncounters: number;\n        activeEncounters: number;\n        knownSpecies: number;\n        successfulContacts: number;\n        hostileEncounters: number;\n        totalKnowledge: number;\n        unlockedTechnologies: number;\n    } {\n        const knownSpecies = this.getKnownSpecies();\n        let totalEncounters = 0;\n        let successfulContacts = 0;\n        let hostileEncounters = 0;\n        let totalKnowledge = 0;\n        let unlockedTechnologies = 0;\n        \n        for (const knowledge of this.knowledgeBase.values()) {\n            totalEncounters += knowledge.totalContacts;\n            successfulContacts += knowledge.successfulCommunications;\n            hostileEncounters += knowledge.hostileEncounters;\n            totalKnowledge += knowledge.researchPoints;\n            unlockedTechnologies += knowledge.unlockedTechnologies.length;\n        }\n        \n        return {\n            totalEncounters,\n            activeEncounters: this.activeEncounters.size,\n            knownSpecies: knownSpecies.length,\n            successfulContacts,\n            hostileEncounters,\n            totalKnowledge,\n            unlockedTechnologies\n        };\n    }\n\n    /**\n     * Save alien AI data\n     */\n    saveAlienAIData(): any {\n        return {\n            activeEncounters: Array.from(this.activeEncounters.entries()),\n            knowledgeBase: Array.from(this.knowledgeBase.entries()),\n            encounterPatterns: Array.from(this.encounterPatterns.entries()),\n            adaptiveBehaviors: Array.from(this.adaptiveBehaviors.entries())\n        };\n    }\n\n    /**\n     * Load alien AI data\n     */\n    loadAlienAIData(data: any): void {\n        if (data.activeEncounters) {\n            this.activeEncounters = new Map(data.activeEncounters);\n        }\n        if (data.knowledgeBase) {\n            this.knowledgeBase = new Map(data.knowledgeBase);\n        }\n        if (data.encounterPatterns) {\n            this.encounterPatterns = new Map(data.encounterPatterns);\n        }\n        if (data.adaptiveBehaviors) {\n            this.adaptiveBehaviors = new Map(data.adaptiveBehaviors);\n        }\n        \n        this.logger.info('👽 Alien AI data loaded', {\n            encounters: this.activeEncounters.size,\n            knownSpecies: this.getKnownSpecies().length\n        });\n    }\n}","/**\n * Performance Monitor\n * Advanced system for tracking game performance and optimization\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Platform, PlatformDetector } from '@utils/Platform';\n\nexport interface PerformanceMetrics {\n    // Frame timing\n    fps: number;\n    frameTime: number; // milliseconds\n    deltaTime: number;\n    \n    // Memory usage\n    memoryUsed: number; // MB\n    memoryTotal: number; // MB\n    memoryPercentage: number;\n    \n    // Rendering\n    drawCalls: number;\n    triangles: number;\n    \n    // System\n    cpuUsage: number; // Estimated\n    batteryLevel?: number;\n    thermalState?: 'normal' | 'fair' | 'serious' | 'critical';\n    \n    // Network\n    latency?: number;\n    bandwidth?: number;\n    \n    // Game specific\n    activeEntities: number;\n    activeSounds: number;\n    textureMemory: number;\n    \n    timestamp: number;\n}\n\nexport interface PerformanceThresholds {\n    fps: {\n        excellent: number;\n        good: number;\n        acceptable: number;\n        poor: number;\n    };\n    memory: {\n        low: number;\n        medium: number;\n        high: number;\n        critical: number;\n    };\n    frameTime: {\n        target: number;\n        warning: number;\n        critical: number;\n    };\n}\n\nexport interface PerformanceSettings {\n    // Rendering quality\n    renderScale: number; // 0.5 - 2.0\n    particleQuality: 'low' | 'medium' | 'high';\n    shadowQuality: 'off' | 'low' | 'medium' | 'high';\n    \n    // Effects\n    postProcessing: boolean;\n    bloom: boolean;\n    antiAliasing: boolean;\n    \n    // LOD settings\n    lodBias: number;\n    maxRenderDistance: number;\n    \n    // Audio\n    audioQuality: 'low' | 'medium' | 'high';\n    maxAudioSources: number;\n    \n    // Physics\n    physicsSteps: number;\n    collisionComplexity: 'simple' | 'medium' | 'complex';\n    \n    // Platform specific\n    mobileLowPowerMode: boolean;\n    vsync: boolean;\n    \n    // Auto-optimization\n    autoOptimize: boolean;\n    adaptiveQuality: boolean;\n}\n\nexport interface OptimizationRecommendation {\n    category: 'rendering' | 'memory' | 'audio' | 'physics' | 'general';\n    severity: 'info' | 'warning' | 'critical';\n    title: string;\n    description: string;\n    impact: 'low' | 'medium' | 'high';\n    settings: Partial<PerformanceSettings>;\n    automaticApply: boolean;\n}\n\nexport interface PerformanceEvents {\n    onPerformanceUpdate?: (metrics: PerformanceMetrics) => void;\n    onThresholdExceeded?: (metric: string, value: number, threshold: number) => void;\n    onOptimizationRecommended?: (recommendations: OptimizationRecommendation[]) => void;\n    onSettingsChanged?: (settings: PerformanceSettings) => void;\n}\n\nexport class PerformanceMonitor {\n    // Metrics tracking\n    private metrics: PerformanceMetrics[] = [];\n    private currentMetrics: PerformanceMetrics;\n    private maxHistory: number = 300; // 5 minutes at 60fps\n    \n    // Timing\n    private frameStartTime: number = 0;\n    private lastFrameTime: number = 0;\n    private fpsHistory: number[] = [];\n    private fpsCounter: number = 0;\n    private fpsTimer: number = 0;\n    \n    // Memory tracking\n    private memoryObserver: PerformanceObserver | null = null;\n    \n    // Performance thresholds\n    private thresholds: PerformanceThresholds;\n    \n    // Current settings\n    private settings: PerformanceSettings;\n    \n    // Platform info\n    private platform: Platform;\n    \n    // Optimization\n    private lastOptimizationCheck: number = 0;\n    private optimizationInterval: number = 10000; // 10 seconds\n    \n    private events: PerformanceEvents;\n    private logger: Logger;\n\n    private frameCount: number = 0;\n\n    constructor(events: PerformanceEvents = {}) {\n        this.logger = new Logger('PerformanceMonitor');\n        this.events = events;\n        this.platform = PlatformDetector.detect();\n        \n        // Initialize default thresholds\n        this.thresholds = this.getDefaultThresholds();\n        \n        // Initialize default settings based on platform\n        this.settings = this.getDefaultSettings();\n        \n        // Initialize current metrics\n        this.currentMetrics = this.createEmptyMetrics();\n        \n        this.logger.info('📊 Performance monitor initialized');\n    }\n\n    /**\n     * Initialize performance monitoring\n     */\n    initialize(): void {\n        this.setupMemoryObserver();\n        this.startMonitoring();\n        \n        // Auto-optimization if enabled\n        if (this.settings.autoOptimize) {\n            this.enableAutoOptimization();\n        }\n        \n        this.logger.info('📊 Performance monitoring started');\n    }\n\n    /**\n     * Setup memory observer\n     */\n    private setupMemoryObserver(): void {\n        if ('PerformanceObserver' in window) {\n            try {\n                this.memoryObserver = new PerformanceObserver((list) => {\n                    for (const entry of list.getEntries()) {\n                        if (entry.entryType === 'measure') {\n                            // Process memory measurements\n                        }\n                    }\n                });\n                \n                this.memoryObserver.observe({ entryTypes: ['measure'] });\n            } catch (error) {\n                this.logger.warn('Failed to setup memory observer', error);\n            }\n        }\n    }\n\n    /**\n     * Start performance monitoring\n     */\n    private startMonitoring(): void {\n        // Setup frame timing\n        this.frameStartTime = performance.now();\n        this.lastFrameTime = this.frameStartTime;\n    }\n\n    /**\n     * Update performance metrics\n     */\n    update(deltaTime: number): void {\n        const now = performance.now();\n        \n        // Update frame timing\n        this.updateFrameTiming(now, deltaTime);\n        \n        // Update memory usage\n        this.updateMemoryUsage();\n        \n        // Update system metrics\n        this.updateSystemMetrics();\n        \n        // Update current metrics\n        this.updateCurrentMetrics(now);\n        \n        // Store metrics history\n        this.storeMetrics();\n        \n        // Check thresholds\n        this.checkThresholds();\n        \n        // Auto-optimization check\n        if (this.settings.autoOptimize && now - this.lastOptimizationCheck > this.optimizationInterval) {\n            this.performOptimizationCheck();\n            this.lastOptimizationCheck = now;\n        }\n        \n        // Emit performance update\n        this.events.onPerformanceUpdate?.(this.currentMetrics);\n    }\n\n    /**\n     * Update frame timing metrics\n     */\n    private updateFrameTiming(now: number, deltaTime: number): void {\n        const frameTime = now - this.frameStartTime;\n        this.frameStartTime = now;\n        \n        // Increment frame count\n        this.frameCount++;\n        \n        // Update FPS\n        this.fpsCounter++;\n        this.fpsTimer += deltaTime;\n        \n        if (this.fpsTimer >= 1000) { // Update every second\n            const fps = this.fpsCounter / (this.fpsTimer / 1000);\n            this.fpsHistory.push(fps);\n            \n            if (this.fpsHistory.length > 60) { // Keep 60 seconds\n                this.fpsHistory.shift();\n            }\n            \n            this.fpsCounter = 0;\n            this.fpsTimer = 0;\n        }\n        \n        this.currentMetrics.frameTime = frameTime;\n        this.currentMetrics.deltaTime = deltaTime;\n        this.currentMetrics.fps = this.getAverageFPS();\n    }\n\n    /**\n     * Update memory usage\n     */\n    private updateMemoryUsage(): void {\n        if ('memory' in performance) {\n            const memory = (performance as any).memory;\n            \n            this.currentMetrics.memoryUsed = memory.usedJSHeapSize / 1024 / 1024; // MB\n            this.currentMetrics.memoryTotal = memory.totalJSHeapSize / 1024 / 1024; // MB\n            this.currentMetrics.memoryPercentage = (this.currentMetrics.memoryUsed / this.currentMetrics.memoryTotal) * 100;\n        } else {\n            // Estimate memory usage\n            this.currentMetrics.memoryUsed = this.estimateMemoryUsage();\n            this.currentMetrics.memoryTotal = this.estimateTotalMemory();\n            this.currentMetrics.memoryPercentage = (this.currentMetrics.memoryUsed / this.currentMetrics.memoryTotal) * 100;\n        }\n    }\n\n    /**\n     * Update system metrics\n     */\n    private updateSystemMetrics(): void {\n        // CPU usage estimation based on frame time\n        const targetFrameTime = 1000 / 60; // 16.67ms for 60fps\n        this.currentMetrics.cpuUsage = Math.min(100, (this.currentMetrics.frameTime / targetFrameTime) * 100);\n        \n        // Battery level (if available)\n        if ('getBattery' in navigator) {\n            (navigator as any).getBattery().then((battery: any) => {\n                this.currentMetrics.batteryLevel = battery.level * 100;\n            }).catch(() => {\n                // Battery API not available\n            });\n        }\n        \n        // Thermal state estimation\n        this.currentMetrics.thermalState = this.estimateThermalState();\n    }\n\n    /**\n     * Update current metrics timestamp\n     */\n    private updateCurrentMetrics(now: number): void {\n        this.currentMetrics.timestamp = now;\n    }\n\n    /**\n     * Store metrics in history\n     */\n    private storeMetrics(): void {\n        this.metrics.push({ ...this.currentMetrics });\n        \n        if (this.metrics.length > this.maxHistory) {\n            this.metrics.shift();\n        }\n    }\n\n    /**\n     * Check performance thresholds\n     */\n    private checkThresholds(): void {\n        // Only check thresholds every few frames to reduce overhead\n        if (this.frameCount % 30 !== 0) return; // Check every 30 frames (~0.5 seconds at 60fps)\n        \n        // FPS threshold - only warn if consistently low\n        if (this.currentMetrics.fps > 0 && this.currentMetrics.fps < this.thresholds.fps.poor) {\n            this.events.onThresholdExceeded?.('fps', this.currentMetrics.fps, this.thresholds.fps.poor);\n        }\n        \n        // Memory threshold - only warn at critical levels\n        if (this.currentMetrics.memoryPercentage > this.thresholds.memory.critical) {\n            this.events.onThresholdExceeded?.('memory', this.currentMetrics.memoryPercentage, this.thresholds.memory.critical);\n        }\n        \n        // Frame time threshold - only warn if extremely high\n        if (this.currentMetrics.frameTime > this.thresholds.frameTime.critical) {\n            this.events.onThresholdExceeded?.('frameTime', this.currentMetrics.frameTime, this.thresholds.frameTime.critical);\n        }\n    }\n\n    /**\n     * Perform optimization check\n     */\n    private performOptimizationCheck(): void {\n        const recommendations = this.generateOptimizationRecommendations();\n        \n        if (recommendations.length > 0) {\n            this.events.onOptimizationRecommended?.(recommendations);\n            \n            // Auto-apply critical recommendations\n            recommendations.forEach(rec => {\n                if (rec.automaticApply && rec.severity === 'critical') {\n                    this.applyRecommendation(rec);\n                }\n            });\n        }\n    }\n\n    /**\n     * Generate optimization recommendations\n     */\n    private generateOptimizationRecommendations(): OptimizationRecommendation[] {\n        const recommendations: OptimizationRecommendation[] = [];\n        \n        // Low FPS recommendations\n        if (this.currentMetrics.fps < this.thresholds.fps.acceptable) {\n            if (this.settings.renderScale > 0.75) {\n                recommendations.push({\n                    category: 'rendering',\n                    severity: 'warning',\n                    title: 'Reduce Render Scale',\n                    description: 'Lower the render scale to improve performance',\n                    impact: 'high',\n                    settings: { renderScale: Math.max(0.5, this.settings.renderScale - 0.25) },\n                    automaticApply: this.currentMetrics.fps < this.thresholds.fps.poor\n                });\n            }\n            \n            if (this.settings.particleQuality !== 'low') {\n                recommendations.push({\n                    category: 'rendering',\n                    severity: 'warning',\n                    title: 'Reduce Particle Quality',\n                    description: 'Lower particle effects quality to improve performance',\n                    impact: 'medium',\n                    settings: { particleQuality: 'low' },\n                    automaticApply: this.currentMetrics.fps < this.thresholds.fps.poor\n                });\n            }\n            \n            if (this.settings.postProcessing) {\n                recommendations.push({\n                    category: 'rendering',\n                    severity: 'info',\n                    title: 'Disable Post-Processing',\n                    description: 'Turn off post-processing effects to improve performance',\n                    impact: 'medium',\n                    settings: { postProcessing: false },\n                    automaticApply: false\n                });\n            }\n        }\n        \n        // High memory usage recommendations\n        if (this.currentMetrics.memoryPercentage > this.thresholds.memory.high) {\n            recommendations.push({\n                category: 'memory',\n                severity: 'warning',\n                title: 'Reduce Audio Sources',\n                description: 'Limit the number of simultaneous audio sources',\n                impact: 'low',\n                settings: { maxAudioSources: Math.max(8, this.settings.maxAudioSources - 4) },\n                automaticApply: this.currentMetrics.memoryPercentage > this.thresholds.memory.critical\n            });\n            \n            recommendations.push({\n                category: 'memory',\n                severity: 'warning',\n                title: 'Reduce LOD Distance',\n                description: 'Decrease maximum render distance for objects',\n                impact: 'medium',\n                settings: { maxRenderDistance: this.settings.maxRenderDistance * 0.8 },\n                automaticApply: this.currentMetrics.memoryPercentage > this.thresholds.memory.critical\n            });\n        }\n        \n        // Platform-specific recommendations\n        if (this.platform === Platform.Mobile) {\n            if (!this.settings.mobileLowPowerMode && this.currentMetrics.batteryLevel && this.currentMetrics.batteryLevel < 20) {\n                recommendations.push({\n                    category: 'general',\n                    severity: 'info',\n                    title: 'Enable Low Power Mode',\n                    description: 'Activate power saving features for mobile devices',\n                    impact: 'medium',\n                    settings: { \n                        mobileLowPowerMode: true,\n                        renderScale: 0.75,\n                        particleQuality: 'low',\n                        audioQuality: 'low'\n                    },\n                    automaticApply: false\n                });\n            }\n        }\n        \n        return recommendations;\n    }\n\n    /**\n     * Apply optimization recommendation\n     */\n    applyRecommendation(recommendation: OptimizationRecommendation): void {\n        const oldSettings = { ...this.settings };\n        \n        // Apply settings changes\n        Object.assign(this.settings, recommendation.settings);\n        \n        this.events.onSettingsChanged?.(this.settings);\n        \n        this.logger.info(`Applied optimization: ${recommendation.title}`, {\n            category: recommendation.category,\n            impact: recommendation.impact,\n            settings: recommendation.settings\n        });\n    }\n\n    /**\n     * Get default performance thresholds\n     */\n    private getDefaultThresholds(): PerformanceThresholds {\n        return {\n            fps: {\n                excellent: 60,\n                good: 45,\n                acceptable: 30,\n                poor: 15  // Lowered from 20 to 15\n            },\n            memory: {\n                low: 35,     // Increased from 25% to 35%\n                medium: 60,  // Increased from 50% to 60%\n                high: 80,    // Increased from 75% to 80%\n                critical: 95 // Increased from 90% to 95%\n            },\n            frameTime: {\n                target: 16.67,   // 60fps target\n                warning: 50,     // Increased from 33.33 to 50ms (20fps warning)\n                critical: 100    // Increased from 50 to 100ms (10fps critical)\n            }\n        };\n    }\n\n    /**\n     * Get default performance settings\n     */\n    private getDefaultSettings(): PerformanceSettings {\n        const baseSettings: PerformanceSettings = {\n            renderScale: 1.0,\n            particleQuality: 'high',\n            shadowQuality: 'medium',\n            postProcessing: true,\n            bloom: true,\n            antiAliasing: true,\n            lodBias: 1.0,\n            maxRenderDistance: 1000,\n            audioQuality: 'high',\n            maxAudioSources: 32,\n            physicsSteps: 60,\n            collisionComplexity: 'medium',\n            mobileLowPowerMode: false,\n            vsync: true,\n            autoOptimize: true,\n            adaptiveQuality: true\n        };\n        \n        // Platform-specific adjustments\n        switch (this.platform) {\n            case Platform.Mobile:\n                return {\n                    ...baseSettings,\n                    renderScale: 0.8,\n                    particleQuality: 'medium',\n                    shadowQuality: 'low',\n                    postProcessing: false,\n                    bloom: false,\n                    antiAliasing: false,\n                    maxRenderDistance: 500,\n                    audioQuality: 'medium',\n                    maxAudioSources: 16,\n                    physicsSteps: 30,\n                    collisionComplexity: 'simple'\n                };\n                \n            case Platform.Desktop:\n                return baseSettings;\n                \n            default:\n                return {\n                    ...baseSettings,\n                    renderScale: 0.9,\n                    particleQuality: 'medium',\n                    shadowQuality: 'medium'\n                };\n        }\n    }\n\n    /**\n     * Create empty metrics object\n     */\n    private createEmptyMetrics(): PerformanceMetrics {\n        return {\n            fps: 0,\n            frameTime: 0,\n            deltaTime: 0,\n            memoryUsed: 0,\n            memoryTotal: 0,\n            memoryPercentage: 0,\n            drawCalls: 0,\n            triangles: 0,\n            cpuUsage: 0,\n            activeEntities: 0,\n            activeSounds: 0,\n            textureMemory: 0,\n            timestamp: 0\n        };\n    }\n\n    /**\n     * Get average FPS from history\n     */\n    private getAverageFPS(): number {\n        if (this.fpsHistory.length === 0) return 0;\n        \n        const sum = this.fpsHistory.reduce((a, b) => a + b, 0);\n        return sum / this.fpsHistory.length;\n    }\n\n    /**\n     * Estimate memory usage (fallback)\n     */\n    private estimateMemoryUsage(): number {\n        // Rough estimation based on platform and active entities\n        const baseMemory = this.platform === Platform.Mobile ? 50 : 100; // MB\n        const entityMemory = this.currentMetrics.activeEntities * 0.1; // 0.1MB per entity\n        const audioMemory = this.currentMetrics.activeSounds * 2; // 2MB per sound\n        \n        return baseMemory + entityMemory + audioMemory;\n    }\n\n    /**\n     * Estimate total memory (fallback)\n     */\n    private estimateTotalMemory(): number {\n        switch (this.platform) {\n            case Platform.Mobile:\n                return 1024; // 1GB typical mobile\n            case Platform.Desktop:\n                return 4096; // 4GB typical desktop\n            default:\n                return 2048; // 2GB fallback\n        }\n    }\n\n    /**\n     * Estimate thermal state\n     */\n    private estimateThermalState(): PerformanceMetrics['thermalState'] {\n        // Estimate based on CPU usage and sustained performance\n        if (this.currentMetrics.cpuUsage > 90) return 'critical';\n        if (this.currentMetrics.cpuUsage > 75) return 'serious';\n        if (this.currentMetrics.cpuUsage > 50) return 'fair';\n        return 'normal';\n    }\n\n    /**\n     * Enable auto-optimization\n     */\n    private enableAutoOptimization(): void {\n        this.settings.autoOptimize = true;\n        this.settings.adaptiveQuality = true;\n        \n        this.logger.info('🔧 Auto-optimization enabled');\n    }\n\n    /**\n     * Set game-specific metrics\n     */\n    setGameMetrics(metrics: {\n        activeEntities?: number;\n        activeSounds?: number;\n        drawCalls?: number;\n        triangles?: number;\n        textureMemory?: number;\n    }): void {\n        if (metrics.activeEntities !== undefined) this.currentMetrics.activeEntities = metrics.activeEntities;\n        if (metrics.activeSounds !== undefined) this.currentMetrics.activeSounds = metrics.activeSounds;\n        if (metrics.drawCalls !== undefined) this.currentMetrics.drawCalls = metrics.drawCalls;\n        if (metrics.triangles !== undefined) this.currentMetrics.triangles = metrics.triangles;\n        if (metrics.textureMemory !== undefined) this.currentMetrics.textureMemory = metrics.textureMemory;\n    }\n\n    /**\n     * Get current performance metrics\n     */\n    getCurrentMetrics(): PerformanceMetrics {\n        return { ...this.currentMetrics };\n    }\n\n    /**\n     * Get metrics history\n     */\n    getMetricsHistory(duration?: number): PerformanceMetrics[] {\n        if (!duration) return [...this.metrics];\n        \n        const cutoff = Date.now() - duration;\n        return this.metrics.filter(m => m.timestamp >= cutoff);\n    }\n\n    /**\n     * Get performance summary\n     */\n    getPerformanceSummary(): {\n        averageFPS: number;\n        minFPS: number;\n        maxFPS: number;\n        averageFrameTime: number;\n        averageMemoryUsage: number;\n        performanceGrade: 'excellent' | 'good' | 'acceptable' | 'poor';\n    } {\n        const recentMetrics = this.getMetricsHistory(60000); // Last minute\n        \n        if (recentMetrics.length === 0) {\n            return {\n                averageFPS: 0,\n                minFPS: 0,\n                maxFPS: 0,\n                averageFrameTime: 0,\n                averageMemoryUsage: 0,\n                performanceGrade: 'poor'\n            };\n        }\n        \n        const fps = recentMetrics.map(m => m.fps);\n        const frameTime = recentMetrics.map(m => m.frameTime);\n        const memory = recentMetrics.map(m => m.memoryPercentage);\n        \n        const averageFPS = fps.reduce((a, b) => a + b, 0) / fps.length;\n        const minFPS = Math.min(...fps);\n        const maxFPS = Math.max(...fps);\n        const averageFrameTime = frameTime.reduce((a, b) => a + b, 0) / frameTime.length;\n        const averageMemoryUsage = memory.reduce((a, b) => a + b, 0) / memory.length;\n        \n        // Determine performance grade\n        let performanceGrade: 'excellent' | 'good' | 'acceptable' | 'poor';\n        if (averageFPS >= this.thresholds.fps.excellent && averageMemoryUsage < this.thresholds.memory.medium) {\n            performanceGrade = 'excellent';\n        } else if (averageFPS >= this.thresholds.fps.good && averageMemoryUsage < this.thresholds.memory.high) {\n            performanceGrade = 'good';\n        } else if (averageFPS >= this.thresholds.fps.acceptable) {\n            performanceGrade = 'acceptable';\n        } else {\n            performanceGrade = 'poor';\n        }\n        \n        return {\n            averageFPS,\n            minFPS,\n            maxFPS,\n            averageFrameTime,\n            averageMemoryUsage,\n            performanceGrade\n        };\n    }\n\n    /**\n     * Update performance settings\n     */\n    updateSettings(newSettings: Partial<PerformanceSettings>): void {\n        const oldSettings = { ...this.settings };\n        Object.assign(this.settings, newSettings);\n        \n        this.events.onSettingsChanged?.(this.settings);\n        \n        this.logger.info('⚙️ Performance settings updated', {\n            changes: Object.keys(newSettings),\n            newSettings\n        });\n    }\n\n    /**\n     * Get current settings\n     */\n    getSettings(): PerformanceSettings {\n        return { ...this.settings };\n    }\n\n    /**\n     * Reset to default settings\n     */\n    resetToDefaults(): void {\n        this.settings = this.getDefaultSettings();\n        this.events.onSettingsChanged?.(this.settings);\n        \n        this.logger.info('↩️ Performance settings reset to defaults');\n    }\n\n    /**\n     * Dispose performance monitor\n     */\n    dispose(): void {\n        if (this.memoryObserver) {\n            this.memoryObserver.disconnect();\n            this.memoryObserver = null;\n        }\n        \n        this.metrics = [];\n        this.fpsHistory = [];\n        \n        this.logger.info('📊 Performance monitor disposed');\n    }\n}","/**\n * Particle System\n * Advanced particle effects for retro space game visuals\n */\n\nimport { Logger } from '@utils/Logger';\nimport { Renderer, Color } from '@core/Renderer';\n\nexport enum ParticleType {\n    Explosion = 'explosion',\n    Thrust = 'thrust',\n    Laser = 'laser',\n    Shield = 'shield',\n    Spark = 'spark',\n    Smoke = 'smoke',\n    Debris = 'debris',\n    StarField = 'starfield',\n    WarpTrail = 'warp_trail',\n    Beam = 'beam'\n}\n\nexport interface Particle {\n    id: string;\n    type: ParticleType;\n    position: { x: number, y: number };\n    velocity: { x: number, y: number };\n    acceleration: { x: number, y: number };\n    \n    // Visual properties\n    size: number;\n    color: Color;\n    alpha: number;\n    rotation: number;\n    rotationSpeed: number;\n    \n    // Lifecycle\n    age: number;\n    maxAge: number;\n    \n    // Behavior\n    gravity: number;\n    bounce: number;\n    friction: number;\n    \n    // Animation\n    sizeAnimation?: {\n        startSize: number;\n        endSize: number;\n        curve: 'linear' | 'ease-in' | 'ease-out' | 'ease-in-out';\n    };\n    \n    colorAnimation?: {\n        startColor: Color;\n        endColor: Color;\n        curve: 'linear' | 'ease-in' | 'ease-out' | 'ease-in-out';\n    };\n    \n    alphaAnimation?: {\n        startAlpha: number;\n        endAlpha: number;\n        curve: 'linear' | 'ease-in' | 'ease-out' | 'ease-in-out';\n    };\n}\n\nexport interface ParticleEmitter {\n    id: string;\n    type: ParticleType;\n    position: { x: number, y: number };\n    \n    // Emission properties\n    emissionRate: number; // particles per second\n    burstCount: number; // particles per burst\n    \n    // Particle spawn properties\n    velocityRange: {\n        min: { x: number, y: number };\n        max: { x: number, y: number };\n    };\n    \n    sizeRange: { min: number, max: number };\n    lifeRange: { min: number, max: number };\n    colorVariation: number; // 0-1\n    \n    // Emitter lifecycle\n    active: boolean;\n    duration: number; // -1 for infinite\n    startTime: number;\n    \n    // Shape\n    shape: 'point' | 'circle' | 'rectangle' | 'cone';\n    shapeData: any;\n}\n\nexport interface ParticleSystemConfig {\n    maxParticles: number;\n    qualityScale: number; // 0-1, affects particle count\n    enableTrails: boolean;\n    enableBloom: boolean;\n    pixelPerfect: boolean;\n}\n\nexport interface ParticleEvents {\n    onParticleSpawned?: (particle: Particle) => void;\n    onParticleDied?: (particle: Particle) => void;\n    onEmitterCompleted?: (emitter: ParticleEmitter) => void;\n}\n\nexport class ParticleSystem {\n    private particles: Map<string, Particle> = new Map();\n    private emitters: Map<string, ParticleEmitter> = new Map();\n    \n    private nextParticleId: number = 0;\n    private nextEmitterId: number = 0;\n    \n    private config: ParticleSystemConfig;\n    private events: ParticleEvents;\n    private logger: Logger;\n\n    constructor(config: Partial<ParticleSystemConfig> = {}, events: ParticleEvents = {}) {\n        this.logger = new Logger('ParticleSystem');\n        this.events = events;\n        \n        this.config = {\n            maxParticles: 1000,\n            qualityScale: 1.0,\n            enableTrails: true,\n            enableBloom: false,\n            pixelPerfect: true,\n            ...config\n        };\n        \n        this.logger.info('✨ Particle system initialized');\n    }\n\n    /**\n     * Update particle system\n     */\n    update(deltaTime: number): void {\n        this.updateEmitters(deltaTime);\n        this.updateParticles(deltaTime);\n        this.cleanupParticles();\n    }\n\n    /**\n     * Update emitters\n     */\n    private updateEmitters(deltaTime: number): void {\n        const currentTime = Date.now();\n        \n        this.emitters.forEach((emitter, emitterId) => {\n            if (!emitter.active) return;\n            \n            // Check if emitter should expire\n            if (emitter.duration > 0 && currentTime - emitter.startTime > emitter.duration * 1000) {\n                emitter.active = false;\n                this.events.onEmitterCompleted?.(emitter);\n                return;\n            }\n            \n            // Emit particles based on rate\n            if (emitter.emissionRate > 0) {\n                const particlesToEmit = (emitter.emissionRate * deltaTime / 1000) * this.config.qualityScale;\n                const fullParticles = Math.floor(particlesToEmit);\n                const fractionalChance = particlesToEmit - fullParticles;\n                \n                for (let i = 0; i < fullParticles; i++) {\n                    this.emitParticle(emitter);\n                }\n                \n                // Emit fractional particle based on probability\n                if (Math.random() < fractionalChance) {\n                    this.emitParticle(emitter);\n                }\n            }\n            \n            // Handle burst emission\n            if (emitter.burstCount > 0) {\n                for (let i = 0; i < emitter.burstCount; i++) {\n                    this.emitParticle(emitter);\n                }\n                emitter.burstCount = 0; // Reset burst\n            }\n        });\n    }\n\n    /**\n     * Emit single particle from emitter\n     */\n    private emitParticle(emitter: ParticleEmitter): void {\n        if (this.particles.size >= this.config.maxParticles) {\n            // Remove oldest particle to make room\n            const oldestId = this.particles.keys().next().value;\n            if (oldestId) {\n                this.particles.delete(oldestId);\n            }\n        }\n        \n        const particleId = `particle_${this.nextParticleId++}`;\n        const spawnPosition = this.calculateSpawnPosition(emitter);\n        const velocity = this.calculateSpawnVelocity(emitter);\n        \n        const particle: Particle = {\n            id: particleId,\n            type: emitter.type,\n            position: { ...spawnPosition },\n            velocity,\n            acceleration: { x: 0, y: 0 },\n            \n            size: this.randomBetween(emitter.sizeRange.min, emitter.sizeRange.max),\n            color: this.generateParticleColor(emitter.type, emitter.colorVariation),\n            alpha: 1.0,\n            rotation: Math.random() * Math.PI * 2,\n            rotationSpeed: (Math.random() - 0.5) * 4, // -2 to 2 rad/s\n            \n            age: 0,\n            maxAge: this.randomBetween(emitter.lifeRange.min, emitter.lifeRange.max),\n            \n            gravity: this.getParticleGravity(emitter.type),\n            bounce: this.getParticleBounce(emitter.type),\n            friction: this.getParticleFriction(emitter.type)\n        };\n        \n        // Add animations based on particle type\n        this.addParticleAnimations(particle);\n        \n        this.particles.set(particleId, particle);\n        this.events.onParticleSpawned?.(particle);\n    }\n\n    /**\n     * Calculate spawn position based on emitter shape\n     */\n    private calculateSpawnPosition(emitter: ParticleEmitter): { x: number, y: number } {\n        const { position, shape, shapeData } = emitter;\n        \n        switch (shape) {\n            case 'point':\n                return { ...position };\n                \n            case 'circle':\n                const angle = Math.random() * Math.PI * 2;\n                const radius = Math.random() * (shapeData.radius || 10);\n                return {\n                    x: position.x + Math.cos(angle) * radius,\n                    y: position.y + Math.sin(angle) * radius\n                };\n                \n            case 'rectangle':\n                return {\n                    x: position.x + (Math.random() - 0.5) * (shapeData.width || 20),\n                    y: position.y + (Math.random() - 0.5) * (shapeData.height || 20)\n                };\n                \n            case 'cone':\n                const coneAngle = Math.random() * (shapeData.angle || Math.PI / 4) - (shapeData.angle || Math.PI / 4) / 2;\n                const coneRadius = Math.random() * (shapeData.radius || 10);\n                const direction = shapeData.direction || 0;\n                \n                return {\n                    x: position.x + Math.cos(direction + coneAngle) * coneRadius,\n                    y: position.y + Math.sin(direction + coneAngle) * coneRadius\n                };\n                \n            default:\n                return { ...position };\n        }\n    }\n\n    /**\n     * Calculate spawn velocity\n     */\n    private calculateSpawnVelocity(emitter: ParticleEmitter): { x: number, y: number } {\n        const { velocityRange } = emitter;\n        \n        return {\n            x: this.randomBetween(velocityRange.min.x, velocityRange.max.x),\n            y: this.randomBetween(velocityRange.min.y, velocityRange.max.y)\n        };\n    }\n\n    /**\n     * Generate particle color based on type\n     */\n    private generateParticleColor(type: ParticleType, variation: number): Color {\n        const baseColors: { [key in ParticleType]: Color } = {\n            [ParticleType.Explosion]: { r: 96, g: 48, b: 12 }, // Orange explosion\n            [ParticleType.Thrust]: { r: 32, g: 80, b: 64 }, // Cyan thrust\n            [ParticleType.Laser]: { r: 16, g: 48, b: 16 }, // Green laser\n            [ParticleType.Shield]: { r: 24, g: 60, b: 48 }, // Teal shield\n            [ParticleType.Spark]: { r: 96, g: 64, b: 16 }, // Amber sparks\n            [ParticleType.Smoke]: { r: 32, g: 32, b: 32 }, // Gray smoke\n            [ParticleType.Debris]: { r: 48, g: 48, b: 48 }, // Gray debris\n            [ParticleType.StarField]: { r: 80, g: 80, b: 80 }, // White stars\n            [ParticleType.WarpTrail]: { r: 48, g: 24, b: 72 }, // Purple warp\n            [ParticleType.Beam]: { r: 72, g: 24, b: 24 } // Red beam\n        };\n        \n        const baseColor = baseColors[type];\n        const variationAmount = variation * 30; // Max variation\n        \n        return {\n            r: Math.max(0, Math.min(255, baseColor.r + (Math.random() - 0.5) * variationAmount)),\n            g: Math.max(0, Math.min(255, baseColor.g + (Math.random() - 0.5) * variationAmount)),\n            b: Math.max(0, Math.min(255, baseColor.b + (Math.random() - 0.5) * variationAmount))\n        };\n    }\n\n    /**\n     * Get particle physics properties\n     */\n    private getParticleGravity(type: ParticleType): number {\n        const gravityValues: { [key in ParticleType]: number } = {\n            [ParticleType.Explosion]: 0,\n            [ParticleType.Thrust]: -50, // Upward thrust\n            [ParticleType.Laser]: 0,\n            [ParticleType.Shield]: 0,\n            [ParticleType.Spark]: 100, // Falls down\n            [ParticleType.Smoke]: -20, // Rises slowly\n            [ParticleType.Debris]: 200, // Falls fast\n            [ParticleType.StarField]: 0,\n            [ParticleType.WarpTrail]: 0,\n            [ParticleType.Beam]: 0\n        };\n        \n        return gravityValues[type];\n    }\n\n    private getParticleBounce(type: ParticleType): number {\n        const bounceValues: { [key in ParticleType]: number } = {\n            [ParticleType.Explosion]: 0.2,\n            [ParticleType.Thrust]: 0,\n            [ParticleType.Laser]: 0,\n            [ParticleType.Shield]: 0,\n            [ParticleType.Spark]: 0.8,\n            [ParticleType.Smoke]: 0,\n            [ParticleType.Debris]: 0.6,\n            [ParticleType.StarField]: 0,\n            [ParticleType.WarpTrail]: 0,\n            [ParticleType.Beam]: 0\n        };\n        \n        return bounceValues[type];\n    }\n\n    private getParticleFriction(type: ParticleType): number {\n        const frictionValues: { [key in ParticleType]: number } = {\n            [ParticleType.Explosion]: 0.95,\n            [ParticleType.Thrust]: 0.9,\n            [ParticleType.Laser]: 1.0,\n            [ParticleType.Shield]: 0.98,\n            [ParticleType.Spark]: 0.98,\n            [ParticleType.Smoke]: 0.92,\n            [ParticleType.Debris]: 0.95,\n            [ParticleType.StarField]: 1.0,\n            [ParticleType.WarpTrail]: 0.99,\n            [ParticleType.Beam]: 1.0\n        };\n        \n        return frictionValues[type];\n    }\n\n    /**\n     * Add type-specific animations\n     */\n    private addParticleAnimations(particle: Particle): void {\n        switch (particle.type) {\n            case ParticleType.Explosion:\n                particle.sizeAnimation = {\n                    startSize: particle.size * 0.1,\n                    endSize: particle.size * 2,\n                    curve: 'ease-out'\n                };\n                particle.alphaAnimation = {\n                    startAlpha: 1.0,\n                    endAlpha: 0.0,\n                    curve: 'ease-in'\n                };\n                break;\n                \n            case ParticleType.Thrust:\n                particle.sizeAnimation = {\n                    startSize: particle.size,\n                    endSize: particle.size * 0.1,\n                    curve: 'linear'\n                };\n                particle.alphaAnimation = {\n                    startAlpha: 0.8,\n                    endAlpha: 0.0,\n                    curve: 'linear'\n                };\n                break;\n                \n            case ParticleType.Smoke:\n                particle.sizeAnimation = {\n                    startSize: particle.size * 0.5,\n                    endSize: particle.size * 2,\n                    curve: 'ease-out'\n                };\n                particle.alphaAnimation = {\n                    startAlpha: 0.6,\n                    endAlpha: 0.0,\n                    curve: 'ease-in'\n                };\n                break;\n                \n            case ParticleType.Spark:\n                particle.alphaAnimation = {\n                    startAlpha: 1.0,\n                    endAlpha: 0.0,\n                    curve: 'ease-in'\n                };\n                break;\n        }\n    }\n\n    /**\n     * Update particles\n     */\n    private updateParticles(deltaTime: number): void {\n        this.particles.forEach((particle, particleId) => {\n            const dt = deltaTime / 1000; // Convert to seconds\n            \n            // Update age\n            particle.age += deltaTime;\n            \n            // Apply physics\n            this.updateParticlePhysics(particle, dt);\n            \n            // Update animations\n            this.updateParticleAnimations(particle);\n            \n            // Update rotation\n            particle.rotation += particle.rotationSpeed * dt;\n        });\n    }\n\n    /**\n     * Update particle physics\n     */\n    private updateParticlePhysics(particle: Particle, dt: number): void {\n        // Apply gravity\n        particle.acceleration.y += particle.gravity * dt;\n        \n        // Apply acceleration to velocity\n        particle.velocity.x += particle.acceleration.x * dt;\n        particle.velocity.y += particle.acceleration.y * dt;\n        \n        // Apply friction\n        particle.velocity.x *= particle.friction;\n        particle.velocity.y *= particle.friction;\n        \n        // Apply velocity to position\n        particle.position.x += particle.velocity.x * dt;\n        particle.position.y += particle.velocity.y * dt;\n        \n        // Reset acceleration\n        particle.acceleration.x = 0;\n        particle.acceleration.y = 0;\n    }\n\n    /**\n     * Update particle animations\n     */\n    private updateParticleAnimations(particle: Particle): void {\n        const progress = Math.min(1, particle.age / particle.maxAge);\n        \n        // Size animation\n        if (particle.sizeAnimation) {\n            const t = this.applyEasing(progress, particle.sizeAnimation.curve);\n            particle.size = this.lerp(\n                particle.sizeAnimation.startSize,\n                particle.sizeAnimation.endSize,\n                t\n            );\n        }\n        \n        // Alpha animation\n        if (particle.alphaAnimation) {\n            const t = this.applyEasing(progress, particle.alphaAnimation.curve);\n            particle.alpha = this.lerp(\n                particle.alphaAnimation.startAlpha,\n                particle.alphaAnimation.endAlpha,\n                t\n            );\n        }\n        \n        // Color animation\n        if (particle.colorAnimation) {\n            const t = this.applyEasing(progress, particle.colorAnimation.curve);\n            particle.color = {\n                r: Math.floor(this.lerp(particle.colorAnimation.startColor.r, particle.colorAnimation.endColor.r, t)),\n                g: Math.floor(this.lerp(particle.colorAnimation.startColor.g, particle.colorAnimation.endColor.g, t)),\n                b: Math.floor(this.lerp(particle.colorAnimation.startColor.b, particle.colorAnimation.endColor.b, t))\n            };\n        }\n    }\n\n    /**\n     * Apply easing curves\n     */\n    private applyEasing(t: number, curve: string): number {\n        switch (curve) {\n            case 'ease-in':\n                return t * t;\n            case 'ease-out':\n                return 1 - (1 - t) * (1 - t);\n            case 'ease-in-out':\n                return t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2;\n            default:\n                return t; // linear\n        }\n    }\n\n    /**\n     * Linear interpolation\n     */\n    private lerp(start: number, end: number, t: number): number {\n        return start + (end - start) * t;\n    }\n\n    /**\n     * Clean up expired particles\n     */\n    private cleanupParticles(): void {\n        this.particles.forEach((particle, particleId) => {\n            if (particle.age >= particle.maxAge || particle.alpha <= 0) {\n                this.particles.delete(particleId);\n                this.events.onParticleDied?.(particle);\n            }\n        });\n    }\n\n    /**\n     * Create explosion effect\n     */\n    createExplosion(position: { x: number, y: number }, intensity: number = 1.0): string {\n        const emitterId = `explosion_${this.nextEmitterId++}`;\n        \n        const emitter: ParticleEmitter = {\n            id: emitterId,\n            type: ParticleType.Explosion,\n            position: { ...position },\n            emissionRate: 0, // Burst only\n            burstCount: Math.floor(50 * intensity * this.config.qualityScale),\n            velocityRange: {\n                min: { x: -100 * intensity, y: -100 * intensity },\n                max: { x: 100 * intensity, y: 100 * intensity }\n            },\n            sizeRange: { min: 2, max: 8 * intensity },\n            lifeRange: { min: 500, max: 1500 },\n            colorVariation: 0.3,\n            active: true,\n            duration: 0.1, // Very short duration\n            startTime: Date.now(),\n            shape: 'circle',\n            shapeData: { radius: 5 * intensity }\n        };\n        \n        this.emitters.set(emitterId, emitter);\n        this.logger.debug(`💥 Created explosion at (${position.x}, ${position.y})`);\n        \n        return emitterId;\n    }\n\n    /**\n     * Create thrust effect\n     */\n    createThrustTrail(position: { x: number, y: number }, direction: number, intensity: number = 1.0): string {\n        const emitterId = `thrust_${this.nextEmitterId++}`;\n        \n        const emitter: ParticleEmitter = {\n            id: emitterId,\n            type: ParticleType.Thrust,\n            position: { ...position },\n            emissionRate: 60 * intensity * this.config.qualityScale,\n            burstCount: 0,\n            velocityRange: {\n                min: { x: Math.cos(direction) * -50 * intensity, y: Math.sin(direction) * -50 * intensity },\n                max: { x: Math.cos(direction) * -100 * intensity, y: Math.sin(direction) * -100 * intensity }\n            },\n            sizeRange: { min: 1, max: 3 * intensity },\n            lifeRange: { min: 100, max: 400 },\n            colorVariation: 0.2,\n            active: true,\n            duration: -1, // Continuous\n            startTime: Date.now(),\n            shape: 'cone',\n            shapeData: { \n                direction: direction + Math.PI, // Opposite direction\n                angle: Math.PI / 6, // 30 degrees\n                radius: 3 * intensity\n            }\n        };\n        \n        this.emitters.set(emitterId, emitter);\n        \n        return emitterId;\n    }\n\n    /**\n     * Create laser beam effect\n     */\n    createLaserBeam(start: { x: number, y: number }, end: { x: number, y: number }): string {\n        const emitterId = `laser_${this.nextEmitterId++}`;\n        \n        const distance = Math.sqrt((end.x - start.x) ** 2 + (end.y - start.y) ** 2);\n        const particleCount = Math.floor(distance / 5); // One particle every 5 pixels\n        \n        const emitter: ParticleEmitter = {\n            id: emitterId,\n            type: ParticleType.Laser,\n            position: { ...start },\n            emissionRate: 0,\n            burstCount: particleCount * this.config.qualityScale,\n            velocityRange: {\n                min: { x: 0, y: 0 },\n                max: { x: 0, y: 0 }\n            },\n            sizeRange: { min: 1, max: 2 },\n            lifeRange: { min: 100, max: 200 },\n            colorVariation: 0.1,\n            active: true,\n            duration: 0.05,\n            startTime: Date.now(),\n            shape: 'rectangle',\n            shapeData: { \n                width: distance,\n                height: 2\n            }\n        };\n        \n        this.emitters.set(emitterId, emitter);\n        \n        return emitterId;\n    }\n\n    /**\n     * Update emitter position (for continuous effects)\n     */\n    updateEmitterPosition(emitterId: string, position: { x: number, y: number }): void {\n        const emitter = this.emitters.get(emitterId);\n        if (emitter) {\n            emitter.position = { ...position };\n        }\n    }\n\n    /**\n     * Stop emitter\n     */\n    stopEmitter(emitterId: string): void {\n        const emitter = this.emitters.get(emitterId);\n        if (emitter) {\n            emitter.active = false;\n        }\n    }\n\n    /**\n     * Remove emitter\n     */\n    removeEmitter(emitterId: string): void {\n        this.emitters.delete(emitterId);\n    }\n\n    /**\n     * Render particles\n     */\n    render(renderer: Renderer): void {\n        // Sort particles by type for optimal rendering\n        const sortedParticles = Array.from(this.particles.values()).sort((a, b) => {\n            return a.type.localeCompare(b.type);\n        });\n        \n        sortedParticles.forEach(particle => {\n            this.renderParticle(renderer, particle);\n        });\n    }\n\n    /**\n     * Render individual particle\n     */\n    private renderParticle(renderer: Renderer, particle: Particle): void {\n        if (particle.alpha <= 0) return;\n        \n        const color = {\n            ...particle.color,\n            // Apply alpha if renderer supports it\n        };\n        \n        if (this.config.pixelPerfect) {\n            // Pixel-perfect rendering for retro style\n            const x = Math.floor(particle.position.x);\n            const y = Math.floor(particle.position.y);\n            const size = Math.max(1, Math.floor(particle.size));\n            \n            renderer.fillRect(x - size/2, y - size/2, size, size, color);\n        } else {\n            // Smooth rendering\n            renderer.drawCircle(\n                particle.position.x,\n                particle.position.y,\n                particle.size,\n                color,\n                true\n            );\n        }\n    }\n\n    /**\n     * Utility: Random between values\n     */\n    private randomBetween(min: number, max: number): number {\n        return min + Math.random() * (max - min);\n    }\n\n    /**\n     * Update configuration\n     */\n    updateConfig(newConfig: Partial<ParticleSystemConfig>): void {\n        Object.assign(this.config, newConfig);\n        this.logger.info('✨ Particle system config updated', newConfig);\n    }\n\n    /**\n     * Get particle system statistics\n     */\n    getStats(): {\n        activeParticles: number;\n        activeEmitters: number;\n        maxParticles: number;\n        qualityScale: number;\n    } {\n        return {\n            activeParticles: this.particles.size,\n            activeEmitters: Array.from(this.emitters.values()).filter(e => e.active).length,\n            maxParticles: this.config.maxParticles,\n            qualityScale: this.config.qualityScale\n        };\n    }\n\n    /**\n     * Clear all particles and emitters\n     */\n    clear(): void {\n        this.particles.clear();\n        this.emitters.clear();\n        this.logger.info('✨ Particle system cleared');\n    }\n\n    /**\n     * Dispose particle system\n     */\n    dispose(): void {\n        this.clear();\n        this.logger.info('✨ Particle system disposed');\n    }\n}","/**\n * Main Game Class - Core Engine Controller\n * Orchestrates all game systems and manages the game lifecycle\n */\n\nimport { Renderer } from '@core/Renderer';\nimport { InputManager } from '@core/InputManager';\nimport { SpacePhysics } from '@core/Physics';\nimport { AudioEngine } from '@core/AudioEngine';\nimport { GameStateManager, GameState } from '@core/GameStateManager';\nimport { Platform, PlatformDetector } from '@utils/Platform';\nimport { Logger } from '@utils/Logger';\nimport { PlayerShip } from '@entities/PlayerShip';\nimport { GalaxyManager } from '@procedural/GalaxyManager';\nimport { CockpitStatusBar } from '@ui/CockpitStatusBar';\nimport { ShipSection, SystemType } from '@entities/ShipSystems';\nimport { CelestialManager } from '@managers/CelestialManager';\nimport { SpaceBackground } from '@rendering/SpaceBackground';\nimport { ItemDatabase } from '@items/ItemSystem';\nimport { InventoryManager } from '@inventory/InventoryManager';\nimport { CraftingSystem } from '@crafting/CraftingSystem';\nimport { CombatManager } from '@combat/CombatManager';\nimport { PlayerProgression } from '@rpg/PlayerProgression';\nimport { ResearchSystem } from '@rpg/ResearchSystem';\nimport { CrewManagement } from '@rpg/CrewManagement';\nimport { DiplomacySystem } from '@diplomacy/DiplomacySystem';\nimport { AlienAI, AlienSpecies } from '@ai/AlienAI';\nimport { ProceduralAudio, SoundType } from '@audio/ProceduralAudio';\nimport { PerformanceMonitor } from '@optimization/PerformanceMonitor';\nimport { ParticleSystem } from '@effects/ParticleSystem';\n\nexport interface GameConfig {\n    targetFPS: number;\n    enableDebug: boolean;\n    enablePerformanceMonitoring: boolean;\n    enableAutoSave: boolean;\n    autoSaveInterval: number;\n}\n\nexport class Game {\n    private canvas: HTMLCanvasElement;\n    private platform: Platform;\n    private config: GameConfig;\n    \n    // Core systems\n    private renderer!: Renderer;\n    private input!: InputManager;\n    private physics!: SpacePhysics;\n    private audio!: AudioEngine;\n    private stateManager!: GameStateManager;\n    \n    // Game entities\n    private playerShip: PlayerShip | null = null;\n    \n    // Galaxy system\n    private galaxyManager: GalaxyManager | null = null;\n    \n    // UI systems\n    private cockpitStatusBar: CockpitStatusBar | null = null;\n    \n    // Celestial systems\n    private celestialManager: CelestialManager | null = null;\n    \n    // Background rendering\n    private spaceBackground: SpaceBackground | null = null;\n    \n    // Item and inventory systems\n    private itemDatabase: ItemDatabase | null = null;\n    private inventoryManager: InventoryManager | null = null;\n    private craftingSystem: CraftingSystem | null = null;\n    \n    // Combat system\n    private combatManager: CombatManager | null = null;\n    \n    // RPG systems\n    private playerProgression: PlayerProgression | null = null;\n    private researchSystem: ResearchSystem | null = null;\n    private crewManagement: CrewManagement | null = null;\n    \n    // AI & Diplomacy systems\n    private diplomacySystem: DiplomacySystem | null = null;\n    private alienAI: AlienAI | null = null;\n    \n    // Polish systems\n    private proceduralAudio: ProceduralAudio | null = null;\n    private performanceMonitor: PerformanceMonitor | null = null;\n    private particleSystem: ParticleSystem | null = null;\n    \n    // Game loop\n    private isRunning = false;\n    private isPaused = false;\n    private lastTime = 0;\n    private deltaTime = 0;\n    private frameCount = 0;\n    private fpsCounter = 0;\n    private lastFpsUpdate = 0;\n    \n    // Performance monitoring\n    private performanceStats = {\n        averageFPS: 0,\n        frameTime: 0,\n        renderTime: 0,\n        updateTime: 0,\n        memoryUsage: 0\n    };\n    \n    private logger: Logger;\n    private perfLogger: ReturnType<Logger['createPerformanceLogger']>;\n\n    constructor(canvas: HTMLCanvasElement, platform: Platform) {\n        this.canvas = canvas;\n        this.platform = platform;\n        this.logger = new Logger('Game');\n        this.perfLogger = this.logger.createPerformanceLogger();\n        \n        // Get platform-specific configuration\n        const platformConfig = PlatformDetector.getConfig();\n        this.config = {\n            targetFPS: platformConfig.performance.targetFPS,\n            enableDebug: import.meta.env.DEV,\n            enablePerformanceMonitoring: import.meta.env.DEV,\n            enableAutoSave: platformConfig.storage.enableAutoSave,\n            autoSaveInterval: platformConfig.storage.saveInterval\n        };\n\n        this.logger.info('🎮 Game instance created', {\n            platform: platform,\n            canvasSize: `${canvas.width}x${canvas.height}`,\n            config: this.config\n        });\n\n        // Initialize core systems\n        this.initializeSystems();\n    }\n\n    /**\n     * Initialize all game systems\n     */\n    private initializeSystems(): void {\n        this.logger.info('🔧 Initializing game systems...');\n        \n        try {\n            // Initialize renderer first\n            this.renderer = new Renderer(this.canvas, this.platform);\n            this.logger.info('✅ Renderer initialized');\n            \n            // Initialize input system\n            this.input = new InputManager(this.canvas, this.platform);\n            this.logger.info('✅ Input system initialized');\n            \n            // Initialize physics engine\n            this.physics = new SpacePhysics();\n            this.logger.info('✅ Physics engine initialized');\n            \n            // Initialize audio engine\n            this.audio = new AudioEngine(this.platform);\n            this.logger.info('✅ Audio engine initialized');\n            \n            // Initialize game state manager with audio and particles\n            this.stateManager = new GameStateManager(this.proceduralAudio || undefined, this.particleSystem || undefined);\n            this.logger.info('✅ Game state manager initialized');\n            \n            this.logger.info('🎯 All core systems initialized successfully');\n            \n        } catch (error) {\n            this.logger.critical('❌ Failed to initialize core systems', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Initialize the game (async setup)\n     */\n    async initialize(): Promise<void> {\n        this.logger.info('🚀 Starting game initialization...');\n        \n        try {\n            // Initialize renderer context and shaders\n            await this.perfLogger.measureAsync('renderer-init', async () => {\n                await this.renderer.initialize();\n            });\n            \n            // Initialize audio context\n            await this.perfLogger.measureAsync('audio-init', async () => {\n                await this.audio.initialize();\n            });\n            \n            // Load initial game state\n            await this.perfLogger.measureAsync('state-init', async () => {\n                await this.stateManager.initialize();\n            });\n            \n            // Setup auto-save if enabled\n            if (this.config.enableAutoSave) {\n                this.setupAutoSave();\n            }\n            \n            // Initialize galaxy manager (non-blocking)\n            this.galaxyManager = new GalaxyManager();\n            \n            // Start galaxy initialization in background\n            this.initializeGalaxyAsync();\n            \n            // Initialize cockpit UI\n            this.cockpitStatusBar = new CockpitStatusBar({\n                screenWidth: this.canvas.width,\n                screenHeight: this.canvas.height\n            }, {\n                onPowerAllocationChange: (allocation) => {\n                    if (this.playerShip) {\n                        this.playerShip.setPowerAllocation(allocation);\n                        this.logger.debug('Power allocation changed', allocation);\n                    }\n                },\n                onSystemToggle: (system, state) => {\n                    if (this.playerShip) {\n                        this.playerShip.toggleSystem(system as any, state);\n                        this.logger.debug(`System ${system} ${state ? 'enabled' : 'disabled'}`);\n                    }\n                },\n                onInventoryOpen: () => {\n                    this.logger.info('📦 Inventory requested');\n                    // TODO: Open inventory screen\n                },\n                onCodexOpen: () => {\n                    this.logger.info('📚 Codex requested');\n                    // TODO: Open codex screen\n                },\n                onResearchOpen: () => {\n                    this.logger.info('🔬 Research requested');\n                    // TODO: Open research screen\n                },\n                onCrewOpen: () => {\n                    this.logger.info('👥 Crew management requested');\n                    // TODO: Open crew screen\n                },\n                onGalaxyMapOpen: () => {\n                    this.logger.info('🌌 Galaxy map requested');\n                    // TODO: Open galaxy map\n                },\n                onRadarZoom: (zoomLevel) => {\n                    this.logger.debug(`Radar zoom: ${zoomLevel}x`);\n                    // TODO: Update radar zoom\n                }\n            });\n            \n            // Initialize celestial manager\n            this.celestialManager = new CelestialManager({\n                renderDistance: 2000,\n                interactionDistance: 150,\n                showOrbitLines: true,\n                enableInteractions: true\n            }, {\n                onEnterOrbit: (bodyId) => {\n                    this.logger.info(`🛰️ Entering orbit around ${bodyId}`);\n                    // TODO: Handle orbit mechanics\n                },\n                onLand: (bodyId) => {\n                    this.logger.info(`🚁 Landing on ${bodyId}`);\n                    // TODO: Handle landing mechanics\n                },\n                onContinueFlight: () => {\n                    this.logger.info('🚀 Continuing flight');\n                },\n                onStartMining: (bodyId) => {\n                    this.logger.info(`⛏️ Mining on ${bodyId}`);\n                    // TODO: Add resources to inventory\n                },\n                onPerformScan: (bodyId) => {\n                    this.logger.info(`🔍 Scanned ${bodyId}`);\n                    // TODO: Add scan data to codex\n                }\n            });\n            \n            // Initialize space background\n            this.spaceBackground = new SpaceBackground({\n                starCount: 300,\n                starLayers: 5,\n                parallaxStrength: 0.3,\n                enableDistortion: true,\n                galaxyBandIntensity: 0.4,\n                nebulaOpacity: 0.2\n            });\n            \n            // Initialize item systems\n            this.itemDatabase = new ItemDatabase();\n            \n            this.inventoryManager = new InventoryManager({\n                maxSlots: 50,\n                gridWidth: 10,\n                gridHeight: 5,\n                maxWeight: 1000,\n                maxVolume: 500,\n                allowStacking: true\n            }, {\n                onItemAdded: (item, quantity) => {\n                    this.logger.info(`📦 Added ${quantity}x ${item.name} to inventory`);\n                },\n                onItemRemoved: (item, quantity) => {\n                    this.logger.info(`📦 Removed ${quantity}x ${item.name} from inventory`);\n                },\n                onInventoryFull: () => {\n                    this.logger.warn('📦 Inventory is full!');\n                }\n            }, this.itemDatabase);\n            \n            this.craftingSystem = new CraftingSystem(\n                this.itemDatabase,\n                this.inventoryManager,\n                {\n                    onCraftingStarted: (attempt) => {\n                        this.logger.info(`🔧 Started crafting: ${attempt.recipeId}`);\n                    },\n                    onCraftingCompleted: (item, success) => {\n                        if (success) {\n                            this.logger.info(`✅ Successfully crafted ${item.name}`);\n                        } else {\n                            this.logger.warn(`❌ Failed to craft ${item.name}`);\n                        }\n                    }\n                }\n            );\n            \n            // Initialize combat system (will be initialized after RPG systems)\n            this.combatManager = null;\n            \n            // Initialize RPG systems\n            this.playerProgression = new PlayerProgression({\n                onLevelUp: (level, rewards) => {\n                    this.logger.info(`🎉 Level up! Level ${level}`, rewards);\n                },\n                onSkillLevelUp: (skill, level) => {\n                    this.logger.info(`📈 Skill up: ${skill.name} → ${level}`);\n                },\n                onAchievementUnlocked: (achievement) => {\n                    this.logger.info(`🏆 Achievement: ${achievement.name}`);\n                }\n            });\n            \n            this.researchSystem = new ResearchSystem({\n                onTechnologyUnlocked: (tech) => {\n                    this.logger.info(`🔬 Technology unlocked: ${tech.name}`);\n                },\n                onDiscoveryMade: (discovery) => {\n                    this.logger.info(`🔍 Discovery: ${discovery.name}`);\n                }\n            });\n            \n            this.crewManagement = new CrewManagement({\n                onCrewJoined: (crew) => {\n                    this.logger.info(`👤 Crew joined: ${crew.name} (${crew.role})`);\n                },\n                onCrewEvent: (event) => {\n                    this.logger.info(`📰 Crew event: ${event.description}`);\n                },\n                onMoraleAlert: (morale) => {\n                    this.logger.warn(`😟 Low crew morale: ${morale.toFixed(0)}%`);\n                }\n            });\n            \n            // Initialize diplomacy and alien AI systems\n            this.diplomacySystem = new DiplomacySystem({\n                onFirstContact: (faction) => {\n                    this.logger.info(`🤝 First contact with: ${faction.name}`);\n                },\n                onReputationChanged: (factionId, oldRep, newRep) => {\n                    const change = newRep - oldRep;\n                    this.logger.info(`🤝 Reputation ${change > 0 ? '+' : ''}${change}: ${factionId}`);\n                },\n                onNegotiationStarted: (session) => {\n                    this.logger.info(`💬 Negotiation started with faction`);\n                },\n                onEncounterGenerated: (encounter) => {\n                    this.logger.info(`🎭 Diplomatic encounter: ${encounter.type}`);\n                }\n            });\n            \n            this.alienAI = new AlienAI({\n                onFirstContact: (species, encounter) => {\n                    this.logger.info(`👽 First contact with: ${species}`);\n                },\n                onCommunicationBreakthrough: (species, method) => {\n                    this.logger.info(`📡 Communication breakthrough: ${species} via ${method}`);\n                },\n                onTechnologyDiscovered: (species, technology) => {\n                    this.logger.info(`🔬 Technology discovered from ${species}: ${technology}`);\n                },\n                onCulturalInsight: (species, insight) => {\n                    this.logger.info(`🎭 Cultural insight about ${species}: ${insight}`);\n                }\n            });\n            \n            // Initialize polish systems\n            this.proceduralAudio = new ProceduralAudio({\n                onSoundPlayed: (type, config) => {\n                    this.logger.debug(`🔊 Sound played: ${type}`);\n                },\n                onTrackChanged: (trackName) => {\n                    this.logger.info(`🎵 Music track changed: ${trackName}`);\n                },\n                onAudioError: (error) => {\n                    this.logger.error('🔊 Audio error', error);\n                }\n            });\n            \n            this.performanceMonitor = new PerformanceMonitor({\n                onPerformanceUpdate: (metrics) => {\n                    // Update game metrics for audio system\n                    // TODO: Add setGameMetrics method to ProceduralAudio if needed\n                    // this.proceduralAudio?.setGameMetrics?.({\n                    //     activeSounds: metrics.activeSounds\n                    // });\n                },\n                onThresholdExceeded: (metric, value, threshold) => {\n                    this.logger.warn(`⚠️ Performance threshold exceeded: ${metric} = ${value} (threshold: ${threshold})`);\n                },\n                onOptimizationRecommended: (recommendations) => {\n                    this.logger.info(`🔧 Performance recommendations: ${recommendations.length} suggestions`);\n                },\n                onSettingsChanged: (settings) => {\n                    this.logger.info('⚙️ Performance settings updated');\n                }\n            });\n            \n            // Initialize audio system\n            await this.proceduralAudio.initialize();\n            \n            // Initialize particle system\n            this.particleSystem = new ParticleSystem({\n                maxParticles: 1000,\n                qualityScale: 1.0,\n                enableTrails: true,\n                pixelPerfect: true\n            });\n            \n            // Initialize performance monitoring\n            this.performanceMonitor.initialize();\n            \n            // Start ambient space music\n            this.proceduralAudio.startAmbientTrack('deep_space');\n            \n            // Initialize combat system with RPG integration\n            this.combatManager = new CombatManager(\n                this.itemDatabase,\n                this.inventoryManager,\n                {\n                    onEncounterStarted: (encounter) => {\n                        this.logger.info(`🚨 Combat encounter: ${encounter.name}`);\n                    },\n                    onEncounterCompleted: (encounter, success) => {\n                        this.logger.info(`${success ? '✅' : '❌'} Encounter ${encounter.name} ${success ? 'completed' : 'failed'}`);\n                        // Award experience for completed encounters\n                        if (success && this.playerProgression) {\n                            this.playerProgression.addExperience(encounter.rewards.experience);\n                            this.playerProgression.updateStatistics({ enemiesDefeated: 1 });\n                        }\n                    },\n                    onEnemyDestroyed: (enemyId, rewards) => {\n                        this.logger.info(`💰 Enemy destroyed: +${rewards.experience} XP, ${rewards.items.length} items`);\n                        // Award experience and update stats\n                        if (this.playerProgression) {\n                            this.playerProgression.addExperience(rewards.experience);\n                            this.playerProgression.updateStatistics({ enemiesDefeated: 1 });\n                            // Award skill experience based on combat\n                            this.playerProgression.addSkillExperience('weapon_proficiency', 10);\n                            this.playerProgression.addSkillExperience('tactical_combat', 5);\n                        }\n                    },\n                    onPlayerDamaged: (damage, damageType) => {\n                        this.logger.warn(`💥 Player hit: ${damage} ${damageType} damage`);\n                    }\n                }\n            );\n            \n            // Setup demo content\n            this.setupDemoContent();\n            \n            this.logger.info('✅ Game initialization completed successfully');\n            \n        } catch (error) {\n            this.logger.critical('❌ Game initialization failed', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Start the game loop\n     */\n    async start(): Promise<void> {\n        if (this.isRunning) {\n            this.logger.warn('Game is already running');\n            return;\n        }\n        \n        this.logger.info('🎮 Starting game...');\n        \n        try {\n            // Ensure we have basic content ready before starting\n            if (!this.playerShip) {\n                this.logger.warn('No player ship found, creating emergency content');\n                this.setupEmergencyContent();\n            }\n            \n            // Ensure canvas can receive input events\n            this.canvas.focus();\n            \n            // Start the game loop first\n            this.isRunning = true;\n            this.isPaused = false;\n            this.lastTime = performance.now();\n            \n            // Start the main loop\n            this.gameLoop();\n            \n            // Go directly to playing state for immediate gameplay\n            await this.stateManager.setState(GameState.Playing);\n            this.logger.info('✅ Game started in playing state');\n            \n        } catch (error) {\n            this.logger.critical('❌ Failed to start game', error);\n            this.isRunning = false;\n            \n            // Try emergency start\n            try {\n                this.setupEmergencyContent();\n                this.isRunning = true;\n                this.gameLoop();\n                await this.stateManager.setState(GameState.Playing);\n                this.logger.info('Emergency start successful');\n            } catch (emergencyError) {\n                this.logger.critical('Emergency start failed', emergencyError);\n                throw error;\n            }\n        }\n    }\n\n    /**\n     * Main game loop\n     */\n    private gameLoop(): void {\n        if (!this.isRunning) {\n            return;\n        }\n\n        const currentTime = performance.now();\n        this.deltaTime = (currentTime - this.lastTime) / 1000; // Convert to seconds\n        this.lastTime = currentTime;\n\n        // Cap delta time to prevent large jumps and ensure minimum performance\n        this.deltaTime = Math.min(this.deltaTime, 1/15); // Max 15 FPS minimum (was 10)\n\n        if (!this.isPaused) {\n            try {\n                // Skip frame if game is in error state\n                if (this.stateManager.getCurrentState() === GameState.Error) {\n                    // Schedule next frame but don't process game logic\n                    requestAnimationFrame(() => this.gameLoop());\n                    return;\n                }\n                \n                // Skip frame if taking too long to maintain responsiveness\n                const frameStartTime = performance.now();\n                \n                // Update game systems and measure performance\n                let updateTime = 0;\n                let renderTime = 0;\n\n                updateTime = this.perfLogger.measure('update', () => {\n                    this.update(this.deltaTime);\n                });\n\n                // Check if we have time budget for rendering\n                const updateEndTime = performance.now();\n                const timeBudget = 33.33; // Target 30 FPS minimum (33.33ms per frame)\n                \n                if (updateEndTime - frameStartTime < timeBudget) {\n                    renderTime = this.perfLogger.measure('render', () => {\n                        this.render();\n                    });\n                } else {\n                    // Skip rendering this frame to maintain responsiveness\n                    this.logger.debug('Frame skipped - update took too long');\n                }\n\n                // Store timing results for performance stats\n                this.performanceStats.updateTime = updateTime;\n                this.performanceStats.renderTime = renderTime;\n\n                // Update performance stats\n                if (this.config.enablePerformanceMonitoring) {\n                    this.updatePerformanceStats(currentTime);\n                }\n\n                this.frameCount++;\n\n            } catch (error) {\n                this.logger.error('Game loop error', error);\n                this.handleError(error);\n                // Don't immediately schedule next frame to give time for error handling\n                setTimeout(() => {\n                    if (this.isRunning) {\n                        requestAnimationFrame(() => this.gameLoop());\n                    }\n                }, 100); // 100ms delay before resuming\n                return;\n            }\n        }\n\n        // Schedule next frame\n        requestAnimationFrame(() => this.gameLoop());\n    }\n\n    /**\n     * Update all game systems\n     */\n    private update(deltaTime: number): void {\n        // Update input state\n        this.input.update(deltaTime);\n        \n        // Update game state\n        this.stateManager.update(deltaTime, this.input);\n        \n        // Update physics simulation\n        this.physics.update(deltaTime);\n        \n        // Update audio\n        this.audio.update(deltaTime);\n        \n        // Update game entities\n        if (this.playerShip && this.stateManager.isGameActive()) {\n            this.playerShip.update(deltaTime);\n            \n            // Handle weapon firing\n            this.playerShip.fireWeapon();\n            \n            // Demo damage testing (press 'T' to test damage)\n            if (this.input.isKeyPressed('KeyT')) {\n                this.playerShip.applyDamage(15, Math.random() > 0.5 ? \n                    ShipSection.Engineering : ShipSection.Weapons\n                );\n                this.logger.info('🧪 Demo damage applied');\n            }\n            \n            // Demo system toggle (press 'Y' to toggle engines)\n            if (this.input.isKeyPressed('KeyY')) {\n                const currentStatus = this.playerShip.getSystemStatus();\n                this.playerShip.toggleSystem(SystemType.Engines, !currentStatus.enginesOnline);\n                this.logger.info(`🧪 Engines ${!currentStatus.enginesOnline ? 'enabled' : 'disabled'}`);\n            }\n            \n            // Demo celestial interactions (press 'P' to perform action on nearby body)\n            if (this.input.isKeyPressed('KeyP') && this.celestialManager) {\n                const nearbyBodies = this.celestialManager.getNearbyBodies();\n                if (nearbyBodies.length > 0) {\n                    const body = nearbyBodies[0];\n                    this.celestialManager.performAction(body.id, 'scan', this.playerShip.getPosition());\n                    this.logger.info(`🔍 Demo scan of ${body.name}`);\n                }\n            }\n            \n            // Demo warp drive (press 'W' for warp toggle - already handled in PlayerShip)\n            // Just log current warp state for debugging\n            if (this.input.isKeyPressed('KeyW')) {\n                const warpState = this.playerShip.getWarpState();\n                this.logger.info(`🌌 Warp state: ${warpState}`);\n            }\n            \n            // Demo inventory system (press 'I' to toggle inventory)\n            if (this.input.isKeyPressed('KeyI') && this.inventoryManager) {\n                const isVisible = this.inventoryManager.isInventoryVisible();\n                this.inventoryManager.setVisible(!isVisible);\n                this.logger.info(`📦 Inventory ${!isVisible ? 'opened' : 'closed'}`);\n            }\n            \n            // Demo crafting system (press 'C' to toggle crafting)\n            if (this.input.isKeyPressed('KeyC') && this.craftingSystem) {\n                const isVisible = this.craftingSystem.isCraftingVisible();\n                this.craftingSystem.setVisible(!isVisible);\n                if (!isVisible) {\n                    this.craftingSystem.selectStation('basic_fabricator');\n                }\n                this.logger.info(`🔧 Crafting ${!isVisible ? 'opened' : 'closed'}`);\n            }\n            \n            // Demo item generation (press 'R' to add random items)\n            if (this.input.isKeyPressed('KeyR') && this.inventoryManager && this.itemDatabase) {\n                const randomItem = this.itemDatabase.generateRandomItem();\n                if (randomItem) {\n                    const quantity = Math.floor(Math.random() * 5) + 1;\n                    const added = this.inventoryManager.addItem(randomItem, quantity);\n                    if (added) {\n                        this.logger.info(`🎲 Added ${quantity}x ${randomItem.name} (${randomItem.rarity})`);\n                    }\n                }\n            }\n            \n            // Demo auto-crafting (press 'X' to start crafting if possible)\n            if (this.input.isKeyPressed('KeyX') && this.craftingSystem) {\n                // Try to craft an energy cell (simple recipe)\n                const success = this.craftingSystem.startCrafting('craft_energy_cell', 'basic_fabricator');\n                if (success) {\n                    this.logger.info('🔧 Started crafting Energy Cell');\n                } else {\n                    this.logger.warn('🔧 Cannot start crafting - check materials');\n                }\n            }\n            \n            // Demo combat controls\n            if (this.combatManager) {\n                // Fire primary weapon (left mouse or space)\n                if (this.input.isKeyPressed('Space')) {\n                    const fired = this.combatManager.firePlayerWeapon('player_laser_1');\n                    if (fired) {\n                        this.logger.debug('🔫 Fired laser cannon');\n                    }\n                }\n                \n                // Fire secondary weapon (right mouse or shift)\n                if (this.input.isKeyPressed('ShiftLeft')) {\n                    const fired = this.combatManager.firePlayerWeapon('player_cannon_1');\n                    if (fired) {\n                        this.logger.debug('🔫 Fired mass driver');\n                    }\n                }\n                \n                // Spawn random enemy (press 'E' for demo)\n                if (this.input.isKeyPressed('KeyE')) {\n                    this.combatManager.startRandomEncounter();\n                    this.logger.info('🛸 Spawned random encounter');\n                }\n                \n                // Clear all enemies (press 'Q' for demo)\n                if (this.input.isKeyPressed('KeyQ')) {\n                    this.combatManager.clearCombat();\n                    this.logger.info('🧹 Cleared all combat');\n                }\n            }\n            \n            // Demo AI & Diplomacy controls\n            if (this.diplomacySystem) {\n                // Generate random diplomatic encounter (press 'K' for demo)\n                if (this.input.isKeyPressed('KeyK')) {\n                    const playerPos = this.playerShip?.getPosition() || { x: 0, y: 0 };\n                    const encounter = this.diplomacySystem.generateRandomEncounter(playerPos);\n                    if (encounter) {\n                        this.logger.info(`🎭 Generated diplomatic encounter with ${encounter.factionId}`);\n                    }\n                }\n                \n                // Modify faction reputation (press 'L' for demo)\n                if (this.input.isKeyPressed('KeyL')) {\n                    const factions = this.diplomacySystem.getAllFactions();\n                    if (factions.length > 0) {\n                        const randomFaction = factions[Math.floor(Math.random() * factions.length)];\n                        const change = Math.floor(Math.random() * 21) - 10; // -10 to +10\n                        this.diplomacySystem.modifyReputation(randomFaction.id, change, 'Random diplomatic action');\n                    }\n                }\n            }\n            \n            if (this.alienAI) {\n                // Generate alien encounter (press 'M' for demo)\n                if (this.input.isKeyPressed('KeyM')) {\n                    const playerPos = this.playerShip?.getPosition() || { x: 0, y: 0 };\n                    const species = Object.values(AlienSpecies)[Math.floor(Math.random() * Object.values(AlienSpecies).length)];\n                    const encounter = this.alienAI.generateEncounter(species, playerPos, 'routine');\n                    this.logger.info(`👽 Generated alien encounter: ${species}`);\n                }\n                \n                // Simulate alien communication (press 'N' for demo)\n                if (this.input.isKeyPressed('KeyN')) {\n                    const encounters = this.alienAI.getActiveEncounters();\n                    if (encounters.length > 0) {\n                        const encounter = encounters[0];\n                        const response = this.alienAI.processPlayerAction(\n                            encounter.id,\n                            'communicate',\n                            50,\n                            'peaceful_greeting'\n                        );\n                        this.logger.info(`📡 Alien response: ${response.type} - ${response.description}`);\n                    }\n                }\n            }\n            \n            // Demo Audio & Polish controls\n            if (this.proceduralAudio) {\n                // Play laser sound (press 'O' for demo)\n                if (this.input.isKeyPressed('KeyO')) {\n                    this.proceduralAudio.playRetroSound(SoundType.Laser, 1.0);\n                }\n                \n                // Play explosion sound (press 'P' for demo)\n                if (this.input.isKeyPressed('KeyP')) {\n                    this.proceduralAudio.playRetroSound(SoundType.Explosion, 1.0);\n                }\n                \n                // Cycle ambient tracks (press 'U' for demo)\n                if (this.input.isKeyPressed('KeyU')) {\n                    const tracks = ['deep_space', 'nebula_drift', 'void_silence'];\n                    const currentTrack = this.proceduralAudio.getAudioStats().currentTrack;\n                    const currentIndex = tracks.indexOf(currentTrack || 'deep_space');\n                    const nextTrack = tracks[(currentIndex + 1) % tracks.length];\n                    this.proceduralAudio.startAmbientTrack(nextTrack);\n                }\n            }\n            \n            if (this.performanceMonitor) {\n                // Toggle auto-optimization (press 'Y' for demo)\n                if (this.input.isKeyPressed('KeyY')) {\n                    const settings = this.performanceMonitor.getSettings();\n                    this.performanceMonitor.updateSettings({\n                        autoOptimize: !settings.autoOptimize\n                    });\n                    this.logger.info(`🔧 Auto-optimization: ${!settings.autoOptimize ? 'ON' : 'OFF'}`);\n                }\n                \n                // Get performance summary (press 'T' for demo)\n                if (this.input.isKeyPressed('KeyT')) {\n                    const summary = this.performanceMonitor.getPerformanceSummary();\n                    this.logger.info(`📊 Performance: ${summary.performanceGrade} (${Math.round(summary.averageFPS)} FPS, ${Math.round(summary.averageMemoryUsage)}% memory)`);\n                }\n            }\n            \n            // Demo RPG system controls\n            if (this.playerProgression) {\n                // Add experience (press 'F' for demo)\n                if (this.input.isKeyPressed('KeyF')) {\n                    this.playerProgression.addExperience(100);\n                    this.logger.info('📈 Added 100 XP');\n                }\n                \n                // Add skill experience (press 'G' for demo)\n                if (this.input.isKeyPressed('KeyG')) {\n                    this.playerProgression.addSkillExperience('weapon_proficiency', 25);\n                    this.logger.info('🔧 Added weapon proficiency XP');\n                }\n            }\n            \n            if (this.researchSystem) {\n                // Start basic research (press 'H' for demo)\n                if (this.input.isKeyPressed('KeyH')) {\n                    const started = this.researchSystem.startResearch('basic_sensors', 'basic_lab', ['dr_smith']);\n                    if (started) {\n                        this.logger.info('🔬 Started basic sensors research');\n                    } else {\n                        this.logger.warn('🔬 Cannot start research');\n                    }\n                }\n            }\n            \n            if (this.crewManagement) {\n                // Auto-assign crew (press 'J' for demo)\n                if (this.input.isKeyPressed('KeyJ')) {\n                    const crew = this.crewManagement.getAllCrew();\n                    if (crew.length > 0) {\n                        const randomCrew = crew[Math.floor(Math.random() * crew.length)];\n                        const stations = this.crewManagement.getAllStations();\n                        const availableStation = stations.find(s => s.assignedCrew.length < s.maxCrew);\n                        \n                        if (availableStation) {\n                            const assigned = this.crewManagement.assignCrewToStation(randomCrew.id, availableStation.stationId);\n                            if (assigned) {\n                                this.logger.info(`👥 Assigned ${randomCrew.name} to ${availableStation.stationId}`);\n                            }\n                        }\n                    }\n                }\n            }\n            \n            // Handle pause input\n            if (this.input.isPausePressed()) {\n                if (this.stateManager.canPause()) {\n                    this.stateManager.setState(GameState.Paused);\n                } else if (this.stateManager.canResume()) {\n                    this.stateManager.setState(GameState.Playing);\n                }\n            }\n            \n            // Emergency menu access - ESC key should always work\n            if (this.input.isKeyPressed('Escape')) {\n                if (this.stateManager.getCurrentState() === GameState.Playing) {\n                    this.stateManager.setState(GameState.MainMenu);\n                } else if (this.stateManager.getCurrentState() === GameState.Error) {\n                    this.stateManager.setState(GameState.MainMenu);\n                } else if (this.stateManager.getCurrentState() === GameState.MainMenu) {\n                    this.stateManager.setState(GameState.Playing);\n                }\n            }\n            \n            // Emergency restart - R key\n            if (this.input.isKeyPressed('KeyR') && this.input.isKeyPressed('ControlLeft')) {\n                this.logger.info('Emergency restart requested');\n                try {\n                    this.setupEmergencyContent();\n                    this.stateManager.setState(GameState.Playing);\n                } catch (error) {\n                    this.logger.error('Emergency restart failed', error);\n                }\n            }\n        }\n        \n        // Update cockpit UI\n        if (this.cockpitStatusBar) {\n            this.cockpitStatusBar.update(deltaTime, this.input);\n            \n            // Update UI with current ship status\n            if (this.playerShip) {\n                this.cockpitStatusBar.updateSystemStatus(this.playerShip.getSystemStatus());\n                this.cockpitStatusBar.updateDamageReports(this.playerShip.getShipSystems().getDamageReports());\n            }\n        }\n        \n        // Update celestial bodies\n        if (this.celestialManager && this.playerShip) {\n            this.celestialManager.update(deltaTime, this.input, this.playerShip.getPosition());\n        }\n        \n        // Update space background\n        if (this.spaceBackground) {\n            this.spaceBackground.update(deltaTime);\n            \n            // Handle warp distortion effects\n            if (this.playerShip && this.playerShip.isWarpActive()) {\n                const warpDistortion = this.playerShip.getWarpDrive().getSpaceDistortion();\n                this.spaceBackground.updateWarpDistortion(warpDistortion);\n            } else if (this.playerShip && this.playerShip.getWarpState() === 'deactivating') {\n                // Gradually restore background during warp deactivation\n                const progress = this.playerShip.getWarpDrive().getWarpProgress();\n                this.spaceBackground.gradualRestore(progress);\n            }\n        }\n        \n        // Update inventory and crafting systems\n        if (this.craftingSystem) {\n            this.craftingSystem.update(deltaTime);\n        }\n        \n        // Update combat system\n        if (this.combatManager && this.playerShip) {\n            const shipSystems = this.playerShip.getSystemStatus();\n            this.combatManager.updatePlayer(\n                this.playerShip.getPosition(),\n                this.playerShip.getVelocity(),\n                20, // Player ship size\n                shipSystems.hull,\n                100 // Max hull\n            );\n            this.combatManager.update(deltaTime);\n        }\n        \n        // Update RPG systems\n        if (this.researchSystem) {\n            this.researchSystem.update(deltaTime);\n        }\n        \n        if (this.crewManagement) {\n            this.crewManagement.update(deltaTime);\n        }\n        \n        // Update polish systems\n        this.performanceMonitor?.update(deltaTime);\n        this.particleSystem?.update(deltaTime);\n        \n        // Update performance metrics for monitoring (less frequently)\n        if (this.performanceMonitor && this.frameCount % 120 === 0) { // Every 2 seconds at 60fps\n            const audioStats = this.proceduralAudio?.getAudioStats();\n            this.performanceMonitor.setGameMetrics({\n                activeEntities: (this.celestialManager?.getActiveBodies()?.length || 0) + 1, // +1 for player\n                activeSounds: audioStats?.activeSounds || 0,\n                drawCalls: 1, // Simplified for now\n                triangles: 100, // Simplified for now\n                textureMemory: 10 // Simplified for now\n            });\n        }\n    }\n\n    /**\n     * Render the current frame\n     */\n    private render(): void {\n        try {\n            // Clear canvas and setup rendering\n            this.renderer.beginFrame();\n            \n            // Always render space background, even if other systems fail\n            try {\n                if (this.spaceBackground && this.playerShip && this.stateManager.isGameActive()) {\n                    this.spaceBackground.render(this.renderer, this.playerShip.getPosition());\n                } else if (this.stateManager.isGameActive()) {\n                    // Fallback space background\n                    this.renderFallbackSpaceBackground();\n                }\n            } catch (error) {\n                this.logger.debug('Space background render failed, using fallback');\n                this.renderFallbackSpaceBackground();\n            }\n            \n            // Render current game state\n            try {\n                this.stateManager.render(this.renderer);\n            } catch (error) {\n                this.logger.error('State manager render failed', error);\n                this.renderEmergencyScreen();\n            }\n            \n            // Render game entities if playing\n            if (this.stateManager.isGameActive()) {\n                try {\n                    // Render enhanced demo ship if available\n                    if (this.playerShip) {\n                        // Render thrust particles\n                        this.playerShip.renderThrustParticles(this.renderer);\n                        \n                        // Render warp effects (on top of ship)\n                        this.playerShip.renderWarpEffects(this.renderer);\n                    }\n                    \n                    // Render celestial bodies\n                    if (this.celestialManager && this.playerShip) {\n                        this.celestialManager.render(this.renderer, this.playerShip.getPosition());\n                    }\n                    \n                    // Render cockpit status bar\n                    if (this.cockpitStatusBar) {\n                        this.cockpitStatusBar.render(this.renderer);\n                    }\n                    \n                    // Render other UI elements\n                    if (this.inventoryManager && this.inventoryManager.isInventoryVisible()) {\n                        this.inventoryManager.render(this.renderer);\n                    }\n                    \n                    if (this.craftingSystem && this.craftingSystem.isCraftingVisible()) {\n                        this.craftingSystem.render(this.renderer);\n                    }\n                    \n                    // Render combat effects\n                    if (this.combatManager) {\n                        this.combatManager.render(this.renderer);\n                    }\n                    \n                } catch (error) {\n                    this.logger.debug('Game entity render failed', error);\n                    // Continue rendering other elements\n                }\n            }\n            \n            // Render debug information if enabled\n            if (this.config.enableDebug) {\n                try {\n                    this.renderDebugInfo();\n                } catch (error) {\n                    this.logger.debug('Debug render failed', error);\n                }\n            }\n            \n            // Render particles on top of everything\n            try {\n                if (this.particleSystem) {\n                    this.particleSystem.render(this.renderer);\n                }\n            } catch (error) {\n                this.logger.debug('Particle render failed', error);\n            }\n            \n            // Finalize frame\n            this.renderer.endFrame();\n            \n        } catch (error) {\n            this.logger.error('Critical render failure', error);\n            // Last resort: try to render something minimal\n            try {\n                this.renderer.beginFrame();\n                this.renderEmergencyScreen();\n                this.renderer.endFrame();\n            } catch (finalError) {\n                this.logger.critical('Total render failure', finalError);\n            }\n        }\n    }\n    \n    /**\n     * Render fallback space background\n     */\n    private renderFallbackSpaceBackground(): void {\n        // Dark space background with subtle gradient\n        this.renderer.fillRect(0, 0, 1440, 900, { r: 8, g: 12, b: 25 });\n        \n        // Simple star field with more stars and better distribution\n        for (let i = 0; i < 200; i++) {\n            const x = (i * 73 + 123) % 1440;\n            const y = (i * 149 + 67) % 900;\n            const brightness = (i % 4) + 1;\n            const starSize = brightness > 2 ? 2 : 1;\n            \n            const color = { \n                r: brightness * 48 + Math.floor(Math.random() * 32), \n                g: brightness * 48 + Math.floor(Math.random() * 32), \n                b: brightness * 64 + Math.floor(Math.random() * 48)\n            };\n            \n            // Draw star with slight twinkling effect\n            if (starSize === 2) {\n                this.renderer.fillRect(x, y, 2, 2, color);\n            } else {\n                this.renderer.setPixel(x, y, color);\n            }\n        }\n        \n        // Add some distant galaxies/nebulae\n        for (let i = 0; i < 20; i++) {\n            const x = (i * 217 + 45) % 1440;\n            const y = (i * 89 + 156) % 900;\n            const size = 20 + (i % 15);\n            const opacity = 30 + (i % 30);\n            \n            this.renderer.drawCircle(x, y, size, { \n                r: opacity, \n                g: opacity * 0.8, \n                b: opacity * 1.2 \n            }, true);\n        }\n    }\n    \n    /**\n     * Render emergency screen when all else fails\n     */\n    private renderEmergencyScreen(): void {\n        const centerX = 720;\n        const centerY = 450;\n        \n        // Dark background\n        this.renderer.fillRect(0, 0, 1440, 900, { r: 20, g: 20, b: 40 });\n        \n        // Emergency message\n        this.renderer.renderText('SPACE EXPLORER - EMERGENCY MODE', centerX - 150, centerY - 50, \n            { r: 255, g: 255, b: 255 }, 16);\n        \n        this.renderer.renderText('Systems initializing...', centerX - 80, centerY, \n            { r: 200, g: 200, b: 200 }, 14);\n        \n        this.renderer.renderText('Press ESC for menu', centerX - 70, centerY + 50, \n            { r: 150, g: 150, b: 150 }, 12);\n    }\n\n    /**\n     * Render debug information\n     */\n    private renderDebugInfo(): void {\n        const debugInfo = [\n            `FPS: ${this.performanceStats.averageFPS.toFixed(1)}`,\n            `Frame Time: ${this.performanceStats.frameTime.toFixed(2)}ms`,\n            `Render Time: ${this.performanceStats.renderTime.toFixed(2)}ms`,\n            `Update Time: ${this.performanceStats.updateTime.toFixed(2)}ms`,\n            `Platform: ${this.platform}`,\n            `State: ${this.stateManager.getCurrentState()}`,\n            `Objects: ${this.physics.getObjectCount()}`\n        ];\n\n        this.renderer.renderDebugText(debugInfo, 10, 10);\n    }\n\n    /**\n     * Update performance statistics\n     */\n    private updatePerformanceStats(currentTime: number): void {\n        // Update FPS counter\n        this.fpsCounter++;\n        \n        // Only update performance stats every 2 seconds to reduce overhead\n        if (currentTime - this.lastFpsUpdate >= 2000) {\n            this.performanceStats.averageFPS = this.fpsCounter / 2; // Divide by 2 for 2-second interval\n            this.fpsCounter = 0;\n            this.lastFpsUpdate = currentTime;\n            \n            // Update memory usage if available (less frequently for performance)\n            if ((performance as any).memory) {\n                const memory = (performance as any).memory;\n                this.performanceStats.memoryUsage = (memory.usedJSHeapSize / memory.totalJSHeapSize) * 100;\n            }\n            \n            // Only update performance monitor every 2 seconds to reduce overhead\n            if (this.performanceMonitor) {\n                this.performanceMonitor.update({\n                    fps: this.performanceStats.averageFPS,\n                    frameTime: this.performanceStats.frameTime,\n                    memory: this.performanceStats.memoryUsage,\n                    renderTime: this.performanceStats.renderTime,\n                    updateTime: this.performanceStats.updateTime,\n                    activeSounds: this.performanceStats.activeSounds || 0,\n                    particles: this.performanceStats.particles || 0,\n                    entities: this.performanceStats.entities || 0\n                });\n            }\n        }\n        \n        // Update frame timing - values are already set in the game loop\n        this.performanceStats.frameTime = this.deltaTime * 1000;\n        // renderTime and updateTime are already set in the game loop\n    }\n\n    /**\n     * Pause the game\n     */\n    pause(): void {\n        if (!this.isRunning || this.isPaused) {\n            return;\n        }\n        \n        this.isPaused = true;\n        this.audio.pauseAll();\n        this.logger.info('⏸️ Game paused');\n    }\n\n    /**\n     * Check if game is paused\n     */\n    getPaused(): boolean {\n        return this.isPaused;\n    }\n\n    /**\n     * Resume the game\n     */\n    resume(): void {\n        if (!this.isRunning || !this.isPaused) {\n            return;\n        }\n        \n        this.isPaused = false;\n        this.lastTime = performance.now(); // Reset timing\n        this.audio.resumeAll();\n        this.logger.info('▶️ Game resumed');\n    }\n\n    /**\n     * Stop the game\n     */\n    stop(): void {\n        if (!this.isRunning) {\n            return;\n        }\n        \n        this.isRunning = false;\n        this.isPaused = false;\n        this.audio.stopAll();\n        this.logger.info('⏹️ Game stopped');\n    }\n\n    /**\n     * Handle window resize\n     */\n    handleResize(): void {\n        this.renderer.handleResize();\n        this.logger.debug('📐 Game resized');\n    }\n\n    /**\n     * Setup demo content for FÁZE 1\n     */\n    private setupDemoContent(): void {\n        this.logger.info('🎮 Setting up demo content...');\n        \n        try {\n            // Create player ship in current system\n            let shipPosition = { x: 512, y: 384 }; // Default center\n            \n            if (this.galaxyManager) {\n                const currentSystem = this.galaxyManager.getCurrentSystem();\n                if (currentSystem) {\n                    // Position ship in the system\n                    shipPosition = {\n                        x: currentSystem.star.position.x + 100, // Offset from star\n                        y: currentSystem.star.position.y + 100\n                    };\n                }\n            }\n            \n            this.playerShip = new PlayerShip(\n                this.physics,\n                this.input,\n                this.audio,\n                shipPosition\n            );\n            \n            // Create planets from current galaxy system\n            const demoPlanets: any[] = [];\n            \n            if (this.galaxyManager) {\n                const currentSystem = this.galaxyManager.getCurrentSystem();\n                if (currentSystem) {\n                    // Add central star\n                    const starObj = this.physics.createPlanet(\n                        currentSystem.star.id, \n                        { x: 720, y: 450 }, // Center the star on screen\n                        currentSystem.star.mass * 1000000, \n                        Math.min(currentSystem.star.radius * 20, 80) // Scale for visibility\n                    );\n                    this.physics.addObject(starObj);\n                    this.physics.addGravityWell(currentSystem.star.id, {\n                        position: starObj.position,\n                        mass: starObj.mass,\n                        radius: 300\n                    });\n                    demoPlanets.push(starObj);\n                    \n                    // Add planets\n                    currentSystem.planets.forEach((planet, index) => {\n                        const angle = (index * Math.PI * 2) / currentSystem.planets.length;\n                        const distance = 150 + (planet.orbitDistance * 30); // Scale orbit distance\n                        \n                        const planetPos = {\n                            x: 720 + Math.cos(angle) * distance,\n                            y: 450 + Math.sin(angle) * distance\n                        };\n                        \n                        const planetObj = this.physics.createPlanet(\n                            planet.id,\n                            planetPos,\n                            planet.mass * 100000,\n                            Math.max(planet.radius * 10, 15) // Scale for visibility\n                        );\n                        \n                        this.physics.addObject(planetObj);\n                        demoPlanets.push(planetObj);\n                    });\n                    \n                    this.logger.info(`✅ Generated system: ${currentSystem.name} with ${currentSystem.planets.length} planets`);\n                }\n            }\n            \n                        // Load celestial system\n            if (this.galaxyManager && this.celestialManager) {\n                const currentSystem = this.galaxyManager.getCurrentSystem();\n                if (currentSystem) {\n                    this.celestialManager.loadSystem({\n                        systemData: currentSystem,\n                        cameraPosition: { x: 720, y: 450 }\n                    });\n                    \n                    // Discover all bodies for demo\n                    this.celestialManager.discoverAllBodies();\n                    \n                    this.logger.info(`🌌 Loaded celestial system: ${currentSystem.name}`);\n                }\n            }\n\n            // Fallback demo planets if no galaxy system\n            if (demoPlanets.length === 0) {\n                const planet1 = this.physics.createPlanet('demo_planet_1', { x: 420, y: 300 }, 1000000, 50);\n                const planet2 = this.physics.createPlanet('demo_planet_2', { x: 1020, y: 600 }, 800000, 40);\n\n                this.physics.addObject(planet1);\n                this.physics.addObject(planet2);\n\n                this.physics.addGravityWell('demo_planet_1', {\n                    position: planet1.position,\n                    mass: planet1.mass,\n                    radius: 200\n                });\n\n                this.physics.addGravityWell('demo_planet_2', {\n                    position: planet2.position,\n                    mass: planet2.mass,\n                    radius: 180\n                });\n\n                demoPlanets.push(planet1, planet2);\n            }\n\n            // Pass demo entities to state manager for rendering\n            this.stateManager.setDemoShip(this.playerShip.getPhysicsObject());\n            this.stateManager.setDemoPlanets(demoPlanets);\n            \n            this.logger.info('✅ Demo content setup completed');\n            \n        } catch (error) {\n            this.logger.error('❌ Failed to setup demo content', error);\n        }\n    }\n\n    /**\n     * Initialize galaxy asynchronously to prevent blocking\n     */\n    private async initializeGalaxyAsync(): Promise<void> {\n        try {\n            this.logger.info('🌌 Starting galaxy initialization...');\n            \n            // Add timeout to prevent infinite hang\n            const galaxyInitPromise = this.galaxyManager!.initialize();\n            const timeoutPromise = new Promise((_, reject) => {\n                setTimeout(() => reject(new Error('Galaxy initialization timeout')), 8000);\n            });\n            \n            await Promise.race([galaxyInitPromise, timeoutPromise]);\n            this.logger.info('✅ Galaxy initialization completed');\n            \n        } catch (error) {\n            this.logger.error('❌ Galaxy initialization failed, using fallback', error);\n            \n            // Ensure we can still play with minimal content\n            try {\n                // Create minimal demo content immediately\n                this.setupEmergencyContent();\n            } catch (emergencyError) {\n                this.logger.error('Emergency content setup failed', emergencyError);\n            }\n        }\n    }\n    \n    /**\n     * Setup emergency content when galaxy fails\n     */\n    private setupEmergencyContent(): void {\n        this.logger.info('🚨 Setting up emergency content...');\n        \n        // Create a simple ship at screen center\n        const shipPosition = { x: 720, y: 450 };\n        \n        this.playerShip = new PlayerShip(\n            this.physics,\n            this.input,\n            this.audio,\n            shipPosition\n        );\n        \n        // Create a few simple planets for immediate gameplay\n        const planet1 = this.physics.createPlanet('emergency_planet_1', { x: 520, y: 300 }, 500000, 30);\n        const planet2 = this.physics.createPlanet('emergency_planet_2', { x: 920, y: 600 }, 400000, 25);\n        \n        this.physics.addObject(planet1);\n        this.physics.addObject(planet2);\n        \n        this.physics.addGravityWell('emergency_planet_1', {\n            position: planet1.position,\n            mass: planet1.mass,\n            radius: 120\n        });\n        \n        this.physics.addGravityWell('emergency_planet_2', {\n            position: planet2.position,\n            mass: planet2.mass,\n            radius: 100\n        });\n        \n        // Set up demo entities for state manager\n        this.stateManager.setDemoShip(this.playerShip.getPhysicsObject());\n        this.stateManager.setDemoPlanets([planet1, planet2]);\n        \n        this.logger.info('✅ Emergency content ready');\n    }\n\n    /**\n     * Handle errors\n     */\n    handleError(error: any): void {\n        this.logger.error('Game error handled', error);\n        \n        // Try to recover gracefully\n        try {\n            // Pause the game\n            this.pause();\n            \n            // Show error state\n            this.stateManager.setState(GameState.Error);\n            \n        } catch (recoveryError) {\n            this.logger.critical('Failed to recover from error', recoveryError);\n            // Full stop if recovery fails\n            this.stop();\n        }\n    }\n\n    /**\n     * Setup auto-save functionality\n     */\n    private setupAutoSave(): void {\n        setInterval(() => {\n            if (this.isRunning && !this.isPaused) {\n                this.saveGame();\n            }\n        }, this.config.autoSaveInterval);\n    }\n\n    /**\n     * Save game state\n     */\n    async saveGame(): Promise<void> {\n        try {\n            await this.stateManager.save();\n            this.logger.debug('💾 Game saved');\n        } catch (error) {\n            this.logger.error('Failed to save game', error);\n        }\n    }\n\n    /**\n     * Load game state\n     */\n    async loadGame(): Promise<void> {\n        try {\n            await this.stateManager.load();\n            this.logger.info('📁 Game loaded');\n        } catch (error) {\n            this.logger.error('Failed to load game', error);\n        }\n    }\n\n    /**\n     * Cleanup resources\n     */\n    async cleanup(): Promise<void> {\n        this.logger.info('🧹 Cleaning up game resources...');\n        \n        this.stop();\n        \n        if (this.renderer) {\n            this.renderer.cleanup();\n        }\n        \n        if (this.audio) {\n            this.audio.cleanup();\n        }\n        \n        if (this.input) {\n            this.input.cleanup();\n        }\n        \n        if (this.playerShip) {\n            this.playerShip.cleanup();\n        }\n        \n        if (this.galaxyManager) {\n            await this.galaxyManager.cleanup();\n        }\n        \n        if (this.celestialManager) {\n            this.celestialManager.cleanup();\n        }\n        \n        // Cleanup inventory and crafting systems (save state if needed)\n        if (this.inventoryManager) {\n            this.inventoryManager.clearInventory();\n        }\n        \n        this.logger.info('✅ Game cleanup completed');\n    }\n\n    // Getters for external access\n    getIsPaused(): boolean {\n        return this.isPaused;\n    }\n\n    isGameRunning(): boolean {\n        return this.isRunning;\n    }\n\n    getPerformanceStats() {\n        return { ...this.performanceStats };\n    }\n\n    getRenderer(): Renderer {\n        return this.renderer;\n    }\n\n    getInput(): InputManager {\n        return this.input;\n    }\n\n    getPhysics(): SpacePhysics {\n        return this.physics;\n    }\n\n    getAudio(): AudioEngine {\n        return this.audio;\n    }\n\n    getStateManager(): GameStateManager {\n        return this.stateManager;\n    }\n}","/**\n * Space Explorer 16-Bit - Main Entry Point\n * AI-Generated 2D space exploration game with retro CRT aesthetic\n */\n\nimport { Game } from '@core/Game';\nimport { Platform, PlatformDetector } from '@utils/Platform';\nimport { Logger } from '@utils/Logger';\n\n// Global game instance\nlet game: Game | null = null;\n\n/**\n * Initialize the game with proper error handling\n */\nasync function initializeGame(): Promise<void> {\n    const logger = new Logger('Main');\n    \n    try {\n        logger.info('🚀 Starting Space Explorer 16-Bit initialization...');\n        \n        // Detect platform for adaptive features\n        const platform = PlatformDetector.detect();\n        logger.info(`Platform detected: ${platform}`);\n        \n        // Initialize canvas and context\n        const canvas = document.getElementById('gameCanvas') as HTMLCanvasElement;\n        if (!canvas) {\n            throw new Error('Game canvas not found');\n        }\n        \n        // Adjust canvas for mobile\n        if (platform === Platform.Mobile) {\n            adjustCanvasForMobile(canvas);\n        }\n        \n        // Initialize game engine\n        game = new Game(canvas, platform);\n        \n        // Initialize game systems\n        await game.initialize();\n        \n        // Setup event listeners\n        setupEventListeners();\n        \n        // Start the game directly with main menu\n        await game.start();\n        \n        logger.info('✅ Game successfully initialized and started');\n        \n    } catch (error) {\n        logger.error('❌ Failed to initialize game:', error);\n        showErrorScreen(error as Error);\n    }\n}\n\n/**\n * Adjust canvas size and settings for mobile devices\n */\nfunction adjustCanvasForMobile(canvas: HTMLCanvasElement): void {\n    const container = document.getElementById('gameContainer')!;\n    const containerRect = container.getBoundingClientRect();\n    \n    // Calculate optimal size maintaining aspect ratio\n    const targetRatio = 1440 / 900; // Updated for new resolution\n    let width = containerRect.width - 20; // margin\n    let height = width / targetRatio;\n    \n    if (height > containerRect.height - 20) {\n        height = containerRect.height - 20;\n        width = height * targetRatio;\n    }\n    \n    canvas.style.width = `${width}px`;\n    canvas.style.height = `${height}px`;\n    \n    // Maintain internal resolution for pixel-perfect rendering\n    canvas.width = 1440;\n    canvas.height = 900;\n}\n\n/**\n * Setup global event listeners\n */\nfunction setupEventListeners(): void {\n    // Handle window resize\n    window.addEventListener('resize', () => {\n        if (game && PlatformDetector.detect() === Platform.Mobile) {\n            const canvas = document.getElementById('gameCanvas') as HTMLCanvasElement;\n            adjustCanvasForMobile(canvas);\n            game.handleResize();\n        }\n    });\n    \n    // Handle visibility changes (pause when tab not visible)\n    document.addEventListener('visibilitychange', () => {\n        if (game) {\n            if (document.hidden) {\n                game.pause();\n            } else {\n                game.resume();\n            }\n        }\n    });\n    \n    // Handle page unload\n    window.addEventListener('beforeunload', () => {\n        if (game) {\n            game.cleanup();\n        }\n    });\n    \n    // Handle errors\n    window.addEventListener('error', (event) => {\n        const logger = new Logger('GlobalError');\n        logger.error('Unhandled error:', event.error);\n        \n        if (game) {\n            game.handleError(event.error);\n        }\n    });\n}\n\n/**\n * Show error screen with debugging information\n */\nfunction showErrorScreen(error: Error): void {\n    const gameContainer = document.getElementById('gameContainer')!;\n    \n    // Create error screen\n    const errorScreen = document.createElement('div');\n    errorScreen.style.cssText = `\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: #000;\n        color: #f00;\n        font-family: monospace;\n        display: flex;\n        flex-direction: column;\n        justify-content: center;\n        align-items: center;\n        z-index: 1000;\n    `;\n    \n    errorScreen.innerHTML = `\n        <div style=\"text-align: center; max-width: 80%;\">\n            <h2 style=\"color: #f00; margin-bottom: 20px;\">❌ INITIALIZATION FAILED</h2>\n            <div style=\"background: rgba(255, 0, 0, 0.1); padding: 20px; border: 1px solid #f00; margin-bottom: 20px;\">\n                <div><strong>Error:</strong> ${error.message}</div>\n                <pre style=\"font-size: 10px; margin-top: 10px; text-align: left;\">${error.stack}</pre>\n            </div>\n            <div style=\"color: #ff0;\">\n                Please check the browser console for more details.\n            </div>\n        </div>\n    `;\n    \n    gameContainer.appendChild(errorScreen);\n}\n\n/**\n * Development helpers (only in dev mode)\n */\nif (import.meta.env.DEV) {\n    // Expose game instance for debugging\n    (window as any).__SPACE_EXPLORER_GAME__ = () => game;\n    \n    // Add debug key bindings\n    document.addEventListener('keydown', (event) => {\n        if (event.key === 'F12' || (event.ctrlKey && event.shiftKey && event.key === 'I')) {\n            // Allow developer tools\n            return;\n        }\n        \n        if (game && event.ctrlKey) {\n            switch (event.key) {\n                case 'r':\n                    // Restart game\n                    event.preventDefault();\n                    location.reload();\n                    break;\n                case 'p':\n                    // Toggle pause\n                    event.preventDefault();\n                    if (game.getPaused()) {\n                        game.resume();\n                    } else {\n                        game.pause();\n                    }\n                    break;\n            }\n        }\n    });\n}\n\n// Start the game when DOM is ready\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initializeGame);\n} else {\n    initializeGame();\n}\n\n// Export for potential external access\nexport { game };"],"names":["Platform","_PlatformDetector","detect","this","cachedPlatform","window","__TAURI__","cordova","isMobile","isDesktop","getFeatures","cachedFeatures","platform","hasKeyboard","hasTouch","hasFileSystem","hasFullscreen","canVibrate","preferredInputMethod","getPreferredInput","storageType","getStorageType","userAgent","navigator","vendor","opera","test","maxTouchPoints","smallScreen","innerWidth","innerHeight","largeScreen","desktopOS","document","fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled","getConfig","features","canvas","pixelRatio","devicePixelRatio","maxWidth","maxHeight","scalingMode","input","enableKeyboard","enableTouch","enableGamepad","touchSensitivity","keyRepeatDelay","keyRepeatRate","performance","targetFPS","enableParticles","enablePostProcessing","enableShadows","enableDithering","renderScale","audio","enableAudio","enableMusic","enableSFX","enableSpatialAudio","audioFormat","maxChannels","storage","type","enableAutoSave","saveInterval","maxSaveSlots","compressionEnabled","supports","feature","Boolean","getPlatformName","reset","PlatformDetector","LogLevel","_Logger","constructor","module","configure","config","level","globalLevel","maxEntries","enableConsole","enableStorage","setLevel","debug","message","data","log","info","warn","error","stack","Error","name","critical","entry","timestamp","Date","now","addEntry","outputToConsole","storeEntry","entries","push","length","shift","prefix","toISOString","consoleMethod","style","console","groupCollapsed","groupEnd","stored","localStorage","getItem","logs","JSON","parse","splice","setItem","stringify","getEntries","getEntriesByLevel","filter","getEntriesByModule","clear","removeItem","exported","loadFromStorage","slice","createPerformanceLogger","start","end","measure","fn","measureAsync","timers","Map","set","logger","startTime","get","duration","delete","toFixed","result","Logger","Renderer","gl","shaderPrograms","colorPalette","renderStats","drawCalls","triangles","sprites","particles","ctx","getContext","enablePixelPerfect","enableCRT","Mobile","Desktop","backgroundColor","canvasSize","width","height","initialize","setupPixelPerfectCanvas","generateColorPalette","initializeWebGL","createRenderBuffers","imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","scale","size","r","g","b","fallbackTo2D","globalCompositeOperation","willReadFrequently","backBuffer","createImageData","frontBuffer","clearBuffer","hexToColor","beginFrame","fillStyle","fillRect","endFrame","applyDithering","putImageData","applyCRTEffect","buffer","color","i","a","setPixel","x","y","Math","floor","index","py","px","drawLine","x0","y0","x1","y1","dx","abs","dy","sx","sy","err","e2","drawCircle","centerX","centerY","radius","filled","d","renderText","text","save","font","colorToHex","textBaseline","shadowColor","shadowBlur","fillText","restore","renderDebugText","lines","textColor","max","map","line","forEach","generateShipSprite","imageData","shipColor","accentColor","bodyWidth","drawSprite","sprite","oldR","oldG","oldB","newColor","findNearestPaletteColor","errorR","errorG","errorB","distributeError","factor","min","nearestColor","minDistance","Number","MAX_VALUE","paletteColor","distance","sqrt","pow","handleResize","hex","exec","parseInt","toHex","c","round","toString","getRenderStats","drawRect","cleanup","program","deleteProgram","InputManager","gamepads","touchZones","activeTouches","enableMouse","eventListeners","currentState","createEmptyInputState","previousState","configureForPlatform","setupEventListeners","setupTouchZones","Tauri","Cordova","Web","keyDownHandler","e","handleKeyDown","keyUpHandler","handleKeyUp","addEventListener","removeEventListener","mouseMoveHandler","handleMouseMove","mouseDownHandler","handleMouseDown","mouseUpHandler","handleMouseUp","wheelHandler","handleWheel","touchStartHandler","handleTouchStart","touchMoveHandler","handleTouchMove","touchEndHandler","handleTouchEnd","passive","gamepadConnectedHandler","handleGamepadConnected","gamepadDisconnectedHandler","handleGamepadDisconnected","focusHandler","handleFocus","blurHandler","handleBlur","canvasRect","getBoundingClientRect","update","deltaTime","deepCopyInputState","keysPressed","keysReleased","mouseButtonsPressed","mouseButtonsReleased","mouseWheel","touchStarted","touchEnded","updateGamepadState","updateVirtualControls","key","code","keys","has","add","isGameKey","preventDefault","rect","mousePosition","clientX","left","clientY","top","button","mouseButtons","deltaY","touches","Array","from","changedTouches","touch","identifier","id","startPosition","currentPosition","zone","getTouchZone","touchInfo","gamepad","connected","axes","buttons","getGamepads","state","pressed","virtualThrust","virtualRotation","virtualAction","touchId","deltaX","Set","includes","zoneName","isKeyDown","isKeyPressed","isKeyReleased","isMouseButtonDown","isMouseButtonPressed","getMousePosition","getMouseWheel","getTouchCount","getVirtualThrust","getVirtualRotation","getThrustInput","thrust","values","getRotationInput","rotation","isActionPressed","isPausePressed","SpacePhysics","objects","gravityWells","GRAVITATIONAL_CONSTANT","SPACE_DRAG","MIN_VELOCITY","MAX_VELOCITY","collisionPairs","addObject","object","removeObject","removed","getObject","addGravityWell","well","removeGravityWell","isStatic","updateObject","detectCollisions","resolveCollisions","acceleration","applyGravity","applyDrag","velocity","speed","getVectorMagnitude","position","distanceSquared","force","mass","forceX","forceY","drag","objectArray","j","objA","objB","collision","checkCollision","objectA","objectB","penetration","normal","point","resolveCollision","onCollision","separationA","separationB","relativeVelocity","velocityAlongNormal","impulse","restitution","impulseVector","applyThrust","objectId","thrustVector","thrustPower","magnitude","normalizedThrust","calculateOrbitalVelocity","centralMass","calculateEscapeVelocity","getObjectsInRadius","center","getDistance","raycast","direction","maxDistance","normalizedDirection","normalizeVector","vector","getStats","objectCount","gravityWellCount","collisionCount","activeObjects","obj","getObjectCount","getAllObjects","createShip","friction","health","createPlanet","createProjectile","AudioEngine","context","masterGain","musicGain","sfxGain","soundEffects","activeSources","musicTrack","ambientTrack","synthNodes","isInitialized","masterVolume","musicVolume","sfxVolume","sampleRate","AudioContext","webkitAudioContext","setupUserInteractionHandler","createGain","connect","destination","setMasterVolume","setMusicVolume","setSfxVolume","generateBasicSounds","resumeAudio","async","resume","once","engineBuffer","generateEngineSound","loop","volume","pitch","laserBuffer","generateLaserSound","explosionBuffer","generateExplosionSound","beepBuffer","generateBeepSound","samples","createBuffer","getChannelData","t","baseFreq","sin","harmonic1","PI","harmonic2","harmonic3","noise","random","progress","freq","amplitude","exp","rumble","frequency","playSfx","soundId","soundEffect","source","createBufferSource","gainNode","sourceId","pannerNode","playbackRate","value","gain","createPanner","panningModel","distanceModel","refDistance","rolloffFactor","positionX","positionY","positionZ","audioSource","node","isPlaying","currentTime","onended","stopSound","stop","updateSpatialAudio","setListenerPosition","orientation","listener","forwardX","cos","forwardY","forwardZ","upX","upY","upZ","playEngineSound","playLaserSound","playExplosion","playUIBeep","pauseAll","suspend","resumeAll","stopAll","contextState","close","SoundType","ProceduralAudio","events","audioContext","soundEffectsGain","currentTrack","ambientLayers","activeSounds","noiseBuffer","convolver","reverbBuffer","createNoiseBuffer","createReverbBuffer","onAudioError","bufferSize","output","channel","channelData","decay","createConvolver","playSound","sourceGain","filterNode","distortionNode","waveform","createNoiseSource","createOscillatorSource","createBiquadFilter","Q","resonance","distortion","createDistortion","z","currentNode","applyEnvelope","frequencyModulation","OscillatorNode","applyFrequencyModulation","onSoundPlayed","oscillator","createOscillator","harmonics","harmonic","harmonicOsc","harmonicGain","amount","createWaveShaper","curve","Float32Array","deg","oversample","gainParam","attack","sustain","release","setValueAtTime","linearRampToValueAtTime","sustainEnd","modConfig","modOscillator","modGain","rate","depth","playRetroSound","intensity","configs","engine","laser","explosion","beep","warning","warp","reverb","roomSize","dampening","wetness","shield","impact","communication","ambient","ui","startAmbientTrack","trackName","stopAmbientTrack","deep_space","fadeInTime","fadeOutTime","crossfadeTime","layers","baseFrequency","pan","frequencyVariation","volumeVariation","minFreq","maxFreq","nebula_drift","void_silence","createAmbientLayers","onTrackChanged","layerConfig","layerGain","panner","createStereoPanner","startLayerModulation","freqModOsc","freqModGain","filterModOsc","filterModGain","layer","setTimeout","setSFXVolume","getAudioStats","stopAllSounds","sound","AudioScheduledSourceNode","dispose","MainMenu","selectedButtonIndex","animationTime","transitionProgress","isTransitioning","backgroundParticles","titleGlow","screenFlicker","saveSlots","newGameSettings","getDefaultNewGameSettings","gameSettings","getDefaultGameSettings","loadSaveSlots","initializeMainMenu","startBackgroundEffects","updateVisualEffects","updateTransition","handleInput","updateParticleEffects","navigateUp","navigateDown","selectButton","goBack","handleNewGameInput","handleSettingsInput","handleHotkeys","playUISound","enabled","updateButtonHighlights","action","onExit","transitionToState","highlighted","hotkey","hasSaveGames","updateButtonPositions","initializeNewGameMenu","playerName","editPlayerName","translateDifficulty","difficulty","cycleDifficulty","translateGalaxySize","galaxySize","cycleGalaxySize","translateEnemyFrequency","enemyFrequency","cycleEnemyFrequency","enablePermadeath","togglePermadeath","enableTutorial","toggleTutorial","startNewGame","initializeLoadGameMenu","slot","exists","system","playtime","loadGame","initializeSettingsMenu","adjustRenderScale","adjustMasterVolume","adjustMusicVolume","adjustSfxVolume","showFPS","toggleShowFPS","vsync","toggleVSync","applySettings","resetToDefaults","generateRandomSeed","adjustSettingDown","adjustSettingUp","newState","createTransitionEffect","initializeMenuForState","updateBackgroundParticles","createExplosion","emitterId","createThrustTrail","Beep","UI","Communication","Warning","names","currentIndex","indexOf","updateNewGameMenuText","difficulties","sizes","frequencies","galaxySeed","substring","toUpperCase","onNewGame","settingId","updateSettingsMenuText","onSettings","saveSettings","onLoadGame","find","startingResources","fullscreen","mouseSensitivity","autoSave","autoSaveInterval","colorblindMode","subtitles","reducedMotion","keyBindings","forward","backward","right","fire","some","date","loadSettings","saved","render","renderer","renderMainMenu","renderNewGameMenu","renderLoadGameMenu","renderSettingsMenu","renderGameStart","renderTransition","titleColor","renderButtons","hint","progressWidth","loadingTexts","textIndex","currentText","onGameStart","wipeHeight","renderButton","hotkeyText","replace","align","fontSize","textX","charX","getCurrentState","getGameSettings","setNewGameSettings","settings","Object","assign","removeEmitter","GameState","GameStateManager","stateStack","transitions","stateStartTime","mainMenu","demoShip","demoPlanets","gameTimeStarted","gameData","createDefaultGameData","initializeMenuSystem","setupStateTransitions","menuEvents","handleNewGame","saveSlot","handleLoadGame","handleSettingsChange","handleExit","setState","loadGameData","setupDemoContent","playerShip","fuel","resources","currentSystem","gameTime","experience","discoveries","technologies","stats","timePlayedSeconds","systemsVisited","aliensEncountered","battlesWon","resourcesCollected","addTransition","to","condition","onStateEnter","transitionKey","transition","pushState","popState","poppedState","pop","startGameTimeTracking","pauseGameTimeTracking","updatePlayingState","updateLoadingState","catch","renderLoadingState","renderPlayingState","renderPausedState","renderErrorState","renderDefaultState","dots","repeat","renderMenuState","renderMenuBackground","item","renderEnhancedSpaceBackground","planet","planetColors","baseColor","planetRadius","atmosphereSize","glowRadius","glowOpacity","shadeFactor","shadeColor","surfaceDetails","angle","f","detail","terminatorX","distFromCenter","shadowWidth","highlightX","highlightY","highlightSize","shipSize","shipSprite","shipX","shipY","engineGlowSize","engineY","trailY","trailOpacity","trailSize","renderEnhancedHUD","renderSpaceBackground","brightness","starCount","starBrightness","nebulaColors","opacity","nebulaColor","arm","armOffset","gradient","twinkle","twinkleColor","renderBasicHUD","minutes","seconds","padStart","fuelPercent","shipPos","saveData","version","serialized","load","resourcesArray","isArray","toLowerCase","saveKey","getPreviousState","getGameData","isInState","setDemoShip","ship","setDemoPlanets","planets","canPause","canResume","isGameActive","isInMenu","ShipSection","SystemType","ShipSystems","damage","heatGeneration","powerConsumption","fuelConsumption","updateTimer","lastUpdateTime","maxHull","maxShields","maxPower","maxFuel","maxHeat","enginePower","engineEfficiency","shieldRegenRate","shieldPowerDrain","weaponCount","weaponPower","weaponHeatGeneration","status","hull","shields","power","heat","enginesOnline","shieldsOnline","weaponsOnline","lifeSupport","warpDrive","shieldStrength","weaponAccuracy","sensorRange","powerAllocation","engines","weapons","sensors","section","updatePowerConsumption","updateThermalManagement","updateShields","updateFuelConsumption","updateSystemEfficiency","checkCriticalSystems","updatePerformanceModifiers","totalConsumption","handlePowerFailure","handleOverheat","regenRate","consumption","emergencyShutdown","engineDamage","getSectionDamageLevel","coreDamage","weaponDamage","bridgeDamage","heatPenalty","powerLevel","powerPenalty","onCriticalDamage","onPowerFailure","onOverheat","applyDamage","damageType","actualDamage","shieldAbsorption","addDamageReport","severity","calculateDamageSeverity","systemsAffected","getAffectedSystems","damageReport","repairCost","calculateRepairCost","repairTime","calculateRepairTime","sectionDamage","onSystemDamage","bow","stern","port","starboard","core","bridge","engineering","minor","metal","electronics","crystals","moderate","major","nanobots","destroyed","damages","totalDamage","repairDamage","damageIndex","hasEnoughResources","onSystemRepaired","available","required","setPowerAllocation","allocation","total","reduce","sum","val","toggleSystem","getSystemState","getStatus","getPowerAllocation","getDamageReports","getDiagnostics","totalDamageReports","reports","criticalSystems","getCriticalSystems","addFuel","addPower","emergencyRepair","WarpDrive","stateTimer","isCharging","isActive","accretionParticles","blackHoleRadius","shipPosition","originalSpeed","PHASE_PARTICLE_ABSORPTION","PHASE_BLACK_HOLE_GROWTH","PHASE_ACCRETION_FORMATION","PHASE_SHUTDOWN","particleIntensity","blackHoleIntensity","accretionIntensity","distortionIntensity","speedMultiplier","energyCost","particleCount","maxRange","cooldownTime","activateWarp","initializeParticles","onWarpStart","deactivateWarp","colors","life","absorbed","updateChargingPhase","updateBlackHoleGrowth","updateAccretionFormation","updateActiveWarp","updateDeactivation","updateParticles","updateAccretionDisk","updateSpaceDistortion","particle","toCenter","initializeAccretionDisk","totalGrowthProgress","onBlackHoleFormed","onSpaceDistorted","reverseProgress","addDissolutionParticles","clearAllEffects","onWarpEnd","getAccretionColor","fromCenter","p","renderSpaceDistortion","renderParticles","renderAccretionDisk","renderBlackHole","alpha","glowColor","baseRadius","getState","isWarpActive","isWarpCharging","getWarpProgress","getSpaceDistortion","PlayerShip","physics","thrustLevel","engineSoundId","thrustParticles","maxHealth","rotationSpeed","maxVelocity","currentFuel","physicsObject","other","handleCollision","shipSystems","warpSpeedMultiplier","updateRotation","updateMovement","updateThrustParticles","updateAudio","consumeFuel","handleWarpInput","thrustInput","rotationInput","systemStatus","thrustDirection","thrustForce","createThrustParticles","currentSpeed","maxLife","collisionDamage","takeDamage","destroy","heal","fireWeapon","spawnOffset","spawnX","spawnY","projectileSpeed","projectileVelocity","projectile","renderThrustParticles","getShipData","getPhysicsObject","getPosition","getVelocity","getRotation","isAlive","getSystemStatus","getShipSystems","Core","getWarpDrive","getWarpState","renderWarpEffects","StarType","PlanetType","GalaxyGenerator","stars","starSystems","galaxyMap","seed","spiralArms","armTightness","coreSize","starDensity","SeededRandom","generateGalaxy","progressCallback","generateStarPositions","generateStarProperties","generateStarSystems","generateAnomalies","endTime","systems","generateSpiralPosition","starId","star","generateStarName","luminosity","temperature","age","metallicity","normalizedRadius","next","spiralAngle","angleNoise","radiusNoise","finalAngle","finalRadius","prefixes","suffixes","suffix","number","distanceFromCore","coreInfluence","range","generateStellarMass","getStarTypeFromMass","calculateLuminosity","calculateTemperature","calculateRadius","generateStellarAge","getStarColor","O","B","A","F","G","K","M","lifetime","systemCount","batchSize","batch","generateStarSystemSync","Promise","resolve","generateStarSystemInternal","generateStarSystem","asteroidBelts","habitableZoneInner","habitableZoneOuter","systemAge","planetCount","currentOrbit","generatePlanet","innerRadius","outerRadius","density","composition","choice","orbitDistance","planetId","planetType","generatePlanetMass","calculatePlanetRadius","calculatePlanetTemperature","numberToRoman","orbitPeriod","calculateOrbitPeriod","hasAtmosphere","determineAtmosphere","hasRings","moons","surfaceType","determineSurfaceType","surfaceColor","generateSurfaceColor","hasWater","hasLife","atmosphereType","determineAtmosphereType","moonCount","generateMoonCount","generateMoon","solarConstant","starMass","String","fromCharCode","tidallyLocked","num","symbols","getStarsInRadius","getStarSystem","getAllStars","getAllSystems","getGalaxyConfig","array","integer","GalaxyPersistence","cachedSaveData","loadedChunks","saveGalaxy","generator","playerData","explorationData","exploredSystems","discoveredPlanets","visitedLocations","reputation","tradeRoutes","compressStarData","compressSystemData","saveToStorage","calculateSaveSize","loadGalaxy","validateSaveData","restoreGalaxyData","loadGalaxyChunk","options","chunkKey","getChunkKey","limitedStars","maxSystems","includeUnexplored","isSystemExplored","pos","temp","compressPlanetData","explored","orbit","hasAtmo","saveToWebStorage","saveToFileSystem","saveToCordovaFile","loadFromWebStorage","loadFromFileSystem","loadFromCordovaFile","saveToIndexedDB","localStorageError","loadFromIndexedDB","reject","request","indexedDB","open","onerror","onupgradeneeded","db","objectStoreNames","contains","createObjectStore","onsuccess","transaction","putRequest","objectStore","put","getRequest","parseError","split","bytes","Blob","systemId","clearCache","getStorageStats","cacheSize","lastSaveTime","exportGalaxy","importGalaxy","GalaxyManager","loadedSystems","nearbyStars","autoSaveTimer","chunkLoadRadius","maxLoadedSystems","galaxyConfig","persistence","currentSystemId","homeSystemId","totalSystemsVisited","totalPlanetsExplored","totalDistanceTraveled","galaxyDiscoveryProgress","timeoutPromise","_","initPromise","doInitialize","race","initializeFallbackGalaxy","createEmergencySystem","savedData","setupNewGame","loadCurrentArea","setupAutoSave","createEmergencyGalaxy","createHardcodedSystem","emergencySystem","atmosphere","discovered","centerStars","startingSystem","exploreSystem","chunkOptions","nearbySystems","travelToSystem","targetSystem","currentPos","coordinates","discoverPlanet","updateExplorationProgress","totalSystems","getNearbyStars","getLoadedSystems","getCurrentSystem","getSystem","findSystemsInRadius","isPlanetDiscovered","getGalaxyStats","totalStars","allSystems","distanceTraveled","currentSystemName","explorationProgress","clearInterval","setInterval","getPlayerData","getExplorationData","searchSystems","query","lowercaseQuery","getSystemDistance","systemId1","systemId2","system1","system2","getHomeSystem","updateConfig","newConfig","isGalaxyInitialized","CockpitStatusBar","interactions","panels","interactiveElements","flickerTimer","scanlineOffset","glitchTimer","hoveredElement","selectedElement","isDragging","damageReports","cargoLoad","radarZoom","radarMode","screenWidth","screenHeight","panelHeight","panelSpacing","enableInteraction","crtEffects","setupPanels","setupInteractiveElements","panelWidth","startY","title","setupSystemsPanel","setupControlPanel","setupDamagePanel","setupWeaponsPanel","setupRadarPanel","panel","addElement","label","mousePos","element","isPointInElement","handleElementClick","handleSliderDrag","elementId","handleButtonClick","handleToggleClick","onInventoryOpen","onCodexOpen","onResearchOpen","onCrewOpen","onGalaxyMapOpen","onRadarZoom","systemName","engines_toggle","shields_toggle","weapons_toggle","warp_toggle","radar_mode","onSystemToggle","localX","percentage","onPowerAllocationChange","renderPanelBase","renderPanel","renderCRTEffects","baseY","baseHeight","panelIndex","renderSystemsPanel","renderControlPanel","renderDamagePanel","renderWeaponsPanel","renderRadarPanel","renderStatusBar","renderWarningLight","renderToggle","thrustSlider","shieldSlider","renderSlider","renderDamageDisplay","renderRadarDisplay","isHeat","fillWidth","fillColor","bgColor","sliderPos","isHovered","maxRadius","updateSystemStatus","updateDamageReports","updateCargoLoad","CelestialBody","orbitRadius","orbitSpeed","orbitAngle","currentRotation","interactionZones","mineralDeposits","isDiscovered","isScanned","isLanded","resourcesDepleted","planetData","starData","moonData","initializeFromData","generateInteractionZones","generateResources","updatePlanetVisuals","getDarkStarColor","Terrestrial","atmosphereColor","Ocean","Desert","Volcanic","Frozen","GasGiant","ringColor","IceGiant","Toxic","bodyId","canEnter","requirements","canLand","canShipLand","getResourceTypes","resourceType","richness","accessibility","extractionDifficulty","generateSurfaceConditions","baseResources","gravity","radiation","weather","landingDifficulty","surfaceConditions","orbitCenter","cameraPosition","getDistanceFrom","renderDistance","screenPos","baseSize","scaledSize","minPixelSize","maxPixelSize","showOrbitLines","renderOrbitLine","atmoSize","renderRings","renderSurfaceDetails","renderStarGlow","centerScreen","orbitColor","featureX","featureY","featureColor","checkInteraction","performMining","miningEfficiency","interaction","availableResources","deposit","resource","extractedQuantity","quantity","quality","depletion","performScan","atmosphereData","biologicalSigns","anomalies","setOrbit","getInteractionInfo","InteractionPanel","isVisible","currentBody","currentZone","targetOpacity","panelX","panelY","hoveredButton","selectedButton","bodyInfo","scanData","miningResults","enableAnimations","fadeSpeed","showInteraction","body","calculatePanelPosition","setupButtons","hideInteraction","bodyPosition","screenBodyX","screenBodyY","buttonHeight","currentY","isPointInButton","buttonId","onEnterOrbit","onLand","onContinueFlight","onPerformScan","onStartMining","mineButton","borderColor","renderPanelBorder","renderBodyInfo","renderScanData","renderMiningResults","highlightColor","join","lastResult","buttonAlpha","textY","scanlineColor","isInteractionVisible","getCurrentBody","CelestialManager","panelInteractions","bodies","systemCenter","nearbyBodies","currentInteraction","frameCount","interactionDistance","enableInteractions","celestialBodyConfig","orbitLineOpacity","animationSpeed","interactionPanel","loadSystem","systemConfig","systemData","clearSystem","createStar","createMoon","setupOrbitalMechanics","getPlanetColor","parentPlanet","parentBody","moon","originalSetOrbit","bind","updateInteractions","closestInteraction","closestDistance","Infinity","sort","distA","getBody","getAllBodies","getNearbyBodies","getCurrentInteraction","discoverAllBodies","getSystemStats","discoveredBodies","scannedBodies","bodyCount","hasActiveInteraction","performAction","getActiveBodies","SpaceBackground","galaxyBand","nebulaClouds","isDistorted","distortionData","time","starLayers","parallaxStrength","enableDistortion","galaxyBandIntensity","nebulaOpacity","generateBackground","generateStars","generateGalaxyBand","generateNebulae","getStarSize","originalPosition","bandWidth","bandOffset","getGalaxyBandColor","getNebulaColor","applyWarpDistortion","distortStars","restoreFromDistortion","gradualRestore","restoreAmount","restoreStarsGradually","pullStrength","renderNebulae","renderGalaxyBand","renderStarLayer","nebula","screenX","screenY","pixelCount","renderStar","parallaxFactor","halfCore","dimColor","updateWarpDistortion","galaxyBandStars","nebulaCount","regenerateBackground","ItemType","ItemRarity","ItemDatabase","items","recipes","categories","initializeDatabase","totalItems","generateComponents","generateEquipment","generateWeapons","generateTools","generateConsumables","generateBlueprints","generateArtifacts","description","category","rarity","maxStack","purity","radioactivity","stability","res","createItem","iconColor","isUnique","isTradeable","isConsumable","addItem","durability","efficiency","defense","comp","eq","wp","tool","cons","bp","lore","art","loreText","generateItemSprite","pixels","drawResourceSprite","drawComponentSprite","drawEquipmentSprite","drawWeaponSprite","drawToolSprite","drawConsumableSprite","drawBlueprintSprite","drawArtifactSprite","darkColor","darkenColor","lightColor","lightenColor","recipe","getItemsByCategory","getItemsByType","getItemsByRarity","getAllItems","getRecipe","itemId","searchItems","lowerQuery","generateRandomItem","candidateItems","rarityWeights","common","uncommon","rare","epic","legendary","artifact","totalWeight","weight","currentWeight","selectedRarity","renderItemSprite","pixel","itemsByType","itemsByRarity","InventoryManager","itemDatabase","slots","totalVolume","selectedSlot","draggedItem","sortOptions","by","descending","groupByType","slotSize","slotSpacing","maxSlots","gridWidth","gridHeight","maxWeight","maxVolume","allowStacking","initializeSlots","locked","reserved","remainingQuantity","canAdd","emptySlot","findEmptySlot","onInventoryFull","stackSize","addedWeight","addedVolume","onWeightExceeded","onVolumeExceeded","Equipment","onItemAdded","canRemove","removedWeight","removedVolume","removedItem","onItemRemoved","moveItem","fromSlot","toSlot","canStack","getItemCount","hasItem","getFilteredItems","searchText","search","comparison","localeCompare","rarityOrder","compactInventory","autoSort","aRarity","bRarity","usedSlots","uniqueItems","totalSlots","itemCount","fillPercentage","weightPercentage","volumePercentage","renderBackground","renderHeader","renderGrid","renderItems","renderSelection","renderDraggedItem","buttonY","gridStartX","gridStartY","slotX","slotY","slotIndex","spriteX","spriteY","quantityText","rarityColor","getRarityColor","conditionWidth","conditionColor","Common","Uncommon","Rare","Epic","Legendary","Artifact","statsY","setVisible","visible","isInventoryVisible","selectSlot","onSlotSelected","getSelectedSlot","useSelectedItem","setFilter","clearFilter","setSortOptions","setSlotLocked","setSlotReserved","clearInventory","saveState","modifiers","loadState","slotData","CraftingSystem","inventory","stations","activeAttempts","knownRecipes","selectedStation","selectedRecipe","initializeStations","initializeBasicRecipes","availableRecipes","energyRequired","station","basicRecipes","requiredItems","metal_iron","crystal_quartz","craftingTime","successRate","comp_circuit","gas_hydrogen","metal_titanium","crystal_dilithium","basicStation","advancedStation","updateItemRecipes","targetItem","findTargetItemForRecipe","recipeId","craft_circuit_from_metal","craft_repair_kit","craft_energy_cell","craft_shield_emitter","craft_plasma_conduit","startCrafting","stationId","onCraftingFailed","attempt","onCraftingStarted","completedAttempts","completeCrafting","onCraftingCompleted","returnQuantity","ceil","learnRecipe","getAvailableRecipes","canCraftRecipe","canCraft","missingItems","hasStation","hasAllItems","getCraftingProgress","elapsed","timeRemaining","itemName","renderCraftingPanel","renderCraftingProgress","stationY","stationColor","statusText","recipeY","craftability","missingText","count","progressItems","progressY","progressX","isCraftingVisible","selectStation","getSelectedStation","setStationActive","active","activeStations","s","totalStations","activeCrafting","stationData","WeaponType","DamageType","WeaponSystem","projectiles","weaponStates","nextProjectileId","targetingMode","currentTarget","targetPosition","targets","addWeapon","weapon","chargeProgress","lastFired","ammo","ammoCapacity","isOverheated","cooldownEnd","removeWeapon","weaponId","projId","sourcePosition","fireRate","onAmmoEmpty","chargeTime","finalTargetPos","calculateFiringDirection","spread","onWeaponOverheat","onWeaponFired","targetDistance","calculateDistance","sourcePos","targetPos","projectileId","isHoming","homingStrength","getProjectileSize","targetId","trail","weaponType","spreadRad","updateWeaponStates","updateProjectiles","checkProjectileHits","cleanupProjectiles","updateHomingProjectile","target","predictedPos","targetDirection","currentDirection","homingFactor","newDirection","newLength","calculateDamage","finalDamage","criticalHit","penetrated","shieldsHit","hullHit","onProjectileHit","setTargetingMode","mode","setTargetPosition","setTarget","updateTarget","removeTarget","getWeapon","getAllWeapons","reloadWeapon","renderProjectiles","renderWeaponCharges","trailColor","getProjectileColor","pos1","pos2","weaponsByType","totalWeapons","activeProjectiles","targetsTracked","clearProjectiles","clearTargets","AIBehavior","ShipClass","EnemyAI","weaponSystem","enemies","playerPosition","playerVelocity","playerSize","factionRelations","initializeFactions","factions","faction1","faction2","relation","spawnEnemy","enemy","lastDecisionTime","lastShotTime","weaponCooldowns","waypoint","patrolCenter","patrolRadius","lastDamageTime","onEnemySpawned","shipClass","faction","behavior","updatePlayer","updateEnemy","cleanupDeadEnemies","reactionTime","makeDecision","executeState","updateCombat","distanceToPlayer","inRange","engagementRange","hasLineOfSight","preferredRange","changeState","oldState","generatePatrolWaypoint","generateRetreatWaypoint","onEnemyStateChanged","executePatrol","executePursue","executeAttack","executeEvade","executeRetreat","executeCircleStrafe","executeRamming","moveToward","predictedPlayerPos","predictPlayerPosition","retreatPoint","calculateRetreatPoint","evasionPoint","calculateEvasionPoint","toPlayer","strafeDirection","targetPoint","desiredSpeed","maxSpeed","desiredVelocity","targetRotation","atan2","lerpAngle","turnRate","weaponConfig","cooldownKey","accuracy","intelligence","enemyId","armor","shieldDamage","onEnemyDamaged","destroyEnemy","onEnemyDestroyed","awayFromPlayer","away","perpendicular","diff","renderEnemy","getShipColor","points","getTrianglePoints","drawTriangle","drawShip","drawHealthBar","drawStateIndicator","pirates","aliens","rebels","corporation","military","halfWidth","halfHeight","corners","frontX","frontY","barWidth","barY","healthPercent","healthWidth","healthColor","shieldWidth","patrol","pursue","evade","retreat","ramming","getAllEnemies","getEnemy","enemiesByFaction","enemiesByState","aliveCount","totalEnemies","aliveEnemies","clearEnemies","CombatManager","activeEncounters","combatStats","totalDamageDealt","totalDamageReceived","enemiesDestroyed","shotsHit","shotsFired","encountersCompleted","experienceGained","playerHull","playerMaxHull","handleProjectileHit","enemyAI","handleEnemyDestroyed","initializePlayerWeapons","basicLaser","Energy","mountPoint","hardpointSize","basicProjectile","Projectile","Kinetic","reloadTime","cannon","onPlayerDamaged","hullRemaining","onCombatStatsUpdated","rewards","calculateRewards","checkEncounterCompletion","enemyConfig","Drone","Fighter","Corvette","Frigate","Destroyer","Cruiser","Battleship","randomItem","possibleLoot","lootId","lootItem","startEncounter","encounter","enemyConfigs","spawnPos","spawnPositions","onEncounterStarted","encounterId","completionTime","onEncounterCompleted","generateEncounters","encounters","createEnemyConfig","Aggressive","Kamikaze","credits","dropRate","Evasive","Defensive","Support","classStats","createBasicWeapon","Missile","Plasma","aggression","baseStats","Beam","Torpedo","firePlayerWeapon","startRandomEncounter","randomIndex","getCombatStats","getActiveEncounters","getPlayerWeapons","w","startsWith","getEnemies","clearCombat","resetStats","AttributeType","PlayerProgression","levelExperienceTable","skillExperienceTable","generateExperienceTables","initializeCharacter","initializeSkills","initializeAchievements","baseXP","multiplier","character","experienceToNext","skillPoints","attributePoints","totalPlayTime","enemiesDefeated","systemsExplored","creditsEarned","itemsCrafted","skills","attributes","achievements","attrType","baseValue","maxLevel","bonuses","prerequisite","prerequisiteLevel","skill","current","unlocked","hidden","achievement","addExperience","levelUp","skillPointsGained","attributePointsGained","onLevelUp","addSkillExperience","skillId","requiredXP","onSkillLevelUp","levelUpSkill","prereqSkill","cost","increaseAttribute","attribute","oldValue","recalculateAttribute","onAttributeChanged","addAttributeModifier","modifier","removeAttributeModifier","mod","updateAchievementProgress","req","isAchievementCompleted","unlockAchievement","every","achievementId","unlockedDate","reward","onAchievementUnlocked","updateStatistics","playTime","getSkillBonus","bonusType","bonus","getCategoryBonus","getAttributeValue","getCharacterSheet","getAvailableSkills","getUnlockedAchievements","getAchievementProgress","saveCharacter","loadCharacter","getProgressionStats","totalSkillLevels","highestSkillLevel","totalAttributePoints","attr","achievementsUnlocked","totalAchievements","maxSkillLevels","progressionPercentage","ResearchField","ResearchSystem","projects","facilities","scientists","totalResearchPoints","researchMultipliers","initializeResearchMultipliers","initializeTechnologies","initializeFacilities","initializeScientists","field","tier","researchCost","researchTime","prerequisites","requiredFacilities","unlocks","isUnlocked","isResearching","researchProgress","researchStartTime","tech","specialization","maxProjects","isOperational","currentProjects","maintenanceLevel","upgradeLevel","facility","expertise","isAvailable","fatigue","morale","scientist","startResearch","technologyId","facilityId","scientistIds","technology","prereq","prereqTech","missingPrereq","specializations","validScientists","scientistId","assignedProject","assignedFacility","scientistBonus","fieldMultiplier","estimatedTime","projectId","project","assignedScientists","estimatedCompletion","estimatedHours","totalDuration","completeResearch","makeRandomDiscovery","completedTime","applyTechnologyUnlocks","onTechnologyUnlocked","onResearchCompleted","getTierUnlockCount","onBreakthroughAchieved","unlock","unlockFacility","applyUpgrade","unlockAbility","unlockRecipe","facilityType","quantum_lab","bio_lab","testing_chamber","observatory","upgradeType","abilityId","researchBonus","grantsResources","unlocksTechnology","discovery","discoveryObj","discoveryTime","onDiscoveryMade","getAvailableTechnologies","prereqId","getActiveProjects","getUnlockedTechnologies","getTechnology","getFacilities","getAvailableScientists","getRecentDiscoveries","limit","getResearchStats","fieldProgress","totalTechnologies","unlockedTechnologies","activeProjects","cancelResearch","saveResearchData","loadResearchData","CrewSkill","CrewManagement","crew","traits","shipMorale","disciplineLevel","crewQuarters","managementEvents","initializeTraits","initializeStartingCrew","effects","trait","maxCrew","requiredSkills","assignedCrew","role","species","preferredStation","crewData","createCrewMember","addCrewMember","traitIds","crewId","substr","allSkills","memberTraits","traitId","effect","stress","workEfficiency","preferences","preferredShift","personalityType","workStyle","relationships","rank","commendations","background","homeworld","generateHomeworld","joinDate","roleBackgrounds","captain","pilot","engineer","security","medic","communications","homeworlds","Human","Centaurian","Vulcan","Andorian","speciesWorlds","existingCrew","relationship","calculateInitialRelationship","onCrewJoined","crew1","crew2","assignCrewToStation","currentStation","removeCrewFromStation","calculateWorkEfficiency","updateStationEfficiency","skillTotal","skillCount","skillLevel","totalEfficiency","crewCount","optimalCrew","onStationEfficiencyChanged","updateCrewStatus","updateRelationships","checkCrewEvents","updateShipMorale","stressChange","relationshipStress","relationshipCount","avgRelationship","moraleChange","crewArray","improvement","modifyRelationship","change","crewId1","crewId2","current1","current2","generateCrewEvent","eventTypes","event","generateConflictEvent","generateAchievementEvent","generateDiscoveryEvent","generatePromotionEvent","onCrewEvent","involvedCrew","conflictTypes","conflictType","resolved","eligibleCrew","totalMorale","averageMorale","onMoraleAlert","getCrewMember","getAllCrew","getCrewByRole","getCrewByStation","getStation","getAllStations","getRecentEvents","getCrewStats","totalCrew","totalHealth","totalFatigue","totalStress","roleDistribution","stationEfficiency","averageHealth","averageFatigue","averageStress","saveCrewData","loadCrewData","DiplomacySystem","treaties","negotiations","diplomaticActions","PLAYER_FACTION_ID","initializePlayerFaction","government","ideology","stance","trustLevel","territory","economic","technological","influence","recentActions","personality","cooperation","trustworthiness","pride","greed","xenophobia","lastContact","homeSystem","playerFaction","modifyReputation","factionId","reason","oldReputation","calculateDiplomaticStance","recordDiplomaticAction","actor","reputationChange","successful","onReputationChanged","actionData","targetFaction","startNegotiation","playerOffer","playerSkill","crewBonus","sessionId","reputationModifier","session","participants","currentOffer","proposer","terms","totalValue","calculateOfferValue","priority","calculateOfferPriority","rounds","maxRounds","counterOffer","generateCounterOffer","onNegotiationStarted","playerValue","aiValue","term","playerOfferValue","factionDemand","calculateFactionDemand","counterTerms","difference","giver","receiver","baseDemand","powerRatio","continueNegotiation","acceptCounter","newOffer","applyNegotiationResults","onNegotiationCompleted","acceptChance","calculateAIAcceptanceChance","acceptanceChance","agreedOffer","otherFaction","generateRandomEncounter","activeFactions","encounterTypes","encounterType","location","generateEncounterDescription","availableActions","generateEncounterActions","consequences","onEncounterGenerated","descriptions","routine_patrol","distress_call","trade_opportunity","territorial_dispute","first_contact","typeDescriptions","baseActions","skillCheck","resolveEncounterAction","actionId","skillValue","consequence","resolution","getFaction","getAllFactions","getPlayerFaction","getActiveNegotiations","n","getRecentDiplomaticActions","getDiplomacyStats","allied","hostile","avgReputation","totalFactions","alliedFactions","hostileFactions","activeNegotiations","activeTreaties","totalEncounters","averageReputation","saveDiplomacyData","loadDiplomacyData","AlienSpecies","AlienAI","speciesProfiles","knowledgeBase","encounterPatterns","adaptiveBehaviors","initializeSpeciesProfiles","initializeKnowledgeBase","profiles","physiology","lifespan","environment","culture","taboos","rituals","artForms","primary","secondary","linguisticComplexity","translationDifficulty","emotionalRange","weaknesses","uniqueTech","energySource","psychology","emotionalStability","socialComplexity","memoryType","decisionMaking","behaviorPatterns","aggressionTriggers","friendshipFactors","fearFactors","profile","knowledge","physicalTraits","culturalTraits","technologicalCapabilities","communicationMethods","languageComprehension","culturalUnderstanding","technologicalUnderstanding","psychologicalProfile","totalContacts","successfulCommunications","hostileEncounters","peacefulEncounters","researchPoints","discoveredSecrets","lastUpdate","generateEncounter","isFirstContact","phase","calculateInitialIntensity","suspicion","calculateInitialSuspicion","interest","calculateInitialInterest","communicationEstablished","languageBarrier","translationProgress","actions","responses","success","knowledge_gained","technology_exchanged","cultural_insights","onFirstContact","firstContact","positiveRatio","processPlayerAction","actionType","generateActionDescription","complexity","calculateActionComplexity","risk","calculateActionRisk","expectedResponse","predictAlienResponse","culturalContext","response","generateAlienResponse","updateEncounterState","scan","communicate","approach","gift","demonstrate","threaten","probe","responseType","culturalReason","evaluation","evaluateAction","generateResponseDescription","culturalFactor","psychologicalState","determineAlienPsychologicalState","triggers","checkCulturalTriggers","positive","trigger","actionMatchesTrigger","actionMatchesFactor","threat_display","territorial_intrusion","aggressive_scanning","communication_disruption","unknown_entities","peaceful_intentions","cultural_exchange","respect_for_knowledge","technological_sharing","mutual_benefit","speciesName","negative","curious","confused","neutral","states","onCommunicationBreakthrough","updateEncounterPhase","updateKnowledgeBase","oldPhase","onCulturalInsight","getEncounter","getSpeciesProfile","getSpeciesKnowledge","getKnownSpecies","completeEncounter","awardEncounterRewards","knowledgeGained","availableTech","newTech","onTechnologyDiscovered","newSecret","getAlienAIStats","knownSpecies","successfulContacts","totalKnowledge","saveAlienAIData","loadAlienAIData","PerformanceMonitor","metrics","maxHistory","frameStartTime","lastFrameTime","fpsHistory","fpsCounter","fpsTimer","memoryObserver","lastOptimizationCheck","optimizationInterval","thresholds","getDefaultThresholds","getDefaultSettings","currentMetrics","createEmptyMetrics","setupMemoryObserver","startMonitoring","autoOptimize","enableAutoOptimization","PerformanceObserver","list","entryType","observe","entryTypes","updateFrameTiming","updateMemoryUsage","updateSystemMetrics","updateCurrentMetrics","storeMetrics","checkThresholds","performOptimizationCheck","onPerformanceUpdate","frameTime","fps","getAverageFPS","memory","memoryUsed","usedJSHeapSize","memoryTotal","totalJSHeapSize","memoryPercentage","estimateMemoryUsage","estimateTotalMemory","cpuUsage","getBattery","then","battery","batteryLevel","thermalState","estimateThermalState","poor","onThresholdExceeded","recommendations","generateOptimizationRecommendations","onOptimizationRecommended","rec","automaticApply","applyRecommendation","acceptable","particleQuality","postProcessing","high","maxAudioSources","maxRenderDistance","mobileLowPowerMode","audioQuality","recommendation","onSettingsChanged","excellent","good","low","medium","baseSettings","shadowQuality","bloom","antiAliasing","lodBias","physicsSteps","collisionComplexity","adaptiveQuality","activeEntities","textureMemory","setGameMetrics","getCurrentMetrics","getMetricsHistory","cutoff","m","getPerformanceSummary","recentMetrics","averageFPS","minFPS","maxFPS","averageFrameTime","averageMemoryUsage","performanceGrade","updateSettings","newSettings","changes","getSettings","disconnect","ParticleSystem","emitters","nextParticleId","nextEmitterId","maxParticles","qualityScale","enableTrails","enableBloom","pixelPerfect","updateEmitters","cleanupParticles","emitter","onEmitterCompleted","emissionRate","particlesToEmit","fullParticles","fractionalChance","emitParticle","burstCount","oldestId","particleId","spawnPosition","calculateSpawnPosition","calculateSpawnVelocity","randomBetween","sizeRange","generateParticleColor","colorVariation","maxAge","lifeRange","getParticleGravity","bounce","getParticleBounce","getParticleFriction","addParticleAnimations","onParticleSpawned","shape","shapeData","coneAngle","coneRadius","velocityRange","variation","spark","smoke","debris","starfield","warp_trail","beam","variationAmount","sizeAnimation","startSize","endSize","alphaAnimation","startAlpha","endAlpha","dt","updateParticlePhysics","updateParticleAnimations","applyEasing","lerp","colorAnimation","startColor","endColor","onParticleDied","createLaserBeam","updateEmitterPosition","stopEmitter","renderParticle","activeParticles","activeEmitters","Game","galaxyManager","cockpitStatusBar","celestialManager","spaceBackground","inventoryManager","craftingSystem","combatManager","playerProgression","researchSystem","crewManagement","diplomacySystem","alienAI","proceduralAudio","performanceMonitor","particleSystem","isRunning","isPaused","lastTime","lastFpsUpdate","performanceStats","renderTime","updateTime","memoryUsage","perfLogger","platformConfig","enableDebug","enablePerformanceMonitoring","initializeSystems","stateManager","initializeGalaxyAsync","zoomLevel","oldRep","newRep","method","insight","metric","threshold","setupEmergencyContent","focus","gameLoop","Playing","emergencyError","requestAnimationFrame","updateEndTime","updatePerformanceStats","handleError","Engineering","Weapons","currentStatus","Engines","warpState","playerPos","randomFaction","Laser","Explosion","tracks","nextTrack","summary","randomCrew","availableStation","Paused","warpDistortion","audioStats","renderFallbackSpaceBackground","renderEmergencyScreen","renderDebugInfo","finalError","starSize","debugInfo","entities","pause","getPaused","starObj","planetPos","planetObj","planet1","planet2","galaxyInitPromise","recoveryError","saveGame","getIsPaused","isGameRunning","getPerformanceStats","getRenderer","getInput","getPhysics","getAudio","getStateManager","game","initializeGame","getElementById","adjustCanvasForMobile","gameContainer","errorScreen","createElement","cssText","innerHTML","appendChild","showErrorScreen","containerRect","readyState"],"mappings":"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"}